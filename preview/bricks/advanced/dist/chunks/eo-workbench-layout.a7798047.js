"use strict";(globalThis.webpackChunk_next_bricks_advanced=globalThis.webpackChunk_next_bricks_advanced||[]).push([[9326],{55319:(e,t,r)=>{r.r(t),r.d(t,{EoWorkbenchLayout:()=>ie,EoWorkbenchLayoutComponent:()=>ae});var a,i=r(74635),n=r(70918),o=r(26902),s=r(5536),l=r(86121),c=r(70829),d=r(62740),p=r(18769),h=r.n(p),g=r(10300),m=r(24295),u=r(52681),b=r(89592),w=r(6055),y=(r(76477),r(45833)),v=r(91116);let f,x,k,z,A,E,C,M,I,L,N,W,B,D,H,T,R,S,Z,P,j,G,_,Y,Q,F;const{defineElement:$,property:J,event:U,method:X}=(0,g.createDecorators)(),q=(0,m.wrapBrick)("eo-button"),O=(0,m.wrapBrick)("eo-dropdown-button",{onActionClick:"action.click"}),K=(0,m.wrapBrick)("eo-icon"),V=(0,m.wrapBrick)("eo-checkbox",{onChange:"change"}),ee=(0,u.unwrapProvider)("basic.show-dialog"),te=e=>null!=e&&e.includes(":")?e.split(":")[0]:e,{isAdmin:re}=w.auth.getAuth(),ae=(0,p.forwardRef)((function(e,t){let{cardTitle:r="卡片列表",layouts:a,componentList:i=[],isEdit:n,onChange:o,onSave:s,onCancel:l,onActionClick:c}=e;const d=(0,p.useMemo)((()=>(0,y.WidthProvider)(y.Responsive)),[]),g=(0,p.useRef)(null),m=(0,p.useRef)(null),u=(0,p.useRef)(a??[]),[w,v]=(0,p.useState)(u.current),[f,x]=(0,p.useState)(3),[k,z]=(0,p.useState)(),A=(0,p.useCallback)((e=>{u.current=e,v(e)}),[]);(0,p.useImperativeHandle)(t,(()=>({setLayouts:A})));const E=(0,p.useCallback)((e=>{A(e),null==o||o(e)}),[o,A]),C=(0,p.useCallback)((e=>{if(!n)return;let t=!0;for(let r=0;r<e.length;r++){const{x:a,w:i,y:n,h:o,i:s,minH:l}=e[r];if(i>1&&a>0){t=!1;break}if(1===i&&a<2){const t=e.find((e=>e.i!==s&&1===e.w&&e.y===n&&a<2));t&&(e[r].minH=e[r].minH??o,e[r].h=Math.max(t.h,o))}else e[r].h=l??o,e[r].minH=void 0}E(t?e:u.current.map((e=>{const{w:t,i:r}=e,a=`${te(r)}:${Math.random()}`;let i=e.x;return t>1&&i>0&&(i=0),{...e,x:i,i:a}})))}),[E,n]),M=(0,p.useCallback)((e=>{const t=e.detail.map((e=>e.value)),r=w.map((e=>te(e.i))),a=e.detail.filter((e=>!r.includes(e.key))).map((e=>({...e.position,x:e.w>1?0:2*w.length%f,y:1/0})));E(w.filter((e=>t.includes(te(e.i)))).concat(a))}),[w,E,f]),I=()=>{E([])},L=(0,p.useCallback)((()=>{null==s||s(w.map((e=>({...e,i:te(e.i)}))))}),[w,s]),N=(0,p.useCallback)(((e,t)=>{e.stopPropagation(),E(w.filter((e=>te(e.i)!==t.key))??[])}),[E,w]),W=e=>{e.preventDefault()},B=(0,p.useMemo)((()=>w.map((e=>{const t=i.find((t=>t.key===te(e.i)));return t?h().createElement("div",{key:e.i,"data-grid":{...t.position??{},...e},style:t.style,className:"drag-box"},n&&h().createElement("div",{className:"edit-mask",onMouseDown:W}),h().createElement(b.ReactUseBrick,{useBrick:t.useBrick}),n&&h().createElement(K,{icon:"delete",lib:"antd",className:"delete-icon",onClick:e=>N(e,t)})):null})).filter(Boolean)),[i,N,w,n]),D=(0,p.useMemo)((()=>i.map((e=>({...e,label:e.title,value:e.key})))),[i]),H=(0,p.useMemo)((()=>w.map((e=>te(e.i)))),[w]),T=(0,p.useCallback)((()=>{if(m&&n){var e;const{top:t}=(null===(e=m.current)||void 0===e||null===(e=e.getClientRects())||void 0===e?void 0:e[0])??{};void 0!==t&&z({height:document.body.clientHeight-t,overflow:"scroll"})}}),[n]);return(0,p.useEffect)((()=>{if(n)return T(),A(a||[]),window.addEventListener("resize",T),()=>{window.removeEventListener("resize",T)}}),[n,T,a,A]),h().createElement("div",{className:"grid-layout-wrapper",ref:g},n&&h().createElement("div",{className:"component-wrapper"},h().createElement("div",{className:"component-title"},r),h().createElement("div",{className:"component-list"},h().createElement(V,{options:D,value:H,onChange:M}),h().createElement("slot",{name:"toolbar"}))),h().createElement("div",{className:"layout-wrapper",ref:m,style:k},n&&h().createElement("div",{className:"actions-wrapper"},h().createElement(q,{type:"primary",onClick:L},"保存"),h().createElement(q,{onClick:()=>{null==l||l()}},"取消"),h().createElement(O,{btnText:"更多",icon:{lib:"antd",icon:"down"},actions:[...re?[{text:"另存为模板",event:"saveAsTemplate"}]:[],{text:"从模版加载",event:"loadFromTemplate"},{text:"清空所有",danger:!0,event:"clear"}],onActionClick:e=>{(e=>{const{event:t}=e;"clear"===t?ee({type:"confirm",title:"清空确认",content:"将清空所有卡片，从零开始编辑，该操作无法撤回。"}).then(I):null==c||c(e,(w??[]).map((e=>({...e,i:te(e.i)}))))})(e.detail)},"data-testid":"edit-layout-actions"})),h().createElement(d,{className:"layout",draggableCancel:".delete-icon,.edit-actions,.ignore-item",breakpoints:{lg:1300,md:1024,sm:768},rowHeight:1,cols:{lg:3,md:3,sm:n?3:1},isResizable:!1,isDraggable:n,onDrag:(e,t,r)=>{var a;const i=null===(a=g.current)||void 0===a?void 0:a.querySelector(".react-grid-placeholder");i&&(r.w>1&&r.x>0?!i.classList.contains("forbidden")&&i.classList.add("forbidden"):i.classList.contains("forbidden")&&i.classList.remove("forbidden"))},onLayoutChange:C,onBreakpointChange:(e,t)=>{x(t)}},B)))}));let ie;var ne=new WeakMap,oe=new WeakMap,se=new WeakMap,le=new WeakMap,ce=new WeakMap,de=new WeakMap,pe=new WeakSet,he=new WeakMap,ge=new WeakMap,me=new WeakMap,ue=new WeakMap,be=new WeakMap,we=new WeakMap,ye=new WeakMap;class ve extends m.ReactNextElement{constructor(){super(...arguments),(0,i.A)(this,pe),(0,n.A)(this,ne,(f(this),(0,p.createRef)())),(0,n.A)(this,oe,k(this)),(0,n.A)(this,se,(z(this),A(this))),(0,n.A)(this,le,(E(this),C(this))),(0,n.A)(this,ce,(M(this),I(this))),(0,n.A)(this,de,(L(this),N(this))),(0,n.A)(this,he,(D(this),e=>{(0,s.A)(pe,this,W).emit(e)})),(0,n.A)(this,ge,H(this)),(0,n.A)(this,me,(S(this),e=>{(0,s.A)(pe,this,T).emit(e)})),(0,n.A)(this,ue,Z(this)),(0,n.A)(this,be,(G(this),()=>{(0,s.A)(pe,this,P).emit()})),(0,n.A)(this,we,_(this)),(0,n.A)(this,ye,(F(this),(e,t)=>{(0,s.A)(pe,this,Y).emit({action:e,layouts:t}),e.event&&this.dispatchEvent(new CustomEvent(e.event,{detail:t}))}))}get cardTitle(){return(0,c.A)(oe,this)}set cardTitle(e){(0,l.A)(oe,this,e)}get isEdit(){return(0,c.A)(se,this)}set isEdit(e){(0,l.A)(se,this,e)}get layouts(){return(0,c.A)(le,this)}set layouts(e){(0,l.A)(le,this,e)}get componentList(){return(0,c.A)(ce,this)}set componentList(e){(0,l.A)(ce,this,e)}setLayouts(e){var t;null===(t=(0,c.A)(ne,this).current)||void 0===t||t.setLayouts(e)}render(){return h().createElement(ae,{cardTitle:this.cardTitle,layouts:this.layouts,componentList:this.componentList,isEdit:this.isEdit,onChange:(0,c.A)(he,this),onSave:(0,c.A)(me,this),onCancel:(0,c.A)(be,this),onActionClick:(0,c.A)(ye,this),ref:(0,c.A)(ne,this)})}}a=ve,({e:[k,z,A,E,C,M,I,L,N,W,B,D,H,T,R,S,Z,P,j,G,_,Y,Q,F,f],c:[ie,x]}=(0,d.A)(a,[$("eo-workbench-layout",{styleTexts:[v.A]})],[[J(),1,"cardTitle"],[J({type:Boolean}),1,"isEdit"],[J({attribute:!1}),1,"layouts"],[J({attribute:!1}),1,"componentList"],[U({type:"change"}),1,"changeEvent",e=>(0,c.A)(de,e),(e,t)=>(0,l.A)(de,e,t)],[U({type:"save"}),1,"saveEvent",e=>(0,c.A)(ge,e),(e,t)=>(0,l.A)(ge,e,t)],[U({type:"cancel"}),1,"cancelEvent",e=>(0,c.A)(ue,e),(e,t)=>(0,l.A)(ue,e,t)],[U({type:"action.click"}),1,"actionClickEvent",e=>(0,c.A)(we,e),(e,t)=>(0,l.A)(we,e,t)],[X(),2,"setLayouts"]],0,(e=>ye.has((0,o.A)(e))),m.ReactNextElement)),x()},91116:(e,t,r)=>{r.d(t,{A:()=>d});var a=r(36758),i=r.n(a),n=r(40935),o=r.n(n),s=r(34566),l=r(16322),c=o()(i());c.i(s.A),c.i(l.A),c.push([e.id,":host{display:block}:host([hidden]){display:none}.grid-layout-wrapper{display:flex;height:100%;position:relative}.grid-layout-wrapper .component-wrapper{width:150px;padding:6px 12px;overflow-y:scroll;box-shadow:1px 0 0 0 var(--palette-gray-5);background:var(--color-fill-bg-container-1);z-index:999;position:sticky;top:0}:is(.grid-layout-wrapper .component-wrapper) .component-title{font-size:16px;padding:6px 0;font-weight:500}:is(.grid-layout-wrapper .component-wrapper) .component-list{margin-top:6px}:is(:is(.grid-layout-wrapper .component-wrapper) .component-list) eo-checkbox::part(checkbox-wrapper){display:flex;flex-wrap:wrap;gap:8px}:is(:is(.grid-layout-wrapper .component-wrapper) .component-list) eo-checkbox::part(checkbox-option){margin-left:0;width:100%;background:none}.grid-layout-wrapper .layout-wrapper{flex:1}:is(.grid-layout-wrapper .layout-wrapper) .layout{max-width:1300px;margin:0 auto}:is(.grid-layout-wrapper .layout-wrapper) .actions-wrapper{position:sticky;top:0;z-index:999;margin-left:1px;display:flex;gap:8px;justify-content:flex-end;background:var(--color-fill-bg-container-1);padding:8px 12px;box-shadow:0 1px 1px 0 var(--palette-gray-5)}:is(.grid-layout-wrapper .layout-wrapper) .edit-mask{position:absolute;left:0;right:0;top:45px;bottom:0;z-index:10}:is(.grid-layout-wrapper .layout-wrapper) .delete-icon{position:absolute;right:15px;top:15px;cursor:pointer;font-size:16px;width:30px;height:30px;display:flex;justify-content:center;align-items:center;background:var(--color-fill-bg-container-1);color:var(--color-normal-text)}:is(.grid-layout-wrapper .layout-wrapper) .delete-icon:hover{color:var(--color-error)}:is(.grid-layout-wrapper .layout-wrapper) .delete-icon:active{color:var(--color-error-active)}.react-grid-item.react-grid-placeholder{background-color:#ddd}.react-grid-item.react-draggable-dragging{pointer-events:none}.react-grid-item.react-grid-placeholder.forbidden{background-color:red}",""]);const d=c.toString()},34566:(e,t,r)=>{r.d(t,{A:()=>s});var a=r(36758),i=r.n(a),n=r(40935),o=r.n(n)()(i());o.push([e.id,'.react-grid-layout{position:relative;transition:height 200ms ease}.react-grid-item{transition:all 200ms ease;transition-property:left,top,width,height}.react-grid-item img{pointer-events:none;-webkit-user-select:none;user-select:none}.react-grid-item.cssTransforms{transition-property:transform,width,height}.react-grid-item.resizing{transition:none;z-index:1;will-change:width,height}.react-grid-item.react-draggable-dragging{transition:none;z-index:3;will-change:transform}.react-grid-item.dropping{visibility:hidden}.react-grid-item.react-grid-placeholder{background:red;opacity:0.2;transition-duration:100ms;z-index:2;-webkit-user-select:none;-o-user-select:none;user-select:none}.react-grid-item.react-grid-placeholder.placeholder-resizing{transition:none}.react-grid-item > .react-resizable-handle{position:absolute;width:20px;height:20px}.react-grid-item > .react-resizable-handle::after{content:"";position:absolute;right:3px;bottom:3px;width:5px;height:5px;border-right:2px solid rgba(0,0,0,0.4);border-bottom:2px solid rgba(0,0,0,0.4)}.react-resizable-hide > .react-resizable-handle{display:none}.react-grid-item > .react-resizable-handle.react-resizable-handle-sw{bottom:0;left:0;cursor:sw-resize;transform:rotate(90deg)}.react-grid-item > .react-resizable-handle.react-resizable-handle-se{bottom:0;right:0;cursor:se-resize}.react-grid-item > .react-resizable-handle.react-resizable-handle-nw{top:0;left:0;cursor:nw-resize;transform:rotate(180deg)}.react-grid-item > .react-resizable-handle.react-resizable-handle-ne{top:0;right:0;cursor:ne-resize;transform:rotate(270deg)}.react-grid-item > .react-resizable-handle.react-resizable-handle-w,\n.react-grid-item > .react-resizable-handle.react-resizable-handle-e{top:50%;margin-top:-10px;cursor:ew-resize}.react-grid-item > .react-resizable-handle.react-resizable-handle-w{left:0;transform:rotate(135deg)}.react-grid-item > .react-resizable-handle.react-resizable-handle-e{right:0;transform:rotate(315deg)}.react-grid-item > .react-resizable-handle.react-resizable-handle-n,\n.react-grid-item > .react-resizable-handle.react-resizable-handle-s{left:50%;margin-left:-10px;cursor:ns-resize}.react-grid-item > .react-resizable-handle.react-resizable-handle-n{top:0;transform:rotate(225deg)}.react-grid-item > .react-resizable-handle.react-resizable-handle-s{bottom:0;transform:rotate(45deg)}',""]);const s=o.toString()},16322:(e,t,r)=>{r.d(t,{A:()=>h});var a=r(36758),i=r.n(a),n=r(40935),o=r.n(n),s=r(20062),l=r.n(s),c=new URL(r(59224),r.b),d=o()(i()),p=l()(c);d.push([e.id,`.react-resizable{position:relative}.react-resizable-handle{position:absolute;width:20px;height:20px;background-repeat:no-repeat;background-origin:content-box;box-sizing:border-box;background-image:url(${p});background-position:bottom right;padding:0 3px 3px 0}.react-resizable-handle-sw{bottom:0;left:0;cursor:sw-resize;transform:rotate(90deg)}.react-resizable-handle-se{bottom:0;right:0;cursor:se-resize}.react-resizable-handle-nw{top:0;left:0;cursor:nw-resize;transform:rotate(180deg)}.react-resizable-handle-ne{top:0;right:0;cursor:ne-resize;transform:rotate(270deg)}.react-resizable-handle-w,\n.react-resizable-handle-e{top:50%;margin-top:-10px;cursor:ew-resize}.react-resizable-handle-w{left:0;transform:rotate(135deg)}.react-resizable-handle-e{right:0;transform:rotate(315deg)}.react-resizable-handle-n,\n.react-resizable-handle-s{left:50%;margin-left:-10px;cursor:ns-resize}.react-resizable-handle-n{top:0;transform:rotate(225deg)}.react-resizable-handle-s{bottom:0;transform:rotate(45deg)}`,""]);const h=d.toString()},59224:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2IDYiIHN0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOiNmZmZmZmYwMCIgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSI2cHgiIGhlaWdodD0iNnB4Ij48ZyBvcGFjaXR5PSIwLjMwMiI+PHBhdGggZD0iTSA2IDYgTCAwIDYgTCAwIDQuMiBMIDQgNC4yIEwgNC4yIDQuMiBMIDQuMiAwIEwgNiAwIEwgNiA2IEwgNiA2IFoiIGZpbGw9IiMwMDAwMDAiLz48L2c+PC9zdmc+"},5536:(e,t,r)=>{r.d(t,{A:()=>i});var a=r(12559);function i(e,t,r){return r((0,a.A)(e,t))}},74635:(e,t,r)=>{r.d(t,{A:()=>i});var a=r(72016);function i(e,t){(0,a.A)(e,t),t.add(e)}}}]);
//# sourceMappingURL=eo-workbench-layout.a7798047.js.map