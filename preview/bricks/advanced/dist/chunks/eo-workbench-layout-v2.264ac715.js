"use strict";(globalThis.webpackChunk_next_bricks_advanced=globalThis.webpackChunk_next_bricks_advanced||[]).push([[771],{20504:(e,t,r)=>{r.r(t),r.d(t,{EoWorkbenchLayoutComponent:()=>ne,EoWorkbenchLayoutV2:()=>oe});var a,i=r(74635),n=r(70918),o=r(26902),s=r(5536),l=r(86121),c=r(70829),d=r(62740),p=r(18769),u=r.n(p),h=r(10300),m=r(24295),g=r(52681),b=r(89592),f=r(6055),y=r(45833),v=(r(76477),r(72465));let A,k,w,x,z,M,W,I,E,L,C,D,B,T,N,R,P,O,H,S,Z,j,U,Q,X,Y,q,G;r(78259);const{defineElement:K,property:_,event:F,method:J}=(0,h.createDecorators)(),$=(0,m.wrapBrick)("eo-button"),V=(0,m.wrapBrick)("eo-dropdown-button",{onActionClick:"action.click"}),ee=(0,m.wrapBrick)("eo-icon"),te=(0,m.wrapBrick)("eo-checkbox",{onChange:"change"}),re=(0,g.unwrapProvider)("basic.show-dialog"),ae=e=>null!=e&&e.includes(":")?e.split(":")[0]:e,{isAdmin:ie}=f.auth.getAuth(),ne=(0,p.forwardRef)((function(e,t){let{cardTitle:r="卡片列表",layouts:a,toolbarBricks:i,componentList:n=[],isEdit:o,onChange:s,onSave:l,onCancel:c,onActionClick:d}=e;const h=(0,p.useMemo)((()=>(0,y.WidthProvider)(y.Responsive)),[]),m=(0,p.useRef)(null),g=(0,p.useRef)(null),f=(0,p.useRef)(a??[]),[A,k]=(0,p.useState)(f.current),[w,x]=(0,p.useState)(3),[z,M]=(0,p.useState)(),W=(0,p.useCallback)((e=>{f.current=e,k(e)}),[]);(0,p.useImperativeHandle)(t,(()=>({setLayouts:W})));const I=(0,p.useCallback)((e=>{W(e),null==s||s(e)}),[s,W]),E=(0,p.useCallback)((e=>{if(!o)return;let t=!0;for(let r=0;r<e.length;r++){const{x:a,w:i,y:n,h:o,i:s,minH:l}=e[r];if(i>1&&a>0){t=!1;break}if(1===i&&a<2){const t=e.find((e=>e.i!==s&&1===e.w&&e.y===n&&a<2));t&&(e[r].minH=e[r].minH??o,e[r].h=Math.max(t.h,o))}else e[r].h=l??o,e[r].minH=void 0}I(t?e:f.current.map((e=>{const{w:t,i:r}=e,a=`${ae(r)}:${Math.random()}`;let i=e.x;return t>1&&i>0&&(i=0),{...e,x:i,i:a}})))}),[I,o]),L=(0,p.useCallback)((e=>{const t=e.detail.map((e=>e.value)),r=A.map((e=>ae(e.i))),a=e.detail.filter((e=>!r.includes(e.key))).map((e=>({...e.position,x:e.w>1?0:2*A.length%w,y:1/0})));I(A.filter((e=>t.includes(ae(e.i)))).concat(a))}),[A,I,w]),C=()=>{I([])},D=(0,p.useCallback)((()=>{null==l||l(A.map((e=>({...e,i:ae(e.i)}))))}),[A,l]),B=(0,p.useCallback)(((e,t)=>{e.stopPropagation(),I(A.filter((e=>ae(e.i)!==t.key))??[])}),[I,A]),T=e=>{e.preventDefault()},N=(0,p.useMemo)((()=>A.map((e=>{const t=n.find((t=>t.key===ae(e.i)));return t?u().createElement("div",{key:e.i,"data-grid":{...t.position??{},...e},style:t.style,className:"drag-box"},o&&u().createElement("div",{className:v.A.editMask,onMouseDown:T}),u().createElement(b.ReactUseBrick,{useBrick:t.useBrick}),o&&u().createElement(ee,{icon:"delete",lib:"antd",className:v.A.deleteIcon,onClick:e=>B(e,t)})):null})).filter(Boolean)),[n,B,A,o]),R=(0,p.useMemo)((()=>n.map((e=>({...e,label:e.title,value:e.key})))),[n]),P=(0,p.useMemo)((()=>A.map((e=>ae(e.i)))),[A]),O=(0,p.useCallback)((()=>{if(g&&o){var e;const{top:t}=(null===(e=g.current)||void 0===e||null===(e=e.getClientRects())||void 0===e?void 0:e[0])??{};void 0!==t&&M({height:document.body.clientHeight-t,overflow:"scroll"})}}),[o]);return(0,p.useEffect)((()=>{if(o)return O(),W(a||[]),window.addEventListener("resize",O),()=>{window.removeEventListener("resize",O)}}),[o,O,a,W]),u().createElement("div",{className:v.A.gridLayoutWrapper,ref:m},o&&u().createElement("div",{className:v.A.componentWrapper},u().createElement("div",{className:v.A.componentTitle},r),u().createElement("div",{className:v.A.componentList},u().createElement(te,{options:R,value:P,onChange:L}),(null==i?void 0:i.useBrick)&&u().createElement(b.ReactUseMultipleBricks,{useBrick:i.useBrick}))),u().createElement("div",{className:v.A.layoutWrapper,ref:g,style:z},o&&u().createElement("div",{className:v.A.actionsWrapper},u().createElement($,{type:"primary",onClick:D},"保存"),u().createElement($,{onClick:()=>{null==c||c()}},"取消"),u().createElement(V,{btnText:"更多",icon:{lib:"antd",icon:"down"},actions:[...ie?[{text:"另存为模板",event:"saveAsTemplate"}]:[],{text:"从模版加载",event:"loadFromTemplate"},{text:"清空所有",danger:!0,event:"clear"}],onActionClick:e=>{(e=>{const{event:t}=e;"clear"===t?re({type:"confirm",title:"清空确认",content:"将清空所有卡片，从零开始编辑，该操作无法撤回。"}).then(C):null==d||d(e,(A??[]).map((e=>({...e,i:ae(e.i)}))))})(e.detail)},"data-testid":"edit-layout-actions"})),u().createElement(h,{className:v.A.layout,draggableCancel:`.${v.A.deleteIcon},.edit-actions,.ignore-item`,breakpoints:{lg:1300,md:1024,sm:768},rowHeight:1,cols:{lg:3,md:3,sm:o?3:1},isResizable:!1,isDraggable:o,onDrag:(e,t,r)=>{var a;const i=null===(a=m.current)||void 0===a?void 0:a.querySelector(".react-grid-placeholder");i&&(r.w>1&&r.x>0?!i.classList.contains("forbidden")&&i.classList.add("forbidden"):i.classList.contains("forbidden")&&i.classList.remove("forbidden"))},onLayoutChange:E,onBreakpointChange:(e,t)=>{x(t)}},N)))}));let oe;var se=new WeakMap,le=new WeakMap,ce=new WeakMap,de=new WeakMap,pe=new WeakMap,ue=new WeakMap,he=new WeakMap,me=new WeakSet,ge=new WeakMap,be=new WeakMap,fe=new WeakMap,ye=new WeakMap,ve=new WeakMap,Ae=new WeakMap,ke=new WeakMap;class we extends m.ReactNextElement{constructor(){super(...arguments),(0,i.A)(this,me),(0,n.A)(this,se,(A(this),(0,p.createRef)())),(0,n.A)(this,le,w(this)),(0,n.A)(this,ce,(x(this),z(this))),(0,n.A)(this,de,(M(this),W(this))),(0,n.A)(this,pe,(I(this),E(this))),(0,n.A)(this,ue,(L(this),C(this))),(0,n.A)(this,he,(D(this),B(this))),(0,n.A)(this,ge,(R(this),e=>{(0,s.A)(me,this,T).emit(e)})),(0,n.A)(this,be,P(this)),(0,n.A)(this,fe,(S(this),e=>{(0,s.A)(me,this,O).emit(e)})),(0,n.A)(this,ye,Z(this)),(0,n.A)(this,ve,(Q(this),()=>{(0,s.A)(me,this,j).emit()})),(0,n.A)(this,Ae,X(this)),(0,n.A)(this,ke,(G(this),(e,t)=>{(0,s.A)(me,this,Y).emit({action:e,layouts:t}),e.event&&this.dispatchEvent(new CustomEvent(e.event,{detail:t}))}))}get cardTitle(){return(0,c.A)(le,this)}set cardTitle(e){(0,l.A)(le,this,e)}get isEdit(){return(0,c.A)(ce,this)}set isEdit(e){(0,l.A)(ce,this,e)}get layouts(){return(0,c.A)(de,this)}set layouts(e){(0,l.A)(de,this,e)}get toolbarBricks(){return(0,c.A)(pe,this)}set toolbarBricks(e){(0,l.A)(pe,this,e)}get componentList(){return(0,c.A)(ue,this)}set componentList(e){(0,l.A)(ue,this,e)}setLayouts(e){var t;null===(t=(0,c.A)(se,this).current)||void 0===t||t.setLayouts(e)}connectedCallback(){this.style.display||(this.style.display="block"),super.connectedCallback()}render(){return u().createElement(ne,{cardTitle:this.cardTitle,layouts:this.layouts,toolbarBricks:this.toolbarBricks,componentList:this.componentList,isEdit:this.isEdit,onChange:(0,c.A)(ge,this),onSave:(0,c.A)(fe,this),onCancel:(0,c.A)(ve,this),onActionClick:(0,c.A)(ke,this),ref:(0,c.A)(se,this)})}}a=we,({e:[w,x,z,M,W,I,E,L,C,D,B,T,N,R,P,O,H,S,Z,j,U,Q,X,Y,q,G,A],c:[oe,k]}=(0,d.A)(a,[K("eo-workbench-layout-v2",{shadowOptions:!1})],[[_(),1,"cardTitle"],[_({type:Boolean}),1,"isEdit"],[_({attribute:!1}),1,"layouts"],[_({attribute:!1}),1,"toolbarBricks"],[_({attribute:!1}),1,"componentList"],[F({type:"change"}),1,"changeEvent",e=>(0,c.A)(he,e),(e,t)=>(0,l.A)(he,e,t)],[F({type:"save"}),1,"saveEvent",e=>(0,c.A)(be,e),(e,t)=>(0,l.A)(be,e,t)],[F({type:"cancel"}),1,"cancelEvent",e=>(0,c.A)(ye,e),(e,t)=>(0,l.A)(ye,e,t)],[F({type:"action.click"}),1,"actionClickEvent",e=>(0,c.A)(Ae,e),(e,t)=>(0,l.A)(Ae,e,t)],[J(),2,"setLayouts"]],0,(e=>ke.has((0,o.A)(e))),m.ReactNextElement)),k()},85689:(e,t,r)=>{r.d(t,{A:()=>d});var a=r(36758),i=r.n(a),n=r(40935),o=r.n(n),s=r(87796),l=r(37564),c=o()(i());c.i(s.A),c.i(l.A),c.push([e.id,".react-grid-item.react-grid-placeholder{background-color:#ddd}.react-grid-item.react-draggable-dragging{pointer-events:none}.react-grid-item.react-grid-placeholder.forbidden{background-color:red}",""]);const d=c},87796:(e,t,r)=>{r.d(t,{A:()=>s});var a=r(36758),i=r.n(a),n=r(40935),o=r.n(n)()(i());o.push([e.id,'.react-grid-layout{position:relative;transition:height 200ms ease}.react-grid-item{transition:all 200ms ease;transition-property:left,top,width,height}.react-grid-item img{pointer-events:none;-webkit-user-select:none;user-select:none}.react-grid-item.cssTransforms{transition-property:transform,width,height}.react-grid-item.resizing{transition:none;z-index:1;will-change:width,height}.react-grid-item.react-draggable-dragging{transition:none;z-index:3;will-change:transform}.react-grid-item.dropping{visibility:hidden}.react-grid-item.react-grid-placeholder{background:red;opacity:0.2;transition-duration:100ms;z-index:2;-webkit-user-select:none;-o-user-select:none;user-select:none}.react-grid-item.react-grid-placeholder.placeholder-resizing{transition:none}.react-grid-item > .react-resizable-handle{position:absolute;width:20px;height:20px}.react-grid-item > .react-resizable-handle::after{content:"";position:absolute;right:3px;bottom:3px;width:5px;height:5px;border-right:2px solid rgba(0,0,0,0.4);border-bottom:2px solid rgba(0,0,0,0.4)}.react-resizable-hide > .react-resizable-handle{display:none}.react-grid-item > .react-resizable-handle.react-resizable-handle-sw{bottom:0;left:0;cursor:sw-resize;transform:rotate(90deg)}.react-grid-item > .react-resizable-handle.react-resizable-handle-se{bottom:0;right:0;cursor:se-resize}.react-grid-item > .react-resizable-handle.react-resizable-handle-nw{top:0;left:0;cursor:nw-resize;transform:rotate(180deg)}.react-grid-item > .react-resizable-handle.react-resizable-handle-ne{top:0;right:0;cursor:ne-resize;transform:rotate(270deg)}.react-grid-item > .react-resizable-handle.react-resizable-handle-w,\n.react-grid-item > .react-resizable-handle.react-resizable-handle-e{top:50%;margin-top:-10px;cursor:ew-resize}.react-grid-item > .react-resizable-handle.react-resizable-handle-w{left:0;transform:rotate(135deg)}.react-grid-item > .react-resizable-handle.react-resizable-handle-e{right:0;transform:rotate(315deg)}.react-grid-item > .react-resizable-handle.react-resizable-handle-n,\n.react-grid-item > .react-resizable-handle.react-resizable-handle-s{left:50%;margin-left:-10px;cursor:ns-resize}.react-grid-item > .react-resizable-handle.react-resizable-handle-n{top:0;transform:rotate(225deg)}.react-grid-item > .react-resizable-handle.react-resizable-handle-s{bottom:0;transform:rotate(45deg)}',""]);const s=o},37564:(e,t,r)=>{r.d(t,{A:()=>u});var a=r(36758),i=r.n(a),n=r(40935),o=r.n(n),s=r(20062),l=r.n(s),c=new URL(r(59224),r.b),d=o()(i()),p=l()(c);d.push([e.id,`.react-resizable{position:relative}.react-resizable-handle{position:absolute;width:20px;height:20px;background-repeat:no-repeat;background-origin:content-box;box-sizing:border-box;background-image:url(${p});background-position:bottom right;padding:0 3px 3px 0}.react-resizable-handle-sw{bottom:0;left:0;cursor:sw-resize;transform:rotate(90deg)}.react-resizable-handle-se{bottom:0;right:0;cursor:se-resize}.react-resizable-handle-nw{top:0;left:0;cursor:nw-resize;transform:rotate(180deg)}.react-resizable-handle-ne{top:0;right:0;cursor:ne-resize;transform:rotate(270deg)}.react-resizable-handle-w,\n.react-resizable-handle-e{top:50%;margin-top:-10px;cursor:ew-resize}.react-resizable-handle-w{left:0;transform:rotate(135deg)}.react-resizable-handle-e{right:0;transform:rotate(315deg)}.react-resizable-handle-n,\n.react-resizable-handle-s{left:50%;margin-left:-10px;cursor:ns-resize}.react-resizable-handle-n{top:0;transform:rotate(225deg)}.react-resizable-handle-s{bottom:0;transform:rotate(45deg)}`,""]);const u=d},89739:(e,t,r)=>{r.d(t,{A:()=>s});var a=r(36758),i=r.n(a),n=r(40935),o=r.n(n)()(i());o.push([e.id,".gridLayoutWrapper--DIttynOM{display:flex;height:100%;position:relative}.gridLayoutWrapper--DIttynOM .componentWrapper--P8xsKOQP{width:170px;padding:6px 12px;overflow-y:scroll;box-shadow:1px 0 0 0 var(--palette-gray-5);background:var(--color-fill-bg-container-1);z-index:999;position:sticky;top:0}:is(.gridLayoutWrapper--DIttynOM .componentWrapper--P8xsKOQP) .componentTitle--nKf9GEoj{font-size:16px;padding:6px 0;font-weight:500}:is(.gridLayoutWrapper--DIttynOM .componentWrapper--P8xsKOQP) .componentList--s3XnAYsB{margin-top:6px}:is(:is(.gridLayoutWrapper--DIttynOM .componentWrapper--P8xsKOQP) .componentList--s3XnAYsB) eo-checkbox::part(checkbox-wrapper){display:flex;flex-wrap:wrap;gap:8px}:is(:is(.gridLayoutWrapper--DIttynOM .componentWrapper--P8xsKOQP) .componentList--s3XnAYsB) eo-checkbox::part(checkbox-option){margin-left:0;width:100%;background:none}.gridLayoutWrapper--DIttynOM .layoutWrapper--pk1t3UAR{flex:1}:is(.gridLayoutWrapper--DIttynOM .layoutWrapper--pk1t3UAR) .layout--kz28taJj{max-width:1300px;margin:0 auto}:is(.gridLayoutWrapper--DIttynOM .layoutWrapper--pk1t3UAR) .actionsWrapper--vQro2Dyn{position:sticky;top:0;z-index:999;margin-left:1px;display:flex;gap:8px;justify-content:flex-end;background:var(--color-fill-bg-container-1);padding:8px 12px;box-shadow:0 1px 1px 0 var(--palette-gray-5)}:is(.gridLayoutWrapper--DIttynOM .layoutWrapper--pk1t3UAR) .editMask--ql2wriZf{position:absolute;left:0;right:0;top:45px;bottom:0;z-index:10}:is(.gridLayoutWrapper--DIttynOM .layoutWrapper--pk1t3UAR) .deleteIcon--IjEzXZqc{position:absolute;right:15px;top:15px;cursor:pointer;font-size:16px;width:30px;height:30px;display:flex;justify-content:center;align-items:center;background:var(--color-fill-bg-container-1);color:var(--color-normal-text)}:is(.gridLayoutWrapper--DIttynOM .layoutWrapper--pk1t3UAR) .deleteIcon--IjEzXZqc:hover{color:var(--color-error)}:is(.gridLayoutWrapper--DIttynOM .layoutWrapper--pk1t3UAR) .deleteIcon--IjEzXZqc:active{color:var(--color-error-active)}",""]),o.locals={gridLayoutWrapper:"gridLayoutWrapper--DIttynOM",componentWrapper:"componentWrapper--P8xsKOQP",componentTitle:"componentTitle--nKf9GEoj",componentList:"componentList--s3XnAYsB",layoutWrapper:"layoutWrapper--pk1t3UAR",layout:"layout--kz28taJj",actionsWrapper:"actionsWrapper--vQro2Dyn",editMask:"editMask--ql2wriZf",deleteIcon:"deleteIcon--IjEzXZqc"};const s=o},78259:(e,t,r)=>{var a=r(72591),i=r.n(a),n=r(1740),o=r.n(n),s=r(88128),l=r.n(s),c=r(30855),d=r.n(c),p=r(93051),u=r.n(p),h=r(73656),m=r.n(h),g=r(85689),b={};b.styleTagTransform=m(),b.setAttributes=d(),b.insert=l().bind(null,"head"),b.domAPI=o(),b.insertStyleElement=u(),i()(g.A,b),g.A&&g.A.locals&&g.A.locals},72465:(e,t,r)=>{r.d(t,{A:()=>f});var a=r(72591),i=r.n(a),n=r(1740),o=r.n(n),s=r(88128),l=r.n(s),c=r(30855),d=r.n(c),p=r(93051),u=r.n(p),h=r(73656),m=r.n(h),g=r(89739),b={};b.styleTagTransform=m(),b.setAttributes=d(),b.insert=l().bind(null,"head"),b.domAPI=o(),b.insertStyleElement=u(),i()(g.A,b);const f=g.A&&g.A.locals?g.A.locals:void 0},72591:e=>{var t=[];function r(e){for(var r=-1,a=0;a<t.length;a++)if(t[a].identifier===e){r=a;break}return r}function a(e,a){for(var n={},o=[],s=0;s<e.length;s++){var l=e[s],c=a.base?l[0]+a.base:l[0],d=n[c]||0,p="".concat(c," ").concat(d);n[c]=d+1;var u=r(p),h={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==u)t[u].references++,t[u].updater(h);else{var m=i(h,a);a.byIndex=s,t.splice(s,0,{identifier:p,updater:m,references:1})}o.push(p)}return o}function i(e,t){var r=t.domAPI(t);return r.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;r.update(e=t)}else r.remove()}}e.exports=function(e,i){var n=a(e=e||[],i=i||{});return function(e){e=e||[];for(var o=0;o<n.length;o++){var s=r(n[o]);t[s].references--}for(var l=a(e,i),c=0;c<n.length;c++){var d=r(n[c]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}n=l}}},88128:e=>{var t={};e.exports=function(e,r){var a=function(e){if(void 0===t[e]){var r=document.querySelector(e);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}t[e]=r}return t[e]}(e);if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(r)}},93051:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},30855:(e,t,r)=>{e.exports=function(e){var t=r.nc;t&&e.setAttribute("nonce",t)}},1740:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(r){!function(e,t,r){var a="";r.supports&&(a+="@supports (".concat(r.supports,") {")),r.media&&(a+="@media ".concat(r.media," {"));var i=void 0!==r.layer;i&&(a+="@layer".concat(r.layer.length>0?" ".concat(r.layer):""," {")),a+=r.css,i&&(a+="}"),r.media&&(a+="}"),r.supports&&(a+="}");var n=r.sourceMap;n&&"undefined"!=typeof btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(n))))," */")),t.styleTagTransform(a,e,t.options)}(t,e,r)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},73656:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},59224:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2IDYiIHN0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOiNmZmZmZmYwMCIgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSI2cHgiIGhlaWdodD0iNnB4Ij48ZyBvcGFjaXR5PSIwLjMwMiI+PHBhdGggZD0iTSA2IDYgTCAwIDYgTCAwIDQuMiBMIDQgNC4yIEwgNC4yIDQuMiBMIDQuMiAwIEwgNiAwIEwgNiA2IEwgNiA2IFoiIGZpbGw9IiMwMDAwMDAiLz48L2c+PC9zdmc+"},5536:(e,t,r)=>{r.d(t,{A:()=>i});var a=r(12559);function i(e,t,r){return r((0,a.A)(e,t))}},74635:(e,t,r)=>{r.d(t,{A:()=>i});var a=r(72016);function i(e,t){(0,a.A)(e,t),t.add(e)}}}]);
//# sourceMappingURL=eo-workbench-layout-v2.264ac715.js.map