/*! For license information please see 2252.65e0507e.js.LICENSE.txt */
"use strict";(globalThis.webpackChunk_next_bricks_advanced=globalThis.webpackChunk_next_bricks_advanced||[]).push([[2252],{86330:(e,t,n)=>{function r(e,t,n,r,o,i,s){try{var a=e[i](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(o,i){var s=e.apply(t,n);function a(e){r(s,o,i,a,c,"next",e)}function c(e){r(s,o,i,a,c,"throw",e)}a(void 0)}))}}n.d(t,{A:()=>o})},24586:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(11369);function o(e,t,n){return(t=(0,r.A)(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},69740:(e,t,n)=>{n.d(t,{A:()=>i});var r=n(24586);function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}},62252:(e,t,n)=>{n.r(t),n.d(t,{analytics:()=>u,auth:()=>ft,checkInstalledApps:()=>o,checkPermissions:()=>lt,flowApi:()=>i,menu:()=>s,messageDispatcher:()=>dt});var r={};n.r(r),n.d(r,{authenticate:()=>m,getAuth:()=>g,isLoggedIn:()=>A,logout:()=>v});var o={};n.r(o),n.d(o,{getCheckedApp:()=>re,preCheckInstalledApps:()=>te,waitForCheckingApps:()=>ne});var i={};n.r(i),n.d(i,{FLOW_API_PROVIDER:()=>ie,clearCollectWidgetContract:()=>ve,clearDebugContract:()=>we,collectContract:()=>me,collectDebugContract:()=>Ae,collectWidgetContract:()=>ge,getArgsOfFlowApi:()=>Se,isFlowApiProvider:()=>be,registerFlowApiProvider:()=>ce});var s={};n.r(s),n.d(s,{fetchMenuById:()=>Ge,getMenuById:()=>He});var a={};n.r(a),n.d(a,{onRequest:()=>st,onResponse:()=>at,onResponseError:()=>ct});var c={};n.r(c),n.d(c,{create:()=>pt});var u={};n.r(u),n.d(u,{http:()=>a,initialize:()=>ot,pageView:()=>c});var p=n(54958),l=n(86330),d=n(30108),f=function(){var e=(0,l.A)((function*(e,t){return(yield d.http.post("api/gateway/micro_app.permission.ValidatePermissions/api/micro_app/v1/permission/validate",e,t)).data}));return function(t,n){return e.apply(this,arguments)}}();const h={};function m(e){Object.assign(h,{org:e.org,username:e.username,userInstanceId:e.userInstanceId,loginFrom:e.loginFrom,accessRule:e.accessRule,isAdmin:e.isAdmin,csrfToken:e.csrfToken,license:e.license,accessToken:e.accessToken,userShowValue:e.userShowValue})}function g(){return{...h}}function v(){for(const e of Object.keys(h))h[e]=void 0;w.clear(),y.length=0,b.clear()}function A(){return void 0!==h.username}const w=new Map,y=[],b=new Map;function S(e){if(A()&&!g().isAdmin)return I((0,p.scanPermissionActionsInAny)(e))}async function I(e){const t=e.filter((e=>!y.includes(e)));if(0===t.length)return;const n=[],r=[];for(const e of t){const t=w.get(e);t?n.push(t):r.push(e)}if(r.length>0){const e=(async()=>{try{const e=await f({actions:r},{noAbortOnRouteChange:!0});for(const t of e.actions)b.set(t.action,t.authorizationStatus),"undefined"===t.authorizationStatus&&console.error(`Undefined permission action: "${t.action}"`)}catch(e){console.error("Pre-check permissions failed",e)}finally{y.push(...r)}})();for(const t of r)w.set(t,e);n.push(e)}await Promise.all(n)}var O=n(74635),P=n(70918),E=n(5536),k=n(12559),M=n(86121),C=n(70829),_=n(15223),T=n(41030);const j=1e3,N=5;var D=new WeakMap,$=new WeakMap,R=new WeakMap,W=new WeakMap,x=new WeakMap,L=new WeakMap,U=new WeakMap,B=new WeakSet;class F{constructor(e){(0,O.A)(this,B),(0,P.A)(this,D,void 0),(0,P.A)(this,$,void 0),(0,P.A)(this,R,[]),(0,P.A)(this,W,new Set),(0,P.A)(this,x,new Set),(0,P.A)(this,L,0),(0,P.A)(this,U,!1),(0,M.A)(D,this,e)}send(e){(0,C.A)($,this)||(0,M.A)($,this,(0,k.A)(B,this,q).call(this));const t=JSON.stringify(e);(0,C.A)($,this).readyState===WebSocket.OPEN?(0,C.A)($,this).send(t):(0,C.A)(R,this).push(t)}onMessage(e){(0,C.A)(W,this).add(e)}onClose(e){(0,C.A)(x,this).add(e)}reset(){(0,C.A)(R,this).length=0,(0,C.A)(W,this).clear(),(0,C.A)(x,this).clear()}close(){var e;(0,M.A)(U,this,!0),(null===(e=(0,C.A)($,this))||void 0===e?void 0:e.readyState)===WebSocket.OPEN&&(0,C.A)($,this).close()}}function q(){console.log("WebSocket connecting ...");const e=new WebSocket((0,C.A)(D,this));let t;return e.addEventListener("open",(n=>{console.log("WebSocket open:",n),t=setTimeout((()=>{t=void 0,(0,M.A)(L,this,0)}),1e3);for(const t of(0,C.A)(R,this))e.send(t);(0,C.A)(R,this).length=0})),e.addEventListener("close",(e=>{if(!(0,C.A)(U,this)){void 0!==t&&clearTimeout(t),console.log("WebSocket close:",e);for(const e of(0,C.A)(x,this))e();1e3!==e.code&&(0,k.A)(B,this,z).call(this)}})),e.addEventListener("error",(e=>{console.error("WebSocket error:",e)})),e.addEventListener("message",(e=>{const t=JSON.parse(e.data);for(const e of(0,C.A)(W,this))e(t)})),e}function z(){if((0,C.A)(L,this)>=N)return void console.error("WebSocket connect retry limit exceeded");const e=Math.pow(2,(0,C.A)(L,this))*j;console.log("WebSocket will reconnect after %d seconds",e/1e3),setTimeout((()=>{var e;(0,M.A)(L,this,(e=(0,C.A)(L,this),++e)),(0,M.A)($,this,(0,k.A)(B,this,q).call(this))}),e)}var H=new WeakMap,G=new WeakMap,J=new WeakMap,V=new WeakSet;function Y(e){if(!(0,C.A)(H,e)){const t=`${"https:"===location.protocol?"wss:":"ws:"}//${window.location.host}${(0,_.getBasePath)()}api/websocket_service/v1/ws`;(0,M.A)(H,e,new F(t))}return(0,C.A)(H,e)}function K(e,t,n,r){const o=(0,C.A)(G,this)[e].get(r);if(o)return o;const i={event:"sub"===e?"TOPIC.SUB":"TOPIC.UNSUB",payload:n},s=new Promise(((t,r)=>{const o=Q(n);(0,E.A)(V,this,Y).onMessage((n=>{const i=n.event===("sub"===e?"TOPIC.SUB_SUCCESS":"TOPIC.UNSUB_SUCCESS"),s=n.event===("sub"===e?"TOPIC.SUB_FAILED":"TOPIC.UNSUB_FAILED");(i||s)&&o===Q(n.payload)&&(i?t:r)(n)})),(0,E.A)(V,this,Y).send(i)}));return"sub"===e&&(0,C.A)(J,this).set(t,r),(0,C.A)(G,this)[e].set(r,s),s}function Q(e){const{system:t,topic:n}=e;return JSON.stringify({system:t,topic:n})}var X=function(){var e=(0,l.A)((function*(e,t){return(yield d.http.post("api/gateway/micro_app_standalone.runtime.SearchMicroAppStandalone/api/v1/micro_app_standalone/search",e,t)).data}));return function(t,n){return e.apply(this,arguments)}}();const Z=new Map,ee=new Map;function te(e,t){if(window.STANDALONE_MICRO_APPS&&!window.NO_AUTH_GUARD){const n=function(e){const t={usedArgs:new Set},{customTemplates:n,menus:r}=e.meta??{};return(0,p.traverseStoryboardExpressions)([e.routes,n,r],((e,n)=>{(0,p.collectInstalledAppsHasUsage)(t,e,n)}),"INSTALLED_APPS"),[...t.usedArgs]}(e),r=[];for(const e of n)Z.has(e)||t(e)||r.push(e);if(0===r.length)return;const o=X({query:{appId:{$in:r}},fields:["appId","currentVersion","installStatus"]}).catch((e=>{console.error("Get off site standalone micro-apps failed",e)}));for(const e of r)Z.set(e,o.then((t=>{var n;const r=null==t||null===(n=t.list)||void 0===n?void 0:n.find((t=>t.appId===e)),o=r?{...r,id:e}:void 0;return ee.set(e,o),o})))}}async function ne(e){await Promise.all(e.map((e=>Z.get(e))))}function re(e){if(window.STANDALONE_MICRO_APPS)return ee.get(e)}var oe=n(13078);const ie="core.provider-flow-api";function se(e,t){return e.some((e=>e.source===t))}async function ae(e){let{url:t,originalUri:n,method:r="GET",responseWrapper:o=!0,ext_fields:i=[],request:s,isFileType:a,stream:c}=e;const u=["get","delete","head"].includes(r.toLowerCase()),p=a?{responseType:"blob"}:{};let l;for(var f=arguments.length,h=new Array(f>1?f-1:0),m=1;m<f;m++)h[m-1]=arguments[m];if(u){var g,v;let e,o;var A;if(n&&"object"===(null==s?void 0:s.type)&&((null===(g=n.match(/:([^/]+)/g))||void 0===g?void 0:g.length)??0)===((null===(v=s.fields)||void 0===v?void 0:v.length)??0)?[o]=h:[e,o]=h,c)return await(0,oe.createSSEStream)(d.http.getUrlWithParams(t,e),{...p,...o,method:r,headers:Object.fromEntries([...new Headers((null===(A=o)||void 0===A?void 0:A.headers)??{}).entries()])});l=await d.http.simpleRequest(r,t,{params:e,...p,...o})}else{const e=function(e){if("object"!==(null==e?void 0:e.type))return!1;const t=e=>!(0,T.isEmpty)(e)&&e.some((e=>["file","file[]"].includes(e.type)||t(e.fields)));return t(e.fields)}(s),n=function(e){const t=se(e,"query"),n=se(e,"body");for(var r=arguments.length,o=new Array(r>1?r-1:0),i=1;i<r;i++)o[i-1]=arguments[i];if(t){if(n){const[e,t,n]=o;return{data:e,options:{params:t,...n}}}const[e,t]=o;return{data:{},options:{params:e,...t}}}const[s,a]=o;return{data:s,options:a}}(i,...h),o=e?function(e){if(e instanceof FormData)return e;const t=new FormData;for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.append(n,e)})):!(0,T.isObject)(r)||r instanceof Blob||r instanceof Date?t.append(n,r):Object.entries(r).forEach((e=>{let[r,o]=e;t.append(`${n}[${r}]`,o)}));return t}(n.data):n.data;if(c){var w;const{body:e,headers:i}=d.http.getBodyAndHeaders(o,null===(w=n.options)||void 0===w?void 0:w.headers);return await(0,oe.createSSEStream)(t,{...p,...n.options,method:r,headers:Object.fromEntries([...new Headers(i??{}).entries()]),body:e})}l=await d.http.requestWithBody(r,t,o,{...p,...n.options})}return!a&&o?l.data:l}function ce(){customElements.define(ie,(0,oe.createProviderClass)(ae))}var ue=n(8679),pe=function(){var e=(0,l.A)((function*(e,t){return(yield d.http.post("api/contract/single_search",e,t)).data}));return function(t,n){return e.apply(this,arguments)}}();const le=new Map,de=new Map,fe=new Map,he=(e,t)=>{null==e||e.forEach((e=>{t.set(`${e.namespaceId}.${e.name}`,e)}))};function me(e){he(e,le)}function ge(e){he(e,de)}function ve(){de.clear()}function Ae(e){he(e,fe)}function we(){fe.clear()}const ye=new Map;function be(e){return e.includes("@")}async function Se(e,t,n,r){if(!e.includes(":"))throw new Error(`You're using legacy Custom API "${e}" which is dropped in v3, please use Flow API instead`);const o=await async function(e){const[t,n]=e.split("@"),[r,o]=n.split(":"),i=function(e){return le.get(e)||de.get(e)||fe.get(e)}(`${t}.${r}`);if(i)return{name:i.name,namespace:i.namespaceId,serviceName:i.serviceName,version:i.version,contract:{endpoint:i.endpoint,response:i.response,request:i.request}};let s=ye.get(e);return s||(s=async function(e,t,n){var r;const{contractData:o}=await pe({contractName:`${e}.${t}`,version:n});return o?{name:o.name,namespace:null===(r=o.namespace)||void 0===r||null===(r=r[0])||void 0===r?void 0:r.name,serviceName:o.serviceName,version:o.version,contract:{endpoint:o.endpoint,response:o.response,request:o.request}}:null}(t,r,o),ye.set(e,s)),s}(e);if(!o)throw new Ie(`Flow API not found: "${e}"`);const i=function(e,t){var n;const r="string"==typeof t.contract?ue.safeLoad(t.contract,{schema:ue.JSON_SCHEMA,json:!0}):t.contract,{uri:o,method:i="GET",ext_fields:s}=(null==r?void 0:r.endpoint)??{},a=!(null==r||!r.response)&&!1!==r.response.wrapper;if(!o)throw new Error(`Missing endpoint.uri in contract of provider "${e}"`);return{uri:o,method:"list"===i.toLowerCase()?"get":i,ext_fields:s,name:t.name,namespace:t.namespace,serviceName:t.serviceName,version:t.version,isFileType:"file"===(null==r||null===(n=r.response)||void 0===n?void 0:n.type),responseWrapper:a,request:null==r?void 0:r.request}}(e,o);return function(e,t,n,r){let{uri:o,method:i,ext_fields:s,name:a,namespace:c,serviceName:u,responseWrapper:p,version:l,isFileType:d,request:f}=e;const h="saveAs"===n;let m;h&&(m=t.shift());const{url:g,args:v}=function(e,t,n,r,o,i){const s=i?"logic.api.gateway"===o||null!=o&&o.startsWith("logic.api.gateway.")?"":o?`api/gateway/${o}`:`api/gateway/${r}.${n}@${i}`:`api/gateway/api_service.${r}.${n}`,a=t.slice(),c=e.replace(/:([^/]+)/g,(()=>a.shift()));return{url:s?s+c:c.replace(/^\//,""),args:a}}(o,t,a,c,u,l);return[...h?[m]:[],{url:g,originalUri:o,method:i,ext_fields:s,responseWrapper:p,request:f,isFileType:d,stream:r},...v]}(i,t,n,r)}class Ie extends Error{constructor(e){super(e),this.name="FlowApiNotFoundError",Error.captureStackTrace&&Error.captureStackTrace(this,Ie)}}var Oe=function(){var e=(0,l.A)((function*(e,t,n){return(yield d.http.post("api/gateway/cmdb.instance.PostSearch/object/".concat(e,"/instance/_search"),t,n)).data}));return function(t,n,r){return e.apply(this,arguments)}}(),Pe=n(69740),Ee=function(){var e=(0,l.A)((function*(e,t,n){return(yield d.http.get("api/gateway/micro_app.installed_micro_app.GetMenusInfo/api/v1/micro-app/menus/".concat(e),(0,Pe.A)((0,Pe.A)({},n),{},{params:t}))).data}));return function(t,n,r){return e.apply(this,arguments)}}(),ke=n(18799);const Me=Symbol("appId"),Ce=Symbol("menuI18nNamespace"),_e=Symbol("overrideApp");async function Te(e,t,n){const r=e.find((e=>"inject"!==e.type));if(!r)return;const o=[],i=new Map,s=new WeakMap;for(const t of e)if(t.i18n){const e=`menu/${t.menuId}~${t.app[0].appId}+${t.instanceId}`;Object.entries(t.i18n).forEach((t=>{let[n,r]=t;ke.i18n.addResourceBundle(n,e,r)})),s.set(t,e)}await Promise.all(e.map((e=>async function(e,t,n,r){if(e.dynamicItems&&e.itemsResolve){const i=e.app[0].appId,s={...t,pendingPermissionsPreCheck:[...t.pendingPermissionsPreCheck,S(e.itemsResolve)]};var o;i!==t.app.id&&(s.overrideApp=window.STANDALONE_MICRO_APPS?e.overrideApp:null===(o=r.getStoryboardByAppId(i))||void 0===o?void 0:o.app,s.appendI18nNamespace=n.get(e));const a=await r.resolveData({transform:"items",...e.itemsResolve},s);e.items=a.items}}(e,t,s,n))));for(const t of e){var a;if(null!==(a=t.items)&&void 0!==a&&a.length)if("inject"===t.type&&t.injectMenuGroupId){let e=i.get(t.injectMenuGroupId);e||(e=[],i.set(t.injectMenuGroupId,e)),e.push(t)}else o.push(t)}return{...r,items:o.flatMap((e=>je(e.items,e,i,s))),[Ce]:s.get(r),[_e]:r.overrideApp}}function je(e,t,n,r){return null==e?void 0:e.map((e=>{const o=e.groupId&&n.get(e.groupId);return o&&n.delete(e.groupId),{...e,children:(je(e.children,t,n,r)??[]).concat(o?o.flatMap((e=>je(e.items,e,n,r))):[]),[Me]:t.app[0].appId,[Ce]:r.get(t),[_e]:t.overrideApp}}))}function Ne(e){e.items=De(e.items)}function De(e){return function(e){return(0,T.sortBy)(e,(e=>e.sort??-1/0))}(e).map((e=>({...e,children:De(e.children)})))}var $e=n(1744),Re=n(522);function We(e,t,n,r){if("titleDataSource"in e&&(0,oe.isObject)(e.titleDataSource)&&Object.entries(e.titleDataSource).every((e=>{let[,t]=e;return null===t||""===t}))&&delete e.titleDataSource,"if"in e&&null===e.if&&delete e.if,"to"in e&&e.to&&!(0,Re.isEvaluable)(e.to)){const t=$e.pipes.yaml(e.to);(0,oe.isObject)(t)&&["pathname","search","hash"].some((e=>(0,oe.hasOwnProperty)(t,e)))&&(e.to=t)}let o=n;if(t!==n.app.id){var i;const s=window.STANDALONE_MICRO_APPS?e[_e]:null===(i=r.getStoryboardByAppId(t))||void 0===i?void 0:i.app;o={...n,overrideApp:s,appendI18nNamespace:e[Ce]}}return r.asyncComputeRealValue(e,o,{ignoreSymbols:!0})}function xe(e,t,n){return Promise.all(e.map((async e=>{let{children:r,...o}=e;const[i,s]=await Promise.all([We(o,o[Me],t,n),r&&await xe(r,t,n)]);return{...i,children:s}})))}var Le=function(){var e=(0,l.A)((function*(e,t,n,r){return(yield d.http.get("api/gateway/cmdb.instance.GetDetail/object/".concat(e,"/instance/").concat(t),(0,Pe.A)((0,Pe.A)({},r),{},{params:n}))).data}));return function(t,n,r,o){return e.apply(this,arguments)}}();const Ue=new Map;async function Be(e){if(e.title||(0,T.isEmpty)(e.titleDataSource))return e.title;const t=JSON.stringify(e.titleDataSource),n=Ue.get(t);if(void 0!==n)return n;const{objectId:r,instanceId:o,attributeId:i}=e.titleDataSource,s=i??"name",a=await Le(r,o,{fields:s});let c;if("#showKey"===i&&Array.isArray(a[s])){const[e,...t]=a[s];c=t.length>0?`${e}(${t.join(",")})`:String(e)}else c=String(a[s]);return Ue.set(t,c),c}const Fe=new Map,qe=new Map;function ze(e){return null==e?void 0:e.filter(_.checkIfOfComputed).map((e=>{const t=ze(e.children);return"group"===e.type?{type:"group",title:e.text,childLayout:e.childLayout,items:t,groupId:e.groupId,groupFrom:e.groupFrom}:null!=t&&t.length?{type:"subMenu",childLayout:e.childLayout,title:e.text,icon:e.icon,items:t,defaultExpanded:e.defaultExpanded}:(0,T.omit)(e,["type","items","children"])}))}function He(e){return qe.get(e)}function Ge(e,t,n){let r=Fe.get(e);return r||(r=async function(e,t,n){const r=window.STANDALONE_MICRO_APPS?function(e,t,n){var r,o;const i=n.getStoryboardByAppId(t);return((null===(r=i.meta)||void 0===r?void 0:r.injectMenus)??(null===(o=i.meta)||void 0===o?void 0:o.menus)??[]).filter((t=>t.menuId===e)).map((e=>{var n;return{...e,...null!==(n=e.app)&&void 0!==n&&null!==(n=n[0])&&void 0!==n&&n.appId?{}:{app:[{appId:t}]}}}))}(e,t.app.id,n):t.flags["three-level-menu-layout"]?(await Ee(e,{menuObjectId:"EASYOPS_STORYBOARD_MENU"})).menus:(await Oe("EASYOPS_STORYBOARD_MENU",{page:1,page_size:200,fields:{menuId:!0,title:!0,icon:!0,link:!0,titleDataSource:!0,defaultCollapsed:!0,defaultCollapsedBreakpoint:!0,type:!0,injectMenuGroupId:!0,dynamicItems:!0,itemsResolve:!0,items:!0,i18n:!0,"items.children":!0,"app.appId":!0},query:{menuId:{$eq:e},app:{$size:{$gt:0}}}})).list,o=await Te(r,t,n);if(!o)throw new Error(`Menu not found: ${e}`);Ne(o);const{items:i,app:s,...a}=o,c={...t,pendingPermissionsPreCheck:[...t.pendingPermissionsPreCheck,S([i,a])]};delete c.tplStateStoreId,delete c.forEachItem,delete c.forEachIndex,delete c.forEachSize;const u=s[0].appId,[p,l]=await Promise.all([We(a,u,c,n),xe(i,c,n)]),d={title:await Be(p),...(0,T.pick)(p,["icon","link","defaultCollapsed","defaultCollapsedBreakpoint"]),menuItems:ze(l)};qe.set(e,d)}(e,t,n)),r}const Je=[];let Ve=null;const Ye={maxWaitingTime:5e3,maxLoggedEvents:10};function Ke(){clearTimeout(Ve),Je.length>Ye.maxLoggedEvents?Qe():Ve=setTimeout(Qe,Ye.maxWaitingTime)}function Qe(){if(0===Je.length)return;const e={model:"easyops.FRONTEND_STAT",columns:["_ver","st","et","lt","size","time","traceId","code","duration","page","uid","username","api","type","msg","status","pageId","route","apiCount","maxApiTimeCost","apiSizeCost","pageTitle"],data:Je.splice(0,Ye.maxLoggedEvents)};var t;!function(e,t){const n=new Blob([JSON.stringify(t)],{type:"application/json"});window.navigator.sendBeacon(e,n)}(Ye.api,e),Je.length&&(t=Qe,(window.requestIdleCallback||window.requestAnimationFrame||(e=>setTimeout(e,17)))(t))}function Xe(){window.addEventListener("beforeunload",Qe,!1)}let Ze,et=!1,tt=null,nt=!0;const rt=[];function ot(e){et||(et=!0,Ze||(Ze=function(e,t){return Object.assign(Ye,{...t,api:e}),{sendOnExit:Xe,emit:Ke}}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),Ze.sendOnExit()))}const it=Symbol("HttpAnalytics");function st(e){const t=Math.round(performance.now()),n=Date.now();return e[it]={st:n,time:Math.round(n/1e3),perfStartTime:t},e}function at(e,t){return ut(!1,e,t)}function ct(e,t){return ut(!0,e,t)}function ut(e,t,n){const r=Math.round(performance.now()),o=Date.now(),{[it]:i,url:s}=n;if(i&&!(e&&t instanceof d.HttpAbortError)){delete n[it];const{st:c,time:u,perfStartTime:p}=i,{userInstanceId:l,username:f}=g();let h,m,v,A,w,y,b;if(e){const e=t instanceof d.HttpResponseError;(e||t instanceof d.HttpParseError)&&(({status:w,headers:y}=t.response),e&&(b=t.responseJson))}else({status:w,data:b,headers:y}=t);(0,oe.isObject)(b)&&({code:h,message:m}=b),y instanceof Headers&&(v=y.get("x-b3-traceid"),A=y.get("content-length")),a={st:c,_ver:c,uid:l,username:f,time:u,et:o,page:location.href,duration:r-p,api:s,type:"api",code:h??-1,msg:m??"",status:w,traceId:v??"",size:A?Number(A):-1},tt?Je.push({...a,type:"apiRequest",...tt}):rt.push(a)}var a;return e?Promise.reject(t):t}function pt(){const e=Math.round(performance.now()),t=Date.now();return rt.length=0,tt=null,function(n){let{status:r,path:o,pageTitle:i}=n;if("ok"!==r)return Je.push(...rt),void(rt.length=0);const s=Math.round(performance.now())-e,a=Date.now(),{username:c}=g();(function(e){const t=function(){const e=URL.createObjectURL(new Blob([]));let t=e.substring(e.lastIndexOf("/")+1);return URL.revokeObjectURL(e),nt&&(t="88-"+t,nt=!1),t}(),{lt:n,route:r}=e;tt={lt:n,route:r,pageId:t},Je.push({...e,pageId:t,apiCount:rt.length,maxApiTimeCost:Math.max(0,...rt.map((e=>e.duration))),size:rt.map((e=>e.size)).filter((e=>e>0)).reduce(((e,t)=>e+t),0)});for(const e of rt)Je.push({...e,...tt});rt.length=0,Ze.emit()})({type:"page",page:location.href,_ver:t,time:Math.round(t/1e3),st:t,et:a,lt:s,pageTitle:i,username:c,route:o}),window.dispatchEvent(new CustomEvent("route.render",{detail:{renderTime:s}}))}}const lt=Object.freeze({checkPermissions:function(){if(!A())return!1;if(g().isAdmin)return!0;for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const e of t)switch(b.get(e)){case"unauthorized":case"undefined":return!1;case void 0:return console.error(`Un-checked permission action: "${e}", please make sure the permission to check is defined in permissionsPreCheck.`),!1}return!0},preCheckPermissions:function(e){if(A()&&!g().isAdmin)return I((0,p.scanPermissionActionsInStoryboard)(e))},preCheckPermissionsForBrickOrRoute:async function(e,t){if(A()&&!g().isAdmin&&Array.isArray(e.permissionsPreCheck))return I(await t(e.permissionsPreCheck))}}),dt=new class{constructor(){(0,O.A)(this,V),(0,P.A)(this,H,void 0),(0,P.A)(this,G,{sub:new Map,unsub:new Map}),(0,P.A)(this,J,new Map)}subscribe(e,t){const n=JSON.stringify(t);return(0,k.A)(V,this,K).call(this,"sub",e,t,n)}unsubscribe(e){const t=(0,C.A)(J,this).get(e);if(!t){const t=`The message channel to unsubscribe "${e}" is not found`;return console.error(t),Promise.reject(new Error(t))}const n=JSON.parse(t),r=(0,k.A)(V,this,K).call(this,"unsub",e,n,t);return(0,C.A)(G,this).sub.delete(t),r.then((()=>{(0,C.A)(J,this).delete(e)})),r}onMessage(e,t){let n=(0,C.A)(J,this).get(e),r=!1;(0,E.A)(V,this,Y).onMessage((o=>{n||(n=(0,C.A)(J,this).get(e)),n?"MESSAGE.PUSH"===o.event&&function(e,t){const n=JSON.parse(e);return n.system===t.system&&(n.topic===t.topic||"string"==typeof n.topic&&n.topic.includes("*")&&new RegExp(`^${n.topic.replace(/([^*]*)\*([^*]*)/g,((e,t,n)=>`${(0,T.escapeRegExp)(t)}[^/]*${(0,T.escapeRegExp)(n)}`))}$`).test(t.topic))}(n,o.payload)&&t(o.payload.message):r||(console.error(`Message channel: "${e}" not found`),r=!0)}))}onClose(e){(0,E.A)(V,this,Y).onClose(e)}reset(){var e;(0,C.A)(G,this).sub.clear(),(0,C.A)(G,this).unsub.clear(),(0,C.A)(J,this).clear(),null===(e=(0,C.A)(H,this))||void 0===e||e.reset()}},ft=function(){const e=(0,_.getV2RuntimeFromDll)();if(e)return Object.freeze((0,T.pick)(e,["authenticate","getAuth","isLoggedIn","logout"]))}()||r}}]);
//# sourceMappingURL=2252.65e0507e.js.map