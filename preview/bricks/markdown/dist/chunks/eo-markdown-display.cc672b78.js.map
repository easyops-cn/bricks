{"version":3,"file":"chunks/eo-markdown-display.cc672b78.js","mappings":"iTAQA,MAAM,cAAEA,EAAa,SAAEC,IAAaC,EAAAA,EAAAA,oBAAmB,IAAAC,EAAA,IAAAC,EAAA,IAAAC,QAUvD,MAAAC,UAG8BC,EAAAA,iBAAiDC,WAAAA,GAAA,SAAAC,YAAAC,EAAAA,EAAAA,GAAA,KAAAN,EAAAO,EAAA,OAAAC,EAAA,iBAEpEC,GAAO,OAAAC,EAAAA,EAAAA,GAAAV,EAAA,iBAAPS,CAAOE,IAAAC,EAAAA,EAAAA,GAAAZ,EAAA,KAAAW,EAAA,CAEhBE,MAAAA,GACE,OAAOC,IAAAA,cAACC,EAAAA,EAAiB,CAACN,QAASO,KAAKP,SAC1C,EACDQ,EAAAf,IAAAgB,GAAAX,EAAAC,GAAAW,GAAApB,EAAAqB,KAAAC,EAAAA,EAAAA,GAAAJ,EAAA,CAVArB,EAAc,sBAAuB,CACpC0B,WAAY,CAACC,EAAAA,MACb,EAEC1B,IAAU,uBADiBM,EAAAA,mBAAgBiB,G,kEClB1CI,E,MAA0B,GAA4B,KAE1DA,EAAwBC,KAAK,CAACC,EAAOC,GAAI,sTACgG,KAEzI,S,qFCJIH,EAA0B,IAA4B,KAC1DA,EAAwBI,EAAE,KAE1BJ,EAAwBC,KAAK,CAACC,EAAOC,GAAI,oeAAqe,KAE9gB,QAAeH,EAAwBK,U,qFCLnCL,EAA0B,IAA4B,KAC1DA,EAAwBI,EAAE,KAE1BJ,EAAwBC,KAAK,CAACC,EAAOC,GAAI,GAAI,KAE7C,QAAeH,EAAwBK,U,gJCEnCC,EAAU,CAAC,EAEfA,EAAQC,kBAAoB,IAC5BD,EAAQE,cAAgB,IACxBF,EAAQG,OAAS,SAAc,KAAM,QACrCH,EAAQI,OAAS,IACjBJ,EAAQK,mBAAqB,IAEhB,IAAI,IAASL,GAKJ,KAAW,IAAQM,QAAS,IAAQA,M,0GChB1D,MAAMC,EAAa,CAAEC,SAAQ,WAAEC,IAAG,MAAEC,KAAIA,EAAAA,MAOjC,SAASzB,EAAiB0B,GAAsC,IAArC,QAAEhC,GAAiCgC,EACnE,MAAOC,EAAcC,IAAmBC,EAAAA,EAAAA,UAA6B,MA2BrE,OAzBAC,EAAAA,EAAAA,YAAU,KACR,IAAIC,GAAS,EAmBb,OAlBAC,EAAAA,EAAAA,KACGC,IAAIC,EAAAA,GACJD,IAAIE,EAAAA,GACJF,IAAI,CAACG,EAAAA,IACLH,IAAII,EAAAA,EAAaf,GACjBgB,QAAQ5C,GACR6C,MAAMC,IACAT,GACHH,EAAgBY,EAAMC,OACxB,IAEDC,OAAOC,IACDZ,IAEHa,QAAQD,MAAM,2BAA4BA,GAC1Cf,EAAgB,MAClB,IAEG,KACLG,GAAS,CAAI,CACd,GACA,CAACrC,IAEGiC,CACT,C,oECvCO,SAASS,IACd,SAASS,EACPC,EACAC,EACAC,GAEA,IAAKA,GAA6B,QAAnBA,EAAOC,SAAsC,SAAjBH,EAAKG,QAC9C,OAGF,MAAMC,EAuBV,SAAqBJ,GACnB,MAAMK,EAAaL,EAAKM,WAAWD,WAA0B,GAE7D,IAAK,MAAME,KAAiBF,EAC1B,GAAkC,cAA9BE,EAAcC,MAAM,EAAG,GACzB,OAAOD,EAAcC,MAAM,GAAGC,cAIlC,OAAO,IACT,CAjCiBC,CAAYV,GAEzB,GAAa,OAATI,EACF,OAGF,IAAIT,EACJ,IACEO,EAAOI,WAAWD,WACfH,EAAOI,WAAWD,WAA0B,IAC7CM,OAAO,YAAcP,GACvBT,EAASiB,EAAAA,EAAUC,WAAU7C,EAAAA,EAAAA,GAASgC,GAAOI,EAC/C,CAAE,MACA,MACF,CAEAJ,EAAKc,SAAWnB,EAAOmB,QACzB,CACA,OAAQC,KACNC,EAAAA,EAAAA,IAAMD,EAAM,UAAWhB,EAAQ,CAEnC,C","sources":["webpack:///./src/markdown-display/index.tsx","webpack:///./src/markdown-display/host-context.css","webpack:///./src/markdown-display/styles.shadow.css","webpack:///../../shared/markdown/dist/esm/prism-tomorrow.css","webpack:///./src/markdown-display/host-context.css?6555","webpack:///../../src/MarkdownComponent.tsx","webpack:///../../src/rehypePrism.ts"],"sourcesContent":["import React from \"react\";\nimport { createDecorators } from \"@next-core/element\";\nimport { ReactNextElement } from \"@next-core/react-element\";\nimport \"@next-core/theme\";\nimport { MarkdownComponent } from \"@next-shared/markdown\";\nimport styleText from \"./styles.shadow.css\";\nimport \"./host-context.css\";\n\nconst { defineElement, property } = createDecorators();\n\nexport interface MarkdownDisplayProps {\n  content?: string;\n}\n\n/**\n * 用于展示 markdown 内容的构件。\n */\nexport\n@defineElement(\"eo-markdown-display\", {\n  styleTexts: [styleText],\n})\nclass MarkdownDisplay extends ReactNextElement implements MarkdownDisplayProps {\n  @property()\n  accessor content: string | undefined;\n\n  render() {\n    return <MarkdownComponent content={this.content} />;\n  }\n}\n","// Imports\nimport ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___ from \"../../../../node_modules/css-loader/dist/runtime/noSourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `:root{--eo-markdown-display-code-color:#b30056;--eo-markdown-display-code-background:#ffe6ec;--eo-markdown-display-blockquote-border-color:#bcc0c5}html[data-theme=\"dark\"],\nhtml[data-theme=\"dark-v2\"]{--eo-markdown-display-code-color:#f3679a;--eo-markdown-display-code-background:var(--color-fill-bg-base-1)}`, \"\"]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___ from \"../../../../node_modules/css-loader/dist/runtime/noSourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../node_modules/css-loader/dist/runtime/api.js\";\nimport ___CSS_LOADER_AT_RULE_IMPORT_0___ from \"-!../../../../node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[1].use[0]!../../../../node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[1].use[1]!../../../../shared/markdown/dist/esm/prism-tomorrow.css\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);\n___CSS_LOADER_EXPORT___.i(___CSS_LOADER_AT_RULE_IMPORT_0___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `:host{display:block}:host([hidden]){display:none}pre{white-space:pre-wrap;background-color:var(--palette-gray-3);border-radius:6px;padding:1em}:not(pre) > code{color:var(--eo-markdown-display-code-color);background:var(--eo-markdown-display-code-background);margin:0 2px;padding:1px 6px;white-space:nowrap;border-radius:3px}blockquote{border-left:6px solid var(--eo-markdown-display-blockquote-border-color);padding:0 1em}:not(blockquote) > blockquote{margin-left:0;margin-right:0}`, \"\"]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___.toString();\n","// Imports\nimport ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___ from \"../../../../node_modules/css-loader/dist/runtime/noSourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../node_modules/css-loader/dist/runtime/api.js\";\nimport ___CSS_LOADER_AT_RULE_IMPORT_0___ from \"-!../../../../node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[1].use[0]!../../../../node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[1].use[1]!../../../../node_modules/prismjs/themes/prism-tomorrow.css\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);\n___CSS_LOADER_EXPORT___.i(___CSS_LOADER_AT_RULE_IMPORT_0___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, ``, \"\"]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___.toString();\n","\n      import API from \"!../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../../node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[0].use[1]!../../../../node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[0].use[2]!./host-context.css\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\noptions.insert = insertFn.bind(null, \"head\");\noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../../../node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[0].use[1]!../../../../node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[0].use[2]!./host-context.css\";\n       export default content && content.locals ? content.locals : undefined;\n","import { useEffect, useState } from \"react\";\nimport { Fragment, jsx, jsxs } from \"react/jsx-runtime\";\nimport { unified } from \"unified\";\nimport remarkParse from \"remark-parse\";\nimport remarkToRehype from \"remark-rehype\";\nimport rehypeReact, { Options as RehypeReactOptions } from \"rehype-react\";\nimport { rehypePrism } from \"./rehypePrism.js\";\n\nconst production = { Fragment, jsx, jsxs };\n\nexport interface MarkdownComponentProps {\n  content?: string;\n}\n\n// Reference https://github.com/remarkjs/react-remark/blob/39553e5f5c9e9b903bebf261788ff45130668de0/src/index.ts\nexport function MarkdownComponent({ content }: MarkdownComponentProps) {\n  const [reactContent, setReactContent] = useState<JSX.Element | null>(null);\n\n  useEffect(() => {\n    let ignore = false;\n    unified()\n      .use(remarkParse)\n      .use(remarkToRehype)\n      .use([rehypePrism])\n      .use(rehypeReact, production as RehypeReactOptions)\n      .process(content)\n      .then((vFile) => {\n        if (!ignore) {\n          setReactContent(vFile.result);\n        }\n      })\n      .catch((error) => {\n        if (!ignore) {\n          // eslint-disable-next-line no-console\n          console.error(\"Convert markdown failed:\", error);\n          setReactContent(null);\n        }\n      });\n    return () => {\n      ignore = true;\n    };\n  }, [content]);\n\n  return reactContent;\n}\n","import { visit } from \"unist-util-visit\";\nimport { toString } from \"hast-util-to-string\";\nimport { refractor, type RefractorElement } from \"refractor\";\n\n// Reference https://github.com/mapbox/rehype-prism\nexport function rehypePrism() {\n  function visitor(\n    node: RefractorElement,\n    _index: number | undefined,\n    parent: RefractorElement | undefined\n  ) {\n    if (!parent || parent.tagName !== \"pre\" || node.tagName !== \"code\") {\n      return;\n    }\n\n    const lang = getLanguage(node);\n\n    if (lang === null) {\n      return;\n    }\n\n    let result;\n    try {\n      parent.properties.className = (\n        (parent.properties.className as string[]) || []\n      ).concat(\"language-\" + lang);\n      result = refractor.highlight(toString(node), lang);\n    } catch {\n      return;\n    }\n\n    node.children = result.children;\n  }\n  return (tree: RefractorElement) => {\n    visit(tree, \"element\", visitor);\n  };\n}\n\nfunction getLanguage(node: RefractorElement) {\n  const className = (node.properties.className as string[]) || [];\n\n  for (const classListItem of className) {\n    if (classListItem.slice(0, 9) === \"language-\") {\n      return classListItem.slice(9).toLowerCase();\n    }\n  }\n\n  return null;\n}\n"],"names":["defineElement","property","createDecorators","_MarkdownDisplay","_A","WeakMap","MarkdownDisplay","ReactNextElement","constructor","arguments","_classPrivateFieldInitSpec","_init_content","_init_extra_content","content","_classPrivateFieldGet","v","_classPrivateFieldSet","render","React","MarkdownComponent","this","_MarkdownDisplay2","e","c","_initClass","_applyDecs","styleTexts","styleText","___CSS_LOADER_EXPORT___","push","module","id","i","toString","options","styleTagTransform","setAttributes","insert","domAPI","insertStyleElement","locals","production","Fragment","jsx","jsxs","_ref","reactContent","setReactContent","useState","useEffect","ignore","unified","use","remarkParse","remarkToRehype","rehypePrism","rehypeReact","process","then","vFile","result","catch","error","console","visitor","node","_index","parent","tagName","lang","className","properties","classListItem","slice","toLowerCase","getLanguage","concat","refractor","highlight","children","tree","visit"],"sourceRoot":""}