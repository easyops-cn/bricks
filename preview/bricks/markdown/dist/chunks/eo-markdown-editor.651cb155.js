"use strict";(globalThis.webpackChunk_next_bricks_markdown=globalThis.webpackChunk_next_bricks_markdown||[]).push([[967],{7196:(e,t,n)=>{n.r(t),n.d(t,{MarkdownEditor:()=>he,MarkdownEditorComponent:()=>Ce});var a,i=n(4586),o=n(4635),l=n(918),r=n(6902),s=n(5536),c=n(6121),u=n(829),d=n(2740),h=n(9575),m=n(8769),k=n.n(m),p=n(169),b=n(5617),y=(n(6477),n(998)),A=n(1408),g=n(8117),w=n(2466),v=n(9169),E=n(9760),f=n(135),C=n(6486),M=n(6512),N=n(8653),S=n(1656),W=n(5435),j=n(9796),I=n(3971),_=n(9830),x=n(1151),T=n(4557),q=n(426),D=n(3373),U=n.n(D);let V,$,B,F,O,G,J,K,P,X,L,Q,R,Y,Z,z,H,ee,te,ne,ae,ie,oe;const le=(0,b.wrapBrick)("eo-form-item"),re=(0,b.wrapBrick)("eo-icon"),se=e=>{let{icon:t,onClick:n,tooltip:a}=e;return k().createElement("div",{className:"menu-btn-box",onMouseDown:e=>{null==n||n(),e.preventDefault()}},k().createElement(re,(0,h.A)({style:{verticalAlign:"middle"}},t)),a&&k().createElement("div",{className:"menuIconTooltip"},a))},{defineElement:ce,property:ue,event:de}=(0,p.createDecorators)();let he;var me=new WeakMap,ke=new WeakMap,pe=new WeakMap,be=new WeakMap,ye=new WeakMap,Ae=new WeakMap,ge=new WeakMap,we=new WeakMap,ve=new WeakSet,Ee=new WeakMap;class fe extends q.N{constructor(){super(...arguments),(0,o.A)(this,ve),(0,l.A)(this,me,$(this)),(0,l.A)(this,ke,(B(this),F(this))),(0,l.A)(this,pe,(O(this),G(this))),(0,l.A)(this,be,(J(this),K(this))),(0,l.A)(this,ye,(P(this),X(this))),(0,l.A)(this,Ae,(L(this),Q(this))),(0,l.A)(this,ge,(R(this),Y(this))),(0,l.A)(this,we,(Z(this),z(this))),(0,i.A)(this,"handleUploadImage",(te(this),e=>{(0,s.A)(ve,this,H).emit(e)})),(0,l.A)(this,Ee,ne(this)),(0,i.A)(this,"handleMarkdownValueChange",(oe(this),e=>{var t;null===(t=this.getFormElement())||void 0===t||t.formStore.onChange(this.name,e),this.value=e,(0,s.A)(ve,this,ae).emit(e)}))}get name(){return(0,u.A)(me,this)}set name(e){(0,c.A)(me,this,e)}get label(){return(0,u.A)(ke,this)}set label(e){(0,c.A)(ke,this,e)}get required(){return(0,u.A)(pe,this)}set required(e){(0,c.A)(pe,this,e)}get value(){return(0,u.A)(be,this)}set value(e){(0,c.A)(be,this,e)}get bucketName(){return(0,u.A)(ye,this)}set bucketName(e){(0,c.A)(ye,this,e)}get readonly(){return(0,u.A)(Ae,this)}set readonly(e){(0,c.A)(Ae,this,e)}get containerStyle(){return(0,u.A)(ge,this)}set containerStyle(e){(0,c.A)(ge,this,e)}render(){return k().createElement(w.pb,null,k().createElement(I.vo,null,k().createElement(Ce,{formElement:this.getFormElement(),name:this.name,label:this.label,required:this.required,curElement:this,bucketName:this.bucketName,value:this.value,readonly:this.readonly,containerStyle:this.containerStyle,onUploadImage:this.handleUploadImage,onMarkdownValueChange:this.handleMarkdownValueChange})))}}function Ce(e){const{bucketName:t,containerStyle:n,value:a,formElement:i,readonly:o,onUploadImage:l,onMarkdownValueChange:r}=e,[s,c]=(0,m.useState)(!1),u=async(n,a)=>{const i=[];let o=[];for(let e=0;e<n.length;e++){const t=n.item(e);t&&t.type.includes("image")&&i.push(t)}try{o=await Promise.all(i.map((async n=>{const i=await(0,A.i)(t,{file:n,width:0,height:0}),o=(r=null==i?void 0:i.objectName,`/next/api/gateway/object_store.object_store.GetObject/api/v1/objectStore/bucket/${e.bucketName}/object/${r}`);var r;const s=n.name;return l&&l({name:s,src:o}),a.nodes.image.createAndFill({src:o,alt:s})})))}catch(e){console.error("upload failed:",e)}return o},d=(0,I.Uv)(),p=(0,I.rJ)(),b=(0,I.$X)(),y=(0,m.useMemo)((()=>o?[]:[S.Te,x.EI,x.nk,e=>async()=>{e.set(x.EI.key,{view:d({component:x.ST})})},(0,x.jp)(p)].flat()),[o,d,p]),{get:q}=(0,w.hG)((e=>g.KE.make().config((n=>{n.set(g.k,e),n.update(g.QM,(e=>({...e,editable:()=>!o}))),a&&n.set(g.CI,a),n.get(N.Ob).markdownUpdated(((e,t,n)=>{r&&r(t)})).focus((()=>{c(!0)})).blur((()=>{c(!1)})),t&&n.update(C.wu.key,(e=>({...e,uploader:u}))),n.update(j.mS.key,(e=>({...e,configureRefractor:()=>_.L})))})).config(E.E).use(N.F_).use(v.PD).use(f.b6).use(S.Te).use(W.pZ).use(C.Se).use(y).use(j.Wj).use(o?[]:(0,M.m5)(v.Ay.node,(()=>b({component:T.N}))))),[]);function D(e,t){var n;return null===(n=q())||void 0===n?void 0:n.action((0,M.KD)(e,t))}(0,m.useEffect)((()=>{var e;i&&void 0!==a&&!s&&(null===(e=q())||void 0===e||e.action((0,M.yh)(a)))}),[q(),a]);const V=[{icon:{lib:"antd",icon:"undo"},onClick:()=>D(f.Eb.key),tooltip:"撤销"},{icon:{lib:"antd",icon:"redo"},onClick:()=>D(f.eD.key),tooltip:"重做"},{icon:{lib:"antd",icon:"bold"},onClick:()=>D(v.vY.key),tooltip:"粗体"},{icon:{lib:"antd",icon:"italic"},onClick:()=>D(v.e0.key),tooltip:"斜体"},{icon:{lib:"antd",icon:"strikethrough"},onClick:()=>D(S.$l.key),tooltip:"删除线"},{icon:{lib:"antd",icon:"table"},onClick:()=>D(S.f$.key),tooltip:"表格"},{icon:{lib:"antd",icon:"unordered-list"},onClick:()=>D(v.Xk.key),tooltip:"无序列表"},{icon:{lib:"antd",icon:"ordered-list"},onClick:()=>D(v.Ej.key),tooltip:"有序列表"},{icon:{lib:"fa",icon:"quote-right"},onClick:()=>D(v.oO.key),tooltip:"块引用"}];return k().createElement(le,(0,h.A)({exportparts:"message"},e),k().createElement("div",{className:U()("markdown-container",{readonly:o}),style:n},!o&&k().createElement("div",{className:"menu-container-outter"},k().createElement("div",{className:"menu-container-inner prose"},V.map((e=>k().createElement(se,(0,h.A)({},e,{key:JSON.stringify(e.icon)})))))),k().createElement("div",{className:"editor-container"},k().createElement(w.y5,null))))}a=fe,({e:[$,B,F,O,G,J,K,P,X,L,Q,R,Y,Z,z,H,ee,te,ne,ae,ie,oe],c:[he,V]}=(0,d.A)(a,[ce("eo-markdown-editor",{styleTexts:[y.A],alias:["markdown.markdown-editor"]})],[[ue(),1,"name"],[ue(),1,"label"],[ue({type:Boolean}),1,"required"],[ue(),1,"value"],[ue(),1,"bucketName"],[ue({type:Boolean}),1,"readonly"],[ue({attribute:!1}),1,"containerStyle"],[de({type:"image.upload"}),1,"uploadImage",e=>(0,u.A)(we,e),(e,t)=>(0,c.A)(we,e,t)],[de({type:"markdown.value.change"}),1,"markdownValueChange",e=>(0,u.A)(Ee,e),(e,t)=>(0,c.A)(Ee,e,t)]],0,(e=>ve.has((0,r.A)(e))),q.N)),V()}}]);
//# sourceMappingURL=eo-markdown-editor.651cb155.js.map