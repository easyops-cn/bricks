"use strict";(globalThis.webpackChunk_next_bricks_markdown=globalThis.webpackChunk_next_bricks_markdown||[]).push([[698],{698:(e,t,n)=>{var o,a=n(4586),r=n(4635),i=n(918),l=n(6902),s=n(5536),c=n(6121),d=n(829),u=n(2740),m=n(9575),h=n(8769),p=n.n(h),k=n(169),b=n(5617),g=(n(6477),n(998)),y=n(1408),A=n(8117),w=n(2466),v=n(9169),f=n(9760),E=n(135),N=n(6486),x=n(6512),C=n(8653),S=n(1656),M=n(5435),j=n(9796),W=n(3971),q=n(9830),I=n(1151),T=n(4557),_=n(426),D=n(3373),F=n.n(D);let U,V,$,B,O,R,L,P,G,J,K,X,Y,Q,Z,z,H,ee,te,ne,oe,ae,re;const ie=(0,b.wrapBrick)("eo-form-item"),le=(0,b.wrapBrick)("eo-icon"),se=e=>{let{icon:t,onClick:n,tooltip:o}=e;return p().createElement("div",{className:"menu-btn-box",onMouseDown:e=>{null==n||n(),e.preventDefault()}},p().createElement(le,(0,m.A)({style:{verticalAlign:"middle"}},t)),o&&p().createElement("div",{className:"menuIconTooltip"},o))},{defineElement:ce,property:de,event:ue}=(0,k.createDecorators)();let me;var he=new WeakMap,pe=new WeakMap,ke=new WeakMap,be=new WeakMap,ge=new WeakMap,ye=new WeakMap,Ae=new WeakMap,we=new WeakMap,ve=new WeakSet,fe=new WeakMap;class Ee extends _.N{constructor(){super(...arguments),(0,r.A)(this,ve),(0,i.A)(this,he,V(this)),(0,i.A)(this,pe,($(this),B(this))),(0,i.A)(this,ke,(O(this),R(this))),(0,i.A)(this,be,(L(this),P(this))),(0,i.A)(this,ge,(G(this),J(this))),(0,i.A)(this,ye,(K(this),X(this))),(0,i.A)(this,Ae,(Y(this),Q(this))),(0,i.A)(this,we,(Z(this),z(this))),(0,a.A)(this,"handleUploadImage",(te(this),e=>{(0,s.A)(ve,this,H).emit(e)})),(0,i.A)(this,fe,ne(this)),(0,a.A)(this,"handleMarkdownValueChange",(re(this),e=>{var t;null===(t=this.getFormElement())||void 0===t||t.formStore.onChange(this.name,e),this.value=e,(0,s.A)(ve,this,oe).emit(e)}))}get name(){return(0,d.A)(he,this)}set name(e){(0,c.A)(he,this,e)}get label(){return(0,d.A)(pe,this)}set label(e){(0,c.A)(pe,this,e)}get required(){return(0,d.A)(ke,this)}set required(e){(0,c.A)(ke,this,e)}get value(){return(0,d.A)(be,this)}set value(e){(0,c.A)(be,this,e)}get bucketName(){return(0,d.A)(ge,this)}set bucketName(e){(0,c.A)(ge,this,e)}get readonly(){return(0,d.A)(ye,this)}set readonly(e){(0,c.A)(ye,this,e)}get containerStyle(){return(0,d.A)(Ae,this)}set containerStyle(e){(0,c.A)(Ae,this,e)}render(){return p().createElement(w.pb,null,p().createElement(W.vo,null,p().createElement(Ne,{formElement:this.getFormElement(),name:this.name,label:this.label,required:this.required,curElement:this,bucketName:this.bucketName,value:this.value,readonly:this.readonly,containerStyle:this.containerStyle,onUploadImage:this.handleUploadImage,onMarkdownValueChange:this.handleMarkdownValueChange})))}}function Ne(e){const{bucketName:t,containerStyle:n,value:o,formElement:a,readonly:r,onUploadImage:i,onMarkdownValueChange:l}=e,[s,c]=(0,h.useState)(!1),d=async(n,o)=>{const a=[];let r=[];for(let e=0;e<n.length;e++){const t=n.item(e);t&&t.type.includes("image")&&a.push(t)}try{r=await Promise.all(a.map((async n=>{const a=await(0,y.i)(t,{file:n,width:0,height:0}),r=(l=null==a?void 0:a.objectName,`/next/api/gateway/object_store.object_store.GetObject/api/v1/objectStore/bucket/${e.bucketName}/object/${l}`);var l;const s=n.name;return i&&i({name:s,src:r}),o.nodes.image.createAndFill({src:r,alt:s})})))}catch(e){console.error("upload failed:",e)}return r},u=(0,W.Uv)(),k=(0,W.rJ)(),b=(0,W.$X)(),g=(0,h.useMemo)((()=>r?[]:[S.Te,I.EI,I.nk,e=>async()=>{e.set(I.EI.key,{view:u({component:I.ST})})},(0,I.jp)(k)].flat()),[r,u,k]),{get:_}=(0,w.hG)((e=>A.KE.make().config((n=>{n.set(A.k,e),n.update(A.QM,(e=>({...e,editable:()=>!r}))),o&&n.set(A.CI,o),n.get(C.Ob).markdownUpdated(((e,t,n)=>{l&&l(t)})).focus((()=>{c(!0)})).blur((()=>{c(!1)})),t&&n.update(N.wu.key,(e=>({...e,uploader:d}))),n.update(j.mS.key,(e=>({...e,configureRefractor:()=>q.L})))})).config(f.E).use(C.F_).use(v.PD).use(E.b6).use(S.Te).use(M.pZ).use(N.Se).use(g).use(j.Wj).use(r?[]:(0,x.m5)(v.Ay.node,(()=>b({component:T.N}))))),[]);function D(e,t){var n;return null===(n=_())||void 0===n?void 0:n.action((0,x.KD)(e,t))}(0,h.useEffect)((()=>{var e;a&&void 0!==o&&!s&&(null===(e=_())||void 0===e||e.action((0,x.yh)(o)))}),[_(),o]);const U=[{icon:{lib:"antd",icon:"undo"},onClick:()=>D(E.Eb.key),tooltip:"撤销"},{icon:{lib:"antd",icon:"redo"},onClick:()=>D(E.eD.key),tooltip:"重做"},{icon:{lib:"antd",icon:"bold"},onClick:()=>D(v.vY.key),tooltip:"粗体"},{icon:{lib:"antd",icon:"italic"},onClick:()=>D(v.e0.key),tooltip:"斜体"},{icon:{lib:"antd",icon:"strikethrough"},onClick:()=>D(S.$l.key),tooltip:"删除线"},{icon:{lib:"antd",icon:"table"},onClick:()=>D(S.f$.key),tooltip:"表格"},{icon:{lib:"antd",icon:"unordered-list"},onClick:()=>D(v.Xk.key),tooltip:"无序列表"},{icon:{lib:"antd",icon:"ordered-list"},onClick:()=>D(v.Ej.key),tooltip:"有序列表"},{icon:{lib:"fa",icon:"quote-right"},onClick:()=>D(v.oO.key),tooltip:"块引用"}];return p().createElement(ie,(0,m.A)({exportparts:"message"},e),p().createElement("div",{className:F()("markdown-container",{readonly:r}),style:n},!r&&p().createElement("div",{className:"menu-container-outter"},p().createElement("div",{className:"menu-container-inner prose"},U.map((e=>p().createElement(se,(0,m.A)({},e,{key:JSON.stringify(e.icon)})))))),p().createElement("div",{className:"editor-container"},p().createElement(w.y5,null))))}o=Ee,({e:[V,$,B,O,R,L,P,G,J,K,X,Y,Q,Z,z,H,ee,te,ne,oe,ae,re],c:[me,U]}=(0,u.A)(o,[ce("eo-markdown-editor",{styleTexts:[g.A],alias:["markdown.markdown-editor"]})],[[de(),1,"name"],[de(),1,"label"],[de({type:Boolean}),1,"required"],[de(),1,"value"],[de(),1,"bucketName"],[de({type:Boolean}),1,"readonly"],[de({attribute:!1}),1,"containerStyle"],[ue({type:"image.upload"}),1,"uploadImage",e=>(0,d.A)(we,e),(e,t)=>(0,c.A)(we,e,t)],[ue({type:"markdown.value.change"}),1,"markdownValueChange",e=>(0,d.A)(fe,e),(e,t)=>(0,c.A)(fe,e,t)]],0,(e=>ve.has((0,l.A)(e))),_.N)),U();var xe=n(1085),Ce=n(45),Se=n(7447),Me=n(3640),je=n(4360),We=n(3544),qe=n(4650);function Ie(){function e(e,t,n){if(!n||"pre"!==n.tagName||"code"!==e.tagName)return;const o=function(e){const t=e.properties.className||[];for(const e of t)if("language-"===e.slice(0,9))return e.slice(9).toLowerCase();return null}(e);if(null===o)return;let a;try{n.properties.className=(n.properties.className||[]).concat("language-"+o),a=q.L.highlight((0,qe.d)(e),o)}catch{return}e.children=a.children}return t=>{(0,We.YR)(t,"element",e)}}const Te={Fragment:xe.Fragment,jsx:xe.jsx,jsxs:xe.jsxs};function _e(e){let{content:t}=e;const[n,o]=(0,h.useState)(null);return(0,h.useEffect)((()=>{let e=!1;return(0,Ce.l)().use(Se.A).use(Me.A).use([Ie]).use(je.A,Te).process(t).then((t=>{e||o(t.result)})).catch((t=>{e||(console.error("Convert markdown failed:",t),o(null))})),()=>{e=!0}}),[t]),n}var De,Fe=n(4724),Ue=n(2591),Ve=n.n(Ue),$e=n(1740),Be=n.n($e),Oe=n(8128),Re=n.n(Oe),Le=n(855),Pe=n.n(Le),Ge=n(3051),Je=n.n(Ge),Ke=n(3656),Xe=n.n(Ke),Ye=n(7148),Qe={};let Ze,ze,He;Qe.styleTagTransform=Xe(),Qe.setAttributes=Pe(),Qe.insert=Re().bind(null,"head"),Qe.domAPI=Be(),Qe.insertStyleElement=Je(),Ve()(Ye.A,Qe),Ye.A&&Ye.A.locals&&Ye.A.locals;const{defineElement:et,property:tt}=(0,k.createDecorators)();let nt;var ot=new WeakMap;class at extends b.ReactNextElement{constructor(){super(...arguments),(0,i.A)(this,ot,ze(this)),He(this)}get content(){return(0,d.A)(ot,this)}set content(e){(0,c.A)(ot,this,e)}render(){return p().createElement(_e,{content:this.content})}}De=at,({e:[ze,He],c:[nt,Ze]}=(0,u.A)(De,[et("eo-markdown-display",{styleTexts:[Fe.A]})],[[tt(),1,"content"]],0,void 0,b.ReactNextElement)),Ze()},7148:(e,t,n)=>{n.d(t,{A:()=>l});var o=n(6758),a=n.n(o),r=n(935),i=n.n(r)()(a());i.push([e.id,':root{--eo-markdown-display-code-color:#b30056;--eo-markdown-display-code-background:#ffe6ec;--eo-markdown-display-blockquote-border-color:#bcc0c5}html[data-theme="dark"],\nhtml[data-theme="dark-v2"]{--eo-markdown-display-code-color:#f3679a;--eo-markdown-display-code-background:var(--color-fill-bg-base-1)}',""]);const l=i},4724:(e,t,n)=>{n.d(t,{A:()=>c});var o=n(6758),a=n.n(o),r=n(935),i=n.n(r),l=n(6131),s=i()(a());s.i(l.A),s.push([e.id,":host{display:block}:host([hidden]){display:none}pre{white-space:pre-wrap;background-color:var(--palette-gray-3);border-radius:6px;padding:1em}:not(pre) > code{color:var(--eo-markdown-display-code-color);background:var(--eo-markdown-display-code-background);margin:0 2px;padding:1px 6px;white-space:nowrap;border-radius:3px}blockquote{border-left:6px solid var(--eo-markdown-display-blockquote-border-color);padding:0 1em}:not(blockquote) > blockquote{margin-left:0;margin-right:0}",""]);const c=s.toString()},6131:(e,t,n)=>{n.d(t,{A:()=>c});var o=n(6758),a=n.n(o),r=n(935),i=n.n(r),l=n(7745),s=i()(a());s.i(l.A),s.push([e.id,"",""]);const c=s.toString()}}]);
//# sourceMappingURL=698.de5d6392.js.map