"use strict";(self.webpackChunk_next_bricks_vb_experiment=self.webpackChunk_next_bricks_vb_experiment||[]).push([[190],{9190:(e,n,t)=>{t.r(n);var r=t(4795),o=t(6107),a=t(1297),i=t.n(a),s=t(6782),l=t(554),c=t(8828),p=t(311),d=t(7243),f=t(1639),u=t(8003),m=t(299),y=t(5125),v=t(9602),h=t(7287),x=t(2524),g=t(3626),j=t(8223),_=t(4450),b=t(3239),w=t(7040),A=t(3870),k=t(8649),S=t(5670),E=t(5202);function I(){return(I=(0,r.Z)((function*(e){var n,t,r,o,a,l,{projectDetail:c,storyboard:p}=e,I=new(i()),O=I.folder("project"),P=O.folder("src"),J={extracts:[],namePool:new Map},M=(0,f.I$)(p.routes,[],J),R={id:c.appId,name:c.name,homepage:c.appSetting.homepage,layoutType:c.appSetting.layoutType,theme:c.appSetting.theme,noAuthGuard:c.appSetting.noAuthGuard,locales:c.appSetting.locales,defaultConfig:JSON.parse(c.appSetting.defaultConfig||"{}"),menuIcon:JSON.parse(c.appSetting.icon||"null"),standaloneMode:!0};P.file("app.js",yield N("export default ".concat(JSON.stringify(R,null,2),";")));var Z=null!==(n=p.meta)&&void 0!==n?n:{},F=null!==(t=Z.customTemplates)&&void 0!==t?t:[],D=null!==(r=Z.functions)&&void 0!==r?r:[],G=null!==(o=Z.menus)&&void 0!==o?o:[],U=null!==(a=Z.contracts)&&void 0!==a?a:[],z=null!==(l=Z.i18n)&&void 0!==l?l:{};delete Z.customTemplates,delete Z.functions,delete Z.menus,delete Z.contracts,delete Z.i18n,delete Z.workflows,delete Z.mocks,delete Z.userGroups;var W=(0,f.LK)(F,["components"],J);J.extracts.push({name:"index",path:["components"],node:W,nodeType:"others"});var B=(0,u.B)(J.extracts);P.file("index.js",v),P.file("routes.jsx",yield N((0,m.R)(M,"routes",["routes.jsx"])));var H=P.folder("resources"),K=H.folder("functions"),L=[],$=[];for(var q of D){if("index"===q.name)throw new Error('Unexpected function name: "index"');var Q=new Set,{code:V}=(0,d.transform)(q.source,{filename:"expr.".concat(q.typescript?"ts":"js"),plugins:[...q.typescript?["syntax-typescript"]:[],S.Z,[E.Z,{imports:Q}]]}),X=Q.has("FN");X&&Q.delete("FN");var Y=[];Q.size>0&&Y.push("import { ".concat([...Q].join(", "),' } from "next-jsx/runtime";')),X&&Y.push('import FN from "./index.js";'),Y.length>0&&(V="".concat(Y.join("\n"),"\n\n").concat(V)),K.file("".concat(q.name,".").concat(q.typescript?"ts":"js"),V),$.push("import ".concat(q.name,' from "./').concat(q.name,'.js";')),L.push(q.name)}K.file("index.js",yield N("".concat($.join("\n"),"\n\nconst FN = { ").concat(L.join(",")," };\n\nexport default FN;")));var ee=H.folder("menus"),ne=[],te=[];for(var re of G){if(C(re),"index"===re.menuId)throw new Error('Unexpected menu id: "index"');var oe="".concat(re.menuId,".js");ee.file(oe,yield N((0,m.R)(re,"menu",["resources","menus",oe])));var ae=re.menuId.replace(/^\d+|[^\w]+/g,"_");k.h8.has(ae)&&(ae="".concat(ae,"__2")),te.push("import ".concat(ae,' from "./').concat(oe,'";')),ne.push(ae)}ee.file("index.js",yield N("".concat(te.join("\n"),"\n\nexport default [").concat(ne.join(","),"]")));var ie=H.folder("contracts"),se=[],le=[];for(var ce of U){if("index"===ce.name)throw new Error('Unexpected contract name: "index"');ie.file("".concat(ce.name,".js"),yield N("export default ".concat(JSON.stringify(ce),";")));var pe=ce.name.replace(/^\d+|[^\w]+/g,"_");le.push("import ".concat(pe,' from "./').concat(ce.name,'.js";')),se.push(pe)}ie.file("index.js",yield N("".concat(le.join("\n"),"\n\nexport default [").concat(se.join(","),"]"))),H.folder("i18n").file("index.js",yield N("export default ".concat(JSON.stringify(z),";"))),H.file("meta.js",yield N("export default ".concat(JSON.stringify(Z,null,2),";"))),H.file("index.js",y),yield T(B,P,[]),O.folder("mock-micro-apps").folder(c.appId).file(".gitignore","*\n!.gitignore"),O.file(".editorconfig",h),O.file(".gitignore",x),O.file("dev.config.mjs",j),O.file("declarations.d.ts",g),O.file("jsconfig.json",_),O.file("next-jsx.config.js",b.replaceAll("__APP_ID__",c.appId)),O.file("package.json",w.replaceAll("__APP_ID__",c.appId)),O.file("README.md",A.replaceAll("__PROJECT_NAME__",c.name).replaceAll("__PROJECT_HOMEPAGE__",c.appSetting.homepage));var de=yield I.generateAsync({type:"blob"});(0,s.saveAs)(de,"project.zip")}))).apply(this,arguments)}function N(e){return O.apply(this,arguments)}function O(){return O=(0,r.Z)((function*(e){var{typescript:n,semi:t=!0,printWidth:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return yield(0,l.WU)(e,{parser:n?"babel-ts":"babel",plugins:[c,p],semi:t,printWidth:r,trailingComma:"es5"})})),O.apply(this,arguments)}function T(e,n,t){return P.apply(this,arguments)}function P(){return(P=(0,r.Z)((function*(e,n,t){for(var r of e){var o=[...t,r.name];if("folder"===r.type){var a=n.folder(r.name);yield T(r.items,a,o)}else n.file("".concat(r.name,".js").concat("routes"===r.nodeType||"bricks"===r.nodeType||"template"===r.nodeType?"x":""),yield N((0,m.R)(r.node,r.nodeType,o)))}}))).apply(this,arguments)}function C(e){for(var[n,t]of Object.entries(e))switch(n){case"items":if(Array.isArray(t))for(var r of t)J(r);break;case"type":"main"===t&&delete e[n];break;case"if":break;case"i18n":0===Object.keys(t).length&&delete e[n];break;default:null!==t&&!1!==t||delete e[n]}}function J(e){for(var[n,t]of Object.entries(e))switch(n){case"children":Array.isArray(t)&&t.length>0&&J(t);break;case"if":break;case"activeExcludes":case"activeIncludes":Array.isArray(t)&&0===t.length&&delete e[n];break;default:null!==t&&!1!==t||delete e[n]}}function M(){return(M=(0,r.Z)((function*(e){var{name:n,files:t}=e,r=new Map,o=new(i()),a=o.folder("widgets").folder(n);for(var{path:l,content:c}of t){var p=l.split("/"),d=p.pop(),f=a,u=1;for(var m of p){var y=p.slice(0,u).join("/"),v=r.get(y);v?f=v:(f=f.folder(m),r.set(y,f)),u++}f.file(d,c)}var h=yield o.generateAsync({type:"blob"});(0,s.saveAs)(h,"".concat(n,".zip"))}))).apply(this,arguments)}customElements.define("vb-experiment.export-as-source-files",(0,o.createProviderClass)((function(e){return I.apply(this,arguments)}))),customElements.define("vb-experiment.export-widgets",(0,o.createProviderClass)((function(e){return M.apply(this,arguments)})))}}]);
//# sourceMappingURL=190.ddb7f848.js.map