{"version":3,"file":"chunks/editors/eo-next-table.b5cc9dab.js","mappings":"qJAAO,MAAMA,EAAoB,CAC/BC,KAAM,SACNC,KAAM,OACNC,UAAW,CACTF,KAAM,aACNG,MAAO,CACLC,OAAQ,aAGZC,SAAU,CACR,CACEL,KAAM,sBACNC,KAAM,OACNK,UAAW,CACTN,KAAM,gBACNG,MAAO,CACLI,KAAM,QAIZ,CACEP,KAAM,aACNQ,MAAO,OACPP,KAAM,SACNQ,UAAU,EACVP,UAAW,CACTF,KAAM,SACNG,MAAO,CACLO,YAAa,QACbC,YAAY,KAIlB,CACEX,KAAM,UACNQ,MAAO,QACPP,KAAM,SACNQ,UAAU,EACVP,UAAW,aACXI,UAAW,CACTN,KAAM,0BACNG,MAAO,CACLS,QAAS,+BAIf,CACEX,KAAM,SACND,KAAM,SACNS,UAAU,EACVD,MAAO,SACPN,UAAW,CACTF,KAAM,SACNG,MAAO,CACLO,YAAa,QACbC,YAAY,KAIlB,CACEX,KAAM,uBACNC,KAAM,OACNK,UAAW,CACTN,KAAM,gBACNG,MAAO,CACLI,KAAM,QAIZ,CACEP,KAAM,cACNQ,MAAO,SACPP,KAAM,UACNK,UAAW,CACTN,KAAM,WACNG,MAAO,CACLC,OAAQ,eAGZ,cAAe,CACb,CACES,OAAQ,eACRC,QAAS,CACPC,MAAO,CACLC,QAAS,uBAMnB,CACEhB,KAAM,eACNQ,MAAO,SACPP,KAAM,SACNC,UAAW,aACXI,UAAW,CACTN,KAAM,0BACNG,MAAO,CACLS,QACE,gDAIR,CACEZ,KAAM,qBACNC,KAAM,OACNK,UAAW,CACTN,KAAM,gBACNG,MAAO,CACLI,KAAM,SAIZ,CACEP,KAAM,eACNQ,MAAO,OACPP,KAAM,UACNC,UAAW,CACTC,MAAO,CACLc,cAAc,EACdC,KAAM,UAGV,cAAe,CACb,CACEL,OAAQ,aACRC,QAAS,CACPC,MAAO,CACLC,QAAS,uBAMnB,CACEhB,KAAM,aACNQ,MAAO,OACPP,KAAM,SACNC,UAAW,aACXI,UAAW,CACTN,KAAM,0BACNG,MAAO,CACLS,QAAS,oCAIf,CACEZ,KAAM,uBACNC,KAAM,OACNK,UAAW,CACTN,KAAM,gBACNG,MAAO,CACLI,KAAM,QAIZ,CACEP,KAAM,eACNQ,MAAO,UACPP,KAAM,SACNC,UAAW,aACXI,UAAW,CACTN,KAAM,4BAGV,CACEA,KAAM,kBACNQ,MAAO,QACPP,KAAM,SACNC,UAAW,aACXI,UAAW,CACTN,KAAM,0BACNG,MAAO,CACLS,QAAS,WAIf,CACEZ,KAAM,qBACNC,KAAM,OACNK,UAAW,CACTN,KAAM,gBACNG,MAAO,CACLI,KAAM,QAIZ,CACEP,KAAM,YACNQ,MAAO,SACPP,KAAM,WAER,CACED,KAAM,OACNQ,MAAO,OACPP,KAAM,SACNC,UAAW,aACXI,UAAW,CACTN,KAAM,4BAGV,CACEA,KAAM,uBACNC,KAAM,OACNK,UAAW,CACTN,KAAM,gBACNG,MAAO,CACLI,KAAM,aAIZ,CACEP,KAAM,aACNQ,MAAO,UACPP,KAAM,SACNC,UAAW,aACXI,UAAW,CACTN,KAAM,4BAGV,CACEA,KAAM,kBACNQ,MAAO,UACPP,KAAM,SACNC,UAAW,aACXI,UAAW,CACTN,KAAM,4BAGV,CACEA,KAAM,qBACNQ,MAAO,SACPP,KAAM,SACNC,UAAW,CACTC,MAAO,CACLO,YAAa,cAInB,CACEV,KAAM,sBACNC,KAAM,OACNK,UAAW,CACTN,KAAM,gBACNG,MAAO,CACLI,KAAM,QAIZ,CACEP,KAAM,OACNQ,MAAO,OACPP,KAAM,SACNK,UAAW,CACTN,KAAM,WACNG,MAAO,CACLC,OAAQ,eAGZe,KAAM,CACJ,CACEC,MAAO,IACPC,MAAO,SAET,CACED,MAAO,IACPC,MAAO,UAET,CACED,MAAO,IACPC,MAAO,UAGXnB,UAAW,CACTF,KAAM,cACNG,MAAO,CACLe,KAAM,QACNI,WAAY,SACZL,aAAc,WAIpB,CACEjB,KAAM,aACNQ,MAAO,OACPP,KAAM,UACNC,UAAW,CACTC,MAAO,CACLc,cAAc,EACdC,KAAM,WAIZ,CACElB,KAAM,gBACNQ,MAAO,QACPP,KAAM,SACNC,UAAW,aACXI,UAAW,CACTN,KAAM,0BACNG,MAAO,CACLS,QAAS,kBAIf,CACEZ,KAAM,sBACNC,KAAM,OACNK,UAAW,CACTN,KAAM,gBACNG,MAAO,CACLI,KAAM,QAIZ,CACEP,KAAM,eACNQ,MAAO,SACPP,KAAM,SACNC,UAAW,aACXI,UAAW,CACTN,KAAM,4BAGV,CACEA,KAAM,eACNQ,MAAO,UACPP,KAAM,UACNC,UAAW,CACTC,MAAO,CACLe,KAAM,UAGVZ,UAAW,CACTN,KAAM,WACNG,MAAO,CACLC,OAAQ,gBAId,CACEJ,KAAM,yBACNC,KAAM,OACNK,UAAW,CACTN,KAAM,gBACNG,MAAO,CACLI,KAAM,QAIZ,CACEP,KAAM,mBACNQ,MAAO,UACPP,KAAM,SACNC,UAAW,aACXI,UAAW,CACTN,KAAM,0BACNG,MAAO,CACLS,QAAS,kBACTR,OAAQ,iB,0DClWlB,MAAMmB,EAA4BC,IACpB,KACPC,EAAAA,EAAAA,MAAKD,EAAU,CAAC,oBACfA,EAASE,aACT,CAAC,EACD,CACEC,YAAY,KA0HtBC,EAAAA,cAAcC,OAAO,iBApGrB,SAAqCC,GACnC,OAAO,SAA8B3B,GACnC,MAAM,qBACJ4B,EAAoB,uBACpBC,EAAsB,aACtBC,EAAY,MACZC,EAAK,QACLC,EAAO,KACPC,GACEjC,EAEEkC,EAAYP,EAAMQ,QAAgB,GAClCC,EAAcT,EAAMQ,SAiF1B,OA/EAR,EAAMU,WAAU,KACd,MAAM,iBACJC,EAAgB,SAChBC,EAAQ,0BACRC,EAAyB,mBACzBC,GACET,EAEJC,EAAKS,iBAAiB,CACpB3B,KAAM,QACN4B,aAAa,EACbpB,cAAc,IAIhBU,EAAKW,WAAW,cAAc,KAC5BJ,GAA0B,KACxBN,EAAUW,SAAU,EAEpBC,YAAW,KACTZ,EAAUW,SAAU,CAAK,GACzB,IAEFJ,EAAmB,cAAeM,IAAe,IAAAC,EAAAC,EAC1Cf,EAAUW,SAEbZ,EAAKiB,eAAe,UAItB,MAAM,MAAEhC,GAAU6B,EACZI,EAA+B,QAAtBH,EAAGZ,EAAYS,eAAO,IAAAG,OAAA,EAAnBA,EAAqBI,MACpCC,IAAcA,aAAI,EAAJA,EAAMnC,SAAUA,IAE3BoC,EACJH,SAAyB,QAAhBF,EAATE,EAAWI,sBAAc,IAAAN,GAAQ,QAARA,EAAzBA,EAA2BO,cAAM,IAAAP,OAAA,EAAjCA,EAAmCQ,KAAKJ,IAAS,CAC/CpC,MAAOoC,aAAI,EAAJA,EAAMxD,KACbqB,MAAOmC,aAAI,EAAJA,EAAMxD,SAEjBoC,EAAKyB,MAAM,UAAUC,MAAMZ,IACzBA,EAAMa,kBAAkB,CACtBC,QAASP,GACT,GACF,GACF,IAINrB,EAAKW,WAAW,oBAAoB,KAClCN,GAAiB,CAACR,EAAuBgC,EAAQC,IACxCjC,EACHV,EAAyB2C,GAjFL1C,KAChC,MAAM2C,GAAmBC,EAAAA,EAAAA,KAAI5C,EAAU,cAYvC,MAXY,KACPC,EAAAA,EAAAA,MAAKD,EAAU,CAAC,mBACM,IAArB2C,EACA,CACEzC,cAAc,GAEhB,CACEA,cAAc,EACdC,WAAYwC,GAGV,EAqEEE,CAAyBH,IAC7B,IAIJ9B,EAAKW,WAAW,YAAY,KAC1BL,GAAUrB,GACDE,EAAyBF,IAChC,GACF,GACD,CAACe,IAEJN,EAAMU,WAAU,KAEd,MAAM,SAAE8B,EAAW,IAAOpC,EAC1BK,EAAYS,QAAUsB,aAAQ,EAARA,EAAUV,KAAKJ,IAAS,IACzCA,EACHpC,MAAOoC,aAAI,EAAJA,EAAMxD,KACbqB,MAAOmC,aAAI,EAAJA,EAAMnC,UAEfe,EAAKyB,MAAM,cAAcC,MAAMZ,IAC7BA,EAAMa,kBAAkB,CACtBC,QAASzB,EAAYS,SACrB,GACF,GACD,CAACd,IAEGJ,EAAMyC,cAAcxC,EAAsB,CAC/CyC,OAAQxC,EAAuBjC,EAAAA,EAAmBkC,GAClDC,SAEJ,CACF,G","sources":["webpack:///./src/editors/eo-next-table/eoNextTable.schema.tsx","webpack:///./src/editors/eo-next-table/index.tsx"],"sourcesContent":["export const eoNextTableSchema = {\n  name: \"layout\",\n  type: \"void\",\n  component: {\n    name: \"FormLayout\",\n    props: {\n      layout: \"vertical\",\n    },\n  },\n  children: [\n    {\n      name: \"categoryTitle_basic\",\n      type: \"void\",\n      decorator: {\n        name: \"CategoryTitle\",\n        props: {\n          text: \"基础\",\n        },\n      },\n    },\n    {\n      name: \"dataSource\",\n      title: \"选择数据\",\n      type: \"string\",\n      required: true,\n      component: {\n        name: \"Select\",\n        props: {\n          placeholder: \"请选择数据\",\n          allowClear: true,\n        },\n      },\n    },\n    {\n      name: \"columns\",\n      title: \"表格列配置\",\n      type: \"string\",\n      required: true,\n      component: \"CodeEditor\",\n      decorator: {\n        name: \"FormItemWithoutAdvanced\",\n        props: {\n          tooltip: \"扩展自antd的table Column相关配置项\",\n        },\n      },\n    },\n    {\n      type: \"string\",\n      name: \"rowKey\",\n      required: true,\n      title: \"表格行key\",\n      component: {\n        name: \"Select\",\n        props: {\n          placeholder: \"index\",\n          allowClear: true,\n        },\n      },\n    },\n    {\n      name: \"categoryTitle_search\",\n      type: \"void\",\n      decorator: {\n        name: \"CategoryTitle\",\n        props: {\n          text: \"搜索\",\n        },\n      },\n    },\n    {\n      name: \"frontSearch\",\n      title: \"使用前端搜索\",\n      type: \"boolean\",\n      decorator: {\n        name: \"FormItem\",\n        props: {\n          layout: \"horizontal\",\n        },\n      },\n      \"x-reactions\": [\n        {\n          target: \"searchFields\",\n          fulfill: {\n            state: {\n              visible: \"{{$self.value}}\",\n            },\n          },\n        },\n      ],\n    },\n    {\n      name: \"searchFields\",\n      title: \"搜索目标字段\",\n      type: \"string\",\n      component: \"CodeEditor\",\n      decorator: {\n        name: \"FormItemWithoutAdvanced\",\n        props: {\n          tooltip:\n            \"支持嵌套的写法,不配置的时候默认为对所有column.dataIndex进行前端搜索\",\n        },\n      },\n    },\n    {\n      name: \"categoryTitle_page\",\n      type: \"void\",\n      decorator: {\n        name: \"CategoryTitle\",\n        props: {\n          text: \"页设置\",\n        },\n      },\n    },\n    {\n      name: \"isPagination\",\n      title: \"显示分页\",\n      type: \"boolean\",\n      component: {\n        props: {\n          defaultValue: true,\n          size: \"small\",\n        },\n      },\n      \"x-reactions\": [\n        {\n          target: \"pagination\",\n          fulfill: {\n            state: {\n              visible: \"{{$self.value}}\",\n            },\n          },\n        },\n      ],\n    },\n    {\n      name: \"pagination\",\n      title: \"分页配置\",\n      type: \"string\",\n      component: \"CodeEditor\",\n      decorator: {\n        name: \"FormItemWithoutAdvanced\",\n        props: {\n          tooltip: \"前端搜索时需设置column.sortPriority优先级\",\n        },\n      },\n    },\n    {\n      name: \"categoryTitle_select\",\n      type: \"void\",\n      decorator: {\n        name: \"CategoryTitle\",\n        props: {\n          text: \"选择\",\n        },\n      },\n    },\n    {\n      name: \"rowSelection\",\n      title: \"表格行可选配置\",\n      type: \"string\",\n      component: \"CodeEditor\",\n      decorator: {\n        name: \"FormItemWithoutAdvanced\",\n      },\n    },\n    {\n      name: \"selectedRowKeys\",\n      title: \"指定选中行\",\n      type: \"string\",\n      component: \"CodeEditor\",\n      decorator: {\n        name: \"FormItemWithoutAdvanced\",\n        props: {\n          tooltip: \"填入key\",\n        },\n      },\n    },\n    {\n      name: \"categoryTitle_sort\",\n      type: \"void\",\n      decorator: {\n        name: \"CategoryTitle\",\n        props: {\n          text: \"排序\",\n        },\n      },\n    },\n    {\n      name: \"multiSort\",\n      title: \"支持多列排序\",\n      type: \"boolean\",\n    },\n    {\n      name: \"sort\",\n      title: \"排序配置\",\n      type: \"string\",\n      component: \"CodeEditor\",\n      decorator: {\n        name: \"FormItemWithoutAdvanced\",\n      },\n    },\n    {\n      name: \"categoryTitle_expand\",\n      type: \"void\",\n      decorator: {\n        name: \"CategoryTitle\",\n        props: {\n          text: \"展开与树形展示\",\n        },\n      },\n    },\n    {\n      name: \"expandable\",\n      title: \"表格行展开配置\",\n      type: \"string\",\n      component: \"CodeEditor\",\n      decorator: {\n        name: \"FormItemWithoutAdvanced\",\n      },\n    },\n    {\n      name: \"expandedRowKeys\",\n      title: \"展开项的key\",\n      type: \"string\",\n      component: \"CodeEditor\",\n      decorator: {\n        name: \"FormItemWithoutAdvanced\",\n      },\n    },\n    {\n      name: \"childrenColumnName\",\n      title: \"树形结构列名\",\n      type: \"string\",\n      component: {\n        props: {\n          placeholder: \"children\",\n        },\n      },\n    },\n    {\n      name: \"categoryTitle_style\",\n      type: \"void\",\n      decorator: {\n        name: \"CategoryTitle\",\n        props: {\n          text: \"外观\",\n        },\n      },\n    },\n    {\n      name: \"size\",\n      title: \"表格大小\",\n      type: \"string\",\n      decorator: {\n        name: \"FormItem\",\n        props: {\n          layout: \"horizontal\",\n        },\n      },\n      enum: [\n        {\n          label: \"S\",\n          value: \"small\",\n        },\n        {\n          label: \"M\",\n          value: \"middle\",\n        },\n        {\n          label: \"L\",\n          value: \"large\",\n        },\n      ],\n      component: {\n        name: \"Radio.Group\",\n        props: {\n          size: \"small\",\n          optionType: \"button\",\n          defaultValue: \"large\",\n        },\n      },\n    },\n    {\n      name: \"showHeader\",\n      title: \"显示表头\",\n      type: \"boolean\",\n      component: {\n        props: {\n          defaultValue: true,\n          size: \"small\",\n        },\n      },\n    },\n    {\n      name: \"hiddenColumns\",\n      title: \"隐藏表格列\",\n      type: \"string\",\n      component: \"CodeEditor\",\n      decorator: {\n        name: \"FormItemWithoutAdvanced\",\n        props: {\n          tooltip: \"填入column.key\",\n        },\n      },\n    },\n    {\n      name: \"categoryTitle_other\",\n      type: \"void\",\n      decorator: {\n        name: \"CategoryTitle\",\n        props: {\n          text: \"其他\",\n        },\n      },\n    },\n    {\n      name: \"scrollConfig\",\n      title: \"表格滚动配置\",\n      type: \"string\",\n      component: \"CodeEditor\",\n      decorator: {\n        name: \"FormItemWithoutAdvanced\",\n      },\n    },\n    {\n      name: \"rowDraggable\",\n      title: \"支持表格行拖拽\",\n      type: \"boolean\",\n      component: {\n        props: {\n          size: \"small\",\n        },\n      },\n      decorator: {\n        name: \"FormItem\",\n        props: {\n          layout: \"horizontal\",\n        },\n      },\n    },\n    {\n      name: \"categoryTitle_advanced\",\n      type: \"void\",\n      decorator: {\n        name: \"CategoryTitle\",\n        props: {\n          text: \"高级\",\n        },\n      },\n    },\n    {\n      name: \"optimizedColumns\",\n      title: \"需优化渲染的列\",\n      type: \"string\",\n      component: \"CodeEditor\",\n      decorator: {\n        name: \"FormItemWithoutAdvanced\",\n        props: {\n          tooltip: \"输入对应的column.key\",\n          layout: \"horizontal\",\n        },\n      },\n    },\n  ],\n};\n","import type _React from \"react\";\nimport { customEditors } from \"@next-core/runtime\";\nimport { eoNextTableSchema } from \"./eoNextTable.schema\";\nimport { get, omit } from \"lodash\";\n\nconst transformNormal2Advanced = (rawValue: any) => {\n  const res = {\n    ...omit(rawValue, [\"isPagination\"]),\n    ...(rawValue.isPagination\n      ? {}\n      : {\n          pagination: false,\n        }),\n  };\n  return res;\n};\n\nconst transformAdvanced2Normal = (rawValue: any) => {\n  const paginationConfig = get(rawValue, \"pagination\");\n  const res = {\n    ...omit(rawValue, [\"pagination\"]),\n    ...(paginationConfig === false\n      ? {\n          isPagination: false,\n        }\n      : {\n          isPagination: true,\n          pagination: paginationConfig,\n        }),\n  };\n  return res;\n};\n\nfunction EoNextTableComponentFactory(React: typeof _React) {\n  return function EoNextTableComponent(props: any): React.ReactElement {\n    const {\n      SchemaFieldComponent,\n      formilySchemaFormatter,\n      advancedMode,\n      scope,\n      effects,\n      form,\n    } = props;\n\n    const isInitRef = React.useRef<boolean>(false);\n    const dataListRef = React.useRef<any>();\n\n    React.useEffect(() => {\n      const {\n        onAdvancedChange,\n        onSubmit,\n        onFormInitialValuesChange,\n        onFieldValueChange,\n      } = effects;\n\n      form.setInitialValues({\n        size: \"large\",\n        frontSearch: false,\n        isPagination: true,\n      });\n\n      // 当data变化时\n      form.addEffects(\"dataChange\", () => {\n        onFormInitialValuesChange(() => {\n          isInitRef.current = true;\n\n          setTimeout(() => {\n            isInitRef.current = false;\n          });\n        }),\n          onFieldValueChange(\"dataSource\", (field: any) => {\n            if (!isInitRef.current) {\n              // 清除关联值\n              form.deleteValuesIn(\"rowKey\");\n            }\n\n            // 修改关联值的options\n            const { value } = field;\n            const matchData = dataListRef.current?.find(\n              (item: any) => item?.value === value\n            );\n            const matchDefinitionOptions =\n              matchData?.dataDefinition?.fields?.map((item: any) => ({\n                label: item?.name,\n                value: item?.name,\n              }));\n            form.query(\"rowKey\").take((field: any) => {\n              field.setComponentProps({\n                options: matchDefinitionOptions,\n              });\n            });\n          });\n      });\n\n      // 监听模式切换\n      form.addEffects(\"onAdvancedChange\", () => {\n        onAdvancedChange((advancedMode: boolean, _: any, values: any) => {\n          return advancedMode\n            ? transformNormal2Advanced(values)\n            : transformAdvanced2Normal(values);\n        });\n      });\n\n      // 监听表单提交\n      form.addEffects(\"onSubmit\", () => {\n        onSubmit((value: any) => {\n          return transformNormal2Advanced(value);\n        });\n      });\n    }, [form]);\n\n    React.useEffect(() => {\n      // 初始化data\n      const { dataList = [] } = scope;\n      dataListRef.current = dataList?.map((item: any) => ({\n        ...item,\n        label: item?.name,\n        value: item?.value,\n      }));\n      form.query(\"dataSource\").take((field: any) => {\n        field.setComponentProps({\n          options: dataListRef.current,\n        });\n      });\n    }, [scope]);\n\n    return React.createElement(SchemaFieldComponent, {\n      schema: formilySchemaFormatter(eoNextTableSchema, advancedMode),\n      scope,\n    });\n  };\n}\n\ncustomEditors.define(\"eo-next-table\", EoNextTableComponentFactory);\n"],"names":["eoNextTableSchema","name","type","component","props","layout","children","decorator","text","title","required","placeholder","allowClear","tooltip","target","fulfill","state","visible","defaultValue","size","enum","label","value","optionType","transformNormal2Advanced","rawValue","omit","isPagination","pagination","customEditors","define","React","SchemaFieldComponent","formilySchemaFormatter","advancedMode","scope","effects","form","isInitRef","useRef","dataListRef","useEffect","onAdvancedChange","onSubmit","onFormInitialValuesChange","onFieldValueChange","setInitialValues","frontSearch","addEffects","current","setTimeout","field","_dataListRef$current","_matchData$dataDefini","deleteValuesIn","matchData","find","item","matchDefinitionOptions","dataDefinition","fields","map","query","take","setComponentProps","options","_","values","paginationConfig","get","transformAdvanced2Normal","dataList","createElement","schema"],"sourceRoot":""}