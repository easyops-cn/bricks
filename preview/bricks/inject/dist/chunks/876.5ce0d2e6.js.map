{"version":3,"file":"chunks/876.5ce0d2e6.js","mappings":"oNASO,IAAIA,EAsCX,SAASC,EAAQC,GACfA,EAAMC,iBACND,EAAME,kBAmFR,SAAqBC,GACnB,MAAMC,EAAUC,EAAwBF,GACpCC,EAAQE,OAAS,GACnBC,OAAOC,OAAOC,YACZ,CACEC,OAAQ,YACRC,KAAM,eACNP,WAEFN,EAGN,CA9FEc,CAAYZ,EAAMa,eACpB,CAEA,SAASC,EAAad,GACpBA,EAAMC,iBACND,EAAME,iBACR,CAEA,MAAMa,GAAeC,EAAAA,EAAAA,WAClBb,IACC,MAAMC,EAAUC,EAAwBF,GAEpCC,EAAQE,OAAS,GACnBC,OAAOC,OAAOC,YACZ,CACEC,OAAQ,YACRC,KAAM,iBACNP,WAEFN,EAEJ,GAEF,IACA,CAAEmB,SAAS,IAGb,SAASC,EAAclB,GACrBA,EAAMC,iBACND,EAAME,kBACNa,EAAaf,EAAMa,eACrB,CAEA,SAASM,EAAcnB,GACrBA,EAAMC,iBACND,EAAME,kBACNa,EAAaf,EAAMa,eACrB,CAEA,SAASO,EAAepB,GACtBA,EAAMC,iBACND,EAAME,kBACNK,OAAOC,OAAOC,YACZ,CACEC,OAAQ,YACRC,KAAM,iBACNP,QAAS,IAEXN,EAEJ,CAEA,SAASuB,EAAcrB,GACrBA,EAAMC,iBACND,EAAME,kBAOR,SACEC,EACAmB,GAKA,MAAMlB,EAAUC,EAAwBF,GACpCC,EAAQE,OAAS,GACnBC,OAAOC,OAAOC,YACZ,CACEC,OAAQ,YACRC,KAAM,wBACNP,UACAkB,YAEFxB,EAGN,CAzBEyB,CAAmBvB,EAAMa,eAAgB,CACvCW,EAAGxB,EAAMyB,QACTC,EAAG1B,EAAM2B,SAEb,CAkDO,SAAStB,EAAwBF,GACtC,MAAMyB,EAAoB,GAC1B,IAAK,MAAMC,KAAU1B,EAEjB0B,aAAkBC,aACY,iBAAvBD,EAAOE,QAAQC,KAEtBJ,EAAQK,KAAKJ,EAAOE,QAAQC,KAGhC,OAAOJ,CACT,C,wBC3IO,SAASM,EAAqBC,GACnC,MAAMC,EArBR,SAAiBC,GACf,MAAMD,EAAa,IAAIE,IAgBvB,OAdAC,EAAAA,EAAAA,GAASF,GAAcG,IACrB,OAAQA,EAAK7B,MACX,IAAK,aACL,IAAK,eAAgB,KAAA8B,EACnB,MAAMC,EACI,QADOD,EACfD,EAAKG,WAAG,IAAAF,OAAA,EADUA,EAEjBC,YACCA,GACFN,EAAWQ,IAAIF,EAEnB,EACF,IAGKN,CACT,CAGqBS,EAAQC,EAAAA,EAAAA,IAAgBX,IAErCY,EAAY,GAElB,IAAK,MAAMC,KAAQZ,EACbY,EAAKC,SAAS,MAChBF,EAAUd,KAAKe,GAInB,OAAOD,CACT,CC3CO,SAASG,EAA0BC,GACxC,MAAMxC,SAAcwC,EACpB,OAAQxC,GACN,IAAK,SACL,IAAK,UACL,IAAK,SACH,MAAO,CACLA,OACAwC,SAEJ,IAAK,YACH,MAAO,CAAExC,QAEb,OAAc,OAAVwC,EACK,CAAExC,KAAM,QAEbyC,MAAMC,QAAQF,GACT,CAAExC,KAAM,QAASL,OAAQ6C,EAAM7C,QAEjC,CAAEK,KAAM,SACjB,CCkCA,IAAI2C,GAAY,EAaZC,EAAaC,EAAAA,WACbC,EAAYC,EAAAA,UACZC,EAAqBC,EAAAA,mBACrBC,EAAUC,EAAAA,QACVC,GAAO,EAIX,IAAI,IAAAC,EACF,MAAMC,EAAO1D,OAAoC0D,IACjD,GACEA,GAC0B,QADvBD,EACHzD,OAAO2D,2BAAmB,IAAAF,GAAqB,QAArBA,EAA1BA,EAA6B,0BAAkB,IAAAA,GAA/CA,EAAiDG,WAAW,MAC5D,CACA,MACEZ,WAAYa,EACZC,cAAeC,EAAe,qBAC9BC,GACEN,EAAI,SACAR,UAAWe,GAAgBP,EAAI,QACvCV,EAAaa,EACbX,EAAYe,EAGZb,EAAqB,IAChBW,EACHG,eAAAA,CAAgBC,EAAIC,GAAuB,IAArB,gBAAEC,GAAiBD,EACvC,OAAOL,EAAgBG,gBAAgBC,EAAM,CAC3CG,aAAcD,GAElB,EACAE,mBAAAA,CAAmBC,GAAsB,IAArB,gBAAEH,GAAiBG,EAGrC,MAAMC,EAAQV,EAAgBQ,oBAAoB,CAChDD,aAAcD,IAEhB,OAAOK,OAAOC,YACZ,IAAIF,GAAOG,KAAIC,IAAA,IAAEC,EAAGC,GAAEF,EAAA,MAAK,CAACC,EAAIC,EAAUnC,MAAM,IAEpD,EACAoC,cAAAA,CAAeC,EAAIC,GAAuB,IAArB,gBAAEb,GAAiBa,EACtC,OAAOnB,EAAgBiB,eAAeC,EAAM,CAC1CX,aAAcD,GAElB,GAGFf,EAAU,CACRU,wBAEFR,GAAO,CACT,CACF,CAAE,MAAO2B,GAEPC,QAAQC,MAAM,qCAAsCF,EACtD,CAEA,IAAIG,EAAuC,KACvCC,EAAoC,KAEzBC,eAAeC,EAC5BC,EACAC,GACA,IAAAC,EAAAC,EACA,GAAI9C,EACF,OAEFA,GAAY,EAEZ,MAAM+C,EACJC,IAEA/F,OAAOC,OAAOC,YACZ,CACEC,OAAQ,eACL4F,GAELL,EACD,EAMH,IAAIM,EACAC,EACAC,EACAC,EANJL,EAAY,CAAE1F,KAAM,oBHzIpBb,EG0IqBmG,EAOrB,MAiCMU,EAA6BA,CACjChG,EACAqB,EACA4E,KAEA,MAAMC,EAAWC,EAAiB9E,GAClCqE,EAAmD,CACjD1F,KAAM,kBACNoG,cAAepG,EACfkG,WACA7E,IAAKA,EACL4E,MAAOA,GACP,EAaJ,IAAII,EACAd,EAAQe,aACVD,EAA8Bd,EAAQgB,UAGxC,MAAMC,EAAgCA,KACpCxD,EAAmBwD,8BACjBjB,EAAQkB,MACRlB,EAAQe,WACRD,GAEFzD,IAAa8D,QAAQ,EAGjBC,EAA+BA,KACnC3D,EAAmB2D,6BACjBpB,EAAQkB,MACRG,KAAKC,MAAMtB,EAAQuB,cAErBlE,IAAa8D,QAAQ,EAGjBK,EAA4BA,KAC/B/D,EAA2B+D,0BAC1BxB,EAAQkB,MACRlB,EAAQyB,OACRzB,EAAQ0B,UAEVrE,IAAa8D,QAAQ,EA8FjBQ,EAAUtE,IAEhBhD,OAAOuH,iBACL,WACA/B,UAAqE,IAAAgC,EAAAC,EAAA,IAA9D,KAAExC,EAAI,OAAEyC,GAAiDC,EAC9D,GACED,IAAWhC,GACVT,GACe,sBAAhBA,EAAK9E,OAIP,GAA0B,YAAtB8E,EAAK2C,aACP,OAAQ3C,EAAK7E,MACX,IAAK,iBACH4F,EAAWf,EAAKxD,IAChBwE,EAAahB,EAAKoB,MAClBD,EAA2B,QAASnB,EAAKxD,IAAKwD,EAAKoB,OACnD,MACF,IAAK,gBACHD,EAA2B,QAAS,oBAAqB,QACzD,MACF,IAAK,mBA1JwByB,KACnC,MAAMvB,EAAWuB,EACdjD,KAAK3C,GAASsE,EAAiBtE,EAAKR,IAAKQ,EAAKoE,SAC9CyB,OACHhC,EAAqD,CACnD1F,KAAM,oBACNkG,YACA,EAoJMyB,CAA4B9C,EAAK+C,gBACjC,MACF,IAAK,eACH9B,EAAYjB,EAAKxD,IACjB0E,EAAclB,EAAKoB,MACnBD,EAA2B,SAAUnB,EAAKxD,IAAKwD,EAAKoB,OACpD,MACF,IAAK,kBAlNgB4B,KAC3B,MAAMC,EAAUC,SAASC,iBAAiBH,EAAIhH,EAAGgH,EAAI9G,GACrD,GAAyB,UAArB+G,aAAO,EAAPA,EAASG,SACXrI,OAAOC,OAAOC,YACZ,CACEC,OAAQ,YACRC,KAAM,gBACNkI,aAAa,EACbvH,SAAU,CACRE,EAAGgH,EAAIhH,EACPE,EAAG8G,EAAI9G,IAGX5B,OAEG,CACL,MAAMM,EH3BL,SAAiC0I,GACtC,MAAM1I,EAAoB,GAE1B,IAAI2I,EAA6BD,EACjC,KAAOC,GAC6B,iBAAvBA,EAAOhH,QAAQC,KACxB5B,EAAQ6B,KAAK8G,EAAOhH,QAAQC,KAE9B+G,EAASA,EAAOC,cAElB,OAAO5I,CACT,CGgBsB6I,CAAwBR,GACxClI,OAAOC,OAAOC,YACZ,CACEC,OAAQ,YACRC,KAAM,iBACNP,UACAyI,aAAa,EACbvH,SAAU,CACRE,EAAGgH,EAAIhH,EACPE,EAAG8G,EAAI9G,IAGX5B,EAEJ,GAqLQoJ,CAAoB1D,EAAKlE,eAI7B,OAAQkE,EAAK7E,MACX,IAAK,oBACH6E,EAAK2D,SH9Vf5I,OAAOuH,iBAAiB,QAAS/H,GAAS,GAC1CQ,OAAOuH,iBAAiB,YAAahH,GAAc,GACnDP,OAAOuH,iBAAiB,YAAahH,GAAc,GACnDP,OAAOuH,iBAAiB,UAAWhH,GAAc,GACjDP,OAAOuH,iBAAiB,cAAe5G,GAAe,GACtDX,OAAOuH,iBAAiB,cAAe3G,GAAe,GACtDZ,OAAOuH,iBAAiB,YAAahH,GAAc,GACnDP,OAAOuH,iBAAiB,eAAgB1G,GAAgB,GACxDb,OAAOuH,iBAAiB,cAAezG,GAAe,KAItDd,OAAO6I,oBAAoB,QAASrJ,GAAS,GAC7CQ,OAAO6I,oBAAoB,YAAatI,GAAc,GACtDP,OAAO6I,oBAAoB,YAAatI,GAAc,GACtDP,OAAO6I,oBAAoB,UAAWtI,GAAc,GACpDP,OAAO6I,oBAAoB,cAAelI,GAAe,GACzDX,OAAO6I,oBAAoB,cAAejI,GAAe,GACzDZ,OAAO6I,oBAAoB,YAAatI,GAAc,GACtDP,OAAO6I,oBAAoB,eAAgBhI,GAAgB,GAC3Db,OAAO6I,oBAAoB,cAAe/H,GAAe,IG2U/C,MACF,IAAK,UACH,GAAgB,QAAhB0G,EAAIvC,EAAKU,eAAO,IAAA6B,GAAZA,EAAcsB,qBAAsB,KAAAC,EA4BtC,IAAIC,EAC+C,IAAAC,EAAAC,EA5BT,UAAtCjE,EAAKU,QAAQmD,qBACf1F,EAAmB+F,wBACjBxD,EAAQkB,MACR5B,EAAKmE,iBAEwC,aAAtCnE,EAAKU,QAAQmD,qBACtB1F,EAAmBiG,2BACjB1D,EAAQkB,MACR5B,EAAKmE,gBACLnE,EAAKU,QAAQgB,UAEgC,YAAtC1B,EAAKU,QAAQmD,qBACtB1F,EAAmBkG,0BACjB3D,EAAQkB,MACR5B,EAAKmE,iBAKwC,SAAtCnE,EAAKU,QAAQmD,sBACrB1F,EAA2B+D,0BAC1BxB,EAAQkB,MACRlB,EAAQyB,OACRnC,EAAKmE,iBAKkC,UAA3B,QAAZL,EAAA9D,EAAKU,eAAO,IAAAoD,OAAA,EAAZA,EAAcD,wBAChBE,QAEmB,QAFJC,GAAMC,EACnB9F,GACAmG,yBAAiB,IAAAN,OAAA,EAFEA,EAAAO,KAAAN,EAECjE,EAAKmE,gBAAiB,CAC1CvC,MAAOlB,EAAQkB,MACfiC,qBAAsB7D,EAAKU,QAAQmD,qBACnC1B,OAAQzB,EAAQyB,OAChBzF,qBAAoBA,OAInB8H,EAAAA,EAAAA,SAAQT,GAQXhG,IAAa8D,SAPbhB,EAAiD,CAC/C1F,KAAM,kBACN6E,KAAM,CACJ5C,IAAK2G,KAOX,KACF,CACA5F,EAAmBsG,iBACjB/D,EAAQkB,MACR5B,EAAKmE,iBAEHzD,EAAQe,YACVD,EAA8BxB,EAAK0B,SACnCC,KACSjB,EAAQyB,QAAUzB,EAAQ0B,SACnCF,IACqB,QAAhBM,EAAIxC,EAAKU,eAAO,IAAA8B,GAAZA,EAAcP,aACvBvB,EAAQuB,YAAcjC,EAAKU,QAAQuB,YACnCH,KAEA/D,IAAa8D,SAEf,MACF,IAAK,SACH6C,SAAS7C,SACT,MACF,IAAK,OACHQ,EAAQsC,SACR,MACF,IAAK,UACHtC,EAAQuC,YACR,MACF,IAAK,WCvbRrE,eACLsE,EACAC,GAEA,MAAMC,QAAqBC,IAAY9B,SAAS+B,KAAM,CACpDC,SAAS,EACTC,MAAO,EACPC,MAAOrK,OAAOsK,WACdC,OAAQvK,OAAOwK,YACfC,wBAAwB,IAEpBC,EAAevC,SAASwC,cAAc,UAvB9C,IAAuBC,EA0BrB,OC9BK,SACLA,EACAF,EACAZ,EACAC,GAEA,MAAMc,EAAcf,EAAWC,GACzB,MAAEM,EAAK,OAAEE,GAAWK,EACpBE,EAAQT,EAAQE,EAChBQ,EAAQD,GAASD,EACjBG,EAAaD,EAAQjB,EAAWC,EAAYe,EAC5CG,EAAcF,EAAQjB,EAAWgB,EAAQf,EAC/CW,EAAaL,MAAQW,EACrBN,EAAaH,OAASU,EAEVP,EAAaQ,WAAW,MAChCC,UAAUP,EAAQ,EAAG,EAAGP,EAAOE,EAAQ,EAAG,EAAGS,EAAYC,GACtDP,EAAaU,WACtB,CDUEC,CAAiBrB,EAAcU,EAAcZ,EAAUC,SAxBlCa,EAyBYF,EAxB1B,IAAIY,SAAQ,SAAUC,EAASC,GACpCZ,EAAOa,QAAO,SAAUC,GAClBA,EACFH,EAAQG,GAERF,GAEJ,GACF,IAkBF,EDyaYG,CAAQ1G,EAAK6E,SAAU7E,EAAK8E,WAAW6B,MACpCC,IACC/F,EAA8C,CAC5C1F,KAAM,aACNyL,cACA,IAEJ,KACE/F,EAAkD,CAChD1F,KAAM,kBACN,IAGN,MACF,IAAK,qBAhOa0L,EAAC3H,EAAc4H,KACvC,IACE,MAAM,SAAEC,GAAaD,EACrB,IAAI1H,EAoBAzB,EAAOxC,EAlBX,GAAiB,UAAb4L,IACF3H,EAAkB4H,KAEb5H,GAWH,YAVAyB,EAAiD,CAC/C1F,KAAM,2BACN6E,KAAM,CACJI,MAAO,CACLU,QACE,+DAUZ,GAAI5B,EACF/D,EAAO,oCACPwC,EAAQQ,EAAmBc,gBAAgBC,EAAM,CAC/CE,wBAEG,CACLjE,EAAO,kCACP,MAAM6E,EAAO7B,EAAmBmB,oBAAoB,CAClDF,oBAEFzB,EAAQ8B,OAAOwH,QAAQjH,GAAML,KAAIuH,IAAA,IAAEhI,EAAMvB,GAAMuJ,EAAA,MAAM,CAAEhI,OAAMvB,QAAO,GACtE,CAEAkD,EAAmD,CACjD1F,OACA6E,KAAM,CACJd,OACAvB,UAKN,CAAE,MAAOyC,GACPS,EAAiD,CAC/C1F,KAAM,2BACN6E,KAAM,CACJc,QAAUV,EAAgBU,UAGhC,GA4KQ+F,CAAkB7G,EAAKd,KAAMc,EAAK8G,QAClC,MACF,IAAK,qBAAsB,CAEzB,MAAMK,EAAMnH,EAAKoH,WAAWzI,WAAW5D,OAAO0H,QAC1CzC,EAAKoH,WAAWC,UAAUtM,OAAO0H,OAAO3H,QACxCkF,EAAKoH,WAEHE,GAAWC,EAAAA,EAAAA,eACXC,EAAKL,EAAIxI,WAAW2I,GACtBH,EAAIE,UAAUC,EAASxM,OAAS,GAChCqM,EACJpJ,IAAatB,KAAK+K,GAClB,KACF,CACA,IAAK,uBACH9G,EAAQ+G,UAAYzH,EAAKyH,UACzB/G,EAAQgH,WAAa1H,EAAK0H,WAC1BC,IACA,MAEF,IAAK,mBA9LUpH,OACrBP,EACA4H,EACAC,KAEA,IACMD,GACFvJ,EAAQU,qBAAqB,CAAC6I,IAEhC,MAAMjK,QAAcQ,EAAmB4B,eAAeC,EAAM,CAC1DZ,gBAC6B,UAA3ByI,EAAcd,SACVC,SACAc,EACNC,QAASrH,EAAQqH,UAGnBlH,EAAoD,CAClD1F,KAAM,2BACN6E,KAAM,CACJgI,UAAWhI,EACXrC,UAGN,CAAE,MAAOyC,GACPS,EAAkD,CAChD1F,KAAM,yBACN6E,KACEI,aAAiB6H,EAAAA,kBACb7H,EAAM8H,aACN,CAAEpH,QAAUV,EAAgBU,UAEtC,GA+JQf,CAAeC,EAAKmI,UAAWnI,EAAK4H,aAAc5H,EAAKU,SACvD,MACF,IAAK,sBAAuB,CAC1B,MAAO0H,EAAKC,EAAQC,EAAO,IAAMtI,EAAKuI,gBACtC,IACE,MAAMC,EAAStF,SAAS+B,KAAKwD,cAAcL,GAAKC,MAAWC,GAC3DvN,OAAOC,OAAOC,YAAY,CACxBC,OAAQ,YACRC,KAAM,8BACN6E,KAAM,CAAEqI,OAAQA,EAAQK,IAAKF,IAEjC,CAAE,MAAOG,GACP5N,OAAOC,OAAOC,YAAY,CACxBC,OAAQ,YACRC,KAAM,4BACN6E,KAAM,CAAEqI,OAAQA,EAAQK,IAAMC,EAAc7H,UAEhD,CACA,KACF,EACF,IAIN/F,OAAOuH,iBAAiB,UAAU,KAChCzB,EAA2C,CACzC1F,KAAM,SACNyN,OAAQ,CACN5M,EAAGjB,OAAO8N,QACV3M,EAAGnB,OAAO+N,UAEZ,IAGJ,IACIC,EADAC,GAAmB,EAEvB,MAAMC,EAAsBC,IAC1BrI,EAA8C,CAC5C1F,KAAM,aACNgM,IAAKzC,SAASjC,OAASJ,EAAQ8G,WAAWD,KAE5CH,EAAkBG,EAClBvB,GAAgB,EAGlB,SAASA,IACP,GAAIjH,EAAQ+G,UAAW,CACrB,MAAM2B,IAAUnL,EAAU8K,EAAgBM,SAAU,CAClDC,KAAM5I,EAAQ+G,UACd8B,MAAO7I,EAAQgH,aAQjB,GANA7G,EAAqD,CACnD1F,KAAM,qBACNiO,UAIE1I,EAAQe,aAAeuH,GAAoBI,EAAO,CACpD,MAAMI,EAAiBtG,SAASuF,cAAc,qBACxCgB,EAA0B,IAAIC,kBAAiB,KAGZ,IAArCF,EAAeG,WAAW7O,QAC6B,SAAtD0O,EAAeI,WAA2BxG,SACM,IAAjDoG,EAAeI,WAAYD,WAAW7O,SAEtC6G,IACA8H,EAAwBI,aAC1B,IAEFJ,EAAwBK,QAAQN,EAAgB,CAAEO,WAAW,GAC/D,CACA,GAAIrJ,EAAQyB,SAAW6G,GAAoBI,EAAO,CAChD,MAAMI,EAAiBtG,SAASuF,cAAc,qBACxCgB,EAA0B,IAAIC,kBAAiB,KAGZ,IAArCF,EAAeG,WAAW7O,QAC6B,SAAtD0O,EAAeI,WAA2BxG,SACM,IAAjDoG,EAAeI,WAAYD,WAAW7O,SAEtCoH,IACAuH,EAAwBI,aAC1B,IAEFJ,EAAwBK,QAAQN,EAAgB,CAAEO,WAAW,GAC/D,CACA,GAAIrJ,EAAQuB,cAAgB+G,GAAoBI,EAAO,CACrD,MAAMI,EAAiBtG,SAASuF,cAAc,qBACxCgB,EAA0B,IAAIC,kBAAiB,KAGZ,IAArCF,EAAeG,WAAW7O,QAC6B,SAAtD0O,EAAeI,WAA2BxG,SACM,IAAjDoG,EAAeI,WAAYD,WAAW7O,SAEtCgH,IACA2H,EAAwBI,aAC1B,IAEFJ,EAAwBK,QAAQN,EAAgB,CAAEO,WAAW,GAC/D,CACAf,EAAmBI,CACrB,CACF,CAkBA,SAASY,IAAqB,IAAAC,EAC5B,MAAMC,EAAOhH,SAASuF,cAAc,gBAC9BxF,GAAUiH,SAAgB,QAAZD,EAAJC,EAAMC,kBAAU,IAAAF,OAAA,EAAhBA,EAAkBxB,cAAc,cAAe,KACzB,IAAA2B,EAAlCnH,IAAY5C,IACM,QAApB+J,EAAA/J,SAAoB,IAAA+J,GAApBA,EAAsBxG,oBAAoB,SAAUyG,GACpDpH,SAAAA,EAASX,iBAAiB,SAAU+H,GACpChK,EAAuB4C,EACvB3C,EAAoB4J,EAExB,CAEA,SAASG,IACPxJ,EAAkD,CAChD1F,KAAM,iBACNyN,OAAQ,CACN5M,EAAGsO,KAAKC,WACRrO,EAAGoO,KAAKE,YAGd,CAnCAvB,EAAmB5G,EAAQqC,UAE3BrC,EAAQoI,OAAOxB,GAEXvI,EAAQe,YACVE,KAGEjB,EAAQyB,QAAUzB,EAAQ0B,WAC5BF,IAGExB,EAAQuB,aACVH,IAwBF,MAAM4I,EAA2BA,KAAM,IAAAC,EACrC,MAAM5C,EAAUrH,EAAQqH,QAElB/H,EAAO7B,EAAmByM,qBAAqB,CAAE7C,YACvDlH,EAAsD,CACpD1F,KAAM,6BACN6E,KAAM,KACD6K,EAAAA,EAAAA,MAAK7K,EAAM,SACd8K,MAAO9K,EAAK8K,MAAQrL,OAAOC,YAAYM,EAAK8K,MAAM7D,WAAa,CAAC,EAChEqC,KAAgB,QAAZqB,EAAE3K,EAAKoJ,aAAK,IAAAuB,OAAA,EAAVA,EAAYI,SAEpB,EA2BJ,IAAIC,EAEJ,SAASC,EAAyBC,GAChC,MAAM9L,EAAkBsB,EAAQe,WAC5BuF,SACAc,EAC0D,IAAAqD,EAAAC,GAA1DJ,IAAgC5L,GAAmB8L,KACrDF,EAA8B5L,EACe,QAA7C+L,GAAAC,EAAAjN,GAAmBkN,kCAA0B,IAAAF,GAA7CA,EAAA5G,KAAA6G,EAAgD,CAC9ChM,oBAGN,CApC6C,QAA7CuB,GAAAC,EAAAzC,GAAmBmN,kCAA0B,IAAA3K,GAA7CA,EAAA4D,KAAA3D,GACE2K,IAA6C,IAA5C,WAAEC,EAAU,gBAAEpM,EAAe,OAAEqM,GAAQF,EACtC1K,EAA8D,CAC5D1F,KAAM,gCACNqQ,aACApM,kBACAqM,OACiB,WAAfD,EACI,CACEtM,KAAMuM,EAAOvM,KACbwM,WAAYhO,EAA0B+N,EAAO9N,QAE/C,CACEqC,KAAMP,OAAOC,YACXD,OAAOwH,QAAQwE,EAAOzL,MAAML,KAAIgM,IAAA,IAAE9L,EAAGC,GAAE6L,EAAA,MAAK,CAC1C9L,EACAnC,EAA0BoC,GAC3B,OAGX,IAkBN/E,OAAOuH,iBAAiB,gBAAgB,KACtC2I,GAAyB,GACzBP,GAA0B,IAG5BV,IACAiB,GAAyB,GACzBP,IAYyB,IAAIhB,kBAC3BlO,EAAAA,EAAAA,WAXuBoQ,KACvB5B,IACAiB,IACIlK,GACFI,EAA2B,QAASJ,EAAUC,GAE5CC,GACFE,EAA2B,SAAUF,EAAWC,EAClD,GAG2B,IAAK,CAAEzF,SAAS,KAE5BqO,QAAQ5G,SAAS+B,KAAM,CAAE4G,SAAS,EAAM9B,WAAW,GACtE,CAEA,SAASzI,EAAiB9E,EAAa4E,GACrC,IAAK5E,EACH,MAAO,GAET,MAAMsP,EAAStP,EAAIiB,SAAS,KACtBsO,EAUD,SACLvP,EACAsP,GAEA,MAAMC,EAA0B,GAuBhC,OArBA,SAASC,EAAKC,GACZ,MAAMC,EAAaD,EAAKE,iBACtBL,EAAStP,EAAM,cAAcA,OAK/B,GAHAuP,EAAStP,QAAQyP,KAGbD,IAAS/I,UAAYgJ,EAAWpR,OAAS,GAK7C,IAAK,MAAM0C,KAAQyO,EAAKE,iBAAiB,KACnC3O,EAAK2M,YACP6B,EAAKxO,EAAK2M,WAGhB,CAEA6B,CAAK9I,UAEE6I,CACT,CAtCmBK,CAAgC5P,EAAKsP,GAChDzK,EAuCR,SAAqB0K,EAAyB3K,GAC5C,OAAO2K,EAASpM,KAAKsD,IAAY,IAAAoJ,EAAAC,EAAAC,EAC/B,MAAMC,EAAoC,QAApBH,EAAG/L,SAAiB,IAAA+L,OAAA,EAAjBA,EAAmBI,SAASxJ,IAC/C,MAAEmC,EAAK,OAAEE,EAAM,KAAEoH,EAAI,IAAEC,GAAQ1J,EAAQ2J,wBAC7C,MAAO,CACLxH,QACAE,SACAoH,KACEA,EACA3R,OAAO8N,SACN2D,GAAwC,QAApBF,EAAAjM,SAAoB,IAAAiM,OAAA,EAApBA,EAAsB/B,aAAc,EAAK,GAChEoC,IACEA,EACA5R,OAAO+N,SACN0D,GAAwC,QAApBD,EAAAlM,SAAoB,IAAAkM,OAAA,EAApBA,EAAsB/B,YAAa,EAAK,GAC/DpJ,QACAoL,mBACD,GAEL,CA1DmBK,CAAYd,EAAU3K,GACvC,OAAO0K,EACHzK,EAAS1B,KAAKnC,IAAI,IACbA,EACH8H,OAAQvK,OAAOwK,YAAc/H,EAAKmP,QAEpCtL,CACN,CAqDA,SAAS2F,IAA6C,IAAA8F,EACpD,MAAMtD,EAAiBtG,SAASuF,cAAc,qBAE9C,OAAQe,SAA0B,QAAZsD,EAAdtD,EAAgBI,kBAAU,IAAAkD,OAAA,EAA3BA,EAA6CvQ,QAClDgC,EAAO,eAAiB,kBAE5B,C","sources":["webpack:///./src/data-providers/visual-builder-preview/inspector.ts","webpack:///./src/data-providers/visual-builder-preview/collectUsedContracts.ts","webpack:///./src/data-providers/visual-builder-preview/realTimeDataInspect.ts","webpack:///./src/data-providers/visual-builder-preview/connect.ts","webpack:///./src/data-providers/visual-builder-preview/capture.ts","webpack:///./src/data-providers/visual-builder-preview/resizeScreenshot.ts"],"sourcesContent":["// istanbul ignore file: working in progress\n// https://github.com/facebook/react/blob/cae635054e17a6f107a39d328649137b83f25972/packages/react-devtools-shared/src/backend/views/Highlighter/index.js\nimport { throttle } from \"lodash\";\nimport type {\n  PreviewMessagePreviewerHoverOnBrick,\n  PreviewMessagePreviewerSelectBrick,\n  PreviewMessagePreviewerContextMenuOnBrick,\n} from \"./interfaces.js\";\n\nexport let previewProxyOrigin: string;\n\nexport function setPreviewFromOrigin(origin: string): void {\n  previewProxyOrigin = origin;\n}\n\nexport function startInspecting(): void {\n  registerListeners();\n}\n\nexport function stopInspecting(): void {\n  unregisterListeners();\n}\n\nfunction registerListeners(): void {\n  window.addEventListener(\"click\", onClick, true);\n  window.addEventListener(\"mousedown\", onMouseEvent, true);\n  window.addEventListener(\"mouseover\", onMouseEvent, true);\n  window.addEventListener(\"mouseup\", onMouseEvent, true);\n  window.addEventListener(\"pointerdown\", onPointerDown, true);\n  window.addEventListener(\"pointermove\", onPointerMove, true);\n  window.addEventListener(\"pointerup\", onMouseEvent, true);\n  window.addEventListener(\"pointerleave\", onPointerLeave, true);\n  window.addEventListener(\"contextmenu\", onContextMenu, true);\n}\n\nfunction unregisterListeners(): void {\n  window.removeEventListener(\"click\", onClick, true);\n  window.removeEventListener(\"mousedown\", onMouseEvent, true);\n  window.removeEventListener(\"mouseover\", onMouseEvent, true);\n  window.removeEventListener(\"mouseup\", onMouseEvent, true);\n  window.removeEventListener(\"pointerdown\", onPointerDown, true);\n  window.removeEventListener(\"pointermove\", onPointerMove, true);\n  window.removeEventListener(\"pointerup\", onMouseEvent, true);\n  window.removeEventListener(\"pointerleave\", onPointerLeave, true);\n  window.removeEventListener(\"contextmenu\", onContextMenu, true);\n}\n\nfunction onClick(event: MouseEvent): void {\n  event.preventDefault();\n  event.stopPropagation();\n  selectBrick(event.composedPath());\n}\n\nfunction onMouseEvent(event: MouseEvent): void {\n  event.preventDefault();\n  event.stopPropagation();\n}\n\nconst hoverOnBrick = throttle(\n  (eventTargets: EventTarget[]) => {\n    const iidList = getPossibleBrickTargets(eventTargets);\n\n    if (iidList.length > 0) {\n      window.parent.postMessage(\n        {\n          sender: \"previewer\",\n          type: \"hover-on-brick\",\n          iidList,\n        } as PreviewMessagePreviewerHoverOnBrick,\n        previewProxyOrigin\n      );\n    }\n  },\n  100,\n  { leading: false }\n);\n\nfunction onPointerDown(event: MouseEvent): void {\n  event.preventDefault();\n  event.stopPropagation();\n  hoverOnBrick(event.composedPath());\n}\n\nfunction onPointerMove(event: MouseEvent): void {\n  event.preventDefault();\n  event.stopPropagation();\n  hoverOnBrick(event.composedPath());\n}\n\nfunction onPointerLeave(event: MouseEvent): void {\n  event.preventDefault();\n  event.stopPropagation();\n  window.parent.postMessage(\n    {\n      sender: \"previewer\",\n      type: \"hover-on-brick\",\n      iidList: [],\n    } as PreviewMessagePreviewerHoverOnBrick,\n    previewProxyOrigin\n  );\n}\n\nfunction onContextMenu(event: MouseEvent): void {\n  event.preventDefault();\n  event.stopPropagation();\n  contextMenuOnBrick(event.composedPath(), {\n    x: event.clientX,\n    y: event.clientY,\n  });\n}\n\nfunction contextMenuOnBrick(\n  eventTargets: EventTarget[],\n  position: {\n    x: number;\n    y: number;\n  }\n): void {\n  const iidList = getPossibleBrickTargets(eventTargets);\n  if (iidList.length > 0) {\n    window.parent.postMessage(\n      {\n        sender: \"previewer\",\n        type: \"context-menu-on-brick\",\n        iidList,\n        position,\n      } as PreviewMessagePreviewerContextMenuOnBrick,\n      previewProxyOrigin\n    );\n  }\n}\n\nfunction selectBrick(eventTargets: EventTarget[]): void {\n  const iidList = getPossibleBrickTargets(eventTargets);\n  if (iidList.length > 0) {\n    window.parent.postMessage(\n      {\n        sender: \"previewer\",\n        type: \"select-brick\",\n        iidList,\n      } as PreviewMessagePreviewerSelectBrick,\n      previewProxyOrigin\n    );\n  }\n}\n\nexport function getPossibleBrickIidList(brick: HTMLElement): string[] {\n  const iidList: string[] = [];\n  // Traverse from bottom to up, to find bricks current hover on.\n  let cursor: HTMLElement | null = brick;\n  while (cursor) {\n    if (typeof cursor.dataset.iid === \"string\") {\n      iidList.push(cursor.dataset.iid);\n    }\n    cursor = cursor.parentElement;\n  }\n  return iidList;\n}\n\nexport function getPossibleBrickTargets(eventTargets: EventTarget[]) {\n  const targets: string[] = [];\n  for (const target of eventTargets) {\n    if (\n      target instanceof HTMLElement &&\n      typeof target.dataset.iid === \"string\"\n    ) {\n      targets.push(target.dataset.iid);\n    }\n  }\n  return targets;\n}\n","import {\n  type StoryboardNode,\n  parseStoryboard,\n  traverse,\n} from \"@next-core/storyboard\";\nimport {\n  Storyboard,\n  UseProviderResolveConf,\n  UseProviderEventHandler,\n} from \"@next-core/types\";\n\nfunction collect(nodeOrNodes: StoryboardNode | StoryboardNode[]): Set<string> {\n  const collection = new Set<string>();\n\n  traverse(nodeOrNodes, (node) => {\n    switch (node.type) {\n      case \"Resolvable\":\n      case \"EventHandler\": {\n        const useProvider = (\n          node.raw as UseProviderResolveConf | UseProviderEventHandler\n        )?.useProvider;\n        if (useProvider) {\n          collection.add(useProvider);\n        }\n      }\n    }\n  });\n\n  return collection;\n}\n\nexport function collectUsedContracts(storyboard: Storyboard): string[] {\n  const collection = collect(parseStoryboard(storyboard as any));\n\n  const contracts = [];\n\n  for (const item of collection) {\n    if (item.includes(\"@\")) {\n      contracts.push(item);\n    }\n  }\n\n  return contracts;\n}\n","export function getRealTimeDataAnnotation(value: unknown) {\n  const type = typeof value;\n  switch (type) {\n    case \"string\":\n    case \"boolean\":\n    case \"number\":\n      return {\n        type,\n        value,\n      };\n    case \"undefined\":\n      return { type };\n  }\n  if (value === null) {\n    return { type: \"null\" };\n  }\n  if (Array.isArray(value)) {\n    return { type: \"array\", length: value.length };\n  }\n  return { type: \"object\" };\n}\n","import {\n  getHistory as _getHistory,\n  getBasePath,\n  matchPath as _matchPath,\n  __secret_internals as _internals,\n  type NextLocation,\n} from \"@next-core/runtime\";\nimport { HttpResponseError } from \"@next-core/http\";\nimport { flowApi as _flowAPi } from \"@next-core/easyops-runtime\";\nimport type {\n  BrickConf,\n  Contract,\n  CustomTemplate,\n  RouteConf,\n} from \"@next-core/types\";\nimport { isEmpty, throttle, omit } from \"lodash\";\nimport type {\n  BrickOutline,\n  HighLightNode,\n  Position,\n  PreviewDataOption,\n  PreviewMessageFromPreviewer,\n  PreviewMessagePreviewContractUpdate,\n  PreviewMessagePreviewDataValueError,\n  PreviewMessagePreviewDataValueSuccess,\n  PreviewMessagePreviewDebugValueSuccess,\n  PreviewMessagePreviewDebugValueError,\n  PreviewMessagePreviewerCaptureFailed,\n  PreviewMessagePreviewerCaptureOk,\n  PreviewMessagePreviewerContentScroll,\n  PreviewMessagePreviewerHighlightBrick,\n  PreviewMessagePreviewerHighlightContext,\n  PreviewMessagePreviewerHoverOnMain,\n  PreviewMessagePreviewerRealTimeDataInspectChange,\n  PreviewMessagePreviewerRouteMatchChange,\n  PreviewMessagePreviewerScroll,\n  PreviewMessagePreviewerUrlChange,\n  PreviewMessageToPreviewer,\n  PreviewSettings,\n  PreviewStartOptions,\n  PreviewDebugData,\n  PreviewMessagePreviewInspectRuntimeValue,\n} from \"./interfaces.js\";\nimport { capture } from \"./capture.js\";\nimport {\n  previewProxyOrigin,\n  getPossibleBrickIidList,\n  setPreviewFromOrigin,\n  startInspecting,\n  stopInspecting,\n} from \"./inspector.js\";\nimport { collectUsedContracts } from \"./collectUsedContracts.js\";\nimport { getRealTimeDataAnnotation } from \"./realTimeDataInspect.js\";\n\nlet connected = false;\n\ninterface DLL {\n  (moduleId: \"tYg3\"): {\n    getHistory: typeof _getHistory;\n    developHelper: typeof _internals;\n    collectDebugContract: typeof flowApi.collectDebugContract;\n  };\n  (moduleId: \"A+yw\"): {\n    matchPath: typeof _matchPath;\n  };\n}\n\nlet getHistory = _getHistory;\nlet matchPath = _matchPath;\nlet __secret_internals = _internals;\nlet flowApi = _flowAPi;\nlet isV2 = false;\n\n// istanbul ignore next\n// Make v3 bricks compatible with Brick Next v2.\ntry {\n  const dll = (window as unknown as { dll?: DLL }).dll;\n  if (\n    dll &&\n    window.BRICK_NEXT_VERSIONS?.[\"brick-container\"]?.startsWith(\"2.\")\n  ) {\n    const {\n      getHistory: getHistoryV2,\n      developHelper: developHelperV2,\n      collectDebugContract,\n    } = dll(\"tYg3\");\n    const { matchPath: matchPathV2 } = dll(\"A+yw\");\n    getHistory = getHistoryV2;\n    matchPath = matchPathV2;\n    // The `__secret_internals` of v3 has pretty the same API as\n    // `developHelper` of v2, especially those for preview usage.\n    __secret_internals = {\n      ...developHelperV2,\n      getContextValue(name, { tplStateStoreId }) {\n        return developHelperV2.getContextValue(name, {\n          tplContextId: tplStateStoreId,\n        } as any);\n      },\n      getAllContextValues({ tplStateStoreId }) {\n        // V3 returns an object of key-value.\n        // While v2 returns a map of ContextItem.\n        const v2Map = developHelperV2.getAllContextValues({\n          tplContextId: tplStateStoreId,\n        } as any) as unknown as Map<string, { value: unknown }>;\n        return Object.fromEntries(\n          [...v2Map].map(([k, v]) => [k, (v as any).value])\n        );\n      },\n      debugDataValue(data, { tplStateStoreId }) {\n        return developHelperV2.debugDataValue(data, {\n          tplContextId: tplStateStoreId,\n        } as any);\n      },\n    };\n\n    flowApi = {\n      collectDebugContract,\n    } as any;\n    isV2 = true;\n  }\n} catch (e) {\n  // eslint-disable-next-line no-console\n  console.error(\"Try to use v2 runtime APIs failed:\", e);\n}\n\nlet contentScrollElement: Element | null = null;\nlet contentScrollHost: Element | null = null;\n\nexport default async function connect(\n  previewFromOrigin: string,\n  options: PreviewStartOptions\n) {\n  if (connected) {\n    return;\n  }\n  connected = true;\n\n  const sendMessage = <T extends PreviewMessageFromPreviewer>(\n    message: Omit<T, \"sender\">\n  ): void => {\n    window.parent.postMessage(\n      {\n        sender: \"previewer\",\n        ...message,\n      },\n      previewFromOrigin\n    );\n  };\n\n  sendMessage({ type: \"preview-started\" });\n  setPreviewFromOrigin(previewFromOrigin);\n\n  let hoverIid: string;\n  let hoverAlias: string;\n  let activeIid: string;\n  let activeAlias: string;\n\n  const handleHoverOnIframe = (pos: Position): void => {\n    const element = document.elementFromPoint(pos.x, pos.y);\n    if (element?.tagName === \"BODY\") {\n      window.parent.postMessage(\n        {\n          sender: \"previewer\",\n          type: \"hover-on-main\",\n          isDirection: true,\n          position: {\n            x: pos.x,\n            y: pos.y,\n          },\n        } as PreviewMessagePreviewerHoverOnMain,\n        previewProxyOrigin\n      );\n    } else {\n      const iidList = getPossibleBrickIidList(element as HTMLElement);\n      window.parent.postMessage(\n        {\n          sender: \"previewer\",\n          type: \"hover-on-brick\",\n          iidList,\n          isDirection: true,\n          position: {\n            x: pos.x,\n            y: pos.y,\n          },\n        },\n        previewProxyOrigin\n      );\n    }\n  };\n\n  const sendHighlightBrickOutlines = (\n    type: \"hover\" | \"active\",\n    iid: string,\n    alias: string\n  ): void => {\n    const outlines = getBrickOutlines(iid);\n    sendMessage<PreviewMessagePreviewerHighlightBrick>({\n      type: \"highlight-brick\",\n      highlightType: type,\n      outlines,\n      iid: iid,\n      alias: alias,\n    });\n  };\n\n  const sendHighlightBricksOutlines = (nodes: HighLightNode[]): void => {\n    const outlines = nodes\n      .map((node) => getBrickOutlines(node.iid, node.alias))\n      .flat();\n    sendMessage<PreviewMessagePreviewerHighlightContext>({\n      type: \"highlight-context\",\n      outlines,\n    });\n  };\n\n  let lastTemplatePreviewSettings: PreviewSettings | undefined;\n  if (options.templateId) {\n    lastTemplatePreviewSettings = options.settings;\n  }\n\n  const updateTemplatePreviewSettings = (): void => {\n    __secret_internals.updateTemplatePreviewSettings(\n      options.appId,\n      options.templateId!,\n      lastTemplatePreviewSettings\n    );\n    getHistory().reload();\n  };\n\n  const updateSnippetPreviewSettings = (): void => {\n    __secret_internals.updateSnippetPreviewSettings(\n      options.appId,\n      JSON.parse(options.snippetData)\n    );\n    getHistory().reload();\n  };\n\n  const updateFormPreviewSettings = (): void => {\n    (__secret_internals as any).updateFormPreviewSettings(\n      options.appId,\n      options.formId,\n      options.formData\n    );\n    getHistory().reload();\n  };\n\n  const handlePreviewData = (name: string, option: PreviewDataOption): void => {\n    try {\n      const { dataType } = option;\n      let tplStateStoreId;\n\n      if (dataType === \"state\") {\n        tplStateStoreId = getRootTplStateStoreId();\n\n        if (!tplStateStoreId) {\n          sendMessage<PreviewMessagePreviewDataValueError>({\n            type: \"inspect-data-value-error\",\n            data: {\n              error: {\n                message:\n                  \"tplStateStoreId not found, unable to preview STATE value\",\n              },\n            },\n          });\n\n          return;\n        }\n      }\n\n      let value, type: PreviewMessagePreviewDataValueSuccess[\"type\"];\n      if (name) {\n        type = \"inspect-single-data-value-success\";\n        value = __secret_internals.getContextValue(name, {\n          tplStateStoreId,\n        });\n      } else {\n        type = \"inspect-all-data-values-success\";\n        const data = __secret_internals.getAllContextValues({\n          tplStateStoreId,\n        });\n        value = Object.entries(data).map(([name, value]) => ({ name, value }));\n      }\n\n      sendMessage<PreviewMessagePreviewDataValueSuccess>({\n        type,\n        data: {\n          name,\n          value,\n        },\n      });\n\n      // istanbul ignore next\n    } catch (error) {\n      sendMessage<PreviewMessagePreviewDataValueError>({\n        type: \"inspect-data-value-error\",\n        data: {\n          message: (error as Error).message,\n        },\n      });\n    }\n  };\n\n  const debugDataValue = async (\n    data: PreviewDebugData,\n    contractData: Contract,\n    previewOption: PreviewDataOption\n  ) => {\n    try {\n      if (contractData) {\n        flowApi.collectDebugContract([contractData]);\n      }\n      const value = await __secret_internals.debugDataValue(data, {\n        tplStateStoreId:\n          previewOption.dataType === \"state\"\n            ? getRootTplStateStoreId()\n            : undefined,\n        routeId: options.routeId,\n      });\n\n      sendMessage<PreviewMessagePreviewDebugValueSuccess>({\n        type: \"debug-data-value-success\",\n        data: {\n          debugConf: data,\n          value,\n        },\n      });\n    } catch (error) {\n      sendMessage<PreviewMessagePreviewDebugValueError>({\n        type: \"debug-data-value-error\",\n        data:\n          error instanceof HttpResponseError\n            ? error.responseJson\n            : { message: (error as Error).message },\n      });\n    }\n  };\n\n  const history = getHistory();\n\n  window.addEventListener(\n    \"message\",\n    async ({ data, origin }: MessageEvent<PreviewMessageToPreviewer>) => {\n      if (\n        origin !== previewFromOrigin ||\n        !data ||\n        data.sender !== \"preview-container\"\n      ) {\n        return;\n      }\n      if (data.forwardedFor === \"builder\") {\n        switch (data.type) {\n          case \"hover-on-brick\":\n            hoverIid = data.iid;\n            hoverAlias = data.alias;\n            sendHighlightBrickOutlines(\"hover\", data.iid, data.alias);\n            break;\n          case \"hover-on-main\":\n            sendHighlightBrickOutlines(\"hover\", \"#main-mount-point\", \"root\");\n            break;\n          case \"hover-on-context\":\n            sendHighlightBricksOutlines(data.highlightNodes);\n            break;\n          case \"select-brick\":\n            activeIid = data.iid;\n            activeAlias = data.alias;\n            sendHighlightBrickOutlines(\"active\", data.iid, data.alias);\n            break;\n          case \"hover-on-iframe\":\n            handleHoverOnIframe(data.position);\n            break;\n        }\n      } else\n        switch (data.type) {\n          case \"toggle-inspecting\":\n            data.enabled ? startInspecting() : stopInspecting();\n            break;\n          case \"refresh\":\n            if (data.options?.updateStoryboardType) {\n              if (data.options.updateStoryboardType === \"route\") {\n                __secret_internals.updateStoryboardByRoute(\n                  options.appId,\n                  data.storyboardPatch as RouteConf\n                );\n              } else if (data.options.updateStoryboardType === \"template\") {\n                __secret_internals.updateStoryboardByTemplate(\n                  options.appId,\n                  data.storyboardPatch as CustomTemplate,\n                  data.options.settings\n                );\n              } else if (data.options.updateStoryboardType === \"snippet\") {\n                __secret_internals.updateStoryboardBySnippet(\n                  options.appId,\n                  data.storyboardPatch as {\n                    snippetId: string;\n                    bricks: BrickConf[];\n                  }\n                );\n              } else if (data.options.updateStoryboardType === \"form\") {\n                (__secret_internals as any).updateFormPreviewSettings(\n                  options.appId,\n                  options.formId,\n                  data.storyboardPatch\n                );\n              }\n\n              let newContracts;\n              if (data.options?.updateStoryboardType !== \"form\") {\n                newContracts = await (\n                  __secret_internals as any\n                ).getAddedContracts?.(data.storyboardPatch, {\n                  appId: options.appId,\n                  updateStoryboardType: data.options.updateStoryboardType,\n                  formId: options.formId,\n                  collectUsedContracts,\n                });\n              }\n\n              if (!isEmpty(newContracts)) {\n                sendMessage<PreviewMessagePreviewContractUpdate>({\n                  type: \"contract-update\",\n                  data: {\n                    add: newContracts,\n                  },\n                });\n              } else {\n                getHistory().reload();\n              }\n\n              break;\n            }\n            __secret_internals.updateStoryboard(\n              options.appId,\n              data.storyboardPatch\n            );\n            if (options.templateId) {\n              lastTemplatePreviewSettings = data.settings;\n              updateTemplatePreviewSettings();\n            } else if (options.formId || options.formData) {\n              updateFormPreviewSettings();\n            } else if (data.options?.snippetData) {\n              options.snippetData = data.options.snippetData;\n              updateSnippetPreviewSettings();\n            } else {\n              getHistory().reload();\n            }\n            break;\n          case \"reload\":\n            location.reload();\n            break;\n          case \"back\":\n            history.goBack();\n            break;\n          case \"forward\":\n            history.goForward();\n            break;\n          case \"capture\":\n            capture(data.maxWidth, data.maxHeight).then(\n              (screenshot) => {\n                sendMessage<PreviewMessagePreviewerCaptureOk>({\n                  type: \"capture-ok\",\n                  screenshot,\n                });\n              },\n              () => {\n                sendMessage<PreviewMessagePreviewerCaptureFailed>({\n                  type: \"capture-failed\",\n                });\n              }\n            );\n            break;\n          case \"inspect-data-value\":\n            handlePreviewData(data.name, data.option);\n            break;\n          case \"update-preview-url\": {\n            // Remove origin first.\n            const url = data.previewUrl.startsWith(window.origin)\n              ? data.previewUrl.substring(window.origin.length)\n              : data.previewUrl;\n            // Then remove base path.\n            const basePath = getBasePath();\n            const to = url.startsWith(basePath)\n              ? url.substring(basePath.length - 1)\n              : url;\n            getHistory().push(to);\n            break;\n          }\n          case \"update-preview-route\": {\n            options.routePath = data.routePath;\n            options.routeExact = data.routeExact;\n            syncRouteMatch();\n            break;\n          }\n          case \"debug-data-value\":\n            debugDataValue(data.debugData, data.contractData, data.options);\n            break;\n          case \"excute-proxy-method\": {\n            const [ref, method, args = []] = data.proxyMethodArgs;\n            try {\n              const result = document.body.querySelector(ref)[method](...args);\n              window.parent.postMessage({\n                sender: \"previewer\",\n                type: \"excute-proxy-method-success\",\n                data: { method: method, res: result },\n              });\n            } catch (err) {\n              window.parent.postMessage({\n                sender: \"previewer\",\n                type: \"excute-proxy-method-error\",\n                data: { method: method, res: (err as Error).message },\n              });\n            }\n            break;\n          }\n        }\n    }\n  );\n\n  window.addEventListener(\"scroll\", () => {\n    sendMessage<PreviewMessagePreviewerScroll>({\n      type: \"scroll\",\n      scroll: {\n        x: window.scrollX,\n        y: window.scrollY,\n      },\n    });\n  });\n\n  let previewPageMatch = true;\n  let currentLocation: NextLocation;\n  const sendLocationChange = (loc: NextLocation): void => {\n    sendMessage<PreviewMessagePreviewerUrlChange>({\n      type: \"url-change\",\n      url: location.origin + history.createHref(loc),\n    });\n    currentLocation = loc;\n    syncRouteMatch();\n  };\n\n  function syncRouteMatch() {\n    if (options.routePath) {\n      const match = !!matchPath(currentLocation.pathname, {\n        path: options.routePath,\n        exact: options.routeExact,\n      });\n      sendMessage<PreviewMessagePreviewerRouteMatchChange>({\n        type: \"route-match-change\",\n        match,\n      });\n\n      // Re-update template preview settings once match route again (typically after login).\n      if (options.templateId && !previewPageMatch && match) {\n        const mainMountPoint = document.querySelector(\"#main-mount-point\")!;\n        const placeholderLoadObserver = new MutationObserver(() => {\n          // We observe when the placeholder is appeared.\n          if (\n            mainMountPoint.childNodes.length === 1 &&\n            (mainMountPoint.firstChild as HTMLElement).tagName === \"SPAN\" &&\n            mainMountPoint.firstChild!.childNodes.length === 0\n          ) {\n            updateTemplatePreviewSettings();\n            placeholderLoadObserver.disconnect();\n          }\n        });\n        placeholderLoadObserver.observe(mainMountPoint, { childList: true });\n      }\n      if (options.formId && !previewPageMatch && match) {\n        const mainMountPoint = document.querySelector(\"#main-mount-point\")!;\n        const placeholderLoadObserver = new MutationObserver(() => {\n          // We observe when the placeholder is appeared.\n          if (\n            mainMountPoint.childNodes.length === 1 &&\n            (mainMountPoint.firstChild as HTMLElement).tagName === \"SPAN\" &&\n            mainMountPoint.firstChild!.childNodes.length === 0\n          ) {\n            updateFormPreviewSettings();\n            placeholderLoadObserver.disconnect();\n          }\n        });\n        placeholderLoadObserver.observe(mainMountPoint, { childList: true });\n      }\n      if (options.snippetData && !previewPageMatch && match) {\n        const mainMountPoint = document.querySelector(\"#main-mount-point\")!;\n        const placeholderLoadObserver = new MutationObserver(() => {\n          // We observe when the placeholder is appeared.\n          if (\n            mainMountPoint.childNodes.length === 1 &&\n            (mainMountPoint.firstChild as HTMLElement).tagName === \"SPAN\" &&\n            mainMountPoint.firstChild!.childNodes.length === 0\n          ) {\n            updateSnippetPreviewSettings();\n            placeholderLoadObserver.disconnect();\n          }\n        });\n        placeholderLoadObserver.observe(mainMountPoint, { childList: true });\n      }\n      previewPageMatch = match;\n    }\n  }\n\n  sendLocationChange(history.location);\n\n  history.listen(sendLocationChange);\n\n  if (options.templateId) {\n    updateTemplatePreviewSettings();\n  }\n\n  if (options.formId || options.formData) {\n    updateFormPreviewSettings();\n  }\n\n  if (options.snippetData) {\n    updateSnippetPreviewSettings();\n  }\n\n  function setupContentScroll() {\n    const host = document.querySelector(\"eo-page-view\");\n    const element = host?.shadowRoot?.querySelector(\".content\") ?? null;\n    if (element !== contentScrollElement) {\n      contentScrollElement?.removeEventListener(\"scroll\", onContentScroll);\n      element?.addEventListener(\"scroll\", onContentScroll);\n      contentScrollElement = element;\n      contentScrollHost = host;\n    }\n  }\n\n  function onContentScroll(this: Element) {\n    sendMessage<PreviewMessagePreviewerContentScroll>({\n      type: \"content-scroll\",\n      scroll: {\n        x: this.scrollLeft,\n        y: this.scrollTop,\n      },\n    });\n  }\n\n  const setupRuntimeValueInspect = () => {\n    const routeId = options.routeId;\n\n    const data = __secret_internals.getLegalRuntimeValue({ routeId });\n    sendMessage<PreviewMessagePreviewInspectRuntimeValue>({\n      type: \"inspect-runtime-data-value\",\n      data: {\n        ...omit(data, \"query\"),\n        query: data.query ? Object.fromEntries(data.query.entries()) : {},\n        path: data.match?.params,\n      },\n    });\n  };\n\n  __secret_internals.addRealTimeDataInspectHook?.(\n    ({ changeType, tplStateStoreId, detail }) => {\n      sendMessage<PreviewMessagePreviewerRealTimeDataInspectChange>({\n        type: \"real-time-data-inspect-change\",\n        changeType,\n        tplStateStoreId,\n        detail:\n          changeType === \"update\"\n            ? {\n                name: detail.name,\n                annotation: getRealTimeDataAnnotation(detail.value),\n              }\n            : {\n                data: Object.fromEntries(\n                  Object.entries(detail.data).map(([k, v]) => [\n                    k,\n                    getRealTimeDataAnnotation(v),\n                  ])\n                ),\n              },\n      });\n    }\n  );\n\n  let memoizedRootTplStateStoreId: string | undefined;\n\n  function setupRealTimeDataInspect(force?: boolean) {\n    const tplStateStoreId = options.templateId\n      ? getRootTplStateStoreId()\n      : undefined;\n    if (memoizedRootTplStateStoreId !== tplStateStoreId || force) {\n      memoizedRootTplStateStoreId = tplStateStoreId;\n      __secret_internals.setRealTimeDataInspectRoot?.({\n        tplStateStoreId,\n      });\n    }\n  }\n\n  window.addEventListener(\"route.render\", () => {\n    setupRealTimeDataInspect(true);\n    setupRuntimeValueInspect();\n  });\n\n  setupContentScroll();\n  setupRealTimeDataInspect(true);\n  setupRuntimeValueInspect();\n\n  const mutationCallback = (): void => {\n    setupContentScroll();\n    setupRealTimeDataInspect();\n    if (hoverIid) {\n      sendHighlightBrickOutlines(\"hover\", hoverIid, hoverAlias);\n    }\n    if (activeIid) {\n      sendHighlightBrickOutlines(\"active\", activeIid, activeAlias);\n    }\n  };\n  const mutationObserver = new MutationObserver(\n    throttle(mutationCallback, 100, { leading: false })\n  );\n  mutationObserver.observe(document.body, { subtree: true, childList: true });\n}\n\nfunction getBrickOutlines(iid: string, alias?: string): BrickOutline[] {\n  if (!iid) {\n    return [];\n  }\n  const isRoot = iid.includes(\"#\");\n  const elements = getElementsIncludingInShadowDOM(iid, isRoot);\n  const outlines = getOutlines(elements, alias);\n  return isRoot\n    ? outlines.map((item) => ({\n        ...item,\n        height: window.innerHeight - item.top,\n      }))\n    : outlines;\n}\n\nexport function getElementsIncludingInShadowDOM(\n  iid: string,\n  isRoot?: boolean\n): HTMLElement[] {\n  const elements: HTMLElement[] = [];\n\n  function walk(root: Document | ShadowRoot) {\n    const candidates = root.querySelectorAll<HTMLElement>(\n      isRoot ? iid : `[data-iid=\"${iid}\"]`\n    );\n    elements.push(...candidates);\n\n    // If elements are found in the document, we should stop searching in shadow DOM.\n    if (root === document && candidates.length > 0) {\n      return;\n    }\n\n    // These useBrick in v3 bricks will be inside shadow DOM.\n    for (const item of root.querySelectorAll(\"*\")) {\n      if (item.shadowRoot) {\n        walk(item.shadowRoot);\n      }\n    }\n  }\n\n  walk(document);\n\n  return elements;\n}\n\nfunction getOutlines(elements: HTMLElement[], alias?: string): BrickOutline[] {\n  return elements.map((element) => {\n    const hasContentScroll = contentScrollHost?.contains(element);\n    const { width, height, left, top } = element.getBoundingClientRect();\n    return {\n      width,\n      height,\n      left:\n        left +\n        window.scrollX +\n        (hasContentScroll ? (contentScrollElement?.scrollLeft ?? 0) : 0),\n      top:\n        top +\n        window.scrollY +\n        (hasContentScroll ? (contentScrollElement?.scrollTop ?? 0) : 0),\n      alias,\n      hasContentScroll,\n    };\n  });\n}\n\nfunction getRootTplStateStoreId(): string | undefined {\n  const mainMountPoint = document.querySelector(\"#main-mount-point\")!;\n\n  return (mainMountPoint?.firstChild as HTMLElement)?.dataset[\n    isV2 ? \"tplContextId\" : \"tplStateStoreId\"\n  ];\n}\n","// istanbul ignore file: nothing logical except calling html2canvas.\nimport html2canvas from \"html2canvas\";\nimport { resizeScreenshot } from \"./resizeScreenshot.js\";\n\nfunction getCanvasBlob(canvas: HTMLCanvasElement): Promise<Blob> {\n  return new Promise(function (resolve, reject) {\n    canvas.toBlob(function (blob: Blob | null) {\n      if (blob) {\n        resolve(blob);\n      } else {\n        reject();\n      }\n    });\n  });\n}\n\nexport async function capture(\n  maxWidth: number,\n  maxHeight: number\n): Promise<Blob> {\n  const sourceCanvas = await html2canvas(document.body, {\n    logging: false,\n    scale: 1,\n    width: window.innerWidth,\n    height: window.innerHeight,\n    foreignObjectRendering: true,\n  });\n  const targetCanvas = document.createElement(\"canvas\");\n  resizeScreenshot(sourceCanvas, targetCanvas, maxWidth, maxHeight);\n  const blob = await getCanvasBlob(targetCanvas);\n  return blob;\n}\n","export function resizeScreenshot(\n  canvas: HTMLCanvasElement,\n  targetCanvas: HTMLCanvasElement,\n  maxWidth: number,\n  maxHeight: number\n): string {\n  const targetRatio = maxWidth / maxHeight;\n  const { width, height } = canvas;\n  const ratio = width / height;\n  const wider = ratio >= targetRatio;\n  const finalWidth = wider ? maxWidth : maxHeight * ratio;\n  const finalHeight = wider ? maxWidth / ratio : maxHeight;\n  targetCanvas.width = finalWidth;\n  targetCanvas.height = finalHeight;\n\n  const ctx = targetCanvas.getContext(\"2d\")!;\n  ctx.drawImage(canvas, 0, 0, width, height, 0, 0, finalWidth, finalHeight);\n  return targetCanvas.toDataURL();\n}\n"],"names":["previewProxyOrigin","onClick","event","preventDefault","stopPropagation","eventTargets","iidList","getPossibleBrickTargets","length","window","parent","postMessage","sender","type","selectBrick","composedPath","onMouseEvent","hoverOnBrick","throttle","leading","onPointerDown","onPointerMove","onPointerLeave","onContextMenu","position","contextMenuOnBrick","x","clientX","y","clientY","targets","target","HTMLElement","dataset","iid","push","collectUsedContracts","storyboard","collection","nodeOrNodes","Set","traverse","node","_node$raw","useProvider","raw","add","collect","parseStoryboard","contracts","item","includes","getRealTimeDataAnnotation","value","Array","isArray","connected","getHistory","_getHistory","matchPath","_matchPath","__secret_internals","_internals","flowApi","_flowAPi","isV2","_window$BRICK_NEXT_VE","dll","BRICK_NEXT_VERSIONS","startsWith","getHistoryV2","developHelper","developHelperV2","collectDebugContract","matchPathV2","getContextValue","name","_ref","tplStateStoreId","tplContextId","getAllContextValues","_ref2","v2Map","Object","fromEntries","map","_ref3","k","v","debugDataValue","data","_ref4","e","console","error","contentScrollElement","contentScrollHost","async","connect","previewFromOrigin","options","_secret_internals$ad","_secret_internals","sendMessage","message","hoverIid","hoverAlias","activeIid","activeAlias","sendHighlightBrickOutlines","alias","outlines","getBrickOutlines","highlightType","lastTemplatePreviewSettings","templateId","settings","updateTemplatePreviewSettings","appId","reload","updateSnippetPreviewSettings","JSON","parse","snippetData","updateFormPreviewSettings","formId","formData","history","addEventListener","_data$options","_data$options3","origin","_ref6","forwardedFor","nodes","flat","sendHighlightBricksOutlines","highlightNodes","pos","element","document","elementFromPoint","tagName","isDirection","brick","cursor","parentElement","getPossibleBrickIidList","handleHoverOnIframe","enabled","removeEventListener","updateStoryboardType","_data$options2","newContracts","_getAddedContracts","_ref7","updateStoryboardByRoute","storyboardPatch","updateStoryboardByTemplate","updateStoryboardBySnippet","getAddedContracts","call","isEmpty","updateStoryboard","location","goBack","goForward","maxWidth","maxHeight","sourceCanvas","html2canvas","body","logging","scale","width","innerWidth","height","innerHeight","foreignObjectRendering","targetCanvas","createElement","canvas","targetRatio","ratio","wider","finalWidth","finalHeight","getContext","drawImage","toDataURL","resizeScreenshot","Promise","resolve","reject","toBlob","blob","capture","then","screenshot","handlePreviewData","option","dataType","getRootTplStateStoreId","entries","_ref5","url","previewUrl","substring","basePath","getBasePath","to","routePath","routeExact","syncRouteMatch","contractData","previewOption","undefined","routeId","debugConf","HttpResponseError","responseJson","debugData","ref","method","args","proxyMethodArgs","result","querySelector","res","err","scroll","scrollX","scrollY","currentLocation","previewPageMatch","sendLocationChange","loc","createHref","match","pathname","path","exact","mainMountPoint","placeholderLoadObserver","MutationObserver","childNodes","firstChild","disconnect","observe","childList","setupContentScroll","_host$shadowRoot","host","shadowRoot","_contentScrollElement","onContentScroll","this","scrollLeft","scrollTop","listen","setupRuntimeValueInspect","_data$match","getLegalRuntimeValue","omit","query","params","memoizedRootTplStateStoreId","setupRealTimeDataInspect","force","_secret_internals$se","_secret_internals2","setRealTimeDataInspectRoot","addRealTimeDataInspectHook","_ref8","changeType","detail","annotation","_ref9","mutationCallback","subtree","isRoot","elements","walk","root","candidates","querySelectorAll","getElementsIncludingInShadowDOM","_contentScrollHost","_contentScrollElement2","_contentScrollElement3","hasContentScroll","contains","left","top","getBoundingClientRect","getOutlines","_mainMountPoint$first"],"sourceRoot":""}