/*! For license information please see 793.b3d28d36.js.LICENSE.txt */
"use strict";(globalThis.webpackChunk_next_bricks_inject=globalThis.webpackChunk_next_bricks_inject||[]).push([[793],{2559:(e,t,n)=>{function o(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}n.d(t,{A:()=>o})},2016:(e,t,n)=>{function o(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}n.d(t,{A:()=>o})},829:(e,t,n)=>{n.d(t,{A:()=>r});var o=n(2559);function r(e,t){return e.get((0,o.A)(e,t))}},918:(e,t,n)=>{n.d(t,{A:()=>r});var o=n(2016);function r(e,t,n){(0,o.A)(e,t),t.set(e,n)}},6121:(e,t,n)=>{n.d(t,{A:()=>r});var o=n(2559);function r(e,t,n){return e.set((0,o.A)(e,t),n),n}},4635:(e,t,n)=>{n.d(t,{A:()=>r});var o=n(2016);function r(e,t){(0,o.A)(e,t),t.add(e)}},3793:(e,t,n)=>{n.r(t),n.d(t,{analytics:()=>u,auth:()=>ht,checkInstalledApps:()=>r,checkPermissions:()=>dt,flowApi:()=>i,menu:()=>s,messageDispatcher:()=>ft});var o={};n.r(o),n.d(o,{authenticate:()=>g,getAuth:()=>v,isLoggedIn:()=>w,logout:()=>A});var r={};n.r(r),n.d(r,{getCheckedApp:()=>re,preCheckInstalledApps:()=>ne,waitForCheckingApps:()=>oe});var i={};n.r(i),n.d(i,{FLOW_API_PROVIDER:()=>se,clearCollectWidgetContract:()=>Ae,clearDebugContract:()=>ye,collectContract:()=>ge,collectDebugContract:()=>we,collectWidgetContract:()=>ve,getArgsOfFlowApi:()=>Ie,isFlowApiProvider:()=>be,registerFlowApiProvider:()=>ue});var s={};n.r(s),n.d(s,{fetchMenuById:()=>Je,getMenuById:()=>Ge});var a={};n.r(a),n.d(a,{onRequest:()=>at,onResponse:()=>ct,onResponseError:()=>ut});var c={};n.r(c),n.d(c,{create:()=>pt});var u={};n.r(u),n.d(u,{http:()=>a,initialize:()=>it,pageView:()=>c});var l=n(4958);function p(e,t,n,o,r,i,s){try{var a=e[i](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(o,r)}function d(e){return function(){var t=this,n=arguments;return new Promise((function(o,r){var i=e.apply(t,n);function s(e){p(i,o,r,s,a,"next",e)}function a(e){p(i,o,r,s,a,"throw",e)}s(void 0)}))}}var f=n(108),h=function(){var e=d((function*(e,t){return(yield f.http.post("api/gateway/micro_app.permission.ValidatePermissions/api/micro_app/v1/permission/validate",e,t)).data}));return function(t,n){return e.apply(this,arguments)}}();const m={};function g(e){Object.assign(m,{org:e.org,username:e.username,userInstanceId:e.userInstanceId,loginFrom:e.loginFrom,accessRule:e.accessRule,isAdmin:e.isAdmin,csrfToken:e.csrfToken,license:e.license,accessToken:e.accessToken,userShowValue:e.userShowValue})}function v(){return{...m}}function A(){for(const e of Object.keys(m))m[e]=void 0;y.clear(),S.length=0,b.clear()}function w(){return void 0!==m.username}const y=new Map,S=[],b=new Map;function I(e){if(w()&&!v().isAdmin)return E((0,l.scanPermissionActionsInAny)(e))}async function E(e){const t=e.filter((e=>!S.includes(e)));if(0===t.length)return;const n=[],o=[];for(const e of t){const t=y.get(e);t?n.push(t):o.push(e)}if(o.length>0){const e=(async()=>{try{const e=await h({actions:o},{noAbortOnRouteChange:!0});for(const t of e.actions)b.set(t.action,t.authorizationStatus),"undefined"===t.authorizationStatus&&console.error(`Undefined permission action: "${t.action}"`)}catch(e){console.error("Pre-check permissions failed",e)}finally{S.push(...o)}})();for(const t of o)y.set(t,e);n.push(e)}await Promise.all(n)}var P=n(4635),k=n(918),O=n(2559);function M(e,t,n){return n((0,O.A)(e,t))}var C=n(6121),T=n(829),_=n(5223),N=n(1030);const j=1e3,$=5;var R=new WeakMap,D=new WeakMap,W=new WeakMap,x=new WeakMap,L=new WeakMap,U=new WeakMap,B=new WeakMap,F=new WeakSet;class q{constructor(e){(0,P.A)(this,F),(0,k.A)(this,R,void 0),(0,k.A)(this,D,void 0),(0,k.A)(this,W,[]),(0,k.A)(this,x,new Set),(0,k.A)(this,L,new Set),(0,k.A)(this,U,0),(0,k.A)(this,B,!1),(0,C.A)(R,this,e)}send(e){(0,T.A)(D,this)||(0,C.A)(D,this,(0,O.A)(F,this,z).call(this));const t=JSON.stringify(e);(0,T.A)(D,this).readyState===WebSocket.OPEN?(0,T.A)(D,this).send(t):(0,T.A)(W,this).push(t)}onMessage(e){(0,T.A)(x,this).add(e)}onClose(e){(0,T.A)(L,this).add(e)}reset(){(0,T.A)(W,this).length=0,(0,T.A)(x,this).clear(),(0,T.A)(L,this).clear()}close(){var e;(0,C.A)(B,this,!0),(null===(e=(0,T.A)(D,this))||void 0===e?void 0:e.readyState)===WebSocket.OPEN&&(0,T.A)(D,this).close()}}function z(){console.log("WebSocket connecting ...");const e=new WebSocket((0,T.A)(R,this));let t;return e.addEventListener("open",(n=>{console.log("WebSocket open:",n),t=setTimeout((()=>{t=void 0,(0,C.A)(U,this,0)}),1e3);for(const t of(0,T.A)(W,this))e.send(t);(0,T.A)(W,this).length=0})),e.addEventListener("close",(e=>{if(!(0,T.A)(B,this)){void 0!==t&&clearTimeout(t),console.log("WebSocket close:",e);for(const e of(0,T.A)(L,this))e();1e3!==e.code&&(0,O.A)(F,this,H).call(this)}})),e.addEventListener("error",(e=>{console.error("WebSocket error:",e)})),e.addEventListener("message",(e=>{const t=JSON.parse(e.data);for(const e of(0,T.A)(x,this))e(t)})),e}function H(){if((0,T.A)(U,this)>=$)return void console.error("WebSocket connect retry limit exceeded");const e=Math.pow(2,(0,T.A)(U,this))*j;console.log("WebSocket will reconnect after %d seconds",e/1e3),setTimeout((()=>{var e;(0,C.A)(U,this,(e=(0,T.A)(U,this),++e)),(0,C.A)(D,this,(0,O.A)(F,this,z).call(this))}),e)}var G=new WeakMap,J=new WeakMap,V=new WeakMap,Y=new WeakSet;function K(e){if(!(0,T.A)(G,e)){const t=`${"https:"===location.protocol?"wss:":"ws:"}//${window.location.host}${(0,_.getBasePath)()}api/websocket_service/v1/ws`;(0,C.A)(G,e,new q(t))}return(0,T.A)(G,e)}function Q(e,t,n,o){const r=(0,T.A)(J,this)[e].get(o);if(r)return r;const i={event:"sub"===e?"TOPIC.SUB":"TOPIC.UNSUB",payload:n},s=new Promise(((t,o)=>{const r=X(n);M(Y,this,K).onMessage((n=>{const i=n.event===("sub"===e?"TOPIC.SUB_SUCCESS":"TOPIC.UNSUB_SUCCESS"),s=n.event===("sub"===e?"TOPIC.SUB_FAILED":"TOPIC.UNSUB_FAILED");(i||s)&&r===X(n.payload)&&(i?t:o)(n)})),M(Y,this,K).send(i)}));return"sub"===e&&(0,T.A)(V,this).set(t,o),(0,T.A)(J,this)[e].set(o,s),s}function X(e){const{system:t,topic:n}=e;return JSON.stringify({system:t,topic:n})}var Z=function(){var e=d((function*(e,t){return(yield f.http.post("api/gateway/micro_app_standalone.runtime.SearchMicroAppStandalone/api/v1/micro_app_standalone/search",e,t)).data}));return function(t,n){return e.apply(this,arguments)}}();const ee=new Map,te=new Map;function ne(e,t){if(window.STANDALONE_MICRO_APPS&&!window.NO_AUTH_GUARD){const n=function(e){const t={usedArgs:new Set},{customTemplates:n,menus:o}=e.meta??{};return(0,l.traverseStoryboardExpressions)([e.routes,n,o],((e,n)=>{(0,l.collectInstalledAppsHasUsage)(t,e,n)}),"INSTALLED_APPS"),[...t.usedArgs]}(e),o=[];for(const e of n)ee.has(e)||t(e)||o.push(e);if(0===o.length)return;const r=Z({query:{appId:{$in:o}},fields:["appId","currentVersion","installStatus"]}).catch((e=>{console.error("Get off site standalone micro-apps failed",e)}));for(const e of o)ee.set(e,r.then((t=>{var n;const o=null==t||null===(n=t.list)||void 0===n?void 0:n.find((t=>t.appId===e)),r=o?{...o,id:e}:void 0;return te.set(e,r),r})))}}async function oe(e){await Promise.all(e.map((e=>ee.get(e))))}function re(e){if(window.STANDALONE_MICRO_APPS)return te.get(e)}var ie=n(3078);const se="core.provider-flow-api";function ae(e,t){return e.some((e=>e.source===t))}async function ce(e){let{url:t,originalUri:n,method:o="GET",responseWrapper:r=!0,ext_fields:i=[],request:s,isFileType:a,stream:c}=e;const u=["get","delete","head"].includes(o.toLowerCase()),l=a?{responseType:"blob"}:{};let p;for(var d=arguments.length,h=new Array(d>1?d-1:0),m=1;m<d;m++)h[m-1]=arguments[m];if(u){var g,v;let e,r;var A;if(n&&"object"===(null==s?void 0:s.type)&&((null===(g=n.match(/:([^/]+)/g))||void 0===g?void 0:g.length)??0)===((null===(v=s.fields)||void 0===v?void 0:v.length)??0)?[r]=h:[e,r]=h,c)return await(0,ie.createSSEStream)(f.http.getUrlWithParams(t,e),{...l,...r,method:o,headers:Object.fromEntries([...new Headers((null===(A=r)||void 0===A?void 0:A.headers)??{}).entries()])});p=await f.http.simpleRequest(o,t,{params:e,...l,...r})}else{const e=function(e){if("object"!==(null==e?void 0:e.type))return!1;const t=e=>!(0,N.isEmpty)(e)&&e.some((e=>["file","file[]"].includes(e.type)||t(e.fields)));return t(e.fields)}(s),n=function(e){const t=ae(e,"query"),n=ae(e,"body");for(var o=arguments.length,r=new Array(o>1?o-1:0),i=1;i<o;i++)r[i-1]=arguments[i];if(t){if(n){const[e,t,n]=r;return{data:e,options:{params:t,...n}}}const[e,t]=r;return{data:{},options:{params:e,...t}}}const[s,a]=r;return{data:s,options:a}}(i,...h),r=e?function(e){if(e instanceof FormData)return e;const t=new FormData;for(const[n,o]of Object.entries(e))Array.isArray(o)?o.forEach((e=>{t.append(n,e)})):!(0,N.isObject)(o)||o instanceof Blob||o instanceof Date?t.append(n,o):Object.entries(o).forEach((e=>{let[o,r]=e;t.append(`${n}[${o}]`,r)}));return t}(n.data):n.data;if(c){var w;const{body:e,headers:i}=f.http.getBodyAndHeaders(r,null===(w=n.options)||void 0===w?void 0:w.headers);return await(0,ie.createSSEStream)(t,{...l,...n.options,method:o,headers:Object.fromEntries([...new Headers(i??{}).entries()]),body:e})}p=await f.http.requestWithBody(o,t,r,{...l,...n.options})}return!a&&r?p.data:p}function ue(){customElements.define(se,(0,ie.createProviderClass)(ce))}var le=n(8679),pe=function(){var e=d((function*(e,t){return(yield f.http.post("api/contract/single_search",e,t)).data}));return function(t,n){return e.apply(this,arguments)}}();const de=new Map,fe=new Map,he=new Map,me=(e,t)=>{null==e||e.forEach((e=>{t.set(`${e.namespaceId}.${e.name}`,e)}))};function ge(e){me(e,de)}function ve(e){me(e,fe)}function Ae(){fe.clear()}function we(e){me(e,he)}function ye(){he.clear()}const Se=new Map;function be(e){return e.includes("@")}async function Ie(e,t,n,o){if(!e.includes(":"))throw new Error(`You're using legacy Custom API "${e}" which is dropped in v3, please use Flow API instead`);const r=await async function(e){const[t,n]=e.split("@"),[o,r]=n.split(":"),i=function(e){return de.get(e)||fe.get(e)||he.get(e)}(`${t}.${o}`);if(i)return{name:i.name,namespace:i.namespaceId,serviceName:i.serviceName,version:i.version,contract:{endpoint:i.endpoint,response:i.response,request:i.request}};let s=Se.get(e);return s||(s=async function(e,t,n){var o;const{contractData:r}=await pe({contractName:`${e}.${t}`,version:n});return r?{name:r.name,namespace:null===(o=r.namespace)||void 0===o||null===(o=o[0])||void 0===o?void 0:o.name,serviceName:r.serviceName,version:r.version,contract:{endpoint:r.endpoint,response:r.response,request:r.request}}:null}(t,o,r),Se.set(e,s)),s}(e);if(!r)throw new Ee(`Flow API not found: "${e}"`);const i=function(e,t){var n;const o="string"==typeof t.contract?le.safeLoad(t.contract,{schema:le.JSON_SCHEMA,json:!0}):t.contract,{uri:r,method:i="GET",ext_fields:s}=(null==o?void 0:o.endpoint)??{},a=!(null==o||!o.response)&&!1!==o.response.wrapper;if(!r)throw new Error(`Missing endpoint.uri in contract of provider "${e}"`);return{uri:r,method:"list"===i.toLowerCase()?"get":i,ext_fields:s,name:t.name,namespace:t.namespace,serviceName:t.serviceName,version:t.version,isFileType:"file"===(null==o||null===(n=o.response)||void 0===n?void 0:n.type),responseWrapper:a,request:null==o?void 0:o.request}}(e,r);return function(e,t,n,o){let{uri:r,method:i,ext_fields:s,name:a,namespace:c,serviceName:u,responseWrapper:l,version:p,isFileType:d,request:f}=e;const h="saveAs"===n;let m;h&&(m=t.shift());const{url:g,args:v}=function(e,t,n,o,r,i){const s=i?"logic.api.gateway"===r||null!=r&&r.startsWith("logic.api.gateway.")?"":r?`api/gateway/${r}`:`api/gateway/${o}.${n}@${i}`:`api/gateway/api_service.${o}.${n}`,a=t.slice(),c=e.replace(/:([^/]+)/g,(()=>a.shift()));return{url:s?s+c:c.replace(/^\//,""),args:a}}(r,t,a,c,u,p);return[...h?[m]:[],{url:g,originalUri:r,method:i,ext_fields:s,responseWrapper:l,request:f,isFileType:d,stream:o},...v]}(i,t,n,o)}class Ee extends Error{constructor(e){super(e),this.name="FlowApiNotFoundError",Error.captureStackTrace&&Error.captureStackTrace(this,Ee)}}var Pe=function(){var e=d((function*(e,t,n){return(yield f.http.post("api/gateway/cmdb.instance.PostSearch/object/".concat(e,"/instance/_search"),t,n)).data}));return function(t,n,o){return e.apply(this,arguments)}}(),ke=n(9740),Oe=function(){var e=d((function*(e,t,n){return(yield f.http.get("api/gateway/micro_app.installed_micro_app.GetMenusInfo/api/v1/micro-app/menus/".concat(e),(0,ke.A)((0,ke.A)({},n),{},{params:t}))).data}));return function(t,n,o){return e.apply(this,arguments)}}(),Me=n(8799);const Ce=Symbol("appId"),Te=Symbol("menuI18nNamespace"),_e=Symbol("overrideApp");async function Ne(e,t,n){const o=e.find((e=>"inject"!==e.type));if(!o)return;const r=[],i=new Map,s=new WeakMap;for(const t of e)if(t.i18n){const e=`menu/${t.menuId}~${t.app[0].appId}+${t.instanceId}`;Object.entries(t.i18n).forEach((t=>{let[n,o]=t;Me.i18n.addResourceBundle(n,e,o)})),s.set(t,e)}await Promise.all(e.map((e=>async function(e,t,n,o){if(e.dynamicItems&&e.itemsResolve){const i=e.app[0].appId,s={...t,pendingPermissionsPreCheck:[...t.pendingPermissionsPreCheck,I(e.itemsResolve)]};var r;i!==t.app.id&&(s.overrideApp=window.STANDALONE_MICRO_APPS?e.overrideApp:null===(r=o.getStoryboardByAppId(i))||void 0===r?void 0:r.app,s.appendI18nNamespace=n.get(e));const a=await o.resolveData({transform:"items",...e.itemsResolve},s);e.items=a.items}}(e,t,s,n))));for(const t of e){var a;if(null!==(a=t.items)&&void 0!==a&&a.length)if("inject"===t.type&&t.injectMenuGroupId){let e=i.get(t.injectMenuGroupId);e||(e=[],i.set(t.injectMenuGroupId,e)),e.push(t)}else r.push(t)}return{...o,items:r.flatMap((e=>je(e.items,e,i,s))),[Te]:s.get(o),[_e]:o.overrideApp}}function je(e,t,n,o){return null==e?void 0:e.map((e=>{const r=e.groupId&&n.get(e.groupId);return r&&n.delete(e.groupId),{...e,children:(je(e.children,t,n,o)??[]).concat(r?r.flatMap((e=>je(e.items,e,n,o))):[]),[Ce]:t.app[0].appId,[Te]:o.get(t),[_e]:t.overrideApp}}))}function $e(e){e.items=Re(e.items)}function Re(e){return function(e){return(0,N.sortBy)(e,(e=>e.sort??-1/0))}(e).map((e=>({...e,children:Re(e.children)})))}var De=n(1744),We=n(522);function xe(e,t,n,o){if("titleDataSource"in e&&(0,ie.isObject)(e.titleDataSource)&&Object.entries(e.titleDataSource).every((e=>{let[,t]=e;return null===t||""===t}))&&delete e.titleDataSource,"if"in e&&null===e.if&&delete e.if,"to"in e&&e.to&&!(0,We.isEvaluable)(e.to)){const t=De.pipes.yaml(e.to);(0,ie.isObject)(t)&&["pathname","search","hash"].some((e=>(0,ie.hasOwnProperty)(t,e)))&&(e.to=t)}let r=n;if(t!==n.app.id){var i;const s=window.STANDALONE_MICRO_APPS?e[_e]:null===(i=o.getStoryboardByAppId(t))||void 0===i?void 0:i.app;r={...n,overrideApp:s,appendI18nNamespace:e[Te]}}return o.asyncComputeRealValue(e,r,{ignoreSymbols:!0})}function Le(e,t,n){return Promise.all(e.map((async e=>{let{children:o,...r}=e;const[i,s]=await Promise.all([xe(r,r[Ce],t,n),o&&await Le(o,t,n)]);return{...i,children:s}})))}var Ue=function(){var e=d((function*(e,t,n,o){return(yield f.http.get("api/gateway/cmdb.instance.GetDetail/object/".concat(e,"/instance/").concat(t),(0,ke.A)((0,ke.A)({},o),{},{params:n}))).data}));return function(t,n,o,r){return e.apply(this,arguments)}}();const Be=new Map;async function Fe(e){if(e.title||(0,N.isEmpty)(e.titleDataSource))return e.title;const t=JSON.stringify(e.titleDataSource),n=Be.get(t);if(void 0!==n)return n;const{objectId:o,instanceId:r,attributeId:i}=e.titleDataSource,s=i??"name",a=await Ue(o,r,{fields:s});let c;if("#showKey"===i&&Array.isArray(a[s])){const[e,...t]=a[s];c=t.length>0?`${e}(${t.join(",")})`:String(e)}else c=String(a[s]);return Be.set(t,c),c}const qe=new Map,ze=new Map;function He(e){return null==e?void 0:e.filter(_.checkIfOfComputed).map((e=>{const t=He(e.children);return"group"===e.type?{type:"group",title:e.text,childLayout:e.childLayout,items:t,groupId:e.groupId,groupFrom:e.groupFrom}:null!=t&&t.length?{type:"subMenu",childLayout:e.childLayout,title:e.text,icon:e.icon,items:t,defaultExpanded:e.defaultExpanded}:(0,N.omit)(e,["type","items","children"])}))}function Ge(e){return ze.get(e)}function Je(e,t,n){let o=qe.get(e);return o||(o=async function(e,t,n){const o=window.STANDALONE_MICRO_APPS?function(e,t,n){var o,r;const i=n.getStoryboardByAppId(t);return((null===(o=i.meta)||void 0===o?void 0:o.injectMenus)??(null===(r=i.meta)||void 0===r?void 0:r.menus)??[]).filter((t=>t.menuId===e)).map((e=>{var n;return{...e,...null!==(n=e.app)&&void 0!==n&&null!==(n=n[0])&&void 0!==n&&n.appId?{}:{app:[{appId:t}]}}}))}(e,t.app.id,n):t.flags["three-level-menu-layout"]?(await Oe(e,{menuObjectId:"EASYOPS_STORYBOARD_MENU"})).menus:(await Pe("EASYOPS_STORYBOARD_MENU",{page:1,page_size:200,fields:{menuId:!0,title:!0,icon:!0,link:!0,titleDataSource:!0,defaultCollapsed:!0,defaultCollapsedBreakpoint:!0,type:!0,injectMenuGroupId:!0,dynamicItems:!0,itemsResolve:!0,items:!0,i18n:!0,"items.children":!0,"app.appId":!0},query:{menuId:{$eq:e},app:{$size:{$gt:0}}}})).list,r=await Ne(o,t,n);if(!r)throw new Error(`Menu not found: ${e}`);$e(r);const{items:i,app:s,...a}=r,c={...t,pendingPermissionsPreCheck:[...t.pendingPermissionsPreCheck,I([i,a])]};delete c.tplStateStoreId,delete c.forEachItem,delete c.forEachIndex,delete c.forEachSize;const u=s[0].appId,[l,p]=await Promise.all([xe(a,u,c,n),Le(i,c,n)]),d={title:await Fe(l),...(0,N.pick)(l,["icon","link","defaultCollapsed","defaultCollapsedBreakpoint"]),menuItems:He(p)};ze.set(e,d)}(e,t,n)),o}const Ve=[];let Ye=null;const Ke={maxWaitingTime:5e3,maxLoggedEvents:10};function Qe(){clearTimeout(Ye),Ve.length>Ke.maxLoggedEvents?Xe():Ye=setTimeout(Xe,Ke.maxWaitingTime)}function Xe(){if(0===Ve.length)return;const e={model:"easyops.FRONTEND_STAT",columns:["_ver","st","et","lt","size","time","traceId","code","duration","page","uid","username","api","type","msg","status","pageId","route","apiCount","maxApiTimeCost","apiSizeCost","pageTitle"],data:Ve.splice(0,Ke.maxLoggedEvents)};var t;!function(e,t){const n=new Blob([JSON.stringify(t)],{type:"application/json"});window.navigator.sendBeacon(e,n)}(Ke.api,e),Ve.length&&(t=Xe,(window.requestIdleCallback||window.requestAnimationFrame||(e=>setTimeout(e,17)))(t))}function Ze(){window.addEventListener("beforeunload",Xe,!1)}let et,tt=!1,nt=null,ot=!0;const rt=[];function it(e){tt||(tt=!0,et||(et=function(e,t){return Object.assign(Ke,{...t,api:e}),{sendOnExit:Ze,emit:Qe}}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),et.sendOnExit()))}const st=Symbol("HttpAnalytics");function at(e){const t=Math.round(performance.now()),n=Date.now();return e[st]={st:n,time:Math.round(n/1e3),perfStartTime:t},e}function ct(e,t){return lt(!1,e,t)}function ut(e,t){return lt(!0,e,t)}function lt(e,t,n){const o=Math.round(performance.now()),r=Date.now(),{[st]:i,url:s}=n;if(i&&!(e&&t instanceof f.HttpAbortError)){delete n[st];const{st:c,time:u,perfStartTime:l}=i,{userInstanceId:p,username:d}=v();let h,m,g,A,w,y,S;if(e){const e=t instanceof f.HttpResponseError;(e||t instanceof f.HttpParseError)&&(({status:w,headers:y}=t.response),e&&(S=t.responseJson))}else({status:w,data:S,headers:y}=t);(0,ie.isObject)(S)&&({code:h,message:m}=S),y instanceof Headers&&(g=y.get("x-b3-traceid"),A=y.get("content-length")),a={st:c,_ver:c,uid:p,username:d,time:u,et:r,page:location.href,duration:o-l,api:s,type:"api",code:h??-1,msg:m??"",status:w,traceId:g??"",size:A?Number(A):-1},nt?Ve.push({...a,type:"apiRequest",...nt}):rt.push(a)}var a;return e?Promise.reject(t):t}function pt(){const e=Math.round(performance.now()),t=Date.now();return rt.length=0,nt=null,function(n){let{status:o,path:r,pageTitle:i}=n;if("ok"!==o)return Ve.push(...rt),void(rt.length=0);const s=Math.round(performance.now())-e,a=Date.now(),{username:c}=v();(function(e){const t=function(){const e=URL.createObjectURL(new Blob([]));let t=e.substring(e.lastIndexOf("/")+1);return URL.revokeObjectURL(e),ot&&(t="88-"+t,ot=!1),t}(),{lt:n,route:o}=e;nt={lt:n,route:o,pageId:t},Ve.push({...e,pageId:t,apiCount:rt.length,maxApiTimeCost:Math.max(0,...rt.map((e=>e.duration))),size:rt.map((e=>e.size)).filter((e=>e>0)).reduce(((e,t)=>e+t),0)});for(const e of rt)Ve.push({...e,...nt});rt.length=0,et.emit()})({type:"page",page:location.href,_ver:t,time:Math.round(t/1e3),st:t,et:a,lt:s,pageTitle:i,username:c,route:r}),window.dispatchEvent(new CustomEvent("route.render",{detail:{renderTime:s}}))}}const dt=Object.freeze({checkPermissions:function(){if(!w())return!1;if(v().isAdmin)return!0;for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const e of t)switch(b.get(e)){case"unauthorized":case"undefined":return!1;case void 0:return console.error(`Un-checked permission action: "${e}", please make sure the permission to check is defined in permissionsPreCheck.`),!1}return!0},preCheckPermissions:function(e){if(w()&&!v().isAdmin)return E((0,l.scanPermissionActionsInStoryboard)(e))},preCheckPermissionsForBrickOrRoute:async function(e,t){if(w()&&!v().isAdmin&&Array.isArray(e.permissionsPreCheck))return E(await t(e.permissionsPreCheck))}}),ft=new class{constructor(){(0,P.A)(this,Y),(0,k.A)(this,G,void 0),(0,k.A)(this,J,{sub:new Map,unsub:new Map}),(0,k.A)(this,V,new Map)}subscribe(e,t){const n=JSON.stringify(t);return(0,O.A)(Y,this,Q).call(this,"sub",e,t,n)}unsubscribe(e){const t=(0,T.A)(V,this).get(e);if(!t){const t=`The message channel to unsubscribe "${e}" is not found`;return console.error(t),Promise.reject(new Error(t))}const n=JSON.parse(t),o=(0,O.A)(Y,this,Q).call(this,"unsub",e,n,t);return(0,T.A)(J,this).sub.delete(t),o.then((()=>{(0,T.A)(V,this).delete(e)})),o}onMessage(e,t){let n=(0,T.A)(V,this).get(e),o=!1;M(Y,this,K).onMessage((r=>{n||(n=(0,T.A)(V,this).get(e)),n?"MESSAGE.PUSH"===r.event&&function(e,t){const n=JSON.parse(e);return n.system===t.system&&(n.topic===t.topic||"string"==typeof n.topic&&n.topic.includes("*")&&new RegExp(`^${n.topic.replace(/([^*]*)\*([^*]*)/g,((e,t,n)=>`${(0,N.escapeRegExp)(t)}[^/]*${(0,N.escapeRegExp)(n)}`))}$`).test(t.topic))}(n,r.payload)&&t(r.payload.message):o||(console.error(`Message channel: "${e}" not found`),o=!0)}))}onClose(e){M(Y,this,K).onClose(e)}reset(){var e;(0,T.A)(J,this).sub.clear(),(0,T.A)(J,this).unsub.clear(),(0,T.A)(V,this).clear(),null===(e=(0,T.A)(G,this))||void 0===e||e.reset()}},ht=function(){const e=(0,_.getV2RuntimeFromDll)();if(e)return Object.freeze((0,N.pick)(e,["authenticate","getAuth","isLoggedIn","logout"]))}()||o}}]);
//# sourceMappingURL=793.b3d28d36.js.map