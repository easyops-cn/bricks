/*! For license information please see 9213.7c396eda.js.LICENSE.txt */
"use strict";(self.webpackChunk_next_bricks_form_platform=self.webpackChunk_next_bricks_form_platform||[]).push([[9213,4822],{6171:(e,t,n)=>{function r(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}n.d(t,{Z:()=>r})},5866:(e,t,n)=>{n.d(t,{Z:()=>i});var r=n(5863);function i(e,t){(0,r.Z)(e,t),t.add(e)}},2159:(e,t,n)=>{function r(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}n.d(t,{Z:()=>r})},9213:(e,t,n)=>{n.r(t),n.d(t,{analytics:()=>u,auth:()=>wt,checkInstalledApps:()=>i,checkPermissions:()=>yt,flowApi:()=>a,menu:()=>o,messageDispatcher:()=>gt});var r={};n.r(r),n.d(r,{authenticate:()=>y,getAuth:()=>g,isLoggedIn:()=>Z,logout:()=>w});var i={};n.r(i),n.d(i,{getCheckedApp:()=>ce,preCheckInstalledApps:()=>ae,waitForCheckingApps:()=>oe});var a={};n.r(a),n.d(a,{FLOW_API_PROVIDER:()=>pe,clearCollectWidgetContract:()=>Ie,collectContract:()=>Se,collectWidgetContract:()=>be,getArgsOfFlowApi:()=>ke,isFlowApiProvider:()=>Oe,registerFlowApiProvider:()=>he});var o={};n.r(o),n.d(o,{fetchMenuById:()=>rt,getMenuById:()=>nt});var s={};n.r(s),n.d(s,{onRequest:()=>dt,onResponse:()=>ft,onResponseError:()=>vt});var c={};n.r(c),n.d(c,{create:()=>mt});var u={};n.r(u),n.d(u,{http:()=>s,initialize:()=>lt,pageView:()=>c});var l=n(4795),p=n(5178),d=n(3110),f=n(3352),v=function(){var e=(0,l.Z)((function*(e,t){return(yield f.http.post("api/gateway/micro_app.permission.ValidatePermissions/api/micro_app/v1/permission/validate",e,t)).data}));return function(t,n){return e.apply(this,arguments)}}(),h=n(3028),m={};function y(e){Object.assign(m,{org:e.org,username:e.username,userInstanceId:e.userInstanceId,loginFrom:e.loginFrom,accessRule:e.accessRule,isAdmin:e.isAdmin,csrfToken:e.csrfToken,license:e.license,userShowValue:e.userShowValue})}function g(){return(0,h.Z)({},m)}function w(){for(var e of Object.keys(m))m[e]=void 0;S.length=0,b.clear()}function Z(){return void 0!==m.username}var S=[],b=new Map;function I(){return(I=(0,l.Z)((function*(e,t){if(Z()&&!g().isAdmin&&Array.isArray(e.permissionsPreCheck))return O(yield t(e.permissionsPreCheck))}))).apply(this,arguments)}function A(e){if(Z()&&!g().isAdmin)return O((0,d.scanPermissionActionsInAny)(e))}function O(e){return k.apply(this,arguments)}function k(){return(k=(0,l.Z)((function*(e){var t=(0,p.difference)(e,[...S]);if(0!==t.length){S.push(...t);try{var n=yield v({actions:t});for(var r of n.actions)b.set(r.action,r.authorizationStatus),"undefined"===r.authorizationStatus&&console.error('Undefined permission action: "'.concat(r.action,'"'))}catch(e){console.error("Pre-check permissions failed",e)}}}))).apply(this,arguments)}var M=n(5866),E=n(3395),P=n(6171),_=n(381),C=n(687),N=n(5062),T=1e3,j=6,R=new WeakMap,D=new WeakMap,W=new WeakMap,L=new WeakMap,x=new WeakMap,U=new WeakMap,B=new WeakMap,F=new WeakSet,q=new WeakSet;class z{constructor(e){(0,M.Z)(this,q),(0,M.Z)(this,F),(0,E.Z)(this,R,{writable:!0,value:void 0}),(0,E.Z)(this,D,{writable:!0,value:void 0}),(0,E.Z)(this,W,{writable:!0,value:[]}),(0,E.Z)(this,L,{writable:!0,value:new Set}),(0,E.Z)(this,x,{writable:!0,value:new Set}),(0,E.Z)(this,U,{writable:!0,value:0}),(0,E.Z)(this,B,{writable:!0,value:!1}),(0,_.Z)(this,R,e)}send(e){(0,C.Z)(this,D)||(0,_.Z)(this,D,(0,P.Z)(this,F,G).call(this));var t=JSON.stringify(e);(0,C.Z)(this,D).readyState===WebSocket.OPEN?(0,C.Z)(this,D).send(t):(0,C.Z)(this,W).push(t)}onMessage(e){(0,C.Z)(this,L).add(e)}onClose(e){(0,C.Z)(this,x).add(e)}reset(){(0,C.Z)(this,W).length=0,(0,C.Z)(this,L).clear(),(0,C.Z)(this,x).clear()}close(){var e;(0,_.Z)(this,B,!0),(null===(e=(0,C.Z)(this,D))||void 0===e?void 0:e.readyState)===WebSocket.OPEN&&(0,C.Z)(this,D).close()}}function G(){console.log("WebSocket connecting ...");var e=new WebSocket((0,C.Z)(this,R));return e.addEventListener("open",(t=>{for(var n of(console.log("WebSocket open:",t),(0,_.Z)(this,U,0),(0,C.Z)(this,W)))e.send(n);(0,C.Z)(this,W).length=0})),e.addEventListener("close",(e=>{if(!(0,C.Z)(this,B)){for(var t of(console.log("WebSocket close:",e),(0,C.Z)(this,x)))t();1e3!==e.code&&(0,P.Z)(this,q,J).call(this)}})),e.addEventListener("error",(e=>{console.error("WebSocket error:",e)})),e.addEventListener("message",(e=>{var t=JSON.parse(e.data);for(var n of(0,C.Z)(this,L))n(t)})),e}function J(){if((0,C.Z)(this,U)>=j)console.error("WebSocket connect retry limit exceeded");else{var e=Math.pow(2,(0,C.Z)(this,U))*T;console.log("WebSocket will reconnect after %d seconds",e/1e3),setTimeout((()=>{var e;(0,_.Z)(this,U,(e=(0,C.Z)(this,U),++e)),(0,_.Z)(this,D,(0,P.Z)(this,F,G).call(this))}),e)}}var H=new WeakMap,V=new WeakMap,Y=new WeakMap,$=new WeakMap,K=new WeakSet;function Q(){if(!(0,C.Z)(this,H)){var e="https:"===location.protocol?"wss:":"ws:",t="".concat(e,"//").concat(window.location.host).concat((0,N.getBasePath)(),"api/websocket_service/v1/ws");(0,_.Z)(this,H,new z(t))}return(0,C.Z)(this,H)}function X(e,t,n,r){var i=(0,C.Z)(this,V)[e].get(r);if(i)return i;var a={event:"sub"===e?"TOPIC.SUB":"TOPIC.UNSUB",payload:n},o=new Promise(((t,r)=>{var i=ee(n);(0,C.Z)(this,$).onMessage((n=>{var a=n.event===("sub"===e?"TOPIC.SUB_SUCCESS":"TOPIC.UNSUB_SUCCESS"),o=n.event===("sub"===e?"TOPIC.SUB_FAILED":"TOPIC.UNSUB_FAILED");(a||o)&&i===ee(n.payload)&&(a?t:r)(n)})),(0,C.Z)(this,$).send(a)}));return"sub"===e&&(0,C.Z)(this,Y).set(t,r),(0,C.Z)(this,V)[e].set(r,o),o}function ee(e){var{system:t,topic:n}=e;return JSON.stringify({system:t,topic:n})}var te=n(9751),ne=function(){var e=(0,l.Z)((function*(e,t){return(yield te.http.post("api/gateway/micro_app_standalone.runtime.SearchMicroAppStandalone/api/v1/micro_app_standalone/search",e,t)).data}));return function(t,n){return e.apply(this,arguments)}}(),re=new Map,ie=new Map;function ae(e,t){if(window.STANDALONE_MICRO_APPS&&!window.NO_AUTH_GUARD){var n=function(e){var t,n={usedArgs:new Set},{customTemplates:r,menus:i}=null!==(t=e.meta)&&void 0!==t?t:{};return(0,d.traverseStoryboardExpressions)([e.routes,r,i],((e,t)=>{(0,d.collectInstalledAppsHasUsage)(n,e,t)}),"INSTALLED_APPS"),[...n.usedArgs]}(e),r=[];for(var i of n)re.has(i)||t(i)||r.push(i);if(0===r.length)return;var a=ne({query:{appId:{$in:r}},fields:["appId","currentVersion","installStatus"]}).catch((e=>{console.error("Get off site standalone micro-apps failed",e)})),o=function(e){re.set(e,a.then((t=>{var n,r=null==t||null===(n=t.list)||void 0===n?void 0:n.find((t=>t.appId===e)),i=r?(0,h.Z)((0,h.Z)({},r),{},{id:e}):void 0;return ie.set(e,i),i})))};for(var s of r)o(s)}}function oe(e){return se.apply(this,arguments)}function se(){return(se=(0,l.Z)((function*(e){yield Promise.all(e.map((e=>re.get(e))))}))).apply(this,arguments)}function ce(e){if(window.STANDALONE_MICRO_APPS)return ie.get(e)}var ue=n(6107),le=n(5121),pe="core.provider-flow-api";function de(e,t){return e.some((e=>e.source===t))}function fe(e){return ve.apply(this,arguments)}function ve(){return ve=(0,l.Z)((function*(e){for(var t,{url:n,originalUri:r,method:i="GET",responseWrapper:a=!0,ext_fields:o=[],request:s,isFileType:c}=e,u=["get","delete","head"].includes(i.toLowerCase()),l=c?{responseType:"blob"}:{},d=arguments.length,f=new Array(d>1?d-1:0),v=1;v<d;v++)f[v-1]=arguments[v];if(u){var m,y,g,w,Z,S;r&&"object"===(null==s?void 0:s.type)&&(null!==(m=null===(y=r.match(/:([^/]+)/g))||void 0===y?void 0:y.length)&&void 0!==m?m:0)===(null!==(g=null===(w=s.fields)||void 0===w?void 0:w.length)&&void 0!==g?g:0)?[S]=f:[Z,S]=f,t=yield le.http.simpleRequest(i,n,(0,h.Z)((0,h.Z)({params:Z},l),S))}else{var b=function(e){if(!e||"object"!==e.type)return!1;var t=e=>!(0,p.isEmpty)(e)&&e.some((e=>["file","file[]"].includes(e.type)||t(e.fields)));return t(e.fields)}(s),I=function(e){for(var t=de(e,"query"),n=de(e,"body"),r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];if(t){if(n){var[o,s,c]=i;return{data:o,options:(0,h.Z)({params:s},c)}}var[u,l]=i;return{data:{},options:(0,h.Z)({params:u},l)}}var[p,d]=i;return{data:p,options:d}}(o,...f);t=yield le.http.requestWithBody(i,n,b?function(e){if(e instanceof FormData)return e;var t=new FormData,n=function(e){Array.isArray(i)?i.forEach((n=>{t.append(e,n)})):!(0,p.isObject)(i)||i instanceof Blob||i instanceof Date?t.append(e,i):Object.entries(i).forEach((n=>{var[r,i]=n;t.append("".concat(e,"[").concat(r,"]"),i)}))};for(var[r,i]of Object.entries(e))n(r);return t}(I.data):I.data,(0,h.Z)((0,h.Z)({},l),I.options))}return!c&&a?t.data:t})),ve.apply(this,arguments)}function he(){customElements.define(pe,(0,ue.createProviderClass)(fe))}var me=n(9169),ye=function(){var e=(0,l.Z)((function*(e,t){return(yield f.http.post("api/contract/single_search",e,t)).data}));return function(t,n){return e.apply(this,arguments)}}(),ge=new Map,we=new Map,Ze=(e,t)=>{null==e||e.forEach((e=>{t.set("".concat(e.namespaceId,".").concat(e.name),e)}))};function Se(e){Ze(e,ge)}function be(e){Ze(e,we)}function Ie(){we.clear()}var Ae=new Map;function Oe(e){return e.includes("@")}function ke(e,t,n){return Me.apply(this,arguments)}function Me(){return Me=(0,l.Z)((function*(e,t,n){if(!e.includes(":"))throw new Error("You're using legacy Custom API \"".concat(e,'" which is dropped in v3, please use Flow API instead'));var r=yield function(e){return Ee.apply(this,arguments)}(e);if(!r)throw new _e('Flow API not found: "'.concat(e,'"'));var i=function(e,t){var n,r,i="string"==typeof t.contract?me.safeLoad(t.contract,{schema:me.JSON_SCHEMA,json:!0}):t.contract,{uri:a,method:o="GET",ext_fields:s}=null!==(n=null==i?void 0:i.endpoint)&&void 0!==n?n:{},c=!(null==i||!i.response)&&!1!==i.response.wrapper;if(!a)throw new Error('Missing endpoint.uri in contract of provider "'.concat(e,'"'));return{uri:a,method:"list"===o.toLowerCase()?"get":o,ext_fields:s,name:t.name,namespace:t.namespace,serviceName:t.serviceName,version:t.version,isFileType:"file"===(null==i||null===(r=i.response)||void 0===r?void 0:r.type),responseWrapper:c,request:null==i?void 0:i.request}}(e,r);return function(e,t,n){var r,{uri:i,method:a,ext_fields:o,name:s,namespace:c,serviceName:u,responseWrapper:l,version:p,isFileType:d,request:f}=e,v=d&&"saveAs"===n;v&&(r=t.shift());var{url:h,args:m}=function(e,t,n,r,i,a){var o=a?i?"api/gateway/".concat(i):"api/gateway/".concat(r,".").concat(n,"@").concat(a):"api/gateway/api_service.".concat(r,".").concat(n),s=t.slice();return{url:o+e.replace(/:([^/]+)/g,(()=>s.shift())),args:s}}(i,t,s,c,u,p);return[...v?[r]:[],{url:h,originalUri:i,method:a,ext_fields:o,responseWrapper:l,request:f,isFileType:d},...m]}(i,t,n)})),Me.apply(this,arguments)}function Ee(){return Ee=(0,l.Z)((function*(e){var[t,n]=e.split("@"),[r,i]=n.split(":"),a=function(e){return ge.get(e)||we.get(e)}("".concat(t,".").concat(r));if(a)return{name:a.name,namespace:a.namespaceId,serviceName:a.serviceName,version:a.version,contract:{endpoint:a.endpoint,response:a.response,request:a.request}};var o=Ae.get(e);return o||(o=function(e,t,n){return Pe.apply(this,arguments)}(t,r,i),Ae.set(e,o)),o})),Ee.apply(this,arguments)}function Pe(){return(Pe=(0,l.Z)((function*(e,t,n){var r,{contractData:i}=yield ye({contractName:"".concat(e,".").concat(t),version:n});return i?{name:i.name,namespace:null===(r=i.namespace)||void 0===r||null===(r=r[0])||void 0===r?void 0:r.name,serviceName:i.serviceName,version:i.version,contract:{endpoint:i.endpoint,response:i.response,request:i.request}}:null}))).apply(this,arguments)}class _e extends Error{constructor(e){super(e),this.name="FlowApiNotFoundError",Error.captureStackTrace&&Error.captureStackTrace(this,_e)}}var Ce=n(2159),Ne=n(2021),Te=function(){var e=(0,l.Z)((function*(e,t,n){return(yield f.http.get("api/gateway/micro_app.installed_micro_app.GetMenusInfo/api/v1/micro-app/menus/".concat(e),(0,h.Z)((0,h.Z)({},n),{},{params:t}))).data}));return function(t,n,r){return e.apply(this,arguments)}}(),je=n(7730),Re=Symbol("appId"),De=Symbol("menuI18nNamespace"),We=Symbol("overrideApp");function Le(){return(Le=(0,l.Z)((function*(e,t,n,r){if(e.dynamicItems&&e.itemsResolve){var i=e.app[0].appId,a=t;if(i!==t.app.id){var o,s=window.STANDALONE_MICRO_APPS?e.overrideApp:null===(o=r.getStoryboardByAppId(i))||void 0===o?void 0:o.app;a=(0,h.Z)((0,h.Z)({},t),{},{overrideApp:s,appendI18nNamespace:n.get(e)})}var c=yield r.resolveData((0,h.Z)({transform:"items"},e.itemsResolve),a);e.items=c.items}}))).apply(this,arguments)}function xe(){return xe=(0,l.Z)((function*(e,t,n){var r=e.find((e=>"inject"!==e.type));if(r){var i=[],a=new Map,o=new WeakMap,s=function*(){if(c.i18n){var e="menu/".concat(c.menuId,"~").concat(c.app[0].appId,"+").concat(c.instanceId);Object.entries(c.i18n).forEach((t=>{var[n,r]=t;je.i18n.addResourceBundle(n,e,r)})),o.set(c,e)}};for(var c of e)yield*s();for(var u of(yield Promise.all(e.map((e=>function(e,t,n,r){return Le.apply(this,arguments)}(e,t,o,n)))),e)){var l;if(null!==(l=u.items)&&void 0!==l&&l.length)if("inject"===u.type&&u.injectMenuGroupId){var p=a.get(u.injectMenuGroupId);p||(p=[],a.set(u.injectMenuGroupId,p)),p.push(u)}else i.push(u)}return(0,h.Z)((0,h.Z)({},r),{},{items:i.flatMap((e=>Ue(e.items,e,a,o))),[De]:o.get(r),[We]:r.overrideApp})}})),xe.apply(this,arguments)}function Ue(e,t,n,r){return null==e?void 0:e.map((e=>{var i,a=e.groupId&&n.get(e.groupId);return a&&n.delete(e.groupId),(0,h.Z)((0,h.Z)({},e),{},{children:(null!==(i=Ue(e.children,t,n,r))&&void 0!==i?i:[]).concat(a?a.flatMap((e=>Ue(e.items,e,n,r))):[]),[Re]:t.app[0].appId,[De]:r.get(t),[We]:t.overrideApp})}))}function Be(e){e.items=Fe(e.items)}function Fe(e){return function(e){return(0,p.sortBy)(e,(e=>{var t;return null!==(t=e.sort)&&void 0!==t?t:-1/0}))}(e).map((e=>(0,h.Z)((0,h.Z)({},e),{},{children:Fe(e.children)})))}var qe=n(672),ze=n(5777),Ge=["children"];function Je(e,t,n,r){if("titleDataSource"in e&&(0,ue.isObject)(e.titleDataSource)&&Object.entries(e.titleDataSource).every((e=>{var[,t]=e;return null===t||""===t}))&&delete e.titleDataSource,"if"in e&&null===e.if&&delete e.if,"to"in e&&e.to&&!(0,ze.isEvaluable)(e.to)){var i=qe.pipes.yaml(e.to);(0,ue.isObject)(i)&&["pathname","search","hash"].some((e=>(0,ue.hasOwnProperty)(i,e)))&&(e.to=i)}var a=n;if(t!==n.app.id){var o,s=window.STANDALONE_MICRO_APPS?e[We]:null===(o=r.getStoryboardByAppId(t))||void 0===o?void 0:o.app;a=(0,h.Z)((0,h.Z)({},n),{},{overrideApp:s,appendI18nNamespace:e[De]})}return r.asyncComputeRealValue(e,a,{ignoreSymbols:!0})}function He(e,t,n){return Promise.all(e.map(function(){var e=(0,l.Z)((function*(e){var{children:r}=e,i=(0,Ce.Z)(e,Ge),[a,o]=yield Promise.all([Je(i,i[Re],t,n),r&&(yield He(r,t,n))]);return(0,h.Z)((0,h.Z)({},a),{},{children:o})}));return function(t){return e.apply(this,arguments)}}()))}var Ve=function(){var e=(0,l.Z)((function*(e,t,n,r){return(yield te.http.get("api/gateway/cmdb.instance.GetDetail/object/".concat(e,"/instance/").concat(t),(0,h.Z)((0,h.Z)({},r),{},{params:n}))).data}));return function(t,n,r,i){return e.apply(this,arguments)}}(),Ye=new Map;function $e(e){return Ke.apply(this,arguments)}function Ke(){return(Ke=(0,l.Z)((function*(e){if(e.title||(0,p.isEmpty)(e.titleDataSource))return e.title;var t=JSON.stringify(e.titleDataSource),n=Ye.get(t);if(void 0!==n)return n;var r,{objectId:i,instanceId:a,attributeId:o}=e.titleDataSource,s=null!=o?o:"name",c=yield Ve(i,a,{fields:s});if("#showKey"===o&&Array.isArray(c[s])){var[u,...l]=c[s];r=l.length>0?"".concat(u,"(").concat(l.join(","),")"):String(u)}else r=String(c[s]);return Ye.set(t,r),r}))).apply(this,arguments)}var Qe=["items","app"],Xe=new Map,et=new Map;function tt(e){return null==e?void 0:e.filter(N.checkIfOfComputed).map((e=>{var t=tt(e.children);return"group"===e.type?{type:"group",title:e.text,childLayout:e.childLayout,items:t,groupId:e.groupId,groupFrom:e.groupFrom}:null!=t&&t.length?{type:"subMenu",childLayout:e.childLayout,title:e.text,icon:e.icon,items:t,defaultExpanded:e.defaultExpanded}:(0,p.omit)(e,["type","items","children"])}))}function nt(e){return et.get(e)}function rt(e,t,n){var r=Xe.get(e);return r||(r=function(e,t,n){return it.apply(this,arguments)}(e,t,n)),r}function it(){return it=(0,l.Z)((function*(e,t,n){var r=window.STANDALONE_MICRO_APPS?function(e,t,n){var r,i,a,o,s=n.getStoryboardByAppId(t);return(null!==(r=null!==(i=null===(a=s.meta)||void 0===a?void 0:a.injectMenus)&&void 0!==i?i:null===(o=s.meta)||void 0===o?void 0:o.menus)&&void 0!==r?r:[]).filter((t=>t.menuId===e)).map((e=>{var n;return(0,h.Z)((0,h.Z)({},e),null!==(n=e.app)&&void 0!==n&&null!==(n=n[0])&&void 0!==n&&n.appId?{}:{app:[{appId:t}]})}))}(e,t.app.id,n):t.flags["three-level-menu-layout"]?(yield Te(e,{menuObjectId:"EASYOPS_STORYBOARD_MENU"})).menus:(yield(0,Ne.x)("EASYOPS_STORYBOARD_MENU",{page:1,page_size:200,fields:{menuId:!0,title:!0,icon:!0,link:!0,titleDataSource:!0,defaultCollapsed:!0,defaultCollapsedBreakpoint:!0,type:!0,injectMenuGroupId:!0,dynamicItems:!0,itemsResolve:!0,items:!0,i18n:!0,"items.children":!0,"app.appId":!0},query:{menuId:{$eq:e},app:{$size:{$gt:0}}}})).list,i=yield function(e,t,n){return xe.apply(this,arguments)}(r,t,n);if(!i)throw new Error("Menu not found: ".concat(e));Be(i);var{items:a,app:o}=i,s=(0,Ce.Z)(i,Qe),c=(0,h.Z)((0,h.Z)({},t),{},{pendingPermissionsPreCheck:[...t.pendingPermissionsPreCheck,A([a,s])]});delete c.tplStateStoreId,delete c.forEachItem,delete c.forEachIndex;var u=o[0].appId,[l,d]=yield Promise.all([Je(s,u,c,n),He(a,c,n)]),f=(0,h.Z)((0,h.Z)({title:yield $e(l)},(0,p.pick)(l,["icon","link","defaultCollapsed","defaultCollapsedBreakpoint"])),{},{menuItems:tt(d)});et.set(e,f)})),it.apply(this,arguments)}var at=!1,ot=null,st=!0,ct=[],ut=[];function lt(e){at||(at=!0,window.addEventListener("beforeunload",(function(){if(0!==ut.length){var t={model:"easyops.FRONTEND_STAT",columns:["_ver","st","et","lt","size","time","traceId","code","duration","page","uid","username","api","type","msg","status","pageId","route","apiCount","maxApiTimeCost","apiSizeCost","pageTitle"],data:ut},n=new Blob([JSON.stringify(t)],{type:"application/json"});ut.length=0,window.navigator.sendBeacon(e,n)}}),!1))}var pt=Symbol("HttpAnalytics");function dt(e){var t=Math.round(performance.now()),n=Date.now();return e[pt]={st:n,time:Math.round(n/1e3),perfStartTime:t},e}function ft(e,t){return ht(!1,e,t)}function vt(e,t){return ht(!0,e,t)}function ht(e,t,n){var r,i=Math.round(performance.now()),a=Date.now(),{[pt]:o,url:s}=n;if(o&&!(e&&t instanceof le.HttpAbortError)){var c,u,l;delete n[pt];var p,d,f,v,m,y,w,{st:Z,time:S,perfStartTime:b}=o,{userInstanceId:I,username:A}=g();if(e){var O=t instanceof le.HttpResponseError;(O||t instanceof le.HttpParseError)&&(({status:m,headers:y}=t.response),O&&(w=t.responseJson))}else({status:m,data:w,headers:y}=t);(0,ue.isObject)(w)&&({code:p,message:d}=w),y instanceof Headers&&(f=y.get("x-b3-traceid"),v=y.get("content-length")),r={st:Z,_ver:Z,uid:I,username:A,time:S,et:a,page:location.href,duration:i-b,api:s,type:"api",code:null!==(c=p)&&void 0!==c?c:-1,msg:null!==(u=d)&&void 0!==u?u:"",status:m,traceId:null!==(l=f)&&void 0!==l?l:"",size:v?Number(v):-1},ot?ut.push((0,h.Z)((0,h.Z)({},r),{},{type:"apiRequest"},ot)):ct.push(r)}return e?Promise.reject(t):t}function mt(){var e=Math.round(performance.now()),t=Date.now();return ct.length=0,ot=null,function(n){var{status:r,path:i,pageTitle:a}=n;if("ok"!==r)return ut.push(...ct),void(ct.length=0);var o=Math.round(performance.now())-e,s=Date.now(),{username:c}=g();(function(e){var t,n,r=(t=URL.createObjectURL(new Blob([])),n=t.substring(t.lastIndexOf("/")+1),URL.revokeObjectURL(t),st&&(n="88-"+n,st=!1),n),{lt:i,route:a}=e;for(var o of(ot={lt:i,route:a,pageId:r},ut.push((0,h.Z)((0,h.Z)({},e),{},{pageId:r,apiCount:ct.length,maxApiTimeCost:Math.max(0,...ct.map((e=>e.duration))),size:ct.map((e=>e.size)).filter((e=>e>0)).reduce(((e,t)=>e+t),0)})),ct))ut.push((0,h.Z)((0,h.Z)({},o),ot));ct.length=0})({type:"page",page:location.href,_ver:t,time:Math.round(t/1e3),st:t,et:s,lt:o,pageTitle:a,username:c,route:i}),window.dispatchEvent(new CustomEvent("route.render",{detail:{renderTime:o}}))}}var yt=Object.freeze({checkPermissions:function(){if(!Z())return!1;if(g().isAdmin)return!0;for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r of t)switch(b.get(r)){case"unauthorized":case"undefined":return!1;case void 0:return console.error('Un-checked permission action: "'.concat(r,'", please make sure the permission to check is defined in permissionsPreCheck.')),!1}return!0},preCheckPermissions:function(e){if(Z()&&!g().isAdmin)return O((0,d.scanPermissionActionsInStoryboard)(e))},preCheckPermissionsForBrickOrRoute:function(e,t){return I.apply(this,arguments)}}),gt=new class{constructor(){(0,M.Z)(this,K),(0,E.Z)(this,$,{get:Q,set:void 0}),(0,E.Z)(this,H,{writable:!0,value:void 0}),(0,E.Z)(this,V,{writable:!0,value:{sub:new Map,unsub:new Map}}),(0,E.Z)(this,Y,{writable:!0,value:new Map})}subscribe(e,t){var n=JSON.stringify(t);return(0,P.Z)(this,K,X).call(this,"sub",e,t,n)}unsubscribe(e){var t=(0,C.Z)(this,Y).get(e);if(!t){var n='The message channel to unsubscribe "'.concat(e,'" is not found');return console.error(n),Promise.reject(new Error(n))}var r=JSON.parse(t),i=(0,P.Z)(this,K,X).call(this,"unsub",e,r,t);return(0,C.Z)(this,V).sub.delete(t),i.then((()=>{(0,C.Z)(this,Y).delete(e)})),i}onMessage(e,t){var n=(0,C.Z)(this,Y).get(e);n?(0,C.Z)(this,$).onMessage((e=>{"MESSAGE.PUSH"===e.event&&function(e,t){var n=JSON.parse(e);return n.system===t.system&&(n.topic===t.topic||"string"==typeof n.topic&&n.topic.includes("*")&&new RegExp("^".concat(n.topic.replace(/([^*]*)\*([^*]*)/g,((e,t,n)=>"".concat((0,p.escapeRegExp)(t),"[^/]*").concat((0,p.escapeRegExp)(n)))),"$")).test(t.topic))}(n,e.payload)&&t(e.payload.message)})):console.error('Message channel: "'.concat(e,'" not found'))}onClose(e){(0,C.Z)(this,$).onClose(e)}reset(){var e;(0,C.Z)(this,V).sub.clear(),(0,C.Z)(this,V).unsub.clear(),(0,C.Z)(this,Y).clear(),null===(e=(0,C.Z)(this,H))||void 0===e||e.reset()}},wt=function(){var e=(0,N.getV2RuntimeFromDll)();if(e)return Object.freeze((0,p.pick)(e,["authenticate","getAuth","isLoggedIn","logout"]))}()||r}}]);
//# sourceMappingURL=9213.7c396eda.js.map