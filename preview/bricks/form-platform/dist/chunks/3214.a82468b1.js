/*! For license information please see 3214.a82468b1.js.LICENSE.txt */
"use strict";(globalThis.webpackChunk_next_bricks_form_platform=globalThis.webpackChunk_next_bricks_form_platform||[]).push([[3214],{3214:(e,t,n)=>{n.r(t),n.d(t,{analytics:()=>u,auth:()=>ht,checkInstalledApps:()=>s,checkPermissions:()=>ft,flowApi:()=>r,menu:()=>i,messageDispatcher:()=>mt});var o={};n.r(o),n.d(o,{authenticate:()=>h,getAuth:()=>g,isLoggedIn:()=>v,logout:()=>A});var s={};n.r(s),n.d(s,{getCheckedApp:()=>se,preCheckInstalledApps:()=>ne,waitForCheckingApps:()=>oe});var r={};n.r(r),n.d(r,{FLOW_API_PROVIDER:()=>ae,clearCollectWidgetContract:()=>we,clearDebugContract:()=>Se,collectContract:()=>Ae,collectDebugContract:()=>ye,collectWidgetContract:()=>ve,getArgsOfFlowApi:()=>Ee,isFlowApiProvider:()=>Ie,registerFlowApiProvider:()=>le});var i={};n.r(i),n.d(i,{fetchMenuById:()=>Ve,getMenuById:()=>Je});var a={};n.r(a),n.d(a,{onRequest:()=>ct,onResponse:()=>ut,onResponseError:()=>lt});var c={};n.r(c),n.d(c,{create:()=>dt});var u={};n.r(u),n.d(u,{http:()=>a,initialize:()=>it,pageView:()=>c});var l=n(4958),p=n(6330),d=n(6730),f=function(){var e=(0,p.A)((function*(e,t){return(yield d.http.post("api/gateway/micro_app.permission.ValidatePermissions/api/micro_app/v1/permission/validate",e,t)).data}));return function(t,n){return e.apply(this,arguments)}}();const m={};function h(e){Object.assign(m,{org:e.org,username:e.username,userInstanceId:e.userInstanceId,loginFrom:e.loginFrom,accessRule:e.accessRule,isAdmin:e.isAdmin,csrfToken:e.csrfToken,license:e.license,accessToken:e.accessToken,userShowValue:e.userShowValue})}function g(){return{...m}}function A(){for(const e of Object.keys(m))m[e]=void 0;w.clear(),y.length=0,S.clear()}function v(){return void 0!==m.username}const w=new Map,y=[],S=new Map;function b(e){if(v()&&!g().isAdmin)return I((0,l.scanPermissionActionsInAny)(e))}async function I(e){const t=e.filter((e=>!y.includes(e)));if(0===t.length)return;const n=[],o=[];for(const e of t){const t=w.get(e);t?n.push(t):o.push(e)}if(o.length>0){const e=(async()=>{try{const e=await f({actions:o},{noAbortOnRouteChange:!0});for(const t of e.actions)S.set(t.action,t.authorizationStatus),"undefined"===t.authorizationStatus&&console.error(`Undefined permission action: "${t.action}"`)}catch(e){console.error("Pre-check permissions failed",e)}finally{y.push(...o)}})();for(const t of o)w.set(t,e);n.push(e)}await Promise.all(n)}var E=n(4635),k=n(918),O=n(5536),P=n(2559),M=n(6121),C=n(829),_=n(5223),T=n(1030);const N=1e3,$=5;var R=new WeakMap,D=new WeakMap,j=new WeakMap,W=new WeakMap,L=new WeakMap,x=new WeakMap,U=new WeakMap,B=new WeakSet;class F{constructor(e){(0,E.A)(this,B),(0,k.A)(this,R,void 0),(0,k.A)(this,D,void 0),(0,k.A)(this,j,[]),(0,k.A)(this,W,new Set),(0,k.A)(this,L,new Set),(0,k.A)(this,x,0),(0,k.A)(this,U,!1),(0,M.A)(R,this,e)}send(e){(0,C.A)(D,this)||(0,M.A)(D,this,(0,P.A)(B,this,q).call(this));const t=JSON.stringify(e);(0,C.A)(D,this).readyState===WebSocket.OPEN?(0,C.A)(D,this).send(t):(0,C.A)(j,this).push(t)}onMessage(e){(0,C.A)(W,this).add(e)}onClose(e){(0,C.A)(L,this).add(e)}reset(){(0,C.A)(j,this).length=0,(0,C.A)(W,this).clear(),(0,C.A)(L,this).clear()}close(){var e;(0,M.A)(U,this,!0),(null===(e=(0,C.A)(D,this))||void 0===e?void 0:e.readyState)===WebSocket.OPEN&&(0,C.A)(D,this).close()}}function q(){console.log("WebSocket connecting ...");const e=new WebSocket((0,C.A)(R,this));let t;return e.addEventListener("open",(n=>{console.log("WebSocket open:",n),t=setTimeout((()=>{t=void 0,(0,M.A)(x,this,0)}),1e3);for(const t of(0,C.A)(j,this))e.send(t);(0,C.A)(j,this).length=0})),e.addEventListener("close",(e=>{if(!(0,C.A)(U,this)){void 0!==t&&clearTimeout(t),console.log("WebSocket close:",e);for(const e of(0,C.A)(L,this))e();1e3!==e.code&&(0,P.A)(B,this,z).call(this)}})),e.addEventListener("error",(e=>{console.error("WebSocket error:",e)})),e.addEventListener("message",(e=>{const t=JSON.parse(e.data);for(const e of(0,C.A)(W,this))e(t)})),e}function z(){if((0,C.A)(x,this)>=$)return void console.error("WebSocket connect retry limit exceeded");const e=Math.pow(2,(0,C.A)(x,this))*N;console.log("WebSocket will reconnect after %d seconds",e/1e3),setTimeout((()=>{var e;(0,M.A)(x,this,(e=(0,C.A)(x,this),++e)),(0,M.A)(D,this,(0,P.A)(B,this,q).call(this))}),e)}var H=new WeakMap,G=new WeakMap,J=new WeakMap,V=new WeakSet;function Y(e){if(!(0,C.A)(H,e)){const t=`${"https:"===location.protocol?"wss:":"ws:"}//${window.location.host}${(0,_.getBasePath)()}api/websocket_service/v1/ws`;(0,M.A)(H,e,new F(t))}return(0,C.A)(H,e)}function K(e,t,n,o){const s=(0,C.A)(G,this)[e].get(o);if(s)return s;const r={event:"sub"===e?"TOPIC.SUB":"TOPIC.UNSUB",payload:n},i=new Promise(((t,o)=>{const s=Q(n);(0,O.A)(V,this,Y).onMessage((n=>{const r=n.event===("sub"===e?"TOPIC.SUB_SUCCESS":"TOPIC.UNSUB_SUCCESS"),i=n.event===("sub"===e?"TOPIC.SUB_FAILED":"TOPIC.UNSUB_FAILED");(r||i)&&s===Q(n.payload)&&(r?t:o)(n)})),(0,O.A)(V,this,Y).send(r)}));return"sub"===e&&(0,C.A)(J,this).set(t,o),(0,C.A)(G,this)[e].set(o,i),i}function Q(e){const{system:t,topic:n}=e;return JSON.stringify({system:t,topic:n})}var X=n(3496),Z=function(){var e=(0,p.A)((function*(e,t){return(yield X.http.post("api/gateway/micro_app_standalone.runtime.SearchMicroAppStandalone/api/v1/micro_app_standalone/search",e,t)).data}));return function(t,n){return e.apply(this,arguments)}}();const ee=new Map,te=new Map;function ne(e,t){if(window.STANDALONE_MICRO_APPS&&!window.NO_AUTH_GUARD){const n=function(e){const t={usedArgs:new Set},{customTemplates:n,menus:o}=e.meta??{};return(0,l.traverseStoryboardExpressions)([e.routes,n,o],((e,n)=>{(0,l.collectInstalledAppsHasUsage)(t,e,n)}),"INSTALLED_APPS"),[...t.usedArgs]}(e),o=[];for(const e of n)ee.has(e)||t(e)||o.push(e);if(0===o.length)return;const s=Z({query:{appId:{$in:o}},fields:["appId","currentVersion","installStatus"]}).catch((e=>{console.error("Get off site standalone micro-apps failed",e)}));for(const e of o)ee.set(e,s.then((t=>{var n;const o=null==t||null===(n=t.list)||void 0===n?void 0:n.find((t=>t.appId===e)),s=o?{...o,id:e}:void 0;return te.set(e,s),s})))}}async function oe(e){await Promise.all(e.map((e=>ee.get(e))))}function se(e){if(window.STANDALONE_MICRO_APPS)return te.get(e)}var re=n(3078),ie=n(108);const ae="core.provider-flow-api";function ce(e,t){return e.some((e=>e.source===t))}async function ue(e){let{url:t,originalUri:n,method:o="GET",responseWrapper:s=!0,ext_fields:r=[],request:i,isFileType:a,stream:c}=e;const u=["get","delete","head"].includes(o.toLowerCase()),l=a?{responseType:"blob"}:{};let p;for(var d=arguments.length,f=new Array(d>1?d-1:0),m=1;m<d;m++)f[m-1]=arguments[m];if(u){var h,g;let e,s;var A;if(n&&"object"===(null==i?void 0:i.type)&&((null===(h=n.match(/:([^/]+)/g))||void 0===h?void 0:h.length)??0)===((null===(g=i.fields)||void 0===g?void 0:g.length)??0)?[s]=f:[e,s]=f,c)return await(0,re.createSSEStream)(ie.http.getUrlWithParams(t,e),{...l,...s,method:o,headers:Object.fromEntries([...new Headers((null===(A=s)||void 0===A?void 0:A.headers)??{}).entries()])});p=await ie.http.simpleRequest(o,t,{params:e,...l,...s})}else{const e=function(e){if("object"!==(null==e?void 0:e.type))return!1;const t=e=>!(0,T.isEmpty)(e)&&e.some((e=>["file","file[]"].includes(e.type)||t(e.fields)));return t(e.fields)}(i),n=function(e){const t=ce(e,"query"),n=ce(e,"body");for(var o=arguments.length,s=new Array(o>1?o-1:0),r=1;r<o;r++)s[r-1]=arguments[r];if(t){if(n){const[e,t,n]=s;return{data:e,options:{params:t,...n}}}const[e,t]=s;return{data:{},options:{params:e,...t}}}const[i,a]=s;return{data:i,options:a}}(r,...f),s=e?function(e){if(e instanceof FormData)return e;const t=new FormData;for(const[n,o]of Object.entries(e))Array.isArray(o)?o.forEach((e=>{t.append(n,e)})):!(0,T.isObject)(o)||o instanceof Blob||o instanceof Date?t.append(n,o):Object.entries(o).forEach((e=>{let[o,s]=e;t.append(`${n}[${o}]`,s)}));return t}(n.data):n.data;if(c){var v;const{body:e,headers:r}=ie.http.getBodyAndHeaders(s,null===(v=n.options)||void 0===v?void 0:v.headers);return await(0,re.createSSEStream)(t,{...l,...n.options,method:o,headers:Object.fromEntries([...new Headers(r??{}).entries()]),body:e})}p=await ie.http.requestWithBody(o,t,s,{...l,...n.options})}return!a&&s?p.data:p}function le(){customElements.define(ae,(0,re.createProviderClass)(ue))}var pe=n(8679),de=function(){var e=(0,p.A)((function*(e,t){return(yield d.http.post("api/contract/single_search",e,t)).data}));return function(t,n){return e.apply(this,arguments)}}();const fe=new Map,me=new Map,he=new Map,ge=(e,t)=>{null==e||e.forEach((e=>{t.set(`${e.namespaceId}.${e.name}`,e)}))};function Ae(e){ge(e,fe)}function ve(e){ge(e,me)}function we(){me.clear()}function ye(e){ge(e,he)}function Se(){he.clear()}const be=new Map;function Ie(e){return e.includes("@")}async function Ee(e,t,n,o){if(!e.includes(":"))throw new Error(`You're using legacy Custom API "${e}" which is dropped in v3, please use Flow API instead`);const s=await async function(e){const[t,n]=e.split("@"),[o,s]=n.split(":"),r=function(e){return fe.get(e)||me.get(e)||he.get(e)}(`${t}.${o}`);if(r)return{name:r.name,namespace:r.namespaceId,serviceName:r.serviceName,version:r.version,contract:{endpoint:r.endpoint,response:r.response,request:r.request}};let i=be.get(e);return i||(i=async function(e,t,n){var o;const{contractData:s}=await de({contractName:`${e}.${t}`,version:n});return s?{name:s.name,namespace:null===(o=s.namespace)||void 0===o||null===(o=o[0])||void 0===o?void 0:o.name,serviceName:s.serviceName,version:s.version,contract:{endpoint:s.endpoint,response:s.response,request:s.request}}:null}(t,o,s),be.set(e,i)),i}(e);if(!s)throw new ke(`Flow API not found: "${e}"`);const r=function(e,t){var n;const o="string"==typeof t.contract?pe.safeLoad(t.contract,{schema:pe.JSON_SCHEMA,json:!0}):t.contract,{uri:s,method:r="GET",ext_fields:i}=(null==o?void 0:o.endpoint)??{},a=!(null==o||!o.response)&&!1!==o.response.wrapper;if(!s)throw new Error(`Missing endpoint.uri in contract of provider "${e}"`);return{uri:s,method:"list"===r.toLowerCase()?"get":r,ext_fields:i,name:t.name,namespace:t.namespace,serviceName:t.serviceName,version:t.version,isFileType:"file"===(null==o||null===(n=o.response)||void 0===n?void 0:n.type),responseWrapper:a,request:null==o?void 0:o.request}}(e,s);return function(e,t,n,o){let{uri:s,method:r,ext_fields:i,name:a,namespace:c,serviceName:u,responseWrapper:l,version:p,isFileType:d,request:f}=e;const m="saveAs"===n;let h;m&&(h=t.shift());const{url:g,args:A}=function(e,t,n,o,s,r){const i=r?"logic.api.gateway"===s||null!=s&&s.startsWith("logic.api.gateway.")?"":s?`api/gateway/${s}`:`api/gateway/${o}.${n}@${r}`:`api/gateway/api_service.${o}.${n}`,a=t.slice(),c=e.replace(/:([^/]+)/g,(()=>a.shift()));return{url:i?i+c:c.replace(/^\//,""),args:a}}(s,t,a,c,u,p);return[...m?[h]:[],{url:g,originalUri:s,method:r,ext_fields:i,responseWrapper:l,request:f,isFileType:d,stream:o},...A]}(r,t,n,o)}class ke extends Error{constructor(e){super(e),this.name="FlowApiNotFoundError",Error.captureStackTrace&&Error.captureStackTrace(this,ke)}}var Oe=n(3733),Pe=n(9740),Me=function(){var e=(0,p.A)((function*(e,t,n){return(yield d.http.get("api/gateway/micro_app.installed_micro_app.GetMenusInfo/api/v1/micro-app/menus/".concat(e),(0,Pe.A)((0,Pe.A)({},n),{},{params:t}))).data}));return function(t,n,o){return e.apply(this,arguments)}}(),Ce=n(6181);const _e=Symbol("appId"),Te=Symbol("menuI18nNamespace"),Ne=Symbol("overrideApp");async function $e(e,t,n){const o=e.find((e=>"inject"!==e.type));if(!o)return;const s=[],r=new Map,i=new WeakMap;for(const t of e)if(t.i18n){const e=`menu/${t.menuId}~${t.app[0].appId}+${t.instanceId}`;Object.entries(t.i18n).forEach((t=>{let[n,o]=t;Ce.i18n.addResourceBundle(n,e,o)})),i.set(t,e)}await Promise.all(e.map((e=>async function(e,t,n,o){if(e.dynamicItems&&e.itemsResolve){const r=e.app[0].appId,i={...t,pendingPermissionsPreCheck:[...t.pendingPermissionsPreCheck,b(e.itemsResolve)]};var s;r!==t.app.id&&(i.overrideApp=window.STANDALONE_MICRO_APPS?e.overrideApp:null===(s=o.getStoryboardByAppId(r))||void 0===s?void 0:s.app,i.appendI18nNamespace=n.get(e));const a=await o.resolveData({transform:"items",...e.itemsResolve},i);e.items=a.items}}(e,t,i,n))));for(const t of e){var a;if(null!==(a=t.items)&&void 0!==a&&a.length)if("inject"===t.type&&t.injectMenuGroupId){let e=r.get(t.injectMenuGroupId);e||(e=[],r.set(t.injectMenuGroupId,e)),e.push(t)}else s.push(t)}return{...o,items:s.flatMap((e=>Re(e.items,e,r,i))),[Te]:i.get(o),[Ne]:o.overrideApp}}function Re(e,t,n,o){return null==e?void 0:e.map((e=>{const s=e.groupId&&n.get(e.groupId);return s&&n.delete(e.groupId),{...e,children:(Re(e.children,t,n,o)??[]).concat(s?s.flatMap((e=>Re(e.items,e,n,o))):[]),[_e]:t.app[0].appId,[Te]:o.get(t),[Ne]:t.overrideApp}}))}function De(e){e.items=je(e.items)}function je(e){return function(e){return(0,T.sortBy)(e,(e=>e.sort??-1/0))}(e).map((e=>({...e,children:je(e.children)})))}var We=n(1744),Le=n(522);function xe(e,t,n,o){if("titleDataSource"in e&&(0,re.isObject)(e.titleDataSource)&&Object.entries(e.titleDataSource).every((e=>{let[,t]=e;return null===t||""===t}))&&delete e.titleDataSource,"if"in e&&null===e.if&&delete e.if,"to"in e&&e.to&&!(0,Le.isEvaluable)(e.to)){const t=We.pipes.yaml(e.to);(0,re.isObject)(t)&&["pathname","search","hash"].some((e=>(0,re.hasOwnProperty)(t,e)))&&(e.to=t)}let s=n;if(t!==n.app.id){var r;const i=window.STANDALONE_MICRO_APPS?e[Ne]:null===(r=o.getStoryboardByAppId(t))||void 0===r?void 0:r.app;s={...n,overrideApp:i,appendI18nNamespace:e[Te]}}return o.asyncComputeRealValue(e,s,{ignoreSymbols:!0})}function Ue(e,t,n){return Promise.all(e.map((async e=>{let{children:o,...s}=e;const[r,i]=await Promise.all([xe(s,s[_e],t,n),o&&await Ue(o,t,n)]);return{...r,children:i}})))}var Be=function(){var e=(0,p.A)((function*(e,t,n,o){return(yield X.http.get("api/gateway/cmdb.instance.GetDetail/object/".concat(e,"/instance/").concat(t),(0,Pe.A)((0,Pe.A)({},o),{},{params:n}))).data}));return function(t,n,o,s){return e.apply(this,arguments)}}();const Fe=new Map;async function qe(e){if(e.title||(0,T.isEmpty)(e.titleDataSource))return e.title;const t=JSON.stringify(e.titleDataSource),n=Fe.get(t);if(void 0!==n)return n;const{objectId:o,instanceId:s,attributeId:r}=e.titleDataSource,i=r??"name",a=await Be(o,s,{fields:i});let c;if("#showKey"===r&&Array.isArray(a[i])){const[e,...t]=a[i];c=t.length>0?`${e}(${t.join(",")})`:String(e)}else c=String(a[i]);return Fe.set(t,c),c}const ze=new Map,He=new Map;function Ge(e){return null==e?void 0:e.filter(_.checkIfOfComputed).map((e=>{const t=Ge(e.children);return"group"===e.type?{type:"group",title:e.text,childLayout:e.childLayout,items:t,groupId:e.groupId,groupFrom:e.groupFrom}:null!=t&&t.length?{type:"subMenu",childLayout:e.childLayout,title:e.text,icon:e.icon,items:t,defaultExpanded:e.defaultExpanded}:(0,T.omit)(e,["type","items","children"])}))}function Je(e){return He.get(e)}function Ve(e,t,n){let o=ze.get(e);return o||(o=async function(e,t,n){const o=window.STANDALONE_MICRO_APPS?function(e,t,n){var o,s;const r=n.getStoryboardByAppId(t);return((null===(o=r.meta)||void 0===o?void 0:o.injectMenus)??(null===(s=r.meta)||void 0===s?void 0:s.menus)??[]).filter((t=>t.menuId===e)).map((e=>{var n;return{...e,...null!==(n=e.app)&&void 0!==n&&null!==(n=n[0])&&void 0!==n&&n.appId?{}:{app:[{appId:t}]}}}))}(e,t.app.id,n):t.flags["three-level-menu-layout"]?(await Me(e,{menuObjectId:"EASYOPS_STORYBOARD_MENU"})).menus:(await(0,Oe.n)("EASYOPS_STORYBOARD_MENU",{page:1,page_size:200,fields:{menuId:!0,title:!0,icon:!0,link:!0,titleDataSource:!0,defaultCollapsed:!0,defaultCollapsedBreakpoint:!0,type:!0,injectMenuGroupId:!0,dynamicItems:!0,itemsResolve:!0,items:!0,i18n:!0,"items.children":!0,"app.appId":!0},query:{menuId:{$eq:e},app:{$size:{$gt:0}}}})).list,s=await $e(o,t,n);if(!s)throw new Error(`Menu not found: ${e}`);De(s);const{items:r,app:i,...a}=s,c={...t,pendingPermissionsPreCheck:[...t.pendingPermissionsPreCheck,b([r,a])]};delete c.tplStateStoreId,delete c.forEachItem,delete c.forEachIndex,delete c.forEachSize;const u=i[0].appId,[l,p]=await Promise.all([xe(a,u,c,n),Ue(r,c,n)]),d={title:await qe(l),...(0,T.pick)(l,["icon","link","defaultCollapsed","defaultCollapsedBreakpoint"]),menuItems:Ge(p)};He.set(e,d)}(e,t,n)),o}const Ye=[];let Ke=null;const Qe={maxWaitingTime:5e3,maxLoggedEvents:10};function Xe(){clearTimeout(Ke),Ye.length>Qe.maxLoggedEvents?Ze():Ke=setTimeout(Ze,Qe.maxWaitingTime)}function Ze(){if(0===Ye.length)return;const e={model:"easyops.FRONTEND_STAT",columns:["_ver","st","et","lt","size","time","traceId","code","duration","page","uid","username","api","type","msg","status","pageId","route","apiCount","maxApiTimeCost","apiSizeCost","pageTitle"],data:Ye.splice(0,Qe.maxLoggedEvents)};var t;!function(e,t){const n=new Blob([JSON.stringify(t)],{type:"application/json"});window.navigator.sendBeacon(e,n)}(Qe.api,e),Ye.length&&(t=Ze,(window.requestIdleCallback||window.requestAnimationFrame||(e=>setTimeout(e,17)))(t))}function et(){window.addEventListener("beforeunload",Ze,!1)}let tt,nt=!1,ot=null,st=!0;const rt=[];function it(e){nt||(nt=!0,tt||(tt=function(e,t){return Object.assign(Qe,{...t,api:e}),{sendOnExit:et,emit:Xe}}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),tt.sendOnExit()))}const at=Symbol("HttpAnalytics");function ct(e){const t=Math.round(performance.now()),n=Date.now();return e[at]={st:n,time:Math.round(n/1e3),perfStartTime:t},e}function ut(e,t){return pt(!1,e,t)}function lt(e,t){return pt(!0,e,t)}function pt(e,t,n){const o=Math.round(performance.now()),s=Date.now(),{[at]:r,url:i}=n;if(r&&!(e&&t instanceof ie.HttpAbortError)){delete n[at];const{st:c,time:u,perfStartTime:l}=r,{userInstanceId:p,username:d}=g();let f,m,h,A,v,w,y;if(e){const e=t instanceof ie.HttpResponseError;(e||t instanceof ie.HttpParseError)&&(({status:v,headers:w}=t.response),e&&(y=t.responseJson))}else({status:v,data:y,headers:w}=t);(0,re.isObject)(y)&&({code:f,message:m}=y),w instanceof Headers&&(h=w.get("x-b3-traceid"),A=w.get("content-length")),a={st:c,_ver:c,uid:p,username:d,time:u,et:s,page:location.href,duration:o-l,api:i,type:"api",code:f??-1,msg:m??"",status:v,traceId:h??"",size:A?Number(A):-1},ot?Ye.push({...a,type:"apiRequest",...ot}):rt.push(a)}var a;return e?Promise.reject(t):t}function dt(){const e=Math.round(performance.now()),t=Date.now();return rt.length=0,ot=null,function(n){let{status:o,path:s,pageTitle:r}=n;if("ok"!==o)return Ye.push(...rt),void(rt.length=0);const i=Math.round(performance.now())-e,a=Date.now(),{username:c}=g();(function(e){const t=function(){const e=URL.createObjectURL(new Blob([]));let t=e.substring(e.lastIndexOf("/")+1);return URL.revokeObjectURL(e),st&&(t="88-"+t,st=!1),t}(),{lt:n,route:o}=e;ot={lt:n,route:o,pageId:t},Ye.push({...e,pageId:t,apiCount:rt.length,maxApiTimeCost:Math.max(0,...rt.map((e=>e.duration))),size:rt.map((e=>e.size)).filter((e=>e>0)).reduce(((e,t)=>e+t),0)});for(const e of rt)Ye.push({...e,...ot});rt.length=0,tt.emit()})({type:"page",page:location.href,_ver:t,time:Math.round(t/1e3),st:t,et:a,lt:i,pageTitle:r,username:c,route:s}),window.dispatchEvent(new CustomEvent("route.render",{detail:{renderTime:i}}))}}const ft=Object.freeze({checkPermissions:function(){if(!v())return!1;if(g().isAdmin)return!0;for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const e of t)switch(S.get(e)){case"unauthorized":case"undefined":return!1;case void 0:return console.error(`Un-checked permission action: "${e}", please make sure the permission to check is defined in permissionsPreCheck.`),!1}return!0},preCheckPermissions:function(e){if(v()&&!g().isAdmin)return I((0,l.scanPermissionActionsInStoryboard)(e))},preCheckPermissionsForBrickOrRoute:async function(e,t){if(v()&&!g().isAdmin&&Array.isArray(e.permissionsPreCheck))return I(await t(e.permissionsPreCheck))}}),mt=new class{constructor(){(0,E.A)(this,V),(0,k.A)(this,H,void 0),(0,k.A)(this,G,{sub:new Map,unsub:new Map}),(0,k.A)(this,J,new Map)}subscribe(e,t){const n=JSON.stringify(t);return(0,P.A)(V,this,K).call(this,"sub",e,t,n)}unsubscribe(e){const t=(0,C.A)(J,this).get(e);if(!t){const t=`The message channel to unsubscribe "${e}" is not found`;return console.error(t),Promise.reject(new Error(t))}const n=JSON.parse(t),o=(0,P.A)(V,this,K).call(this,"unsub",e,n,t);return(0,C.A)(G,this).sub.delete(t),o.then((()=>{(0,C.A)(J,this).delete(e)})),o}onMessage(e,t){let n=(0,C.A)(J,this).get(e),o=!1;(0,O.A)(V,this,Y).onMessage((s=>{n||(n=(0,C.A)(J,this).get(e)),n?"MESSAGE.PUSH"===s.event&&function(e,t){const n=JSON.parse(e);return n.system===t.system&&(n.topic===t.topic||"string"==typeof n.topic&&n.topic.includes("*")&&new RegExp(`^${n.topic.replace(/([^*]*)\*([^*]*)/g,((e,t,n)=>`${(0,T.escapeRegExp)(t)}[^/]*${(0,T.escapeRegExp)(n)}`))}$`).test(t.topic))}(n,s.payload)&&t(s.payload.message):o||(console.error(`Message channel: "${e}" not found`),o=!0)}))}onClose(e){(0,O.A)(V,this,Y).onClose(e)}reset(){var e;(0,C.A)(G,this).sub.clear(),(0,C.A)(G,this).unsub.clear(),(0,C.A)(J,this).clear(),null===(e=(0,C.A)(H,this))||void 0===e||e.reset()}},ht=function(){const e=(0,_.getV2RuntimeFromDll)();if(e)return Object.freeze((0,T.pick)(e,["authenticate","getAuth","isLoggedIn","logout"]))}()||o}}]);
//# sourceMappingURL=3214.a82468b1.js.map