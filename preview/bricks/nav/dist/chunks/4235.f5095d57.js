/*! For license information please see 4235.f5095d57.js.LICENSE.txt */
"use strict";(globalThis.webpackChunk_next_bricks_nav=globalThis.webpackChunk_next_bricks_nav||[]).push([[4235,1369],{2559:(e,t,n)=>{function r(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}n.d(t,{A:()=>r})},2016:(e,t,n)=>{function r(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}n.d(t,{A:()=>r})},829:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(2559);function o(e,t){return e.get((0,r.A)(e,t))}},918:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(2016);function o(e,t,n){(0,r.A)(e,t),t.set(e,n)}},6121:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(2559);function o(e,t,n){return e.set((0,r.A)(e,t),n),n}},4635:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(2016);function o(e,t){(0,r.A)(e,t),t.add(e)}},4586:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(1369);function o(e,t,n){return(t=(0,r.A)(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},1369:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(7545);function o(e){var t=function(e,t){if("object"!=(0,r.A)(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!=(0,r.A)(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==(0,r.A)(t)?t:t+""}},7545:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}n.d(t,{A:()=>r})},4235:(e,t,n)=>{n.r(t),n.d(t,{Dialog:()=>Xt,Notification:()=>on,StoryboardFunctionRegistryFactory:()=>pe,__secret_internals:()=>r,__test_only:()=>{},applyTheme:()=>te,authenticate:()=>xa,batchSetAppsLocalTheme:()=>ne,checkIfByTransform:()=>St,checkIfOfComputed:()=>Et,createHistory:()=>A,createRuntime:()=>Ea,customEditors:()=>Na,customProcessors:()=>M,customTemplates:()=>Pe,fetchByProvider:()=>Ua,getAuth:()=>Ma,getBasePath:()=>p,getCssPropertyValue:()=>ce,getCurrentMode:()=>ie,getCurrentTheme:()=>ee,getHistory:()=>k,getPageInfo:()=>fo,getRealValue:()=>ja,getRuntime:()=>Sa,getV2RuntimeFromDll:()=>S,handleHttpError:()=>rn,httpErrorToString:()=>Qt,instantiateModalStack:()=>Ka,isLoggedIn:()=>$a,isUnauthenticatedError:()=>Zt,logout:()=>La,matchPath:()=>Bt,registerWidgetFunctions:()=>Be,registerWidgetI18n:()=>N,setUIVersion:()=>ho,unstable_createRoot:()=>Fa});var r={};n.r(r),n.d(r,{addRealTimeDataInspectHook:()=>Pr,debugDataValue:()=>Cr,getAddedContracts:()=>Ir,getAllContextValues:()=>wr,getBrickPackagesById:()=>Er,getContextValue:()=>yr,getLegalRuntimeValue:()=>Rr,getRenderId:()=>kr,legacyDoTransform:()=>ur,loadBricks:()=>Sr,loadEditors:()=>Ar,mountUseBrick:()=>cr,renderUseBrick:()=>sr,setRealTimeDataInspectRoot:()=>_r,symbolForRootRuntimeContext:()=>ir,unmountUseBrick:()=>lr,updateSnippetPreviewSettings:()=>vr,updateStoryboard:()=>dr,updateStoryboardByRoute:()=>fr,updateStoryboardBySnippet:()=>gr,updateStoryboardByTemplate:()=>pr,updateTemplatePreviewSettings:()=>hr});var o=n(4586),a=n(918),i=n(6121),s=n(829),c=n(6181),l=n(49),u=n(3078),d=n(1302),f=(n(6036),n(2890));function p(){const e=document.querySelector("base");return e?e.getAttribute("href"):"/"}var h=n(1030);function m(e,t){const n=(0,h.orderBy)(e,(e=>{var t;return(null===(t=e.app.homepage)||void 0===t?void 0:t.length)??0}),"desc");for(const e of n){const n=e.app.homepage;if("string"==typeof n&&"/"===n[0]&&g(n,t))return e}}function g(e,t){return"/"===e?t===e:`${t.replace(/\/+$/,"")}/`.startsWith(`${e.replace(/\/+$/,"")}/`)}function v(e){var t;return!e||(null===(t=Sa().getCurrentApp())||void 0===t?void 0:t.id)!==e.app.id&&!window.STANDALONE_MICRO_APPS&&e.app.standaloneMode}let b,y=!1;function w(e,t){y=!confirm(e),t(!y)}function E(e){const{push:t,replace:n}=e;function r(r){return function(o,a,i){let s;const c="string"==typeof o;return s=c?(0,f.parsePath)(o).pathname:o.pathname,"string"==typeof s&&s.startsWith("/")&&v(function(e){var t;return m((null===(t=va)||void 0===t?void 0:t.storyboards)??[],e)}(s))?location["push"===r?"assign":"replace"](c?p()+o.substring(1):e.createHref(o)):("push"===r?t:n)(o,a,i)}}return{push:r("push"),replace:r("replace")}}function S(){var e;const{dll:t}=window;if(t&&null!==(e=window.BRICK_NEXT_VERSIONS)&&void 0!==e&&null!==(e=e["brick-container"])&&void 0!==e&&e.startsWith("2."))return t("tYg3")}function A(){if(!b){const e=(0,f.createBrowserHistory)({basename:p().replace(/\/$/,""),getUserConfirmation:w});Object.assign(e,function(e){const{push:t,replace:n}=e;function r(e,n,r){y=!1,t(e,n),null==r||r(y)}function o(e,t,r){y=!1,n(e,t),null==r||r(y)}function a(t){return function(n){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;const{extraQuery:s,clear:c,keepHash:l,...u}=a,d=new URLSearchParams(c?"":e.location.search),f={};Object.assign(f,n,s);for(const[e,t]of Object.entries(f))if(Array.isArray(t)){d.delete(e);for(const n of t)d.append(e,n)}else null==t||""===t?d.delete(e):d.set(e,t);("push"===t?r:o)(`?${d.toString()}${l?e.location.hash:""}`,u,i)}}let i;return{pushQuery:a("push"),replaceQuery:a("replace"),pushAnchor:function(t,n,o){r({...e.location,key:void 0,hash:t,state:{notify:!1,...n}},void 0,o)},reload:function(t){o({...e.location,state:{...e.location.state,notify:!0,noIncremental:!0}},void 0,t)},setBlockMessage:function(e){i=e},getBlockMessage:function(){return i},unblock:function(){i=void 0},...E({...e,push:r,replace:o})}}(e)),b=e}return b}const k=function(){const e=S();if(e)return e.getHistory}()||function(){return b};var I=n(4635),C=n(2559),R=n(108),O=n(522),T=n(4958),_=n(1491),P=n(9613),x=new WeakMap;const M=function(){const e=S();if(e)return Object.freeze({define:(t,n)=>e.getRuntime().registerCustomProcessor(t,n)})}()||new class{constructor(){(0,a.A)(this,x,new Map)}define(e,t){const[n,r]=e.split(".");let o=(0,s.A)(x,this).get(n);if(o||(o=new Map,(0,s.A)(x,this).set(n,o)),o.has(r))throw new Error(`Custom processor of "${e}" already registered`);o.set(r,t)}get(e){return(0,s.A)(x,this).get(e)}};function L(e){let{app:t,meta:n}=e;if(null!=n&&n.i18n){const e=$("app",t.id),r=[];return Object.entries(n.i18n).forEach((t=>{let[n,o]=t;c.i18n.addResourceBundle(n,e,o),r.push(n)})),()=>{for(const t of r)c.i18n.removeResourceBundle(t,e)}}}function $(e,t){return`${e}/${t}`}function B(e){return c.i18n.getFixedT(null,$("widget",e))}const N=function(){const e=S();if(e)return function(t,n){return e.getRuntime().registerWidgetI18n(t,n)}}()||function(e,t){const n=$("widget",e);Object.entries(t).forEach((e=>{let[t,r]=e;c.i18n.addResourceBundle(t,n,r)}))},U="brick-next-devtools-panel",F="devtools-frame-active-change",j="devtools-panel-change";let D,K=!0;function V(e,t){const n=W();if(!n||"evaluation"===e&&(!K||D&&"Evaluations"!==D))return;const r=()=>{var r;null===(r=n.emit)||void 0===r||r.call(n,{type:e,payload:t})};"function"==typeof window.requestIdleCallback?window.requestIdleCallback(r):setTimeout(r,0)}function W(){return window.__BRICK_NEXT_DEVTOOLS_HOOK__}const H=()=>{throw new Error("Can't modify read-only proxy object")},z={set:H,defineProperty:H,deleteProperty:H,setPrototypeOf:H};function G(e){return new Proxy(e,z)}function q(e){let{get:t,ownKeys:n}=e;return W()?G(Object.fromEntries(n(null).map((e=>[e,t(null,e,null)])))):new Proxy(Object.freeze({}),{get:t})}let Y="light";const X=new u.JsonStorage(localStorage),J="apps-theme";function Q(e){if("dark"!==e&&"light"!==e&&"dark-v2"!==e)throw new Error(`Unsupported theme: ${e}`);Y=e}function Z(){return Y}function ee(){return document.documentElement.dataset.theme}function te(e){e?Q(e):e=Z(),e!==ee()&&(document.documentElement.dataset.theme=e,window.dispatchEvent(new CustomEvent("theme.change",{detail:e})))}function ne(e){X.setItem(J,{...re(),...e})}function re(){let e;try{e=X.getItem(J)}catch{console.error("JSON parse error inside `getLocalAppsTheme()`")}return e??{}}let oe="default";function ae(e){if("dashboard"!==e&&"default"!==e)throw new Error(`Unsupported mode: ${e}`);oe=e}function ie(){return document.documentElement.dataset.mode}function se(e){e?ae(e):e=oe,e!==ie()&&(document.documentElement.dataset.mode=e,window.dispatchEvent(new CustomEvent("mode.change",{detail:e})))}function ce(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.documentElement;return n&&(null===(t=window.getComputedStyle(n))||void 0===t?void 0:t.getPropertyValue(e))||""}function le(e,t){const n={};for(const r of e){const e=ue(r,t);void 0!==e&&(n[r]=e)}return n}function ue(e,t){var n,r,o;let{collectCoverage:a,widgetId:i,widgetVersion:s,app:l,appendI18nNamespace:u,storyboardFunctions:d,isStoryboardFunction:f}=t;switch(e){case"BASE_URL":return a?"/next":p().replace(/\/$/,"");case"FN":return d;case"IMG":return a?{get:e=>`mock/images/${e}`}:i?null==wa||null===(n=wa.images)||void 0===n?void 0:n.widgetImagesFactory(i,s):null==wa||null===(r=wa.images)||void 0===r?void 0:r.imagesFactory(l.id,l.isBuildPush,l.currentVersion);case"I18N":return a?h.identity:i?B(i):c.i18n.getFixedT(null,[u,$("app",l.id)].filter(Boolean));case"I18N_TEXT":return a?de:c.i18nText;case"PERMISSIONS":return G({check:a?fe:null==wa||null===(o=wa.checkPermissions)||void 0===o?void 0:o.checkPermissions});case"THEME":return G({getTheme:a?()=>"light":Z,getCssPropertyValue:a?()=>"":ce});case"console":return f?G(console):void 0;case"location":return a?{href:"http://localhost:3000/functions/test",origin:"http://localhost:3000",host:"localhost:3000",hostname:"localhost"}:{href:location.href,origin:location.origin,host:location.host,hostname:location.hostname}}}function de(e){return null==e?void 0:e.en}function fe(){return!0}function pe(){let{widgetId:e,widgetVersion:t,collectCoverage:n,debuggerOverrides:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const o=new Map,a=null==r?void 0:r({precookFunction:O.precookFunction,cook:O.cook,supply:P.supply}),i=new Proxy(Object.freeze({}),{get:(c,l)=>function(c){const l=o.get(c);if(!l)return;if(l.processed)return l.cooked;let u;n&&(u=n.createCollector(c));const d=(0,O.precookFunction)(l.source,{typescript:l.typescript,hooks:u&&{beforeVisit:u.beforeVisit},cacheKey:l}),f=(0,P.supply)(d.attemptToVisitGlobals,le(d.attemptToVisitGlobals,{collectCoverage:n,widgetId:e,widgetVersion:t,app:s,storyboardFunctions:i,isStoryboardFunction:!0}),!!n);return l.cooked=(0,O.cook)(d.function,l.source,{rules:{noVar:!0},globalVariables:a?{...f,...null!=a&&a.LodashWithStaticFields&&d.attemptToVisitGlobals.has("_")?{_:{...f._,...a.LodashWithStaticFields}}:null,...null!=a&&a.ArrayConstructor&&d.attemptToVisitGlobals.has("Array")?{Array:a.ArrayConstructor}:null,...null!=a&&a.ObjectWithStaticFields&&d.attemptToVisitGlobals.has("Object")?{Object:{...f.Object,...a.ObjectWithStaticFields}}:null}:f,ArrayConstructor:null==a?void 0:a.ArrayConstructor,hooks:u&&{beforeEvaluate:u.beforeEvaluate,beforeCall:u.beforeCall,beforeBranch:u.beforeBranch},debug:!!r}),l.processed=!0,l.cooked}(l)});let s;return{storyboardFunctions:i,registerStoryboardFunctions:function(e,t){if(t&&(s=t),o.clear(),Array.isArray(e))for(const t of e){let e=t.deps;null==e&&(e=(0,T.collectMemberUsageInFunction)(t,"FN",!!n),e.delete(t.name));const r=t.perm??(0,T.collectMemberUsageInFunction)(t,"PERMISSIONS",!!n).has("check");o.set(t.name,{source:t.source,typescript:t.typescript,deps:e,hasPermissionsCheck:r})}},updateStoryboardFunction(e,t){const n={...t,name:e},r=(0,T.collectMemberUsageInFunction)(n,"FN",!0),a=(0,T.collectMemberUsageInFunction)(n,"PERMISSIONS",!0).has("check");o.set(e,{source:t.source,typescript:t.typescript,deps:r,hasPermissionsCheck:a})},checkPermissionsUsage(e){const t=new Set,n=e=>{if(!t.has(e)){t.add(e);const r=o.get(e);return!!r&&(r.hasPermissionsCheck||[...r.deps].some(n))}return!1};return e.some(n)},clearGlobalExecutionContextStack(){(0,O.__dev_only_clearGlobalExecutionContextStack)()},getGlobalExecutionContextStack:()=>(0,O.__dev_only_getGlobalExecutionContextStack)()}}const{storyboardFunctions:he,registerStoryboardFunctions:me,checkPermissionsUsage:ge}=pe();var ve={};try{ve.EventTarget=(new EventTarget).constructor}catch(e){!function(e,t){var n=e.create,r=e.defineProperty,o=a.prototype;function a(){t.set(this,n(null))}function i(e,t,n){r(e,t,{configurable:!0,writable:!0,value:n})}function s(e){var t=e.options;return t&&t.once&&e.target.removeEventListener(this.type,e.listener),"function"==typeof e.listener?e.listener.call(e.target,this):e.listener.handleEvent(this),this._stopImmediatePropagationFlag}i(o,"addEventListener",(function(e,n,r){for(var o=t.get(this),a=o[e]||(o[e]=[]),i=0,s=a.length;i<s;i++)if(a[i].listener===n)return;a.push({target:this,listener:n,options:r})})),i(o,"dispatchEvent",(function(e){var n=t.get(this)[e.type];return n&&(i(e,"target",this),i(e,"currentTarget",this),n.slice(0).some(s,e),delete e.currentTarget,delete e.target),!0})),i(o,"removeEventListener",(function(e,n){for(var r=t.get(this),o=r[e]||(r[e]=[]),a=0,i=o.length;a<i;a++)if(o[a].listener===n)return void o.splice(a,1)})),ve.EventTarget=a}(Object,new WeakMap)}const be=ve.EventTarget;let ye=function(e){return e.xLarge="xLarge",e.large="large",e.medium="medium",e.small="small",e.xSmall="xSmall",e}({});const we=new Map([[ye.xLarge,"1920px"],[ye.large,"1600px"],[ye.medium,"1280px"],[ye.small,"1024px"],[ye.xSmall,0]]),Ee=new be,Se={},Ae={};function ke(e,t){let n=!1;Se[t]=e.matches;for(const[e]of we)if(Se[e]&&Ae.breakpoint!==e){Ae.breakpoint=e,n=!0;break}n&&Ee.dispatchEvent(new CustomEvent("change",{detail:Ae}))}we.forEach(((e,t)=>{const n=window.matchMedia(`(min-width: ${e})`);ke(n,t),n.addEventListener?n.addEventListener("change",(e=>{ke(e,t)})):n.addListener((e=>{ke(e,t)}))}));const Ie=()=>Ae;function Ce(e){return function(t){const n="local"===e?localStorage:sessionStorage;return JSON.parse(n.getItem(t)??"null")}}function Re(e){var t,n;return!(null===(t=e?e.flags:null===(n=Sa())||void 0===n?void 0:n.getFeatureFlags())||void 0===t||!t["brick-next-v3-strict-mode"])}function Oe(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];const a=0===r.length?"":",";e?console.error(`${t} is dropped in v3 strict mode${a}`,...r):console.warn(`${t} is deprecated in v3 and will be dropped in strict mode${a}`,...r)}const Te=new Set(["prefix"]);var _e=new WeakMap;const Pe=function(){const e=S();if(e)return Object.freeze({define:(t,n)=>e.getRuntime().registerCustomTemplate(t,n)})}()||new class{constructor(){(0,a.A)(this,_e,new Map)}define(e,t){var n,r;let o=(0,s.A)(_e,this).has(e);o?console.warn(`Custom template of "${e}" already registered.`):(o=!!customElements.get(e),o&&console.warn(`Custom template of "${e}" already defined by customElements.`));const a=Re(),i=(null===(n=t.proxy)||void 0===n?void 0:n.properties)??{},c=[],l=[];for(const[t,n]of Object.entries(i))n.asVariable?(Oe(a,"Template `asVariable`",e,t),a||l.push(t)):n.mergeProperty||n.refTransform?console.error("Template `mergeProperty` and `refTransform` are dropped in v3:",e,t):n.ref&&c.push([t,n]);const u={...t,proxy:{...t.proxy,properties:Object.fromEntries(c)},state:(t.state?a?t.state:t.state.map((e=>({expose:!0,...e}))):[]).concat(l.map((e=>({name:e,expose:!0}))))};(0,s.A)(_e,this).set(e,{...u,name:e});const d=(f=u.state,(0,h.uniq)((null==f?void 0:f.filter((e=>e.expose)).map((e=>e.name)))??[]));var f;const p=Object.entries((null===(r=u.proxy)||void 0===r?void 0:r.methods)??{}),m=d.concat(c.map((e=>e[0]))),g=p.map((e=>e[0])),v=m.concat(g).filter((e=>e in HTMLElement.prototype&&!Te.has(e)));if(v.length>0&&(Oe(a,"Using native HTMLElement properties as template properties or methods",e,...v),a))throw new Error(`In custom template "${e}", ${v.map((e=>`"${e}"`)).join(", ")} are native HTMLElement properties, and should be avoid to be used as brick properties or methods.`);if(!o){class t extends HTMLElement{get $$typeof(){return"custom-template"}static get _dev_only_definedProperties(){return m}static get _dev_only_definedMethods(){return g}$$getElementByRef(e){var t;return null===(t=this.$$tplStateStore)||void 0===t||null===(t=t.hostBrick)||void 0===t||null===(t=t.tplHostMetadata)||void 0===t||null===(t=t.internalBricksByRef.get(e))||void 0===t?void 0:t.element}connectedCallback(){let e=this.shadowRoot;e||(e=this.attachShadow({mode:"open"}));const t=document.createDocumentFragment(),n=document.createElement("style");n.textContent=":host{display:block}:host([hidden]){display:none}";const r=document.createElement("slot");t.appendChild(n),t.appendChild(r),e.appendChild(t)}disconnectedCallback(){this.shadowRoot&&(this.shadowRoot.textContent="")}}for(const n of d)c.some((e=>e[0]===n))?console.error(`Cannot define an exposed state that is also a proxy property: "${n}" in ${e}`):Object.defineProperty(t.prototype,n,{get(){return this.$$tplStateStore.getValue(n)},set(e){var t;null===(t=this.$$tplStateStore)||void 0===t||t.updateValue(n,e,"replace")},enumerable:!0});for(const[e,n]of c)Object.defineProperty(t.prototype,e,{get(){return this.$$getElementByRef(n.ref)[n.refProperty??e]},set(t){var r;const o=null===(r=this.$$getElementByRef)||void 0===r?void 0:r.call(this,n.ref);o&&(o[n.refProperty??e]=t)},enumerable:!0});for(const[e,n]of p)Object.defineProperty(t.prototype,e,{value(){return this.$$getElementByRef(n.ref)[n.refMethod??e](...arguments)},enumerable:!0});customElements.define(e,t)}}get(e){return(0,s.A)(_e,this).get(e)}};function xe(e,t,n){let{tplStateStoreId:r,tplStateStoreMap:o}=e;if(!r)throw new Error(`Using "${t}" outside of a custom template${n??""}`);const a=o.get(r);if(!a)throw new Error(`Template state store is not found when using "${t}"${n??""}.\nThis is a bug of Brick Next, please report it.`);return a}function Me(e,t,n){const r=xe(e,t,n).hostBrick.element;if(!r)throw new Error(`Template host element is gone when using "${t}"${n??""}.\nThis is a bug of Brick Next, please report it.`);return r}const Le=new Map,$e=new Proxy(Object.freeze({}),{get:(e,t)=>Le.get(t)}),Be=function(){const e=S();if(e)return function(t,n,r){return e.getRuntime().registerWidgetFunctions(t,n,r)}}()||function(e,t,n){if(Le.has(e))throw new Error(`Widget functions of "${e}" already registered`);const{storyboardFunctions:r,registerStoryboardFunctions:o}=pe({widgetId:e,widgetVersion:n});Le.set(e,r),o(t)},Ne=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,Ue=e=>{if("string"!=typeof e)throw new TypeError("Invalid argument expected string");const t=e.match(Ne);if(!t)throw new Error(`Invalid argument not valid semver ('${e}' received)`);return t.shift(),t},Fe=e=>"*"===e||"x"===e||"X"===e,je=e=>{const t=parseInt(e,10);return isNaN(t)?e:t},De=(e,t)=>{if(Fe(e)||Fe(t))return 0;const[n,r]=((e,t)=>typeof e!=typeof t?[String(e),String(t)]:[e,t])(je(e),je(t));return n>r?1:n<r?-1:0},Ke=(e,t)=>{for(let n=0;n<Math.max(e.length,t.length);n++){const r=De(e[n]||"0",t[n]||"0");if(0!==r)return r}return 0},Ve=(e,t,n)=>{ze(n);const r=((e,t)=>{const n=Ue(e),r=Ue(t),o=n.pop(),a=r.pop(),i=Ke(n,r);return 0!==i?i:o&&a?Ke(o.split("."),a.split(".")):o||a?o?-1:1:0})(e,t);return We[n].includes(r)},We={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1],"!=":[-1,1]},He=Object.keys(We),ze=e=>{if("string"!=typeof e)throw new TypeError("Invalid operator type, expected string but got "+typeof e);if(-1===He.indexOf(e))throw new Error(`Invalid operator, expected one of ${He.join("|")}`)};function Ge(e,t){let n=Pa(e);if(!n&&null!=wa&&wa.checkInstalledApps&&(n=wa.checkInstalledApps.getCheckedApp(e)),!n||"running"===n.installStatus)return!1;if(!t||!n.currentVersion)return!0;const r=t.match(/^([><]=?|=)(.*)$/);try{if(!r)throw new TypeError(`Invalid match version: ${t}`);return Ve(n.currentVersion,r[2],r[1])}catch(e){console.error(e)}return!1}function qe(e,t,n){let{formStateStoreId:r,formStateStoreMap:o}=e;if(!r)throw new Error(`Using "${t}" outside of form renderer${n??""}`);const a=o.get(r);if(!a)throw new Error(`Form state store is not found when using "${t}"${n??""}.\nThis is a bug of Brick Next, please report it.`);return a}const Ye=new Map;async function Xe(e){var t;const n=null==wa||null===(t=wa.flowApi)||void 0===t?void 0:t.isFlowApiProvider(e);n&&(e=wa.flowApi.FLOW_API_PROVIDER);let r=Ye.get(e);if(r)return r;if(e.includes("-")&&!customElements.get(e))if(n)wa.flowApi.registerFlowApiProvider();else if(await(0,l.loadBricksImperatively)([e],Ca()),!customElements.get(e))throw new Error(`Provider not defined: "${e}".`);return r=document.createElement(e),Ye.set(e,r),r}let Je=new WeakSet;function Qe(e){if((0,u.isObject)(e)&&!Ze(e))if(Je.add(e),Array.isArray(e))e.forEach(Qe);else{const t=Object.getPrototypeOf(e);t&&t.constructor!==Object||Object.values(e).forEach(Qe)}}function Ze(e){return Je.has(e)}const et=new Map;async function tt(e,t,n){const{useProvider:r,method:o="resolve",args:a=[],onReject:i}=e,{provider:s,field:c}=e;if(s&&!r)throw new Error(`You're using "provider: ${s}" which is dropped in v3, please use "useProvider" instead`);const l=null!=c;if(l){const e=Re();if(Oe(e,"`resolve.field`"),e)throw new Error("Using deprecated `resolve.field`")}const[u,d]=await Promise.all([Xe(r),mt(a,t)]),f=null==n?void 0:n.renderId,p=nt(u,r,o,d,n,a,!!f&&f!==Oa());let m,{transform:g}=e;try{const e=await p;m=l?(0,h.get)(e,c):e,Qe(m)}catch(e){if(!function(e){return!(null==e||!e.transform)}(i))throw e;g=i.transform,m=e}return g?"string"==typeof g?{[g]:m}:mt(g,{...t,data:m}):m}async function nt(e,t,n,r,o,a,i){let s,c;try{s=JSON.stringify({useProvider:t,method:n,args:r})}catch(e){if(!a)throw e;s=JSON.stringify({useProvider:t,method:n,originalArgs:a})}return"reload"!==(null==o?void 0:o.cache)&&(c=et.get(s)),c||(c=(async o=>{const a=null!=wa&&null!==(o=wa.flowApi)&&void 0!==o&&o.isFlowApiProvider(t)?await wa.flowApi.getArgsOfFlowApi(t,r,n):r;return e[n](...a)})(),i||et.set(s,c)),c}const rt=Symbol.for("pre.evaluated.raw"),ot=Symbol.for("pre.evaluated.context");function at(e){return!(null==e||!e[rt])}function it(e){return e[rt]}function st(e){return"string"==typeof e?(0,O.shouldAllowRecursiveEvaluations)(e):(0,O.shouldAllowRecursiveEvaluations)(e[rt])}const ct=new WeakSet([SyntaxError,TypeError,ReferenceError]);function lt(e){return ct.has(e.constructor)?e.constructor:TypeError}function ut(e,t,n){const{run:r}=dt(e,t,n,!1);return r()}function dt(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;const o=[];if("string"!=typeof e){const n=(0,h.omit)(t,["pendingPermissionsPreCheck","tplStateStoreMap","tplStateStoreScope","formStateStoreMap","formStateStoreScope"]);t={...e[ot],...n},e=e[rt]}const a={usedArgs:new Set},i={usedArgs:new Set};let s;try{s=(0,O.preevaluate)(e,{cache:!0,withParent:!0,hooks:{beforeVisitGlobal(e,t){(0,T.collectAppGetMenuUsage)(a,e,t),(0,T.collectInstalledAppsHasUsage)(i,e,t)}}})}catch(t){const n=`${t.message}, in "${e}"`;throw new(lt(t))(n)}if(a.hasNonStaticUsage)throw new Error(`Non-static usage of "APP.getMenu" is prohibited in v3, check your expression: "${e}"`);if(i.hasNonStaticUsage)throw new Error(`Non-static usage of "INSTALLED_APPS.has" is prohibited in v3, check your expression: "${e}"`);const c={},{attemptToVisitGlobals:d}=s;if(n.lazy||d.has("EVENT")&&!(0,u.hasOwnProperty)(t,"event")||d.has("DATA")&&!(0,u.hasOwnProperty)(t,"data"))return{blockingList:o,run:()=>Object.keys(t).length>0?{[rt]:e,[ot]:t}:e};let f,p,m,g;const v=Re(t);let b,y;(d.has("STATE")||!v&&d.has("TPL"))&&(g=xe(t,"STATE",`: "${e}"`)),d.has("FORM_STATE")&&(y=qe(t,"FORM_STATE",`: "${e}"`));const w=W();if(r||w){if(d.has("CTX")&&(f=(0,T.strictCollectMemberUsage)(e,"CTX"),r&&o.push(t.ctxStore.waitFor(f))),g){if(m=(0,T.strictCollectMemberUsage)(e,"STATE"),!v){const t=(0,T.strictCollectMemberUsage)(e,"TPL");for(const e of t)m.add(e)}r&&o.push(g.waitFor(m))}y&&(b=(0,T.strictCollectMemberUsage)(e,"FORM_STATE"),r&&o.push(y.waitFor(b))),d.has("PROCESSORS")&&(p=(0,T.strictCollectMemberUsage)(e,"PROCESSORS",2),r&&o.push((0,l.loadProcessorsImperatively)(p,Ca())))}if(r){let n=d.has("PERMISSIONS");if(!n&&d.has("FN")){const t=[...(0,T.strictCollectMemberUsage)(e,"FN")];n=ge(t)}if(n&&o.push(...t.pendingPermissionsPreCheck),a.usedArgs.size>0&&null!=wa&&wa.menu){const e=[...a.usedArgs];o.push(Promise.all(e.map((e=>wa.menu.fetchMenuById(e,t,{getStoryboardByAppId:_a,resolveData:tt,asyncComputeRealValue:mt})))))}var E;i.usedArgs.size>0&&o.push(null==wa||null===(E=wa.checkInstalledApps)||void 0===E?void 0:E.waitForCheckingApps([...i.usedArgs]))}return{blockingList:o,run(){var n,r;const{app:o,location:a,query:i,match:l,flags:w,sys:E,ctxStore:S,data:A,event:k}=t,I=t.overrideApp??o;for(const o of d)switch(o){case"ANCHOR":c[o]=a.hash?a.hash.substring(1):null;break;case"APP":if(null==I)throw new ReferenceError(`APP is not defined, in "${e}"`);c[o]={...(0,h.cloneDeep)(I),getMenu:null==wa||null===(n=wa.menu)||void 0===n?void 0:n.getMenuById};break;case"CTX":c[o]=q({get:(e,t)=>S.getValue(t),ownKeys:()=>Array.from(f)});break;case"DATA":c[o]=A;break;case"EVENT":c[o]=k;break;case"FLAGS":c[o]=G(w);break;case"FORM_STATE":c[o]=q({get:(e,t)=>y.getValue(t),ownKeys:()=>Array.from(b)});break;case"HASH":c[o]=a.hash;break;case"INSTALLED_APPS":c[o]=G({has:Ge});break;case"ITEM":case"INDEX":case"SIZE":{const n="ITEM"===o?"forEachItem":"INDEX"===o?"forEachIndex":"forEachSize";(0,u.hasOwnProperty)(t,n)?c[o]=t[n]:console.error(`Using \`${o}\` but no \`:forEach\` is found, check your expression: "${e}"`);break}case"LOCAL_STORAGE":c[o]=G({getItem:Ce("local")});break;case"MEDIA":c[o]=G(Ie());break;case"MISC":c[o]=Sa().getMiscSettings();break;case"PARAMS":if(null==i)throw new ReferenceError(`PARAMS is not defined, in "${e}"`);c[o]=new URLSearchParams(i);break;case"PATH":c[o]=G((null==l?void 0:l.params)??{});break;case"PATH_NAME":c[o]=a.pathname;break;case"PROCESSORS":c[o]=q({get(e,t){const n=M.get(t);if(!n)throw new Error(`'PROCESSORS.${t}' is not registered! Have you installed the relevant brick package?`);return q({get:(e,t)=>n.get(t),ownKeys:()=>Array.from(n.keys())})},ownKeys(){const e=new Set;for(const t of p){const n=t.split(".")[0];e.add(n)}return Array.from(e)}});break;case"QUERY":if(null==i)throw new ReferenceError(`QUERY is not defined, in "${e}"`);c[o]=Object.fromEntries(Array.from(i.keys()).map((e=>[e,i.get(e)])));break;case"QUERY_ARRAY":if(null==i)throw new ReferenceError(`QUERY_ARRAY is not defined, in "${e}"`);c[o]=Object.fromEntries(Array.from(i.keys()).map((e=>[e,i.getAll(e)])));break;case"SESSION_STORAGE":c[o]=G({getItem:Ce("session")});break;case"TPL":if(Oe(v,'Using "TPL" in expression',`check your expression: "${e}"`),v)break;case"STATE":c[o]=q({get:(e,t)=>g.getValue(t),ownKeys:()=>Array.from(m)});break;case"SYS":c[o]=G(E??{});break;case"__WIDGET_FN__":c[o]=$e;break;case"__WIDGET_IMG__":c[o]=null==wa||null===(r=wa.images)||void 0===r?void 0:r.widgetImagesFactory;break;case"__WIDGET_I18N__":c[o]=B}Object.assign(c,le(s.attemptToVisitGlobals,{storyboardFunctions:he,app:I,appendI18nNamespace:t.appendI18nNamespace}));try{const t=(0,O.cook)(s.expression,s.source,{globalVariables:(0,P.supply)(s.attemptToVisitGlobals,c)});return V("evaluation",{raw:e,context:c,result:t}),t}catch(t){const n=`${t.message}, in "${e}"`;throw new(lt(t))(n)}}}}let ft=function(e){return e[e.INITIAL=0]="INITIAL",e[e.USE_BRICK=1]="USE_BRICK",e[e.USE_BRICK_ITEM=2]="USE_BRICK_ITEM",e[e.USE_BRICK_PROPERTIES=3]="USE_BRICK_PROPERTIES",e[e.USE_BRICK_TRANSFORM=4]="USE_BRICK_TRANSFORM",e[e.USE_BRICK_EVENTS=5]="USE_BRICK_EVENTS",e[e.USE_BRICK_IF=6]="USE_BRICK_IF",e[e.USE_BRICK_SLOTS=7]="USE_BRICK_SLOTS",e[e.USE_BRICK_SLOTS_ITEM=8]="USE_BRICK_SLOTS_ITEM",e[e.USE_BRICK_SLOTS_ITEM_BRICKS=9]="USE_BRICK_SLOTS_ITEM_BRICKS",e[e.USE_BRICK_SLOTS_ITEM_BRICKS_ITEM=10]="USE_BRICK_SLOTS_ITEM_BRICKS_ITEM",e[e.USE_BRICK_LIFECYCLE=11]="USE_BRICK_LIFECYCLE",e[e.USE_BRICK_DATA_SOURCE=12]="USE_BRICK_DATA_SOURCE",e}({});function pt(e){switch(e){case ft.USE_BRICK_PROPERTIES:case ft.USE_BRICK_TRANSFORM:case ft.USE_BRICK_EVENTS:case ft.USE_BRICK_IF:case ft.USE_BRICK_LIFECYCLE:case ft.USE_BRICK_DATA_SOURCE:return!0}return!1}function ht(e,t,n){if(pt(e))return e;if(t)switch(e){case ft.USE_BRICK:return ft.USE_BRICK_ITEM;case ft.USE_BRICK_SLOTS_ITEM_BRICKS:return ft.USE_BRICK_SLOTS_ITEM_BRICKS_ITEM}else switch(e){case ft.INITIAL:if("useBrick"===n)return ft.USE_BRICK;break;case ft.USE_BRICK:case ft.USE_BRICK_ITEM:case ft.USE_BRICK_SLOTS_ITEM_BRICKS_ITEM:switch(n){case"properties":return ft.USE_BRICK_PROPERTIES;case"transform":return ft.USE_BRICK_TRANSFORM;case"dataSource":return ft.USE_BRICK_DATA_SOURCE;case"events":return ft.USE_BRICK_EVENTS;case"slots":return ft.USE_BRICK_SLOTS;case"children":return ft.USE_BRICK_SLOTS_ITEM_BRICKS;case"if":return ft.USE_BRICK_IF;case"lifeCycle":return ft.USE_BRICK_LIFECYCLE}break;case ft.USE_BRICK_SLOTS:return ft.USE_BRICK_SLOTS_ITEM;case ft.USE_BRICK_SLOTS_ITEM:if("bricks"===n)return ft.USE_BRICK_SLOTS_ITEM_BRICKS}return ft.INITIAL}async function mt(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=at(e);if(r||"string"==typeof e){const o=n.$$lazyForUseBrick&&pt(n.$$stateOfUseBrick);let a,i=o;return r||(0,O.isEvaluable)(e)?(a=await async function(e,t,n){const{blockingList:r,run:o}=dt(e,t,n,!0);return await Promise.all(r),o()}(e,t,{lazy:o}),i=st(e)):a=o?e:((0,u.hasOwnProperty)(t,"data")?n.noInject?_.transform:_.transformAndInject:n.noInject?bt:_.inject)(e,t),i||Qe(a),a}if(!(0,u.isObject)(e)||Ze(e)||"function"==typeof e)return e;if(Array.isArray(e)){const r=vt(n,!0);return Promise.all(e.map((e=>mt(e,t,r))))}return Object.fromEntries((await Promise.all(Object.entries(e).map((e=>{let[r,o]=e;return Promise.all([mt(r,t),mt(o,t,vt(n,!1,r))])})))).concat(n.ignoreSymbols?[]:Object.getOwnPropertySymbols(e).map((t=>[t,e[t]]))))}function gt(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=at(e);if(r||"string"==typeof e){const o=n.$$lazyForUseBrick&&pt(n.$$stateOfUseBrick);let a,i=o;return r||(0,O.isEvaluable)(e)?(a=ut(e,t),i=st(e)):a=o?e:((0,u.hasOwnProperty)(t,"data")?n.noInject?_.transform:_.transformAndInject:n.noInject?bt:_.inject)(e,t),i||Qe(a),a}if(!(0,u.isObject)(e)||Ze(e)||"function"==typeof e)return e;if(Array.isArray(e)){const r=vt(n,!0);return e.map((e=>gt(e,t,r)))}return Object.fromEntries(Object.entries(e).map((e=>{let[r,o]=e;return[gt(r,t),gt(o,t,vt(n,!1,r))]})).concat(n.ignoreSymbols?[]:Object.getOwnPropertySymbols(e).map((t=>[t,e[t]]))))}function vt(e,t,n){return e.$$lazyForUseBrick?{...e,$$stateOfUseBrick:ht(e.$$stateOfUseBrick,t,n)}:e}function bt(e){return e}async function yt(e,t){return!(0,u.hasOwnProperty)(e,"if")||!!("string"==typeof e.if||at(e.if)?await mt(e.if,t):e.if)}function wt(e,t){return!(0,u.hasOwnProperty)(e,"if")||!!("string"==typeof e.if||at(e.if)?gt(e.if,t):e.if)}function Et(e){return!(0,u.hasOwnProperty)(e,"if")||!!e.if}const St=function(){const e=S();if(e)return e.looseCheckIfByTransform}()||function(e,t){return wt(e,{data:t})};function At(e){let t=!1,n=!1,r=!1;if("string"==typeof e?(0,O.isEvaluable)(e):at(e)){const o="string"==typeof e?e:it(e);if((0,O.isTrackAll)(o)){const e=(0,T.trackAll)(o);e&&(t=e.context,n=e.state,r=e.formState)}else t=(0,T.track)(o,"track context","CTX"),n=(0,T.track)(o,"track state","STATE"),r=(0,T.track)(o,"track formstate","FORM_STATE")}return{contextNames:t,stateNames:n,formStateNames:r}}async function kt(e,t){for(const[n,r,o]of e)if(n===t){const e=await r;if(void 0!==e||!o)return e}}async function It(e){const t={};for(const[n,r,o]of e){const e=await r;void 0===e&&o||!("style"!==n&&"dataset"!==n||(0,u.isObject)(e))||(t[n]=e)}return t}function Ct(e,t){if(t)for(const[n,r]of Object.entries(t))switch(n){case"style":case"dataset":for(const[t,o]of Object.entries(r))e[n][t]=o;break;case"constructor":case"__proto__":case"innerHTML":throw new Error(`set \`${n}\` is prohibited`);default:e[n]=r}}function Rt(e,t,n){const r=function(e,t){return(0,u.isObject)(e)?Object.fromEntries(Object.entries(e).map((e=>{let[n,r]=e;const o=gt(r,t,{$$lazyForUseBrick:!0,$$stateOfUseBrick:"useBrick"===n?ft.USE_BRICK:ft.INITIAL});if("style"!==n&&"dataset"!==n||(0,u.isObject)(o))return[n,o]})).filter(Boolean)):{}}(t,n);Array.isArray(e)||(e=[e]),e.forEach((e=>{Ct(e,r)}))}function Ot(e,t,n){if(n)for(const{contextNames:r,stateNames:o,propValue:a}of t){if(r)for(const t of r)n.disposes.push(e.ctxStore.onChange(t,n.listener));if(o)for(const t of o){const r=xe(e,"STATE",`: "${a}"`);n.disposes.push(r.onChange(t,n.listener))}}}function Tt(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function _t(e){return e&&e.sensitive?"":"i"}function Pt(e,t,n){return function(e,t,n){void 0===n&&(n={});for(var r=n.strict,o=void 0!==r&&r,a=n.start,i=void 0===a||a,s=n.end,c=void 0===s||s,l=n.encode,u=void 0===l?function(e){return e}:l,d=n.delimiter,f=void 0===d?"/#?":d,p=n.endsWith,h="[".concat(Tt(void 0===p?"":p),"]|$"),m="[".concat(Tt(f),"]"),g=i?"^":"",v=0,b=e;v<b.length;v++){var y=b[v];if("string"==typeof y)g+=Tt(u(y));else{var w=Tt(u(y.prefix)),E=Tt(u(y.suffix));if(y.pattern)if(t&&t.push(y),w||E)if("+"===y.modifier||"*"===y.modifier){var S="*"===y.modifier?"?":"";g+="(?:".concat(w,"((?:").concat(y.pattern,")(?:").concat(E).concat(w,"(?:").concat(y.pattern,"))*)").concat(E,")").concat(S)}else g+="(?:".concat(w,"(").concat(y.pattern,")").concat(E,")").concat(y.modifier);else{if("+"===y.modifier||"*"===y.modifier)throw new TypeError('Can not repeat "'.concat(y.name,'" without a prefix and suffix'));g+="(".concat(y.pattern,")").concat(y.modifier)}else g+="(?:".concat(w).concat(E,")").concat(y.modifier)}}if(c)o||(g+="".concat(m,"?")),g+=n.endsWith?"(?=".concat(h,")"):"$";else{var A=e[e.length-1],k="string"==typeof A?m.indexOf(A[A.length-1])>-1:void 0===A;o||(g+="(?:".concat(m,"(?=").concat(h,"))?")),k||(g+="(?=".concat(m,"|").concat(h,")"))}return new RegExp(g,_t(n))}(function(e,t){void 0===t&&(t={});for(var n=function(e){for(var t=[],n=0;n<e.length;){var r=e[n];if("*"!==r&&"+"!==r&&"?"!==r)if("\\"!==r)if("{"!==r)if("}"!==r)if(":"!==r)if("("!==r)t.push({type:"CHAR",index:n,value:e[n++]});else{var o=1,a="";if("?"===e[s=n+1])throw new TypeError('Pattern cannot start with "?" at '.concat(s));for(;s<e.length;)if("\\"!==e[s]){if(")"===e[s]){if(0==--o){s++;break}}else if("("===e[s]&&(o++,"?"!==e[s+1]))throw new TypeError("Capturing groups are not allowed at ".concat(s));a+=e[s++]}else a+=e[s++]+e[s++];if(o)throw new TypeError("Unbalanced pattern at ".concat(n));if(!a)throw new TypeError("Missing pattern at ".concat(n));t.push({type:"PATTERN",index:n,value:a}),n=s}else{for(var i="",s=n+1;s<e.length;){var c=e.charCodeAt(s);if(!(c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122||95===c))break;i+=e[s++]}if(!i)throw new TypeError("Missing parameter name at ".concat(n));t.push({type:"NAME",index:n,value:i}),n=s}else t.push({type:"CLOSE",index:n,value:e[n++]});else t.push({type:"OPEN",index:n,value:e[n++]});else t.push({type:"ESCAPED_CHAR",index:n++,value:e[n++]});else t.push({type:"MODIFIER",index:n,value:e[n++]})}return t.push({type:"END",index:n,value:""}),t}(e),r=t.prefixes,o=void 0===r?"./":r,a=t.delimiter,i=void 0===a?"/#?":a,s=[],c=0,l=0,u="",d=function(e){if(l<n.length&&n[l].type===e)return n[l++].value},f=function(e){var t=d(e);if(void 0!==t)return t;var r=n[l],o=r.type,a=r.index;throw new TypeError("Unexpected ".concat(o," at ").concat(a,", expected ").concat(e))},p=function(){for(var e,t="";e=d("CHAR")||d("ESCAPED_CHAR");)t+=e;return t},h=function(e){var t=s[s.length-1],n=e||(t&&"string"==typeof t?t:"");if(t&&!n)throw new TypeError('Must have text between two parameters, missing text after "'.concat(t.name,'"'));return!n||function(e){for(var t=0,n=i;t<n.length;t++){var r=n[t];if(e.indexOf(r)>-1)return!0}return!1}(n)?"[^".concat(Tt(i),"]+?"):"(?:(?!".concat(Tt(n),")[^").concat(Tt(i),"])+?")};l<n.length;){var m=d("CHAR"),g=d("NAME"),v=d("PATTERN");if(g||v){var b=m||"";-1===o.indexOf(b)&&(u+=b,b=""),u&&(s.push(u),u=""),s.push({name:g||c++,prefix:b,suffix:"",pattern:v||h(b),modifier:d("MODIFIER")||""})}else{var y=m||d("ESCAPED_CHAR");if(y)u+=y;else if(u&&(s.push(u),u=""),d("OPEN")){b=p();var w=d("NAME")||"",E=d("PATTERN")||"",S=p();f("CLOSE"),s.push({name:w||(E?c++:""),pattern:w&&!E?h(b):E,prefix:b,suffix:S,modifier:d("MODIFIER")||""})}else f("END")}}return s}(e,n),t,n)}function xt(e,t,n){return e instanceof RegExp?function(e,t){if(!t)return e;for(var n=/\((?:\?<(.*?)>)?(?!\?)/g,r=0,o=n.exec(e.source);o;)t.push({name:o[1]||r++,prefix:"",suffix:"",modifier:"",pattern:""}),o=n.exec(e.source);return e}(e,t):Array.isArray(e)?function(e,t,n){var r=e.map((function(e){return xt(e,t,n).source}));return new RegExp("(?:".concat(r.join("|"),")"),_t(n))}(e,t,n):Pt(e,t,n)}const Mt=new Map,Lt=1e4;let $t=0;function Bt(e,t){const{path:n,exact:r=!1,strict:o=!1,sensitive:a=!0}=t;return(Array.isArray(n)?n:[n]).reduce(((t,n)=>{if(t)return t;const{regexp:i,keys:s}=function(e,t){const n=`${t.end}${t.strict}${t.sensitive}`;let r=Mt.get(n);r||Mt.set(n,r=new Map);const o=r.get(e);if(o)return o;const a=[],i={regexp:xt(e,a,t),keys:a};return $t<Lt&&(r.set(e,i),$t++),i}(n,{end:r,strict:o,sensitive:a}),c=i.exec(e);if(!c)return null;const[l,...u]=c,d=e===l;return r&&!d?null:{path:n,url:"/"===n&&""===l?"/":l,isExact:d,params:s.reduce(((e,t,n)=>(e[t.name]=u[n],e)),{})}}),null)}function Nt(e,t,n){return Bt(n,{path:e.path.replace(/^\$\{APP.homepage\}/,t),exact:e.exact})}const Ut=Symbol.for("tpl.asyncComputedPropsFromHost"),Ft=Symbol.for("tpl.stateStoreId"),jt=Symbol.for("tpl.externalForEachItem"),Dt=Symbol.for("tpl.externalForEachIndex"),Kt=Symbol.for("tpl.externalForEachSize"),Vt=new Set;let Wt=function(e){return e.REQUEST_FAILED="REQUEST_FAILED",e.SOMETHING_WENT_WRONG="SOMETHING_WENT_WRONG",e.LOGIN_TIMEOUT_MESSAGE="LOGIN_TIMEOUT_MESSAGE",e.NETWORK_ERROR="NETWORK_ERROR",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.NO_PERMISSION="NO_PERMISSION",e.PAGE_NOT_FOUND="PAGE_NOT_FOUND",e.APP_NOT_FOUND="APP_NOT_FOUND",e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.GO_BACK_TO_PREVIOUS_PAGE="GO_BACK_TO_PREVIOUS_PAGE",e.GO_BACK_HOME="GO_BACK_HOME",e.RELOAD="RELOAD",e}({});const Ht={[Wt.REQUEST_FAILED]:"Request Failed",[Wt.SOMETHING_WENT_WRONG]:"Something went wrong!",[Wt.LOGIN_TIMEOUT_MESSAGE]:"You haven't logged in or your login session has expired. Login right now?",[Wt.NETWORK_ERROR]:"Network error, please check your network.",[Wt.LICENSE_EXPIRED]:"The license authorization has expired, please contact the platform administrator",[Wt.NO_PERMISSION]:"Unauthorized access, unable to retrieve the required resources for this page",[Wt.PAGE_NOT_FOUND]:"Page not found, please check the URL",[Wt.APP_NOT_FOUND]:"App not found, maybe the URL is wrong or you don't have permission to access",[Wt.UNKNOWN_ERROR]:"Oops! Something went wrong",[Wt.GO_BACK_TO_PREVIOUS_PAGE]:"Go back to previous page",[Wt.GO_BACK_HOME]:"Go back to home page",[Wt.RELOAD]:"Reload"},zt={[Wt.REQUEST_FAILED]:"请求失败",[Wt.SOMETHING_WENT_WRONG]:"出现了一些问题！",[Wt.LOGIN_TIMEOUT_MESSAGE]:"您还未登录或登录信息已过期，现在重新登录？",[Wt.NETWORK_ERROR]:"网络错误，请检查您的网络连接。",[Wt.LICENSE_EXPIRED]:"License 授权失效，请联系平台管理员",[Wt.NO_PERMISSION]:"没有权限，无法获取页面所需要的资源",[Wt.PAGE_NOT_FOUND]:"请求的页面未找到，请确认 URL 是否正确",[Wt.APP_NOT_FOUND]:"请求的微应用无法找到, 可能是 URL 错误或者无权限访问",[Wt.UNKNOWN_ERROR]:"糟糕！页面出现了一些问题",[Wt.GO_BACK_TO_PREVIOUS_PAGE]:"回到上一页",[Wt.GO_BACK_HOME]:"回到首页",[Wt.RELOAD]:"刷新"},Gt="core/runtime",qt={en:Ht,zh:zt};let Yt;const Xt=Object.freeze({show:function(e){if(Yt)return Yt.resolve(e);if("confirm"===e.type){const t=confirm(e.content);return new Promise(((e,n)=>setTimeout((()=>{(t?e:n)()}),1)))}return alert(e.content),new Promise((e=>setTimeout((()=>{e()}),1)))}});function Jt(e){const{search:t,pathname:n}=e,r=n?window.btoa(encodeURIComponent(n)):"",o=t?window.btoa(encodeURIComponent(t)):"";document.cookie=`SALOGINPATH=${r}; path=/`,document.cookie=`SALOGINQUERY=${o}; path=/`}function Qt(e){if(e instanceof Event&&e.target instanceof HTMLScriptElement)return e.target.src;if(e instanceof R.HttpFetchError)return c.i18n.t(`${Gt}:${Wt.NETWORK_ERROR}`);if(e instanceof R.HttpResponseError&&e.responseJson){if("string"==typeof e.responseJson.error)return e.responseJson.error;if("string"==typeof e.responseJson.msg)return e.responseJson.msg}return null==e?"Unknown error":e.toString()}function Zt(e){return e instanceof R.HttpResponseError&&401===e.response.status&&!!e.responseJson&&100003===e.responseJson.code}let en,tn,nn=!1;function rn(e){if(e instanceof R.HttpAbortError)return;if(Zt(e)&&!window.NO_AUTH_GUARD){if(nn)return;return nn=!0,void Xt.show({type:"confirm",content:c.i18n.t(`${Gt}:${Wt.LOGIN_TIMEOUT_MESSAGE}`)}).then((()=>{!function(){const e=Sa().getFeatureFlags()["sso-enabled"],t=k();Jt(t.location),t.push(e?"/sso-auth/login":"/auth/login",{from:{...t.location,state:void 0}})}(),nn=!1}),(()=>{nn=!1}))}console.error(e);const t=Qt(e);t!==en&&(en=t,Xt.show({type:"error",title:c.i18n.t(`${Gt}:${Wt.REQUEST_FAILED}`),content:t,contentStyle:{whiteSpace:"pre-wrap",wordBreak:"break-word"}}).then((()=>{en=void 0})))}const on=Object.freeze({show:function(e){tn?tn.resolve(e):alert(e.message)}});function an(e,t,n){t&&Object.entries(t).forEach((t=>{let[r,o]=t;const a=dn(o,n,{element:e});e.addEventListener(r,a),e.$$listeners||(e.$$listeners=[]),e.$$listeners.push([r,a]),e.$$eventListeners||(e.$$eventListeners=[]);for(const t of[].concat(o))e.$$eventListeners.push([r,null,t])}))}function sn(e){return"string"==typeof e.action}function cn(e){return"string"==typeof e.useProvider}function ln(e){return!(!e.target&&!e.targetRef||!e.method&&!e.properties)}function un(e){return!!e.then}function dn(e,t,n){return function(r){for(const o of[].concat(e))if(wt(o,{...t,event:r}))if(un(o))dn(o.then,t,n)(r);else if(sn(o)){const[e,a]=o.action.split(".");switch(o.action){case"history.push":case"history.replace":case"history.pushQuery":case"history.replaceQuery":case"history.pushAnchor":case"history.block":case"history.goBack":case"history.goForward":case"history.reload":case"history.unblock":mn(r,a,o.args,o.callback,t);break;case"window.open":gn(r,o.args,t);break;case"window.postMessage":vn(r,o.args,t);break;case"parent.postMessage":bn(r,o.args,t);break;case"location.reload":case"location.assign":An(r,a,o.args,t);break;case"localStorage.setItem":case"localStorage.removeItem":case"sessionStorage.setItem":case"sessionStorage.removeItem":kn(r,e,a,o.args,t);break;case"event.preventDefault":r.preventDefault();break;case"event.stopPropagation":r.stopPropagation();break;case"console.log":case"console.error":case"console.warn":case"console.info":In(r,a,o.args,t);break;case"message.success":case"message.error":case"message.info":case"message.warn":Cn(r,a,o.args,t);break;case"handleHttpError":rn(r.detail);break;case"context.assign":case"context.replace":case"context.refresh":case"context.load":wn(r,a,o.args,o.batch??!0,o.callback,t);break;case"state.update":case"state.refresh":case"state.load":En(r,a,o.args,o.batch??!0,o.callback,t);break;case"tpl.dispatchEvent":{const[e,n]=Tn(o.args,t,r);Me(t,o.action,`: ${e}`).dispatchEvent(new CustomEvent(e,n));break}case"formstate.update":Sn(r,o.args,o.callback,t);break;case"message.subscribe":case"message.unsubscribe":Rn(r,a,o.args,t,n,o.callback);break;case"theme.setDarkTheme":case"theme.setLightTheme":te("theme.setDarkTheme"===o.action?"dark":"light");break;case"theme.setTheme":{const[e]=Tn(o.args,t,r);te(e);break}case"mode.setDashboardMode":case"mode.setDefaultMode":se("mode.setDashboardMode"===o.action?"dashboard":"default");break;default:console.error("unknown event listener action:",o.action)}}else cn(o)?fn(r,o,t,n):ln(o)?pn(r,o,t,n):console.error("unknown event handler:",o);else o.else&&dn(o.else,t,n)(r)}}function fn(e,t,n,r){const o="saveAs"!==t.method?"resolve":"saveAs";hn(e,t.useProvider,t,o,n,r)}function pn(e,t,n,r){let o=[];const a=t.target,i=t.targetRef;let s=a;if(("string"==typeof a?(0,O.isEvaluable)(a):at(a))&&(s=gt(a,{...n,event:e})),"string"==typeof s)if("_self"===s)o.push(r.element);else if(t.multiple)o=Array.from(document.querySelectorAll(s));else{const e=document.querySelector(s);null!==e&&o.push(e)}else if(s)s instanceof HTMLElement?o.push(s):console.error("unexpected target:",s);else if(i){let t=i;("string"==typeof i?(0,O.isEvaluable)(i):at(i))&&(t=gt(i,{...n,event:e}));const r=[].concat(t),a=Me(n,"targetRef",`: ${r.join(", ")}`);o.push(...r.map((e=>{var t;return null===(t=a.$$getElementByRef)||void 0===t?void 0:t.call(a,e)})).filter(Boolean))}0!==o.length?function(e){return!!e.method}(t)?o.forEach((o=>{hn(e,o,t,t.method,n,r,{useEventAsDefault:!0})})):function(e){return!!e.properties}(t)&&Rt(o,t.properties,{...n,event:e}):console.error("target not found:",a||i)}async function hn(e,t,n,r,o,a,i){const s=cn(n),c=async()=>{var a;const c=s?await Xe(t):t;if("function"!=typeof c[r])throw new Error(`target <${c.tagName.toLowerCase()}> has no method: ${r}`);let l=Tn(n.args,o,e,i);var u;return cn(n)&&null!=wa&&null!==(a=wa.flowApi)&&void 0!==a&&a.isFlowApiProvider(n.useProvider)&&(l=await wa.flowApi.getArgsOfFlowApi(n.useProvider,l,r,null===(u=n.sse)||void 0===u?void 0:u.stream)),c[r](...l)};if(!n.callback)return void c();const l=On(n.callback,o,a),u={progress:l("progress"),success:l("success"),error:l("error"),finally:l("finally")};if(s){var d,f;const t={...o,event:e};if(gt(null===(d=n.sse)||void 0===d?void 0:d.stream,t))return void async function(e,t){let{progress:n,success:r,error:o,finally:a}=t;const i=Oa();try{const t=await e();for await(const e of t){if(i!==Oa())return;null==n||n(e)}if(i!==Oa())return;null==r||r()}catch(e){if(i!==Oa())return;null==o||o(e)}finally{null==a||a()}}(c,u);if(gt(null===(f=n.poll)||void 0===f?void 0:f.enabled,t))return void function(e,t,n,r){let{progress:o,success:a,error:i,finally:s}=t;const{expectPollStopImmediately:c,expectPollEnd:l}=n,{interval:u,leadingRequestDelay:d,continueOnError:f,delegateLoadingBar:p}=gt((0,h.pick)(n,["interval","leadingRequestDelay","continueOnError","delegateLoadingBar"]),r),m=Oa();let g;async function v(){let t;Vt.delete(g);try{var n;if(t=null===(n=gt(c,r))||void 0===n?void 0:n(),t)null==s||s();else{var d;const n=await e(),i=null===(d=gt(c,r))||void 0===d?void 0:d();var h;t=i||m!==Oa(),t?i&&(null==s||s()):(null==o||o(n),null!==(h=gt(l,r))&&void 0!==h&&h(n)?(p&&window.dispatchEvent(new Event("request.end")),null==a||a(n),null==s||s()):b(u??3e3))}}catch(e){var v;const n=null===(v=gt(c,r))||void 0===v?void 0:v();t=n||m!==Oa(),t?n&&(null==s||s()):(null==i||i(e),f?b(u??3e3):null==s||s())}finally{p&&t&&window.dispatchEvent(new Event("request.end"))}}function b(e){g=setTimeout(v,e),Vt.add(g)}b(d??0),p&&window.dispatchEvent(new Event("request.start"))}(c,u,n.poll,t)}try{const e=await c();u.success(e)}catch(e){u.error(e)}finally{u.finally()}}function mn(e,t,n,r,o){let a=0,i=!1,s=t;switch(t){case"push":case"replace":case"pushQuery":case"replaceQuery":case"pushAnchor":a=2,i=!0;break;case"reload":i=!0;break;case"block":a=1,s="setBlockMessage"}let c=[];if(a>0&&(c=Tn(n,o,e,{useEventDetailAsDefault:!0}),c.length=a),i&&r){const e=On(r,o,void 0);c.push((t=>{e(t?"error":"success")({blocked:t}),e("finally")({blocked:t})}))}k()[s](...c)}function gn(e,t,n){const[r,o,a]=Tn(t,n,e);window.open(r,o||"_self",a)}function vn(e,t,n){const r=Tn(t,n,e);1===r.length&&r.push(location.origin),window.postMessage(...r)}function bn(e,t,n){if(parent===window)throw new Error("parent is the window itself");const r=Tn(t,n,e);parent.postMessage(...r)}function yn(e,t,n,r,o,a){t?r.updateValues(e,n,(e=>Tn(e,o,a)[0])):e.forEach((e=>{const{name:t,value:i}=Tn([e],o,a)[0];r.updateValue(t,i,n)}))}function wn(e,t,n,r,o,a){if(!Array.isArray(n)||!n.every(u.isObject)||"assign"!==t&&"replace"!==t){const[r,i]=Tn(n,a,e);a.ctxStore.updateValue(r,i,t,o,a)}else yn(n,r,t,a.ctxStore,a,e)}function En(e,t,n,r,o,a){if(Array.isArray(n)&&n.every(u.isObject)&&"update"===t)yn(n,r,"replace",xe(a,`state.${t}`,`: ${JSON.stringify(n)}`),a,e);else{const[r,i]=Tn(n,a,e);xe(a,`state.${t}`,`: ${r}`).updateValue(r,i,"update"===t?"replace":t,o,a)}}function Sn(e,t,n,r){const[o,a]=Tn(t,r,e);qe(r,"formstate.update",`: ${o}`).updateValue(o,a,"replace",n,r)}function An(e,t,n,r){if("assign"===t){const[t]=Tn(n,r,e);location.assign(t)}else location[t]()}function kn(e,t,n,r,o){const a="localStorage"===t?localStorage:sessionStorage,[i,s]=Tn(r,o,e);"setItem"===n?void 0!==s&&a.setItem(i,JSON.stringify(s)):a.removeItem(i)}function In(e,t,n,r){console[t](...Tn(n,r,e,{useEventAsDefault:!0}))}function Cn(e,t,n,r){const o=Tn(n,r,e,{useEventAsDefault:!0});on.show({type:t,message:o[0]})}async function Rn(e,t,n,r,o,a){const i=()=>{var o;const a=Tn(n,r,e);return null==wa||null===(o=wa.messageDispatcher)||void 0===o?void 0:o[t](...a)};if(!a)return void i();const s=On(a,r,o);try{const e=await i();s("success")(e)}catch(e){s("error")(e)}finally{s("finally")()}}function On(e,t,n){return function(r){return function(o){const a=null==e?void 0:e[r];if(a)try{const e=new CustomEvent(`callback.${r}`,{detail:o});dn(a,t,n)(e)}catch(e){console.error(e)}else"error"===r&&console.error("Unhandled callback error:",o)}}}function Tn(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Array.isArray(e)?gt(e,{...t,event:n}):r.useEventAsDefault?[n]:r.useEventDetailAsDefault?[n.detail]:[]}function _n(e){var t;const{ref:n,runtimeContext:r,element:o}=e;if(!n||!r.tplStateStoreId)return;const{hostBrick:a}=xe(r,"bindTemplateProxy"),i=a.tplHostMetadata;i.internalBricksByRef.set(n,e);const s=null===(t=i.proxy)||void 0===t?void 0:t.events;if(s)for(const[e,t]of Object.entries(s))if(t.ref===n){var c;const n=t=>{t.bubbles&&t.stopPropagation(),a.element.dispatchEvent(new CustomEvent(e,{detail:t.detail,bubbles:t.bubbles,cancelable:t.cancelable,composed:t.composed}))},r=t.refEvent??e;o.addEventListener(r,n),(c=o).$$proxyListeners??(c.$$proxyListeners=[]),o.$$proxyListeners.push([r,n])}}function Pn(e){const{ref:t,runtimeContext:n,element:r}=e;if(null==n||!n.tplStateStoreId||!t)return;const{hostBrick:o}=xe(n,"unbindTemplateProxy");o.tplHostMetadata.internalBricksByRef.delete(t);for(const[e,t]of r.$$proxyListeners??[])r.removeEventListener(e,t);delete r.$$proxyListeners}let xn=function(e){return e[e.ROOT=1]="ROOT",e[e.BRICK=2]="BRICK",e[e.PLACEHOLDER=3]="PLACEHOLDER",e}({});function Mn(e){e.replaceChildren()}function Ln(e,t){window.DISABLE_REACT_FLUSH_SYNC=!1;let n=e.child;const r=[];for(;n;){if(n.tag===xn.BRICK){var o;const a=n.type;a.includes("-")&&!customElements.get(a)&&console.error(`Undefined custom element: ${a}`),"basic-bricks.script-brick"===a&&console.warn("`basic-bricks.script-brick` is deprecated, please take caution when using it");const i=t&&n===e.child?t:document.createElement(a);n.element=i,n.slotId&&i.setAttribute("slot",n.slotId),n.iid&&(i.dataset.iid=n.iid),null!==(o=n.tplHostMetadata)&&void 0!==o&&o.tplStateStoreId&&(i.dataset.tplStateStoreId=n.tplHostMetadata.tplStateStoreId),Ct(i,n.properties),an(i,n.events,n.runtimeContext),n.tplHostMetadata&&(i.$$tplStateStore=xe({tplStateStoreId:n.tplHostMetadata.tplStateStoreId,tplStateStoreMap:n.runtimeContext.tplStateStoreMap},"mount")),_n(n),n.portal?r.push(i):n.return&&(n.return.childElements||(n.return.childElements=[]),n.return.childElements.push(i))}if(n.child)n=n.child;else if(n.sibling)n=n.sibling;else{var a;let e=n.return;for(;e;){var i;if(e.childElements)e.tag===xn.ROOT?null===(i=e.container)||void 0===i||i.append(...e.childElements):e.element.append(...e.childElements),e.childElements=void 0;if(e.tag===xn.ROOT&&r.length>0&&("function"==typeof e.createPortal?e.createPortal():e.createPortal).append(...r),e.sibling)break;e=e.return}n=null===(a=e)||void 0===a?void 0:a.sibling}}setTimeout((()=>{window.DISABLE_REACT_FLUSH_SYNC=!0}))}const $n=["onMount","onUnmount","onMediaChange","onScrollIntoView","onMessage","onMessageClose"],Bn=["onBeforePageLoad","onPageLoad","onPageLeave","onBeforePageLeave","onAnchorLoad","onAnchorUnload"];var Nn=new WeakMap,Un=new WeakMap,Fn=new WeakMap,jn=new WeakMap,Dn=new WeakMap,Kn=new WeakMap,Vn=new WeakMap,Wn=new WeakMap,Hn=new WeakMap,zn=new WeakSet;class Gn{constructor(e,t){(0,I.A)(this,zn),(0,o.A)(this,"scope",void 0),(0,o.A)(this,"unknownBricks",void 0),(0,o.A)(this,"renderId",void 0),(0,a.A)(this,Nn,void 0),(0,a.A)(this,Un,{onBeforePageLoad:[],onPageLoad:[],onPageLeave:[],onBeforePageLeave:[],onAnchorLoad:[],onAnchorUnload:[],onMediaChange:[],onScrollIntoView:[],onMount:[],onUnmount:[],onMessage:[],onMessageClose:[]}),(0,a.A)(this,Fn,new Map),(0,a.A)(this,jn,void 0),(0,a.A)(this,Dn,new Map),(0,a.A)(this,Kn,void 0),(0,a.A)(this,Vn,void 0),(0,a.A)(this,Wn,new WeakMap),(0,a.A)(this,Hn,new Map),this.scope=e,this.unknownBricks=(null==t?void 0:t.unknownBricks)??"throw",(0,i.A)(Nn,this,null==t?void 0:t.routeHelper),this.renderId=null==t?void 0:t.renderId}setInitialMenuRequestNode(e){(0,i.A)(Vn,this,e)}memoizeMenuRequestNode(e,t){(0,s.A)(Wn,this).set(e,t)}getMenuRequests(){const e=[];let t=(0,s.A)(Vn,this);for(;t;)if(t.request&&e.push(t.request),t.child)t=t.child;else{for(var n;t&&!t.sibling;)t=t.return;t=null===(n=t)||void 0===n?void 0:n.sibling}return e}async reMergeMenuRequestNodes(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=(0,s.A)(Wn,this).get(t);(0,s.A)(Wn,this).set(t,n);let o,a=e.child;for(;a&&a!==r;)o=a,a=a.sibling;o?(o.sibling=n,n.sibling=null==r?void 0:r.sibling):e.child=n,await(0,s.A)(Nn,this).mergeMenus(this.getMenuRequests())}reBailout(e){return(0,s.A)(Nn,this).bailout(e)}reCatch(e,t){return(0,s.A)(Nn,this).catch(e,t,!1,!0)}async didPerformIncrementalRender(e,t){let n=!1;const r=[];for(const{parentRoutes:o,callback:a}of[...(0,s.A)(Hn,this).values()].reverse()){const i=o[o.length-1];if(r.includes(i))continue;const s=await a(e,t);s&&r.push(...o.slice(0,-1)),!1!==s&&(n=!0)}return n}performIncrementalRender(e,t,n){(0,s.A)(Hn,this).set(e,{parentRoutes:t,callback:n})}registerBrickLifeCycle(e,t){if(!t)return;const n=[...$n,..."page"===this.scope?Bn:[]];for(const r of n){const n=t[r];n&&(0,s.A)(Un,this)[r].push({brick:e,handlers:n})}(0,h.isEmpty)(t.useResolves)||console.error("`lifeCycle.useResolves` is dropped in v3:",t)}registerArbitraryLifeCycle(e,t){const n=(0,s.A)(Dn,this).get(e);n?n.add(t):(0,s.A)(Dn,this).set(e,new Set([t]))}memoize(e,t,n,r){(0,s.A)(Kn,this)||(0,i.A)(Kn,this,new WeakMap);const o=[e??"",...t].join(".");let a=(0,s.A)(Kn,this).get(r);a||(a=new Map,(0,s.A)(Kn,this).set(r,a)),a.set(o,{node:n,last:Qn(n),lastNormal:Zn(n),lastPortal:tr(n)})}reRender(e,t,n,r){const o=[e??"",...t].join("."),a=(0,s.A)(Kn,this).get(r).get(o),{node:i,last:c,lastNormal:l,lastPortal:u}=a;let d;const f=[];if((null==i?void 0:i.tag)===xn.PLACEHOLDER){var p,h;d=(null===(p=function(e){return er(e,!0)}(i))||void 0===p?void 0:p.element)??null;const e=null===(h=function(e){return nr(e,!0)}(i))||void 0===h?void 0:h.element;e&&f.push(e)}else{var m,g;d=(null==l||null===(m=l.element)||void 0===m?void 0:m.nextSibling)??null;let e=null==u||null===(g=u.element)||void 0===g?void 0:g.nextSibling;for(;e&&(f.push(e),e instanceof HTMLElement&&"DIV"===e.tagName);)e=e.nextSibling}const v=Qn(n);let b;a.node=n,a.last=v,a.lastNormal=Zn(n),a.lastPortal=tr(n);let y=r.child;for(;y&&y!==c;){if(y.sibling===i){b=y;break}y=y.sibling}const w=document.createDocumentFragment(),E=document.createDocumentFragment(),S={tag:xn.ROOT,container:w,createPortal:E,child:n};for(y=n;y;)y.return=S,y=y.sibling;const A=rr(i,c);for((0,C.A)(zn,this,qn).call(this,A),Ln(S),b?b.sibling=n:r.child=n,v&&(v.sibling=null==c?void 0:c.sibling),y=n;y;)y.return=r,y=y.sibling;var k,I;if(w.hasChildNodes()&&(r.tag===xn.ROOT?null===(k=r.container)||void 0===k||k.insertBefore(w,d):null===(I=r.element)||void 0===I||I.insertBefore(w,d)),E.hasChildNodes()){var R;let e=n;for(;e&&e.return;)e=e.return;if((null===(R=e)||void 0===R?void 0:R.tag)!==xn.ROOT)throw new Error("Cannot find render root node. This is a bug of Brick Next, please report it.");const t="function"==typeof e.createPortal?e.createPortal():e.createPortal;let r=null;for(const e of f)if(t.contains(e)){r=e;break}t.insertBefore(E,r)}const O=rr(n,v);(0,C.A)(zn,this,Yn).call(this,O)}dispose(){for(const e of Object.values((0,s.A)(Un,this)))e.length=0;for(const e of(0,s.A)(Fn,this).values()){for(const t of e)t.disconnect();e.length=0}(0,s.A)(Fn,this).clear(),(0,s.A)(jn,this)&&(Ee.removeEventListener("change",(0,s.A)(jn,this)),(0,i.A)(jn,this,void 0)),(0,i.A)(Kn,this,void 0),(0,s.A)(Dn,this).clear(),(0,s.A)(Hn,this).clear(),(0,i.A)(Wn,this,void 0)}dispatchBeforePageLoad(){(0,C.A)(zn,this,Xn).call(this,"onBeforePageLoad",new CustomEvent("page.beforeLoad"))}dispatchPageLoad(){const e=new CustomEvent("page.load");(0,C.A)(zn,this,Xn).call(this,"onPageLoad",e),window.dispatchEvent(e)}dispatchBeforePageLeave(e){(0,C.A)(zn,this,Xn).call(this,"onBeforePageLeave",new CustomEvent("page.beforeLeave",{detail:e}))}dispatchPageLeave(){(0,C.A)(zn,this,Xn).call(this,"onPageLeave",new CustomEvent("page.leave"))}dispatchAnchorLoad(){const{hash:e}=k().location;e&&"#"!==e?(0,C.A)(zn,this,Xn).call(this,"onAnchorLoad",new CustomEvent("anchor.load",{detail:{hash:e,anchor:e.substring(1)}})):(0,C.A)(zn,this,Xn).call(this,"onAnchorUnload",new CustomEvent("anchor.unload"))}initializeScrollIntoView(){for(const{brick:e,handlers:t}of(0,s.A)(Un,this).onScrollIntoView)(0,C.A)(zn,this,Jn).call(this,e,t)}initializeMediaChange(){(0,i.A)(jn,this,(e=>{(0,C.A)(zn,this,Xn).call(this,"onMediaChange",new CustomEvent("media.change",{detail:G(e.detail)}))})),Ee.addEventListener("change",(0,s.A)(jn,this))}initializeMessageDispatcher(){var e;for(const{brick:e,handlers:n}of(0,s.A)(Un,this).onMessage)for(const r of[].concat(n)){var t;null==wa||null===(t=wa.messageDispatcher)||void 0===t||t.onMessage(r.channel,(t=>{dn(r.handlers,e.runtimeContext,e)(new CustomEvent("message.push",{detail:t}))}))}null==wa||null===(e=wa.messageDispatcher)||void 0===e||e.onClose((()=>{(0,C.A)(zn,this,Xn).call(this,"onMessageClose",new CustomEvent("message.close"))}))}dispatchOnMount(){(0,C.A)(zn,this,Xn).call(this,"onMount",new CustomEvent("mount"))}dispatchOnUnmount(){(0,C.A)(zn,this,Xn).call(this,"onUnmount",new CustomEvent("unmount"))}}function qn(e){const t=[...$n,..."page"===this.scope?Bn:[]],n=[];for(const r of t){const t=(0,h.remove)((0,s.A)(Un,this)[r],(t=>e.has(t.brick)));"onUnmount"===r&&n.push(...t)}for(const t of e){var r,o,a;const e=(0,s.A)(Fn,this).get(t);if(null!=e&&e.length){for(const t of e)t.disconnect();e.length=0,(0,s.A)(Fn,this).delete(t)}Pn(t),null===(r=t.element)||void 0===r||delete r.$$tplStateStore,null===(o=t.element)||void 0===o||o.remove(),null===(a=t.disposes)||void 0===a||a.forEach((e=>e())),delete t.disposes}const i=new CustomEvent("unmount");for(const{brick:e,handlers:t}of n)dn(t,e.runtimeContext,e)(i)}function Yn(e){const t=new CustomEvent("mount");for(const{brick:n,handlers:r}of(0,s.A)(Un,this).onMount)e.has(n)&&dn(r,n.runtimeContext,n)(t);for(const{brick:t,handlers:n}of(0,s.A)(Un,this).onScrollIntoView)e.has(t)&&(0,C.A)(zn,this,Jn).call(this,t,n)}function Xn(e,t){for(const{brick:n,handlers:r}of(0,s.A)(Un,this)[e])dn(r,n.runtimeContext,n)(t);const n=(0,s.A)(Dn,this).get(e);if(n)for(const e of n)e()}function Jn(e,t){const n=t.threshold??.1,r=new IntersectionObserver(((r,o)=>{r.forEach((r=>{r.isIntersecting&&r.intersectionRatio>=n&&(dn(t.handlers,e.runtimeContext,e)(new CustomEvent("scroll.into.view")),o.disconnect())}))}),{threshold:n});r.observe(e.element);let o=(0,s.A)(Fn,this).get(e);o||(o=[],(0,s.A)(Fn,this).set(e,o)),o.push(r)}function Qn(e){let t=e;for(;null!==(n=t)&&void 0!==n&&n.sibling;){var n;t=t.sibling}return t}function Zn(e){return er(e,!1)}function er(e,t){let n,r=e;for(;r;){if(r.tag===xn.BRICK&&!r.portal){if(t)return r;n=r}r=r.sibling}return n}function tr(e){return nr(e,!1)}function nr(e,t){let n,r=e;for(;r;){if(r.tag===xn.BRICK&&r.portal){if(t)return r;n=r}if(r.child)r=r.child;else if(r.sibling)r=r.sibling;else{var o;let e=r.return;for(;e&&!e.sibling;)e=e.return;r=null===(o=e)||void 0===o?void 0:o.sibling}}return n}function rr(e,t){const n=new Set;let r=e;for(;r;)if(r.tag===xn.BRICK&&n.add(r),r.child)r=r.child;else{if(r===t)break;if(r.sibling)r=r.sibling;else{var o;let e=r.return;for(;e&&e!==t&&!e.sibling;)e=e.return;if(e===t)break;r=null===(o=e)||void 0===o?void 0:o.sibling}}return n}const or=new Map;function ar(e){return or.get(e)}const ir=Symbol.for("root.runtimeContext");async function sr(e,t,n){var r,o;const[a,i,s]=ro({...e[ir]??Ta(),data:t,pendingPermissionsPreCheck:[]});a.tplStateStoreMap??(a.tplStateStoreMap=new Map),a.formStateStoreMap??(a.formStateStoreMap=new Map);const c=new Gn("fragment"),l={tag:xn.ROOT,createPortal:null},u=e.transform,d=Re();u&&Oe(d,"`useBrick.transform`",'please use "properties" instead, check your useBrick:',e);const f=await eo(l,d&&!n?e:{errorBoundary:n,...e,properties:{...e.properties,...u}},a,c,[],{}),p=[...i,...s];if(await no(f,a,p),(null===(r=f.node)||void 0===r?void 0:r.tag)===xn.PLACEHOLDER)throw new Error("The root brick of useBrick cannot be an ignored control node");if(null!==(o=f.node)&&void 0!==o&&o.portal)throw new Error("The root brick of useBrick cannot be a portal brick");return l.child=f.node,{tagName:f.node?f.node.type:null,renderRoot:l,rendererContext:c,scopedStores:p}}function cr(e,t){let n,{renderRoot:r,rendererContext:o,scopedStores:a}=e;r.createPortal=()=>{const e=document.querySelector("#portal-mount-point");return n=document.createElement("div"),e.appendChild(n),n},Ln(r,t),o.dispatchOnMount(),o.initializeScrollIntoView(),o.initializeMediaChange(),o.initializeMessageDispatcher();for(const e of a)e.mountAsyncData();return{portal:n}}function lr(e,t){let{rendererContext:n}=e;t.portal&&(Mn(t.portal),t.portal.remove()),n.dispatchOnUnmount(),n.dispose()}function ur(e,t,n){if(n)throw new Error("Legacy doTransform does not support options in v3");return gt(t,{...Ta(),data:e},{noInject:!0})}function dr(e,t){const n=_a(e);Object.assign(n,{...t,meta:{...n.meta,...t.meta},$$fulfilling:null,$$fulfilled:!0,$$registerCustomTemplateProcessed:!1}),L(n)}function fr(e,t){const n=_a(e);let r=!1;function o(e){e.forEach(((n,i)=>{"routes"===n.type?o(n.routes):function(e){return e.path===t.path&&!e.exact==!t.exact}(n)?(r=!0,e[i]=t):Array.isArray(n.bricks)&&a(n.bricks)}))}function a(e){e.forEach((e=>{if(e.slots)for(const t of Object.values(e.slots))"routes"===t.type?o(t.routes):a(t.bricks)}))}o(n.routes),r||n.routes.unshift(t)}function pr(e,t,n){const r=`${e}.${t.name}`;Pe.define(r,{bricks:t.bricks,proxy:t.proxy,state:t.state}),hr(e,t.name,n)}function hr(e,t,n){br(e,`\${APP.homepage}/_dev_only_/template-preview/${t}`,[{brick:t,...(0,h.pick)(n,"properties","events","lifeCycle","context","slots","children")}])}function mr(e){return`\${APP.homepage}/_dev_only_/snippet-preview/${e}`}function gr(e,t){var n;br(e,mr(t.snippetId),null!==(n=t.bricks)&&void 0!==n&&n.length?t.bricks:[{brick:"span"}],t.context)}const vr=gr;function br(e,t,n,r){const{routes:o}=_a(e),a=o.findIndex((e=>e.path===t)),i={path:t,bricks:n,context:r,menu:!1,exact:!0};-1===a?o.unshift(i):o.splice(a,1,i)}function yr(e,t){let{tplStateStoreId:n}=t;const r=Ta();return n?xe({...r,tplStateStoreId:n},"STATE").getValue(e):r.ctxStore.getValue(e)}function wr(e){let{tplStateStoreId:t}=e;const n=Ta();return t?xe({...n,tplStateStoreId:t},"STATE").getAllValues():n.ctxStore.getAllValues()}function Er(e){return Ca().find((t=>t.id?t.id===e:t.filePath.startsWith(`${e}/`)))}function Sr(e){return(0,l.loadBricksImperatively)(e,Ca())}function Ar(e,t){return(0,l.loadEditorsImperatively)(e,t??Ca())}function kr(){return Oa()}async function Ir(e,t){let{appId:n,updateStoryboardType:r,collectUsedContracts:o}=t;const a=_a(n);let i;if("route"===r)i={routes:[e]};else if("template"===r)i={meta:{customTemplates:[e]}};else if("snippet"===r){var s;const t=mr(e.snippetId);i={routes:[null==a||null===(s=a.routes)||void 0===s?void 0:s.find((e=>e.path===t))]}}const c=[];return i&&o&&(await o(i)).forEach((e=>{var t;const[n,r,o]=e.match(/(.*)@(.*):\d\.\d\.\d/);null!=a&&null!==(t=a.meta)&&void 0!==t&&null!==(t=t.contracts)&&void 0!==t&&t.some((e=>e.namespaceId===r&&e.name===o))||c.push(e)})),c}async function Cr(e,t){let{tplStateStoreId:n,routeId:r}=t;const o={...Ta(),tplStateStoreId:n,match:ar(r)};return e.resolve?tt(e.resolve,o,{cache:"reload"}):mt(e.value,o)}function Rr(e){const t=Ta();return{app:(null==t?void 0:t.overrideApp)??(null==t?void 0:t.app),location:(0,h.pick)(location,["href","origin","hostname","host"]),...(0,h.pick)(t,["query","sys"]),match:ar(null==e?void 0:e.routeId)}}let Or;const Tr=[];function _r(e){Or=e;const t=wr({tplStateStoreId:e.tplStateStoreId});xr({changeType:"initialize",tplStateStoreId:e.tplStateStoreId,detail:{data:t}})}function Pr(e){Tr.push(e)}function xr(e){setTimeout((()=>{for(const t of Tr)try{t(e)}catch(t){console.error(`RealTimeDataInspectHook failed (${e.changeType}):`,t)}}))}const Mr=["onBeforePageLoad","onPageLoad","onBeforePageLeave","onPageLeave","onAnchorLoad","onAnchorUnload"];class Lr{constructor(e,t,n,r){(0,o.A)(this,"type",void 0),(0,o.A)(this,"data",new Map),(0,o.A)(this,"changeEventType",void 0),(0,o.A)(this,"pendingStack",[]),(0,o.A)(this,"hostBrick",void 0),(0,o.A)(this,"stateStoreId",void 0),(0,o.A)(this,"batchUpdate",!1),(0,o.A)(this,"batchUpdateContextsNames",[]),(0,o.A)(this,"rendererContext",void 0),(0,o.A)(this,"routeMap",new WeakMap),this.type=e,this.changeEventType="FORM_STATE"===this.type?"formstate.change":"STATE"===this.type?"state.change":"context.change",this.hostBrick=t,this.rendererContext=n,this.stateStoreId=r}getAllValues(){return Object.fromEntries([...this.data.entries()].map((e=>{let[t,{value:n}]=e;return[t,n]})))}getValue(e){var t;return null===(t=this.data.get(e))||void 0===t?void 0:t.value}notifyRealTimeDataChange(e,t){if(Or){const{tplStateStoreId:n}=Or;(n?"STATE"===this.type&&this.stateStoreId===n:"CTX"===this.type)&&xr({changeType:"update",tplStateStoreId:n,detail:{name:e,value:t}})}}getAffectListByContext(e){const t=[e];return this.data.forEach(((e,n)=>{e.deps&&e.deps.some((e=>t.includes(e)))&&t.push(n)&&t.push(...this.getAffectListByContext(n))})),t.shift(),[...new Set(t)]}updateValues(e,t,n){if(this.batchUpdate=!0,this.batchUpdateContextsNames=e.map((e=>e.name)),[...new Set(this.batchUpdateContextsNames)].length!==this.batchUpdateContextsNames.length)throw new Error("Batch update not allow to update same item");const r={},o={},a=[];e.forEach((e=>{const{name:o,value:i}=n([e]),s=this.data.get(o);a.push(...this.getAffectListByContext(o)),s&&(r[o]=s),this.updateValue(o,i,t)})),a.filter((e=>!r[e])).forEach((e=>{const t=this.data.get(e);t&&(o[e]=t)}));const i=e=>{for(const n in e){var t;const r=e[n];null===(t=r.eventTarget)||void 0===t||t.dispatchEvent(new CustomEvent(this.changeEventType,{detail:r.value}))}};i(r),i(o),this.batchUpdate=!1}updateValue(e,t,n,r,o){const a=this.data.get(e);if(!a)throw new Error(`${this.type} '${e}' is not defined`);if("refresh"!==n&&"load"!==n)"replace"===n?a.value=t:(0,u.isObject)(a.value)?Object.assign(a.value,t):(console.warn(`Non-object current value of "${this.type}.${e}" for "context.assign", try "context.replace" instead.`),a.value=t),this.batchUpdate||a.eventTarget.dispatchEvent(new CustomEvent(this.changeEventType,{detail:a.value}));else{if(!a.useResolve)throw new Error(`You can not ${n} "${this.type}.${e}" which is not using resolve`);let i;"load"===n&&(a.loaded?i=Promise.resolve(a.value):a.loading&&(i=a.loading));const s=e=>{var t;let n;return"FlowApiNotFoundError"===(null==e?void 0:e.name)&&!!(n=null===(t=this.rendererContext)||void 0===t?void 0:t.renderId)&&n!==Oa()};if(i||(i=a.loading=a.load({cache:"load"===n?"default":"reload",...t}),i.then((e=>{this.finishLoad(a,e)}),(e=>{!a.useResolve||s(e)||null!=r&&r.error||rn(e)}))),r){const e=On(r,o);i.then((t=>{e("success")({value:t}),e("finally")()}),(t=>{!s(t)&&r.error&&e("error")(t),e("finally")()}))}}}finishLoad(e,t){e.useResolve&&(e.loaded=!0,e.value=t,e.eventTarget.dispatchEvent(new CustomEvent(this.changeEventType,{detail:t})))}define(e,t,n,r){if(Array.isArray(e)&&e.length>0){const o=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"CTX";const r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"CTX",n=arguments.length>2?arguments[2]:void 0;const r=new Map;for(const o of e){const e=[o.if,o.value,o.resolve],a=(0,T.collectMemberUsage)(e,t);if(!n&&"STATE"===t){const t=(0,T.collectMemberUsage)(e,"TPL");for(const e of t.usedProperties)a.usedProperties.add(e);t.hasNonStaticUsage&&(a.hasNonStaticUsage=!0)}r.set(o,a)}return r}(e,n,arguments.length>3?arguments[3]:void 0),o=new Map;for(const e of Array.from(r.keys()).map((e=>e.name)))o.set(e,(o.get(e)??0)+1);const a=Array.from(r.values()).some((e=>e.hasNonStaticUsage)),i=new WeakSet,s=new Map,c=new Map([...new Set(e.map((e=>e.name)))].map((e=>[e,new Promise(((t,n)=>{s.set(e,{resolve:t,reject:n})}))]))),l=async e=>{i.add(e);const n=await t(e);r.delete(e);const a=o.get(e.name)??0;if(n){if(s.get(e.name).resolve(),o.delete(e.name),0===a)throw new Error(`Duplicated context defined: ${e.name}`)}else 1===a?(s.get(e.name).resolve(),o.delete(e.name)):o.set(e.name,a-1);await d()};let u=a;async function d(){const e=Array.from(r.entries()).filter(function(e,t){return(n,r)=>t?0===r:![...n[1].usedProperties].some((t=>e.has(t)))}(o,u)).map((e=>e[0])).filter((e=>!i.has(e)));await Promise.all(e.map(l))}return{pendingResult:d().then((async()=>{r.size>0&&(function(e,t){const n=new Map(e),r=new Set(Array.from(n.keys()).map((e=>e.name))),o=()=>{let e=!1;for(const[t,o]of n.entries())[...o.usedProperties].some((e=>r.has(e)))||(n.delete(t),r.delete(t.name),e=!0);e&&o()};if(o(),n.size>0)throw new ReferenceError(`Circular ${t} detected: ${Array.from(n.keys()).map((e=>e.name)).join(", ")}`)}(r,n),u=!0,await d());for(const e of s.values())e.resolve()})).catch((e=>{for(const t of s.values())t.reject(e);throw e})),pendingContexts:c}}(e,(e=>this.resolve(e,t,n,r)),this.type,Re(t));this.pendingStack.push(o)}}onChange(e,t){var n;const r=null===(n=this.data.get(e))||void 0===n?void 0:n.eventTarget;return null==r||r.addEventListener(this.changeEventType,t),()=>{null==r||r.removeEventListener(this.changeEventType,t)}}async waitFor(e){for(const{pendingContexts:t}of this.pendingStack)await Promise.all([...e].map((e=>t.get(e))))}async waitForAll(){for(const{pendingContexts:e}of this.pendingStack)for(const t of e.values())t.catch((()=>{}));for(const{pendingResult:e}of this.pendingStack)await e}mountAsyncData(e){this.data.forEach((t=>{var n;if(t.async&&(!e||null!==(n=this.routeMap.get(e))&&void 0!==n&&n.has(t.name))){if(t.asyncMounted)return void console.error(`Async data "${t.name}" already mounted. This is a bug of Brick Next, please report it.`);t.asyncMounted=!0,t.loading.then((e=>{this.finishLoad(t,e)}))}}))}async resolve(e,t,n,r){if(!await yt(e,t))return!1;let o,a,i,s,c,l;if(n&&("STATE"===this.type?e.expose:"FORM_STATE"===this.type)&&(o=await kt(n,e.name)),void 0===o){if(e.resolve){const n=(0,u.hasOwnProperty)(e,"value");c=e.track&&n&&(0,u.hasOwnProperty)(e.resolve,"if")&&(0,T.strictCollectMemberUsage)(e.resolve.if,this.type).size>0;const r={transform:"value",...e.resolve};if(s=await yt(e.resolve,t),(s||c)&&(a=async e=>{var n;return(await tt(r,t,{...e,renderId:null===(n=this.rendererContext)||void 0===n?void 0:n.renderId})).value}),s)l=e.resolve.async?"async":e.resolve.lazy?"lazy":"eager","eager"===l?o=await a():"async"===l&&(i=a());else if(!n)return!1}s&&"eager"===l||void 0===e.value||(o=await mt(e.value,t))}if(this.data.has(e.name))throw new Error(`${this.type} '${e.name}' has already been declared`);const d={name:e.name,value:o,eventTarget:new be,useResolve:s,load:a,loaded:"eager"===l,loading:i,async:"async"===l,deps:[]};if("lazy"===l){const{trigger:t}=e.resolve;var f;t&&Mr.includes(t)&&(null===(f=this.rendererContext)||void 0===f||f.registerArbitraryLifeCycle(t,(()=>{this.updateValue(e.name,void 0,"load")})))}if(e.onChange&&d.eventTarget.addEventListener(this.changeEventType,dn(e.onChange,t)),e.track){const n=(0,T.strictCollectMemberUsage)(c?[e.resolve,e.value]:a?e.resolve:e.value,this.type);!a&&(d.deps=[...n]);for(const r of n)this.onChange(r,this.batchAddListener((()=>{d.useResolve=c?wt(e.resolve,t):!!a,d.useResolve?this.updateValue(e.name,{cache:"default"},"refresh"):this.updateValue(e.name,gt(e.value,t),"replace")}),e))}if(d.eventTarget.addEventListener(this.changeEventType,(t=>{this.notifyRealTimeDataChange(e.name,t.detail)})),this.data.set(e.name,d),Array.isArray(r))for(const t of r){const n=this.routeMap.get(t);n?n.add(e.name):this.routeMap.set(t,new Set([e.name]))}return!0}disposeDataInRoutes(e){for(const t of e){const e=this.routeMap.get(t);if(void 0!==e)for(const t of e)this.data.delete(t)}}batchAddListener(e,t){return n=>{this.batchUpdate&&this.batchUpdateContextsNames.includes(t.name)||e(n)}}}function $r(e,t,n){const{reversedProxies:r,asyncHostPropertyEntries:o,externalSlots:a,tplStateStoreId:i,hostBrick:s}=e;let c;if(t&&r){const e=r.properties.get(t);e&&(d=o,c=e.map((e=>{let{from:t,to:n}=e;const r=d.filter((e=>e[0]===t));if(r.length>0&&n.refProperty)return[n.refProperty,kt(r,t),!0]})).filter(Boolean));const i=r.slots.get(t);if(i&&a){const e=new Map;for(const{from:t,to:r}of i){var l;const o=(null===(l=a[t])||void 0===l?void 0:l.bricks)??[];if(!o.length)continue;const i=r.refSlot??t;let c=e.get(i);if(!c){c=[];const t=(0,u.hasOwnProperty)(n,i)?n[i].bricks.length+1:1;for(let e=0;e<t;e+=1)c.push([]);e.set(i,c)}const d=r.refPosition??-1,f=(0,u.hasOwnProperty)(s.runtimeContext,"forEachItem");c[(0,h.clamp)(d<0?c.length+d:d,0,c.length-1)].push(...f?Br(o,s.runtimeContext.forEachItem,s.runtimeContext.forEachIndex,s.runtimeContext.forEachSize):o)}for(const[t,r]of e.entries()){(0,u.hasOwnProperty)(n,t)||(n[t]={type:"bricks",bricks:[]});const e=n[t];e.bricks=r.flatMap(((t,n)=>n<e.bricks.length?t.concat(e.bricks[n]):t)),0===e.bricks.length&&delete n[t]}}}var d;return{[Ut]:c,[Ft]:i}}function Br(e,t,n,r){return e.map((e=>{let{children:o,slots:a,...i}=e;return{...i,[jt]:t,[Dt]:n,[Kt]:r,slots:":forEach"===i.brick?io(o,a):Object.fromEntries(Object.entries(io(o,a)??{}).map((e=>{let[o,a]=e;return[o,"routes"===a.type?{type:"routes",routes:Nr(a.routes,t,n,r)}:{type:"bricks",bricks:Br(a.bricks,t,n,r)}]})))}}))}function Nr(e,t,n,r){return e.map((e=>"routes"===e.type?{...e,routes:Nr(e.routes,t,n,r)}:"redirect"===e.type?e:{...e,bricks:Br(e.bricks,t,n,r)}))}function Ur(e,t){function n(e){return(0,u.isObject)(e)&&"function"!=typeof e?Array.isArray(e)?e.map(n):Object.fromEntries(Object.entries(e).map((e=>{let[t,o]=e;return(0,u.isObject)(o)&&"useBrick"===t?Array.isArray(o)?[t,o.map(r)]:[t,r(o)]:[t,n(o)]})).concat(Object.getOwnPropertySymbols(e).map((t=>[t,e[t]])))):e}function r(e){const{properties:o,slots:a,children:i,...s}=e,c=io(i,a),l=Object.fromEntries(Object.entries(c??{}).map((e=>{let[t,n]=e;return[t,{type:"bricks",bricks:(n.bricks??[]).map(r)}]})));return{...s,properties:n(o),slots:l,...$r(t,s.ref,l)}}return n(e)}function Fr(e,t,n,r,o){var a;const i=(0,h.uniqueId)("tpl-state-"),s={...n.runtimeContext,tplStateStoreId:i};delete s.forEachItem,delete s.forEachIndex,delete s.forEachSize,delete s.formStateStoreId;const c=new Lr("STATE",n,o,i);s.tplStateStoreMap.set(i,c),s.tplStateStoreScope&&s.tplStateStoreScope.push(c);const{bricks:l,proxy:u,state:d,contracts:f}=Pe.get(e);null==wa||null===(a=wa.flowApi)||void 0===a||a.collectWidgetContract(f),c.define(d,s,r);const{slots:p,children:m,...g}=t,v={...g,brick:e};n.tplHostMetadata={internalBricksByRef:new Map,tplStateStoreId:i,proxy:u};const b={properties:new Map,slots:new Map};if(null!=u&&u.properties)for(const[e,t]of Object.entries(u.properties)){let n=b.properties.get(t.ref);n||(n=[],b.properties.set(t.ref,n)),n.push({from:e,to:t})}if(null!=u&&u.slots)for(const[e,t]of Object.entries(u.slots)){let n=b.slots.get(t.ref);n||(n=[],b.slots.set(t.ref,n)),n.push({from:e,to:t})}const y={reversedProxies:b,asyncHostPropertyEntries:r,externalSlots:io(m,p),tplStateStoreId:i,hostBrick:n};return v.slots={"":{type:"bricks",bricks:l.map((e=>jr(e,y)))}},v}function jr(e,t){null===e.if&&delete e.if;const{properties:n,slots:r,children:o,...a}=e,i=io(o,r),s=Object.fromEntries(Object.entries(i??{}).map((e=>{let[n,r]=e;return[n,{type:"bricks",bricks:(r.bricks??[]).map((e=>jr(e,t)))}]})));return{...a,properties:Ur(n,t),slots:s,...$r(t,a.ref,s)}}const Dr="form-renderer.form-renderer",Kr=Symbol.for("form.stateStoreId"),Vr=["forms.general-form","form.general-form","eo-form"];function Wr(e,t,n){const{id:r,bricks:o,events:a,context:i,mountPoint:s,instanceId:c}=e;let{brick:l,properties:d}=e;const f=t.find((e=>e.fieldId===r));if(f){const e=function(e){let t;const n={id:e.fieldId,name:e.fieldId,label:e.name,dataset:{testid:e.fieldId}},r=()=>{var t,n;return{readOnly:null===(t=e.limit)||void 0===t?void 0:t.includes("READONLY"),required:null===(n=e.limit)||void 0===n?void 0:n.includes("REQUIRED")}};switch(e.fieldType){case"INT":t={brick:"forms.general-input-number",properties:{...n,...r(),placeholder:e.description,precision:0,inputBoxStyle:{width:"100%"}}};break;case"BOOLEAN":t={brick:"forms.general-switch",properties:{...n,...r()}};break;case"FLOAT":t={brick:"forms.general-input-number",properties:{...n,...r(),placeholder:e.description,inputBoxStyle:{width:"100%"}}};break;case"ENUM":t={brick:"forms.general-select",properties:{...n,...r(),options:[{label:"选项一",value:1},{label:"选项二",value:2}],placeholder:e.description,inputBoxStyle:{width:"100%"}}};break;case"ENUMS":t={brick:"forms.general-select",properties:{...n,...r(),mode:"multiple",options:[{label:"选项一",value:1},{label:"选项二",value:2}],placeholder:e.description,inputBoxStyle:{width:"100%"}}};break;case"DATE":case"TIME":t={brick:"forms.general-date-picker",properties:{...n,...r(),placeholder:e.description}};break;case"IP":t={brick:"forms.general-input",properties:{...n,...r(),placeholder:e.description,pattern:"((^s*((([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5]).){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5]))s*$)|(^s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:)))(%.+)?s*$))",message:{pattern:"输入字符不匹配IP格式"}}};break;case"JSON":t={brick:"forms.general-textarea",properties:{...n}};break;case"ARRAY":t={brick:"forms.general-select",properties:{...n}};break;case"STRUCTURE":case"STRUCTURE_ARRAY":t={brick:"forms.cmdb-instance-select-panel",properties:{...n,...r()}};break;default:t={brick:"forms.general-input",properties:{...n,...r(),placeholder:e.description}}}return t}(f);l||(l=e.brick),d={...e.properties,...d}}const p={brick:l,properties:d,iid:c,slot:s,events:a,context:i,children:Hr(o,t,n),[Kr]:n};return(0,u.hasOwnProperty)(e,"if")&&(p.if=e.if),p}function Hr(e,t,n){if(Array.isArray(e))return e.map((e=>Wr(e,t,n)))}var zr=new WeakSet;class Gr extends HTMLElement{constructor(){super(...arguments),(0,I.A)(this,zr),(0,o.A)(this,"renderRoot",void 0)}get $$typeof(){return"formRenderer"}validate(){(0,C.A)(zr,this,qr).call(this,"validate")}setInitValue(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];(0,C.A)(zr,this,qr).call(this,"setInitValue",t)}resetFields(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];(0,C.A)(zr,this,qr).call(this,"resetFields",t)}}function qr(e){var t,n;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const o=!1!==this.renderRoot?null===(t=this.firstElementChild)||void 0===t?void 0:t.firstElementChild:this.firstElementChild,a=null==o||null===(n=o.tagName)||void 0===n?void 0:n.toLowerCase();Vr.includes(a)?o[e](...r):console.error(`no ${e} method in the container element`,{container:a})}class Yr extends Error{constructor(e){super(e),this.name="PageNotFoundError",Error.captureStackTrace&&Error.captureStackTrace(this,l.BrickLoadError)}}async function Xr(e,t,n){const{title:r,variant:o,showLink:a,showDescription:i}=function(e){var t,n;return e instanceof Yr?"app not found"===e.message?{showLink:"home",title:c.i18n.t(`${Gt}:${Wt.APP_NOT_FOUND}`),variant:"no-permission"}:{showLink:"home",variant:"not-found",title:c.i18n.t(`${Gt}:${Wt.PAGE_NOT_FOUND}`)}:e instanceof l.BrickLoadError||e instanceof Error&&"ChunkLoadError"===e.name||e instanceof Event&&"error"===e.type&&e.target instanceof HTMLScriptElement?{showDescription:!0,title:c.i18n.t(`${Gt}:${Wt.NETWORK_ERROR}`),variant:"internet-disconnected",showLink:"reload"}:e instanceof R.HttpResponseError&&403===(null===(t=e.response)||void 0===t?void 0:t.status)?{showLink:"previous",showDescription:!0,title:c.i18n.t(`${Gt}:${Wt.NO_PERMISSION}`),variant:"no-permission"}:e instanceof R.HttpResponseError&&"200000"===(null===(n=e.responseJson)||void 0===n?void 0:n.code)?{showDescription:!0,title:c.i18n.t(`${Gt}:${Wt.LICENSE_EXPIRED}`),variant:"license-expired"}:{showLink:"previous",showDescription:!0,title:c.i18n.t(`${Gt}:${Wt.UNKNOWN_ERROR}`),variant:"unknown-error"}}(e);if(n){const n=Ra().error??"illustrations.error-message";if(!1!==n){const s="eo-link",c=(a?[n,s]:[n]).filter((e=>!customElements.get(e)));try{await Promise.race([(0,l.loadBricksImperatively)(c,Ca()),new Promise(((e,t)=>setTimeout((()=>{t(new Error("timeout"))}),3e3)))]);const u={tag:xn.BRICK,type:n,properties:{errorTitle:r,description:i?Qt(e):void 0,variant:o,dataset:{errorBoundary:""}},runtimeContext:null,return:t};return a&&(u.child=Jr(a,s,u,"")),u}catch(e){console.error("Failed to load brick:",c.join(", "),e)}}}const s=n&&!!customElements.get("easyops-default-error"),u={tag:xn.BRICK,type:s?"easyops-default-error":"div",properties:{errorTitle:r,dataset:{errorBoundary:""},style:{color:"var(--color-error)"}},runtimeContext:null,return:t},d={tag:xn.BRICK,type:"div",properties:{textContent:s?i?Qt(e):"":i?`${r}: ${Qt(e)}`:r},runtimeContext:null,return:u};return u.child=d,n&&a&&(d.sibling=Jr(a,"a",u,s?"link":"")),u}function Jr(e,t,n,r){return{tag:xn.BRICK,type:t,slotId:r,properties:{textContent:"home"===e?c.i18n.t(`${Gt}:${Wt.GO_BACK_HOME}`):"reload"===e?c.i18n.t(`${Gt}:${Wt.RELOAD}`):c.i18n.t(`${Gt}:${Wt.GO_BACK_TO_PREVIOUS_PAGE}`),href:"home"===e?p():"reload"===e?location.href:void 0},events:"previous"===e?{click:{action:"history.goBack"}}:void 0,runtimeContext:null,return:n}}async function Qr(e,t,n,r,o,a,i,s,c){const u=await async function(e,t){for(const n of e){if("string"!=typeof n.path)throw console.error("Invalid route with invalid path:",n),new Error("Invalid route with invalid type of path: "+typeof n.path);const e=Nt(n,t.app.homepage,t.location.pathname);if(e&&await yt(n,t))return t.app.noAuthGuard||n.public||null==wa||!wa.auth||wa.auth.isLoggedIn()?{match:e,route:n}:"unauthenticated"}return"missed"}(t,n),d={blockingList:[]},f=d.menuRequestNode={return:a};switch(u){case"missed":break;case"unauthenticated":d.unauthenticated=!0;break;default:{var p;const a=d.route=u.route;d.path=u.match.path;const g={...n,match:u.match};a.iid&&(h=a.iid,m=u.match,or.set(h,m)),s&&g.ctxStore.disposeDataInRoutes(t);const v=o.concat(a);g.ctxStore.define(a.context,g,void 0,v),g.pendingPermissionsPreCheck.push(null==wa||null===(p=wa.checkPermissions)||void 0===p?void 0:p.preCheckPermissionsForBrickOrRoute(a,(e=>mt(e,g))));const{preLoadBricks:b}=a;if(Array.isArray(b)&&d.blockingList.push((0,l.loadBricksImperatively)(b,Ca())),"redirect"===a.type){let e;if(e="string"==typeof a.redirect?await mt(a.redirect,g):(await tt({transform:"redirect",...a.redirect},g)).redirect,"string"!=typeof e)throw console.error("Unexpected redirect result:",e),new Error("Unexpected type of redirect result: "+typeof e);d.redirect={path:e}}else{const n=function(e,t){if(e){if("brick"===e.type)throw console.error("Set menu with brick is dropped in v3:",e),new Error("Set menu with brick is dropped in v3");if("resolve"!==e.type)return mt(e,t);console.warn("Set menu with resolve is not supported in v3 yet:",e)}}(a.menu,g);let o;n&&(f.request=n),s||r.memoizeMenuRequestNode(t,f),o="routes"===a.type?await Qr(e,a.routes,g,r,v,f,i,void 0,c):await Zr(e,a.bricks,g,r,v,f,i,void 0,void 0,c),oo(d,o),ao(f,o.menuRequestNode)}}}var h,m;return d}async function Zr(e,t,n,r,o,a,i,s,c,l){!function(e,t,n){function r(e){if((0,u.isObject)(e)&&"function"!=typeof e)if(Array.isArray(e))e.map(r);else for(const[t,n]of Object.entries(e))(0,u.isObject)(n)&&"useBrick"===t?Array.isArray(n)?n.forEach((e=>o(e,!0))):o(n,!0,!0):r(n)}function o(e,a,i){if(a&&(e[ir]=t),r(e.properties),n&&!i)return;const s=io(e.children,e.slots);for(const e of Object.values(s??{}))for(const t of e.bricks??[])o(t,a)}for(const t of e)o(t)}(t,n,!0);const d={blockingList:[]},f=c??[];return(await Promise.all(t.map(((t,c)=>eo(e,t,n,r,o,a,i,f.concat(c),s&&new Map(s),l))))).forEach(((t,n)=>{t.hasTrackingControls&&r.memoize(i,f.concat(n),t.node,e),oo(d,t)})),d}async function eo(e,t,n,r,o,a,i){let s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:[],c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:new Map,d=arguments.length>9?arguments[9]:void 0;try{return await async function(e,t,n,r,o,a,i,s,c,d){var f,p;const m={blockingList:[]};if(!t.brick)return t.template?console.error("Legacy templates are dropped in v3:",t):console.error("Invalid brick:",t),m;const{if:v,permissionsPreCheck:b,...y}=t;if(function(e){return"string"==typeof e?(0,O.isTrackAll)(e):at(e)&&(0,O.isTrackAll)(it(e))}(v))return eo(e,{brick:":if",dataSource:v,permissionsPreCheck:b,slots:{"":{type:"bricks",bricks:[y]}},...Object.getOwnPropertySymbols(t).reduce(((e,n)=>({...e,[n]:t[n]})),{})},n,r,o,a,i,s,c,d);const w=t[Ft],E=t[Kr],S={...n,tplStateStoreId:w,formStateStoreId:E};(0,u.hasOwnProperty)(t,jt)&&(S.forEachItem=t[jt],S.forEachIndex=t[Dt],S.forEachSize=t[Kt]);const{context:A}=t;if(Array.isArray(A)&&A.length>0){const e=Re(S);Oe(e,"Defining context on bricks","check your brick:",t),e||S.ctxStore.define(A,S)}if(S.pendingPermissionsPreCheck.push(null==wa||null===(f=wa.checkPermissions)||void 0===f?void 0:f.preCheckPermissionsForBrickOrRoute(t,(e=>mt(e,S)))),!await async function(e,t){return(0,u.isObject)(e.if)&&!at(e.if)?Et(await tt(e.if,t)):yt(e,t)}(t,S))return m;const k=t.brick;if(k.startsWith(":")){!function(e){if(":forEach"!==e&&":if"!==e&&":switch"!==e)throw new Error(`Unknown storyboard control node: "${e}"`)}(k);const{dataSource:n}=t,{contextNames:l,stateNames:d}=At(n),f=async(f,p,h)=>{var m;const g=await mt(n,f);h&&Ot(f,[{contextNames:l,stateNames:d,propValue:n}],p);const v=":forEach"===k?"":":switch"===k?String(g):g?"":"else",b=io(t.children,t.slots),y=b&&(0,u.hasOwnProperty)(b,v)&&(null===(m=b[v])||void 0===m?void 0:m.bricks);if(!Array.isArray(y))return{blockingList:[]};switch(k){case":forEach":return Array.isArray(g)?async function(e,t,n,r,o,a,i,s,c,l,u){const d={blockingList:[]},f=t.length,p=await Promise.all(t.map(((t,d)=>Promise.all(n.map(((n,p)=>eo(e,n,{...r,forEachItem:t,forEachIndex:d,forEachSize:f},o,a,i,s,l.concat(d*f+p),c&&new Map(c),u)))))));return p.flat().forEach(((t,n)=>{t.hasTrackingControls&&o.memoize(s,l.concat(n),t.node,e),oo(d,t)})),d}(e,g,y,f,r,o,a,i,c,s,p):{blockingList:[]};case":if":case":switch":return Zr(e,y,f,r,o,a,i,c,s,p)}},p=async(n,r)=>{var o;let a=!1;const i={disposes:[],listener:()=>{a=!0}};let s,c=0,l=!0;for(;l||a;)if(a=!1,s=await f(n,i,l&&"initial"===r),i.disposes.forEach((e=>e())),i.disposes.length=0,l=!1,++c>10)throw new Error(`Maximum rerender stack overflowed (iid: ${t.iid})`);return(o=s).node??(o.node={tag:xn.PLACEHOLDER,return:e}),s},m=await p(S,"initial"),{onMount:g,onUnmount:v}=t.lifeCycle??{};if(l||d){m.hasTrackingControls=!0;let t=0;const o=async()=>{const n=++t,[o,a,c]=ro(S),l=await p(o,"rerender"),u=[...a,...c];if(await no(l,o,u),t===n){v&&dn(v,S)(new CustomEvent("unmount",{detail:{rerender:!0}})),r.reRender(i,s,l.node,e),g&&dn(g,o)(new CustomEvent("mount",{detail:{rerender:!0}}));for(const e of u)e.mountAsyncData()}},a=(0,h.debounce)(o,0,{leading:!0,trailing:!0}),c=e.tag===xn.BRICK?e:null,u=c?c.disposes??(c.disposes=[]):[];if(l)for(const e of l)u.push(S.ctxStore.onChange(e,a));if(d)for(const e of d){const t=xe(S,"STATE",`: "${n}"`);u.push(t.onChange(e,a))}}return g&&r.registerArbitraryLifeCycle("onMount",(()=>{dn(g,S)(new CustomEvent("mount",{detail:{rerender:!1}}))})),v&&r.registerArbitraryLifeCycle("onUnmount",(()=>{dn(v,S)(new CustomEvent("unmount",{detail:{rerender:!1}}))})),m}/\.tpl-/.test(k)&&!Pe.get(k)&&await so((0,l.loadBricksImperatively)([k],Ca()),"brick",k,r.unknownBricks);const I=function(e,t){if(!e.includes(".")&&e.startsWith("tpl-")&&t){const n=`${t}.${e}`;if(Pe.get(n))return n}return!!Pe.get(e)&&e}(k,null===(p=S.app)||void 0===p?void 0:p.id);if(I){const e=c.get(I)??0;if(e>=10)throw new Error(`Maximum custom template stack overflowed: "${I}"`);c.set(I,e+1)}else k.includes("-")&&!customElements.get(k)&&(k===Dr?customElements.get(Dr)||customElements.define(Dr,Gr):m.blockingList.push(so((0,l.enqueueStableLoadBricks)([k],Ca()),"brick",k,r.unknownBricks)));let C,R;var _;k===Dr?(({formData:C,...R}=t.properties??{}),null!==(_=t.properties)&&void 0!==_&&_.compute&&(C=await mt(C,S))):R=t.properties;const P=[],x=function(e,t,n){return(0,u.isObject)(e)?Object.entries(e).map((e=>{let[r,o]=e;const{contextNames:a,stateNames:i,formStateNames:s}=At(o);return(a||i||s)&&n.push({contextNames:a,stateNames:i,formStateNames:s,propName:r,propValue:o}),[r,mt(o,t,{$$lazyForUseBrick:!0,$$stateOfUseBrick:"useBrick"===r?ft.USE_BRICK:ft.INITIAL})]})):[]}(R,S,P),M=t[Ut];M&&x.push(...M);const L="script"===k;if(L||"link"===k){const e=await It(x);if(L?e.src:"stylesheet"===e.rel&&e.href){const t=window.PUBLIC_ROOT??"";if(L){const{src:n,...r}=e;await so((0,l.loadScript)(n,t,r),"script",n,"silent")}else{const{href:n,...r}=e;await so((0,l.loadStyle)(n,t,r),"stylesheet",n,"silent")}return m}}const $={tag:xn.BRICK,type:I||k,return:e,slotId:i,events:t.events,runtimeContext:S,portal:t.portal,iid:t.iid,ref:t.ref};m.node=$;const B=(0,T.strictCollectMemberUsage)([t.events,t.lifeCycle],"PROCESSORS",2);B.size>0&&m.blockingList.push(so((0,l.loadProcessorsImperatively)(B,Ca()),"processors",[...B].join(", "),r.unknownBricks));const N=[];Ot(S,P,d);N.push((async()=>{$.properties=await It(x),function(e,t){for(const n of t){const t=()=>{e.element&&Rt(e.element,{[n.propName]:n.propValue},e.runtimeContext)};if(e.disposes??(e.disposes=[]),n.contextNames)for(const r of n.contextNames)e.disposes.push(e.runtimeContext.ctxStore.onChange(r,t));if(n.stateNames){const r=xe(e.runtimeContext,"STATE",`: "${n.propValue}"`);for(const o of n.stateNames)e.disposes.push(r.onChange(o,t))}if(n.formStateNames){const r=qe(e.runtimeContext,"FORM_STATE",`: "${n.propValue}"`);for(const o of n.formStateNames)e.disposes.push(r.onChange(o,t))}}}($,P)})()),r.registerBrickLifeCycle($,t.lifeCycle);let U,F=t;I?F=Fr(I,t,$,x,r):k===Dr&&(F=function(e,t,n,r,o){var a;const i="string"==typeof e?JSON.parse(e):e,s=(0,h.uniqueId)("form-state-"),c={...n.runtimeContext,formStateStoreId:s};delete c.forEachItem,delete c.forEachIndex,delete c.forEachSize,delete c.tplStateStoreId;const l=new Lr("FORM_STATE",void 0,o,s);c.formStateStoreMap.set(s,l),c.formStateStoreScope&&c.formStateStoreScope.push(l);const d=i.context??[];d.some((e=>"params"===e.name))||d.push({name:"params"}),l.define(d,c,r);const f=Wr(i.formSchema,i.fields,s);return Vr.includes(f.brick)&&t.events&&(f.events=function(e,t){const n=e??{};for(const[e,r]of Object.entries(t))n[e]=(0,u.hasOwnProperty)(n,e)?[n[e],r].flat():r;return n}(f.events,t.events)),"boolean"!=typeof(null===(a=t.properties)||void 0===a?void 0:a.renderRoot)||t.properties.renderRoot?{...t,slots:void 0,children:[{brick:"eo-micro-view",properties:{style:{padding:"12px"}},children:[f]}]}:{...t,slots:void 0,children:[f]}}(C,t,$,x,r)),F.portal&&($.slotId=void 0),I?(U={...S},delete U.forEachItem,delete U.forEachIndex,delete U.forEachSize):U=S;return N.push((async()=>{const e=io(F.children,F.slots);if(!e)return;const t=new Map,n=await Promise.all(Object.entries(e).map(((e,n)=>{let[i,s]=e;if("routes"!==s.type)return Zr($,s.bricks,U,r,o,a,i,c,void 0,d);const l=o[o.length-1];return null!=l&&l.incrementalSubRoutes&&(t.set(n,i),r.performIncrementalRender(s,o,(async(e,t)=>{const{homepage:n}=U.app,{pathname:c}=e;if(!g(n,c)||!o.every((e=>{let r,o;return(r=Nt(e,n,t.pathname))&&(o=Nt(e,n,c))&&(e!==l||(0,h.isEqual)(r.params,o.params))})))return!1;const[u,d,f]=ro({...U,location:e,query:new URLSearchParams(e.search)});let p,m=!1,v=[];try{if(p=await Qr($,s.routes,u,r,o,a,i,!0),p.route){if(r.reBailout(p))return!0;v=[...d,...f],await no(p,u,[u.ctxStore,...v])}await r.reMergeMenuRequestNodes(a,s.routes,p.menuRequestNode)}catch(e){console.error("Incremental sub-router failed:",e);const t=await r.reCatch(e,$);if(!t)return!0;({failed:m,output:p}=t),await r.reMergeMenuRequestNodes(a,s.routes,p.menuRequestNode)}if(r.reRender(i,[],p.node,$),!m){u.ctxStore.mountAsyncData(p.route);for(const e of v)e.mountAsyncData()}return!!p.route||null}))),Qr($,s.routes,U,r,o,a,i,void 0,d)}))),i={...m,node:void 0,blockingList:[],menuRequestNode:void 0};n.forEach(((e,n)=>{t.has(n)&&r.memoize(t.get(n),[],e.node,$),oo(i,e),function(e,t){const n=t.menuRequestNode;if(n)if(e.menuRequestNode){let t=e.menuRequestNode;for(;t.sibling;)t=t.sibling;t.sibling=n}else e.menuRequestNode=n}(i,e)})),i.node&&($.child=i.node),oo(m,{...i,node:void 0}),ao(a,m.menuRequestNode=i.menuRequestNode)})()),await Promise.all(N),m}(e,t,n,r,o,a,i,s,c,d)}catch(n){if(t.errorBoundary)return console.error("Error caught by error boundary:",n),{node:await Xr(n,e),blockingList:[]};throw n}}function to(e){return[e.ctxStore,...e.tplStateStoreMap.values(),...e.formStateStoreMap.values()]}function no(e,t,n){return(0,l.flushStableLoadBricks)(),Promise.all([...e.blockingList,...n.map((e=>e.waitForAll())),...t.pendingPermissionsPreCheck])}function ro(e){const t=[],n=[];return[{...e,tplStateStoreScope:t,formStateStoreScope:n},t,n]}function oo(e,t){const{blockingList:n,node:r,menuRequestNode:o,hasTrackingControls:a,...i}=t;if(e.blockingList.push(...n),r)if(e.node){let t=e.node;for(;t.sibling;)t=t.sibling;t.sibling=r}else e.node=r;Object.assign(e,i)}function ao(e,t){if(t)if(e.child){let n=e.child;for(;n.sibling;)n=n.sibling;n.sibling=t}else e.child=t}function io(e,t){let n=t;if(Array.isArray(e)&&!n){n={};for(const t of e){const e=t.slot??"";(0,u.hasOwnProperty)(n,e)||(n[e]={type:"bricks",bricks:[]}),n[e].bricks.push(t)}}return n}function so(e,t,n,r){return"silent"===r?e.catch((e=>{console.error('Load %s "%s" failed:',t,n,e)})):e}let co,lo,uo;function fo(){if(!co){if(co={isInIframe:!1,isInIframeOfSameSite:!1,isInIframeOfNext:!1,isInIframeOfVisualBuilder:!1,isInIframeOfLegacyConsole:!1},window!==window.parent){co.isInIframe=!0;try{if(window.origin===window.parent.origin){co.isInIframeOfSameSite=!0;const e="/next/"===p(),t=window.parent.location.pathname,n=t.startsWith("/next/");co.isInIframeOfNext=0==(Number(e)^Number(n));const r=n?"/next":"";co.isInIframeOfVisualBuilder=t.startsWith(`${r}/visual-builder/`)||t.startsWith(`${r}/visual-builder-`),co.isInIframeOfLegacyConsole=e&&!n}}catch{}}Object.freeze(co)}return co}function po(e){var t;if(e.$$registerCustomTemplateProcessed)return;e.$$registerCustomTemplateProcessed=!0;const n=null===(t=e.meta)||void 0===t?void 0:t.customTemplates;if(Array.isArray(n))for(const t of n){const n=t.name.includes(".")?t.name:`${e.app.id}.${t.name}`;Pe.define(n,t)}}function ho(e){let t;t="8.2"===e?"v8-2":"v8",document.documentElement.dataset.ui=t}const mo="basic.show-watermark";var go=new WeakMap,vo=new WeakMap,bo=new WeakMap,yo=new WeakMap,wo=new WeakMap,Eo=new WeakMap,So=new WeakMap,Ao=new WeakMap,ko=new WeakMap,Io=new WeakMap,Co=new WeakMap,Ro=new WeakSet;class Oo{constructor(e){(0,I.A)(this,Ro),(0,a.A)(this,go,void 0),(0,a.A)(this,vo,!1),(0,a.A)(this,bo,void 0),(0,a.A)(this,yo,void 0),(0,a.A)(this,wo,void 0),(0,a.A)(this,Eo,new Set),(0,a.A)(this,So,0),(0,a.A)(this,Ao,void 0),(0,a.A)(this,ko,void 0),(0,a.A)(this,Io,void 0),(0,a.A)(this,Co,void 0),(0,i.A)(go,this,e);const t=k();window.addEventListener("beforeunload",(e=>{(0,C.A)(Ro,this,To).call(this,{})?(e.preventDefault(),e.returnValue=""):delete e.returnValue})),t.block(((e,t)=>(0,C.A)(Ro,this,To).call(this,{location:e,action:t})))}getRenderId(){return(0,s.A)(Ao,this)}getRuntimeContext(){return(0,s.A)(yo,this)}getRecentApps(){return{currentApp:(0,s.A)(ko,this),previousApp:(0,s.A)(Io,this)}}getNavConfig(){return(0,s.A)(Co,this)}bootstrap(){window.AbortController&&(lo=new AbortController,R.http.interceptors.request.use((e=>{var t;return{...e,options:{...e.options,signal:null!==(t=e.options)&&void 0!==t&&t.noAbortOnRouteChange?null:lo.signal}}})));const e=k();let t=e.location;return e.listen(((e,n)=>{const r=t;t=e,(0,s.A)(vo,this)?(0,i.A)(bo,this,{location:e,prevLocation:r,action:n}):(0,C.A)(Ro,this,Po).call(this,{location:e,prevLocation:r,action:n}).catch(rn)})),(0,C.A)(Ro,this,Po).call(this,{location:e.location})}}function To(e){var t;const n=k(),r=n.getBlockMessage();null===(t=(0,s.A)(wo,this))||void 0===t||t.dispatchBeforePageLeave(e);const o=n.getBlockMessage();return!r&&o&&n.unblock(),o}function _o(e,t,n){var r,o;if((0,i.A)(So,this,(r=(0,s.A)(So,this),o=r++,r)),o>10){const t=`Infinite redirect detected: from "${n.pathname}${n.search}${n.hash}" to "${e}"`;throw new Error(t)}k().replace(e,t)}async function Po(e){(0,i.A)(vo,this,!0);try{await(0,C.A)(Ro,this,xo).call(this,e)}finally{if((0,i.A)(vo,this,!1),(0,s.A)(bo,this)){const e=(0,s.A)(bo,this);(0,i.A)(bo,this,void 0),await(0,C.A)(Ro,this,Po).call(this,e)}}}async function xo(e){let{location:t,prevLocation:n,action:r}=e;if(n){var o,a,i,c;let e;const u={hash:void 0,state:void 0};var l;if(void 0!==t.key&&("POP"!==r||void 0!==n.key&&!1!==(null===(o=n.state)||void 0===o?void 0:o.notify))||(u.key=void 0),((0,f.locationsAreEqual)({...n,...u},{...t,...u})||"POP"!==r&&!1===(null===(a=t.state)||void 0===a?void 0:a.notify))&&(e=!0),e||null!==(i=t.state)&&void 0!==i&&i.noIncremental||(e=await(null===(l=(0,s.A)(wo,this))||void 0===l?void 0:l.didPerformIncrementalRender(t,n))),e)return;if(lo&&(lo.abort(),lo=new AbortController),null===(c=(0,s.A)(wo,this))||void 0===c||c.dispatchPageLeave(),"POP"===r&&v(m((0,s.A)(go,this),t.pathname)))return void window.location.reload();V("locationChange")}return(0,C.A)(Ro,this,Mo).call(this,t,!n)}async function Mo(e,t){var n,r,o,a;const c=(0,i.A)(Ao,this,(0,h.uniqueId)("render-id-"));Je=new WeakSet,et.clear(),null==wa||null===(n=wa.flowApi)||void 0===n||n.clearCollectWidgetContract(),k().unblock();const u=null==wa||null===(r=wa.pageView)||void 0===r?void 0:r.create(),d=m((0,s.A)(go,this),e.pathname),f=null===(o=(0,s.A)(yo,this))||void 0===o?void 0:o.app,p=null==d||null===(a=d.app)||void 0===a?void 0:a.id;window.BOOTSTRAP_UNION_FILE&&p&&p!==(null==f?void 0:f.id)&&function(e){const{appId:t,version:n}=e;window.APP_ROOT_TPL&&(window.APP_ID=t,window.APP_ROOT=window.APP_ROOT_TPL.replace("{id}",t).replace("{version}",n))}({appId:p,version:d.app.currentVersion}),null!=d&&d.app&&await async function(e){if(!e.$$fulfilled)return e.$$fulfilling||(e.$$fulfilling=async function(e){var t;await(null==wa||null===(t=wa.fulfilStoryboard)||void 0===t?void 0:t.call(wa,e)),L(e),Object.assign(e,{$$fulfilled:!0,$$fulfilling:null})}(e)),e.$$fulfilling}(d);const g=(0,i.A)(ko,this,null==d?void 0:d.app);!function(){var e,t,n,r,o;const a=Sa().getFeatureFlags(),i=Sa().getMiscSettings();if(!a["show-watermark"])return;const s="0.0.0"===(null===(e=window.APP_ROOT)||void 0===e||null===(e=e.match(/versions\/([^/]+)\//))||void 0===e?void 0:e[1])||"0.0.0"===(null===(t=window.APP_ROOT)||void 0===t||null===(t=t.match(/micro-apps\/(?:v2|v3)\/[^/]+\/([^/]+)/))||void 0===t?void 0:t[1]),c=(null==wa||null===(n=wa.auth)||void 0===n||null===(n=n.getAuth())||void 0===n?void 0:n.username)??"",u=i.watermarkConfig??{flags:{}},d=[..."string"==typeof u.content?[u.content]:u.content??[],null!==(r=u.flags)&&void 0!==r&&r["show-development"]&&s?"Development":"",null!==(o=u.flags)&&void 0!==o&&o["show-user"]?c:""].filter(Boolean);if(0===d.length)return;const f={content:d,zIndex:1001,width:200,font:{fontSize:28},gap:[190,190],...(0,h.omit)(u,["content","flags"])};uo?uo.resolve(f):(0,l.loadBricksImperatively)([mo],Ca()).then((()=>{uo=document.createElement(mo),uo.resolve(f)}),(e=>{console.error("Load watermark service failed:",e)}))}();const v=f&&g?f.id!==g.id:f!==g;(0,O.clearExpressionASTCache)(),v&&(0,O.clearFunctionASTCache)();const b=Sa().getFeatureFlags(),y=(0,s.A)(wo,this),w=(t,n)=>{null==u||u({status:"redirected"}),(0,s.A)(Eo,this).add(y),(0,C.A)(Ro,this,_o).call(this,t,n,e)},E=()=>{const t=b["sso-enabled"]?"/sso-auth/login":"/auth/login";Jt(e),w(t,{from:e})},S=document.querySelector("#main-mount-point"),A=document.querySelector("#portal-mount-point"),I={tag:xn.ROOT,container:S,createPortal:A},T=()=>{var e;Mn(S),Mn(A),(0,s.A)(Eo,this).add(y);for(const e of(0,s.A)(Eo,this))e&&(e.dispatchOnUnmount(),e.dispose());(0,s.A)(Eo,this).clear(),null==wa||null===(e=wa.messageDispatcher)||void 0===e||e.reset(),v&&((0,i.A)(Io,this,f),window.dispatchEvent(new CustomEvent("app.change",{detail:{previousApp:f,currentApp:g}})))};if(Q(g&&(re()[g.id]||g.theme)||"light"),ae("default"),g){var _,P,x,M,$,B;null==wa||null===(_=wa.checkInstalledApps)||void 0===_||_.preCheckInstalledApps(d,(e=>!!Pa(e)));const n={bailout:e=>e.unauthenticated?(E(),!0):e.redirect?(w(e.redirect.path,e.redirect.state),!0):void(0,i.A)(So,this,0),mergeMenus:async e=>{const t=await Promise.all(e);(0,i.A)(Co,this,function(e){const t={breadcrumb:[]};for(const n of e){const{breadcrumb:e}=n;e&&(e.overwrite?t.breadcrumb=e.items:t.breadcrumb.push(...e.items))}return t}(t)),window.dispatchEvent(new CustomEvent("navConfig.change",{detail:(0,s.A)(Co,this)}))},catch:async(t,n,r,o)=>{if(!Zt(t)||window.NO_AUTH_GUARD){if(!(t instanceof R.HttpAbortError)){const a=Sa().getMiscSettings().noAuthGuardLoginPath;if(Zt(t)&&a)return void w(a,{from:e});if(r)throw t;return{failed:!0,output:{node:await Xr(t,n,!o),blockingList:[]}}}(0,s.A)(Eo,this).add(y)}else E()}},r=(0,i.A)(wo,this,new Gn("page",{routeHelper:n,renderId:c})),o=(0,i.A)(yo,this,{app:g,location:e,query:new URLSearchParams(e.search),flags:b,sys:{...null==wa||null===(P=wa.auth)||void 0===P?void 0:P.getAuth(),...fo(),settings:{brand:Sa().getBrandSettings()}},ctxStore:new Lr("CTX",void 0,r),pendingPermissionsPreCheck:[null==wa||null===(x=wa.checkPermissions)||void 0===x?void 0:x.preCheckPermissions(d)],tplStateStoreMap:new Map,formStateStoreMap:new Map});(0,i.A)(Co,this,void 0),po(d),me(null===(M=d.meta)||void 0===M?void 0:M.functions,g),null==wa||null===($=wa.flowApi)||void 0===$||$.collectContract(null===(B=d.meta)||void 0===B?void 0:B.contracts);let a,l=!1,f=[];try{or.clear();const e={};if(a=await Qr(I,function(e){if(window.parent===window)return e;let t=e;const n=(0,h.findLastIndex)(t,(e=>e.path.startsWith("${APP.homepage}/_dev_only_/template-preview/")));t=[...t.slice(0,n+1),{path:"${APP.homepage}/_dev_only_/template-preview/:templateId",bricks:[{brick:"span"}],menu:!1,exact:!0},...t.slice(n+1)];const r=(0,h.findLastIndex)(t,(e=>e.path.startsWith("${APP.homepage}/_dev_only_/snippet-preview/")));return t=[...t.slice(0,r+1),{path:"${APP.homepage}/_dev_only_/snippet-preview/:snippetId",bricks:[{brick:"span"}],menu:!1,exact:!0},...t.slice(r+1)],t}(d.routes),o,r,[],e),n.bailout(a))return;f=to(o),await no(a,o,f),e.child=a.menuRequestNode,r.setInitialMenuRequestNode(e),await n.mergeMenus(r.getMenuRequests())}catch(e){console.error("Router failed:",e);const r=await n.catch(e,I,t);if(!r)return;({failed:l,output:a}=r)}if(I.child=a.node,T(),a.route&&"routes"!==a.route.type||l){if(l||r.dispatchBeforePageLoad(),te(),se(),ho(null==g?void 0:g.uiVersion),Ln(I),window.scrollTo(0,0),l)null==u||u({status:"failed"});else{r.dispatchPageLoad(),r.dispatchAnchorLoad(),r.dispatchOnMount(),r.initializeScrollIntoView(),r.initializeMediaChange(),r.initializeMessageDispatcher();for(const e of f)e.mountAsyncData();null==u||u({status:"ok",path:a.path,pageTitle:document.title})}return void V("rendered")}}else{if(!window.NO_AUTH_GUARD&&null!=wa&&wa.auth&&!wa.auth.isLoggedIn())return void E();T()}te(),se();const N=await Xr(new Yr(g?"page not found":"app not found"),I,!0);I.child=N,Ln(I),window.scrollTo(0,0),null==u||u({status:"not-found"}),V("rendered")}const Lo="undefined"!=typeof BRICK_PACKAGES?BRICK_PACKAGES:null;function $o(e,t){(function(e){return"string"==typeof e&&-1!==e.indexOf(".")&&1===parseFloat(e)})(e)&&(e="100%");var n=function(e){return"string"==typeof e&&-1!==e.indexOf("%")}(e);return e=360===t?e:Math.min(t,Math.max(0,parseFloat(e))),n&&(e=parseInt(String(e*t),10)/100),Math.abs(e-t)<1e-6?1:e=360===t?(e<0?e%t+t:e%t)/parseFloat(String(t)):e%t/parseFloat(String(t))}function Bo(e){return e<=1?"".concat(100*Number(e),"%"):e}function No(e){return 1===e.length?"0"+e:String(e)}function Uo(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*n*(t-e):n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function Fo(e){return jo(e)/255}function jo(e){return parseInt(e,16)}var Do={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function Ko(e){var t,n,r,o={r:0,g:0,b:0},a=1,i=null,s=null,c=null,l=!1,u=!1;return"string"==typeof e&&(e=function(e){if(0===(e=e.trim().toLowerCase()).length)return!1;var t=!1;if(Do[e])e=Do[e],t=!0;else if("transparent"===e)return{r:0,g:0,b:0,a:0,format:"name"};var n=zo.rgb.exec(e);return n?{r:n[1],g:n[2],b:n[3]}:(n=zo.rgba.exec(e))?{r:n[1],g:n[2],b:n[3],a:n[4]}:(n=zo.hsl.exec(e))?{h:n[1],s:n[2],l:n[3]}:(n=zo.hsla.exec(e))?{h:n[1],s:n[2],l:n[3],a:n[4]}:(n=zo.hsv.exec(e))?{h:n[1],s:n[2],v:n[3]}:(n=zo.hsva.exec(e))?{h:n[1],s:n[2],v:n[3],a:n[4]}:(n=zo.hex8.exec(e))?{r:jo(n[1]),g:jo(n[2]),b:jo(n[3]),a:Fo(n[4]),format:t?"name":"hex8"}:(n=zo.hex6.exec(e))?{r:jo(n[1]),g:jo(n[2]),b:jo(n[3]),format:t?"name":"hex"}:(n=zo.hex4.exec(e))?{r:jo(n[1]+n[1]),g:jo(n[2]+n[2]),b:jo(n[3]+n[3]),a:Fo(n[4]+n[4]),format:t?"name":"hex8"}:!!(n=zo.hex3.exec(e))&&{r:jo(n[1]+n[1]),g:jo(n[2]+n[2]),b:jo(n[3]+n[3]),format:t?"name":"hex"}}(e)),"object"==typeof e&&(Go(e.r)&&Go(e.g)&&Go(e.b)?(t=e.r,n=e.g,r=e.b,o={r:255*$o(t,255),g:255*$o(n,255),b:255*$o(r,255)},l=!0,u="%"===String(e.r).substr(-1)?"prgb":"rgb"):Go(e.h)&&Go(e.s)&&Go(e.v)?(i=Bo(e.s),s=Bo(e.v),o=function(e,t,n){e=6*$o(e,360),t=$o(t,100),n=$o(n,100);var r=Math.floor(e),o=e-r,a=n*(1-t),i=n*(1-o*t),s=n*(1-(1-o)*t),c=r%6;return{r:255*[n,i,a,a,s,n][c],g:255*[s,n,n,i,a,a][c],b:255*[a,a,s,n,n,i][c]}}(e.h,i,s),l=!0,u="hsv"):Go(e.h)&&Go(e.s)&&Go(e.l)&&(i=Bo(e.s),c=Bo(e.l),o=function(e,t,n){var r,o,a;if(e=$o(e,360),t=$o(t,100),n=$o(n,100),0===t)o=n,a=n,r=n;else{var i=n<.5?n*(1+t):n+t-n*t,s=2*n-i;r=Uo(s,i,e+1/3),o=Uo(s,i,e),a=Uo(s,i,e-1/3)}return{r:255*r,g:255*o,b:255*a}}(e.h,i,c),l=!0,u="hsl"),Object.prototype.hasOwnProperty.call(e,"a")&&(a=e.a)),a=function(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}(a),{ok:l,format:e.format||u,r:Math.min(255,Math.max(o.r,0)),g:Math.min(255,Math.max(o.g,0)),b:Math.min(255,Math.max(o.b,0)),a}}var Vo="(?:".concat("[-\\+]?\\d*\\.\\d+%?",")|(?:").concat("[-\\+]?\\d+%?",")"),Wo="[\\s|\\(]+(".concat(Vo,")[,|\\s]+(").concat(Vo,")[,|\\s]+(").concat(Vo,")\\s*\\)?"),Ho="[\\s|\\(]+(".concat(Vo,")[,|\\s]+(").concat(Vo,")[,|\\s]+(").concat(Vo,")[,|\\s]+(").concat(Vo,")\\s*\\)?"),zo={CSS_UNIT:new RegExp(Vo),rgb:new RegExp("rgb"+Wo),rgba:new RegExp("rgba"+Ho),hsl:new RegExp("hsl"+Wo),hsla:new RegExp("hsla"+Ho),hsv:new RegExp("hsv"+Wo),hsva:new RegExp("hsva"+Ho),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function Go(e){return Boolean(zo.CSS_UNIT.exec(String(e)))}var qo=2,Yo=.16,Xo=.05,Jo=.05,Qo=.15,Zo=5,ea=4,ta=[{index:7,opacity:.15},{index:6,opacity:.25},{index:5,opacity:.3},{index:5,opacity:.45},{index:5,opacity:.65},{index:5,opacity:.85},{index:4,opacity:.9},{index:3,opacity:.95},{index:2,opacity:.97},{index:1,opacity:.98}];function na(e){var t=function(e,t,n){e=$o(e,255),t=$o(t,255),n=$o(n,255);var r=Math.max(e,t,n),o=Math.min(e,t,n),a=0,i=r,s=r-o,c=0===r?0:s/r;if(r===o)a=0;else{switch(r){case e:a=(t-n)/s+(t<n?6:0);break;case t:a=(n-e)/s+2;break;case n:a=(e-t)/s+4}a/=6}return{h:a,s:c,v:i}}(e.r,e.g,e.b);return{h:360*t.h,s:t.s,v:t.v}}function ra(e){var t=e.r,n=e.g,r=e.b;return"#".concat(function(e,t,n,r){var o=[No(Math.round(e).toString(16)),No(Math.round(t).toString(16)),No(Math.round(n).toString(16))];return o.join("")}(t,n,r))}function oa(e,t,n){var r;return(r=Math.round(e.h)>=60&&Math.round(e.h)<=240?n?Math.round(e.h)-qo*t:Math.round(e.h)+qo*t:n?Math.round(e.h)+qo*t:Math.round(e.h)-qo*t)<0?r+=360:r>=360&&(r-=360),r}function aa(e,t,n){return 0===e.h&&0===e.s?e.s:((r=n?e.s-Yo*t:t===ea?e.s+Yo:e.s+Xo*t)>1&&(r=1),n&&t===Zo&&r>.1&&(r=.1),r<.06&&(r=.06),Number(r.toFixed(2)));var r}function ia(e,t,n){var r;return(r=n?e.v+Jo*t:e.v-Qo*t)>1&&(r=1),Number(r.toFixed(2))}function sa(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[],r=Ko(e),o=Zo;o>0;o-=1){var a=na(r),i=ra(Ko({h:oa(a,o,!0),s:aa(a,o,!0),v:ia(a,o,!0)}));n.push(i)}n.push(ra(r));for(var s=1;s<=ea;s+=1){var c=na(r),l=ra(Ko({h:oa(c,s),s:aa(c,s),v:ia(c,s)}));n.push(l)}return"dark"===t.theme?ta.map((function(e){var r,o,a,i=e.index,s=e.opacity;return ra((r=Ko(t.backgroundColor||"#141414"),a=100*s/100,{r:((o=Ko(n[i])).r-r.r)*a+r.r,g:(o.g-r.g)*a+r.g,b:(o.b-r.b)*a+r.b}))})):n}var ca={red:"#F5222D",volcano:"#FA541C",orange:"#FA8C16",gold:"#FAAD14",yellow:"#FADB14",lime:"#A0D911",green:"#52C41A",cyan:"#13C2C2",blue:"#1890FF",geekblue:"#2F54EB",purple:"#722ED1",magenta:"#EB2F96",grey:"#666666"},la={},ua={};function da(e){return':root,\n[data-override-theme="light"] {\n'.concat(e,"}")}function fa(e){return'html[data-theme="dark-v2"],\n[data-override-theme="dark-v2"] {\n'.concat(e,"}")}function pa(e){return e.match(/[0-9a-fA-F]{2}/g).map((e=>parseInt(e,16))).join(", ")}function ha(e,t,n){return"dark"===t?sa(e,{theme:t,backgroundColor:n})[5]:e}function ma(e){const t=[];if(["light","dark"].forEach((n=>{if(e[n])switch(e.type){case"brandColor":t.push(function(e,t){return("dark"===e?fa:da)("string"==typeof(n=t)?"  --color-brand: ".concat(n,";\n"):["  --color-brand: ".concat(n.default,";"),"  --color-brand-hover: ".concat(n.hover,";"),"  --color-brand-active: ".concat(n.active,";"),""].join("\n"));var n}(n,e[n]));break;case"baseColors":t.push(function(e,t,n){return("dark"===e?fa:da)("".concat(function(e,t){return Object.entries(e).flatMap((e=>{var[n,r]=e;return function(e){if(!/^[a-z0-9]+(?:-[a-z0-9]+)*$/.test(e))throw new Error("Invalid base color name: ".concat(JSON.stringify(e)))}(n),r.map(((e,r)=>["  --palette-".concat(n,"-").concat(r+1,"-channel: ").concat(pa(e),";")].concat("dark"===t?[]:"  --palette-".concat(n,"-").concat(r+1,": rgb(var(--palette-").concat(n,"-").concat(r+1,"-channel));")).join("\n"))).concat("")})).join("\n")}(function(e,t,n){return Object.fromEntries(Object.entries(e).map((e=>{var[r,o]=e;return[r,sa(o,"dark"===t?{theme:t,backgroundColor:n}:void 0)]})))}(t,e,n),e),"\n").concat(function(e,t,n){return Object.entries({green:"green",red:"red",blue:"blue",orange:"orange",cyan:"cyan",purple:"purple",geekblue:"indigo"}).flatMap((r=>{var[o,a]=r;return["  --theme-".concat(o,"-color-rgb-channel: ").concat(pa(ha(t[a],e,n)),";"),..."dark"===e?[]:["  --theme-".concat(o,"-color: var(--palette-").concat(a,"-6);"),"  --theme-".concat(o,"-border-color: var(--palette-").concat(a,"-3);")],"  --theme-".concat(o,"-background: var(--palette-").concat(a,"-").concat("dark"===e?2:1,");"),""]})).join("\n")}(e,t,n)))}(n,e[n],e.backgroundColor));break;case"variables":t.push(function(e,t){return("dark"===e?fa:da)(function(e){return Object.entries(e).map((e=>{var[t,n]=e;return function(e){if(!/^--[a-z][a-z0-9]*(?:-[a-z0-9]+)*$/.test(e))throw new Error("Invalid css variable name: ".concat(JSON.stringify(e)))}(t),"  ".concat(t,": ").concat(n,";")})).concat("").join("\n")}(t))}(n,e[n]))}})),t.length>0){const e=document.createElement("style");return e.textContent=t.join("\n\n"),document.head.appendChild(e),()=>{e.remove()}}}let ga,va,ba,ya,wa;function Ea(e){if(ga)throw new Error("Cannot create multiple runtimes");return window.addEventListener("message",(e=>{let{data:t}=e;if((null==t?void 0:t.source)!==U)return;const n=t.payload;switch(null==n?void 0:n.type){case F:K=n.active;break;case j:D=n.panel}})),wa=null==e?void 0:e.hooks,(0,c.initializeI18n)(Gt,qt),d.locale(c.i18n.language),c.i18n.on("languageChanged",(()=>{d.locale(c.i18n.language)})),A(),ga=new Ia,ga}Object.keys(ca).forEach((function(e){la[e]=sa(ca[e]),la[e].primary=la[e][5],ua[e]=sa(ca[e],{theme:"dark",backgroundColor:"#141414"}),ua[e].primary=ua[e][5]})),la.red,la.volcano,la.gold,la.orange,la.yellow,la.lime,la.green,la.cyan,la.blue,la.geekblue,la.purple,la.magenta,la.grey;const Sa=function(){const e=S();if(e)return function(){return new Proxy(e.getRuntime(),{get(){switch(arguments.length<=1?void 0:arguments[1]){case"getCurrentApp":case"getRecentApps":case"hasInstalledApp":case"getDesktops":case"getLaunchpadSettings":case"getLaunchpadSiteMap":case"toggleLaunchpadEffect":case"applyPageTitle":case"getNavConfig":case"getFeatureFlags":case"getMiscSettings":case"getBrandSettings":return Reflect.get(...arguments)}}})}}()||function(){return ga};var Aa=new WeakMap,ka=new WeakMap;class Ia{constructor(){(0,a.A)(this,Aa,!1),(0,a.A)(this,ka,!1),(0,o.A)(this,"version",3)}initialize(e){var t;if((0,s.A)(Aa,this))throw new Error("The runtime cannot be initialized more than once");(0,i.A)(Aa,this,!0),function(e){(0,u.isObject)(e.settings)&&(0,u.deepFreeze)(e.settings),e.brickPackages&&(0,u.deepFreeze)(e.brickPackages)}(e),va=e;const{notification:n,dialog:r}=Ra();var o;!1!==n&&(o=n??"basic.show-notification",(0,this.loadBricks)([o]).then((()=>{tn=document.createElement(o)}),(e=>{console.error("Load notification service failed:",e)}))),!1!==r&&function(e,t){t([e]).then((()=>{Yt=document.createElement(e)}),(e=>{console.error("Load dialog service failed:",e)}))}(r??"basic.show-dialog",this.loadBricks),function(e){e&&(e.brandColor?ma({type:"brandColor",...e.brandColor}):e.baseColors?ma({type:"baseColors",...e.baseColors}):e.variables&&ma({type:"variables",...e.variables}))}(null===(t=e.settings)||void 0===t||null===(t=t.misc)||void 0===t?void 0:t.theme)}async bootstrap(e){if(e&&this.initialize(e),(0,s.A)(ka,this))throw new Error("The runtime cannot be bootstrapped more than once");(0,i.A)(ka,this,!0),ba=new Oo(va.storyboards),await ba.bootstrap()}getRecentApps(){var e;return(null===(e=ba)||void 0===e?void 0:e.getRecentApps())??{}}getCurrentApp(){var e;return null===(e=ba)||void 0===e?void 0:e.getRecentApps().currentApp}hasInstalledApp(e,t){return Ge(e,t)}getFeatureFlags(){var e,t;return{...null===(e=va)||void 0===e||null===(e=e.settings)||void 0===e?void 0:e.featureFlags,...null===(t=ba)||void 0===t||null===(t=t.getRecentApps().currentApp)||void 0===t||null===(t=t.config)||void 0===t||null===(t=t.settings)||void 0===t?void 0:t.featureFlags,"migrate-to-brick-next-v3":!0}}getMiscSettings(){var e,t;return{...null===(e=va)||void 0===e||null===(e=e.settings)||void 0===e?void 0:e.misc,...null===(t=ba)||void 0===t||null===(t=t.getRecentApps().currentApp)||void 0===t||null===(t=t.config)||void 0===t||null===(t=t.settings)||void 0===t?void 0:t.misc}}getBrandSettings(){var e;return{base_title:"DevOps 管理专家",...null===(e=va)||void 0===e||null===(e=e.settings)||void 0===e?void 0:e.brand}}getLaunchpadSettings(){var e;return{columns:7,rows:4,...null===(e=va)||void 0===e||null===(e=e.settings)||void 0===e?void 0:e.launchpad}}getDesktops(){var e;return(null===(e=va)||void 0===e?void 0:e.desktops)??[]}getLaunchpadSiteMap(){var e;return(null===(e=va)||void 0===e?void 0:e.siteSort)??[]}toggleLaunchpadEffect(e){document.body.classList.toggle("launchpad-open",e)}applyPageTitle(e){var t;const n=this.getBrandSettings().base_title;document.title=(null===(t=ba)||void 0===t||null===(t=t.getRecentApps().currentApp)||void 0===t?void 0:t.localeTitle)||(e?`${e} - ${n}`:n)}getNavConfig(){var e;return null===(e=ba)||void 0===e?void 0:e.getNavConfig()}loadBricks(e){return(0,l.loadBricksImperatively)(e,Ca())}}function Ca(){var e;return ya??(ya=function(e,t){if(null==t||!t.length)return e;const n=new Map;return[...t,...e].forEach((e=>{const t=e.filePath.split("/")[1];n.has(t)||n.set(t,e)})),Array.from(n.values())}((null===(e=va)||void 0===e?void 0:e.brickPackages)??Lo??window.STANDALONE_BRICK_PACKAGES??[],window.PUBLIC_DEPS))}function Ra(){var e;return(null===(e=va)||void 0===e||null===(e=e.settings)||void 0===e?void 0:e.presetBricks)??{}}function Oa(){var e;return null===(e=ba)||void 0===e?void 0:e.getRenderId()}function Ta(){var e;return null===(e=ba)||void 0===e?void 0:e.getRuntimeContext()}function _a(e){var t;return null===(t=va)||void 0===t||null===(t=t.storyboards)||void 0===t?void 0:t.find((t=>t.app.id===e))}function Pa(e){var t;return null===(t=_a(e))||void 0===t?void 0:t.app}function xa(){for(var e,t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];null==wa||null===(e=wa.auth)||void 0===e||null===(t=e.authenticate)||void 0===t||t.call(e,...r)}function Ma(){var e;return null==wa||null===(e=wa.auth)||void 0===e?void 0:e.getAuth()}function La(){var e,t;return null==wa||null===(e=wa.auth)||void 0===e||null===(t=e.logout)||void 0===t?void 0:t.call(e)}function $a(){var e;return null==wa||null===(e=wa.auth)||void 0===e?void 0:e.isLoggedIn()}var Ba=new WeakMap;const Na=new class{constructor(){(0,a.A)(this,Ba,new Map)}define(e,t){(0,s.A)(Ba,this).has(e)?console.error(`Custom editor of "${e}" already registered`):(0,s.A)(Ba,this).set(e,t)}get(e){return(0,s.A)(Ba,this).get(e)}};async function Ua(e,t,n){return nt(await Xe(e),e,"resolve",t,n)}function Fa(e){let t,{portal:n,scope:r="fragment",unknownBricks:o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=n;t=n||(()=>(a=document.createElement("div"),a.style.position="absolute",a.style.width=a.style.height="0",document.body.append(a),a));let i,s,l=!1;return{async render(n){let{theme:u,uiVersion:d,language:f,context:p,functions:m,templates:g,i18n:v,url:b,app:y}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(l)throw new Error("The root is unmounted and cannot be rendered any more");const w=[].concat(n),E=i,S=(0,h.uniqueId)("render-id-");i=new Gn(r,{unknownBricks:o,renderId:S});const A={ctxStore:new Lr("CTX",void 0,i),pendingPermissionsPreCheck:[],tplStateStoreMap:new Map,formStateStoreMap:new Map};if(b){const e=new URL(b);A.query=e.searchParams,A.location={pathname:e.pathname,search:e.search,hash:e.hash,state:void 0}}const k={tag:xn.ROOT,container:e,createPortal:t};if("page"===r){var I;Q(u??"light"),ae("default"),ho(d),f&&await c.i18n.changeLanguage(f),y??(y={id:"demo",homepage:"/demo"}),A.app=y;const e={app:y,meta:{i18n:v,customTemplates:g}};null===(I=s)||void 0===I||I(),s=L(e),po(e),me(m,y)}A.ctxStore.define(p,A);let C,R=!1,O=[];try{C=await Zr(k,w,A,i,[],{}),O=to(A),await no(C,A,O)}catch(e){R=!0,C={node:await Xr(e,k,"page"===r),blockingList:[]}}if(k.child=C.node,null==E||E.dispatchOnUnmount(),null==E||E.dispose(),Mn(e),a&&Mn(a),"page"===r&&(R||i.dispatchBeforePageLoad(),te(),se()),Ln(k),"page"===r&&window.scrollTo(0,0),!R){for(const e of O)e.mountAsyncData();"page"===r&&i.dispatchPageLoad(),i.dispatchOnMount(),i.initializeScrollIntoView(),i.initializeMediaChange(),i.initializeMessageDispatcher()}},unmount(){l||(l=!0,Mn(e),a&&(Mn(a),n||a.remove()))}}}function ja(e){let{useRealTimeQuery:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n={...Ta()};t&&(n.query=new URLSearchParams(k().location.search));const r=t=>{if("string"==typeof t){if((0,O.isEvaluable)(t)){const e=ut(t,n);return Qe(e),e}return(0,_.inject)(t,n)}return!(0,u.isObject)(t)||Ze(e)?t:Array.isArray(t)?t.map((e=>r(e))):Object.fromEntries(Object.entries(t).map((e=>{let[t,n]=e;return[r(t),r(n)]})))};return r(e)}const Da=[];function Ka(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,t=-1;const n=()=>{if(t>-1){const e=Da.indexOf(t);e>-1&&Da.splice(e,1)}};return{push:()=>(n(),t=(Da[Da.length-1]??-1)+1,Da.push(t),t+e),pull:n}}}}]);
//# sourceMappingURL=4235.f5095d57.js.map