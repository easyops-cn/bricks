/*! For license information please see 2252.09da952a.js.LICENSE.txt */
"use strict";(globalThis.webpackChunk_next_bricks_nav=globalThis.webpackChunk_next_bricks_nav||[]).push([[2252],{2559:(e,t,n)=>{function r(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}n.d(t,{A:()=>r})},6330:(e,t,n)=>{function r(e,t,n,r,o,i,s){try{var a=e[i](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(o,i){var s=e.apply(t,n);function a(e){r(s,o,i,a,c,"next",e)}function c(e){r(s,o,i,a,c,"throw",e)}a(void 0)}))}}n.d(t,{A:()=>o})},2016:(e,t,n)=>{function r(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}n.d(t,{A:()=>r})},829:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(2559);function o(e,t){return e.get((0,r.A)(e,t))}},918:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(2016);function o(e,t,n){(0,r.A)(e,t),t.set(e,n)}},6121:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(2559);function o(e,t,n){return e.set((0,r.A)(e,t),n),n}},5536:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(2559);function o(e,t,n){return n((0,r.A)(e,t))}},4635:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(2016);function o(e,t){(0,r.A)(e,t),t.add(e)}},4586:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(1369);function o(e,t,n){return(t=(0,r.A)(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},9740:(e,t,n)=>{n.d(t,{A:()=>i});var r=n(4586);function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}},2252:(e,t,n)=>{n.r(t),n.d(t,{analytics:()=>u,auth:()=>mt,checkInstalledApps:()=>o,checkPermissions:()=>ft,flowApi:()=>i,menu:()=>s,messageDispatcher:()=>ht});var r={};n.r(r),n.d(r,{authenticate:()=>m,getAuth:()=>g,isLoggedIn:()=>A,logout:()=>v});var o={};n.r(o),n.d(o,{getCheckedApp:()=>oe,preCheckInstalledApps:()=>ne,waitForCheckingApps:()=>re});var i={};n.r(i),n.d(i,{FLOW_API_PROVIDER:()=>ae,clearCollectWidgetContract:()=>we,clearDebugContract:()=>be,collectContract:()=>ve,collectDebugContract:()=>ye,collectWidgetContract:()=>Ae,getArgsOfFlowApi:()=>Oe,isFlowApiProvider:()=>Ie,registerFlowApiProvider:()=>pe});var s={};n.r(s),n.d(s,{fetchMenuById:()=>Ve,getMenuById:()=>Je});var a={};n.r(a),n.d(a,{onRequest:()=>ct,onResponse:()=>ut,onResponseError:()=>pt});var c={};n.r(c),n.d(c,{create:()=>dt});var u={};n.r(u),n.d(u,{http:()=>a,initialize:()=>st,pageView:()=>c});var p=n(4958),l=n(6330),d=n(6730),f=function(){var e=(0,l.A)((function*(e,t){return(yield d.http.post("api/gateway/micro_app.permission.ValidatePermissions/api/micro_app/v1/permission/validate",e,t)).data}));return function(t,n){return e.apply(this,arguments)}}();const h={};function m(e){Object.assign(h,{org:e.org,username:e.username,userInstanceId:e.userInstanceId,loginFrom:e.loginFrom,accessRule:e.accessRule,isAdmin:e.isAdmin,csrfToken:e.csrfToken,license:e.license,accessToken:e.accessToken,userShowValue:e.userShowValue})}function g(){return{...h}}function v(){for(const e of Object.keys(h))h[e]=void 0;w.clear(),y.length=0,b.clear()}function A(){return void 0!==h.username}const w=new Map,y=[],b=new Map;function S(e){if(A()&&!g().isAdmin)return I((0,p.scanPermissionActionsInAny)(e))}async function I(e){const t=e.filter((e=>!y.includes(e)));if(0===t.length)return;const n=[],r=[];for(const e of t){const t=w.get(e);t?n.push(t):r.push(e)}if(r.length>0){const e=(async()=>{try{const e=await f({actions:r},{noAbortOnRouteChange:!0});for(const t of e.actions)b.set(t.action,t.authorizationStatus),"undefined"===t.authorizationStatus&&console.error(`Undefined permission action: "${t.action}"`)}catch(e){console.error("Pre-check permissions failed",e)}finally{y.push(...r)}})();for(const t of r)w.set(t,e);n.push(e)}await Promise.all(n)}var O=n(4635),P=n(918),E=n(5536),k=n(2559),M=n(6121),C=n(829),T=n(5223),_=n(1030);const j=1e3,N=5;var D=new WeakMap,$=new WeakMap,R=new WeakMap,W=new WeakMap,x=new WeakMap,L=new WeakMap,U=new WeakMap,B=new WeakSet;class F{constructor(e){(0,O.A)(this,B),(0,P.A)(this,D,void 0),(0,P.A)(this,$,void 0),(0,P.A)(this,R,[]),(0,P.A)(this,W,new Set),(0,P.A)(this,x,new Set),(0,P.A)(this,L,0),(0,P.A)(this,U,!1),(0,M.A)(D,this,e)}send(e){(0,C.A)($,this)||(0,M.A)($,this,(0,k.A)(B,this,q).call(this));const t=JSON.stringify(e);(0,C.A)($,this).readyState===WebSocket.OPEN?(0,C.A)($,this).send(t):(0,C.A)(R,this).push(t)}onMessage(e){(0,C.A)(W,this).add(e)}onClose(e){(0,C.A)(x,this).add(e)}reset(){(0,C.A)(R,this).length=0,(0,C.A)(W,this).clear(),(0,C.A)(x,this).clear()}close(){var e;(0,M.A)(U,this,!0),(null===(e=(0,C.A)($,this))||void 0===e?void 0:e.readyState)===WebSocket.OPEN&&(0,C.A)($,this).close()}}function q(){console.log("WebSocket connecting ...");const e=new WebSocket((0,C.A)(D,this));let t;return e.addEventListener("open",(n=>{console.log("WebSocket open:",n),t=setTimeout((()=>{t=void 0,(0,M.A)(L,this,0)}),1e3);for(const t of(0,C.A)(R,this))e.send(t);(0,C.A)(R,this).length=0})),e.addEventListener("close",(e=>{if(!(0,C.A)(U,this)){void 0!==t&&clearTimeout(t),console.log("WebSocket close:",e);for(const e of(0,C.A)(x,this))e();1e3!==e.code&&(0,k.A)(B,this,z).call(this)}})),e.addEventListener("error",(e=>{console.error("WebSocket error:",e)})),e.addEventListener("message",(e=>{const t=JSON.parse(e.data);for(const e of(0,C.A)(W,this))e(t)})),e}function z(){if((0,C.A)(L,this)>=N)return void console.error("WebSocket connect retry limit exceeded");const e=Math.pow(2,(0,C.A)(L,this))*j;console.log("WebSocket will reconnect after %d seconds",e/1e3),setTimeout((()=>{var e;(0,M.A)(L,this,(e=(0,C.A)(L,this),++e)),(0,M.A)($,this,(0,k.A)(B,this,q).call(this))}),e)}var H=new WeakMap,G=new WeakMap,J=new WeakMap,V=new WeakSet;function Y(e){if(!(0,C.A)(H,e)){const t=`${"https:"===location.protocol?"wss:":"ws:"}//${window.location.host}${(0,T.getBasePath)()}api/websocket_service/v1/ws`;(0,M.A)(H,e,new F(t))}return(0,C.A)(H,e)}function K(e,t,n,r){const o=(0,C.A)(G,this)[e].get(r);if(o)return o;const i={event:"sub"===e?"TOPIC.SUB":"TOPIC.UNSUB",payload:n},s=new Promise(((t,r)=>{const o=Q(n);(0,E.A)(V,this,Y).onMessage((n=>{const i=n.event===("sub"===e?"TOPIC.SUB_SUCCESS":"TOPIC.UNSUB_SUCCESS"),s=n.event===("sub"===e?"TOPIC.SUB_FAILED":"TOPIC.UNSUB_FAILED");(i||s)&&o===Q(n.payload)&&(i?t:r)(n)})),(0,E.A)(V,this,Y).send(i)}));return"sub"===e&&(0,C.A)(J,this).set(t,r),(0,C.A)(G,this)[e].set(r,s),s}function Q(e){const{system:t,topic:n}=e;return JSON.stringify({system:t,topic:n})}var X=n(3496),Z=function(){var e=(0,l.A)((function*(e,t){return(yield X.http.post("api/gateway/micro_app_standalone.runtime.SearchMicroAppStandalone/api/v1/micro_app_standalone/search",e,t)).data}));return function(t,n){return e.apply(this,arguments)}}();const ee=new Map,te=new Map;function ne(e,t){if(window.STANDALONE_MICRO_APPS&&!window.NO_AUTH_GUARD){const n=function(e){const t={usedArgs:new Set},{customTemplates:n,menus:r}=e.meta??{};return(0,p.traverseStoryboardExpressions)([e.routes,n,r],((e,n)=>{(0,p.collectInstalledAppsHasUsage)(t,e,n)}),"INSTALLED_APPS"),[...t.usedArgs]}(e),r=[];for(const e of n)ee.has(e)||t(e)||r.push(e);if(0===r.length)return;const o=Z({query:{appId:{$in:r}},fields:["appId","currentVersion","installStatus"]}).catch((e=>{console.error("Get off site standalone micro-apps failed",e)}));for(const e of r)ee.set(e,o.then((t=>{var n;const r=null==t||null===(n=t.list)||void 0===n?void 0:n.find((t=>t.appId===e)),o=r?{...r,id:e}:void 0;return te.set(e,o),o})))}}async function re(e){await Promise.all(e.map((e=>ee.get(e))))}function oe(e){if(window.STANDALONE_MICRO_APPS)return te.get(e)}var ie=n(3078),se=n(108);const ae="core.provider-flow-api";function ce(e,t){return e.some((e=>e.source===t))}async function ue(e){let{url:t,originalUri:n,method:r="GET",responseWrapper:o=!0,ext_fields:i=[],request:s,isFileType:a,stream:c}=e;const u=["get","delete","head"].includes(r.toLowerCase()),p=a?{responseType:"blob"}:{};let l;for(var d=arguments.length,f=new Array(d>1?d-1:0),h=1;h<d;h++)f[h-1]=arguments[h];if(u){var m,g;let e,o;var v;if(n&&"object"===(null==s?void 0:s.type)&&((null===(m=n.match(/:([^/]+)/g))||void 0===m?void 0:m.length)??0)===((null===(g=s.fields)||void 0===g?void 0:g.length)??0)?[o]=f:[e,o]=f,c)return await(0,ie.createSSEStream)(se.http.getUrlWithParams(t,e),{...p,...o,method:r,headers:Object.fromEntries([...new Headers((null===(v=o)||void 0===v?void 0:v.headers)??{}).entries()])});l=await se.http.simpleRequest(r,t,{params:e,...p,...o})}else{const e=function(e){if("object"!==(null==e?void 0:e.type))return!1;const t=e=>!(0,_.isEmpty)(e)&&e.some((e=>["file","file[]"].includes(e.type)||t(e.fields)));return t(e.fields)}(s),n=function(e){const t=ce(e,"query"),n=ce(e,"body");for(var r=arguments.length,o=new Array(r>1?r-1:0),i=1;i<r;i++)o[i-1]=arguments[i];if(t){if(n){const[e,t,n]=o;return{data:e,options:{params:t,...n}}}const[e,t]=o;return{data:{},options:{params:e,...t}}}const[s,a]=o;return{data:s,options:a}}(i,...f),o=e?function(e){if(e instanceof FormData)return e;const t=new FormData;for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.append(n,e)})):!(0,_.isObject)(r)||r instanceof Blob||r instanceof Date?t.append(n,r):Object.entries(r).forEach((e=>{let[r,o]=e;t.append(`${n}[${r}]`,o)}));return t}(n.data):n.data;if(c){var A;const{body:e,headers:i}=se.http.getBodyAndHeaders(o,null===(A=n.options)||void 0===A?void 0:A.headers);return await(0,ie.createSSEStream)(t,{...p,...n.options,method:r,headers:Object.fromEntries([...new Headers(i??{}).entries()]),body:e})}l=await se.http.requestWithBody(r,t,o,{...p,...n.options})}return!a&&o?l.data:l}function pe(){customElements.define(ae,(0,ie.createProviderClass)(ue))}var le=n(8679),de=function(){var e=(0,l.A)((function*(e,t){return(yield d.http.post("api/contract/single_search",e,t)).data}));return function(t,n){return e.apply(this,arguments)}}();const fe=new Map,he=new Map,me=new Map,ge=(e,t)=>{null==e||e.forEach((e=>{t.set(`${e.namespaceId}.${e.name}`,e)}))};function ve(e){ge(e,fe)}function Ae(e){ge(e,he)}function we(){he.clear()}function ye(e){ge(e,me)}function be(){me.clear()}const Se=new Map;function Ie(e){return e.includes("@")}async function Oe(e,t,n,r){if(!e.includes(":"))throw new Error(`You're using legacy Custom API "${e}" which is dropped in v3, please use Flow API instead`);const o=await async function(e){const[t,n]=e.split("@"),[r,o]=n.split(":"),i=function(e){return fe.get(e)||he.get(e)||me.get(e)}(`${t}.${r}`);if(i)return{name:i.name,namespace:i.namespaceId,serviceName:i.serviceName,version:i.version,contract:{endpoint:i.endpoint,response:i.response,request:i.request}};let s=Se.get(e);return s||(s=async function(e,t,n){var r;const{contractData:o}=await de({contractName:`${e}.${t}`,version:n});return o?{name:o.name,namespace:null===(r=o.namespace)||void 0===r||null===(r=r[0])||void 0===r?void 0:r.name,serviceName:o.serviceName,version:o.version,contract:{endpoint:o.endpoint,response:o.response,request:o.request}}:null}(t,r,o),Se.set(e,s)),s}(e);if(!o)throw new Pe(`Flow API not found: "${e}"`);const i=function(e,t){var n;const r="string"==typeof t.contract?le.safeLoad(t.contract,{schema:le.JSON_SCHEMA,json:!0}):t.contract,{uri:o,method:i="GET",ext_fields:s}=(null==r?void 0:r.endpoint)??{},a=!(null==r||!r.response)&&!1!==r.response.wrapper;if(!o)throw new Error(`Missing endpoint.uri in contract of provider "${e}"`);return{uri:o,method:"list"===i.toLowerCase()?"get":i,ext_fields:s,name:t.name,namespace:t.namespace,serviceName:t.serviceName,version:t.version,isFileType:"file"===(null==r||null===(n=r.response)||void 0===n?void 0:n.type),responseWrapper:a,request:null==r?void 0:r.request}}(e,o);return function(e,t,n,r){let{uri:o,method:i,ext_fields:s,name:a,namespace:c,serviceName:u,responseWrapper:p,version:l,isFileType:d,request:f}=e;const h="saveAs"===n;let m;h&&(m=t.shift());const{url:g,args:v}=function(e,t,n,r,o,i){const s=i?"logic.api.gateway"===o||null!=o&&o.startsWith("logic.api.gateway.")?"":o?`api/gateway/${o}`:`api/gateway/${r}.${n}@${i}`:`api/gateway/api_service.${r}.${n}`,a=t.slice(),c=e.replace(/:([^/]+)/g,(()=>a.shift()));return{url:s?s+c:c.replace(/^\//,""),args:a}}(o,t,a,c,u,l);return[...h?[m]:[],{url:g,originalUri:o,method:i,ext_fields:s,responseWrapper:p,request:f,isFileType:d,stream:r},...v]}(i,t,n,r)}class Pe extends Error{constructor(e){super(e),this.name="FlowApiNotFoundError",Error.captureStackTrace&&Error.captureStackTrace(this,Pe)}}var Ee=function(){var e=(0,l.A)((function*(e,t,n){return(yield X.http.post("api/gateway/cmdb.instance.PostSearch/object/".concat(e,"/instance/_search"),t,n)).data}));return function(t,n,r){return e.apply(this,arguments)}}(),ke=n(9740),Me=function(){var e=(0,l.A)((function*(e,t,n){return(yield d.http.get("api/gateway/micro_app.installed_micro_app.GetMenusInfo/api/v1/micro-app/menus/".concat(e),(0,ke.A)((0,ke.A)({},n),{},{params:t}))).data}));return function(t,n,r){return e.apply(this,arguments)}}(),Ce=n(6181);const Te=Symbol("appId"),_e=Symbol("menuI18nNamespace"),je=Symbol("overrideApp");async function Ne(e,t,n){const r=e.find((e=>"inject"!==e.type));if(!r)return;const o=[],i=new Map,s=new WeakMap;for(const t of e)if(t.i18n){const e=`menu/${t.menuId}~${t.app[0].appId}+${t.instanceId}`;Object.entries(t.i18n).forEach((t=>{let[n,r]=t;Ce.i18n.addResourceBundle(n,e,r)})),s.set(t,e)}await Promise.all(e.map((e=>async function(e,t,n,r){if(e.dynamicItems&&e.itemsResolve){const i=e.app[0].appId,s={...t,pendingPermissionsPreCheck:[...t.pendingPermissionsPreCheck,S(e.itemsResolve)]};var o;i!==t.app.id&&(s.overrideApp=window.STANDALONE_MICRO_APPS?e.overrideApp:null===(o=r.getStoryboardByAppId(i))||void 0===o?void 0:o.app,s.appendI18nNamespace=n.get(e));const a=await r.resolveData({transform:"items",...e.itemsResolve},s);e.items=a.items}}(e,t,s,n))));for(const t of e){var a;if(null!==(a=t.items)&&void 0!==a&&a.length)if("inject"===t.type&&t.injectMenuGroupId){let e=i.get(t.injectMenuGroupId);e||(e=[],i.set(t.injectMenuGroupId,e)),e.push(t)}else o.push(t)}return{...r,items:o.flatMap((e=>De(e.items,e,i,s))),[_e]:s.get(r),[je]:r.overrideApp}}function De(e,t,n,r){return null==e?void 0:e.map((e=>{const o=e.groupId&&n.get(e.groupId);return o&&n.delete(e.groupId),{...e,children:(De(e.children,t,n,r)??[]).concat(o?o.flatMap((e=>De(e.items,e,n,r))):[]),[Te]:t.app[0].appId,[_e]:r.get(t),[je]:t.overrideApp}}))}function $e(e){e.items=Re(e.items)}function Re(e){return function(e){return(0,_.sortBy)(e,(e=>e.sort??-1/0))}(e).map((e=>({...e,children:Re(e.children)})))}var We=n(1744),xe=n(522);function Le(e,t,n,r){if("titleDataSource"in e&&(0,ie.isObject)(e.titleDataSource)&&Object.entries(e.titleDataSource).every((e=>{let[,t]=e;return null===t||""===t}))&&delete e.titleDataSource,"if"in e&&null===e.if&&delete e.if,"to"in e&&e.to&&!(0,xe.isEvaluable)(e.to)){const t=We.pipes.yaml(e.to);(0,ie.isObject)(t)&&["pathname","search","hash"].some((e=>(0,ie.hasOwnProperty)(t,e)))&&(e.to=t)}let o=n;if(t!==n.app.id){var i;const s=window.STANDALONE_MICRO_APPS?e[je]:null===(i=r.getStoryboardByAppId(t))||void 0===i?void 0:i.app;o={...n,overrideApp:s,appendI18nNamespace:e[_e]}}return r.asyncComputeRealValue(e,o,{ignoreSymbols:!0})}function Ue(e,t,n){return Promise.all(e.map((async e=>{let{children:r,...o}=e;const[i,s]=await Promise.all([Le(o,o[Te],t,n),r&&await Ue(r,t,n)]);return{...i,children:s}})))}var Be=function(){var e=(0,l.A)((function*(e,t,n,r){return(yield X.http.get("api/gateway/cmdb.instance.GetDetail/object/".concat(e,"/instance/").concat(t),(0,ke.A)((0,ke.A)({},r),{},{params:n}))).data}));return function(t,n,r,o){return e.apply(this,arguments)}}();const Fe=new Map;async function qe(e){if(e.title||(0,_.isEmpty)(e.titleDataSource))return e.title;const t=JSON.stringify(e.titleDataSource),n=Fe.get(t);if(void 0!==n)return n;const{objectId:r,instanceId:o,attributeId:i}=e.titleDataSource,s=i??"name",a=await Be(r,o,{fields:s});let c;if("#showKey"===i&&Array.isArray(a[s])){const[e,...t]=a[s];c=t.length>0?`${e}(${t.join(",")})`:String(e)}else c=String(a[s]);return Fe.set(t,c),c}const ze=new Map,He=new Map;function Ge(e){return null==e?void 0:e.filter(T.checkIfOfComputed).map((e=>{const t=Ge(e.children);return"group"===e.type?{type:"group",title:e.text,childLayout:e.childLayout,items:t,groupId:e.groupId,groupFrom:e.groupFrom}:null!=t&&t.length?{type:"subMenu",childLayout:e.childLayout,title:e.text,icon:e.icon,items:t,defaultExpanded:e.defaultExpanded}:(0,_.omit)(e,["type","items","children"])}))}function Je(e){return He.get(e)}function Ve(e,t,n){let r=ze.get(e);return r||(r=async function(e,t,n){const r=window.STANDALONE_MICRO_APPS?function(e,t,n){var r,o;const i=n.getStoryboardByAppId(t);return((null===(r=i.meta)||void 0===r?void 0:r.injectMenus)??(null===(o=i.meta)||void 0===o?void 0:o.menus)??[]).filter((t=>t.menuId===e)).map((e=>{var n;return{...e,...null!==(n=e.app)&&void 0!==n&&null!==(n=n[0])&&void 0!==n&&n.appId?{}:{app:[{appId:t}]}}}))}(e,t.app.id,n):t.flags["three-level-menu-layout"]?(await Me(e,{menuObjectId:"EASYOPS_STORYBOARD_MENU"})).menus:(await Ee("EASYOPS_STORYBOARD_MENU",{page:1,page_size:200,fields:{menuId:!0,title:!0,icon:!0,link:!0,titleDataSource:!0,defaultCollapsed:!0,defaultCollapsedBreakpoint:!0,type:!0,injectMenuGroupId:!0,dynamicItems:!0,itemsResolve:!0,items:!0,i18n:!0,"items.children":!0,"app.appId":!0},query:{menuId:{$eq:e},app:{$size:{$gt:0}}}})).list,o=await Ne(r,t,n);if(!o)throw new Error(`Menu not found: ${e}`);$e(o);const{items:i,app:s,...a}=o,c={...t,pendingPermissionsPreCheck:[...t.pendingPermissionsPreCheck,S([i,a])]};delete c.tplStateStoreId,delete c.forEachItem,delete c.forEachIndex,delete c.forEachSize;const u=s[0].appId,[p,l]=await Promise.all([Le(a,u,c,n),Ue(i,c,n)]),d={title:await qe(p),...(0,_.pick)(p,["icon","link","defaultCollapsed","defaultCollapsedBreakpoint"]),menuItems:Ge(l)};He.set(e,d)}(e,t,n)),r}const Ye=[];let Ke=null;const Qe={maxWaitingTime:5e3,maxLoggedEvents:10};function Xe(){clearTimeout(Ke),Ye.length>Qe.maxLoggedEvents?Ze():Ke=setTimeout(Ze,Qe.maxWaitingTime)}function Ze(){if(0===Ye.length)return;const e={model:"easyops.FRONTEND_STAT",columns:["_ver","st","et","lt","size","time","traceId","code","duration","page","uid","username","api","type","msg","status","pageId","route","apiCount","maxApiTimeCost","apiSizeCost","pageTitle"],data:Ye.splice(0,Qe.maxLoggedEvents)};var t;!function(e,t){const n=new Blob([JSON.stringify(t)],{type:"application/json"});window.navigator.sendBeacon(e,n)}(Qe.api,e),Ye.length&&(t=Ze,(window.requestIdleCallback||window.requestAnimationFrame||(e=>setTimeout(e,17)))(t))}function et(){window.addEventListener("beforeunload",Ze,!1)}let tt,nt=!1,rt=null,ot=!0;const it=[];function st(e){nt||(nt=!0,tt||(tt=function(e,t){return Object.assign(Qe,{...t,api:e}),{sendOnExit:et,emit:Xe}}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),tt.sendOnExit()))}const at=Symbol("HttpAnalytics");function ct(e){const t=Math.round(performance.now()),n=Date.now();return e[at]={st:n,time:Math.round(n/1e3),perfStartTime:t},e}function ut(e,t){return lt(!1,e,t)}function pt(e,t){return lt(!0,e,t)}function lt(e,t,n){const r=Math.round(performance.now()),o=Date.now(),{[at]:i,url:s}=n;if(i&&!(e&&t instanceof se.HttpAbortError)){delete n[at];const{st:c,time:u,perfStartTime:p}=i,{userInstanceId:l,username:d}=g();let f,h,m,v,A,w,y;if(e){const e=t instanceof se.HttpResponseError;(e||t instanceof se.HttpParseError)&&(({status:A,headers:w}=t.response),e&&(y=t.responseJson))}else({status:A,data:y,headers:w}=t);(0,ie.isObject)(y)&&({code:f,message:h}=y),w instanceof Headers&&(m=w.get("x-b3-traceid"),v=w.get("content-length")),a={st:c,_ver:c,uid:l,username:d,time:u,et:o,page:location.href,duration:r-p,api:s,type:"api",code:f??-1,msg:h??"",status:A,traceId:m??"",size:v?Number(v):-1},rt?Ye.push({...a,type:"apiRequest",...rt}):it.push(a)}var a;return e?Promise.reject(t):t}function dt(){const e=Math.round(performance.now()),t=Date.now();return it.length=0,rt=null,function(n){let{status:r,path:o,pageTitle:i}=n;if("ok"!==r)return Ye.push(...it),void(it.length=0);const s=Math.round(performance.now())-e,a=Date.now(),{username:c}=g();(function(e){const t=function(){const e=URL.createObjectURL(new Blob([]));let t=e.substring(e.lastIndexOf("/")+1);return URL.revokeObjectURL(e),ot&&(t="88-"+t,ot=!1),t}(),{lt:n,route:r}=e;rt={lt:n,route:r,pageId:t},Ye.push({...e,pageId:t,apiCount:it.length,maxApiTimeCost:Math.max(0,...it.map((e=>e.duration))),size:it.map((e=>e.size)).filter((e=>e>0)).reduce(((e,t)=>e+t),0)});for(const e of it)Ye.push({...e,...rt});it.length=0,tt.emit()})({type:"page",page:location.href,_ver:t,time:Math.round(t/1e3),st:t,et:a,lt:s,pageTitle:i,username:c,route:o}),window.dispatchEvent(new CustomEvent("route.render",{detail:{renderTime:s}}))}}const ft=Object.freeze({checkPermissions:function(){if(!A())return!1;if(g().isAdmin)return!0;for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const e of t)switch(b.get(e)){case"unauthorized":case"undefined":return!1;case void 0:return console.error(`Un-checked permission action: "${e}", please make sure the permission to check is defined in permissionsPreCheck.`),!1}return!0},preCheckPermissions:function(e){if(A()&&!g().isAdmin)return I((0,p.scanPermissionActionsInStoryboard)(e))},preCheckPermissionsForBrickOrRoute:async function(e,t){if(A()&&!g().isAdmin&&Array.isArray(e.permissionsPreCheck))return I(await t(e.permissionsPreCheck))}}),ht=new class{constructor(){(0,O.A)(this,V),(0,P.A)(this,H,void 0),(0,P.A)(this,G,{sub:new Map,unsub:new Map}),(0,P.A)(this,J,new Map)}subscribe(e,t){const n=JSON.stringify(t);return(0,k.A)(V,this,K).call(this,"sub",e,t,n)}unsubscribe(e){const t=(0,C.A)(J,this).get(e);if(!t){const t=`The message channel to unsubscribe "${e}" is not found`;return console.error(t),Promise.reject(new Error(t))}const n=JSON.parse(t),r=(0,k.A)(V,this,K).call(this,"unsub",e,n,t);return(0,C.A)(G,this).sub.delete(t),r.then((()=>{(0,C.A)(J,this).delete(e)})),r}onMessage(e,t){let n=(0,C.A)(J,this).get(e),r=!1;(0,E.A)(V,this,Y).onMessage((o=>{n||(n=(0,C.A)(J,this).get(e)),n?"MESSAGE.PUSH"===o.event&&function(e,t){const n=JSON.parse(e);return n.system===t.system&&(n.topic===t.topic||"string"==typeof n.topic&&n.topic.includes("*")&&new RegExp(`^${n.topic.replace(/([^*]*)\*([^*]*)/g,((e,t,n)=>`${(0,_.escapeRegExp)(t)}[^/]*${(0,_.escapeRegExp)(n)}`))}$`).test(t.topic))}(n,o.payload)&&t(o.payload.message):r||(console.error(`Message channel: "${e}" not found`),r=!0)}))}onClose(e){(0,E.A)(V,this,Y).onClose(e)}reset(){var e;(0,C.A)(G,this).sub.clear(),(0,C.A)(G,this).unsub.clear(),(0,C.A)(J,this).clear(),null===(e=(0,C.A)(H,this))||void 0===e||e.reset()}},mt=function(){const e=(0,T.getV2RuntimeFromDll)();if(e)return Object.freeze((0,_.pick)(e,["authenticate","getAuth","isLoggedIn","logout"]))}()||r}}]);
//# sourceMappingURL=2252.09da952a.js.map