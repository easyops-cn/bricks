{"version":3,"file":"chunks/2252.09da952a.js","mappings":"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","sources":["webpack:///../../node_modules/@babel/runtime/helpers/esm/assertClassBrand.js","webpack:///../../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js","webpack:///../../node_modules/@babel/runtime/helpers/esm/checkPrivateRedeclaration.js","webpack:///../../node_modules/@babel/runtime/helpers/esm/classPrivateFieldGet2.js","webpack:///../../node_modules/@babel/runtime/helpers/esm/classPrivateFieldInitSpec.js","webpack:///../../node_modules/@babel/runtime/helpers/esm/classPrivateFieldSet2.js","webpack:///../../node_modules/@babel/runtime/helpers/esm/classPrivateGetter.js","webpack:///../../node_modules/@babel/runtime/helpers/esm/classPrivateMethodInitSpec.js","webpack:///../../node_modules/@babel/runtime/helpers/esm/defineProperty.js","webpack:///../../node_modules/@babel/runtime/helpers/esm/objectSpread2.js","webpack:///../../node_modules/@next-api-sdk/micro-app-sdk/dist/esm/api/micro_app/permission/validatePermissions.js","webpack:///../../node_modules/@next-core/easyops-runtime/dist/esm/auth.js","webpack:///../../node_modules/@next-core/easyops-runtime/dist/esm/checkPermissions.js","webpack:///../../node_modules/@next-core/easyops-runtime/dist/esm/websocket/MessageService.js","webpack:///../../node_modules/@next-core/easyops-runtime/dist/esm/websocket/MessageDispatcher.js","webpack:///../../node_modules/@next-api-sdk/micro-app-standalone-sdk/dist/esm/api/micro_app_standalone/runtime/searchMicroAppStandalone.js","webpack:///../../node_modules/@next-core/easyops-runtime/dist/esm/checkInstalledApps.js","webpack:///../../node_modules/@next-core/easyops-runtime/dist/esm/flowApi/FlowApiProvider.js","webpack:///../../node_modules/@next-api-sdk/api-gateway-sdk/dist/esm/api/api_gateway/contract/searchSingleContract.js","webpack:///../../node_modules/@next-core/easyops-runtime/dist/esm/flowApi/CollectContracts.js","webpack:///../../node_modules/@next-core/easyops-runtime/dist/esm/flowApi/FlowApi.js","webpack:///../../node_modules/@next-api-sdk/cmdb-sdk/dist/esm/api/cmdb/instance/postSearch.js","webpack:///../../node_modules/@next-api-sdk/micro-app-sdk/dist/esm/api/micro_app/installed_micro_app/getMenusInfo.js","webpack:///../../node_modules/@next-core/easyops-runtime/dist/esm/menu/constants.js","webpack:///../../node_modules/@next-core/easyops-runtime/dist/esm/menu/mergeMenu.js","webpack:///../../node_modules/@next-core/easyops-runtime/dist/esm/menu/loadDynamicMenuItems.js","webpack:///../../node_modules/@next-core/easyops-runtime/dist/esm/menu/reorderMenuItems.js","webpack:///../../node_modules/@next-core/easyops-runtime/dist/esm/menu/computeMenuData.js","webpack:///../../node_modules/@next-api-sdk/cmdb-sdk/dist/esm/api/cmdb/instance/getDetail.js","webpack:///../../node_modules/@next-core/easyops-runtime/dist/esm/menu/fetchMenuTitle.js","webpack:///../../node_modules/@next-core/easyops-runtime/dist/esm/menu/fetchMenuById.js","webpack:///../../node_modules/@next-core/easyops-runtime/dist/esm/menu/getMenusOfStandaloneApp.js","webpack:///../../node_modules/@next-core/easyops-runtime/dist/esm/analytics/transport.js","webpack:///../../node_modules/@next-core/easyops-runtime/dist/esm/analytics/analytics.js","webpack:///../../node_modules/@next-core/easyops-runtime/dist/esm/analytics/http.js","webpack:///../../node_modules/@next-core/easyops-runtime/dist/esm/analytics/pageView.js","webpack:///../../node_modules/@next-core/easyops-runtime/dist/esm/index.js","webpack:///../../node_modules/@next-core/easyops-runtime/dist/esm/auth-v2.js"],"sourcesContent":["export default function _assertClassBrand(e, t, n) {\n  if (\"function\" == typeof e ? e === t : e.has(t)) return arguments.length < 3 ? t : n;\n  throw new TypeError(\"Private element is not present on this object\");\n}","function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\nexport default function _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n      args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n      _next(undefined);\n    });\n  };\n}","export default function _checkPrivateRedeclaration(obj, privateCollection) {\n  if (privateCollection.has(obj)) {\n    throw new TypeError(\"Cannot initialize the same private elements twice on an object\");\n  }\n}","import assertClassBrand from \"./assertClassBrand.js\";\nexport default function _classPrivateFieldGet2(s, a) {\n  return s.get(assertClassBrand(s, a));\n}","import checkPrivateRedeclaration from \"./checkPrivateRedeclaration.js\";\nexport default function _classPrivateFieldInitSpec(obj, privateMap, value) {\n  checkPrivateRedeclaration(obj, privateMap);\n  privateMap.set(obj, value);\n}","import assertClassBrand from \"./assertClassBrand.js\";\nexport default function _classPrivateFieldSet2(s, a, r) {\n  return s.set(assertClassBrand(s, a), r), r;\n}","import assertClassBrand from \"./assertClassBrand.js\";\nexport default function _classPrivateGetter(s, r, a) {\n  return a(assertClassBrand(s, r));\n}","import checkPrivateRedeclaration from \"./checkPrivateRedeclaration.js\";\nexport default function _classPrivateMethodInitSpec(obj, privateSet) {\n  checkPrivateRedeclaration(obj, privateSet);\n  privateSet.add(obj);\n}","import toPropertyKey from \"./toPropertyKey.js\";\nexport default function _defineProperty(obj, key, value) {\n  key = toPropertyKey(key);\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n  return obj;\n}","import defineProperty from \"./defineProperty.js\";\nfunction ownKeys(e, r) {\n  var t = Object.keys(e);\n  if (Object.getOwnPropertySymbols) {\n    var o = Object.getOwnPropertySymbols(e);\n    r && (o = o.filter(function (r) {\n      return Object.getOwnPropertyDescriptor(e, r).enumerable;\n    })), t.push.apply(t, o);\n  }\n  return t;\n}\nexport default function _objectSpread2(e) {\n  for (var r = 1; r < arguments.length; r++) {\n    var t = null != arguments[r] ? arguments[r] : {};\n    r % 2 ? ownKeys(Object(t), !0).forEach(function (r) {\n      defineProperty(e, r, t[r]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) {\n      Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r));\n    });\n  }\n  return e;\n}","import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport { http } from \"@next-core/http\";\n/**\n * @description 校验系统权限\n * @endpoint POST /api/micro_app/v1/permission/validate\n */\nexport var PermissionApi_validatePermissions = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator(function* (data, options) {\n    return (/**! @contract easyops.api.micro_app.permission.ValidatePermissions@1.0.0 */(yield http.post(\"api/gateway/micro_app.permission.ValidatePermissions/api/micro_app/v1/permission/validate\", data, options)).data\n    );\n  });\n  return function PermissionApi_validatePermissions(_x, _x2) {\n    return _ref.apply(this, arguments);\n  };\n}();\n//# sourceMappingURL=validatePermissions.js.map","import { resetPermissionPreChecks } from \"./checkPermissions.js\";\nconst auth = {};\n\n/** @internal */\n\n/** @internal */\nexport function authenticate(newAuth) {\n  Object.assign(auth, {\n    org: newAuth.org,\n    username: newAuth.username,\n    userInstanceId: newAuth.userInstanceId,\n    loginFrom: newAuth.loginFrom,\n    accessRule: newAuth.accessRule,\n    isAdmin: newAuth.isAdmin,\n    csrfToken: newAuth.csrfToken,\n    license: newAuth.license,\n    accessToken: newAuth.accessToken,\n    userShowValue: newAuth.userShowValue\n  });\n}\n\n/**\n * 获取当前登录认证信息。\n *\n * @returns 当前登录认证信息。\n */\nexport function getAuth() {\n  return {\n    ...auth\n  };\n}\n\n/** @internal */\nexport function logout() {\n  for (const key of Object.keys(auth)) {\n    auth[key] = undefined;\n  }\n  resetPermissionPreChecks();\n}\n\n/**\n * 查看当前是否已登录。\n *\n * @returns 当前是否已登录。\n */\nexport function isLoggedIn() {\n  return auth.username !== undefined;\n}\n//# sourceMappingURL=auth.js.map","import { scanPermissionActionsInAny, scanPermissionActionsInStoryboard } from \"@next-core/utils/storyboard\";\nimport { PermissionApi_validatePermissions } from \"@next-api-sdk/micro-app-sdk\";\nimport { getAuth, isLoggedIn } from \"./auth.js\";\nconst checkingPermissions = new Map();\nconst checkedPermissions = [];\nconst permissionMap = new Map();\nexport function preCheckPermissions(storyboard) {\n  if (isLoggedIn() && !getAuth().isAdmin) {\n    const usedActions = scanPermissionActionsInStoryboard(storyboard);\n    return validatePermissions(usedActions);\n  }\n}\nexport async function preCheckPermissionsForBrickOrRoute(container, asyncComputeRealValue) {\n  if (isLoggedIn() && !getAuth().isAdmin && Array.isArray(container.permissionsPreCheck)) {\n    const actions = await asyncComputeRealValue(container.permissionsPreCheck);\n    return validatePermissions(actions);\n  }\n}\nexport function preCheckPermissionsForAny(data) {\n  if (isLoggedIn() && !getAuth().isAdmin) {\n    const usedActions = scanPermissionActionsInAny(data);\n    return validatePermissions(usedActions);\n  }\n}\nexport async function validatePermissions(usedActions) {\n  // Do not request known actions.\n  const uncheckedActions = usedActions.filter(action => !checkedPermissions.includes(action));\n  if (uncheckedActions.length === 0) {\n    return;\n  }\n  const checkingTasks = [];\n  const restActions = [];\n  for (const action of uncheckedActions) {\n    const promise = checkingPermissions.get(action);\n    if (promise) {\n      checkingTasks.push(promise);\n    } else {\n      restActions.push(action);\n    }\n  }\n  if (restActions.length > 0) {\n    const task = (async () => {\n      try {\n        const result = await PermissionApi_validatePermissions({\n          actions: restActions\n        }, {\n          noAbortOnRouteChange: true\n        });\n        for (const item of result.actions) {\n          permissionMap.set(item.action, item.authorizationStatus);\n          if (item.authorizationStatus === \"undefined\") {\n            // eslint-disable-next-line no-console\n            console.error(`Undefined permission action: \"${item.action}\"`);\n          }\n        }\n      } catch (error) {\n        // Allow pre-check to fail, and\n        // make it not crash when the backend service is not updated.\n        // eslint-disable-next-line no-console\n        console.error(\"Pre-check permissions failed\", error);\n      } finally {\n        checkedPermissions.push(...restActions);\n      }\n    })();\n    for (const action of restActions) {\n      checkingPermissions.set(action, task);\n    }\n    checkingTasks.push(task);\n  }\n  await Promise.all(checkingTasks);\n}\n\n/**\n * Check the current logged-in user whether to have all\n * permissions of actions passed to it.\n *\n * @param actions - Required permission actions.\n */\nexport function checkPermissions() {\n  if (!isLoggedIn()) {\n    return false;\n  }\n  if (getAuth().isAdmin) {\n    return true;\n  }\n  for (var _len = arguments.length, actions = new Array(_len), _key = 0; _key < _len; _key++) {\n    actions[_key] = arguments[_key];\n  }\n  for (const action of actions) {\n    // Only **exclusively authorized** permissions are ok.\n    // Those scenarios below will fail:\n    // - unauthorized actions (pre-check results)\n    // - undefined actions (pre-check results)\n    // - Un-pre-checked or pre-check failed\n    switch (permissionMap.get(action)) {\n      case \"unauthorized\":\n      case \"undefined\":\n        return false;\n      case undefined:\n        // eslint-disable-next-line no-console\n        console.error(`Un-checked permission action: \"${action}\", please make sure the permission to check is defined in permissionsPreCheck.`);\n        return false;\n    }\n  }\n  return true;\n}\n\n/**\n * Reset permission pre-checks after logged-out.\n */\nexport function resetPermissionPreChecks() {\n  checkingPermissions.clear();\n  checkedPermissions.length = 0;\n  permissionMap.clear();\n}\n//# sourceMappingURL=checkPermissions.js.map","import _classPrivateMethodInitSpec from \"@babel/runtime/helpers/classPrivateMethodInitSpec\";\nimport _classPrivateFieldInitSpec from \"@babel/runtime/helpers/classPrivateFieldInitSpec\";\nimport _assertClassBrand from \"@babel/runtime/helpers/assertClassBrand\";\nimport _classPrivateFieldGet from \"@babel/runtime/helpers/classPrivateFieldGet2\";\nimport _classPrivateFieldSet from \"@babel/runtime/helpers/classPrivateFieldSet2\";\nconst RETRY_TIMEOUT_UNIT = 1000;\nconst RETRY_LIMIT = 5;\nvar _url = /*#__PURE__*/new WeakMap();\nvar _ws = /*#__PURE__*/new WeakMap();\nvar _queuedMessages = /*#__PURE__*/new WeakMap();\nvar _messageListeners = /*#__PURE__*/new WeakMap();\nvar _closeListeners = /*#__PURE__*/new WeakMap();\nvar _retryCount = /*#__PURE__*/new WeakMap();\nvar _closed = /*#__PURE__*/new WeakMap();\nvar _MessageService_brand = /*#__PURE__*/new WeakSet();\nexport class MessageService {\n  constructor(url) {\n    _classPrivateMethodInitSpec(this, _MessageService_brand);\n    _classPrivateFieldInitSpec(this, _url, void 0);\n    _classPrivateFieldInitSpec(this, _ws, void 0);\n    _classPrivateFieldInitSpec(this, _queuedMessages, []);\n    _classPrivateFieldInitSpec(this, _messageListeners, new Set());\n    _classPrivateFieldInitSpec(this, _closeListeners, new Set());\n    _classPrivateFieldInitSpec(this, _retryCount, 0);\n    _classPrivateFieldInitSpec(this, _closed, false);\n    _classPrivateFieldSet(_url, this, url);\n  }\n  send(data) {\n    // Connect when data is sent for the first time\n    if (!_classPrivateFieldGet(_ws, this)) {\n      _classPrivateFieldSet(_ws, this, _assertClassBrand(_MessageService_brand, this, _connect).call(this));\n    }\n    const stringifiedData = JSON.stringify(data);\n    if (_classPrivateFieldGet(_ws, this).readyState === WebSocket.OPEN) {\n      _classPrivateFieldGet(_ws, this).send(stringifiedData);\n    } else {\n      _classPrivateFieldGet(_queuedMessages, this).push(stringifiedData);\n    }\n  }\n  onMessage(listener) {\n    _classPrivateFieldGet(_messageListeners, this).add(listener);\n  }\n  onClose(listener) {\n    _classPrivateFieldGet(_closeListeners, this).add(listener);\n  }\n  reset() {\n    _classPrivateFieldGet(_queuedMessages, this).length = 0;\n    _classPrivateFieldGet(_messageListeners, this).clear();\n    _classPrivateFieldGet(_closeListeners, this).clear();\n  }\n  close() {\n    var _classPrivateFieldGet2;\n    _classPrivateFieldSet(_closed, this, true);\n    if (((_classPrivateFieldGet2 = _classPrivateFieldGet(_ws, this)) === null || _classPrivateFieldGet2 === void 0 ? void 0 : _classPrivateFieldGet2.readyState) === WebSocket.OPEN) {\n      _classPrivateFieldGet(_ws, this).close();\n    }\n  }\n}\nfunction _connect() {\n  // eslint-disable-next-line no-console\n  console.log(\"WebSocket connecting ...\");\n  const ws = new WebSocket(_classPrivateFieldGet(_url, this));\n  let resetRetryCountTimeout;\n  ws.addEventListener(\"open\", e => {\n    // eslint-disable-next-line no-console\n    console.log(\"WebSocket open:\", e);\n\n    // If server closes the socket not more than 1 second after it's opened,\n    // we should not reset the retry count.\n    resetRetryCountTimeout = setTimeout(() => {\n      resetRetryCountTimeout = undefined;\n      _classPrivateFieldSet(_retryCount, this, 0);\n    }, 1e3);\n    for (const msg of _classPrivateFieldGet(_queuedMessages, this)) {\n      ws.send(msg);\n    }\n    _classPrivateFieldGet(_queuedMessages, this).length = 0;\n  });\n  ws.addEventListener(\"close\", e => {\n    if (_classPrivateFieldGet(_closed, this)) {\n      return;\n    }\n    if (resetRetryCountTimeout !== undefined) {\n      clearTimeout(resetRetryCountTimeout);\n    }\n    // eslint-disable-next-line no-console\n    console.log(\"WebSocket close:\", e);\n    for (const listener of _classPrivateFieldGet(_closeListeners, this)) {\n      listener();\n    }\n    // Error code 1000 means that the connection was closed normally.\n    if (e.code !== 1000) {\n      _assertClassBrand(_MessageService_brand, this, _reconnect).call(this);\n    }\n  });\n  ws.addEventListener(\"error\", e => {\n    // No need to reconnect in error event listener,\n    // there will always be a close event along with the error event.\n    // eslint-disable-next-line no-console\n    console.error(\"WebSocket error:\", e);\n  });\n  ws.addEventListener(\"message\", e => {\n    const response = JSON.parse(e.data);\n    for (const listener of _classPrivateFieldGet(_messageListeners, this)) {\n      listener(response);\n    }\n  });\n  return ws;\n}\nfunction _reconnect() {\n  // istanbul ignore next: currently can't mock this\n  if (_classPrivateFieldGet(_retryCount, this) >= RETRY_LIMIT) {\n    // eslint-disable-next-line no-console\n    console.error(\"WebSocket connect retry limit exceeded\");\n    return;\n  }\n  // Double the timeout for each retry\n  const delay = Math.pow(2, _classPrivateFieldGet(_retryCount, this)) * RETRY_TIMEOUT_UNIT;\n  // eslint-disable-next-line no-console\n  console.log(\"WebSocket will reconnect after %d seconds\", delay / 1000);\n  setTimeout(() => {\n    var _this$retryCount, _this$retryCount2;\n    _classPrivateFieldSet(_retryCount, this, (_this$retryCount = _classPrivateFieldGet(_retryCount, this), _this$retryCount2 = _this$retryCount++, _this$retryCount)), _this$retryCount2;\n    _classPrivateFieldSet(_ws, this, _assertClassBrand(_MessageService_brand, this, _connect).call(this));\n  }, delay);\n}\n//# sourceMappingURL=MessageService.js.map","import _classPrivateMethodInitSpec from \"@babel/runtime/helpers/classPrivateMethodInitSpec\";\nimport _classPrivateFieldInitSpec from \"@babel/runtime/helpers/classPrivateFieldInitSpec\";\nimport _classPrivateGetter from \"@babel/runtime/helpers/classPrivateGetter\";\nimport _assertClassBrand from \"@babel/runtime/helpers/assertClassBrand\";\nimport _classPrivateFieldSet from \"@babel/runtime/helpers/classPrivateFieldSet2\";\nimport _classPrivateFieldGet from \"@babel/runtime/helpers/classPrivateFieldGet2\";\nimport { getBasePath } from \"@next-core/runtime\";\nimport { escapeRegExp } from \"lodash\";\nimport { MessageService } from \"./MessageService.js\";\nvar _ms = /*#__PURE__*/new WeakMap();\nvar _memoizedChannels = /*#__PURE__*/new WeakMap();\nvar _channelPayloads = /*#__PURE__*/new WeakMap();\nvar _MessageDispatcher_brand = /*#__PURE__*/new WeakSet();\nexport class MessageDispatcher {\n  constructor() {\n    _classPrivateMethodInitSpec(this, _MessageDispatcher_brand);\n    _classPrivateFieldInitSpec(this, _ms, void 0);\n    _classPrivateFieldInitSpec(this, _memoizedChannels, {\n      sub: new Map(),\n      unsub: new Map()\n    });\n    _classPrivateFieldInitSpec(this, _channelPayloads, new Map());\n  }\n  subscribe(channel, payload) {\n    const stringifiedPayload = JSON.stringify(payload);\n    return _assertClassBrand(_MessageDispatcher_brand, this, _subOrUnsub).call(this, \"sub\", channel, payload, stringifiedPayload);\n  }\n  unsubscribe(channel) {\n    const stringifiedPayload = _classPrivateFieldGet(_channelPayloads, this).get(channel);\n    if (!stringifiedPayload) {\n      const msg = `The message channel to unsubscribe \"${channel}\" is not found`;\n      // eslint-disable-next-line no-console\n      console.error(msg);\n      return Promise.reject(new Error(msg));\n    }\n    const payload = JSON.parse(stringifiedPayload);\n    const result = _assertClassBrand(_MessageDispatcher_brand, this, _subOrUnsub).call(this, \"unsub\", channel, payload, stringifiedPayload);\n    _classPrivateFieldGet(_memoizedChannels, this).sub.delete(stringifiedPayload);\n    result.then(() => {\n      _classPrivateFieldGet(_channelPayloads, this).delete(channel);\n    });\n    return result;\n  }\n  onMessage(channel, listener) {\n    let stringifiedPayload = _classPrivateFieldGet(_channelPayloads, this).get(channel);\n    let warned = false;\n    _classPrivateGetter(_MessageDispatcher_brand, this, _get_ms).onMessage(response => {\n      if (!stringifiedPayload) {\n        stringifiedPayload = _classPrivateFieldGet(_channelPayloads, this).get(channel);\n      }\n      if (!stringifiedPayload) {\n        if (!warned) {\n          // eslint-disable-next-line no-console\n          console.error(`Message channel: \"${channel}\" not found`);\n          warned = true;\n        }\n        return;\n      }\n      if (response.event === \"MESSAGE.PUSH\" && matchMessageChannel(stringifiedPayload, response.payload)) {\n        listener(response.payload.message);\n      }\n    });\n  }\n  onClose(listener) {\n    _classPrivateGetter(_MessageDispatcher_brand, this, _get_ms).onClose(listener);\n  }\n  reset() {\n    var _classPrivateFieldGet2;\n    _classPrivateFieldGet(_memoizedChannels, this).sub.clear();\n    _classPrivateFieldGet(_memoizedChannels, this).unsub.clear();\n    _classPrivateFieldGet(_channelPayloads, this).clear();\n    (_classPrivateFieldGet2 = _classPrivateFieldGet(_ms, this)) === null || _classPrivateFieldGet2 === void 0 || _classPrivateFieldGet2.reset();\n  }\n}\nfunction _get_ms(_this) {\n  if (!_classPrivateFieldGet(_ms, _this)) {\n    const protocol = location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n    const url = `${protocol}//${window.location.host}${getBasePath()}api/websocket_service/v1/ws`;\n    _classPrivateFieldSet(_ms, _this, new MessageService(url));\n  }\n  return _classPrivateFieldGet(_ms, _this);\n}\nfunction _subOrUnsub(type, channel, payload, stringifiedPayload) {\n  const hit = _classPrivateFieldGet(_memoizedChannels, this)[type].get(stringifiedPayload);\n  if (hit) {\n    return hit;\n  }\n  const request = {\n    event: type === \"sub\" ? \"TOPIC.SUB\" : \"TOPIC.UNSUB\",\n    payload\n  };\n  const promise = new Promise((resolve, reject) => {\n    const identity = getIdentity(payload);\n    _classPrivateGetter(_MessageDispatcher_brand, this, _get_ms).onMessage(response => {\n      const isSuccess = response.event === (type === \"sub\" ? \"TOPIC.SUB_SUCCESS\" : \"TOPIC.UNSUB_SUCCESS\");\n      const isFailed = response.event === (type === \"sub\" ? \"TOPIC.SUB_FAILED\" : \"TOPIC.UNSUB_FAILED\");\n      if ((isSuccess || isFailed) &&\n      // Put this after event type checks, to prevent unnecessary\n      // JSON stringify.\n      identity === getIdentity(response.payload)) {\n        (isSuccess ? resolve : reject)(response);\n      }\n    });\n    _classPrivateGetter(_MessageDispatcher_brand, this, _get_ms).send(request);\n  });\n  if (type === \"sub\") {\n    _classPrivateFieldGet(_channelPayloads, this).set(channel, stringifiedPayload);\n  }\n  _classPrivateFieldGet(_memoizedChannels, this)[type].set(stringifiedPayload, promise);\n  return promise;\n}\nfunction getIdentity(payload) {\n  const {\n    system,\n    topic\n  } = payload;\n  return JSON.stringify({\n    system,\n    topic\n  });\n}\nfunction matchMessageChannel(stringifiedPayload, responsePayload) {\n  const payload = JSON.parse(stringifiedPayload);\n  return payload.system === responsePayload.system && (\n  // Exact match\n  payload.topic === responsePayload.topic ||\n  // Wildcards match\n  // For `ab.cd.*`:\n  // - Matches `ab.cd.r` or `ab.cd.x.yz`\n  // - DOES NOT match `ab.cd.x/yz` or `ab.x.cd` or `x.ab.cd.yz`\n  typeof payload.topic === \"string\" && payload.topic.includes(\"*\") && new RegExp(`^${payload.topic.replace(/([^*]*)\\*([^*]*)/g, (_m, p1, p2) => `${escapeRegExp(p1)}[^/]*${escapeRegExp(p2)}`)}$`).test(responsePayload.topic));\n}\n//# sourceMappingURL=MessageDispatcher.js.map","import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport { http } from \"@next-core/http\";\n/**\n * @description 查询独立部署小产品\n * @endpoint POST /api/v1/micro_app_standalone/search\n */\nexport var RuntimeApi_searchMicroAppStandalone = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator(function* (data, options) {\n    return (/**! @contract easyops.api.micro_app_standalone.runtime.SearchMicroAppStandalone@1.0.1 */(yield http.post(\"api/gateway/micro_app_standalone.runtime.SearchMicroAppStandalone/api/v1/micro_app_standalone/search\", data, options)).data\n    );\n  });\n  return function RuntimeApi_searchMicroAppStandalone(_x, _x2) {\n    return _ref.apply(this, arguments);\n  };\n}();\n//# sourceMappingURL=searchMicroAppStandalone.js.map","import { traverseStoryboardExpressions, collectInstalledAppsHasUsage } from \"@next-core/utils/storyboard\";\nimport { RuntimeApi_searchMicroAppStandalone } from \"@next-api-sdk/micro-app-standalone-sdk\";\nconst checkingApps = new Map();\nconst checkedApps = new Map();\nexport function preCheckInstalledApps(storyboard, hasAppInBootstrap) {\n  if (window.STANDALONE_MICRO_APPS && !window.NO_AUTH_GUARD) {\n    const appIds = scanInstalledAppsUsage(storyboard);\n    const searchIds = [];\n    for (const appId of appIds) {\n      // Do not check these apps already checking or in bootstrap.\n      if (!checkingApps.has(appId) && !hasAppInBootstrap(appId)) {\n        searchIds.push(appId);\n      }\n    }\n    if (searchIds.length === 0) {\n      return;\n    }\n    const promise = RuntimeApi_searchMicroAppStandalone({\n      query: {\n        appId: {\n          $in: searchIds\n        }\n      },\n      fields: [\"appId\", \"currentVersion\", \"installStatus\"]\n    }).catch(error => {\n      // Allow search micro app to fail, and\n      // make it not crash when the backend service is not updated.\n      // eslint-disable-next-line no-console\n      console.error(\"Get off site standalone micro-apps failed\", error);\n    });\n    for (const appId of searchIds) {\n      checkingApps.set(appId, promise.then(result => {\n        var _result$list;\n        const app = result === null || result === void 0 || (_result$list = result.list) === null || _result$list === void 0 ? void 0 : _result$list.find(item => item.appId === appId);\n        const checkedApp = app ? {\n          ...app,\n          id: appId\n        } : undefined;\n        checkedApps.set(appId, checkedApp);\n        return checkedApp;\n      }));\n    }\n  }\n}\nexport async function waitForCheckingApps(appIds) {\n  await Promise.all(appIds.map(appId => checkingApps.get(appId)));\n}\nexport function getCheckedApp(appId) {\n  if (window.STANDALONE_MICRO_APPS) {\n    return checkedApps.get(appId);\n  }\n}\nfunction scanInstalledAppsUsage(storyboard) {\n  const usage = {\n    usedArgs: new Set()\n  };\n  // `INSTALLED_APPS.has(...)` is not available in storyboard functions\n  const {\n    customTemplates,\n    menus\n  } = storyboard.meta ?? {};\n  traverseStoryboardExpressions([storyboard.routes, customTemplates, menus], (node, parent) => {\n    collectInstalledAppsHasUsage(usage, node, parent);\n  }, \"INSTALLED_APPS\");\n  return [...usage.usedArgs];\n}\n//# sourceMappingURL=checkInstalledApps.js.map","import { createProviderClass } from \"@next-core/utils/general\";\nimport { http } from \"@next-core/http\";\nimport { isEmpty, isObject } from \"lodash\";\nimport { createSSEStream } from \"@next-core/utils/general\";\nexport const FLOW_API_PROVIDER = \"core.provider-flow-api\";\nfunction hasFields(ext_fields, type) {\n  return ext_fields.some(item => item.source === type);\n}\nexport function processExtFields(ext_fields) {\n  const hasQueryParams = hasFields(ext_fields, \"query\");\n  const hasBodyParams = hasFields(ext_fields, \"body\");\n  for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n    args[_key - 1] = arguments[_key];\n  }\n  if (hasQueryParams) {\n    if (hasBodyParams) {\n      const [data, params, options] = args;\n      return {\n        data: data,\n        options: {\n          params: params,\n          ...options\n        }\n      };\n    }\n    const [params, options] = args;\n    return {\n      data: {},\n      options: {\n        params: params,\n        ...options\n      }\n    };\n  }\n\n  // only hasBodyParams or default\n  const [data, options] = args;\n  return {\n    data,\n    options: options\n  };\n}\nexport function hasFileType(request) {\n  if ((request === null || request === void 0 ? void 0 : request.type) !== \"object\") {\n    return false;\n  }\n  const processFields = fields => {\n    return !isEmpty(fields) && fields.some(field => [\"file\", \"file[]\"].includes(field.type) || processFields(field.fields));\n  };\n  return processFields(request.fields);\n}\nexport function transformFormData(data) {\n  if (data instanceof FormData) {\n    return data;\n  }\n  const formData = new FormData();\n  for (const [key, value] of Object.entries(data)) {\n    if (Array.isArray(value)) {\n      value.forEach(v => {\n        formData.append(key, v);\n      });\n    } else if (isObject(value) && !(value instanceof Blob) && !(value instanceof Date)) {\n      Object.entries(value).forEach(_ref => {\n        let [k, v] = _ref;\n        formData.append(`${key}[${k}]`, v);\n      });\n    } else {\n      formData.append(key, value);\n    }\n  }\n  return formData;\n}\nexport async function callFlowApi(_ref2) {\n  let {\n    url,\n    originalUri,\n    method = \"GET\",\n    responseWrapper = true,\n    ext_fields = [],\n    request,\n    isFileType,\n    stream\n  } = _ref2;\n  const isSimpleRequest = [\"get\", \"delete\", \"head\"].includes(method.toLowerCase());\n  const defaultOptions = isFileType ? {\n    responseType: \"blob\"\n  } : {};\n  let response;\n  for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n    args[_key2 - 1] = arguments[_key2];\n  }\n  if (isSimpleRequest) {\n    var _originalUri$match, _request$fields;\n    const noParams = originalUri && (request === null || request === void 0 ? void 0 : request.type) === \"object\" ? (((_originalUri$match = originalUri.match(/:([^/]+)/g)) === null || _originalUri$match === void 0 ? void 0 : _originalUri$match.length) ?? 0) === (((_request$fields = request.fields) === null || _request$fields === void 0 ? void 0 : _request$fields.length) ?? 0) : false;\n    let params;\n    let options;\n    if (noParams) {\n      [options] = args;\n    } else {\n      [params, options] = args;\n    }\n    if (stream) {\n      var _options;\n      const stream = await createSSEStream(http.getUrlWithParams(url, params), {\n        ...defaultOptions,\n        ...options,\n        method,\n        headers: Object.fromEntries([...new Headers(((_options = options) === null || _options === void 0 ? void 0 : _options.headers) ?? {}).entries()])\n      });\n      return stream;\n    }\n    response = await http.simpleRequest(method, url, {\n      params,\n      ...defaultOptions,\n      ...options\n    });\n  } else {\n    const isUploadType = hasFileType(request);\n    const result = processExtFields(ext_fields, ...args);\n    const data = isUploadType ? transformFormData(result.data) : result.data;\n    if (stream) {\n      var _result$options;\n      const {\n        body,\n        headers\n      } = http.getBodyAndHeaders(data, (_result$options = result.options) === null || _result$options === void 0 ? void 0 : _result$options.headers);\n      const stream = await createSSEStream(url, {\n        ...defaultOptions,\n        ...result.options,\n        method,\n        headers: Object.fromEntries([...new Headers(headers ?? {}).entries()]),\n        body\n      });\n      return stream;\n    }\n    response = await http.requestWithBody(method, url, data, {\n      ...defaultOptions,\n      ...result.options\n    });\n  }\n  return (isFileType ? false : responseWrapper) ? response.data : response;\n}\nexport function registerFlowApiProvider() {\n  customElements.define(FLOW_API_PROVIDER, createProviderClass(callFlowApi));\n}\n//# sourceMappingURL=FlowApiProvider.js.map","import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport { http } from \"@next-core/http\";\n/**\n * @description 通过defaultOrg查找单个契约信息\n * @endpoint POST /api/contract/single_search\n */\nexport var ContractApi_searchSingleContract = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator(function* (data, options) {\n    return (/**! @contract easyops.api.api_gateway.contract.SearchSingleContract@1.0.0 */(yield http.post(\"api/contract/single_search\", data, options)).data\n    );\n  });\n  return function ContractApi_searchSingleContract(_x, _x2) {\n    return _ref.apply(this, arguments);\n  };\n}();\n//# sourceMappingURL=searchSingleContract.js.map","const contractsMap = new Map();\nconst widgetContractMap = new Map();\nconst debugContractMap = new Map();\nconst addContract = (contracts, map) => {\n  contracts === null || contracts === void 0 || contracts.forEach(contract => {\n    map.set(`${contract.namespaceId}.${contract.name}`, contract);\n  });\n};\nexport function collectContract(contracts) {\n  addContract(contracts, contractsMap);\n}\nexport function collectWidgetContract(contracts) {\n  addContract(contracts, widgetContractMap);\n}\nexport function clearCollectWidgetContract() {\n  widgetContractMap.clear();\n}\nexport function collectDebugContract(contracts) {\n  addContract(contracts, debugContractMap);\n}\nexport function clearDebugContract() {\n  debugContractMap.clear();\n}\nexport function getContract(name) {\n  return contractsMap.get(name) || widgetContractMap.get(name) || debugContractMap.get(name);\n}\n//# sourceMappingURL=CollectContracts.js.map","import yaml from \"js-yaml\";\nimport { ContractApi_searchSingleContract } from \"@next-api-sdk/api-gateway-sdk\";\nimport { getContract } from \"./CollectContracts.js\";\nconst remoteContractCache = new Map();\n\n// Legacy Custom API: `${namespace}@${name}`\n// Flow API: `${namespace}@${name}:${version}`\nexport function isFlowApiProvider(provider) {\n  return provider.includes(\"@\");\n}\nexport async function getArgsOfFlowApi(provider, originalArgs, method, stream) {\n  if (!provider.includes(\":\")) {\n    throw new Error(`You're using legacy Custom API \"${provider}\" which is dropped in v3, please use Flow API instead`);\n  }\n  const apiDefinition = await fetchFlowApiDefinition(provider);\n  if (!apiDefinition) {\n    throw new FlowApiNotFoundError(`Flow API not found: \"${provider}\"`);\n  }\n  const apiProfile = getApiProfileFromApiDefinition(provider, apiDefinition);\n  return getApiArgsFromApiProfile(apiProfile, originalArgs, method, stream);\n}\nfunction getApiArgsFromApiProfile(_ref, originalArgs, method, stream) {\n  let {\n    uri,\n    method: apiMethod,\n    ext_fields,\n    name,\n    namespace,\n    serviceName,\n    responseWrapper,\n    version,\n    isFileType,\n    request\n  } = _ref;\n  // `saveAs` requires the first argument to be the filename.\n  const isDownload = method === \"saveAs\";\n  let fileName;\n  if (isDownload) {\n    fileName = originalArgs.shift();\n  }\n  const {\n    url,\n    args\n  } = getTransformedUriAndRestArgs(uri, originalArgs, name, namespace, serviceName, version);\n  return [...(isDownload ? [fileName] : []), {\n    url,\n    originalUri: uri,\n    method: apiMethod,\n    ext_fields,\n    responseWrapper,\n    request,\n    isFileType,\n    stream\n  }, ...args];\n}\nfunction getTransformedUriAndRestArgs(uri, originalArgs, name, namespace, serviceName, version) {\n  const prefix = version ? serviceName === \"logic.api.gateway\" || serviceName !== null && serviceName !== void 0 && serviceName.startsWith(\"logic.api.gateway.\") ? \"\" : serviceName ? `api/gateway/${serviceName}` : `api/gateway/${namespace}.${name}@${version}` : `api/gateway/api_service.${namespace}.${name}`;\n  const restArgs = originalArgs.slice();\n  const transformedUri = uri.replace(/:([^/]+)/g, () => restArgs.shift());\n  return {\n    url: prefix ? prefix + transformedUri : transformedUri.replace(/^\\//, \"\"),\n    args: restArgs\n  };\n}\nfunction getApiProfileFromApiDefinition(provider, api) {\n  var _contract$response;\n  const contract = typeof api.contract === \"string\" ? yaml.safeLoad(api.contract, {\n    schema: yaml.JSON_SCHEMA,\n    json: true\n  }) : api.contract;\n  const {\n    uri,\n    method = \"GET\",\n    ext_fields\n  } = (contract === null || contract === void 0 ? void 0 : contract.endpoint) ?? {};\n  const responseWrapper = contract !== null && contract !== void 0 && contract.response ? contract.response.wrapper !== false : false;\n  if (!uri) {\n    throw new Error(`Missing endpoint.uri in contract of provider \"${provider}\"`);\n  }\n  return {\n    uri,\n    method: method.toLowerCase() === \"list\" ? \"get\" : method,\n    ext_fields,\n    name: api.name,\n    namespace: api.namespace,\n    serviceName: api.serviceName,\n    version: api.version,\n    isFileType: (contract === null || contract === void 0 || (_contract$response = contract.response) === null || _contract$response === void 0 ? void 0 : _contract$response.type) === \"file\",\n    responseWrapper,\n    request: contract === null || contract === void 0 ? void 0 : contract.request\n  };\n}\nasync function fetchFlowApiDefinition(provider) {\n  const [namespaceName, nameWithVersion] = provider.split(\"@\");\n  const [name, version] = nameWithVersion.split(\":\");\n\n  // Do not cache the result of `geContract`, which will lead to no contract\n  // will be found when render twice immediately.\n  const contract = getContract(`${namespaceName}.${name}`);\n  if (contract) {\n    return {\n      name: contract.name,\n      namespace: contract.namespaceId,\n      serviceName: contract.serviceName,\n      version: contract.version,\n      contract: {\n        endpoint: contract.endpoint,\n        response: contract.response,\n        request: contract.request\n      }\n    };\n  }\n  let promise = remoteContractCache.get(provider);\n  if (!promise) {\n    promise = fetchFlowApiDefinitionFromRemote(namespaceName, name, version);\n    remoteContractCache.set(provider, promise);\n  }\n  return promise;\n}\nasync function fetchFlowApiDefinitionFromRemote(namespace, name, version) {\n  var _contractData$namespa;\n  const {\n    contractData\n  } = await ContractApi_searchSingleContract({\n    contractName: `${namespace}.${name}`,\n    version\n  });\n\n  // return undefined if don't found contract\n  return contractData ? {\n    name: contractData.name,\n    namespace: (_contractData$namespa = contractData.namespace) === null || _contractData$namespa === void 0 || (_contractData$namespa = _contractData$namespa[0]) === null || _contractData$namespa === void 0 ? void 0 : _contractData$namespa.name,\n    serviceName: contractData.serviceName,\n    version: contractData.version,\n    contract: {\n      endpoint: contractData.endpoint,\n      response: contractData.response,\n      request: contractData.request\n    }\n  } : null;\n}\nclass FlowApiNotFoundError extends Error {\n  constructor(message) {\n    // Pass remaining arguments (including vendor specific ones) to parent constructor\n    super(message);\n    this.name = \"FlowApiNotFoundError\";\n\n    // Maintains proper stack trace for where our error was thrown (only available on V8)\n    // istanbul ignore else\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, FlowApiNotFoundError);\n    }\n  }\n}\n//# sourceMappingURL=FlowApi.js.map","import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport { http } from \"@next-core/http\";\n/**\n * @description 搜索实例\n * @endpoint POST /object/:objectId/instance/_search\n */\nexport var InstanceApi_postSearch = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator(function* (objectId, data, options) {\n    return (/**! @contract easyops.api.cmdb.instance.PostSearch@1.1.0 */(yield http.post(\"api/gateway/cmdb.instance.PostSearch/object/\".concat(objectId, \"/instance/_search\"), data, options)).data\n    );\n  });\n  return function InstanceApi_postSearch(_x, _x2, _x3) {\n    return _ref.apply(this, arguments);\n  };\n}();\n//# sourceMappingURL=postSearch.js.map","import _objectSpread from \"@babel/runtime/helpers/objectSpread2\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport { http } from \"@next-core/http\";\n/**\n * @description 获取菜单信息\n * @endpoint GET /api/v1/micro-app/menus/:menuId\n */\nexport var InstalledMicroAppApi_getMenusInfo = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator(function* (menuId, params, options) {\n    return (/**! @contract easyops.api.micro_app.installed_micro_app.GetMenusInfo@1.0.0 */(yield http.get(\"api/gateway/micro_app.installed_micro_app.GetMenusInfo/api/v1/micro-app/menus/\".concat(menuId), _objectSpread(_objectSpread({}, options), {}, {\n        params\n      }))).data\n    );\n  });\n  return function InstalledMicroAppApi_getMenusInfo(_x, _x2, _x3) {\n    return _ref.apply(this, arguments);\n  };\n}();\n//# sourceMappingURL=getMenusInfo.js.map","export const symbolAppId = Symbol(\"appId\");\nexport const symbolMenuI18nNamespace = Symbol(\"menuI18nNamespace\");\nexport const symbolOverrideApp = Symbol(\"overrideApp\");\n//# sourceMappingURL=constants.js.map","import { i18n } from \"@next-core/i18n\";\nimport { symbolAppId, symbolMenuI18nNamespace, symbolOverrideApp } from \"./constants.js\";\nimport { loadDynamicMenuItems } from \"./loadDynamicMenuItems.js\";\nexport async function mergeMenu(menuList, runtimeContext, helpers) {\n  const mainMenu = menuList.find(menu => menu.type !== \"inject\");\n  if (!mainMenu) {\n    return undefined;\n  }\n  const validMenuList = [];\n  const injectWithMenus = new Map();\n  const menuWithI18n = new WeakMap();\n  for (const menu of menuList) {\n    if (menu.i18n) {\n      const menuI18nNamespace = `menu/${menu.menuId}~${menu.app[0].appId}+${menu.instanceId}`;\n      // Support any language in `menu.i18n`.\n      Object.entries(menu.i18n).forEach(_ref => {\n        let [lang, resources] = _ref;\n        i18n.addResourceBundle(lang, menuI18nNamespace, resources);\n      });\n      menuWithI18n.set(menu, menuI18nNamespace);\n    }\n  }\n  await Promise.all(menuList.map(menu => loadDynamicMenuItems(menu, runtimeContext, menuWithI18n, helpers)));\n  for (const menu of menuList) {\n    var _menu$items;\n    if ((_menu$items = menu.items) !== null && _menu$items !== void 0 && _menu$items.length) {\n      if (menu.type === \"inject\" && menu.injectMenuGroupId) {\n        let injectingMenus = injectWithMenus.get(menu.injectMenuGroupId);\n        if (!injectingMenus) {\n          injectingMenus = [];\n          injectWithMenus.set(menu.injectMenuGroupId, injectingMenus);\n        }\n        injectingMenus.push(menu);\n      } else {\n        validMenuList.push(menu);\n      }\n    }\n  }\n  return {\n    ...mainMenu,\n    items: validMenuList.flatMap(menu =>\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    processGroupInject(menu.items, menu, injectWithMenus, menuWithI18n)),\n    [symbolMenuI18nNamespace]: menuWithI18n.get(mainMenu),\n    [symbolOverrideApp]: mainMenu.overrideApp\n  };\n}\nfunction processGroupInject(items, menu, injectWithMenus, menuWithI18n) {\n  return items === null || items === void 0 ? void 0 : items.map(item => {\n    const foundInjectingMenus = item.groupId && injectWithMenus.get(item.groupId);\n    if (foundInjectingMenus) {\n      // Each menu to be injected with should be injected only once.\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      injectWithMenus.delete(item.groupId);\n    }\n    return {\n      ...item,\n      children: (processGroupInject(item.children, menu, injectWithMenus, menuWithI18n) ?? []).concat(foundInjectingMenus ? foundInjectingMenus.flatMap(injectingMenu =>\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      processGroupInject(injectingMenu.items, injectingMenu, injectWithMenus, menuWithI18n)) : []),\n      [symbolAppId]: menu.app[0].appId,\n      [symbolMenuI18nNamespace]: menuWithI18n.get(menu),\n      [symbolOverrideApp]: menu.overrideApp\n    };\n  });\n}\n//# sourceMappingURL=mergeMenu.js.map","import { preCheckPermissionsForAny } from \"../checkPermissions.js\";\nexport async function loadDynamicMenuItems(menu, runtimeContext, menuWithI18n, helpers) {\n  if (menu.dynamicItems && menu.itemsResolve) {\n    const overrideAppId = menu.app[0].appId;\n    const newRuntimeContext = {\n      ...runtimeContext,\n      pendingPermissionsPreCheck: [...runtimeContext.pendingPermissionsPreCheck, preCheckPermissionsForAny(menu.itemsResolve)]\n    };\n    if (overrideAppId !== runtimeContext.app.id) {\n      var _helpers$getStoryboar;\n      newRuntimeContext.overrideApp = window.STANDALONE_MICRO_APPS ? menu.overrideApp : (_helpers$getStoryboar = helpers.getStoryboardByAppId(overrideAppId)) === null || _helpers$getStoryboar === void 0 ? void 0 : _helpers$getStoryboar.app;\n      newRuntimeContext.appendI18nNamespace = menuWithI18n.get(menu);\n    }\n    const resolved = await helpers.resolveData({\n      transform: \"items\",\n      ...menu.itemsResolve\n    }, newRuntimeContext);\n    menu.items = resolved.items;\n  }\n}\n//# sourceMappingURL=loadDynamicMenuItems.js.map","import { sortBy } from \"lodash\";\nexport function reorderMenu(menuData) {\n  menuData.items = reorderMenuItems(menuData.items);\n}\nfunction reorderMenuItems(list) {\n  return sortMenuItems(list).map(item => ({\n    ...item,\n    children: reorderMenuItems(item.children)\n  }));\n}\nfunction sortMenuItems(list) {\n  return sortBy(list, item => item.sort ?? -Infinity);\n}\n//# sourceMappingURL=reorderMenuItems.js.map","import { symbolAppId, symbolMenuI18nNamespace, symbolOverrideApp } from \"./constants.js\";\nimport { hasOwnProperty, isObject } from \"@next-core/utils/general\";\nimport { pipes } from \"@next-core/pipes\";\nimport { isEvaluable } from \"@next-core/cook\";\nexport function computeMenuData(data, overrideAppId, runtimeContext, helpers) {\n  if (\"titleDataSource\" in data && isObject(data.titleDataSource) && Object.entries(data.titleDataSource).every(_ref => {\n    let [, value] = _ref;\n    return value === null || value === \"\";\n  })) {\n    delete data.titleDataSource;\n  }\n  if (\"if\" in data && data.if === null) {\n    delete data.if;\n  }\n  if (\"to\" in data && data.to && !isEvaluable(data.to)) {\n    const yaml = pipes.yaml(data.to);\n    if (isObject(yaml) && [\"pathname\", \"search\", \"hash\"].some(key => hasOwnProperty(yaml, key))) {\n      data.to = yaml;\n    }\n  }\n  let newRuntimeContext = runtimeContext;\n  if (overrideAppId !== runtimeContext.app.id) {\n    var _helpers$getStoryboar;\n    const overrideApp = window.STANDALONE_MICRO_APPS ? data[symbolOverrideApp] : (_helpers$getStoryboar = helpers.getStoryboardByAppId(overrideAppId)) === null || _helpers$getStoryboar === void 0 ? void 0 : _helpers$getStoryboar.app;\n    newRuntimeContext = {\n      ...runtimeContext,\n      overrideApp,\n      appendI18nNamespace: data[symbolMenuI18nNamespace]\n    };\n  }\n  return helpers.asyncComputeRealValue(data, newRuntimeContext, {\n    ignoreSymbols: true\n  });\n}\nexport function computeMenuItems(items, runtimeContext, helpers) {\n  return Promise.all(items.map(async _ref2 => {\n    let {\n      children,\n      ...rest\n    } = _ref2;\n    const [computedRest, computedChildren] = await Promise.all([computeMenuData(rest, rest[symbolAppId], runtimeContext, helpers), children && (await computeMenuItems(children, runtimeContext, helpers))]);\n    return {\n      ...computedRest,\n      children: computedChildren\n    };\n  }));\n}\n//# sourceMappingURL=computeMenuData.js.map","import _objectSpread from \"@babel/runtime/helpers/objectSpread2\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport { http } from \"@next-core/http\";\n/**\n * @description 获取实例详情\n * @endpoint GET /object/:objectId/instance/:instanceId\n */\nexport var InstanceApi_getDetail = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator(function* (objectId, instanceId, params, options) {\n    return (/**! @contract easyops.api.cmdb.instance.GetDetail@1.0.0 */(yield http.get(\"api/gateway/cmdb.instance.GetDetail/object/\".concat(objectId, \"/instance/\").concat(instanceId), _objectSpread(_objectSpread({}, options), {}, {\n        params\n      }))).data\n    );\n  });\n  return function InstanceApi_getDetail(_x, _x2, _x3, _x4) {\n    return _ref.apply(this, arguments);\n  };\n}();\n//# sourceMappingURL=getDetail.js.map","import { isEmpty } from \"lodash\";\nimport { InstanceApi_getDetail } from \"@next-api-sdk/cmdb-sdk\";\nconst menuTitleCache = new Map();\nexport async function fetchMenuTitle(menuData) {\n  if (menuData.title || isEmpty(menuData.titleDataSource)) {\n    return menuData.title;\n  }\n  const cacheKey = JSON.stringify(menuData.titleDataSource);\n  const cachedTitle = menuTitleCache.get(cacheKey);\n  if (cachedTitle !== undefined) {\n    return cachedTitle;\n  }\n  const {\n    objectId,\n    instanceId,\n    attributeId\n  } = menuData.titleDataSource;\n  const attr = attributeId ?? \"name\";\n  const instanceData = await InstanceApi_getDetail(objectId, instanceId, {\n    fields: attr\n  });\n  let title;\n  if (attributeId === \"#showKey\" && Array.isArray(instanceData[attr])) {\n    const [primary, ...rest] = instanceData[attr];\n    title = rest.length > 0 ? `${primary}(${rest.join(\",\")})` : String(primary);\n  } else {\n    title = String(instanceData[attr]);\n  }\n  menuTitleCache.set(cacheKey, title);\n  return title;\n}\n//# sourceMappingURL=fetchMenuTitle.js.map","import { InstanceApi_postSearch } from \"@next-api-sdk/cmdb-sdk\";\nimport { InstalledMicroAppApi_getMenusInfo } from \"@next-api-sdk/micro-app-sdk\";\nimport { omit, pick } from \"lodash\";\nimport { checkIfOfComputed } from \"@next-core/runtime\";\nimport { mergeMenu } from \"./mergeMenu.js\";\nimport { reorderMenu } from \"./reorderMenuItems.js\";\nimport { computeMenuItems, computeMenuData } from \"./computeMenuData.js\";\nimport { fetchMenuTitle } from \"./fetchMenuTitle.js\";\nimport { getMenusOfStandaloneApp } from \"./getMenusOfStandaloneApp.js\";\nimport { preCheckPermissionsForAny } from \"../checkPermissions.js\";\nconst menuPromises = new Map();\nconst menuCache = new Map();\nfunction transformMenuItems(menuItems) {\n  return menuItems === null || menuItems === void 0 ? void 0 : menuItems.filter(checkIfOfComputed).map(item => {\n    const children = transformMenuItems(item.children);\n    const transformedMenuItem = item.type === \"group\" ? {\n      type: \"group\",\n      title: item.text,\n      childLayout: item.childLayout,\n      items: children,\n      groupId: item.groupId,\n      groupFrom: item.groupFrom\n    } : children !== null && children !== void 0 && children.length ? {\n      type: \"subMenu\",\n      childLayout: item.childLayout,\n      title: item.text,\n      icon: item.icon,\n      items: children,\n      defaultExpanded: item.defaultExpanded\n    } : omit(item, [\"type\", \"items\", \"children\"]);\n    return transformedMenuItem;\n  });\n}\nexport function getMenuById(menuId) {\n  return menuCache.get(menuId);\n}\nexport function fetchMenuById(menuId, runtimeContext, helpers) {\n  let promise = menuPromises.get(menuId);\n  if (!promise) {\n    promise = _fetchMenuById(menuId, runtimeContext, helpers);\n  }\n  return promise;\n}\nasync function _fetchMenuById(menuId, runtimeContext, helpers) {\n  const menuList = window.STANDALONE_MICRO_APPS ? getMenusOfStandaloneApp(menuId, runtimeContext.app.id, helpers) : runtimeContext.flags[\"three-level-menu-layout\"] ? (await InstalledMicroAppApi_getMenusInfo(menuId, {\n    menuObjectId: \"EASYOPS_STORYBOARD_MENU\"\n  })).menus : (await InstanceApi_postSearch(\"EASYOPS_STORYBOARD_MENU\", {\n    page: 1,\n    page_size: 200,\n    fields: {\n      menuId: true,\n      title: true,\n      icon: true,\n      link: true,\n      titleDataSource: true,\n      defaultCollapsed: true,\n      defaultCollapsedBreakpoint: true,\n      type: true,\n      injectMenuGroupId: true,\n      dynamicItems: true,\n      itemsResolve: true,\n      items: true,\n      i18n: true,\n      \"items.children\": true,\n      \"app.appId\": true\n    },\n    query: {\n      menuId: {\n        $eq: menuId\n      },\n      app: {\n        $size: {\n          $gt: 0\n        }\n      }\n    }\n  })).list;\n  const menuData = await mergeMenu(menuList, runtimeContext, helpers);\n  if (!menuData) {\n    throw new Error(`Menu not found: ${menuId}`);\n  }\n  reorderMenu(menuData);\n  const {\n    items,\n    app,\n    ...restMenuData\n  } = menuData;\n  const newRuntimeContext = {\n    ...runtimeContext,\n    pendingPermissionsPreCheck: [...runtimeContext.pendingPermissionsPreCheck, preCheckPermissionsForAny([items, restMenuData])]\n  };\n  delete newRuntimeContext.tplStateStoreId;\n  delete newRuntimeContext.forEachItem;\n  delete newRuntimeContext.forEachIndex;\n  delete newRuntimeContext.forEachSize;\n  const rootAppId = app[0].appId;\n  const [computedMenuData, computedMenuItems] = await Promise.all([computeMenuData(restMenuData, rootAppId, newRuntimeContext, helpers), computeMenuItems(items, newRuntimeContext, helpers)]);\n  const finalMenuData = {\n    title: await fetchMenuTitle(computedMenuData),\n    ...pick(computedMenuData, [\"icon\", \"link\", \"defaultCollapsed\", \"defaultCollapsedBreakpoint\"]),\n    menuItems: transformMenuItems(computedMenuItems)\n  };\n\n  // Todo(steve): reconsider the menu cache strategy\n  menuCache.set(menuId, finalMenuData);\n}\n//# sourceMappingURL=fetchMenuById.js.map","export function getMenusOfStandaloneApp(menuId, appId, helpers) {\n  var _storyboard$meta, _storyboard$meta2;\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  const storyboard = helpers.getStoryboardByAppId(appId);\n  const menus = ((_storyboard$meta = storyboard.meta) === null || _storyboard$meta === void 0 ? void 0 : _storyboard$meta.injectMenus) ?? ((_storyboard$meta2 = storyboard.meta) === null || _storyboard$meta2 === void 0 ? void 0 : _storyboard$meta2.menus) ?? [];\n  return menus.filter(menu => menu.menuId === menuId).map(menu => {\n    var _menu$app;\n    return {\n      ...menu,\n      ...((_menu$app = menu.app) !== null && _menu$app !== void 0 && (_menu$app = _menu$app[0]) !== null && _menu$app !== void 0 && _menu$app.appId ? {} : {\n        app: [{\n          appId\n        }]\n      })\n    };\n  });\n\n  // Todo: maybe: fetch menus from STANDALONE_MENU@EASYOPS\n}\n//# sourceMappingURL=getMenusOfStandaloneApp.js.map","export const events = [];\nconst MAXIMUM_WAITING_TIME = 5 * 1000;\nconst MAXIMUM_LOGGED_EVENTS = 10;\nlet timer = null;\nexport const transportOptions = {\n  maxWaitingTime: MAXIMUM_WAITING_TIME,\n  maxLoggedEvents: MAXIMUM_LOGGED_EVENTS\n};\nexport function createTransport(api, options) {\n  Object.assign(transportOptions, {\n    ...options,\n    api\n  });\n  return {\n    sendOnExit,\n    emit\n  };\n}\nfunction nextTime(callback) {\n  return (window.requestIdleCallback || window.requestAnimationFrame || (cb => setTimeout(cb, 17)))(callback);\n}\nfunction emit() {\n  clearTimeout(timer);\n  events.length > transportOptions.maxLoggedEvents ? send() : timer = setTimeout(send, transportOptions.maxWaitingTime);\n}\nfunction send() {\n  if (events.length === 0) {\n    return;\n  }\n  const transportEvents = events.splice(0, transportOptions.maxLoggedEvents);\n  const transportData = buildTransportData(transportEvents);\n  sendBeacon(transportOptions.api, transportData);\n  events.length && nextTime(send);\n}\nfunction sendBeacon(requestUrl, data) {\n  const headers = {\n    type: \"application/json\"\n  };\n  const blob = new Blob([JSON.stringify(data)], headers);\n  window.navigator.sendBeacon(requestUrl, blob);\n}\nfunction sendOnExit() {\n  window.addEventListener(\"beforeunload\", send, false);\n}\nfunction buildTransportData(data) {\n  return {\n    model: \"easyops.FRONTEND_STAT\",\n    columns: [\"_ver\", \"st\", \"et\", \"lt\", \"size\", \"time\", \"traceId\", \"code\", \"duration\", \"page\", \"uid\", \"username\", \"api\", \"type\", \"msg\", \"status\", \"pageId\", \"route\", \"apiCount\", \"maxApiTimeCost\", \"apiSizeCost\", \"pageTitle\"],\n    data\n  };\n}\n//# sourceMappingURL=transport.js.map","import { createTransport, events } from \"./transport.js\";\nlet initialized = false;\nlet transport;\nlet pageState = null;\nlet isFirstPageView = true;\nconst stashedApiMetrics = [];\nexport function initialize(api) {\n  let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  if (initialized) {\n    return;\n  }\n  initialized = true;\n  if (!transport) {\n    transport = createTransport(api, options);\n    transport.sendOnExit();\n  }\n}\nexport function createPageView() {\n  stashedApiMetrics.length = 0;\n  pageState = null;\n}\nexport function finishPageView(metric) {\n  const pageId = generateUUID();\n  const {\n    lt,\n    route\n  } = metric;\n  pageState = {\n    lt,\n    route,\n    pageId\n  };\n  events.push({\n    ...metric,\n    pageId,\n    apiCount: stashedApiMetrics.length,\n    maxApiTimeCost: Math.max(0, ...stashedApiMetrics.map(api => api.duration)),\n    size: stashedApiMetrics.map(api => api.size).filter(size => size > 0).reduce((prev, current) => prev + current, 0)\n  });\n  for (const item of stashedApiMetrics) {\n    events.push({\n      ...item,\n      ...pageState\n    });\n  }\n  stashedApiMetrics.length = 0;\n  transport.emit();\n}\nexport function earlyFinishPageView() {\n  events.push(...stashedApiMetrics);\n  stashedApiMetrics.length = 0;\n}\nexport function pushApiMetric(metric) {\n  if (pageState) {\n    events.push({\n      ...metric,\n      type: \"apiRequest\",\n      ...pageState\n    });\n  } else {\n    stashedApiMetrics.push(metric);\n  }\n}\n\n// Ref https://medium.com/teads-engineering/generating-uuids-at-scale-on-the-web-2877f529d2a2\nfunction generateUUID() {\n  const url = URL.createObjectURL(new Blob([]));\n  let uuid = url.substring(url.lastIndexOf(\"/\") + 1);\n  URL.revokeObjectURL(url);\n  // 第一次渲染加上特殊标记\n  if (isFirstPageView) {\n    uuid = \"88-\" + uuid;\n    isFirstPageView = false;\n  }\n  return uuid;\n}\n//# sourceMappingURL=analytics.js.map","import { HttpResponseError, HttpParseError, HttpAbortError } from \"@next-core/http\";\nimport { isObject } from \"@next-core/utils/general\";\nimport { getAuth } from \"../auth.js\";\nimport { pushApiMetric } from \"./analytics.js\";\nconst symbolHttpAnalytics = Symbol(\"HttpAnalytics\");\nexport function onRequest(config) {\n  const perfStartTime = Math.round(performance.now());\n  const st = Date.now();\n  config[symbolHttpAnalytics] = {\n    st,\n    time: Math.round(st / 1000),\n    perfStartTime\n  };\n  return config;\n}\nexport function onResponse(response, config) {\n  return onResponseOrError(false, response, config);\n}\nexport function onResponseError(error, config) {\n  return onResponseOrError(true, error, config);\n}\nfunction onResponseOrError(hasError, responseOrError, config) {\n  const perfEndTime = Math.round(performance.now());\n  const et = Date.now();\n  const {\n    [symbolHttpAnalytics]: meta,\n    url\n  } = config;\n  if (meta && !(hasError && responseOrError instanceof HttpAbortError)) {\n    delete config[symbolHttpAnalytics];\n    const {\n      st,\n      time,\n      perfStartTime\n    } = meta;\n    const {\n      userInstanceId: uid,\n      username\n    } = getAuth();\n    let code;\n    let message;\n    let traceId;\n    let size;\n    let status;\n    let headers;\n    let data;\n    if (hasError) {\n      const isHttpResponseError = responseOrError instanceof HttpResponseError;\n      if (isHttpResponseError || responseOrError instanceof HttpParseError) {\n        ({\n          status,\n          headers\n        } = responseOrError.response);\n        if (isHttpResponseError) {\n          data = responseOrError.responseJson;\n        }\n      }\n    } else {\n      ({\n        status,\n        data,\n        headers\n      } = responseOrError);\n    }\n    if (isObject(data)) {\n      ({\n        code,\n        message\n      } = data);\n    }\n    if (headers instanceof Headers) {\n      traceId = headers.get(\"x-b3-traceid\");\n      size = headers.get(\"content-length\");\n    }\n    pushApiMetric({\n      st,\n      _ver: st,\n      uid,\n      username,\n      time,\n      et,\n      page: location.href,\n      duration: perfEndTime - perfStartTime,\n      api: url,\n      type: \"api\",\n      code: code ?? -1,\n      msg: message ?? \"\",\n      status,\n      traceId: traceId ?? \"\",\n      size: size ? Number(size) : -1\n    });\n  }\n  return hasError ? Promise.reject(responseOrError) : responseOrError;\n}\n//# sourceMappingURL=http.js.map","import { createPageView, earlyFinishPageView, finishPageView } from \"./analytics.js\";\nimport { getAuth } from \"../auth.js\";\nexport function create() {\n  const perfStartTime = Math.round(performance.now());\n  const startTime = Date.now();\n  createPageView();\n  return function finish(_ref) {\n    let {\n      status,\n      path,\n      pageTitle\n    } = _ref;\n    if (status !== \"ok\") {\n      earlyFinishPageView();\n      return;\n    }\n    const renderTime = Math.round(performance.now()) - perfStartTime;\n    const endTime = Date.now();\n    const {\n      username\n    } = getAuth();\n    finishPageView({\n      type: \"page\",\n      page: location.href,\n      _ver: startTime,\n      time: Math.round(startTime / 1000),\n      st: startTime,\n      et: endTime,\n      lt: renderTime,\n      pageTitle,\n      username,\n      route: path\n    });\n\n    // For bricks which would take actions with render time.\n    window.dispatchEvent(new CustomEvent(\"route.render\", {\n      detail: {\n        renderTime\n      }\n    }));\n  };\n}\n//# sourceMappingURL=pageView.js.map","// istanbul ignore file\nimport { checkPermissions as _checkPermissions, preCheckPermissions, preCheckPermissionsForBrickOrRoute } from \"./checkPermissions.js\";\nimport { MessageDispatcher } from \"./websocket/MessageDispatcher.js\";\nimport * as authV3 from \"./auth.js\";\nimport { authV2Factory } from \"./auth-v2.js\";\nimport * as _checkInstalledApps from \"./checkInstalledApps.js\";\nexport { _checkInstalledApps as checkInstalledApps };\nimport * as _flowApi from \"./flowApi/index.js\";\nexport { _flowApi as flowApi };\nimport * as _menu from \"./menu/index.js\";\nexport { _menu as menu };\nimport * as _analytics from \"./analytics/index.js\";\nexport { _analytics as analytics };\nexport const checkPermissions = Object.freeze({\n  checkPermissions: _checkPermissions,\n  preCheckPermissions,\n  preCheckPermissionsForBrickOrRoute\n});\nexport const messageDispatcher = new MessageDispatcher();\nexport const auth = authV2Factory() || authV3;\n//# sourceMappingURL=index.js.map","// istanbul ignore file\nimport { getV2RuntimeFromDll } from \"@next-core/runtime\";\nimport { pick } from \"lodash\";\nexport function authV2Factory() {\n  const v2Kit = getV2RuntimeFromDll();\n  if (v2Kit) {\n    return Object.freeze(pick(v2Kit, [\"authenticate\", \"getAuth\", \"isLoggedIn\", \"logout\"]));\n  }\n}\n//# sourceMappingURL=auth-v2.js.map"],"names":["_assertClassBrand","e","t","n","has","arguments","length","TypeError","asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","value","error","done","Promise","then","_asyncToGenerator","fn","self","this","args","apply","err","undefined","_checkPrivateRedeclaration","obj","privateCollection","_classPrivateFieldGet2","s","a","get","_classPrivateFieldInitSpec","privateMap","set","_classPrivateFieldSet2","r","_classPrivateGetter","_classPrivateMethodInitSpec","privateSet","add","_defineProperty","Object","defineProperty","enumerable","configurable","writable","ownKeys","keys","getOwnPropertySymbols","o","filter","getOwnPropertyDescriptor","push","_objectSpread2","forEach","getOwnPropertyDescriptors","defineProperties","PermissionApi_validatePermissions","_ref","data","options","http","post","_x","_x2","auth","authenticate","newAuth","assign","org","username","userInstanceId","loginFrom","accessRule","isAdmin","csrfToken","license","accessToken","userShowValue","getAuth","logout","checkingPermissions","clear","checkedPermissions","permissionMap","isLoggedIn","Map","preCheckPermissionsForAny","validatePermissions","scanPermissionActionsInAny","async","usedActions","uncheckedActions","action","includes","checkingTasks","restActions","promise","task","result","actions","noAbortOnRouteChange","item","authorizationStatus","console","all","RETRY_TIMEOUT_UNIT","RETRY_LIMIT","_url","WeakMap","_ws","_queuedMessages","_messageListeners","_closeListeners","_retryCount","_closed","_MessageService_brand","WeakSet","MessageService","constructor","url","Set","send","_connect","call","stringifiedData","JSON","stringify","readyState","WebSocket","OPEN","onMessage","listener","onClose","reset","close","log","ws","resetRetryCountTimeout","addEventListener","setTimeout","msg","clearTimeout","code","_reconnect","response","parse","delay","Math","pow","_this$retryCount","_ms","_memoizedChannels","_channelPayloads","_MessageDispatcher_brand","_get_ms","_this","location","protocol","window","host","getBasePath","_subOrUnsub","type","channel","payload","stringifiedPayload","hit","request","event","identity","getIdentity","isSuccess","isFailed","system","topic","RuntimeApi_searchMicroAppStandalone","checkingApps","checkedApps","preCheckInstalledApps","storyboard","hasAppInBootstrap","STANDALONE_MICRO_APPS","NO_AUTH_GUARD","appIds","usage","usedArgs","customTemplates","menus","meta","traverseStoryboardExpressions","routes","node","parent","collectInstalledAppsHasUsage","scanInstalledAppsUsage","searchIds","appId","query","$in","fields","catch","_result$list","app","list","find","checkedApp","id","waitForCheckingApps","map","getCheckedApp","FLOW_API_PROVIDER","hasFields","ext_fields","some","source","callFlowApi","_ref2","originalUri","method","responseWrapper","isFileType","stream","isSimpleRequest","toLowerCase","defaultOptions","responseType","_len2","Array","_key2","_originalUri$match","_request$fields","params","_options","match","createSSEStream","getUrlWithParams","headers","fromEntries","Headers","entries","simpleRequest","isUploadType","processFields","isEmpty","field","hasFileType","hasQueryParams","hasBodyParams","_len","_key","processExtFields","FormData","formData","isArray","v","append","isObject","Blob","Date","k","transformFormData","_result$options","body","getBodyAndHeaders","requestWithBody","registerFlowApiProvider","customElements","define","createProviderClass","ContractApi_searchSingleContract","contractsMap","widgetContractMap","debugContractMap","addContract","contracts","contract","namespaceId","name","collectContract","collectWidgetContract","clearCollectWidgetContract","collectDebugContract","clearDebugContract","remoteContractCache","isFlowApiProvider","provider","getArgsOfFlowApi","originalArgs","Error","apiDefinition","namespaceName","nameWithVersion","split","version","getContract","namespace","serviceName","endpoint","_contractData$namespa","contractData","contractName","fetchFlowApiDefinitionFromRemote","fetchFlowApiDefinition","FlowApiNotFoundError","apiProfile","api","_contract$response","schema","json","uri","wrapper","getApiProfileFromApiDefinition","apiMethod","isDownload","fileName","shift","prefix","startsWith","restArgs","slice","transformedUri","replace","getTransformedUriAndRestArgs","getApiArgsFromApiProfile","message","super","captureStackTrace","InstanceApi_postSearch","objectId","concat","_x3","InstalledMicroAppApi_getMenusInfo","menuId","symbolAppId","Symbol","symbolMenuI18nNamespace","symbolOverrideApp","mergeMenu","menuList","runtimeContext","helpers","mainMenu","menu","validMenuList","injectWithMenus","menuWithI18n","i18n","menuI18nNamespace","instanceId","lang","resources","addResourceBundle","dynamicItems","itemsResolve","overrideAppId","newRuntimeContext","pendingPermissionsPreCheck","_helpers$getStoryboar","overrideApp","getStoryboardByAppId","appendI18nNamespace","resolved","resolveData","transform","items","loadDynamicMenuItems","_menu$items","injectMenuGroupId","injectingMenus","flatMap","processGroupInject","foundInjectingMenus","groupId","delete","children","injectingMenu","reorderMenu","menuData","reorderMenuItems","sortBy","sort","sortMenuItems","computeMenuData","titleDataSource","every","if","to","isEvaluable","yaml","pipes","hasOwnProperty","asyncComputeRealValue","ignoreSymbols","computeMenuItems","rest","computedRest","computedChildren","InstanceApi_getDetail","_x4","menuTitleCache","fetchMenuTitle","title","cacheKey","cachedTitle","attributeId","attr","instanceData","primary","join","String","menuPromises","menuCache","transformMenuItems","menuItems","checkIfOfComputed","text","childLayout","groupFrom","icon","defaultExpanded","omit","getMenuById","fetchMenuById","_storyboard$meta","_storyboard$meta2","injectMenus","_menu$app","getMenusOfStandaloneApp","flags","menuObjectId","page","page_size","link","defaultCollapsed","defaultCollapsedBreakpoint","$eq","$size","$gt","restMenuData","tplStateStoreId","forEachItem","forEachIndex","forEachSize","rootAppId","computedMenuData","computedMenuItems","finalMenuData","pick","_fetchMenuById","events","timer","transportOptions","maxWaitingTime","maxLoggedEvents","emit","transportData","model","columns","splice","callback","requestUrl","blob","navigator","sendBeacon","requestIdleCallback","requestAnimationFrame","cb","sendOnExit","transport","initialized","pageState","isFirstPageView","stashedApiMetrics","initialize","createTransport","symbolHttpAnalytics","onRequest","config","perfStartTime","round","performance","now","st","time","onResponse","onResponseOrError","onResponseError","hasError","responseOrError","perfEndTime","et","HttpAbortError","uid","traceId","size","status","isHttpResponseError","HttpResponseError","HttpParseError","responseJson","metric","_ver","href","duration","Number","create","startTime","path","pageTitle","renderTime","endTime","pageId","URL","createObjectURL","uuid","substring","lastIndexOf","revokeObjectURL","generateUUID","lt","route","apiCount","maxApiTimeCost","max","reduce","prev","current","finishPageView","dispatchEvent","CustomEvent","detail","freeze","checkPermissions","preCheckPermissions","scanPermissionActionsInStoryboard","preCheckPermissionsForBrickOrRoute","container","permissionsPreCheck","messageDispatcher","sub","unsub","subscribe","unsubscribe","warned","responsePayload","RegExp","_m","p1","p2","escapeRegExp","test","matchMessageChannel","v2Kit","getV2RuntimeFromDll","authV2Factory"],"sourceRoot":""}