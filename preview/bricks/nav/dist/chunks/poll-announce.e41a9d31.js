/*! For license information please see poll-announce.e41a9d31.js.LICENSE.txt */
"use strict";(globalThis.webpackChunk_next_bricks_nav=globalThis.webpackChunk_next_bricks_nav||[]).push([[7352,1369,2052],{6276:(e,t,n)=>{n.d(t,{I:()=>i,K:()=>r,NS:()=>o});let r=function(e){return e.VIEW_DETAILS="VIEW_DETAILS",e.DISMISS="DISMISS",e}({});const o="bricks/nav/poll-announce",i={en:{VIEW_DETAILS:"View details",DISMISS:"Dismiss"},zh:{VIEW_DETAILS:"查看详情",DISMISS:"忽略"}}},8266:(e,t,n)=>{n.r(t),n.d(t,{PollAnnounce:()=>q,PollAnnounceComponent:()=>Z});var r,o=n(4635),i=n(918),a=n(6902),s=n(5536),c=n(6121),l=n(829),u=n(2740),f=n(8769),p=n.n(f),d=n(300),h=n(4295),v=n(5223),m=n(3078),y=(n(6477),n(6181)),g=n(7896),b=n(9896),A=n(8627),w=n(7439),S=n(6276),E=n(6651),I=n(5782);let T,x,M,k,_,C,j,D,P,L,W,N,O;(0,g.initializeReactI18n)(S.NS,S.I);const{defineElement:$,property:V,event:z}=(0,d.createDecorators)(),F=(0,m.unwrapProvider)("basic.show-notification"),R=new Set;let q;var K=new WeakMap,B=new WeakMap,H=new WeakMap,U=new WeakSet,J=new WeakMap,G=new WeakMap,Q=new WeakMap;class X extends h.ReactNextElement{constructor(){super(...arguments),(0,o.A)(this,U),(0,i.A)(this,K,x(this)),(0,i.A)(this,B,(M(this),k(this))),(0,i.A)(this,H,(_(this),C(this))),(0,i.A)(this,J,(P(this),()=>{(0,s.A)(U,this,j).emit()})),(0,i.A)(this,G,L(this)),(0,i.A)(this,Q,(O(this),()=>{(0,s.A)(U,this,W).emit()}))}get pollEnabled(){return(0,l.A)(K,this)}set pollEnabled(e){(0,c.A)(K,this,e)}get realTimeMessage(){return(0,l.A)(B,this)}set realTimeMessage(e){(0,c.A)(B,this,e)}render(){return p().createElement(Z,{pollEnabled:this.pollEnabled,realTimeMessage:this.realTimeMessage,onOpen:(0,l.A)(Q,this),onClose:(0,l.A)(J,this)})}}async function Y(e,t){let{title:n,data:r,instanceId:o}=e;const i=r.replace(/<[^>]+>|&nbsp;/gim,"\r\n").replace(/&ldquo;/gim,"“").replace(/&rdquo;/gim,"”"),a=i.length>100?i.slice(0,100):i;try{await F({placement:"topRight",icon:{lib:"antd",theme:"filled",icon:"sound",style:{color:"var(--theme-orange-color)"}},title:n,htmlMessage:`<div class="${I.A.message}">${a}</div>`,closable:!0,showConfirm:!0,confirmText:y.i18n.t(`${S.NS}:${S.K.VIEW_DETAILS}`),confirmLink:{url:`/announcement-management/announcement-front/content?instanceId=${o}`,target:"_blank"},showCancel:!0,cancelText:y.i18n.t(`${S.NS}:${S.K.DISMISS}`)})}catch{}finally{if(!R.has(o)){R.add(o);try{await(0,b.w)({instanceIds:[o]}),t()}catch(e){console.error("ignore announce failed:",e)}}}}function Z(e){let{pollEnabled:t,realTimeMessage:n,onOpen:r,onClose:o}=e;return(0,f.useEffect)((()=>{(async()=>{const e=(await(0,A.F)({})).list;e.length&&e.filter((e=>e.isPopup)).reverse().forEach((e=>{Y(e,o)}))})()}),[]),(0,f.useEffect)((()=>{!t&&n&&Y(n,o)}),[o,t,n]),(0,f.useEffect)((()=>{if(!t)return;let e=!1;const n=async()=>{if(!e)try{Y(await(0,w.$)({interceptorParams:{ignoreLoadingBar:!0}}),o),r(),n()}catch(e){var t;const r=(0,v.httpErrorToString)(e);null!=r&&null!==(t=r.toLowerCase())&&void 0!==t&&t.includes("timeout")&&n()}};return n(),()=>{e=!0}}),[o,r,t]),null}r=X,({e:[x,M,k,_,C,j,D,P,L,W,N,O],c:[q,T]}=(0,u.A)(r,[$("nav.poll-announce",{styleTexts:[E.A]})],[[V({type:Boolean}),1,"pollEnabled"],[V({attribute:!1}),1,"realTimeMessage"],[z({type:"notification.close"}),1,"closeEvent",e=>(0,l.A)(H,e),(e,t)=>(0,c.A)(H,e,t)],[z({type:"notification.open"}),1,"openEvent",e=>(0,l.A)(G,e),(e,t)=>(0,c.A)(G,e,t)]],0,(e=>Q.has((0,a.A)(e))),h.ReactNextElement)),T()},6651:(e,t,n)=>{n.d(t,{A:()=>s});var r=n(6758),o=n.n(r),i=n(935),a=n.n(i)()(o());a.push([e.id,":host{display:inline-block}:host([hidden]){display:none}",""]);const s=a.toString()},1784:(e,t,n)=>{n.d(t,{A:()=>s});var r=n(6758),o=n.n(r),i=n(935),a=n.n(i)()(o());a.push([e.id,".message--Fxvh9j9V{color:var(--color-normal-text);overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical}",""]),a.locals={message:"message--Fxvh9j9V"};const s=a},935:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",r=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),r&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),r&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,r,o,i){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(r)for(var s=0;s<this.length;s++){var c=this[s][0];null!=c&&(a[c]=!0)}for(var l=0;l<e.length;l++){var u=[].concat(e[l]);r&&a[u[0]]||(void 0!==i&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=i),n&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=n):u[2]=n),o&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=o):u[4]="".concat(o)),t.push(u))}},t}},6758:e=>{e.exports=function(e){return e[1]}},5782:(e,t,n)=>{n.d(t,{A:()=>y});var r=n(2591),o=n.n(r),i=n(1740),a=n.n(i),s=n(8128),c=n.n(s),l=n(855),u=n.n(l),f=n(3051),p=n.n(f),d=n(3656),h=n.n(d),v=n(1784),m={};m.styleTagTransform=h(),m.setAttributes=u(),m.insert=c().bind(null,"head"),m.domAPI=a(),m.insertStyleElement=p(),o()(v.A,m);const y=v.A&&v.A.locals?v.A.locals:void 0},2591:e=>{var t=[];function n(e){for(var n=-1,r=0;r<t.length;r++)if(t[r].identifier===e){n=r;break}return n}function r(e,r){for(var i={},a=[],s=0;s<e.length;s++){var c=e[s],l=r.base?c[0]+r.base:c[0],u=i[l]||0,f="".concat(l," ").concat(u);i[l]=u+1;var p=n(f),d={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==p)t[p].references++,t[p].updater(d);else{var h=o(d,r);r.byIndex=s,t.splice(s,0,{identifier:f,updater:h,references:1})}a.push(f)}return a}function o(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,o){var i=r(e=e||[],o=o||{});return function(e){e=e||[];for(var a=0;a<i.length;a++){var s=n(i[a]);t[s].references--}for(var c=r(e,o),l=0;l<i.length;l++){var u=n(i[l]);0===t[u].references&&(t[u].updater(),t.splice(u,1))}i=c}}},8128:e=>{var t={};e.exports=function(e,n){var r=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},3051:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},855:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},1740:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var o=void 0!==n.layer;o&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,o&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var i=n.sourceMap;i&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),t.styleTagTransform(r,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},3656:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},2740:(e,t,n)=>{n.d(t,{A:()=>s});var r=n(7545),o=n(6902);function i(e,t,n){"symbol"==(0,r.A)(t)&&(t=(t=t.description)?"["+t+"]":"");try{Object.defineProperty(e,"name",{configurable:!0,value:n?n+" "+t:t})}catch(e){}return e}var a=n(1369);function s(e,t,n,s,c,l){var u,f,p,d,h,v,m,y=Symbol.metadata||Symbol.for("Symbol.metadata"),g=Object.defineProperty,b=Object.create,A=[b(null),b(null)],w=t.length;function S(t,n,r){return function(o,i){n&&(i=o,o=e);for(var a=0;a<t.length;a++)i=t[a].apply(o,r?[i]:[]);return r?i:o}}function E(e,t,n,r){if("function"!=typeof e&&(r||void 0!==e))throw new TypeError(t+" must "+(n||"be")+" a function"+(r?"":" or undefined"));return e}function I(e,t,n,o,a,s,c,l,p,d,h){function v(e){if(!h(e))throw new TypeError("Attempted to access private element on non-instance")}var m=[].concat(t[0]),y=t[3],b=!c,w=1===a,I=3===a,T=4===a,x=2===a;function M(t,n,r){return function(o,i){return n&&(i=o,o=e),r&&r(o),k[t].call(o,i)}}if(!b){var k={},_=[],C=I?"get":T||w?"set":"value";if(p?(d||w?k={get:i((function(){return y(this)}),o,"get"),set:function(e){t[4](this,e)}}:k[C]=y,d||i(k[C],o,x?"":C)):d||(k=Object.getOwnPropertyDescriptor(e,o)),!d&&!p){if((f=A[+l][o])&&7!=(f^a))throw Error("Decorating two elements with the same name ("+k[C].name+") is not supported yet");A[+l][o]=a<3?1:a}}for(var j=e,D=m.length-1;D>=0;D-=n?2:1){var P=E(m[D],"A decorator","be",!0),L=n?m[D-1]:void 0,W={},N={kind:["field","accessor","method","getter","setter","class"][a],name:o,metadata:u,addInitializer:function(e,t){if(e.v)throw Error("attempted to call addInitializer after decoration was finished");E(t,"An initializer","be",!0),s.push(t)}.bind(null,W)};if(b)f=P.call(L,j,N),W.v=1,E(f,"class decorators","return")&&(j=f);else if(N.static=l,N.private=p,f=N.access={has:p?h.bind():function(e){return o in e}},T||(f.get=p?x?function(e){return v(e),k.value}:M("get",0,v):function(e){return e[o]}),x||I||(f.set=p?M("set",0,v):function(e,t){e[o]=t}),j=P.call(L,w?{get:k.get,set:k.set}:k[C],N),W.v=1,w){if("object"==(0,r.A)(j)&&j)(f=E(j.get,"accessor.get"))&&(k.get=f),(f=E(j.set,"accessor.set"))&&(k.set=f),(f=E(j.init,"accessor.init"))&&_.unshift(f);else if(void 0!==j)throw new TypeError("accessor decorators must return an object with get, set, or init properties or undefined")}else E(j,(d?"field":"method")+" decorators","return")&&(d?_.unshift(j):k[C]=j)}return a<2&&c.push(S(_,l,1),S(s,l,0)),d||b||(p?w?c.splice(-1,0,M("get",l),M("set",l)):c.push(x?k[C]:E.call.bind(k[C])):g(e,o,k)),j}function T(e){return g(e,y,{configurable:!0,enumerable:!0,value:u})}return void 0!==l&&(u=l[y]),u=b(null==u?null:u),h=[],v=function(e){e&&h.push(S(e))},m=function(t,r){for(var i=0;i<n.length;i++){var s=n[i],l=s[1],u=7&l;if((8&l)==t&&!u==r){var f=s[2],v=!!s[3],m=16&l;I(t?e:e.prototype,s,m,v?"#"+f:(0,a.A)(f),u,u<2?[]:t?d=d||[]:p=p||[],h,!!t,v,r,t&&v?function(t){return(0,o.A)(t)===e}:c)}}},m(8,0),m(0,0),m(8,1),m(0,1),v(p),v(d),f=h,w||T(e),{e:f,get c(){var n=[];return w&&[T(e=I(e,[t],s,e.name,5,n)),S(n,1)]}}}},2559:(e,t,n)=>{function r(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}n.d(t,{A:()=>r})},6902:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(7545);function o(e){if(Object(e)!==e)throw TypeError("right-hand side of 'in' should be an object, got "+(null!==e?(0,r.A)(e):"null"));return e}},2016:(e,t,n)=>{function r(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}n.d(t,{A:()=>r})},829:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(2559);function o(e,t){return e.get((0,r.A)(e,t))}},918:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(2016);function o(e,t,n){(0,r.A)(e,t),t.set(e,n)}},6121:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(2559);function o(e,t,n){return e.set((0,r.A)(e,t),n),n}},5536:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(2559);function o(e,t,n){return n((0,r.A)(e,t))}},4635:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(2016);function o(e,t){(0,r.A)(e,t),t.add(e)}},1369:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(7545);function o(e){var t=function(e,t){if("object"!=(0,r.A)(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!=(0,r.A)(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==(0,r.A)(t)?t:t+""}},7545:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}n.d(t,{A:()=>r})},9896:(e,t,n)=>{n.d(t,{w:()=>o});var r=n(9422);const o=(e,t)=>r.http.post("api/gateway/sys_setting.announce.IgnoreAnnounce/api/sys_setting/v1/announce/ignore",e,t)},8627:(e,t,n)=>{n.d(t,{F:()=>o});var r=n(9422);const o=async(e,t)=>(await r.http.get("api/gateway/sys_setting.announce.ListEffectiveAnnounce/api/sys_setting/v1/announce/effective",{...t,params:e})).data},7439:(e,t,n)=>{n.d(t,{$:()=>o});var r=n(9422);const o=async e=>(await r.http.get("api/gateway/sys_setting.announce.PollAnnounce/api/sys_setting/v1/announce/poll",e)).data}}]);
//# sourceMappingURL=poll-announce.e41a9d31.js.map