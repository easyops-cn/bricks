"use strict";(globalThis.webpackChunk_next_bricks_widget_editors=globalThis.webpackChunk_next_bricks_widget_editors||[]).push([[399],{5399:(e,t,r)=>{r.r(t),r.d(t,{BrickLoadError:()=>k,enqueueStableLoadBricks:()=>p,enqueueStableLoadProcessors:()=>w,flushStableLoadBricks:()=>f,loadBricksImperatively:()=>m,loadEditorsImperatively:()=>v,loadProcessorsImperatively:()=>h,loadScript:()=>o,loadSharedModule:()=>a,loadStyle:()=>i});const s=new Map;function n(e,t,r,o){if(Array.isArray(t))return Promise.all(t.map((t=>n(e,t,r))));const i=r&&!/^https?:/.test(t)?`${r}${t}`:t,a=s.get(i);if(a)return a;const c=new Promise(((t,r)=>{const s=()=>{window.dispatchEvent(new Event("request.end"))},n=document.createElement("style"===e?"link":"script");"script"===e?Object.assign(n,{type:"text/javascript",async:!0,...o,src:i}):Object.assign(n,{rel:"stylesheet",...o,href:i}),n.onload=()=>{t(i),s()},n.onerror=e=>{r(e),s()};const a=document.currentScript||document.getElementsByTagName("script")[0];a.parentNode.insertBefore(n,a),window.dispatchEvent(new Event("request.start"))}));return s.set(i,c),c}function o(e,t,r){return n("script",e,t,r)}function i(e,t,r){return n("style",e,t,r)}async function a(e,t){await r.I("default");const s=window[e];return await s.init(r.S.default),(await s.get(t))()}let c,l,d=!1;const u=new Promise(((e,t)=>{c=e,l=t}));function f(){d||c()}function p(e,t){return S($("bricks",e,t))}function w(e,t){return S($("processors",e,t))}async function m(e,t){const r=$("bricks",e,t);return f(),S(r)}function h(e,t){const r=$("processors",e,t);return f(),S(r)}function v(e,t){const r=$("editors",e,t);return f(),S(r)}class k extends Error{constructor(e){super(e),this.name="BrickLoadError",Error.captureStackTrace&&Error.captureStackTrace(this,k)}}let y;const b="v2-adapter.load-bricks";function g(e,t,r){const s=new Map,n=new Set,o=t=>{var i;if(n.has(t))return;let a,c,l;if(n.add(t),"editors"===e){l=t;for(const e of r.values()){var d;null!==(d=e.propertyEditors??e.editors)&&void 0!==d&&d.some((e=>e===l))&&(a=e)}}else if("processors"===e||t.includes(".")){[c,l]=t.split(".");const s=`bricks/${"processors"===e?(p=c,p.replace(/[A-Z]/g,(e=>`-${e[0].toLocaleLowerCase()}`)).replace(/_[0-9]/g,(e=>`-${e[1]}`))):c}`;a=r.get(s)}else{let e;l=t;for(const s of r.values()){var u;if(null!==(u=s.elements)&&void 0!==u&&u.some((e=>e===l))){var f;if(null===(f=s.deprecatedElements)||void 0===f||!f.includes(t)){a=s;break}e=s}}!a&&e&&(a=e)}var p;if(!a)return void console.error(`Package for ${t} not found.`);let w=s.get(a);w||(w=[],s.set(a,w)),w.push({fullName:t,lastName:l});const m=null===(i=a.dependencies)||void 0===i?void 0:i[t];if(m)for(const e of m)o(e)};for(const e of t)o(e);return s}async function P(e,t,r){const s=`${"processors"===e||"editors"===e?`./${e}/`:"./"}${"editors"===e?r.fullName:r.lastName}`;try{await a(t,s)}catch(t){throw console.error(t),new k(`Load ${e} of "${r.fullName}" failed: ${null==t?void 0:t.message}`)}}function E(e,t,r){return t.map((async t=>(await o(t.filePath,window.PUBLIC_ROOT??""),await u,Promise.all(r.get(t).map((r=>P(e,t.id,r)))))))}async function $(e,t,r){const s=new Map;for(const e of r){const t=e.id||_(e.filePath);s.set(t,e)}const n=g(e,t,s);let i;const a=[],u=[];let f;for(const e of n.keys())if(e.id)"bricks/basic"===e.id?i=e:u.push(e);else if(a.push(e),f=s.get("bricks/v2-adapter"),!f)throw new Error("Using v2 bricks, but v2-adapter not found");const p=f;let w;const m=i;if(m){const t=o(m.filePath,window.PUBLIC_ROOT??"");d||(d=!0,t.then((()=>Promise.resolve())).then(c,l)),w=t.then((()=>Promise.all(n.get(m).map((t=>P(e,m.id,t))))))}const h=[w].concat(E(e,u,n));if(p&&a.length>0){if(!y){const e=g("bricks",[b],s),t=[...e.keys()];y=(async()=>(await Promise.all(E("bricks",t,e)),document.createElement(b)))()}h.push(y.then((t=>Promise.all(a.map((s=>{const o=_(s.filePath).split("/")[1];return t.resolve(p.filePath,"editors"===e?s.propertyEditorsJsFilePath??s.filePath:s.filePath,"bricks"===e?n.get(s).map((e=>`${o}.${e.lastName}`)):[],s.dll,r)}))))))}await Promise.all(h)}async function S(e){window.dispatchEvent(new Event("request.start"));try{await e}finally{window.dispatchEvent(new Event("request.end"))}}function _(e){return e.split("/").slice(0,2).join("/")}}}]);
//# sourceMappingURL=399.d897ee29.js.map