"use strict";(globalThis.webpackChunk_next_bricks_vs=globalThis.webpackChunk_next_bricks_vs||[]).push([[7242],{7242:(e,t,n)=>{var i,s=n(4635),r=n(918),a=n(6902),o=n(5536),l=n(6121),c=n(829),u=n(2740),h=n(8769),d=n.n(h),g=n(300),m=n(3078),p=n(4295),k=n(9592),f=n(426),A=n(2329),y=n(6197),v=n(3909),w=n(2257),b=n(3135),M=n(1732),C=n.n(M),E=(n(6477),n(2445)),x=n(7137),L=n(4929),S=n(4804),N=n(4102),B=n(9287),W=n(5502),_=n(8182),P=n(3373),R=n.n(P),z=(n(3569),n(1968)),O=n(1836),V=n(1865);let I,D,F,H,K,T,Y,q,j,U,J,X,$,G,Q,Z,ee,te,ne,ie,se,re,ae,oe,le,ce,ue,he,de,ge,me,pe,ke,fe,Ae,ye,ve,we,be,Me,Ce,Ee,xe,Le,Se,Ne,Be,We,_e,Pe,Re,ze,Oe,Ve,Ie,De,Fe,He,Ke,Te,Ye;(0,W.initializeReactI18n)(_.NS,_.I),(0,y.kz)(A),(0,v.kz)(A),(0,w.kz)(A,"brick_next_yaml"),(0,b.kz)(A);const{defineElement:qe,property:je,event:Ue}=(0,g.createDecorators)(),Je=(0,p.wrapBrick)("eo-form-item"),Xe=(0,p.wrapBrick)("eo-tooltip"),$e=(0,p.wrapBrick)("eo-icon"),Ge=(0,m.unwrapProvider)("basic.copy-to-clipboard"),Qe=(0,m.unwrapProvider)("basic.show-notification");let Ze;var et=new WeakMap,tt=new WeakMap,nt=new WeakMap,it=new WeakMap,st=new WeakMap,rt=new WeakMap,at=new WeakMap,ot=new WeakMap,lt=new WeakMap,ct=new WeakMap,ut=new WeakMap,ht=new WeakMap,dt=new WeakMap,gt=new WeakMap,mt=new WeakMap,pt=new WeakMap,kt=new WeakMap,ft=new WeakMap,At=new WeakMap,yt=new WeakMap,vt=new WeakMap,wt=new WeakMap,bt=new WeakMap,Mt=new WeakMap,Ct=new WeakMap,Et=new WeakSet,xt=new WeakMap,Lt=new WeakMap,St=new WeakMap,Nt=new WeakMap,Bt=new WeakMap,Wt=new WeakMap;class _t extends f.N{constructor(){super(...arguments),(0,s.A)(this,Et),(0,r.A)(this,et,D(this)),(0,r.A)(this,tt,(F(this),H(this))),(0,r.A)(this,nt,(K(this),T(this))),(0,r.A)(this,it,(Y(this),q(this))),(0,r.A)(this,st,(j(this),U(this))),(0,r.A)(this,rt,(J(this),X(this))),(0,r.A)(this,at,($(this),G(this))),(0,r.A)(this,ot,(Q(this),Z(this))),(0,r.A)(this,lt,(ee(this),te(this))),(0,r.A)(this,ct,(ne(this),ie(this))),(0,r.A)(this,ut,(se(this),re(this))),(0,r.A)(this,ht,(ae(this),oe(this))),(0,r.A)(this,dt,(le(this),ce(this))),(0,r.A)(this,gt,(ue(this),he(this))),(0,r.A)(this,mt,(de(this),ge(this))),(0,r.A)(this,pt,(me(this),pe(this))),(0,r.A)(this,kt,(ke(this),fe(this))),(0,r.A)(this,ft,(Ae(this),ye(this))),(0,r.A)(this,At,(ve(this),we(this))),(0,r.A)(this,yt,(be(this),Me(this))),(0,r.A)(this,vt,(Ce(this),Ee(this))),(0,r.A)(this,wt,(xe(this),Le(this))),(0,r.A)(this,bt,(Se(this),Ne(this))),(0,r.A)(this,Mt,(Be(this),We(this))),(0,r.A)(this,Ct,(_e(this),Pe(this))),(0,r.A)(this,xt,(Oe(this),Ve(this))),(0,r.A)(this,Lt,(Fe(this),e=>{var t;this.value=e,null===(t=this.getFormElement())||void 0===t||t.formStore.onChange(this.name,e),(0,o.A)(Et,this,Re).emit(e)})),(0,r.A)(this,St,(e=>{(0,o.A)(Et,this,Ie).emit(e)})),(0,r.A)(this,Nt,He(this)),(0,r.A)(this,Bt,(Ye(this),e=>{(0,o.A)(Et,this,Ke).emit(e)})),(0,r.A)(this,Wt,(e=>{if("brick_next_yaml"===this.language||"yaml"===this.language)try{C().load(e)}catch{return"请填写正确的格式"}return""}))}get name(){return(0,c.A)(et,this)}set name(e){(0,l.A)(et,this,e)}get label(){return(0,c.A)(tt,this)}set label(e){(0,l.A)(tt,this,e)}get value(){return(0,c.A)(nt,this)}set value(e){(0,l.A)(nt,this,e)}get language(){return(0,c.A)(it,this)}set language(e){(0,l.A)(it,this,e)}get theme(){return(0,c.A)(st,this)}set theme(e){(0,l.A)(st,this,e)}get required(){return(0,c.A)(rt,this)}set required(e){(0,l.A)(rt,this,e)}get readOnly(){return(0,c.A)(at,this)}set readOnly(e){(0,l.A)(at,this,e)}get automaticLayout(){return(0,c.A)(ot,this)}set automaticLayout(e){(0,l.A)(ot,this,e)}get minLines(){return(0,c.A)(lt,this)}set minLines(e){(0,l.A)(lt,this,e)}get completers(){return(0,c.A)(ct,this)}set completers(e){(0,l.A)(ct,this,e)}get advancedCompleters(){return(0,c.A)(ut,this)}set advancedCompleters(e){(0,l.A)(ut,this,e)}get markers(){return(0,c.A)(ht,this)}set markers(e){(0,l.A)(ht,this,e)}get links(){return(0,c.A)(dt,this)}set links(e){(0,l.A)(dt,this,e)}get maxLines(){return(0,c.A)(gt,this)}set maxLines(e){(0,l.A)(gt,this,e)}get height(){return(0,c.A)(mt,this)}set height(e){(0,l.A)(mt,this,e)}get message(){return(0,c.A)(pt,this)}set message(e){(0,l.A)(pt,this,e)}get placeholder(){return(0,c.A)(kt,this)}set placeholder(e){(0,l.A)(kt,this,e)}get showExpandButton(){return(0,c.A)(ft,this)}set showExpandButton(e){(0,l.A)(ft,this,e)}get lineNumbers(){return(0,c.A)(At,this)}set lineNumbers(e){(0,l.A)(At,this,e)}get tokenConfig(){return(0,c.A)(yt,this)}set tokenConfig(e){(0,l.A)(yt,this,e)}get customValidationInBrickNextYaml(){return(0,c.A)(vt,this)}set customValidationInBrickNextYaml(e){(0,l.A)(vt,this,e)}get showCopyButton(){return(0,c.A)(wt,this)}set showCopyButton(e){(0,l.A)(wt,this,e)}get glyphMargin(){return(0,c.A)(bt,this)}set glyphMargin(e){(0,l.A)(bt,this,e)}get extraLibs(){return(0,c.A)(Mt,this)}set extraLibs(e){(0,l.A)(Mt,this,e)}connectedCallback(){this.style.display||(this.style.display="block"),super.connectedCallback()}render(){return d().createElement(Je,{exportparts:"message",curElement:this,formElement:this.getFormElement(),name:this.name,label:this.label,required:this.required,helpBrick:this.helpBrick,labelBrick:this.labelBrick,notRender:this.notRender,validator:(0,c.A)(Wt,this)},d().createElement(Pt,{value:this.value,language:this.language,readOnly:this.readOnly,theme:this.theme,automaticLayout:this.automaticLayout,minLines:this.minLines,maxLines:this.maxLines,height:this.height,completers:this.completers,advancedCompleters:this.advancedCompleters,extraLibs:this.extraLibs,markers:this.markers,links:this.links,tokenConfig:this.tokenConfig,lineNumbers:this.lineNumbers,glyphMargin:this.glyphMargin,placeholder:this.placeholder,showCopyButton:this.showCopyButton,showExpandButton:this.showExpandButton,validateState:this.validateState,onChange:(0,c.A)(Lt,this),onUserInput:(0,c.A)(St,this),onTokenClick:(0,c.A)(Bt,this),customValidationInBrickNextYaml:this.customValidationInBrickNextYaml}))}}function Pt(e){let{value:t,language:n,theme:i,minLines:s,maxLines:r,height:a,automaticLayout:o,completers:l,advancedCompleters:c,markers:u,readOnly:g,links:m,extraLibs:p,tokenConfig:f={showDSKey:!1},showExpandButton:y,showCopyButton:v=!0,lineNumbers:w="on",glyphMargin:b=!1,placeholder:M,validateState:C,onChange:P,onTokenClick:I,customValidationInBrickNextYaml:D}=e;const F=t??"",H=n??"plaintext",K=i??"auto",T=s??3,Y=r??1/0,q=a??500,[j,U]=(0,h.useState)(!1),J=(0,h.useMemo)((()=>(0,E.uniqueId)("worker")),[]),{t:X}=(0,W.useTranslation)(_.NS),$=(0,h.useRef)(null),G=(0,h.useRef)(),Q=(0,h.useRef)(),Z=(0,h.useRef)({width:300,height:Rt(F,T,Y)}),[ee,te]=(0,h.useState)(),ne=(0,h.useRef)(o),ie=(0,k.useCurrentTheme)();(0,h.useEffect)((()=>{const e="auto"===K?"dark"===ie||"dark-v2"===ie?"vs-dark":"vs":K,t=e.includes("dark")?"#FFFFFF0F":"#0000000A";A.editor.defineTheme("custom-theme",{base:e,inherit:!0,rules:[],colors:{"editor.lineHighlightBackground":`${t}`}}),A.editor.setTheme("custom-theme")}),[ie,K]),(0,h.useEffect)((()=>{if(Q.current){const e=Q.current.getModel();A.editor.setModelLanguage(e,H)}}),[H]),(0,h.useEffect)((()=>{if("brick_next_yaml"===H){const e=(0,L.v)(l,c,J,f),t=A.languages.registerCompletionItemProvider("brick_next_yaml",{provideCompletionItems:e,triggerCharacters:[".",":","<"]});return()=>{t.dispose()}}}),[l,c,H]),(0,h.useEffect)((()=>{const e=Q.current;if(e){const t=e.getModel();null!=t&&t.getValue&&F!==t.getValue()&&t.setValue(F)}}),[F]),(0,h.useLayoutEffect)((()=>{var e;if("fit-content"!==ne.current||!$.current)return;Z.current.width=$.current.getBoundingClientRect().width,null===(e=Q.current)||void 0===e||e.layout(Z.current);const t=new ResizeObserver((e=>{for(const n of e)if(n.target===$.current){const e=n.contentBoxSize?n.contentBoxSize[0].inlineSize:n.contentRect.width,i=n.contentBoxSize?n.contentBoxSize[0].blockSize:n.contentRect.height;var t;(e!==Z.current.width||j)&&(Z.current.width=e,null===(t=Q.current)||void 0===t||t.layout({width:e,height:j?i:Z.current.height}));break}}));return t.observe($.current),()=>{t.disconnect()}}),[j]),(0,h.useLayoutEffect)((()=>{if("fit-container"!==ne.current)return;const e=function(e){let t=e;for(;t;){const e="vs.code-editor"===t.tagName.toLowerCase();if(t=t.parentElement,e)return t}}($.current);if(!e)return;const t=new ResizeObserver((()=>{te(e.offsetHeight)}));return t.observe(e),()=>{t.disconnect()}}),[]),(0,h.useEffect)((()=>{"fit-container"!==ne.current&&"fit-content"!==ne.current&&te(q)}),[q]),(0,h.useEffect)((()=>{Q.current&&Q.current.updateOptions({readOnly:g})}),[g]),(0,h.useEffect)((()=>{if(Q.current||!$.current)return;const e=A.editor.createModel(F,H);if("brick_next_yaml"===H){const t=(0,N.AR)(e.uri);A.editor.createModel(F,"javascript",t),A.languages.typescript.javascriptDefaults.addExtraLib((0,N.Eh)(),e.uri.toString()+"d.ts")}Q.current=A.editor.create($.current,{model:e,minimap:{enabled:!1,showRegionSectionHeaders:!1,showMarkSectionHeaders:!1},scrollBeyondLastLine:!1,tabSize:2,insertSpaces:!0,automaticLayout:"fit-content"!==ne.current,fontSize:x.yU,lineHeight:x.fE,scrollbar:{horizontalScrollbarSize:x.lP,verticalScrollbarSize:x.lP,horizontalSliderSize:8,verticalSliderSize:8,alwaysConsumeMouseWheel:!1},padding:{top:x.Vu,bottom:"fit-content"==ne.current?void 0:x.Vu},overviewRulerBorder:!1,mouseWheelScrollSensitivity:.5,fixedOverflowWidgets:!0,lineNumbers:w,lineNumbersMinChars:3,glyphMargin:b,folding:"off"!==w,suggest:{insertMode:"insert",preview:!0},readOnly:g,quickSuggestions:{strings:!0,other:!0,comments:!0},renderLineHighlightOnlyWhenFocus:!0,unicodeHighlight:{ambiguousCharacters:!1}}),G.current=Q.current.createDecorationsCollection()}),[]),(0,h.useEffect)((()=>{const e=p??[],t="typescript"===H?"typescriptDefaults":"javascriptDefaults",n=(0,B.m)(e,{languageDefaults:t});return()=>{for(const e of n)e.dispose()}}),[p,H]),(0,h.useEffect)((()=>{const e=Q.current;if("brick_next_yaml"===H&&e){const t=e.getModel(),n=e.onMouseDown((function(e){var n;const i=G.current;((null==i||null===(n=i.getRanges)||void 0===n?void 0:n.call(i))??[]).forEach((n=>{const i=/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"metaKey":"ctrlKey";n&&e.target.position&&e.event[i]&&n.containsPosition(e.target.position)&&I(t.getValueInRange(n))}))})),i=e.onMouseMove((function(e){const t=G.current;t&&t.getRanges().forEach((n=>{const i=/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"metaKey":"ctrlKey";if(n&&e.target.position&&e.event[i]&&n.containsPosition(e.target.position)){const e=t.getRanges().map((e=>({range:e,options:{inlineClassName:n.equalsRange(e)?"highlight pointer":"highlight"}})));t.set(e)}else if(!e.event[i]){const e=t.getRanges().map((e=>({range:e,options:{inlineClassName:"highlight"}})));t.set(e)}}))}));return()=>{null==i||i.dispose(),null==n||n.dispose()}}}),[H,I,ie,K]),(0,h.useEffect)((()=>{const e=Q.current;if(!e||!$.current||"fit-content"!==ne.current)return;const t=e.onDidContentSizeChange((t=>{if(!j&&t.contentHeightChanged){const n=zt(t.contentHeight,T,Y);n!==Z.current.height&&(Z.current.height=n,e.layout(Z.current))}})),n=zt(e.getContentHeight(),T,Y);return n!==Z.current.height&&(Z.current.height=n,e.layout(Z.current)),()=>{t.dispose()}}),[Y,T,j]);const se=(0,h.useCallback)((async(e,t)=>{A.editor.setModelMarkers(e,"semantic_validate",[]);const n=e.findPreviousMatch("<%[~=]?",t,!0,!1,null,!1),i=e.findNextMatch("%>",t,!1,!1,null,!1),s=null==n?void 0:n.range,r=null==i?void 0:i.range;if(s&&r){const n=new A.Range(s.startLineNumber,s.endColumn,r.startLineNumber,r.startColumn),i=e.getValueInRange(n);if(n.containsPosition(t)&&!/<% | %>/.test(i)){const t=(0,N.AR)(e.uri);A.editor.getModel(t).setValue(i);const r=e.getOffsetAt(new A.Position(s.startLineNumber,s.endColumn));if(z.b.getInstance(J).updateState({content:i,range:n,offset:r}),!D)return;const a=await A.languages.typescript.getJavaScriptWorker(),o=await a(t),l=(await o.getSemanticDiagnostics(t.toString())).map((t=>{const n=r+(t.start??0),i=e.getPositionAt(n);return{startLineNumber:i.lineNumber,startColumn:i.column,endLineNumber:i.lineNumber,endColumn:i.column+t.length,message:t.messageText,severity:A.MarkerSeverity.Warning}}));A.editor.setModelMarkers(e,"semantic_validate",l)}}}),[J]);(0,h.useEffect)((()=>{if(!Q.current)return;const e=Q.current.getModel(),t=e.onDidChangeContent((async t=>{(0,S.J)(J),["brick_next_yaml"].includes(H)&&se(e,Q.current.getPosition()),t.isFlush||P(e.getValue())}));return()=>{t.dispose()}}),[P,J,H,se]),(0,h.useEffect)((()=>{if(j){const e=t=>{"Escape"!==t.key&&"Esc"!==t.key||(window.removeEventListener("keydown",e),U(!1))};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}}}),[j]),(0,h.useEffect)((()=>()=>{var e,t;null===(e=Q.current)||void 0===e||null===(e=e.getModel())||void 0===e||e.dispose(),null===(t=Q.current)||void 0===t||t.dispose()}),[]),(0,h.useEffect)((()=>{if(!Q.current&&!M)return;const e=new O.j(M,Q.current);return()=>{e.dispose()}}),[M]);const re=(0,h.useCallback)((()=>{if(Q.current){const e=Q.current.getModel();Ge(e.getValue()).then((()=>Qe({type:"success",message:X(_.K.COPY_SUCCESS)}))).catch((()=>Qe({type:"error",message:X(_.K.COPY_FAILED)})))}}),[X]),ae=(0,h.useCallback)((()=>{U(!j)}),[j]);return(0,h.useEffect)((()=>{const e=Q.current;if(e&&"brick_next_yaml"===H){const t=(0,V.e)(),n=()=>{const n=e.getValue();t.postMessage({id:J,source:n,links:m,markers:u})},i=(0,E.debounce)(n,200),s=t=>{var n;const{id:i,lintMarkers:s,lintDecorations:r}=t.data;if(i!==J)return;const a=e.getModel();a&&(A.editor.setModelMarkers(a,"brick_next_yaml_lint",s.map((e=>{let{start:t,end:n,message:i,severity:s,code:r}=e;const o=a.getPositionAt(t),l=a.getPositionAt(n);return{startLineNumber:o.lineNumber,startColumn:o.column,endLineNumber:l.lineNumber,endColumn:l.column,severity:A.MarkerSeverity[s],message:i,code:r}}))),null===(n=G.current)||void 0===n||n.set(r.map((e=>{let{start:t,end:n,options:i}=e;return{range:A.Range.fromPositions(a.getPositionAt(t),a.getPositionAt(n)),options:i}}))))};t.addEventListener("message",s);const r=e.onDidChangeModelContent(i);return i(),()=>{r.dispose(),A.editor.setModelMarkers(e.getModel(),"brick_next_yaml_lint",[]),t.removeEventListener("message",s)}}}),[H,m,u,K,J]),d().createElement("div",{className:R()("code-editor-wrapper",{expanded:j,error:"error"===C})},d().createElement("div",{ref:$,style:{height:j?"100%":ee,overflow:j?"scroll":""}}),d().createElement("div",{className:"toolbar"},v&&d().createElement(Xe,{content:X(_.K.COPY)},d().createElement($e,{className:"copy-icon",icon:"copy",lib:"antd",theme:"outlined",onClick:re})),y&&d().createElement(Xe,{content:X(j?_.K.COLLAPSE:_.K.EXPAND)},d().createElement($e,{className:"expand-icon",icon:j?"compress":"expand",lib:"antd",theme:"outlined",onClick:ae}))))}function Rt(e,t,n){return Ot(Math.min(n,Math.max(t,e.split("\n").length)))}function zt(e,t,n){let i=e;return(e-x.Vu)%x.fE==0&&(i=e+x.lP),Math.min(Ot(n),Math.max(i,Ot(t)))}function Ot(e){return e*x.fE+x.lP+x.Vu}i=_t,({e:[D,F,H,K,T,Y,q,j,U,J,X,$,G,Q,Z,ee,te,ne,ie,se,re,ae,oe,le,ce,ue,he,de,ge,me,pe,ke,fe,Ae,ye,ve,we,be,Me,Ce,Ee,xe,Le,Se,Ne,Be,We,_e,Pe,Re,ze,Oe,Ve,Ie,De,Fe,He,Ke,Te,Ye],c:[Ze,I]}=(0,u.A)(i,[qe("vs.code-editor",{shadowOptions:!1})],[[je(),1,"name"],[je(),1,"label"],[je(),1,"value"],[je(),1,"language"],[je(),1,"theme"],[je({type:Boolean}),1,"required"],[je({type:Boolean}),1,"readOnly"],[je(),1,"automaticLayout"],[je({type:Number}),1,"minLines"],[je({attribute:!1}),1,"completers"],[je({attribute:!1}),1,"advancedCompleters"],[je({attribute:!1}),1,"markers"],[je({attribute:!1}),1,"links"],[je({type:Number}),1,"maxLines"],[je({attribute:!1}),1,"height"],[je(),1,"message"],[je(),1,"placeholder"],[je({type:Boolean}),1,"showExpandButton"],[je(),1,"lineNumbers"],[je({attribute:!1}),1,"tokenConfig"],[je({type:Boolean}),1,"customValidationInBrickNextYaml"],[je({type:Boolean}),1,"showCopyButton"],[je({type:Boolean}),1,"glyphMargin"],[je({attribute:!1}),1,"extraLibs"],[Ue({type:"code.change"}),1,"codeChange",e=>(0,c.A)(Ct,e),(e,t)=>(0,l.A)(Ct,e,t)],[Ue({type:"user.input"}),1,"userInput",e=>(0,c.A)(xt,e),(e,t)=>(0,l.A)(xt,e,t)],[Ue({type:"token.click"}),1,"tokenClickEvent",e=>(0,c.A)(Nt,e),(e,t)=>(0,l.A)(Nt,e,t)]],0,(e=>Wt.has((0,a.A)(e))),f.N)),I()}}]);
//# sourceMappingURL=7242.12376140.js.map