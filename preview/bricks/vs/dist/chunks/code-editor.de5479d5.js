"use strict";(self.webpackChunk_next_bricks_vs=self.webpackChunk_next_bricks_vs||[]).push([[1085],{28962:(e,t,r)=>{r.r(t),r.d(t,{CodeEditor:()=>ye,CodeEditorComponent:()=>at});var n,i,a,s,l,u,o,h,c,d,m,v,g,p,f,b,Z,k,w,y,C,M,L,E,N,S,x,W,z,_,R,O,P,B,q,H,I,D,V,j,K,T,F,G,U,A,J,Q,X=r(33028),Y=r(53395),$=r(31815),ee=r(40381),te=r(70687),re=r(72604),ne=r(48657),ie=r.n(ne),ae=r(55366),se=r(44511),le=r(21436),ue=r(25576),oe=r(67411),he=r(73701),ce=r(47637),de=r(64167),me=r(27680),ve=r(42308),ge=r.n(ve),pe=r(16123),fe=(r(88161),r(78035)),be=r(83047),Ze=r(80660),ke=(r(53154),r(55637)),we=r(5777);(0,he.z2)(oe),(0,ce.z2)(oe),(0,de.z2)(oe,"brick_next_yaml"),(0,me.z2)(oe);var ye,{defineElement:Ce,property:Me,event:Le}=(0,ae.createDecorators)(),Ee=(0,se.wrapBrick)("eo-form-item");i=Ce("vs.code-editor",{shadowOptions:!1}),a=Me(),l=Me(),o=Me({attribute:!1}),c=Me(),m=Me(),g=Me({type:Boolean}),f=Me({type:Boolean}),Z=Me(),w=Me({type:Number}),C=Me({attribute:!1}),L=Me({attribute:!1}),N=Me({attribute:!1}),x=Me({attribute:!1}),z=Me({type:Number}),R=Me({attribute:!1}),P=Me(),q=Le({type:"code.change"}),V=Le({type:"user.input"}),F=Le({type:"token.click"});var Ne=new WeakMap,Se=new WeakMap,xe=new WeakMap,We=new WeakMap,ze=new WeakMap,_e=new WeakMap,Re=new WeakMap,Oe=new WeakMap,Pe=new WeakMap,Be=new WeakMap,qe=new WeakMap,He=new WeakMap,Ie=new WeakMap,De=new WeakMap,Ve=new WeakMap,je=new WeakMap,Ke=new WeakMap,Te=new WeakMap,Fe=new WeakMap,Ge=new WeakMap,Ue=new WeakMap,Ae=new WeakMap,Je=new WeakMap,Qe=new WeakMap,Xe=new WeakMap;class Ye extends ue.G{constructor(){super(...arguments),(0,Y.Z)(this,Je,{get:it,set:nt}),(0,Y.Z)(this,Ge,{get:rt,set:tt}),(0,Y.Z)(this,Te,{get:et,set:$e}),(0,Y.Z)(this,Ne,{writable:!0,value:(J(this),s(this))}),(0,Y.Z)(this,Se,{writable:!0,value:u(this)}),(0,Y.Z)(this,xe,{writable:!0,value:h(this)}),(0,Y.Z)(this,We,{writable:!0,value:d(this)}),(0,Y.Z)(this,ze,{writable:!0,value:v(this)}),(0,Y.Z)(this,_e,{writable:!0,value:p(this)}),(0,Y.Z)(this,Re,{writable:!0,value:b(this)}),(0,Y.Z)(this,Oe,{writable:!0,value:k(this)}),(0,Y.Z)(this,Pe,{writable:!0,value:y(this)}),(0,Y.Z)(this,Be,{writable:!0,value:M(this)}),(0,Y.Z)(this,qe,{writable:!0,value:E(this)}),(0,Y.Z)(this,He,{writable:!0,value:S(this)}),(0,Y.Z)(this,Ie,{writable:!0,value:W(this)}),(0,Y.Z)(this,De,{writable:!0,value:_(this)}),(0,Y.Z)(this,Ve,{writable:!0,value:O(this)}),(0,Y.Z)(this,je,{writable:!0,value:B(this)}),(0,Y.Z)(this,Ke,{writable:!0,value:H(this)}),(0,Y.Z)(this,Fe,{writable:!0,value:j(this)}),(0,Y.Z)(this,Ue,{writable:!0,value:(e,t,r)=>{var n;null===(n=this.getFormElement())||void 0===n||n.formStore.onChange(this.name,e),(0,te.Z)(this,Te).emit(t),r||(0,te.Z)(this,Ge).emit(t)}}),(0,Y.Z)(this,Ae,{writable:!0,value:G(this)}),(0,Y.Z)(this,Qe,{writable:!0,value:e=>{(0,te.Z)(this,Je).emit(e)}}),(0,Y.Z)(this,Xe,{writable:!0,value:e=>{try{ge().load(e)}catch(e){return"请填写正确的格式"}return""}})}get name(){return(0,te.Z)(this,Ne)}set name(e){(0,ee.Z)(this,Ne,e)}get label(){return(0,te.Z)(this,Se)}set label(e){(0,ee.Z)(this,Se,e)}get value(){return(0,te.Z)(this,xe)}set value(e){(0,ee.Z)(this,xe,e)}get language(){return(0,te.Z)(this,We)}set language(e){(0,ee.Z)(this,We,e)}get theme(){return(0,te.Z)(this,ze)}set theme(e){(0,ee.Z)(this,ze,e)}get required(){return(0,te.Z)(this,_e)}set required(e){(0,ee.Z)(this,_e,e)}get readOnly(){return(0,te.Z)(this,Re)}set readOnly(e){(0,ee.Z)(this,Re,e)}get automaticLayout(){return(0,te.Z)(this,Oe)}set automaticLayout(e){(0,ee.Z)(this,Oe,e)}get minLines(){return(0,te.Z)(this,Pe)}set minLines(e){(0,ee.Z)(this,Pe,e)}get completers(){return(0,te.Z)(this,Be)}set completers(e){(0,ee.Z)(this,Be,e)}get advancedCompleters(){return(0,te.Z)(this,qe)}set advancedCompleters(e){(0,ee.Z)(this,qe,e)}get markers(){return(0,te.Z)(this,He)}set markers(e){(0,ee.Z)(this,He,e)}get links(){return(0,te.Z)(this,Ie)}set links(e){(0,ee.Z)(this,Ie,e)}get maxLines(){return(0,te.Z)(this,De)}set maxLines(e){(0,ee.Z)(this,De,e)}get height(){return(0,te.Z)(this,Ve)}set height(e){(0,ee.Z)(this,Ve,e)}get message(){return(0,te.Z)(this,je)}set message(e){(0,ee.Z)(this,je,e)}connectedCallback(){this.style.display||(this.style.display="block"),super.connectedCallback()}render(){return ie().createElement(Ee,{curElement:this,formElement:this.getFormElement(),name:this.name,label:this.label,required:this.required,validator:(0,te.Z)(this,Xe)},ie().createElement(at,{value:this.value,language:this.language,readOnly:this.readOnly,theme:this.theme,automaticLayout:this.automaticLayout,minLines:this.minLines,maxLines:this.maxLines,height:this.height,completers:this.completers,advancedCompleters:this.advancedCompleters,markers:this.markers,links:this.links,validateState:this.validateState,onChange:(0,te.Z)(this,Ue),onHighlightClick:(0,te.Z)(this,Qe)}))}}function $e(e){D(this,e)}function et(){return I(this)}function tt(e){T(this,e)}function rt(){return K(this)}function nt(e){A(this,e)}function it(){return U(this)}function at(e){var{value:t,language:r,theme:n,minLines:i,maxLines:a,height:s,automaticLayout:l,completers:u,advancedCompleters:o,markers:h,readOnly:c,links:d,validateState:m,onChange:v,onHighlightClick:g}=e,p=null!=t?t:"",f=null!=r?r:"plaintext",b=null!=n?n:"auto",Z=null!=i?i:3,k=null!=a?a:1/0,w=null!=s?s:500,y=(0,ne.useRef)(null),C=(0,ne.useRef)(),M=(0,ne.useRef)(),L=(0,ne.useRef)({width:300,height:st(p,Z,k)}),[E,N]=(0,ne.useState)(),S=(0,ne.useRef)(l),x=(0,le.useCurrentTheme)();(0,ne.useEffect)((()=>{oe.editor.setTheme("auto"===b?"dark"===x||"dark-v2"===x?"vs-dark":"vs":b)}),[x,b]),(0,ne.useEffect)((()=>{if(M.current){var e=M.current.getModel();oe.editor.setModelLanguage(e,f),(0,fe.isEqual)(e.getValue(),p)||e.setValue(p)}}),[p,f]),(0,ne.useEffect)((()=>{if("brick_next_yaml"===f){var e=(0,Ze.Z)(u,o),t=oe.languages.registerCompletionItemProvider("brick_next_yaml",{provideCompletionItems:e,triggerCharacters:[".",":","<"]});return()=>{t.dispose()}}}),[u,o,f]);var W=(0,ne.useCallback)((()=>{var e=new pe.Z,t=void 0;if(M.current){var r=M.current.getModel();try{if(t=ge().load(p,{listener:e.listen()}),(d||h)&&M.current){var n,i=[];if(e.getTokens().forEach((e=>{var{startLineNumber:t,endLineNumber:r,startColumn:n}=e,a=[],s=(0,we.preevaluate)(e.source,{hooks:{beforeVisit(e){"MemberExpression"===e.type&&"Identifier"===e.object.type&&ke.fT.includes(e.object.name)&&"Identifier"===e.property.type&&a.push(e)}}});a.forEach((a=>{var{start:l,end:u,loc:o}=a;if(e.startLineNumber!==e.endLineNumber){var h,c,d,m,v,g=/<%[ ]+/.test(s.prefix);i.push({token:null===(h=a.object)||void 0===h?void 0:h.name,property:a.property.name,startLineNumber:e.startLineNumber+(null==o||null===(c=o.start)||void 0===c?void 0:c.line)-Number(g),endLineNumber:e.startLineNumber+(null==o||null===(d=o.end)||void 0===d?void 0:d.line)-Number(g),startColumn:(g&&1===(null==o?void 0:o.start.line)?s.prefix.length:0)+(null==o||null===(m=o.start)||void 0===m?void 0:m.column)+1,endColumn:(g&&1===(null==o?void 0:o.start.line)?s.prefix.length:0)+(null==o||null===(v=o.end)||void 0===v?void 0:v.column)+1})}else{var p,f,b;i.push({token:null===(p=a.object)||void 0===p?void 0:p.name,property:a.property.name,startLineNumber:t,endLineNumber:r,startColumn:n+l+(null===(f=s.prefix)||void 0===f?void 0:f.length)+Number(!e.isString),endColumn:n+u+(null===(b=s.prefix)||void 0===b?void 0:b.length)+Number(!e.isString)})}}))})),null===(n=C.current)||void 0===n||n.set(i.filter((e=>null==d?void 0:d.includes(e.token))).map((e=>({range:new oe.Range(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn),options:{inlineClassName:"highlight"}})))),h){var a=i.map((e=>{var t,r,n=h.find((t=>t.token===e.token));return null==n||!n.params||(null===(t=n.params)||void 0===t?void 0:t.includes(e.property))?n&&n.message?(0,X.Z)((0,X.Z)({severity:ke.aC[null!==(r=null==n?void 0:n.level)&&void 0!==r?r:"warn"],message:n.message},n.code?{code:{value:n.code.value,target:oe.Uri.parse(n.code.target)}}:{}),{},{startLineNumber:e.startLineNumber,endLineNumber:e.endLineNumber,startColumn:e.startColumn,endColumn:e.endColumn}):void 0:{severity:ke.aC.warn,message:"Miss Property",startLineNumber:e.startLineNumber,endLineNumber:e.endLineNumber,startColumn:e.startColumn,endColumn:e.endColumn}})).filter(Boolean);oe.editor.setModelMarkers(r,"brick_next_yaml",a)}}}catch(e){var s;oe.editor.setModelMarkers(r,"brick_next_yaml",[]),null==C||null===(s=C.current)||void 0===s||s.set([])}}return t}),[p,d,h]);return(0,ne.useLayoutEffect)((()=>{var e;if("fit-content"===S.current&&y.current){L.current.width=y.current.getBoundingClientRect().width,null===(e=M.current)||void 0===e||e.layout(L.current);var t=new ResizeObserver((e=>{for(var t of e)if(t.target===y.current){var r,n=t.contentBoxSize?t.contentBoxSize[0].inlineSize:t.contentRect.width;n!==L.current.width&&(L.current.width=n,null===(r=M.current)||void 0===r||r.layout(L.current));break}}));return t.observe(y.current),()=>{t.disconnect()}}}),[]),(0,ne.useLayoutEffect)((()=>{if("fit-container"===S.current){var e=function(e){for(var t=e;t;){var r="vs.code-editor"===t.tagName.toLowerCase();if(t=t.parentElement,r)return t}}(y.current);if(e){var t=new ResizeObserver((()=>{N(e.offsetHeight)}));return t.observe(e),()=>{t.disconnect()}}}}),[]),(0,ne.useEffect)((()=>{"fit-container"!==S.current&&"fit-content"!==S.current&&N(w)}),[w]),(0,ne.useEffect)((()=>{M.current&&M.current.updateOptions({readOnly:c})}),[c]),(0,ne.useEffect)((()=>{if(!M.current&&y.current){var e=oe.editor.createModel(p,f);M.current=oe.editor.create(y.current,{model:e,minimap:{enabled:!1},scrollBeyondLastLine:!1,tabSize:2,insertSpaces:!0,automaticLayout:"fit-content"!==S.current,fontSize:be.P0,lineHeight:be.Mv,scrollbar:{horizontalScrollbarSize:be.sE,verticalScrollbarSize:be.sE,horizontalSliderSize:8,verticalSliderSize:8,alwaysConsumeMouseWheel:!1},padding:{top:be.LS,bottom:"fit-content"==S.current?void 0:be.LS},overviewRulerBorder:!1,mouseWheelScrollSensitivity:.5,suggest:{insertMode:"insert",preview:!0},readOnly:c,quickSuggestions:{strings:!0,other:!0,comments:!0}}),C.current=M.current.createDecorationsCollection()}}),[p,f,c]),(0,ne.useEffect)((()=>{var e=M.current;if("brick_next_yaml"===f&&e){var t=e.getModel(),r=e.onMouseDown((function(e){var r,n,i=C.current;(null!==(r=null==i||null===(n=i.getRanges)||void 0===n?void 0:n.call(i))&&void 0!==r?r:[]).forEach((r=>{var n=/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"metaKey":"ctrlKey";r&&e.target.position&&e.event[n]&&r.containsPosition(e.target.position)&&g(t.getValueInRange(r))}))})),n=e.onMouseMove((function(e){var t=C.current;t&&t.getRanges().forEach((r=>{var n=/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"metaKey":"ctrlKey";if(r&&e.target.position&&e.event[n]&&r.containsPosition(e.target.position)){var i=t.getRanges().map((e=>({range:e,options:{inlineClassName:r.equalsRange(e)?"highlight pointer":"highlight"}})));t.set(i)}else if(!e.event[n]){var a=t.getRanges().map((e=>({range:e,options:{inlineClassName:"highlight"}})));t.set(a)}}))}));return W(),()=>{null==n||n.dispose(),null==r||r.dispose()}}}),[f,g,x,b,W]),(0,ne.useEffect)((()=>{var e=M.current;if(e&&y.current&&"fit-content"===S.current){var t=e.onDidContentSizeChange((t=>{if(t.contentHeightChanged){var r=lt(t.contentHeight,Z,k);r!==L.current.height&&(L.current.height=r,e.layout(L.current))}})),r=lt(e.getContentHeight(),Z,k);return r!==L.current.height&&(L.current.height=r,e.layout(L.current)),()=>{t.dispose()}}}),[k,Z]),(0,ne.useEffect)((()=>{if(M.current){var e=M.current.getModel(),t=e.onDidChangeContent((t=>{var r=W();v(e.getValue(),r,t.isFlush)}));return()=>{t.dispose()}}}),[v,W]),(0,ne.useEffect)((()=>()=>{var e,t;null===(e=M.current)||void 0===e||null===(e=e.getModel())||void 0===e||e.dispose(),null===(t=M.current)||void 0===t||t.dispose()}),[]),ie().createElement("div",{ref:y,style:(0,X.Z)({height:E},"error"===m?{outline:"1px solid var(--antd-error-color)"}:{})})}function st(e,t,r){return ut(Math.min(r,Math.max(t,e.split("\n").length)))}function lt(e,t,r){var n=e;return(e-be.LS)%be.Mv==0&&(n=e+be.sE),Math.min(ut(r),Math.max(n,ut(t)))}function ut(e){return e*be.Mv+be.sE+be.LS}Q=Ye,({e:[s,u,h,d,v,p,b,k,y,M,E,S,W,_,O,B,H,I,D,j,K,T,G,U,A,J],c:[ye,n]}=(0,re.Z)(Q,[[a,1,"name"],[l,1,"label"],[o,1,"value"],[c,1,"language"],[m,1,"theme"],[g,1,"required"],[f,1,"readOnly"],[Z,1,"automaticLayout"],[w,1,"minLines"],[C,1,"completers"],[L,1,"advancedCompleters"],[N,1,"markers"],[x,1,"links"],[z,1,"maxLines"],[R,1,"height"],[P,1,"message"],[q,1,"codeChange",e=>(0,te.Z)(e,Ke),(e,t)=>(0,ee.Z)(e,Ke,t)],[V,1,"userInput",e=>(0,te.Z)(e,Fe),(e,t)=>(0,ee.Z)(e,Fe,t)],[F,1,"highlighClickEvent",e=>(0,te.Z)(e,Ae),(e,t)=>(0,ee.Z)(e,Ae,t)]],[i],0,(e=>Xe.has((0,$.Z)(e))),ue.G)),n()}}]);
//# sourceMappingURL=code-editor.de5479d5.js.map