/*! For license information please see 5832.b5f07eff.js.LICENSE.txt */
"use strict";(globalThis.webpackChunk_next_bricks_visual_builder=globalThis.webpackChunk_next_bricks_visual_builder||[]).push([[5832,5238],{5832:(e,t,n)=>{var a,i=n(4635),r=n(918),o=n(6902),s=n(5536),l=n(6121),c=n(829),d=n(2740),p=n(8769),h=n.n(p),u=n(300),m=n(4295),v=n(7180),g=n(9765),b=n(3373),f=n.n(b);let A,y,k,E,w,x,N,C,T,M,L,S,O,I,R;const _=(0,m.wrapBrick)("eo-icon"),{defineElement:P,property:D,event:W}=(0,u.createDecorators)();let $;var B=new WeakMap,F=new WeakMap,U=new WeakMap,z=new WeakMap,V=new WeakSet,K=new WeakMap,j=new WeakMap,J=new WeakMap;class X extends m.ReactNextElement{constructor(){super(...arguments),(0,i.A)(this,V),(0,r.A)(this,B,y(this)),(0,r.A)(this,F,(k(this),E(this))),(0,r.A)(this,U,(w(this),x(this))),(0,r.A)(this,z,(N(this),C(this))),(0,r.A)(this,K,(L(this),e=>{e!==this.active&&(this.active=e,(0,s.A)(V,this,T).emit(e))})),(0,r.A)(this,j,S(this)),(0,r.A)(this,J,(R(this),()=>{(0,s.A)(V,this,O).emit()}))}get titleLabel(){return(0,c.A)(B,this)}set titleLabel(e){(0,l.A)(B,this,e)}get active(){return(0,c.A)(F,this)}set active(e){(0,l.A)(F,this,e)}get badge(){return(0,c.A)(U,this)}set badge(e){(0,l.A)(U,this,e)}render(){return h().createElement(H,{titleLabel:this.titleLabel,active:this.active,badge:this.badge,onActiveChange:(0,c.A)(K,this),onFirstActivated:(0,c.A)(J,this)})}}function H(e){let{titleLabel:t,active:n,badge:a,onActiveChange:i,onFirstActivated:r}=e;const[o,s]=(0,p.useState)(n),[l,c]=(0,p.useState)(!1);(0,p.useEffect)((()=>{s(n)}),[n]),(0,p.useEffect)((()=>{null==i||i(o)}),[o,i]);const d=(0,p.useCallback)((()=>{s((e=>!e)),l||o||(c(!0),null==r||r())}),[l,o,r]),u=(0,p.useRef)(),[m,v]=(0,p.useState)(!1),g=(0,p.useMemo)((()=>function(e){let t;const n=()=>cancelAnimationFrame(t),a=function(){for(var e=arguments.length,a=new Array(e),i=0;i<e;i++)a[i]=arguments[i];t&&n(),t=requestAnimationFrame((()=>{(()=>{v(u.current.scrollTop>0)})(...a)}))};return a.cancel=n,a}()),[]);return h().createElement("div",{className:f()("pane",{scrolled:m})},h().createElement("div",{className:"pane-header",tabIndex:0,onClick:d},h().createElement("div",{className:"pane-title"},h().createElement("span",{className:"title-icon"},o?h().createElement(_,{lib:"antd",theme:"outlined",icon:"down"}):h().createElement(_,{lib:"antd",theme:"outlined",icon:"right"})),h().createElement("div",{className:"title-label"},t),h().createElement("slot",{name:"title"})),h().createElement("slot",{name:"actions"}),a&&h().createElement("div",{className:"badge"},a),h().createElement("div",{className:"pane-scroll-shadow"})),h().createElement("div",{className:"pane-body custom-scrollbar-container",onScroll:g,ref:u},h().createElement("slot",null,h().createElement("div",{style:{padding:"10px 20px",color:"var(--text-color-secondary)"}},"No content"))))}a=X,({e:[y,k,E,w,x,N,C,T,M,L,S,O,I,R],c:[$,A]}=(0,d.A)(a,[P("visual-builder.workbench-pane",{styleTexts:[v.A,g.A]})],[[D(),1,"titleLabel"],[D({type:Boolean}),1,"active"],[D({type:Number}),1,"badge"],[W({type:"active.change"}),1,"activeChangeEvent",e=>(0,c.A)(z,e),(e,t)=>(0,l.A)(z,e,t)],[W({type:"active.firstActivated"}),1,"activeFirstActivatedEvent",e=>(0,c.A)(j,e),(e,t)=>(0,l.A)(j,e,t)]],0,(e=>J.has((0,o.A)(e))),m.ReactNextElement)),A();var q,Y=n(4586),G=n(2150);let Z,Q,ee;const{defineElement:te,property:ne}=(0,u.createDecorators)();let ae;var ie=new WeakMap,re=new WeakMap,oe=new WeakMap,se=new WeakMap;class le extends m.ReactNextElement{constructor(){super(...arguments),(0,r.A)(this,ie,Q(this)),(0,r.A)(this,re,(ee(this),()=>{var e;return null===(e=this.shadowRoot)||void 0===e?void 0:e.querySelector("slot:not([name])")})),(0,r.A)(this,oe,(()=>{const e=(0,c.A)(re,this).call(this).assignedNodes();for(const t of e)t.active?t.style.flex=String(t.activeFlex??"1"):t.style.flex="initial"})),(0,r.A)(this,se,(e=>{const t=e.target.assignedNodes();for(const e of t)e.addEventListener("active.change",(0,c.A)(oe,this))})),(0,Y.A)(this,"refCallback",(()=>{(0,c.A)(oe,this).call(this);const e=(0,c.A)(re,this).call(this);null==e||e.addEventListener("slotchange",(e=>{(0,c.A)(se,this).call(this,e)}))}))}get titleLabel(){return(0,c.A)(ie,this)}set titleLabel(e){(0,l.A)(ie,this,e)}render(){return h().createElement(ce,{titleLabel:this.titleLabel,refCallback:this.refCallback})}}function ce(e){let{titleLabel:t,refCallback:n}=e;return h().createElement("div",{className:"sidebar",ref:n},h().createElement("div",{className:"title-container"},h().createElement("div",{className:"title-label"},t),h().createElement("slot",{name:"titleToolbar"})),h().createElement("div",{className:"pane-container"},h().createElement("slot",null)))}q=le,({e:[Q,ee],c:[ae,Z]}=(0,d.A)(q,[te("visual-builder.workbench-sidebar",{styleTexts:[G.A]})],[[ne(),1,"titleLabel"]],0,void 0,m.ReactNextElement)),Z();var de=n(2591),pe=n.n(de),he=n(1740),ue=n.n(he),me=n(8128),ve=n.n(me),ge=n(855),be=n.n(ge),fe=n(3051),Ae=n.n(fe),ye=n(3656),ke=n.n(ye),Ee=n(2984),we={};we.styleTagTransform=ke(),we.setAttributes=be(),we.insert=ve().bind(null,"head"),we.domAPI=ue(),we.insertStyleElement=Ae(),pe()(Ee.A,we),Ee.A&&Ee.A.locals&&Ee.A.locals;var xe,Ne=n(5292);let Ce,Te,Me,Le,Se,Oe,Ie,Re,_e,Pe,De,We,$e;const{defineElement:Be,property:Fe}=(0,u.createDecorators)(),Ue=(0,m.wrapBrick)("eo-link"),ze=(0,m.wrapBrick)("eo-icon"),Ve=(0,m.wrapBrick)("eo-tooltip");let Ke;var je=new WeakMap,Je=new WeakMap,Xe=new WeakMap,He=new WeakMap,qe=new WeakMap,Ye=new WeakMap;class Ge extends m.ReactNextElement{constructor(){super(...arguments),(0,r.A)(this,je,Te(this)),(0,r.A)(this,Je,(Me(this),Le(this))),(0,r.A)(this,Xe,(Se(this),Oe(this))),(0,r.A)(this,He,(Ie(this),Re(this))),(0,r.A)(this,qe,(_e(this),Pe(this))),(0,r.A)(this,Ye,(De(this),We(this))),$e(this)}get icon(){return(0,c.A)(je,this)}set icon(e){(0,l.A)(je,this,e)}get to(){return(0,c.A)(Je,this)}set to(e){(0,l.A)(Je,this,e)}get active(){return(0,c.A)(Xe,this)}set active(e){(0,l.A)(Xe,this,e)}get href(){return(0,c.A)(He,this)}set href(e){(0,l.A)(He,this,e)}get target(){return(0,c.A)(qe,this)}set target(e){(0,l.A)(qe,this,e)}get tooltip(){return(0,c.A)(Ye,this)}set tooltip(e){(0,l.A)(Ye,this,e)}render(){return h().createElement(Ze,{to:this.to,icon:this.icon,active:this.active,href:this.href,target:this.target,tooltip:this.tooltip})}}function Ze(e){let{icon:t,to:n,active:a,href:i,target:r,tooltip:o}=e;return h().createElement(Ve,{content:o,placement:"right"},h().createElement(Ue,{className:f()("action",{active:a}),url:n,href:i,target:r},h().createElement(ze,t)))}xe=Ge,({e:[Te,Me,Le,Se,Oe,Ie,Re,_e,Pe,De,We,$e],c:[Ke,Ce]}=(0,d.A)(xe,[Be("visual-builder.workbench-action",{styleTexts:[Ne.A]})],[[Fe({attribute:!1}),1,"icon"],[Fe(),1,"to"],[Fe({type:Boolean}),1,"active"],[Fe(),1,"href"],[Fe(),1,"target"],[Fe(),1,"tooltip"]],0,void 0,m.ReactNextElement)),Ce();var Qe=n(5223),et=n(1201),tt=n(1030);function nt(e,t,n,a){const i=[],r=[],o=[];let s=0;return e&&e.forEach((e=>{if(e.key=""===a?`${s}`:`${a}.${s}`,function(e){return"group"===e.type}(e)||function(e,t){return Boolean("subMenu"===e.type||void 0)}(e)){const a=nt(e.items,t,n,e.key);i.push(...a.selectedKeys),(a.selectedKeys.length||e.defaultExpanded)&&r.push(e.key),r.push(...a.openedKeys),o.push(...a.matchedKeys)}else if(function(e,t,n){if(!e.to)return!1;const a="object"==typeof e.to?e.to:(0,et.parsePath)(e.to),i=a.pathname.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1");let r=!!(0,Qe.matchPath)(t,{path:i,exact:e.exact});if(r&&e.activeMatchSearch&&(r=at(n,a.search)),!r&&Array.isArray(e.activeIncludes))for(const a of e.activeIncludes){let e,i=!0;(0,tt.isObject)(a)?(e=Array.isArray(a.path)?a.path:[a.path],i=a.exact):e=[a];for(const a of e){var o;let e;const s=a.includes("?");if(s&&(e=(0,et.parsePath)(a)),r=!!(0,Qe.matchPath)(t,{path:s?e.pathname:a,exact:i}),r&&null!==(o=e)&&void 0!==o&&o.search&&(r=at(n,e.search)),r)break}if(r)break}if(r&&Array.isArray(e.activeExcludes))for(const n of e.activeExcludes){let e,a=!0;(0,tt.isObject)(n)?(e=Array.isArray(n.path)?n.path:[n.path],a=n.exact):e=[n];for(const n of e)if(r=!(0,Qe.matchPath)(t,{path:n,exact:a}),!r)break;if(!r)break}return r}(e,t,n)){i.push(String(e.key));const t=e.key.split(".");for(let e=0;e<t.length;e++)o.push(t.slice(0,e+1).join("."))}s+=1})),i.length&&""!==a&&r.push(a),{selectedKeys:i,openedKeys:r,matchedKeys:o}}function at(e,t){const n=new URLSearchParams(e),a=new URLSearchParams(t);for(const[e,t]of a.entries())if((n.get(e)??"")!==t)return!1;return!0}var it=n(607),rt={};rt.styleTagTransform=ke(),rt.setAttributes=be(),rt.insert=ve().bind(null,"head"),rt.domAPI=ue(),rt.insertStyleElement=Ae(),pe()(it.A,rt),it.A&&it.A.locals&&it.A.locals;var ot,st=n(3430);let lt,ct,dt,pt,ht;const ut=(0,m.wrapBrick)("visual-builder.workbench-action"),{defineElement:mt,property:vt}=(0,u.createDecorators)();let gt;var bt=new WeakMap,ft=new WeakMap;class At extends m.ReactNextElement{constructor(){super(...arguments),(0,r.A)(this,bt,ct(this)),(0,r.A)(this,ft,(dt(this),pt(this))),ht(this)}get appId(){return(0,c.A)(bt,this)}set appId(e){(0,l.A)(bt,this,e)}get menu(){return(0,c.A)(ft,this)}set menu(e){(0,l.A)(ft,this,e)}render(){return h().createElement(Et,{appId:this.appId,menu:this.menu})}}let yt;ot=At,({e:[ct,dt,pt,ht],c:[gt,lt]}=(0,d.A)(ot,[mt("visual-builder.workbench-action-list",{styleTexts:[st.A]})],[[vt(),1,"appId"],[vt({attribute:!1}),1,"menu"]],0,void 0,m.ReactNextElement)),lt();const kt=new Map;function Et(e){var t;let{appId:n,menu:a}=e;const i=(0,Qe.getHistory)(),[r,o]=(0,p.useState)(),[s,l]=(0,p.useState)(i.location);return(0,p.useEffect)((()=>{const e=i.listen((e=>{l(e)}));return e}),[i]),(0,p.useEffect)((()=>{yt||(yt=n),yt!==n&&(kt.clear(),yt=n)}),[n]),(0,p.useEffect)((()=>{const{pathname:e,search:t}=s,{selectedKeys:n}=nt((null==a?void 0:a.menuItems)??[],e,t,"");o(Number(n[0]))}),[a,s]),h().createElement(h().Fragment,null,null==a||null===(t=a.menuItems)||void 0===t?void 0:t.map(((e,t)=>{if((e=>"default"===e.type||!e.type)(e)){let n=e.to;return r!==t&&kt.has(t)&&(n=kt.get(t)),h().createElement(ut,{key:t,icon:e.icon,to:n,href:e.href,target:e.target,tooltip:e.text,active:r===t,onClick:()=>(e=>{e.href||kt.set(r,`${s.pathname}${s.search}`)})(e)})}})).filter(Boolean))}var wt,xt=n(4940),Nt=n(7758),Ct=n(9406),Tt=n(675),Mt=n(7995),Lt=n(6275);let St,Ot,It,Rt,_t,Pt,Dt,Wt,$t,Bt,Ft,Ut,zt,Vt,Kt,jt,Jt,Xt,Ht,qt,Yt,Gt,Zt,Qt,en,tn,nn,an,rn,on,sn,ln,cn,dn,pn,hn,un,mn,vn,gn,bn,fn,An,yn,kn,En,wn,xn,Nn,Cn,Tn,Mn,Ln,Sn,On,In,Rn;function _n(e){return e.key}n(6477);const{defineElement:Pn,property:Dn,event:Wn}=(0,u.createDecorators)();let $n;var Bn=new WeakMap,Fn=new WeakMap,Un=new WeakMap,zn=new WeakMap,Vn=new WeakMap,Kn=new WeakMap,jn=new WeakMap,Jn=new WeakMap,Xn=new WeakMap,Hn=new WeakMap,qn=new WeakMap,Yn=new WeakMap,Gn=new WeakMap,Zn=new WeakMap,Qn=new WeakMap,ea=new WeakMap,ta=new WeakMap,na=new WeakMap,aa=new WeakMap,ia=new WeakSet,ra=new WeakMap,oa=new WeakMap,sa=new WeakMap,la=new WeakMap,ca=new WeakMap,da=new WeakMap,pa=new WeakMap,ha=new WeakMap,ua=new WeakMap;class ma extends m.ReactNextElement{constructor(){super(...arguments),(0,i.A)(this,ia),(0,r.A)(this,Bn,Ot(this)),(0,r.A)(this,Fn,(It(this),Rt(this))),(0,r.A)(this,Un,(_t(this),Pt(this))),(0,r.A)(this,zn,(Dt(this),Wt(this))),(0,r.A)(this,Vn,($t(this),Bt(this))),(0,r.A)(this,Kn,(Ft(this),Ut(this))),(0,r.A)(this,jn,(zt(this),Vt(this))),(0,r.A)(this,Jn,(Kt(this),jt(this))),(0,r.A)(this,Xn,(Jt(this),Xt(this))),(0,r.A)(this,Hn,(Ht(this),qt(this))),(0,r.A)(this,qn,(Yt(this),Gt(this))),(0,r.A)(this,Yn,(Zt(this),Qt(this))),(0,r.A)(this,Gn,(en(this),tn(this))),(0,r.A)(this,Zn,(nn(this),an(this))),(0,r.A)(this,Qn,(rn(this),on(this))),(0,r.A)(this,ea,(sn(this),ln(this))),(0,r.A)(this,ta,(cn(this),dn(this))),(0,r.A)(this,na,(pn(this),hn(this))),(0,r.A)(this,aa,(un(this),mn(this))),(0,r.A)(this,ra,(bn(this),e=>{(0,s.A)(ia,this,vn).emit(e)})),(0,r.A)(this,oa,fn(this)),(0,r.A)(this,sa,(kn(this),e=>()=>{(0,s.A)(ia,this,An).emit(e.data)})),(0,r.A)(this,la,En(this)),(0,r.A)(this,ca,(Nn(this),e=>{(0,s.A)(ia,this,wn).emit(e)})),(0,r.A)(this,da,Cn(this)),(0,r.A)(this,pa,(Ln(this),e=>t=>{t.preventDefault(),(0,s.A)(ia,this,Tn).emit({active:!0,node:null==e?void 0:e.data,x:t.clientX,y:t.clientY})})),(0,r.A)(this,ha,Sn(this)),(0,r.A)(this,ua,(Rn(this),(e,t)=>{(0,s.A)(ia,this,On).emit({nodeId:e,collapsed:t})}))}get nodes(){return(0,c.A)(Bn,this)}set nodes(e){(0,l.A)(Bn,this,e)}get actions(){return(0,c.A)(Fn,this)}set actions(e){(0,l.A)(Fn,this,e)}get actionsHidden(){return(0,c.A)(Un,this)}set actionsHidden(e){(0,l.A)(Un,this,e)}get placeholder(){return(0,c.A)(zn,this)}set placeholder(e){(0,l.A)(zn,this,e)}get isTransformName(){return(0,c.A)(Vn,this)}set isTransformName(e){(0,l.A)(Vn,this,e)}get searchPlaceholder(){return(0,c.A)(Kn,this)}set searchPlaceholder(e){(0,l.A)(Kn,this,e)}get noSearch(){return(0,c.A)(jn,this)}set noSearch(e){(0,l.A)(jn,this,e)}get activeKey(){return(0,c.A)(Jn,this)}set activeKey(e){(0,l.A)(Jn,this,e)}get showMatchedNodeOnly(){return(0,c.A)(Xn,this)}set showMatchedNodeOnly(e){(0,l.A)(Xn,this,e)}get matchNodeDataFields(){return(0,c.A)(Hn,this)}set matchNodeDataFields(e){(0,l.A)(Hn,this,e)}get fixedActionsFor(){return(0,c.A)(qn,this)}set fixedActionsFor(e){(0,l.A)(qn,this,e)}get collapsible(){return(0,c.A)(Yn,this)}set collapsible(e){(0,l.A)(Yn,this,e)}get collapsedNodes(){return(0,c.A)(Gn,this)}set collapsedNodes(e){(0,l.A)(Gn,this,e)}get allowDrag(){return(0,c.A)(Zn,this)}set allowDrag(e){(0,l.A)(Zn,this,e)}get allowDragToRoot(){return(0,c.A)(Qn,this)}set allowDragToRoot(e){(0,l.A)(Qn,this,e)}get allowDragToInside(){return(0,c.A)(ea,this)}set allowDragToInside(e){(0,l.A)(ea,this,e)}get nodeKey(){return(0,c.A)(ta,this)}set nodeKey(e){(0,l.A)(ta,this,e)}get skipNotify(){return(0,c.A)(na,this)}set skipNotify(e){(0,l.A)(na,this,e)}render(){return h().createElement(xt.e.Provider,{value:{actions:this.actions,actionsHidden:this.actionsHidden,onActionClick:(0,c.A)(ra,this)}},h().createElement(Ct.N.Provider,{value:{activeKey:this.activeKey,basePaddingLeft:5,showMatchedNodeOnly:this.showMatchedNodeOnly,isTransformName:this.isTransformName,fixedActionsFor:this.fixedActionsFor,nodeKey:this.nodeKey,collapsible:this.collapsible,collapsedNodes:this.collapsedNodes,getCollapsedId:_n,onNodeToggle:(0,c.A)(ua,this),skipNotify:this.skipNotify,clickFactory:(0,c.A)(sa,this),contextMenuFactory:(0,c.A)(pa,this),matchNode:(e,t)=>{var n;return(0,Tt.U)(e.name,t)||!(null===(n=this.matchNodeDataFields)||void 0===n||!n.length)&&(0,Tt.U)("*"===this.matchNodeDataFields?e.data:(0,tt.pick)(e.data,this.matchNodeDataFields),t)}}},h().createElement(Nt.cU,{nodes:this.nodes,placeholder:this.placeholder,searchPlaceholder:this.searchPlaceholder,noSearch:this.noSearch,dropEmit:(0,c.A)(ca,this),allowDrag:this.allowDrag,allowDragToInside:this.allowDragToInside,allowDragToRoot:this.allowDragToRoot})))}}wt=ma,({e:[Ot,It,Rt,_t,Pt,Dt,Wt,$t,Bt,Ft,Ut,zt,Vt,Kt,jt,Jt,Xt,Ht,qt,Yt,Gt,Zt,Qt,en,tn,nn,an,rn,on,sn,ln,cn,dn,pn,hn,un,mn,vn,gn,bn,fn,An,yn,kn,En,wn,xn,Nn,Cn,Tn,Mn,Ln,Sn,On,In,Rn],c:[$n,St]}=(0,d.A)(wt,[Pn("visual-builder.workbench-tree",{styleTexts:[Mt.A,Lt.A]})],[[Dn({attribute:!1}),1,"nodes"],[Dn({attribute:!1}),1,"actions"],[Dn({type:Boolean}),1,"actionsHidden"],[Dn(),1,"placeholder"],[Dn({type:Boolean}),1,"isTransformName"],[Dn(),1,"searchPlaceholder"],[Dn({type:Boolean}),1,"noSearch"],[Dn({attribute:!1}),1,"activeKey"],[Dn({type:Boolean}),1,"showMatchedNodeOnly"],[Dn({attribute:!1}),1,"matchNodeDataFields"],[Dn({attribute:!1}),1,"fixedActionsFor"],[Dn({type:Boolean}),1,"collapsible"],[Dn({attribute:!1}),1,"collapsedNodes"],[Dn({type:Boolean}),1,"allowDrag"],[Dn({type:Boolean}),1,"allowDragToRoot"],[Dn({type:Boolean}),1,"allowDragToInside"],[Dn({type:String}),1,"nodeKey"],[Dn({type:Boolean}),1,"skipNotify"],[Wn({type:"action.click"}),1,"actionClickEvent",e=>(0,c.A)(aa,e),(e,t)=>(0,l.A)(aa,e,t)],[Wn({type:"node.click"}),1,"nodeClickEvent",e=>(0,c.A)(oa,e),(e,t)=>(0,l.A)(oa,e,t)],[Wn({type:"node.drop"}),1,"nodeDropEvent",e=>(0,c.A)(la,e),(e,t)=>(0,l.A)(la,e,t)],[Wn({type:"context.menu"}),1,"nodeContextMenuEvent",e=>(0,c.A)(da,e),(e,t)=>(0,l.A)(da,e,t)],[Wn({type:"node.toggle"}),1,"nodeToggleEvent",e=>(0,c.A)(ha,e),(e,t)=>(0,l.A)(ha,e,t)]],0,(e=>ua.has((0,o.A)(e))),m.ReactNextElement)),St();var va=n(155),ga=n.n(va),ba=n(1361),fa=n(5502);let Aa=function(e){return e.LOAD_MORE="LOAD_MORE",e.LOADING="LOADING",e.NO_DATA="NO_DATA",e.NODE="NODE",e.ADD="ADD",e.EDIT="EDIT",e.DELETE="DELETE",e.IMPORT="IMPORT",e.CLONE="CLONE",e.APPEND_RELATION="APPEND_RELATION",e.UPDATE_RELATION="UPDATE_RELATION",e.REMOVE_RELATION="REMOVE_RELATION",e.ROLLBACK="ROLLBACK",e.ROLLBACK_ALL="ROLLBACK_ALL",e.ADD_FULL="ADD_FULL",e.EDIT_FULL="EDIT_FULL",e.DELETE_FULL="DELETE_FULL",e.IMPORT_FULL="IMPORT_FULL",e.CLONE_FULL="CLONE_FULL",e.APPEND_RELATION_FULL="APPEND_RELATION_FULL",e.UPDATE_RELATION_FULL="UPDATE_RELATION_FULL",e.REMOVE_RELATION_FULL="REMOVE_RELATION_FULL",e.ROLLBACK_FULL="ROLLBACK_FULL",e.ROLLBACK_ALL_FULL="ROLLBACK_ALL_FULL",e.PROJECT="PROJECT",e.USER="USER",e.PERMISSION="PERMISSION",e.BRICK="BRICK",e.ROUTE="ROUTE",e.TEMPLATE="TEMPLATE",e.SNIPPET="SNIPPET",e.I18N="I18N",e.IMAGE="IMAGE",e.FUNCTION="FUNCTION",e.MENU="MENU",e.MENU_ITEM="MENU_ITEM",e.WORKFLOW="WORKFLOW",e}({});const ya="bricks/visual-builder/workbench-history-action";var ka=n(9740),Ea=n(6330),wa=n(108),xa=function(){var e=(0,Ea.A)((function*(e,t,n){return(yield wa.http.get("api/gateway/next_builder.workspace.GetChangeHistory/api/v1/next-builder/workspace/".concat(e,"/changes"),(0,ka.A)((0,ka.A)({},n),{},{params:t}))).data}));return function(t,n,a){return e.apply(this,arguments)}}(),Na=n(8799);const Ca={add:`${ya}:${Aa.ADD}`,edit:`${ya}:${Aa.EDIT}`,delete:`${ya}:${Aa.DELETE}`,batch_delete:`${ya}:${Aa.DELETE}`,import:`${ya}:${Aa.IMPORT}`,clone:`${ya}:${Aa.CLONE}`,append_relation:`${ya}:${Aa.APPEND_RELATION}`,update_relation:`${ya}:${Aa.UPDATE_RELATION}`,remove_relation:`${ya}:${Aa.REMOVE_RELATION}`,rollback:`${ya}:${Aa.ROLLBACK}`,rollback_all:`${ya}:${Aa.ROLLBACK_ALL}`},Ta={add:`${ya}:${Aa.ADD_FULL}`,edit:`${ya}:${Aa.EDIT_FULL}`,delete:`${ya}:${Aa.DELETE_FULL}`,batch_delete:`${ya}:${Aa.DELETE_FULL}`,import:`${ya}:${Aa.IMPORT_FULL}`,clone:`${ya}:${Aa.CLONE_FULL}`,append_relation:`${ya}:${Aa.APPEND_RELATION_FULL}`,update_relation:`${ya}:${Aa.UPDATE_RELATION_FULL}`,remove_relation:`${ya}:${Aa.REMOVE_RELATION_FULL}`,rollback:`${ya}:${Aa.ROLLBACK_FULL}`,rollback_all:`${ya}:${Aa.ROLLBACK_ALL_FULL}`},Ma={project:`${ya}:${Aa.PROJECT}`,userGroup:`${ya}:${Aa.USER}`,permission:`${ya}:${Aa.PERMISSION}`,brick:`${ya}:${Aa.BRICK}`,route:`${ya}:${Aa.ROUTE}`,template:`${ya}:${Aa.TEMPLATE}`,snippet:`${ya}:${Aa.SNIPPET}`,i18n:`${ya}:${Aa.I18N}`,image:`${ya}:${Aa.IMAGE}`,function:`${ya}:${Aa.FUNCTION}`,menu:`${ya}:${Aa.MENU}`,menuItem:`${ya}:${Aa.MENU_ITEM}`,workflow:`${ya}:${Aa.WORKFLOW}`},La={PROJECT_MICRO_APP:`${ya}:${Aa.PROJECT}`,"MICRO_APP_USER_GROUP@EASYOPS":`${ya}:${Aa.USER}`,MICRO_APP_RESOURCE_PERMISSION:`${ya}:${Aa.PERMISSION}`,STORYBOARD_BRICK:`${ya}:${Aa.BRICK}`,STORYBOARD_ROUTE:`${ya}:${Aa.ROUTE}`,STORYBOARD_TEMPLATE:`${ya}:${Aa.TEMPLATE}`,STORYBOARD_SNIPPET:`${ya}:${Aa.SNIPPET}`,STORYBOARD_I18N:`${ya}:${Aa.I18N}`,MICRO_APP_RESOURCE_IMAGE:`${ya}:${Aa.IMAGE}`,STORYBOARD_FUNCTION:`${ya}:${Aa.FUNCTION}`,MICRO_APP_RESOURCE_MENU:`${ya}:${Aa.MENU}`,MICRO_APP_RESOURCE_MENU_ITEM:`${ya}:${Aa.MENU_ITEM}`,"WORKFLOW_DEF@EASYOPS":`${ya}:${Aa.WORKFLOW}`};function Sa(e){var t,n,a,i,r,o,s,l,c,d,p,h;const u="rollback"!==e.action||e.rollBackIdInfo?e.action:"rollback_all",m=Na.i18n.t(Ma[e.category]??e.category),v=Na.i18n.t(Ca[u]??u),g=Na.i18n.t(La[null===(t=e.abstract)||void 0===t?void 0:t.leftObjectId]??(null===(n=e.abstract)||void 0===n?void 0:n.leftObjectId)),b=Na.i18n.t(La[null===(a=e.abstract)||void 0===a?void 0:a.rightObjectId]??(null===(i=e.abstract)||void 0===i?void 0:i.rightObjectId)),f=Oa(null===(r=e.abstract)||void 0===r?void 0:r.nodes,null===(o=e.abstract)||void 0===o?void 0:o.nodesCount),A=Oa(null===(s=e.abstract)||void 0===s?void 0:s.leftNodes,null===(l=e.abstract)||void 0===l?void 0:l.leftNodesCount),y=Oa(null===(c=e.abstract)||void 0===c?void 0:c.rightNodes,null===(d=e.abstract)||void 0===d?void 0:d.rightNodesCount),k="rollback"===u?Sa(e.rollBackIdInfo).abstract:null;return{category:m,action:v,leftObjectId:g,rightObjectId:b,nodes:f,leftNodes:A,rightNodes:y,abstract:Na.i18n.t(Ta[u]??u,{category:m,nodes:f,leftNodes:A,rightNodes:y,nodeChanges:null===(p=e.abstract)||void 0===p||null===(p=p.nodeChanges)||void 0===p?void 0:p.join(", "),relationChanges:null===(h=e.abstract)||void 0===h||null===(h=h.relationChanges)||void 0===h?void 0:h.join(", "),leftObjectId:g,rightObjectId:b,rollbackAbstract:k}),rollbackAbstract:k}}function Oa(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:", ";return Na.i18n.t(`${ya}:${Aa.NODE}`,{nodes:e.join(n),context:t>e.length?"ellipsis":void 0,count:t})}var Ia;let Ra,_a,Pa,Da,Wa,$a,Ba,Fa,Ua,za,Va,Ka,ja,Ja,Xa,Ha,qa;(0,fa.initializeReactI18n)(ya,{en:{LOAD_MORE:"Load more",LOADING:"Loading",NO_DATA:"No data",NODE:"{{ nodes }}",NODE_ellipsis:"{{ nodes }} etc., a total of {{ count }} items",ADD:"Add node",EDIT:"Edit node",DELETE:"Delete node",IMPORT:"Batch import node",CLONE:"Clone node",APPEND_RELATION:"Append Relation",UPDATE_RELATION:"Update Relation",REMOVE_RELATION:"Remove Relation",ROLLBACK:"Rollback",ROLLBACK_ALL:"Rollback all operations",ADD_FULL:"Add {{ category }} ({{ nodes }})",EDIT_FULL:"Edit {{ nodeChanges }} of {{ category }} ({{ nodes }})",DELETE_FULL:"Delete {{ category }} ({{ nodes }})",IMPORT_FULL:"Batch Import {{ category }} ({{ nodes }})",CLONE_FULL:"Clone {{ category }} ({{ nodes }})",APPEND_RELATION_FULL:"Append the relation between {{ leftObjectId }} ({{ leftNodes }}) and {{ rightObjectId }} ({{ rightNodes }})",UPDATE_RELATION_FULL:"Update the relation between {{ leftObjectId }} ({{ leftNodes }}) and {{ rightObjectId }} ({{ rightNodes }})",REMOVE_RELATION_FULL:"Remove the relation between {{ leftObjectId }} ({{ leftNodes }}) and {{ rightObjectId }} ({{ rightNodes }})",ROLLBACK_FULL:"Rollback to [{{ rollbackAbstract }}]",ROLLBACK_ALL_FULL:"Rollback all operations",PROJECT:"Project",USER:"User Group",PERMISSION:"Permission",BRICK:"Brick",ROUTE:"Route",TEMPLATE:"Template",SNIPPET:"Snippet",I18N:"I18N",IMAGE:"Image",FUNCTION:"Function",MENU:"Menu",MENU_ITEM:"Menu item",WORKFLOW:"Workflow"},zh:{LOAD_MORE:"加载更多",LOADING:"加载中",NO_DATA:"没有数据",NODE:"{{ nodes }}",NODE_ellipsis:"{{ nodes }}等共{{ count }}项",ADD:"新增节点",EDIT:"编辑节点",DELETE:"删除节点",IMPORT:"批量导入节点",CLONE:"克隆节点",APPEND_RELATION:"添加关系",UPDATE_RELATION:"更新关系",REMOVE_RELATION:"移除关系",ROLLBACK:"回滚",ROLLBACK_ALL:"回滚全部操作",ADD_FULL:"新增{{ category }}（{{ nodes }}）",EDIT_FULL:"编辑{{ category }}（{{ nodes }}）的 {{ nodeChanges }}",DELETE_FULL:"删除{{ category }}（{{ nodes }}）",IMPORT_FULL:"批量导入{{ category }}（{{ nodes }}）",CLONE_FULL:"克隆{{ category }}（{{ nodes }}）",APPEND_RELATION_FULL:"添加{{ leftObjectId }}（{{ leftNodes }}）和{{ rightObjectId }}（{{ rightNodes }}）的关系",UPDATE_RELATION_FULL:"更新{{ leftObjectId }}（{{ leftNodes }}）和{{ rightObjectId }}（{{ rightNodes }}）的关系",REMOVE_RELATION_FULL:"移除{{ leftObjectId }}（{{ leftNodes }}）和{{ rightObjectId }}（{{ rightNodes }}）的关系",ROLLBACK_FULL:"回滚到【{{ rollbackAbstract }}】",ROLLBACK_ALL_FULL:"回滚全部操作",PROJECT:"项目",USER:"用户组",PERMISSION:"权限点",BRICK:"构件",ROUTE:"路由",TEMPLATE:"模版",SNIPPET:"片段",I18N:"国际化",IMAGE:"图片",FUNCTION:"函数",MENU:"菜单",MENU_ITEM:"菜单项",WORKFLOW:"工作流"}});const{defineElement:Ya,property:Ga,event:Za}=(0,u.createDecorators)(),Qa=(0,m.wrapBrick)("eo-button"),ei=(0,m.wrapBrick)("eo-link"),ti=(0,m.wrapBrick)("eo-icon"),ni=(0,m.wrapBrick)("eo-easyops-avatar"),ai=(0,m.wrapBrick)("eo-popover",{onVisibleChange:"visible.change",beforeVisibleChange:"before.visible.change"});let ii;var ri=new WeakMap,oi=new WeakMap,si=new WeakMap,li=new WeakSet,ci=new WeakMap,di=new WeakMap,pi=new WeakMap,hi=new WeakMap,ui=new WeakMap;class mi extends m.ReactNextElement{constructor(){super(...arguments),(0,i.A)(this,li),(0,r.A)(this,ri,_a(this)),(0,r.A)(this,oi,(Pa(this),Da(this))),(0,r.A)(this,si,(Wa(this),$a(this))),(0,r.A)(this,ci,(Ua(this),e=>{(0,s.A)(li,this,Ba).emit(e)})),(0,r.A)(this,di,za(this)),(0,r.A)(this,pi,(ja(this),e=>{(0,s.A)(li,this,Va).emit(e)})),(0,r.A)(this,hi,Ja(this)),(0,r.A)(this,ui,(qa(this),()=>{(0,s.A)(li,this,Xa).emit()}))}get appId(){return(0,c.A)(ri,this)}set appId(e){(0,l.A)(ri,this,e)}get projectId(){return(0,c.A)(oi,this)}set projectId(e){(0,l.A)(oi,this,e)}render(){return h().createElement(vi,{appId:this.appId,projectId:this.projectId,onHistoryItemClick:(0,c.A)(ci,this),onRollback:(0,c.A)(pi,this),onRollbackAll:(0,c.A)(ui,this)})}}function vi(e){const{appId:t,onHistoryItemClick:n,onRollback:a,onRollbackAll:i}=e,{t:r}=(0,fa.useTranslation)(ya),[o,s]=(0,p.useState)(!1),[l,c]=(0,p.useState)(!0),[d,u]=(0,p.useState)(!1),[m,v]=(0,p.useState)([]),g=(0,p.useRef)(""),b=e=>{s(!0),xa(t,{ts:g.current,limit:20}).then((t=>{v((n=>{const a=t.list.map((e=>({...e,translation:Sa(e)})));return e?a:n.concat(a)})),g.current=t.ts,u(t.list.length<20),c(t.list.length<20)})).catch((e=>{(0,Qe.handleHttpError)(e)})).finally((()=>{s(!1)}))};return h().createElement(ai,{placement:"bottom",trigger:"click",arrow:!0,arrowColor:"var(--color-fill-bg-container-4)",beforeVisibleChange:e=>{e.detail&&(c(!0),u(!1),v([]),g.current="",b(!0))}},h().createElement(Qa,{slot:"anchor",shape:"circle",className:"history-action",icon:{lib:"antd",icon:"history",theme:"outlined"}}),h().createElement("div",null,h().createElement("div",{className:"history-title"},"History"),h().createElement("div",{className:"history-list"},m.length?h().createElement(h().Fragment,null,m.map(((e,t)=>h().createElement(gi,{key:`${e.uniqueKey}-${e.ts}`,data:e,enableRollback:0!==t&&"rollback"!==e.action,current:0===t,onHistoryItemClick:n,onRollback:a}))),!l&&h().createElement("span",{className:"load-more-container"},h().createElement(ei,{className:"load-more",disabled:o,onClick:()=>b()},r(Aa.LOAD_MORE))),d&&h().createElement("span",{className:"end-container"},"The End",h().createElement(ti,{className:"rollback-all",lib:"antd",icon:"rollback",theme:"outlined",onClick:()=>i()}))):h().createElement("div",{className:"empty"},r(o?Aa.LOADING:Aa.NO_DATA))),h().createElement("slot",null)))}function gi(e){const{data:t,enableRollback:n,current:a,onHistoryItemClick:i,onRollback:r}=e,o=ga()(Number(t.ts)/1e6),s=ga().duration(o.diff(ga()())),l=s.days()<=-1?o.format("YYYY-MM-DD HH:mm:ss"):s.humanize(!0,{ss:0,s:60,m:60,h:24});return h().createElement("div",{className:"item-container"},h().createElement("div",{className:"item-title"},h().createElement("div",{className:"title-left",onClick:()=>i({...t,enableRollback:n})},h().createElement("div",{className:"topic",title:t.translation.abstract},t.translation.abstract),a&&h().createElement("div",{className:"branch"},"(current)")),h().createElement("div",{className:"title-right"},n&&h().createElement(ti,{className:"rollback",lib:"antd",icon:"rollback",theme:"outlined",onClick:()=>r(t)}))),h().createElement("div",{className:"item-info"},h().createElement(ni,{className:"avatar",nameOrInstanceId:t.user,size:"xs"}),h().createElement("div",{className:"time"},l),h().createElement("div",{className:"operator"},t.user)))}Ia=mi,({e:[_a,Pa,Da,Wa,$a,Ba,Fa,Ua,za,Va,Ka,ja,Ja,Xa,Ha,qa],c:[ii,Ra]}=(0,d.A)(Ia,[Ya("visual-builder.workbench-history-action",{styleTexts:[ba.A]})],[[Ga(),1,"appId"],[Ga(),1,"projectId"],[Za({type:"history.item.click"}),1,"historyItemClickEvent",e=>(0,c.A)(si,e),(e,t)=>(0,l.A)(si,e,t)],[Za({type:"rollback"}),1,"rollbackEvent",e=>(0,c.A)(di,e),(e,t)=>(0,l.A)(di,e,t)],[Za({type:"rollback.all"}),1,"rollbackAllEvent",e=>(0,c.A)(hi,e),(e,t)=>(0,l.A)(hi,e,t)]],0,(e=>ui.has((0,o.A)(e))),m.ReactNextElement)),Ra();var bi,fi=n(2381);let Ai,yi,ki,Ei,wi,xi,Ni,Ci,Ti,Mi,Li,Si,Oi,Ii,Ri,_i,Pi,Di,Wi,$i,Bi,Fi,Ui,zi,Vi,Ki,ji,Ji,Xi,Hi,qi,Yi,Gi,Zi,Qi,er,tr,nr,ar,ir,rr,or,sr,lr,cr,dr,pr,hr,ur,mr,vr,gr,br;const{defineElement:fr,property:Ar,event:yr}=(0,u.createDecorators)(),kr=(0,m.wrapBrick)("eo-icon"),Er=(0,m.wrapBrick)("eo-tooltip"),wr=new Set;let xr;var Nr=new WeakMap,Cr=new WeakMap,Tr=new WeakMap,Mr=new WeakMap,Lr=new WeakMap,Sr=new WeakMap,Or=new WeakMap,Ir=new WeakMap,Rr=new WeakMap,_r=new WeakSet,Pr=new WeakMap,Dr=new WeakMap,Wr=new WeakMap,$r=new WeakMap,Br=new WeakMap,Fr=new WeakMap,Ur=new WeakMap,zr=new WeakMap,Vr=new WeakMap,Kr=new WeakMap,jr=new WeakMap,Jr=new WeakMap,Xr=new WeakMap,Hr=new WeakMap,qr=new WeakMap,Yr=new WeakMap,Gr=new WeakMap;class Zr extends m.ReactNextElement{constructor(){super(...arguments),(0,i.A)(this,_r),(0,r.A)(this,Nr,yi(this)),(0,r.A)(this,Cr,(ki(this),Ei(this))),(0,r.A)(this,Tr,(wi(this),xi(this))),(0,r.A)(this,Mr,(Ni(this),Ci(this))),(0,r.A)(this,Lr,(Ti(this),Mi(this))),(0,r.A)(this,Sr,(Li(this),Si(this))),(0,r.A)(this,Or,(Oi(this),Ii(this))),(0,r.A)(this,Ir,(Ri(this),_i(this))),(0,r.A)(this,Rr,(Pi(this),Di(this))),(0,r.A)(this,Pr,(Bi(this),e=>{(0,s.A)(_r,this,Wi).emit(e)})),(0,r.A)(this,Dr,Fi(this)),(0,r.A)(this,Wr,(Vi(this),e=>{(0,s.A)(_r,this,Ui).emit(e)})),(0,r.A)(this,$r,Ki(this)),(0,r.A)(this,Br,(Xi(this),()=>{(0,s.A)(_r,this,ji).emit()})),(0,r.A)(this,Fr,Hi(this)),(0,r.A)(this,Ur,(Gi(this),()=>{(0,s.A)(_r,this,qi).emit()})),(0,r.A)(this,zr,Zi(this)),(0,r.A)(this,Vr,(tr(this),e=>{(0,s.A)(_r,this,Qi).emit(e)})),(0,r.A)(this,Kr,nr(this)),(0,r.A)(this,jr,(rr(this),()=>{(0,s.A)(_r,this,ar).emit()})),(0,r.A)(this,Jr,or(this)),(0,r.A)(this,Xr,(cr(this),e=>{(0,s.A)(_r,this,sr).emit(e)})),(0,r.A)(this,Hr,dr(this)),(0,r.A)(this,qr,(ur(this),e=>{(0,s.A)(_r,this,pr).emit(e)})),(0,r.A)(this,Yr,mr(this)),(0,r.A)(this,Gr,(br(this),e=>{(0,s.A)(_r,this,vr).emit(e)}))}get label(){return(0,c.A)(Nr,this)}set label(e){(0,l.A)(Nr,this,e)}get type(){return(0,c.A)(Cr,this)}set type(e){(0,l.A)(Cr,this,e)}get external(){return(0,c.A)(Tr,this)}set external(e){(0,l.A)(Tr,this,e)}get subNodes(){return(0,c.A)(Mr,this)}set subNodes(e){(0,l.A)(Mr,this,e)}get active(){return(0,c.A)(Lr,this)}set active(e){(0,l.A)(Lr,this,e)}get notSynced(){return(0,c.A)(Sr,this)}set notSynced(e){(0,l.A)(Sr,this,e)}get disableChildAppend(){return(0,c.A)(Or,this)}set disableChildAppend(e){(0,l.A)(Or,this,e)}get autoFocusOnce(){return(0,c.A)(Ir,this)}set autoFocusOnce(e){(0,l.A)(Ir,this,e)}render(){return h().createElement(Qr,{label:this.label,type:this.type,external:this.external,subNodes:this.subNodes,autoFocusOnce:this.autoFocusOnce,onLabelEditingChange:(0,c.A)(Pr,this),onLabelChange:(0,c.A)(Wr,this),onNodeClick:(0,c.A)(Br,this),onNodeDoubleClick:(0,c.A)(Ur,this),onNodeContextMenu:(0,c.A)(Vr,this),onChildAppend:(0,c.A)(jr,this),onExternalClick:(0,c.A)(Xr,this),onSubNodeDoubleClick:(0,c.A)(qr,this),onSubNodeContextMenu:(0,c.A)(Gr,this)})}}function Qr(e){let{label:t,type:n,external:a,subNodes:i,autoFocusOnce:r,onLabelEditingChange:o,onLabelChange:s,onNodeClick:l,onNodeDoubleClick:c,onNodeContextMenu:d,onChildAppend:u,onExternalClick:m,onSubNodeDoubleClick:v,onSubNodeContextMenu:g}=e;const b="board"===n?"board":"page",[A,y]=(0,p.useState)(t),[k,E]=(0,p.useState)(!1),w=(0,p.useRef)(!1),[x,N]=(0,p.useState)(!1),C=(0,p.useRef)(null);(0,p.useEffect)((()=>{y(t)}),[t]);const T=(0,p.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),E(!0)}),[]);(0,p.useEffect)((()=>{r&&!wr.has(r)&&(wr.add(r),setTimeout((()=>{E(!0)}),1))}),[r]),(0,p.useEffect)((()=>{var e,t;k&&(null===(e=C.current)||void 0===e||e.focus({preventScroll:!0}),null===(t=C.current)||void 0===t||t.select())}),[k]),(0,p.useEffect)((()=>{w.current?null==o||o(k):w.current=!0}),[k,o]);const M=(0,p.useCallback)((e=>{y(e.target.value)}),[]),L=(0,p.useCallback)((e=>{const t=e.key||e.keyCode||e.which;var n;"Enter"!==t&&13!==t||null===(n=C.current)||void 0===n||n.blur()}),[]),S=(0,p.useCallback)((()=>{E(!1),N(!0)}),[]);(0,p.useEffect)((()=>{x&&(null==s||s(A),N(!1))}),[A,s,x]);const O=(0,p.useCallback)((e=>{e.stopPropagation(),null==u||u()}),[u]),I=(0,p.useCallback)((e=>{e.stopPropagation(),null==m||m(a)}),[a,m]),R=(0,p.useCallback)((e=>{e.stopPropagation()}),[]),_=38*Math.max(0,Math.floor(((null==i?void 0:i.length)??0)-3));return h().createElement(h().Fragment,null,h().createElement("div",{className:f()("node",b,{"editing-label":k}),style:{height:"board"===b?70:130+_},onClick:l,onDoubleClick:c,onContextMenu:e=>{e.stopPropagation(),e.preventDefault(),null==d||d({clientX:e.clientX,clientY:e.clientY})}},h().createElement("input",{className:"label-input",value:A,ref:C,onChange:M,onKeyDown:L,onBlur:S,onDoubleClick:R,onContextMenu:R,onMouseDown:R}),h().createElement("div",{className:"label",onDoubleClick:T,onMouseDown:R},A),"board"===b?h().createElement("div",{className:"icon-container"},h().createElement(kr,{lib:"antd",icon:"unordered-list"})):h().createElement("div",{className:"thumbnail-container",style:{height:98+_}},h().createElement("div",{className:"thumbnail-placeholder"},h().createElement(kr,{lib:"antd",icon:"ellipsis"})),a&&h().createElement("div",{className:"external",onClick:I,onDoubleClick:R,onMouseDown:R},h().createElement(kr,{lib:"antd",icon:"desktop"}),h().createElement("span",{className:"external-label"},a.label)),null!=i&&i.length?h().createElement("div",{className:"sub-nodes"},i.map((e=>h().createElement(eo,{key:e.id,subNode:e,onSubNodeDoubleClick:v,onSubNodeContextMenu:g})))):null)),h().createElement("div",{className:"add-button",role:"button",onClick:O,onMouseDown:R},h().createElement(kr,{lib:"fa",icon:"plus"})))}function eo(e){let{subNode:t,onSubNodeDoubleClick:n,onSubNodeContextMenu:a}=e;return h().createElement(Er,{key:t.id,content:t.label},h().createElement("div",{className:"sub-node",onDoubleClick:e=>{e.stopPropagation(),null==n||n(t)},onContextMenu:e=>{e.stopPropagation(),e.preventDefault(),null==a||a({node:t,clientX:e.clientX,clientY:e.clientY})}},h().createElement("div",{className:"sub-node-skeleton-title"}),h().createElement("div",{className:"sub-node-skeleton-content"}),h().createElement("div",{className:"sub-node-skeleton-button"})))}bi=Zr,({e:[yi,ki,Ei,wi,xi,Ni,Ci,Ti,Mi,Li,Si,Oi,Ii,Ri,_i,Pi,Di,Wi,$i,Bi,Fi,Ui,zi,Vi,Ki,ji,Ji,Xi,Hi,qi,Yi,Gi,Zi,Qi,er,tr,nr,ar,ir,rr,or,sr,lr,cr,dr,pr,hr,ur,mr,vr,gr,br],c:[xr,Ai]}=(0,d.A)(bi,[fr("visual-builder.page-arch-node",{styleTexts:[fi.A]})],[[Ar(),1,"label"],[Ar(),1,"type"],[Ar({attribute:!1}),1,"external"],[Ar({attribute:!1}),1,"subNodes"],[Ar({type:Boolean,render:!1}),1,"active"],[Ar({type:Boolean,render:!1}),1,"notSynced"],[Ar({type:Boolean,render:!1}),1,"disableChildAppend"],[Ar(),1,"autoFocusOnce"],[yr({type:"label.editing.change"}),1,"labelEditingChange",e=>(0,c.A)(Rr,e),(e,t)=>(0,l.A)(Rr,e,t)],[yr({type:"label.change"}),1,"labelChange",e=>(0,c.A)(Dr,e),(e,t)=>(0,l.A)(Dr,e,t)],[yr({type:"node.click"}),1,"nodeClick",e=>(0,c.A)($r,e),(e,t)=>(0,l.A)($r,e,t)],[yr({type:"node.dblclick"}),1,"nodeDoubleClick",e=>(0,c.A)(Fr,e),(e,t)=>(0,l.A)(Fr,e,t)],[yr({type:"node.contextmenu"}),1,"nodeContextMenu",e=>(0,c.A)(zr,e),(e,t)=>(0,l.A)(zr,e,t)],[yr({type:"child.append"}),1,"childAppend",e=>(0,c.A)(Kr,e),(e,t)=>(0,l.A)(Kr,e,t)],[yr({type:"external.click"}),1,"externalClick",e=>(0,c.A)(Jr,e),(e,t)=>(0,l.A)(Jr,e,t)],[yr({type:"subNode.dblclick"}),1,"subNodeDoubleClick",e=>(0,c.A)(Hr,e),(e,t)=>(0,l.A)(Hr,e,t)],[yr({type:"subNode.contextmenu"}),1,"subNodeContextMenu",e=>(0,c.A)(Yr,e),(e,t)=>(0,l.A)(Yr,e,t)]],0,(e=>Gr.has((0,o.A)(e))),m.ReactNextElement)),Ai();var to,no=n(9592),ao=n(6213),io=n(2559);function ro(e,t,n,a){return t((0,io.A)(e,n),a),a}let oo,so,lo,co,po,ho,uo,mo,vo;const{method:go,property:bo}=(0,u.createDecorators)();var fo=new WeakMap,Ao=new WeakSet,yo=new WeakMap,ko=new WeakMap,Eo=new WeakMap,wo=new WeakMap,xo=new WeakMap,No=new WeakMap;class Co extends m.ReactNextElement{constructor(){super(...arguments),(0,i.A)(this,Ao),(0,r.A)(this,fo,(oo(this),!1)),(0,r.A)(this,yo,"normal"),(0,r.A)(this,ko,!1),(0,r.A)(this,Eo,so(this)),(0,r.A)(this,wo,(lo(this),co(this))),(0,r.A)(this,xo,(po(this),ho(this))),(0,r.A)(this,No,(uo(this),mo(this))),vo(this)}get isFormItemElement(){return!0}set validateState(e){ro(Ao,So,this,e),this._render()}get validateState(){return(0,s.A)(Ao,this,Lo)}set notRender(e){this.hidden=e,ro(Ao,Mo,this,e),this._render()}get notRender(){return(0,s.A)(Ao,this,To)}get $bindFormItem(){return(0,s.A)(Ao,this,Oo)}set $bindFormItem(e){ro(Ao,Io,this,e),this._render()}get helpBrick(){return(0,c.A)(Eo,this)}set helpBrick(e){(0,l.A)(Eo,this,e)}get labelBrick(){return(0,c.A)(wo,this)}set labelBrick(e){(0,l.A)(wo,this,e)}get labelCol(){return(0,c.A)(xo,this)}set labelCol(e){(0,l.A)(xo,this,e)}get wrapperCol(){return(0,c.A)(No,this)}set wrapperCol(e){(0,l.A)(No,this,e)}setNotRender(e){this.notRender=e}getFormElement(){let e=this;for(;(e=e.parentNode)&&e&&!e.isFormElement;);return e}}function To(e){return(0,c.A)(fo,e)}function Mo(e,t){(0,l.A)(fo,e,t)}function Lo(e){return(0,c.A)(yo,e)}function So(e,t){(0,l.A)(yo,e,t)}function Oo(e){return(0,c.A)(ko,e)}function Io(e,t){(0,l.A)(ko,e,t)}to=Co,[so,lo,co,po,ho,uo,mo,vo,oo]=(0,d.A)(to,[],[[bo({attribute:!1}),1,"helpBrick"],[bo({attribute:!1}),1,"labelBrick"],[bo({attribute:!1}),1,"labelCol"],[bo({attribute:!1}),1,"wrapperCol"],[go(),2,"setNotRender"],[go(),2,"getFormElement"]],0,void 0,m.ReactNextElement).e;var Ro=function(){var e=(0,Ea.A)((function*(e,t){return(yield wa.http.post("api/gateway/next_builder.contract_center.SearchContract/api/v1/contract/search",e,t)).data}));return function(t,n){return e.apply(this,arguments)}}();let _o=function(e){return e.CONTRACT_OPTIONS_TIPS_PREFIX="CONTRACT_OPTIONS_TIPS_PREFIX",e.CONTRACT_OPTIONS_TIPS_SUFFIX="CONTRACT_OPTIONS_TIPS_SUFFIX",e.CONTRACT_VALIDATE_MESSAGE="CONTRACT_VALIDATE_MESSAGE",e}({});const Po="bricks/visual-builder/contract-select",Do={en:{CONTRACT_OPTIONS_TIPS_PREFIX:"Only the first",CONTRACT_OPTIONS_TIPS_SUFFIX:"items are displayed, please search for more results",CONTRACT_VALIDATE_MESSAGE:"Please fill in the correct contract name "},zh:{CONTRACT_OPTIONS_TIPS_PREFIX:"仅展示前",CONTRACT_OPTIONS_TIPS_SUFFIX:"项,更多结果请搜索",CONTRACT_VALIDATE_MESSAGE:"请填写正确的契约名称"}};(0,fa.initializeReactI18n)(Po,Do);const Wo=(0,m.wrapBrick)("eo-icon"),$o=(0,m.wrapBrick)("eo-input",{onChange:"change"});function Bo(e){const{itemsCount:t=20,onBlur:n}=e,[a,i]=(0,p.useState)(t),{t:r}=(0,fa.useTranslation)(Po),[o,s]=(0,p.useState)(!1);return h().createElement("div",{className:"options-tips",slot:e.slot},r(_o.CONTRACT_OPTIONS_TIPS_PREFIX)," ",o?h().createElement($o,{autoFocus:!0,inputStyle:{width:65},value:String(a),onBlur:()=>{s(!1),null==n||n(a)},onChange:e=>{i(Number(e.detail))}}):h().createElement("span",null,a," ",h().createElement(Wo,{icon:"edit",lib:"antd",onClick:()=>{s(!0)}}))," ",r(_o.CONTRACT_OPTIONS_TIPS_SUFFIX))}var Fo;let Uo,zo,Vo,Ko,jo,Jo,Xo,Ho,qo,Yo,Go,Zo,Qo,es,ts;(0,fa.initializeReactI18n)(Po,Do);const{defineElement:ns,property:as,event:is}=(0,u.createDecorators)(),rs=(0,m.wrapBrick)("eo-form-item"),os=(0,m.wrapBrick)("eo-auto-complete",{onChange:"change"});let ss;var ls=new WeakMap,cs=new WeakMap,ds=new WeakMap,ps=new WeakMap,hs=new WeakMap,us=new WeakMap,ms=new WeakSet;function vs(e){if("string"!=typeof e)return{name:"",version:""};const[t,n]=e.split(":");return{name:t,version:n}}function gs(e){return/.*@.*:\d+\.\d+\.\d+/.test(e)}function bs(e){return(0,tt.isNil)(e)||gs(e)?"":Na.i18n.t(`${Po}:${_o.CONTRACT_VALIDATE_MESSAGE}`)}function fs(e){let{value:t,inputStyle:n,validateState:a,suffix:i,onChange:r}=e;const[o,s]=(0,p.useState)(),[l,c]=(0,p.useState)(20),d=function(e){let{pageSize:t=20,q:n=""}=e;const[a,i]=(0,p.useState)([]),[r,o]=(0,p.useState)(n),[s,l]=(0,p.useState)(t);return(0,p.useEffect)((()=>{o(n)}),[n]),(0,p.useEffect)((()=>{l(t)}),[t]),(0,p.useEffect)((()=>{(async()=>{try{const{list:e}=await Ro({page:1,pageSize:s,fullContractName:r},{interceptorParams:{ignoreLoadingBar:!0}});i(e)}catch(e){console.error(e),i([])}})()}),[r,s]),a}({q:o,pageSize:l}),[u,m]=(0,p.useState)(vs(t)),[v,g]=(0,p.useState)([]);(0,p.useEffect)((()=>{m(vs(t))}),[t]);const b=(0,p.useMemo)((()=>(0,tt.debounce)((e=>{s(e)}),200)),[]);return h().createElement("div",{className:"contract-wrapper"},h().createElement(os,{className:"contract-selector",options:null==d?void 0:d.map((e=>({value:e.fullContractName,label:e.fullContractName}))),value:u.name,inputStyle:n,validateState:a,onChange:e=>{const t=e.detail;if(gs(t))m(vs(t)),null==r||r(t);else{var n;const e=null===(n=d.find((e=>e.fullContractName===t)))||void 0===n?void 0:n.version,a=(null==e?void 0:e[0])??"";g(e),m({name:t,version:a}),null==r||r(`${t}:${a}`)}b(t)}},h().createElement(Bo,{onBlur:e=>c(e),slot:"options-toolbar"})),h().createElement(os,{className:"version-selector",value:u.version,validateState:a,options:null==v?void 0:v.map((e=>({value:e,label:e}))),onChange:e=>{const t=e.detail;m({name:u.name,version:t}),null==r||r(`${u.name}:${t}`)}}),null!=i&&i.useBrick?h().createElement(no.ReactUseMultipleBricks,i):null)}Fo=class extends Co{constructor(){super(...arguments),(0,i.A)(this,ms),(0,r.A)(this,ls,zo(this)),(0,r.A)(this,cs,(Vo(this),Ko(this))),(0,r.A)(this,ds,(jo(this),Jo(this))),(0,r.A)(this,ps,(Xo(this),Ho(this))),(0,r.A)(this,hs,(qo(this),Yo(this))),(0,r.A)(this,us,(Go(this),Zo(this))),(0,Y.A)(this,"handleChange",(ts(this),e=>{(0,s.A)(ms,this,Qo).emit(e)}))}get name(){return(0,c.A)(ls,this)}set name(e){(0,l.A)(ls,this,e)}get required(){return(0,c.A)(cs,this)}set required(e){(0,l.A)(cs,this,e)}get label(){return(0,c.A)(ds,this)}set label(e){(0,l.A)(ds,this,e)}get value(){return(0,c.A)(ps,this)}set value(e){(0,l.A)(ps,this,e)}get suffix(){return(0,c.A)(hs,this)}set suffix(e){(0,l.A)(hs,this,e)}render(){return h().createElement(rs,{exportparts:"message",curElement:this,formElement:this.getFormElement(),name:this.name,label:this.label,required:this.required,labelBrick:this.labelBrick,helpBrick:this.helpBrick,notRender:this.notRender,trigger:"handleChange",validator:bs},h().createElement(fs,{value:this.value,suffix:this.suffix,validateState:this.validateState,onChange:this.handleChange}))}},({e:[zo,Vo,Ko,jo,Jo,Xo,Ho,qo,Yo,Go,Zo,Qo,es,ts],c:[ss,Uo]}=(0,d.A)(Fo,[ns("visual-builder.contract-select",{styleTexts:[ao.A]})],[[as(),1,"name"],[as({type:Boolean}),1,"required"],[as(),1,"label"],[as({attribute:!1}),1,"value"],[as({attribute:!1}),1,"suffix"],[is({type:"change"}),1,"changeEvent",e=>(0,c.A)(us,e),(e,t)=>(0,l.A)(us,e,t)]],0,(e=>ms.has((0,o.A)(e))),Co)),Uo();var As=n(3078);var ys,ks=n(7540);let Es,ws,xs,Ns,Cs,Ts,Ms,Ls,Ss,Os,Is,Rs,_s,Ps,Ds,Ws;const $s=(0,m.wrapBrick)("eo-menu"),Bs=(0,m.wrapBrick)("eo-menu-item"),Fs=(0,m.wrapBrick)("eo-tooltip"),Us=(0,As.unwrapProvider)("basic.lock-body-scroll");(0,fa.initializeReactI18n)("bricks/visual-builder/generate-snippets-context-menu",{en:{},zh:{}});const{defineElement:zs,property:Vs,event:Ks,method:js}=(0,u.createDecorators)();let Js;var Xs=new WeakMap,Hs=new WeakMap,qs=new WeakMap,Ys=new WeakMap,Gs=new WeakSet,Zs=new WeakMap,Qs=new WeakMap,el=new WeakMap;class tl extends m.ReactNextElement{constructor(){super(...arguments),(0,i.A)(this,Gs),(0,r.A)(this,Xs,(Es(this),xs(this))),(0,r.A)(this,Hs,(Ns(this),Cs(this))),(0,r.A)(this,qs,(Ts(this),Ms(this))),(0,r.A)(this,Ys,(Ls(this),Ss(this))),(0,r.A)(this,Zs,(Rs(this),_s(this))),(0,r.A)(this,Qs,(Ws(this),e=>{(0,s.A)(Gs,this,Os).emit(e)})),(0,r.A)(this,el,(e=>{(0,s.A)(Gs,this,Ps).emit(e)}))}get options(){return(0,c.A)(Xs,this)}set options(e){(0,l.A)(Xs,this,e)}get active(){return(0,c.A)(Hs,this)}set active(e){(0,l.A)(Hs,this,e)}get position(){return(0,c.A)(qs,this)}set position(e){(0,l.A)(qs,this,e)}open(e){let{position:t}=e;this.active=!0,this.position=t}close(){this.active=!1,this.position=void 0}disconnectedCallback(){super.disconnectedCallback(),Us(this,!1)}render(){return h().createElement(nl,{active:this.active,element:this,position:this.position,onItemDragStart:(0,c.A)(Qs,this),onItemDragEnd:(0,c.A)(el,this),options:this.options})}}function nl(e){var t,n;let{element:a,active:i,onItemDragEnd:r,onItemDragStart:o,options:s,position:l}=e;const[c,d]=(0,p.useState)(!1),u=(0,p.useRef)(null),[m,v]=(0,p.useState)(null),g=(0,p.useCallback)((e=>{e.preventDefault(),null==a||a.close()}),[a]),b=(0,p.useCallback)(((e,t)=>{var n;d(!0),t.dragConf&&(null===(n=e.dataTransfer)||void 0===n||n.setData(t.dragConf.format,JSON.stringify(t.dragConf.data))),e.target.classList.add("dragging"),null==o||o(t)}),[o]),f=(0,p.useCallback)(((e,t)=>{d(!1),e.target.classList.remove("dragging"),null==a||a.close(),null==r||r(t)}),[a,r]);return(0,p.useEffect)((()=>{Us(a,i)}),[i,a]),(0,p.useEffect)((()=>{if(i&&u.current&&l){const e=u.current.getBoundingClientRect(),t=e.width+8,n=e.height+8,{clientWidth:a,clientHeight:i}=document.documentElement,r=[...l];a>t&&l[0]+t>a&&(r[0]=l[0]-t),i>n&&l[1]+n>i&&(r[1]=i-n),v(r)}else v(null)}),[i,l]),h().createElement(h().Fragment,null,!c&&h().createElement("div",{className:"mask",onClick:g,onContextMenu:g}),h().createElement("div",{className:"container",ref:u,style:{left:null===(t=m??l)||void 0===t?void 0:t[0],top:null===(n=m??l)||void 0===n?void 0:n[1],visibility:m?"visible":"hidden"}},null==s?void 0:s.map(((e,t)=>{var n,a;return h().createElement("div",{key:t},h().createElement("div",{className:"title"},e.title),(null===(n=e.children)||void 0===n?void 0:n.length)&&h().createElement($s,null,null===(a=e.children)||void 0===a?void 0:a.map(((e,t)=>h().createElement(Fs,{content:e.tooltip,hoist:!0,placement:"left",key:t},h().createElement(Bs,{disabled:e.disabled,icon:e.icon,draggable:!e.disabled,onDragStart:t=>b(t,e),onDragEnd:t=>f(t,e)},e.text))))))}))))}ys=tl,({e:[xs,Ns,Cs,Ts,Ms,Ls,Ss,Os,Is,Rs,_s,Ps,Ds,Ws,Es],c:[Js,ws]}=(0,d.A)(ys,[zs("visual-builder.generate-snippets-context-menu",{styleTexts:[ks.A]})],[[Vs({attribute:!1}),1,"options"],[Vs({type:Boolean}),1,"active"],[Vs({attribute:!1}),1,"position"],[Ks({type:"item.drag.start"}),1,"itemDragStartEvent",e=>(0,c.A)(Ys,e),(e,t)=>(0,l.A)(Ys,e,t)],[Ks({type:"item.drag.end"}),1,"itemDragEndEvent",e=>(0,c.A)(Zs,e),(e,t)=>(0,l.A)(Zs,e,t)],[js(),2,"open"],[js(),2,"close"]],0,(e=>el.has((0,o.A)(e))),m.ReactNextElement)),ws();var al=n(1085),il=n(3091),rl=n(7447),ol=n(3640),sl=n(4360),ll=n(3544),cl=n(4650),dl=n(9830);function pl(){function e(e,t,n){if(!n||"pre"!==n.tagName||"code"!==e.tagName)return;const a=function(e){const t=e.properties.className||[];for(const e of t)if("language-"===e.slice(0,9))return e.slice(9).toLowerCase();return null}(e);if(null===a)return;let i;try{n.properties.className=(n.properties.className||[]).concat("language-"+a),i=dl.L.highlight((0,cl.d)(e),a)}catch{return}e.children=i.children}return t=>{(0,ll.YR)(t,"element",e)}}const hl={Fragment:al.Fragment,jsx:al.jsx,jsxs:al.jsxs};function ul(e){let{content:t}=e;const[n,a]=(0,p.useState)(null);return(0,p.useEffect)((()=>{let e=!1;return(0,il.l)().use(rl.A).use(ol.A).use([pl]).use(sl.A,hl).process(t).then((t=>{e||a(t.result)})).catch((t=>{e||(console.error("Convert markdown failed:",t),a(null))})),()=>{e=!0}}),[t]),n}const ml=(0,m.wrapBrick)("eo-avatar");function vl(e){let{message:t}=e;const n=(0,p.useMemo)((()=>{const e=[];if("assistant"===t.role){const n=/(?:^|\n)```(easy_cmd_\S+)\n([\s\S]*?)\n```(?:$|\n)/gm;let a,i=0;for(;a=n.exec(t.content);){const[r,o,s]=a,l=a.index,c=t.content.slice(i,l).trim();c.length>0&&e.push({type:"markdown",content:c}),e.push({type:"command",command:o,content:s.trim(),raw:r}),i=n.lastIndex}const r=t.content.slice(i).trim();r.length>0&&e.push({type:"markdown",content:r})}else e.push({type:"plain",content:t.content});return e}),[t.content,t.role]),a=(0,p.useRef)(null);return(0,p.useEffect)((()=>{const e=a.current;e&&setTimeout((()=>{const n=e.parentElement.querySelectorAll(".texting");for(const e of n)e.classList.remove("texting");if(!t.partial)return;let a=e;for(;a;){const e=a.lastChild;if((null==e?void 0:e.nodeType)!==Node.ELEMENT_NODE||"DETAILS"===(null==e?void 0:e.tagName)&&!e.open){var i;if((null==e?void 0:e.nodeType)!==Node.TEXT_NODE||0!==e.textContent.trim().length||(null===(i=e.previousSibling)||void 0===i?void 0:i.nodeType)!==Node.ELEMENT_NODE)break;a=e.previousSibling}else a=e}a.classList.add("texting")}),1)}),[t.partial,t.content]),h().createElement("div",{className:f()("message",{failed:t.failed})},h().createElement("div",{className:"avatar"},h().createElement(ml,{icon:{lib:"easyops",icon:"assistant"===t.role?"robot":"account"},size:"small",className:`role-${t.role}`})),h().createElement("div",{className:"main"},h().createElement("div",{className:"label"},"assistant"===t.role?"Assistant":"You"),h().createElement("div",{className:"content",ref:a},n.map(((e,t)=>h().createElement(gl,{key:t,chunk:e}))))))}function gl(e){let{chunk:t}=e;return h().createElement(h().Fragment,null,"markdown"===t.type?h().createElement("div",{className:"markdown"},h().createElement(ul,{content:t.content})):"command"===t.type?h().createElement(h().Fragment,null,h().createElement("details",{className:"command"},h().createElement("summary",null,"```",t.command),h().createElement("pre",null,h().createElement("code",null,t.content)))):h().createElement("div",{className:"plain"},t.content))}var bl,fl=n(7236);let Al,yl,kl,El,wl,xl,Nl,Cl,Tl;const{defineElement:Ml,property:Ll,event:Sl}=(0,u.createDecorators)();let Ol;var Il=new WeakMap,Rl=new WeakMap,_l=new WeakMap,Pl=new WeakSet,Dl=new WeakMap;class Wl extends m.ReactNextElement{constructor(){super(...arguments),(0,i.A)(this,Pl),(0,r.A)(this,Il,yl(this)),(0,r.A)(this,Rl,(kl(this),El(this))),(0,r.A)(this,_l,(wl(this),xl(this))),(0,r.A)(this,Dl,(Tl(this),e=>{(0,s.A)(Pl,this,Nl).emit(e)}))}get messages(){return(0,c.A)(Il,this)}set messages(e){(0,l.A)(Il,this,e)}get errorBoundary(){return(0,c.A)(Rl,this)}set errorBoundary(e){(0,l.A)(Rl,this,e)}render(){return h().createElement($l,{host:this,messages:this.messages,errorBoundary:this.errorBoundary,onStoryboardUpdate:(0,c.A)(Dl,this)})}}function $l(e){let{messages:t,host:n,errorBoundary:a,onStoryboardUpdate:i}=e;const r=(0,p.useMemo)((()=>/(?:^|\n)```easy_cmd_vb_block_(page|storyboard)\n([\s\S]*?)\n```(?:$|\n)/gm),[]),o=(0,p.useRef)(new Map),[s,l]=(0,p.useState)([]),c=(0,p.useRef)(!1);(0,p.useEffect)((()=>{for(const e of t??[]){if("assistant"!==e.role)continue;let t;r.lastIndex=o.current.get(e.key)??0;const n=[];let a=!1;for(;t=r.exec(e.content);){o.current.set(e.key,r.lastIndex);const[,i,s]=t;try{const e=JSON.parse(s);"page"===i?(a=!0,n.push(...e)):n.push({...e,type:"item"})}catch(e){console.error("parse storyboard failed:",e)}}a?l(n):n.length>0&&l((e=>[...e,...n]))}}),[r,t]);const[d,u]=(0,p.useState)([]);(0,p.useEffect)((()=>{const e=[],t=new Map;for(const n of s)"block"===n.type?e.push(n):n.storyboard&&t.set(n.uuid,n.storyboard);e.sort(((e,t)=>e.seq-t.seq));const n={brick:"eo-content-layout",children:[]},i={brick:"eo-main-view",children:[{brick:"eo-page-title",slot:"pageTitle",properties:{pageTitle:"测试页面"}}]};let r=!1;for(const o of e)if("全局操作区"===o.name)for(const e of o.children){const n=t.get(e);n&&(i.children.push({...n,properties:{...n.properties,slot:void 0},errorBoundary:a,slot:"toolbar",iid:`item:${e}`,meta:{type:"item",uuid:e,block:{uuid:o.uuid,name:o.name}}}),r=!0)}else{const e=t.get(o.uuid);if(e){const i={...e,children:[],errorBoundary:a,iid:`block:${o.uuid}`,meta:{type:"block",uuid:o.uuid,name:o.name}};r=!0,n.children.push(i);for(const e of o.children){const n=t.get(e);n&&i.children.push({...n,errorBoundary:a,iid:`item:${e}`,meta:{type:"item",uuid:e}})}}else if(!o.hasContainer)for(const e of o.children){const i=t.get(e);i&&(n.children.push({...i,errorBoundary:a,iid:`item:${e}`,meta:{type:"item",uuid:e}}),r=!0)}}i.children.push(n),u((e=>r?[i]:0===e.length?e:[]))}),[s,a]),(0,p.useEffect)((()=>{null==i||i(d)}),[i,d]);const m=(0,p.useMemo)((()=>{let e=n;for(;e;){const t=getComputedStyle(e,null).getPropertyValue("overflow-y");if("auto"===t||"scroll"===t)return e;if(e.parentNode instanceof ShadowRoot)e=e.parentNode.host;else{if(!(e.parentNode instanceof Element))break;e=e.parentNode}}return document.scrollingElement||document.documentElement}),[n]);return(0,p.useEffect)((()=>{c.current||setTimeout((()=>{m.scrollTo(0,m.scrollHeight)}),1)}),[t,m]),(0,p.useEffect)((()=>{const e=()=>{c.current=m.scrollTop+m.clientHeight+6<m.scrollHeight};return m.addEventListener("scroll",e),()=>{m.removeEventListener("scroll",e)}}),[m]),h().createElement(h().Fragment,null,null==t?void 0:t.map(((e,t)=>h().createElement(vl,{key:e.key??`index-${t}`,message:e}))))}bl=Wl,({e:[yl,kl,El,wl,xl,Nl,Cl,Tl],c:[Ol,Al]}=(0,d.A)(bl,[Ml("visual-builder.chat-conversation",{styleTexts:[fl.A]})],[[Ll({attribute:!1}),1,"messages"],[Ll({type:Boolean}),1,"errorBoundary"],[Sl({type:"storyboard.update"}),1,"storyboardUpdate",e=>(0,c.A)(_l,e),(e,t)=>(0,l.A)(_l,e,t)]],0,(e=>Dl.has((0,o.A)(e))),m.ReactNextElement)),Al();var Bl=n(9575),Fl=n(1732);function Ul(e){let{variant:t,width:n,height:a,left:i,top:r,label:o}=e;return h().createElement("div",{className:"outline "+t,style:{width:n+8,height:a+8,left:i-4,top:r-4}},h().createElement("div",{className:"label"},o))}var zl,Vl=n(1563);let Kl,jl,Jl,Xl,Hl,ql,Yl,Gl,Zl,Ql,ec,tc,nc,ac,ic,rc;const{defineElement:oc,property:sc,event:lc,method:cc}=(0,u.createDecorators)();let dc;var pc=new WeakMap,hc=new WeakMap,uc=new WeakMap,mc=new WeakMap,vc=new WeakMap,gc=new WeakMap,bc=new WeakSet,fc=new WeakMap;class Ac extends m.ReactNextElement{constructor(){super(...arguments),(0,i.A)(this,bc),(0,r.A)(this,pc,(Kl(this),Jl(this))),(0,r.A)(this,hc,(Xl(this),Hl(this))),(0,r.A)(this,uc,(ql(this),Yl(this))),(0,r.A)(this,mc,(Gl(this),Zl(this))),(0,r.A)(this,vc,(Ql(this),ec(this))),(0,r.A)(this,gc,(tc(this),nc(this))),(0,r.A)(this,fc,(rc(this),e=>{(0,s.A)(bc,this,ac).emit(e)}))}get storyboard(){return(0,c.A)(pc,this)}set storyboard(e){(0,l.A)(pc,this,e)}get theme(){return(0,c.A)(hc,this)}set theme(e){(0,l.A)(hc,this,e)}get uiVersion(){return(0,c.A)(uc,this)}set uiVersion(e){(0,l.A)(uc,this,e)}get app(){return(0,c.A)(mc,this)}set app(e){(0,l.A)(mc,this,e)}get inspecting(){return(0,c.A)(vc,this)}set inspecting(e){(0,l.A)(vc,this,e)}select(e){var t;const n=null===(t=this.shadowRoot)||void 0===t||null===(t=t.querySelector("iframe"))||void 0===t?void 0:t.contentWindow;null==n||n.postMessage({channel:"chat-preview",type:"select",payload:e},location.origin)}render(){return h().createElement(yc,{storyboard:this.storyboard,theme:this.theme,uiVersion:this.uiVersion,app:this.app,inspecting:this.inspecting,onActiveTargetChange:(0,c.A)(fc,this)})}}function yc(e){let{storyboard:t,theme:n,uiVersion:a,app:i,inspecting:r,onActiveTargetChange:o}=e;const s=(0,p.useRef)(),[l,c]=(0,p.useState)(!1),[d,u]=(0,p.useState)(!1),[m,v]=(0,p.useState)({x:0,y:0}),[g,b]=(0,p.useState)([]),[A,y]=(0,p.useState)([]),[k,E]=(0,p.useState)([]),[w,x]=(0,p.useState)([]),N=(0,p.useCallback)((()=>{const e=()=>{var t;const n=null===(t=s.current)||void 0===t?void 0:t.contentWindow;null!=n&&n._preview_only_render?c(!0):setTimeout(e,100)};e()}),[]);(0,p.useEffect)((()=>{var e;if(!l)return;const t=Qe.__secret_internals.getBrickPackagesById("bricks/visual-builder");if(!t)throw new Error("Cannot find preview agent package: bricks/visual-builder");(null===(e=s.current)||void 0===e||null===(e=e.contentWindow)||void 0===e?void 0:e._preview_only_inject)("visual-builder.inject-chat-preview-agent",{...t,filePath:`${location.origin}${(0,Qe.getBasePath)()}${window.PUBLIC_ROOT??""}${t.filePath}`})}),[l]),(0,p.useEffect)((()=>{var e;if(!l)return;const r=null===(e=s.current)||void 0===e||null===(e=e.contentWindow)||void 0===e?void 0:e._preview_only_render;r&&r("yaml",{yaml:(0,Fl.safeDump)(t,{schema:Fl.JSON_SCHEMA,skipInvalid:!0,noRefs:!0,noCompatMode:!0})},{app:i,theme:n,uiVersion:a})}),[i,l,t,n,a]);const C=(0,p.useMemo)((()=>{if(d)return()=>{setTimeout((()=>{window.postMessage({channel:"chat-preview",type:"inspect-hover",payload:{outlines:[]}})}),100)}}),[d]);(0,p.useEffect)((()=>{const e=e=>{var t;if("chat-preview"===(null===(t=e.data)||void 0===t?void 0:t.channel))switch(e.data.type){case"initialized":u(!0);break;case"inspect-hover":b(e.data.payload.outlines);break;case"scroll":v(e.data.payload);break;case"inspect-active":y(e.data.payload.outlines)}};return window.addEventListener("message",e),()=>{window.removeEventListener("message",e)}}),[]),(0,p.useEffect)((()=>{var e;d&&(null===(e=s.current)||void 0===e||null===(e=e.contentWindow)||void 0===e||e.postMessage({channel:"chat-preview",type:"toggle-inspecting",payload:{inspecting:r}},location.origin))}),[d,r]);const T=(0,p.useCallback)((e=>e.map((e=>{var t,n;const a=(null==s||null===(t=s.current)||void 0===t?void 0:t.offsetLeft)??0,i=(null==s||null===(n=s.current)||void 0===n?void 0:n.offsetTop)??0,{width:r,height:o,left:l,top:c,...d}=e;return{width:1*r,height:1*o,left:1*(l-m.x)+a,top:1*(c-m.y)+i,...d}}))),[m.x,m.y]);return(0,p.useEffect)((()=>{o(A[0])}),[A,o]),(0,p.useEffect)((()=>{x(T(A))}),[A,T]),(0,p.useEffect)((()=>{E(T(g))}),[g,T]),h().createElement("div",{className:f()("container",{inspecting:r})},h().createElement("iframe",{ref:s,src:`${(0,Qe.getBasePath)()}_brick-preview-v3_/preview/`,loading:"lazy",onLoad:N,onMouseOut:C}),k.map(((e,t)=>h().createElement(Ul,(0,Bl.A)({key:t,variant:"hover"},e)))),w.map(((e,t)=>h().createElement(Ul,(0,Bl.A)({key:t,variant:"active"},e)))))}zl=Ac,({e:[Jl,Xl,Hl,ql,Yl,Gl,Zl,Ql,ec,tc,nc,ac,ic,rc,Kl],c:[dc,jl]}=(0,d.A)(zl,[oc("visual-builder.chat-preview",{styleTexts:[Vl.A]})],[[sc({attribute:!1}),1,"storyboard"],[sc(),1,"theme"],[sc(),1,"uiVersion"],[sc(),1,"app"],[sc({type:Boolean}),1,"inspecting"],[lc({type:"activeTarget.change"}),1,"activeTargetChangeEvent",e=>(0,c.A)(gc,e),(e,t)=>(0,l.A)(gc,e,t)],[cc(),2,"select"]],0,(e=>fc.has((0,o.A)(e))),m.ReactNextElement)),jl();let kc=!1;const Ec="item:";let wc=null;function xc(e){e.preventDefault(),e.stopPropagation(),function(e){const t=Lc(e.composedPath());window.parent.postMessage({channel:"chat-preview",type:"inspect-active",payload:{outlines:t.map(Sc)}},location.origin)}(e)}function Nc(e){e.preventDefault(),e.stopPropagation()}const Cc=(0,tt.debounce)(((e,t,n)=>{let a=Lc(e);if(0===a.length)for(const i of e)if(i instanceof HTMLElement&&i.shadowRoot){a=Lc(i.shadowRoot.elementsFromPoint(t,n));break}const i=a.length>0?a[0].element:null;i!==wc&&(wc=i,window.parent.postMessage({channel:"chat-preview",type:"inspect-hover",payload:{outlines:a.map(Sc)}},location.origin))}),20,{leading:!0});function Tc(e){Cc(e.composedPath(),e.clientX,e.clientY)}function Mc(e){e.preventDefault(),e.stopPropagation(),wc=null,window.parent.postMessage({channel:"chat-preview",type:"inspect-hover",payload:{outlines:[]}},location.origin)}function Lc(e){const t=[];return e.forEach((e=>{let n;if(e.nodeType===Node.ELEMENT_NODE&&e instanceof HTMLElement&&(n=e.dataset.iid)&&n.startsWith(Ec)){const a=n.substring(Ec.length);t.push({type:"item",uuid:a,label:Oc(e),element:e})}})),t}function Sc(e){const{element:t,type:n,uuid:a,label:i}=e,{width:r,height:o,left:s,top:l}=t.getBoundingClientRect();return{width:r,height:o,left:s+window.scrollX,top:l+window.scrollY,type:n,uuid:a,label:i}}function Oc(e){return e.tagName.toLowerCase().split(".").pop()}let Ic=!1;function Rc(e){window.parent.postMessage({channel:"chat-preview",...e},location.origin)}customElements.define("visual-builder.inject-chat-preview-agent",(0,As.createProviderClass)((async function(){Ic||(Ic=!0,n.e(2201).then(n.bind(n,2201)),Rc({type:"initialized"}),window.addEventListener("message",(e=>{var t;if("chat-preview"===(null===(t=e.data)||void 0===t?void 0:t.channel))switch(e.data.type){case"toggle-inspecting":!function(e){if(kc===e)return;kc=e;const t=e?"addEventListener":"removeEventListener";window[t]("click",xc,!0),window[t]("mousedown",Nc,!0),window[t]("mouseover",Nc,!0),window[t]("mouseup",Nc,!0),window[t]("pointerdown",Nc,!0),window[t]("pointerover",Nc,!0),window[t]("pointerup",Nc,!0),window[t]("pointerleave",Mc,!0),window[t]("pointermove",Tc,!0)}(e.data.payload.inspecting);break;case"select":!function(e){const t=function(e,t){const n=[];return function t(a){const i=a.querySelectorAll(`[data-iid="${e}"]`);if(n.push(...i),!(a===document&&i.length>0))for(const e of a.querySelectorAll("*"))e.shadowRoot&&t(e.shadowRoot)}(document),n}(`${e.type}:${e.uuid}`);window.parent.postMessage({channel:"chat-preview",type:"inspect-active",payload:{outlines:t.map((t=>Sc({...e,element:t,label:Oc(t)})))}},location.origin)}(e.data.payload)}})),window.addEventListener("scroll",(()=>{Rc({type:"scroll",payload:{x:window.scrollX,y:window.scrollY}})})))})));var _c,Pc=n(4014),Dc=n(8918);let Wc,$c,Bc,Fc,Uc,zc,Vc,Kc,jc,Jc,Xc;const{defineElement:Hc,property:qc}=(0,u.createDecorators)();let Yc;var Gc=new WeakMap,Zc=new WeakMap,Qc=new WeakMap,ed=new WeakMap,td=new WeakMap;class nd extends m.ReactNextElement{constructor(){super(...arguments),(0,r.A)(this,Gc,$c(this)),(0,r.A)(this,Zc,(Bc(this),Fc(this))),(0,r.A)(this,Qc,(Uc(this),zc(this))),(0,r.A)(this,ed,(Vc(this),Kc(this))),(0,r.A)(this,td,(jc(this),Jc(this))),Xc(this)}get generations(){return(0,c.A)(Gc,this)}set generations(e){(0,l.A)(Gc,this,e)}get category(){return(0,c.A)(Zc,this)}set category(e){(0,l.A)(Zc,this,e)}get theme(){return(0,c.A)(Qc,this)}set theme(e){(0,l.A)(Qc,this,e)}get uiVersion(){return(0,c.A)(ed,this)}set uiVersion(e){(0,l.A)(ed,this,e)}get app(){return(0,c.A)(td,this)}set app(e){(0,l.A)(td,this,e)}render(){return h().createElement(ad,{generations:this.generations,category:this.category,theme:this.theme,uiVersion:this.uiVersion,app:this.app})}}function ad(e){let{generations:t,category:n,theme:a,uiVersion:i,app:r}=e;const o=(0,p.useRef)(),[s,l]=(0,p.useState)(!1),[c,d]=(0,p.useState)(!1),u=(0,p.useCallback)((()=>{const e=()=>{var t;const n=null===(t=o.current)||void 0===t?void 0:t.contentWindow;null!=n&&n._preview_only_render?l(!0):setTimeout(e,100)};e()}),[]);return(0,p.useEffect)((()=>{if(!s)return;const e=Qe.__secret_internals.getBrickPackagesById("bricks/visual-builder");if(!e)throw new Error("Cannot find preview agent package: bricks/visual-builder");const t=o.current.contentWindow._preview_only_inject,n={...e,filePath:`${location.origin}${(0,Qe.getBasePath)()}${window.PUBLIC_ROOT??""}${e.filePath}`};Promise.allSettled(["visual-builder.pre-generated-table-view","visual-builder.pre-generated-container"].map((e=>t(e,n,void 0,!0)))).then((()=>{d(!0)}))}),[s]),(0,p.useEffect)((()=>{var e;if(!c)return;const s=null===(e=o.current)||void 0===e||null===(e=e.contentWindow)||void 0===e?void 0:e._preview_only_render;if(!s)return;const l=new Map,d=new Map;for(const e of t){let t=l.get(e.propertyId);t||l.set(e.propertyId,t=new Map);let n=t.get(e.rwType);n||t.set(e.rwType,n=new Map),n.set(e.displayLevel??0,e),d.set(e.propertyId,e.mockData)}const p=[{brick:"div",properties:{textContent:"属性",className:"head-cell"}},{brick:"div",properties:{textContent:"类别",className:"head-cell"}},{brick:"div",properties:{textContent:"展示等级",className:"head-cell last-col-cell",style:{gridColumn:"span 5",textAlign:"center"}}}],h={brick:"visual-builder.pre-generated-table-view",properties:{style:{gridTemplateColumns:"120px 80px repeat(5, 1fr)"}},children:p};let u=0;for(const[e,t]of l){let a=0;const i=u===l.size-1;for(const[r,o]of t){if(0===a){let n;for(const t of o.values()){n=t.propertyName??e;break}p.push({brick:"div",properties:{textContent:n,className:f()("body-cell",{"last-row-cell":i}),style:{gridRow:`span ${t.size}`}}})}const s=i&&a===t.size-1;p.push({brick:"div",properties:{textContent:r,className:f()("body-cell",{"last-row-cell":s})}});for(let t=-2;t<3;t++){var m;const a=o.get(t),i=(null==a?void 0:a.category)??n;let r;if(null!=a&&null!==(m=a.mockData)&&void 0!==m&&m.length){const t=a.mockData[Math.floor(Math.random()*a.mockData.length)];switch(i){case"detail-item":case"form-item":case"card-item":r={[e]:t};break;case"table-column":r={cellData:t}}}const l=[].concat((null==a?void 0:a.storyboard)??[]).filter((e=>!!(0,As.isObject)(e)||(console.error("Unexpected type of storyboard:",typeof e),!1)));let c;switch(l.forEach(id),i){case"form-item":c={brick:"eo-form",properties:{layout:"inline",values:r,className:"form-container"},children:l.map((e=>({...e,errorBoundary:!0})))};break;case"card-item":c={brick:":forEach",dataSource:[r],children:l.map((e=>({...e,errorBoundary:!0})))};break;default:c={brick:"visual-builder.pre-generated-container",properties:{useBrick:l,dataSource:r},errorBoundary:!0}}p.push({brick:"div",properties:{className:f()("body-cell",{"last-col-cell":2===t,"last-row-cell":s})},children:[{...c,errorBoundary:!0}]})}a++}u++}s("yaml",{yaml:(0,Fl.safeDump)(h,{schema:Fl.JSON_SCHEMA,skipInvalid:!0,noRefs:!0,noCompatMode:!0})},{app:r,theme:a,uiVersion:i,styleText:Dc.A})}),[r,c,t,a,i,n]),h().createElement("div",{className:f()("container")},h().createElement("iframe",{ref:o,src:`${(0,Qe.getBasePath)()}_brick-preview-v3_/preview/`,loading:"lazy",onLoad:u}))}function id(e){var t;null!==(t=e.properties)&&void 0!==t&&t.prefix&&(console.error("Unexpected readonly property of 'prefix' in:",e),delete e.properties.prefix)}_c=nd,({e:[$c,Bc,Fc,Uc,zc,Vc,Kc,jc,Jc,Xc],c:[Yc,Wc]}=(0,d.A)(_c,[Hc("visual-builder.pre-generated-preview",{styleTexts:[Pc.A]})],[[qc({attribute:!1}),1,"generations"],[qc(),1,"category"],[qc(),1,"theme"],[qc(),1,"uiVersion"],[qc(),1,"app"]],0,void 0,m.ReactNextElement)),Wc();var rd,od=n(9216);let sd;const{defineElement:ld}=(0,u.createDecorators)();let cd;class dd extends m.ReactNextElement{render(){return h().createElement(pd,null)}}function pd(){return h().createElement("slot",null)}rd=dd,[cd,sd]=(0,d.A)(rd,[ld("visual-builder.pre-generated-table-view",{styleTexts:[od.A]})],[],0,void 0,m.ReactNextElement).c,sd();var hd,ud=n(4967);let md,vd,gd,bd,fd;const{defineElement:Ad,property:yd}=(0,u.createDecorators)();let kd;var Ed=new WeakMap,wd=new WeakMap;class xd extends m.ReactNextElement{constructor(){super(...arguments),(0,r.A)(this,Ed,vd(this)),(0,r.A)(this,wd,(gd(this),bd(this))),fd(this)}get useBrick(){return(0,c.A)(Ed,this)}set useBrick(e){(0,l.A)(Ed,this,e)}get dataSource(){return(0,c.A)(wd,this)}set dataSource(e){(0,l.A)(wd,this,e)}render(){return h().createElement(Nd,{useBrick:this.useBrick,dataSource:this.dataSource})}}function Nd(e){let{useBrick:t,dataSource:n}=e;return h().createElement(no.ReactUseMultipleBricks,{useBrick:t,data:n,errorBoundary:!0})}hd=xd,({e:[vd,gd,bd,fd],c:[kd,md]}=(0,d.A)(hd,[Ad("visual-builder.pre-generated-container",{styleTexts:[ud.A]})],[[yd({attribute:!1}),1,"useBrick"],[yd({attribute:!1}),1,"dataSource"]],0,void 0,m.ReactNextElement)),md(),n(2080),customElements.define("visual-builder.check-editor-by-name",(0,As.createProviderClass)((async function(e){try{await Qe.__secret_internals.loadEditors([e])}catch{return!1}return!!Qe.customEditors.get(e)})));var Cd=n(4958);function Td(e,t){const n=new Map;for(const a of e){const e=(0,Cd.collectMemberUsage)([a.if,a.value,a.resolve],t);n.set(a,e)}return n}function Md(e,t){e.forEach((n=>{!function(e,t){var n;const{dependencyList:a,nodeList:i,parents:r,result:o}=t,s=(0,tt.cloneDeep)(e);o.push(s);const l=a.find((e=>e.node.key===s.key));if(null!==(n=l.deps)&&void 0!==n&&n.length&&!r.some((e=>e.key===s.key))){const e=s.children=[];!function(e,t){const n=[];e.deps.forEach((e=>{const a=t.nodeList.filter((t=>t.name===e));n.push(...a)})),Md(n,t)}(l,{dependencyList:a,nodeList:i,parents:[...r,s],result:e})}}(n,{...t,nodeList:e})}))}function Ld(e,t){const n=`[${JSON.stringify(t)}]`;let a;switch(e.display){case"link":case"text":a=Od(e,n),"struct-list"!==e.type||e.countOnly?"link"===e.display&&(a={brick:"eo-link",errorBoundary:!0,children:[a]}):a={brick:"eo-tag",errorBoundary:!0,children:[a]};break;case"tag":{var i,r,o,s,l;const t="background"===(null===(i=e.style)||void 0===i?void 0:i.variant)?"-inverse":"",c=Id(e,n);a={brick:"eo-tag",errorBoundary:!0,properties:{textContent:`<% ${c} %>`,size:Rd(null===(r=e.style)||void 0===r?void 0:r.size),color:null!==(o=e.style)&&void 0!==o&&o.background?`${e.style.background}${t}`:null!==(s=e.style)&&void 0!==s&&s.palette?`<% \`\${(${JSON.stringify(e.style.palette)})[${c}] ?? "gray"}${t}\` %>`:`gray${t}`,outline:"outline"===(null===(l=e.style)||void 0===l?void 0:l.variant)}};break}case"icon":a=Sd(e,n);break;case"icon+text":a={brick:"span",errorBoundary:!0,properties:{style:{display:"inline-flex",alignItems:"center",gap:"0.5em"}},children:[Sd(e,n),Od(e,n)]};break;default:return null}if("struct-list"!==e.type||e.countOnly)return a;const c=Number(e.maxItems)||3;return{brick:"span",errorBoundary:!0,properties:{style:{display:"inline-flex",alignItems:"center",gap:"0.5em"}},children:[{brick:":forEach",dataSource:`<% DATA${n}.slice(0, ${c}) %>`,children:[a]},{brick:"eo-link",if:`<% DATA${n}.length > ${c} %>`,properties:{textContent:`<% \`+ \${DATA${n}.length - ${c}}\` %>`}}]}}function Sd(e,t){if("boolean"===e.type){var n,a,i,r;const o=Id(e,t),s=(null===(n=e.true)||void 0===n?void 0:n.icon)??"check",l=(null===(a=e.false)||void 0===a?void 0:a.icon)??"xmark",c=_d(null===(i=e.true)||void 0===i?void 0:i.style),d=_d(null===(r=e.false)||void 0===r?void 0:r.style);return{brick:"eo-icon",errorBoundary:!0,properties:{lib:"fa",prefix:"fas",icon:`<% ${o} ? ${JSON.stringify(s)} : ${JSON.stringify(l)} %>`,style:`<% ${o} ? ${JSON.stringify(c)} : ${JSON.stringify(d)} %>`}}}return{brick:"eo-icon",errorBoundary:!0,properties:{lib:"fa",prefix:"fas",icon:e.icon,style:_d(e.style)}}}function Od(e,t){var n;if("struct-list"===e.type&&e.countOnly)return{brick:"span",properties:{textContent:`<% \`\${DATA${t}.length}\` %>`}};const a=Id(e,t),i=`<% ${a} %>`;switch(null===(n=e.formatter)||void 0===n?void 0:n.type){case"number":return{brick:"eo-formatter-number",errorBoundary:!0,properties:{value:i,type:e.formatter.format,...(0,tt.pick)(e.formatter,["currency","originalUnit","decimals","thousandsSeparator"]),style:_d(e.style)}};case"date":case"date-time":return{brick:"eo-humanize-time",errorBoundary:!0,properties:{value:i,type:"date"===e.type?"date":void 0,formatter:e.formatter.format,style:_d(e.style)}};case"cost-time":return{brick:"eo-humanize-time",errorBoundary:!0,properties:{value:i,isCostTime:!0,style:_d(e.style)}};default:{let t,n;if("boolean"===e.type){var r,o,s,l;const i=(null===(r=e.true)||void 0===r?void 0:r.text)??"Yes",c=(null===(o=e.false)||void 0===o?void 0:o.text)??"No",d=_d(null===(s=e.true)||void 0===s?void 0:s.style),p=_d(null===(l=e.false)||void 0===l?void 0:l.style);t=`<% ${a} ? ${JSON.stringify(i)} : ${JSON.stringify(c)} %>`,n=`<% ${a} ? ${JSON.stringify(d)} : ${JSON.stringify(p)} %>`}else t=i,n=_d(e.style);return{brick:"span",errorBoundary:!0,properties:{textContent:t,style:n}}}}}function Id(e,t){return"struct"!==e.type&&"struct-list"!==e.type||!e.field?`DATA${t}`:`${"struct"===e.type?`DATA${t}`:"ITEM"}[${JSON.stringify(e.field)}]`}function Rd(e){switch(e){case"large":case"medium":case"small":return e;case"x-large":return"large"}}function _d(e){if(!e)return;const t={};switch(e.size){case"small":t.fontSize="var(--sub-title-font-size-small)";break;case"medium":t.fontSize="var(--normal-font-size)";break;case"large":t.fontSize="var(--card-title-font-size)";break;case"x-large":t.fontSize="var(--title-font-size-larger)"}switch(e.fontWeight){case"bold":case"normal":t.fontWeight=e.fontWeight}return e.color&&(t.color=e.color),t}customElements.define("visual-builder.get-data-deps",(0,As.createProviderClass)(Td)),customElements.define("visual-builder.get-dependency-tree",(0,As.createProviderClass)((function(e,t){const n=e,a=Td(n.map((e=>e.data)),t.dataType),i=[];for(const[e,t]of a)i.push({deps:Array.from(t.usedProperties),node:n.find((t=>t.data===e))});const r=[];return Md(n,{result:r,dependencyList:i,parents:[]}),r})));var Pd,Dd=n(9034),Wd=n(4162);let $d,Bd,Fd,Ud,zd,Vd,Kd,jd,Jd,Xd,Hd,qd,Yd,Gd,Zd,Qd,ep,tp,np,ap,ip,rp,op,sp,lp,cp,dp,pp,hp;const{defineElement:up,property:mp,event:vp}=(0,u.createDecorators)();let gp;var bp=new WeakMap,fp=new WeakMap,Ap=new WeakMap,yp=new WeakMap,kp=new WeakMap,Ep=new WeakMap,wp=new WeakMap,xp=new WeakMap,Np=new WeakMap,Cp=new WeakSet,Tp=new WeakMap,Mp=new WeakMap,Lp=new WeakMap,Sp=new WeakMap,Op=new WeakMap;class Ip extends m.ReactNextElement{constructor(){super(...arguments),(0,i.A)(this,Cp),(0,r.A)(this,bp,Bd(this)),(0,r.A)(this,fp,(Fd(this),Ud(this))),(0,r.A)(this,Ap,(zd(this),Vd(this))),(0,r.A)(this,yp,(Kd(this),jd(this))),(0,r.A)(this,kp,(Jd(this),Xd(this))),(0,r.A)(this,Ep,(Hd(this),qd(this))),(0,r.A)(this,wp,(Yd(this),Gd(this))),(0,r.A)(this,xp,(Zd(this),Qd(this))),(0,r.A)(this,Np,(ep(this),tp(this))),(0,r.A)(this,Tp,(ip(this),e=>{(0,s.A)(Cp,this,np).emit(e)})),(0,r.A)(this,Mp,rp(this)),(0,r.A)(this,Lp,(lp(this),e=>{(0,s.A)(Cp,this,op).emit(e)})),(0,r.A)(this,Sp,cp(this)),(0,r.A)(this,Op,(hp(this),e=>{(0,s.A)(Cp,this,dp).emit(e)}))}get previewUrl(){return(0,c.A)(bp,this)}set previewUrl(e){(0,l.A)(bp,this,e)}get generations(){return(0,c.A)(fp,this)}set generations(e){(0,l.A)(fp,this,e)}get mocks(){return(0,c.A)(Ap,this)}set mocks(e){(0,l.A)(Ap,this,e)}get busy(){return(0,c.A)(yp,this)}set busy(e){(0,l.A)(yp,this,e)}get category(){return(0,c.A)(kp,this)}set category(e){(0,l.A)(kp,this,e)}get theme(){return(0,c.A)(Ep,this)}set theme(e){(0,l.A)(Ep,this,e)}get uiVersion(){return(0,c.A)(wp,this)}set uiVersion(e){(0,l.A)(wp,this,e)}get app(){return(0,c.A)(xp,this)}set app(e){(0,l.A)(xp,this,e)}render(){return h().createElement(Rp,{previewUrl:this.previewUrl,generations:this.generations,mocks:this.mocks,busy:this.busy,category:this.category,theme:this.theme,uiVersion:this.uiVersion,app:this.app,onComment:(0,c.A)(Tp,this),onApprove:(0,c.A)(Lp,this),onViewAttrPrompt:(0,c.A)(Op,this)})}}function Rp(e){let{previewUrl:t,generations:n,mocks:a,busy:i,category:r,theme:o,uiVersion:s,app:l,onComment:c,onApprove:d,onViewAttrPrompt:u}=e;const m=(0,p.useRef)(),[v,g]=(0,p.useState)(!1),[b,A]=(0,p.useState)(!1),y=(0,p.useRef)([]),k=(0,p.useRef)([]),E=(0,p.useRef)([]);(0,p.useEffect)((()=>{E.current=(null==n?void 0:n.filter((e=>e.approved)).map((e=>e.propertyId)))??[]}),[n]);const w=(0,p.useCallback)((()=>{const e=()=>{var t;const n=null===(t=m.current)||void 0===t?void 0:t.contentWindow;null!=n&&n._preview_only_render?g(!0):setTimeout(e,100)};e()}),[]);return(0,p.useEffect)((()=>{v&&m.current.contentWindow.postMessage({channel:"raw-data-preview",type:"busy",payload:i},location.origin)}),[i,v]),(0,p.useEffect)((()=>{if(v){const e=m.current.contentWindow,t=e=>{let{data:t}=e;if("raw-data-preview"===(null==t?void 0:t.channel))switch(t.type){case"comment":c(t.payload);break;case"approve":d(t.payload);break;case"viewAttrPrompt":u(t.payload);break;case"updatePropertyToggleState":y.current=t.payload;break;case"updatePropertyExpandState":k.current=t.payload;break;case"updatePropertyApproveState":E.current=t.payload}};return e.addEventListener("message",t),()=>{e.removeEventListener("message",t)}}}),[d,c,v]),(0,p.useEffect)((()=>{if(!v)return;const e=Qe.__secret_internals.getBrickPackagesById("bricks/visual-builder");if(!e)throw new Error("Cannot find preview agent package: bricks/visual-builder");const n=m.current.contentWindow._preview_only_inject,a={...e,filePath:t?new URL(e.filePath,new URL(t,location.origin)).toString():`${location.origin}${(0,Qe.getBasePath)()}${window.PUBLIC_ROOT??""}${e.filePath}`};Promise.allSettled(["visual-builder.pre-generated-table-view","visual-builder.pre-generated-container"].map((e=>n(e,a,void 0,!0)))).then((()=>{A(!0)}))}),[t,v]),(0,p.useEffect)((()=>{var e;if(!b)return;const t=null===(e=m.current)||void 0===e||null===(e=e.contentWindow)||void 0===e?void 0:e._preview_only_render;if(!t)return;const i=[{brick:"div",properties:{textContent:"属性",className:"head-cell"}},{brick:"div",properties:{textContent:"",className:"head-cell"}},{brick:"div",properties:{textContent:"类型",className:"head-cell"}},{brick:"div",properties:{textContent:"原始数据",className:"head-cell"}},{brick:"div",properties:{textContent:"视觉重量 (由低至高)",className:"head-cell",style:{gridColumn:"span 4",textAlign:"center"}}},{brick:"div",properties:{textContent:"确认",className:"head-cell"}},{brick:"div",properties:{className:"head-cell last-col-cell"},children:[{brick:"span",properties:{textContent:"批注"}},{brick:"span",properties:{className:"tips",textContent:"（补充提示词，按住 ⌘ 或 ctrl + 回车提交）"}}]}],r={brick:"visual-builder.pre-generated-table-view",context:[{name:"propertyToggleState",value:y.current,onChange:{action:"window.postMessage",args:[{channel:"raw-data-preview",type:"updatePropertyToggleState",payload:"<% CTX.propertyToggleState %>"}]}},{name:"propertyExpandState",value:k.current,onChange:{action:"window.postMessage",args:[{channel:"raw-data-preview",type:"updatePropertyExpandState",payload:"<% CTX.propertyExpandState %>"}]}},{name:"propertyApproveState",value:E.current,onChange:{action:"window.postMessage",args:[{channel:"raw-data-preview",type:"updatePropertyApproveState",payload:"<% CTX.propertyApproveState %>"}]}},{name:"busy"}],properties:{style:{gridTemplateColumns:"minmax(120px, 0.5fr) 32px auto repeat(5, 1fr) auto 1fr"}},children:i};for(let e=0,t=n.length;e<t;e++){var c;const r=n[e],o=e===t-1,s=new Map;for(const e of r.candidates??[])s.set(e.visualWeight??0,e);i.push({brick:"div",properties:{className:f()("body-cell",{"last-row-cell":o})},children:[{brick:"span",properties:{textContent:`${r.propertyName??r.propertyId}`}},{brick:"eo-button",properties:{className:"btn-toggle",type:"text",icon:`<%=\n                  {\n                    lib: "fa",\n                    prefix: "fas",\n                    icon: CTX.propertyToggleState.includes(${JSON.stringify(r.propertyId)}) ? "chevron-up" : "chevron-down",\n                  }\n                %>`},events:{click:{action:"context.replace",args:["propertyToggleState",`<%\n                      CTX.propertyToggleState.includes(${JSON.stringify(r.propertyId)})\n                        ? CTX.propertyToggleState.filter((id) => id !== ${JSON.stringify(r.propertyId)})\n                        : CTX.propertyToggleState.concat(${JSON.stringify(r.propertyId)})\n                    %>`]}}}]},{brick:"div",properties:{className:f()("body-cell",{"last-row-cell":o})},children:null!==(c=r.candidates)&&void 0!==c&&c.length?[{brick:"eo-icon",properties:{lib:"fa",prefix:"fas",icon:"circle",style:{color:r.generationId?"var(--palette-green-6)":"var(--palette-gray-6)",transformOrigin:"center center",transform:"scale(0.5)"}}}]:void 0},{brick:"div",properties:{className:f()("body-cell",{"last-row-cell":o})},children:[{brick:"eo-link",properties:{type:"text",textContent:r.propertyType},events:{click:{action:"window.postMessage",args:[{channel:"raw-data-preview",type:"viewAttrPrompt",payload:r}]}}}]});let l=r.propertyValues;if(!l){const e=(r.mockData??a??[]).slice();e.sort(((e,t)=>{const n=null==e?void 0:e[r.propertyId],a=null==t?void 0:t[r.propertyId],i=Array.isArray(n),o=Array.isArray(a);if(i||o)return(o?a.length:-1)-(i?n.length:-1);const s=null==n,l=null==a;if(s||l)return(l?0:1)-(s?0:1);const c="string"==typeof n&&0===n.length,d="string"==typeof a&&0===a.length;return c||d?(d?0:1)-(c?0:1):0})),l=e.map((e=>e[r.propertyId]))}i.push({brick:"div",properties:{className:f()("body-cell",{"last-row-cell":o})},children:[{brick:"div",properties:{className:"list"},children:l.map(((e,t)=>({brick:"div",if:0===t||`<%= CTX.propertyToggleState.includes(${JSON.stringify(r.propertyId)}) %>`,properties:{className:`<%= \`raw-content\${ CTX.propertyExpandState.includes(${JSON.stringify(r.propertyId)}) ? " expand" : "" }\` %>`,textContent:void 0===e?"":"string"==typeof e?e:JSON.stringify(e,null,2)}})))},{brick:"eo-button",properties:{className:"btn-toggle",type:"text",icon:`<%=\n                {\n                  lib: "fa",\n                  prefix: "fas",\n                  icon: CTX.propertyExpandState.includes(${JSON.stringify(r.propertyId)}) ? "chevron-up" : "chevron-down",\n                }\n              %>`},events:{click:{action:"context.replace",args:["propertyExpandState",`<%\n                    CTX.propertyExpandState.includes(${JSON.stringify(r.propertyId)})\n                      ? CTX.propertyExpandState.filter((id) => id !== ${JSON.stringify(r.propertyId)})\n                      : CTX.propertyExpandState.concat(${JSON.stringify(r.propertyId)})\n                  %>`]}}}]});for(let e=-1;e<3;e++){const t=s.get(e);let n;t&&(n=Ld(t,r.propertyId)),i.push({brick:"div",properties:{className:f()("body-cell",{"last-row-cell":o})},children:[{brick:"div",properties:{className:"list"},children:n?l.map(((e,t)=>({brick:"visual-builder.pre-generated-container",if:0===t||`<%= CTX.propertyToggleState.includes(${JSON.stringify(r.propertyId)}) %>`,properties:{useBrick:[n],dataSource:{[r.propertyId]:e}},errorBoundary:!0}))):void 0}]})}i.push({brick:"div",properties:{className:f()("body-cell",{"last-row-cell":o})},children:r.candidates?[{brick:"eo-checkbox",properties:{value:`<%= CTX.propertyApproveState.includes(${JSON.stringify(r.propertyId)}) ? ["approved"] : [] %>`,options:[{label:"",value:"approved"}],disabled:"<%= CTX.busy %>"},events:{change:[{action:"window.postMessage",args:[{channel:"raw-data-preview",type:"approve",payload:{approved:"<% EVENT.detail.length > 0 %>",propertyInstanceId:r.propertyInstanceId}}]},{action:"context.replace",args:["propertyApproveState",`<%\n                            EVENT.detail.length > 0\n                              ? CTX.propertyApproveState.concat(${JSON.stringify(r.propertyId)})\n                              : CTX.propertyApproveState.filter((id) => id !== ${JSON.stringify(r.propertyId)})\n                          %>`]}]}}]:void 0},{brick:"div",properties:{className:f()("body-cell",{"last-col-cell":!0,"last-row-cell":o})},children:r.candidates?[{brick:"eo-textarea",properties:{value:r.comment?`<% ${JSON.stringify(r.comment)} %>`:void 0,autoSize:!0,style:{width:"100%"},disabled:`<%= CTX.busy || CTX.propertyApproveState.includes(${JSON.stringify(r.propertyId)}) %>`},events:{keydown:{if:"<% EVENT.code === 'Enter' && (EVENT.metaKey || EVENT.ctrlKey) %>",action:"window.postMessage",args:[{channel:"raw-data-preview",type:"comment",payload:{comment:"<% EVENT.target.value %>",propertyInstanceId:r.propertyInstanceId}}]}}}]:void 0})}t("yaml",{yaml:(0,Fl.safeDump)([r,{brick:"eo-message-listener",properties:{sameOrigin:!0},events:{message:{if:"<% EVENT.detail.data?.channel === 'raw-data-preview' && EVENT.detail.data.type === 'busy' %>",action:"context.replace",args:["busy","<% EVENT.detail.data.payload %>"]}},portal:!0,errorBoundary:!0}],{schema:Fl.JSON_SCHEMA,skipInvalid:!0,noRefs:!0,noCompatMode:!0})},{app:l,theme:o,uiVersion:s,styleText:Wd.A})}),[l,b,n,o,s,r,a]),h().createElement("div",{className:f()("container")},h().createElement("iframe",{ref:m,src:t??`${(0,Qe.getBasePath)()}_brick-preview-v3_/preview/`,loading:"lazy",onLoad:w}))}Pd=Ip,({e:[Bd,Fd,Ud,zd,Vd,Kd,jd,Jd,Xd,Hd,qd,Yd,Gd,Zd,Qd,ep,tp,np,ap,ip,rp,op,sp,lp,cp,dp,pp,hp],c:[gp,$d]}=(0,d.A)(Pd,[up("visual-builder.raw-data-preview",{styleTexts:[Dd.A]})],[[mp(),1,"previewUrl"],[mp({attribute:!1}),1,"generations"],[mp({attribute:!1}),1,"mocks"],[mp({type:Boolean}),1,"busy"],[mp(),1,"category"],[mp(),1,"theme"],[mp(),1,"uiVersion"],[mp(),1,"app"],[vp({type:"comment"}),1,"commentEvent",e=>(0,c.A)(Np,e),(e,t)=>(0,l.A)(Np,e,t)],[vp({type:"approve"}),1,"approveEvent",e=>(0,c.A)(Mp,e),(e,t)=>(0,l.A)(Mp,e,t)],[vp({type:"view.attr.prompt"}),1,"viewAttrPromptEvent",e=>(0,c.A)(Sp,e),(e,t)=>(0,l.A)(Sp,e,t)]],0,(e=>Op.has((0,o.A)(e))),m.ReactNextElement)),$d();var _p=n(264);customElements.define("visual-builder.parse-path",(0,As.createProviderClass)((async function(e,t){const n=[];return{regexp:(0,_p.MM)(e,n,(0,tt.defaults)(t,{end:!1,strict:!1,sensitive:!0})),keys:n}})));var Pp=function(){var e=(0,Ea.A)((function*(e,t,n){return(yield wa.http.post("api/gateway/cmdb.instance.CreateInstance/v2/object/".concat(e,"/instance"),t,n)).data}));return function(t,n,a){return e.apply(this,arguments)}}();customElements.define("visual-builder.batch-update-raw-data-generated-view",(0,As.createProviderClass)((async function(e){return Promise.allSettled(e.map((e=>{let{attrInstanceId:t,...n}=e;return Pp("RAW_DATA_GENERATED_VIEW@EASYOPS",{...n,attr:[t]})})))})));var Dp=n(3084),Wp=n(7710),$p=n(5799),Bp=n(4671),Fp=n(8397),Up=n(3404),zp=n(3287);customElements.define("visual-builder.get-raw-data-system-prompts",(0,As.createProviderClass)((function(){return{boolean:Dp,"date-time":Wp,enum:$p,number:Bp,others:Fp,"struct-list":Up,struct:zp}})))},2080:(e,t,n)=>{n.d(t,{ADVANCED_CHANGE_KEY:()=>Me,SchemaField:()=>Le});var a,i=n(4635),r=n(918),o=n(6902),s=n(5536),l=n(6121),c=n(829),d=n(2740),p=n(8769),h=n.n(p),u=n(300),m=n(4295),v=(n(6477),n(5908)),g=n(7091),b=n(8788),f=n(6768),A=n(6257),y=n(9708),k=n(9592),E=n(3768),w=n(2803),x=n(3824),N=n(2513),C=n(5067),T=n(1477),M=n(4287),L=n(966),S=n(5768),O=n(6110),I=n(5944),R=n(8409),_=n(5223),P=n(3995),D=(n(74),n(1030)),W=n.n(D);let $,B,F,U,z,V,K,j,J,X,H,q,Y,G,Z,Q,ee,te,ne,ae,ie,re,oe,se,le,ce,de,pe,he,ue,me,ve,ge,be,fe,Ae,ye,ke;const{defineElement:Ee,property:we,method:xe,event:Ne}=(0,u.createDecorators)(),Ce=h().forwardRef(et),Te="before_submit",Me="on_advanced_change",Le=(0,g.Uy)({components:{FormLayout:y.Hb,Input:y.pd,FormItem:w.M,FormItemWithoutAdvanced:y.eI,FormCollapse:y.w9,NumberPicker:y.Y_,Radio:y.sx,Select:y.l6,Switch:y.dO,CategoryTitle:E.H,CodeEditor:x.S,IconSelect:N.r,ColorPicker:C.h,UseChildrenSelect:S._,InputWithUrl:T.r,InputWithUnit:L.U,TextAlignRadio:M.p,CustomOptions:I.F,BoxSize:O.i,CustomTab:R.v}});let Se,Oe;var Ie=new WeakMap,Re=new WeakMap,_e=new WeakMap,Pe=new WeakMap,De=new WeakMap,We=new WeakMap,$e=new WeakMap,Be=new WeakMap,Fe=new WeakMap,Ue=new WeakMap,ze=new WeakSet,Ve=new WeakMap,Ke=new WeakMap,je=new WeakMap,Je=new WeakMap,Xe=new WeakMap,He=new WeakMap,qe=new WeakMap,Ye=new WeakMap,Ge=new WeakMap,Ze=new WeakMap;class Qe extends m.ReactNextElement{constructor(){super(...arguments),(0,i.A)(this,ze),(0,r.A)(this,Ie,($(this),(0,p.createRef)())),(0,r.A)(this,Re,F(this)),(0,r.A)(this,_e,(U(this),z(this))),(0,r.A)(this,Pe,(V(this),K(this))),(0,r.A)(this,De,(j(this),J(this))),(0,r.A)(this,We,(X(this),H(this))),(0,r.A)(this,$e,(q(this),Y(this))),(0,r.A)(this,Be,(G(this),Z(this))),(0,r.A)(this,Fe,(Q(this),ee(this))),(0,r.A)(this,Ue,(te(this),ne(this))),(0,r.A)(this,Ve,(re(this),oe(this))),(0,r.A)(this,Ke,(ce(this),de(this))),(0,r.A)(this,je,(ue(this),e=>{(0,s.A)(ze,this,pe).emit(e)})),(0,r.A)(this,Je,me(this)),(0,r.A)(this,Xe,(be(this),e=>{(0,s.A)(ze,this,ve).emit(e)})),(0,r.A)(this,He,void 0),(0,r.A)(this,qe,(0,v.fA)(Te,((e,t)=>n=>{(0,l.A)(He,this,n(e,t))}))),(0,r.A)(this,Ye,fe(this)),(0,r.A)(this,Ge,(ke(this),e=>{(0,s.A)(ze,this,Ae).emit(e)})),(0,r.A)(this,Ze,(e=>{const t="string"==typeof e&&"undefined"===e?void 0:(0,D.omit)(e,["dataset.testid"]),n=[];(0,D.isEmpty)(null==t?void 0:t.dataset)&&n.push("dataset"),(0,D.isEmpty)(null==t?void 0:t.style)&&n.push("style");const a=(0,D.omit)(t,n);if(!(0,D.isEmpty)(a))return a}))}get editorName(){return(0,c.A)(Re,this)}set editorName(e){(0,l.A)(Re,this,e)}get values(){return(0,c.A)(_e,this)}set values(e){(0,l.A)(_e,this,e)}get advancedMode(){return(0,c.A)(Pe,this)}set advancedMode(e){(0,l.A)(Pe,this,e)}get dataList(){return(0,c.A)(De,this)}set dataList(e){(0,l.A)(De,this,e)}get editorPackages(){return(0,c.A)(We,this)}set editorPackages(e){(0,l.A)(We,this,e)}get links(){return(0,c.A)($e,this)}set links(e){(0,l.A)($e,this,e)}get extraLibs(){return(0,c.A)(Be,this)}set extraLibs(e){(0,l.A)(Be,this,e)}get childSlots(){return(0,c.A)(Fe,this)}set childSlots(e){(0,l.A)(Fe,this,e)}validate(){var e;const t=null===(e=(0,c.A)(Ie,this).current)||void 0===e?void 0:e.getFormInstance();(0,l.A)(He,this,null),t.validate().then((()=>{if(this.advancedMode)(0,s.A)(ze,this,ae).emit(t.values[P.qZ]);else{const e=W().omit(t.values,[P.qZ]);t.notify(Te,e),(0,s.A)(ze,this,ae).emit((0,c.A)(He,this)??e)}})).catch((e=>{(0,s.A)(ze,this,se).emit(e)}))}render(){return h().createElement(Ce,{ref:(0,c.A)(Ie,this),editorName:this.editorName,values:(0,c.A)(Ze,this).call(this,this.values),advancedMode:this.advancedMode,dataList:this.dataList,extraLibs:this.extraLibs,links:this.links,childSlots:this.childSlots,editorPackages:this.editorPackages,handleValuesChange:(0,c.A)(je,this),handleTokenClick:(0,c.A)(Xe,this),handleTriggerAction:(0,c.A)(Ge,this),onSubmitEffect:(0,c.A)(qe,this)})}}function et(e,t){let{advancedMode:n,values:a,editorName:i,dataList:r,editorPackages:o,extraLibs:s,childSlots:l,links:c,handleValuesChange:d,handleTokenClick:u,handleTriggerAction:m,onSubmitEffect:y}=e;const[E,w]=(0,p.useState)(Se),x=(0,k.useCurrentTheme)(),N=(0,p.useMemo)((()=>(0,A.VC)()),[]),C=(0,p.useMemo)((()=>(0,v.DG)()),[E]),T=(0,p.useRef)(null),M=(0,p.useRef)(!1),L=(0,p.useMemo)((()=>(0,v.fA)(Me,((e,t)=>n=>{const a=!e&&t.values[P.qZ]?t.values[P.qZ]:t.values;T.current=n(e,t,a)}))),[]);(0,p.useImperativeHandle)(t,(()=>({getFormInstance:()=>C})));const S=(0,p.useCallback)((async()=>{_.customEditors.get(i)?w((()=>{var e;return null===(e=_.customEditors.get(i))||void 0===e?void 0:e(h())})):(await _.__secret_internals.loadEditors([i],o),Se=()=>{var e;return null===(e=_.customEditors.get(i))||void 0===e?void 0:e(h())},w(Se))}),[i,o]),O=(0,p.useCallback)(((e,t)=>{if(t){const t=W().omit(e,[P.qZ]);return{[P.qZ]:W().isEmpty(t)?"":t}}return e[P.qZ]??e}),[]);return(0,p.useEffect)((()=>{S()}),[S]),(0,p.useEffect)((()=>{E&&C.setInitialValues(a,"overwrite")}),[E,C]),(0,p.useEffect)((()=>{M.current=!0,T.current=null,C.notify(Me,n),C.query(P.N4).take((e=>{e.display=n?"hidden":"visible"})),C.query(P.qZ).take((e=>{e.display=n?"visible":"hidden"}));const e=C.getState().values,t=O(T.current??e,n);C.setValues(t,"overwrite"),M.current=!1}),[n,C,O,E]),(0,p.useEffect)((()=>{C.addEffects("onValueChange",(()=>{(0,v.A$)((e=>{M.current||d(e.values)}))}))}),[C,d]),E?h().createElement("div",{className:"property-form-wrapper"},h().createElement(b.Ay,{prefixCls:"antdV5",theme:{algorithm:"dark-v2"===x?f.A.darkAlgorithm:f.A.defaultAlgorithm,components:{InputNumber:{handleVisible:!0}}},getPopupContainer:e=>e},h().createElement(A.N7,{cache:N},h().createElement(g.Op,{form:C},h().createElement(E,{advancedMode:n,SchemaFieldComponent:Le,form:C,scope:{dataList:r,advancedMode:n,childSlots:l,extraLibs:s,links:c,tokenClick:e=>u(e.detail),triggerAction:m},effects:{onFieldInit:v.yd,onFieldValueChange:v.$l,onFieldInitialValueChange:v.J4,onFormInitialValuesChange:v.oJ,onFormValidateSuccess:v.zu,onFormValuesChange:v.A$,onSubmit:y,onAdvancedChange:L},formilySchemaFormatter:P.cV}))))):null}a=Qe,({e:[F,U,z,V,K,j,J,X,H,q,Y,G,Z,Q,ee,te,ne,ae,ie,re,oe,se,le,ce,de,pe,he,ue,me,ve,ge,be,fe,Ae,ye,ke,$],c:[Oe,B]}=(0,d.A)(a,[Ee("visual-builder.property-editor",{shadowOptions:!1,dependencies:["eo-icon-select","vs.code-editor","eo-tooltip"]})],[[we(),1,"editorName"],[we({attribute:!1}),1,"values"],[we({type:Boolean}),1,"advancedMode"],[we({attribute:!1}),1,"dataList"],[we({attribute:!1}),1,"editorPackages"],[we({attribute:!1}),1,"links"],[we({attribute:!1}),1,"extraLibs"],[we({attribute:!1}),1,"childSlots"],[Ne({type:"validate.success"}),1,"successEvent",e=>(0,c.A)(Ue,e),(e,t)=>(0,l.A)(Ue,e,t)],[Ne({type:"validate.error"}),1,"errorEvent",e=>(0,c.A)(Ve,e),(e,t)=>(0,l.A)(Ve,e,t)],[xe(),2,"validate"],[Ne({type:"values.change"}),1,"valuesChangeEvent",e=>(0,c.A)(Ke,e),(e,t)=>(0,l.A)(Ke,e,t)],[Ne({type:"token.click"}),1,"tokenClick",e=>(0,c.A)(Je,e),(e,t)=>(0,l.A)(Je,e,t)],[Ne({type:"trigger.action"}),1,"triggerActionEvent",e=>(0,c.A)(Ye,e),(e,t)=>(0,l.A)(Ye,e,t)]],0,(e=>Ze.has((0,o.A)(e))),m.ReactNextElement)),B()},607:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(6758),i=n.n(a),r=n(935),o=n.n(r)()(i());o.push([e.id,':root{--vb-workbench-action-list-background:#f8f8f8}html[data-theme="dark"],\nhtml[data-theme="dark-v2"]{--vb-workbench-action-list-background:#323237}',""]);const s=o},2984:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(6758),i=n.n(a),r=n(935),o=n.n(r)()(i());o.push([e.id,':root{--vb-workbench-action-color:#616161;--vb-workbench-action-active-color:#1f1f1f;--vb-workbench-action-active-border-color:#005fb8}html[data-theme="dark"],\nhtml[data-theme="dark-v2"]{--vb-workbench-action-color:rgba(255,255,255,0.4);--vb-workbench-action-active-color:#fff;--vb-workbench-action-active-border-color:#fff}',""]);const s=o},7236:(e,t,n)=>{n.d(t,{A:()=>c});var a=n(6758),i=n.n(a),r=n(935),o=n.n(r),s=n(6131),l=o()(i());l.i(s.A),l.push([e.id,':host{display:block}:host([hidden]){display:none}*{box-sizing:border-box}.message{display:flex;gap:8px}.main{flex:1;min-width:0}.label{font-weight:bold;line-height:28px}.message:not(:last-child){margin-bottom:2em}.invisible-dots{opacity:0}.failed .content{color:var(--color-error)}.command:not(:first-child){margin-top:1em}.command:not(:last-child){margin-bottom:1em}pre{white-space:pre-wrap;background-color:var(--palette-gray-3);border-radius:6px;padding:1em}.markdown > :first-child{margin-top:0}.markdown > :last-child{margin-bottom:0}.avatar{align-self:flex-start;display:flex;align-items:center;justify-content:center}.texting::after{content:"   ";animation:texting 2s infinite;white-space:pre}@keyframes texting{0%{content:"   "}25%{content:".  "}50%{content:".. "}75%{content:"..."}100%{content:"   "}}pre[class*="language-"]{overflow:visible}pre[class*="language-"],\ncode[class*="language-"]{white-space:pre-wrap}eo-avatar.role-assistant::part(avatar-icon){background-color:var(--palette-blue-5)}.content{word-wrap:break-word}.plain{white-space:pre-wrap}',""]);const c=l.toString()},1563:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(6758),i=n.n(a),r=n(935),o=n.n(r)()(i());o.push([e.id,":host{display:block}:host([hidden]){display:none}*{box-sizing:border-box}.container,\niframe{width:100%;height:100%;border-radius:4px}.container{position:relative;box-shadow:rgba(204,204,204,0.2) 0px 0px 0px 1px}iframe{display:block;border:none;margin:0;padding:0;transform-origin:0% 0%;-webkit-user-select:none;user-select:none}.outline{position:absolute;border-style:solid;border-width:2px;border-radius:0 4px 4px;pointer-events:none}.label{position:absolute;left:-2px;top:-20px;height:18px;line-height:16px;padding:2px 5px 0;font-size:12px;border-radius:4px 4px 0 0;white-space:nowrap}.outline.hover{border-color:rgba(var(--palette-blue-6-channel),0.3)}.outline.hover .label{background:rgba(var(--palette-blue-6-channel),0.3)}.outline.active{border-color:var(--palette-blue-6)}.outline.active .label{background:var(--palette-blue-6)}.container:not(.inspecting) .outline{display:none}",""]);const s=o.toString()},6213:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(6758),i=n.n(a),r=n(935),o=n.n(r)()(i());o.push([e.id,":host{display:inline-block}:host([hidden]){display:none}.contract-wrapper{display:flex;gap:4px}.contract-selector{flex:1}.version-selector{width:100px}.options-tips{padding:0px 10px;font-weight:400;color:#999;white-space:nowrap;font-style:italic}",""]);const s=o.toString()},7540:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(6758),i=n.n(a),r=n(935),o=n.n(r)()(i());o.push([e.id,":host{display:inline-block}:host([hidden]){display:none}.mask,\n.container{display:none;position:fixed;z-index:1}.mask{top:0;bottom:0;left:0;right:0;z-index:1}:host([active]) .mask,\n:host([active]) .container{display:block}.container{background:var(--antd-dropdown-menu-bg);border-radius:var(--medius-border-radius);padding:5px}.container .title{padding:5px 12px;cursor:default;color:var(--color-secondary-text);border-bottom:1px solid var(--color-text-divider-line)}.container eo-menu{border:none;padding:5px 0}:is(.container eo-menu) eo-menu-item:not([disabled]):hover::part(menu-item){background-color:var(--left-sidebar-item-hover-bg)}:is(.container eo-menu) eo-menu-item[disabled]::part(menu-item){cursor:not-allowed}:is(.container eo-menu) eo-menu-item::part(menu-item){cursor:grab;padding:5px 12px;border-radius:var(--medius-border-radius);min-width:max-content}:is(.container eo-menu) eo-menu-item.dragging{opacity:0.5}:is(.container eo-menu) eo-tooltip{display:block}",""]);const s=o.toString()},2381:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(6758),i=n.n(a),r=n(935),o=n.n(r)()(i());o.push([e.id,":host{--local-node-outline-style:solid;display:block}:host([hidden]){display:none}:host([not-synced]){--local-node-outline-style:dashed}*{box-sizing:border-box}.node{width:168px;max-width:none;height:130px;position:relative;display:flex;flex-direction:column;justify-content:space-between;align-items:center;cursor:pointer;-webkit-user-select:none;user-select:none}.node.board{height:70px;max-width:168px;width:-moz-fit-content;width:fit-content;padding-bottom:4px}.label,\n.label-input{width:100%;height:24px;padding:3px;border:none;line-height:18px;font-size:var(--sub-title-font-size-small);color:var(--color-header-text);font-weight:var(--font-weight-500);text-align:center;font-family:inherit;cursor:text;-webkit-user-select:text;user-select:text}.label{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.node.editing-label .label{height:0}.node:not(.editing-label) .label-input{display:none}.add-button,\n.icon-container,\n.thumbnail-container,\n.thumbnail-placeholder{display:flex;align-items:center;justify-content:center}.thumbnail-container{height:98px;outline:1px var(--local-node-outline-style) var(--palette-gray-4);opacity:1;border:4px solid transparent;border-radius:4px;width:100%;position:relative;flex-direction:column}.thumbnail-placeholder{color:var(--palette-gray-5);font-size:36px;flex:1}.icon-container{font-size:20px;background-color:var(--palette-teal-6);color:var(--palette-gray-4);width:36px;height:36px;border-radius:50%;outline-offset:4px}:host([active]) .thumbnail-container,\n:host([active]) .icon-container{outline:2px var(--local-node-outline-style) var(--palette-blue-3)}:host(:not([active])) .node:hover .thumbnail-container,\n:host(:not([active])) .node:hover .icon-container{outline:1px var(--local-node-outline-style) var(--palette-blue-3)}.add-button{position:absolute;bottom:-26px;left:calc(50% - 12px);width:24px;height:24px;background:var(--palette-gray-3);color:var(--palette-gray-6);border-radius:50%;cursor:pointer}:host([not-synced]) .add-button,\n:host([disable-child-append]) .add-button,\n:host(:not([active])) .add-button{display:none}.add-button:hover{background:var(--palette-blue-5);color:var(--palette-gray-2)}.external{position:absolute;top:4px;left:4px;padding:0 10px;display:flex;align-items:center;gap:6px;background:var(--palette-purple-4);font-size:12px;line-height:20px;height:22px;cursor:pointer;color:var(--palette-gray-1);border-radius:9999px;right:4px;max-width:-moz-fit-content;max-width:fit-content}.external-label{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.external:hover{background:var(--palette-purple-5)}.sub-nodes{display:grid;grid-template-columns:1fr 1fr 1fr;gap:6px;width:100%}.sub-node{background-color:var(--palette-gray-2);border-radius:4px;padding:6px;display:flex;flex-direction:column;justify-content:space-between;height:32px}.sub-node-skeleton-title{width:18px;height:4px;border-radius:2px;align-self:flex-start;background-color:var(--palette-gray-4)}.sub-node-skeleton-content{width:100%;height:4px;border-radius:2px;background-color:var(--palette-gray-4)}.sub-node-skeleton-button{width:18px;height:4px;border-radius:2px;align-self:flex-end;background-color:var(--palette-blue-3)}.sub-node:hover{background-color:var(--palette-gray-3)}.sub-node:hover .sub-node-skeleton-title,\n.sub-node:hover .sub-node-skeleton-content{background-color:var(--palette-gray-5)}.sub-node:hover .sub-node-skeleton-button{background-color:var(--palette-blue-4)}",""]);const s=o.toString()},4967:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(6758),i=n.n(a),r=n(935),o=n.n(r)()(i());o.push([e.id,":host{display:inline-block}:host([hidden]){display:none}",""]);const s=o.toString()},8918:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(6758),i=n.n(a),r=n(935),o=n.n(r)()(i());o.push([e.id,"body{background-color:transparent}#preview-root{padding:0;height:auto;max-height:100vh;overflow-y:auto;border:1px solid var(--theme-gray-border-color);border-radius:4px;background:var(--body-background)}.head-cell{position:sticky;top:0;z-index:1;font-weight:bold}.head-cell,\n.body-cell{background:var(--body-background)}.last-col-cell{border-right-color:transparent}.last-row-cell{border-bottom-color:transparent}.form-container > ::part(message){display:none}",""]);const s=o.toString()},4014:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(6758),i=n.n(a),r=n(935),o=n.n(r)()(i());o.push([e.id,":host{display:block}:host([hidden]){display:none}*{box-sizing:border-box}.container,\niframe{width:100%;height:100%;border-radius:4px}.container{position:relative}iframe{display:block;border:none;margin:0;padding:0;transform-origin:0% 0%;-webkit-user-select:none;user-select:none}",""]);const s=o.toString()},9216:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(6758),i=n.n(a),r=n(935),o=n.n(r)()(i());o.push([e.id,":host{display:grid;width:100%}:host([hidden]){display:none}::slotted(*){padding:4px 8px;border:1px solid var(--theme-gray-border-color);border-left-color:transparent;border-top-color:transparent;min-width:0;word-break:break-word}",""]);const s=o.toString()},4162:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(6758),i=n.n(a),r=n(935),o=n.n(r)()(i());o.push([e.id,"body{background-color:transparent}#preview-root{padding:0;height:auto;max-height:100vh;overflow-y:auto;border:1px solid var(--theme-gray-border-color);border-radius:4px;background:var(--body-background)}.head-cell{position:sticky;top:0;z-index:1;font-weight:bold}.head-cell,\n.body-cell{background:var(--body-background)}.body-cell{display:flex;align-items:center;justify-content:space-between}.last-col-cell{border-right-color:transparent}.last-row-cell{border-bottom-color:transparent}.form-container > ::part(message){display:none}.list{display:flex;flex-direction:column;gap:8px;overflow:hidden}.raw-content{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:var(--text-color-secondary)}.raw-content.expand{white-space:pre-wrap}.tips{color:var(--text-color-secondary);font-weight:normal}.body-cell:not(:hover) .btn-toggle{visibility:hidden}",""]);const s=o.toString()},9034:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(6758),i=n.n(a),r=n(935),o=n.n(r)()(i());o.push([e.id,":host{display:block}:host([hidden]){display:none}*{box-sizing:border-box}.container,\niframe{width:100%;height:100%;border-radius:4px}.container{position:relative}iframe{display:block;border:none;margin:0;padding:0;transform-origin:0% 0%;-webkit-user-select:none;user-select:none}",""]);const s=o.toString()},9765:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(6758),i=n.n(a),r=n(935),o=n.n(r)()(i());o.push([e.id,".custom-scrollbar-container{scrollbar-width:thin;scrollbar-color:rgba(255,255,255,0.15) rgba(255,255,255,0.03)}.custom-scrollbar-container::-webkit-scrollbar{width:8px;height:8px;background-color:transparent;position:absolute}.custom-scrollbar-container::-webkit-scrollbar-thumb{background-color:rgba(255,255,255,0);border-radius:4px}.custom-scrollbar-container:hover::-webkit-scrollbar-track{background-color:rgba(255,255,255,0.03)}.custom-scrollbar-container:hover::-webkit-scrollbar-thumb{background-color:rgba(255,255,255,0.15)}",""]);const s=o.toString()},3430:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(6758),i=n.n(a),r=n(935),o=n.n(r)()(i());o.push([e.id,":host{display:flex;flex-direction:column;height:100%;overflow-y:auto;scrollbar-width:none;background-color:var(--vb-workbench-action-list-background)}:host([hidden]){display:none}",""]);const s=o.toString()},5292:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(6758),i=n.n(a),r=n(935),o=n.n(r)()(i());o.push([e.id,'.action::part(link){display:flex;justify-content:center;align-items:center;width:48px;height:48px;font-size:24px;color:var(--vb-workbench-action-color);position:relative;transition:none}.action.active::part(link)::before{content:"";position:absolute;top:0;bottom:0;left:0;width:2px;background-color:var(--vb-workbench-action-active-border-color)}.action.active::part(link),\n.action::part(link):hover{color:var(--vb-workbench-active-color)}',""]);const s=o.toString()},1361:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(6758),i=n.n(a),r=n(935),o=n.n(r)()(i());o.push([e.id,":host{display:inline-block}:host([hidden]){display:none}eo-popover::part(popup){width:800px;max-width:60vw;padding:10px;background:var(--color-fill-bg-container-4);border-radius:var(--medius-border-radius);box-shadow:var(--feedback-container-shadow);z-index:1000}.history-title{font-size:var(--title-font-size);font-weight:var(--font-weight-500);color:var(--color-strong-text);margin-bottom:5px}.history-list{max-height:500px;overflow-y:auto}.item-container{padding:10px 0;display:flex;flex-direction:column;gap:5px}.empty{padding:5px 0 10px 0;font-size:14px;color:var(--text-color-secondary);text-align:center}.item-container:not(:last-of-type){border-bottom:1px solid var(--color-border-divider-line)}.item-title{display:flex;align-items:center;justify-content:space-between;gap:5px}.title-left,\n.title-right{display:flex;align-items:center}.title-left{cursor:pointer;overflow:hidden;gap:5px}.topic{font-size:14px;color:var(--text-color-title);font-weight:var(--font-weight-500);text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.branch{font-size:14px;color:var(--text-color-secondary)}.rollback{margin-right:5px;font-size:14px;color:var(--text-color-secondary);cursor:pointer}.rollback:hover{color:var(--color-brand)}.item-info{display:flex;align-items:center;gap:5px}.time,\n.operator{font-size:14px;color:var(--text-color-secondary)}.load-more-container{display:block;text-align:center}.end-container{display:flex;align-items:center;justify-content:center;gap:10px;font-size:16px;color:var(--color-brand)}.rollback-all{cursor:pointer}",""]);const s=o.toString()},7180:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(6758),i=n.n(a),r=n(935),o=n.n(r)()(i());o.push([e.id,':host{display:block;--pane-color:#595959}:host-context(html[data-theme="dark-v2"]),\n:host-context([data-override-theme="dark-v2"]){--pane-color:#ccc}:host([hidden]){display:none}*,\n*::before,\n*::after{box-sizing:border-box}.pane{display:flex;flex-direction:column;color:var(--pane-color);height:100%}.pane-header{display:flex;align-items:center;cursor:pointer;border-top:1px solid transparent;position:relative}.pane-header:focus{outline-width:1px;outline-style:solid;outline-offset:-1px;outline-color:#007fd4}:host(:not(:first-child)) .pane-header{border-top-color:rgba(204,204,204,0.2)}.pane-scroll-shadow{display:none;position:absolute;bottom:-3px;left:0;right:0;height:3px;box-shadow:#000000 0 6px 6px -6px inset;z-index:1}.scrolled .pane-scroll-shadow{display:block}.pane-title{display:flex;align-items:center;font-size:13px;line-height:24px;height:25px;min-width:0;flex:1}.title-icon{display:flex;justify-content:center;align-items:center;width:24px;padding-right:2px;line-height:1;flex-shrink:0}.title-label{text-transform:uppercase;font-weight:500;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.pane-body{flex-grow:1;min-height:0;display:none;overflow:hidden;overflow-y:auto;overflow-y:overlay}:host([active]) .pane-body{display:initial}:host(:not(:hover)) ::slotted([slot="actions"]){display:none}.badge{background-color:rgb(77,77,77);color:rgb(255,255,255);border-radius:11px;height:18px;padding:3px 6px;line-height:13px;margin:0 3px;font-size:12px}',""]);const s=o.toString()},2150:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(6758),i=n.n(a),r=n(935),o=n.n(r)()(i());o.push([e.id,':host{--sidebar-background:#fff;--title-container-background:#fff;--title-container-color:#595959;display:block;outline-color:rgba(83,89,93,0.5);background-color:var(--sidebar-background);height:100%}:host-context(html[data-theme="dark-v2"]),\n:host-context([data-override-theme="dark-v2"]){--sidebar-background:#181818;--title-container-background:#181818;--title-container-color:rgb(187,187,187);background-color:var(--sidebar-background)}:host([hidden]){display:none}*,\n*::before,\n*::after{box-sizing:border-box}.sidebar{display:flex;flex-direction:column;height:100%}.title-container{display:flex;padding:0 8px 8px 8px;color:var(--title-container-color);background:var(--title-container-background)}.title-label{font-weight:300;line-height:44px;padding-left:12px;text-transform:uppercase;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.pane-container{flex-grow:1;min-height:0;display:flex;flex-direction:column}::slotted([slot="panes"]){transition:flex 0.2s;min-height:25px}',""]);const s=o.toString()},6131:(e,t,n)=>{n.d(t,{A:()=>c});var a=n(6758),i=n.n(a),r=n(935),o=n.n(r),s=n(7745),l=o()(i());l.i(s.A),l.push([e.id,"",""]);const c=l.toString()},264:(e,t,n)=>{function a(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function i(e){return e&&e.sensitive?"":"i"}function r(e,t,n){return function(e,t,n){void 0===n&&(n={});for(var r=n.strict,o=void 0!==r&&r,s=n.start,l=void 0===s||s,c=n.end,d=void 0===c||c,p=n.encode,h=void 0===p?function(e){return e}:p,u=n.delimiter,m=void 0===u?"/#?":u,v=n.endsWith,g="[".concat(a(void 0===v?"":v),"]|$"),b="[".concat(a(m),"]"),f=l?"^":"",A=0,y=e;A<y.length;A++){var k=y[A];if("string"==typeof k)f+=a(h(k));else{var E=a(h(k.prefix)),w=a(h(k.suffix));if(k.pattern)if(t&&t.push(k),E||w)if("+"===k.modifier||"*"===k.modifier){var x="*"===k.modifier?"?":"";f+="(?:".concat(E,"((?:").concat(k.pattern,")(?:").concat(w).concat(E,"(?:").concat(k.pattern,"))*)").concat(w,")").concat(x)}else f+="(?:".concat(E,"(").concat(k.pattern,")").concat(w,")").concat(k.modifier);else{if("+"===k.modifier||"*"===k.modifier)throw new TypeError('Can not repeat "'.concat(k.name,'" without a prefix and suffix'));f+="(".concat(k.pattern,")").concat(k.modifier)}else f+="(?:".concat(E).concat(w,")").concat(k.modifier)}}if(d)o||(f+="".concat(b,"?")),f+=n.endsWith?"(?=".concat(g,")"):"$";else{var N=e[e.length-1],C="string"==typeof N?b.indexOf(N[N.length-1])>-1:void 0===N;o||(f+="(?:".concat(b,"(?=").concat(g,"))?")),C||(f+="(?=".concat(b,"|").concat(g,")"))}return new RegExp(f,i(n))}(function(e,t){void 0===t&&(t={});for(var n=function(e){for(var t=[],n=0;n<e.length;){var a=e[n];if("*"!==a&&"+"!==a&&"?"!==a)if("\\"!==a)if("{"!==a)if("}"!==a)if(":"!==a)if("("!==a)t.push({type:"CHAR",index:n,value:e[n++]});else{var i=1,r="";if("?"===e[s=n+1])throw new TypeError('Pattern cannot start with "?" at '.concat(s));for(;s<e.length;)if("\\"!==e[s]){if(")"===e[s]){if(0==--i){s++;break}}else if("("===e[s]&&(i++,"?"!==e[s+1]))throw new TypeError("Capturing groups are not allowed at ".concat(s));r+=e[s++]}else r+=e[s++]+e[s++];if(i)throw new TypeError("Unbalanced pattern at ".concat(n));if(!r)throw new TypeError("Missing pattern at ".concat(n));t.push({type:"PATTERN",index:n,value:r}),n=s}else{for(var o="",s=n+1;s<e.length;){var l=e.charCodeAt(s);if(!(l>=48&&l<=57||l>=65&&l<=90||l>=97&&l<=122||95===l))break;o+=e[s++]}if(!o)throw new TypeError("Missing parameter name at ".concat(n));t.push({type:"NAME",index:n,value:o}),n=s}else t.push({type:"CLOSE",index:n,value:e[n++]});else t.push({type:"OPEN",index:n,value:e[n++]});else t.push({type:"ESCAPED_CHAR",index:n++,value:e[n++]});else t.push({type:"MODIFIER",index:n,value:e[n++]})}return t.push({type:"END",index:n,value:""}),t}(e),i=t.prefixes,r=void 0===i?"./":i,o=t.delimiter,s=void 0===o?"/#?":o,l=[],c=0,d=0,p="",h=function(e){if(d<n.length&&n[d].type===e)return n[d++].value},u=function(e){var t=h(e);if(void 0!==t)return t;var a=n[d],i=a.type,r=a.index;throw new TypeError("Unexpected ".concat(i," at ").concat(r,", expected ").concat(e))},m=function(){for(var e,t="";e=h("CHAR")||h("ESCAPED_CHAR");)t+=e;return t},v=function(e){var t=l[l.length-1],n=e||(t&&"string"==typeof t?t:"");if(t&&!n)throw new TypeError('Must have text between two parameters, missing text after "'.concat(t.name,'"'));return!n||function(e){for(var t=0,n=s;t<n.length;t++){var a=n[t];if(e.indexOf(a)>-1)return!0}return!1}(n)?"[^".concat(a(s),"]+?"):"(?:(?!".concat(a(n),")[^").concat(a(s),"])+?")};d<n.length;){var g=h("CHAR"),b=h("NAME"),f=h("PATTERN");if(b||f){var A=g||"";-1===r.indexOf(A)&&(p+=A,A=""),p&&(l.push(p),p=""),l.push({name:b||c++,prefix:A,suffix:"",pattern:f||v(A),modifier:h("MODIFIER")||""})}else{var y=g||h("ESCAPED_CHAR");if(y)p+=y;else if(p&&(l.push(p),p=""),h("OPEN")){A=m();var k=h("NAME")||"",E=h("PATTERN")||"",w=m();u("CLOSE"),l.push({name:k||(E?c++:""),pattern:k&&!E?v(A):E,prefix:A,suffix:w,modifier:h("MODIFIER")||""})}else u("END")}}return l}(e,n),t,n)}function o(e,t,n){return e instanceof RegExp?function(e,t){if(!t)return e;for(var n=/\((?:\?<(.*?)>)?(?!\?)/g,a=0,i=n.exec(e.source);i;)t.push({name:i[1]||a++,prefix:"",suffix:"",modifier:"",pattern:""}),i=n.exec(e.source);return e}(e,t):Array.isArray(e)?function(e,t,n){var a=e.map((function(e){return o(e,t,n).source}));return new RegExp("(?:".concat(a.join("|"),")"),i(n))}(e,t,n):r(e,t,n)}n.d(t,{MM:()=>o})}}]);
//# sourceMappingURL=5832.b5f07eff.js.map