{"version":3,"file":"chunks/property-editor.5846d698.js","mappings":"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","sources":["webpack:///./src/property-editor/index.tsx"],"sourcesContent":["import React, {\n  useEffect,\n  useImperativeHandle,\n  useMemo,\n  createRef,\n  useState,\n  useCallback,\n  useRef,\n} from \"react\";\nimport { createDecorators, EventEmitter } from \"@next-core/element\";\nimport { ReactNextElement } from \"@next-core/react-element\";\nimport \"@next-core/theme\";\nimport {\n  createForm,\n  Form,\n  onFieldValueChange,\n  onFieldInit,\n  onFieldInitialValueChange,\n  onFormInitialValuesChange,\n  onFormValidateSuccess,\n  onFormValuesChange,\n  createEffectHook,\n} from \"@formily/core\";\nimport { createSchemaField, FormProvider } from \"@formily/react\";\nimport { ConfigProvider, theme } from \"antd\";\nimport { StyleProvider, createCache } from \"@ant-design/cssinjs\";\nimport {\n  FormCollapse,\n  FormItem,\n  FormLayout,\n  Input,\n  NumberPicker,\n  Radio,\n  Select,\n  Switch,\n} from \"@formily/antd-v5\";\nimport { useCurrentTheme } from \"@next-core/react-runtime\";\nimport {\n  EditorComponentProps,\n  DataItem,\n  SelectOptions,\n} from \"@next-shared/property-editor\";\nimport { CategoryTitle } from \"./components/CategoryTitle\";\nimport { AdvancedFormItem } from \"./components/AdvancedFormItem\";\nimport { CodeEditorComponent } from \"./components/common/CodeEditorComponent\";\nimport { IconSelectComponent } from \"./components/common/IconSelectComponent\";\nimport { ColorPickerComponent } from \"./components/common/ColorPickerComponent\";\nimport { InputWithUrlComponent } from \"./components/common/InputWithUrlComponent\";\nimport { TextAlignRadioComponent } from \"./components/common/TextAlignRadioComponent\";\nimport { InputWithUnitComponent } from \"./components/common/InputWithUnitComponent\";\nimport { UseChildrenSelectComponent } from \"./components/common/UseChildrenSelectComponent\";\nimport { BoxSizeComponent } from \"./components/common/BoxSizeComponent\";\nimport { CustomOptionsComponent } from \"./components/common/CustomOptionsComponent\";\nimport { CustomTab } from \"./components/common/CustomTab\";\nimport { __secret_internals, customEditors } from \"@next-core/runtime\";\nimport {\n  ADVANCED_FORM_KEY,\n  DataNode,\n  formilySchemaFormatter,\n} from \"./utils/formilySchemaFormatter\";\nimport \"./style.css\";\nimport _, { isEmpty, omit } from \"lodash\";\nimport { BrickPackage } from \"@next-core/types\";\nimport { NORMAL_FORM_KEY } from \"./utils/formilySchemaFormatter\";\n\nconst { defineElement, property, method, event } = createDecorators();\n\nconst PropertyEditorComponent = React.forwardRef(LegacyPropertyEditor);\n\nexport const BEFORE_SUBMIT_KEY = \"before_submit\";\nexport const ADVANCED_CHANGE_KEY = \"on_advanced_change\";\n\nexport const SchemaField = createSchemaField({\n  components: {\n    FormLayout,\n    Input,\n    FormItem: AdvancedFormItem,\n    FormItemWithoutAdvanced: FormItem,\n    FormCollapse,\n    NumberPicker,\n    Radio,\n    Select,\n    Switch,\n    CategoryTitle,\n    CodeEditor: CodeEditorComponent,\n    IconSelect: IconSelectComponent,\n    ColorPicker: ColorPickerComponent,\n    UseChildrenSelect: UseChildrenSelectComponent,\n    InputWithUrl: InputWithUrlComponent,\n    InputWithUnit: InputWithUnitComponent,\n    TextAlignRadio: TextAlignRadioComponent,\n    CustomOptions: CustomOptionsComponent,\n    BoxSize: BoxSizeComponent,\n    CustomTab,\n  },\n});\n\nexport type { DataNode };\n\nlet cacheCustomEditor: Function;\n\n/**\n * 构件 `visual-builder.property-editor`\n */\nexport\n@defineElement(\"visual-builder.property-editor\", {\n  // styleTexts: [styleText],\n  // 因为有使用 vs.code-editor，需要把 shadowOptions 设置成 false\n  shadowOptions: false,\n  dependencies: [\"eo-icon-select\", \"vs.code-editor\", \"eo-tooltip\"],\n})\nclass PropertyEditor extends ReactNextElement {\n  #formRef = createRef<any>();\n\n  /** 构件名称 */\n  @property()\n  accessor editorName: string | undefined;\n\n  /** 值 */\n  @property({\n    attribute: false,\n  })\n  accessor values: any | undefined;\n\n  /** 高级模式 */\n  @property({\n    type: Boolean,\n  })\n  accessor advancedMode: boolean | undefined;\n\n  @property({\n    attribute: false,\n  })\n  accessor dataList: DataItem[];\n\n  @property({\n    attribute: false,\n  })\n  accessor editorPackages: BrickPackage[];\n\n  @property({\n    attribute: false,\n  })\n  accessor links: any;\n\n  @property({\n    attribute: false,\n  })\n  accessor extraLibs: SelectOptions;\n\n  @property({\n    attribute: false,\n  })\n  accessor childSlots: SelectOptions;\n\n  /**\n   * 表单验证成功时触发事件\n   */\n  @event({ type: \"validate.success\" }) accessor #successEvent!: EventEmitter<\n    Record<string, unknown>\n  >;\n  /**\n   * 表单验证报错时触发事件\n   */\n  @event({ type: \"validate.error\" }) accessor #errorEvent!: EventEmitter<any[]>;\n\n  @method()\n  validate() {\n    const form: Form = this.#formRef.current?.getFormInstance();\n    this.#submitValue = null;\n\n    form\n      .validate()\n      .then(() => {\n        if (this.advancedMode) {\n          // 高级模式直接输出 form.values[ADVANCED_FORM_KEY]\n          this.#successEvent.emit(form.values[ADVANCED_FORM_KEY]);\n        } else {\n          const value = _.omit(form.values, [ADVANCED_FORM_KEY]);\n          form.notify(BEFORE_SUBMIT_KEY, value);\n          this.#successEvent.emit(this.#submitValue ?? value);\n        }\n      })\n      .catch((err: any[]) => {\n        this.#errorEvent.emit(err);\n      });\n  }\n\n  @event({ type: \"values.change\" })\n  accessor #valuesChangeEvent!: EventEmitter<any>;\n\n  #handleValuesChange = (value: any) => {\n    this.#valuesChangeEvent.emit(value);\n  };\n\n  @event({ type: \"token.click\" })\n  accessor #tokenClick!: EventEmitter<string>;\n\n  #handleTokenClick = (value: string): void => {\n    this.#tokenClick.emit(value);\n  };\n\n  #submitValue: any;\n\n  #onSubmitEffect = createEffectHook(\n    BEFORE_SUBMIT_KEY,\n    (values, form) => (listener) => {\n      this.#submitValue = listener(values, form);\n    }\n  );\n\n  @event({ type: \"trigger.action\" })\n  accessor #triggerActionEvent!: EventEmitter<string>;\n\n  #handleTriggerAction = (action: string) => {\n    this.#triggerActionEvent.emit(action);\n  };\n\n  #filterData = (data?: Record<string, any> | string) => {\n    const transformData =\n      typeof data === \"string\" && data === \"undefined\"\n        ? undefined\n        : omit(data as any, [\"dataset.testid\"]);\n    const shouldFilterFields = [];\n    isEmpty(transformData?.dataset) && shouldFilterFields.push(\"dataset\");\n    isEmpty(transformData?.style) && shouldFilterFields.push(\"style\");\n\n    const filterData = omit(transformData, shouldFilterFields);\n    if (isEmpty(filterData)) {\n      return undefined;\n    }\n    return filterData;\n  };\n\n  render() {\n    return (\n      <PropertyEditorComponent\n        ref={this.#formRef}\n        editorName={this.editorName}\n        values={this.#filterData(this.values)}\n        advancedMode={this.advancedMode}\n        dataList={this.dataList}\n        extraLibs={this.extraLibs}\n        links={this.links}\n        childSlots={this.childSlots}\n        editorPackages={this.editorPackages}\n        handleValuesChange={this.#handleValuesChange}\n        handleTokenClick={this.#handleTokenClick}\n        handleTriggerAction={this.#handleTriggerAction}\n        onSubmitEffect={this.#onSubmitEffect}\n      />\n    );\n  }\n}\n\nexport interface PropertyEditorProps {\n  values: any;\n  editorName: string;\n  advancedMode?: boolean;\n  childSlots?: SelectOptions;\n  extraLibs: SelectOptions;\n  dataList: DataItem[];\n  links: any;\n  editorPackages: BrickPackage[];\n  handleValuesChange: (value: any) => void;\n  handleTokenClick: (token: string) => void;\n  handleTriggerAction: (action: string) => void;\n  onSubmitEffect: (listener: (value: any, form: Form) => any) => void;\n}\n\nexport function LegacyPropertyEditor(\n  {\n    advancedMode,\n    values,\n    editorName,\n    dataList,\n    editorPackages,\n    extraLibs,\n    childSlots,\n    links,\n    handleValuesChange,\n    handleTokenClick,\n    handleTriggerAction,\n    onSubmitEffect,\n  }: PropertyEditorProps,\n  ref: any\n) {\n  const [Editor, setEditor] = useState<\n    (props: EditorComponentProps<typeof SchemaField>) => React.ReactElement\n  >(cacheCustomEditor as any);\n  const currentTheme = useCurrentTheme();\n  const cache = useMemo(() => createCache(), []);\n  // should update form instance when Editor change\n  const form = useMemo(() => createForm(), [Editor]);\n  const transformValueRef = useRef<any>(null);\n  const advancedChangeRef = useRef<boolean>(false);\n\n  const onAdvancedChangeEffect = useMemo(\n    () =>\n      createEffectHook(\n        ADVANCED_CHANGE_KEY,\n        (advancedMode, form) => (listener) => {\n          const values =\n            !advancedMode && form.values[ADVANCED_FORM_KEY]\n              ? form.values[ADVANCED_FORM_KEY]\n              : form.values;\n          transformValueRef.current = listener(advancedMode, form, values);\n        }\n      ),\n    []\n  );\n\n  useImperativeHandle(ref, () => ({\n    getFormInstance: () => form,\n  }));\n\n  const load = useCallback(async () => {\n    // TODO: cache editors\n    if (customEditors.get(editorName)) {\n      setEditor(() => customEditors.get(editorName)?.(React) as any);\n      return;\n    }\n    await __secret_internals.loadEditors([editorName], editorPackages);\n    cacheCustomEditor = () => customEditors.get(editorName)?.(React);\n    setEditor(cacheCustomEditor as any);\n  }, [editorName, editorPackages]);\n\n  const defaultTransform = useCallback((values: any, advancedMode: boolean) => {\n    if (advancedMode) {\n      const filterValue = _.omit(values, [ADVANCED_FORM_KEY]);\n      return {\n        [ADVANCED_FORM_KEY]: _.isEmpty(filterValue) ? \"\" : filterValue,\n      };\n    }\n    return values[ADVANCED_FORM_KEY] ?? values;\n  }, []);\n\n  useEffect(() => {\n    load();\n  }, [load]);\n\n  useEffect(() => {\n    if (Editor) {\n      form.setInitialValues(values, \"overwrite\");\n    }\n  }, [Editor, form]);\n\n  useEffect(() => {\n    advancedChangeRef.current = true;\n    transformValueRef.current = null;\n\n    form.notify(ADVANCED_CHANGE_KEY, advancedMode);\n\n    form.query(NORMAL_FORM_KEY).take((field) => {\n      field.display = !advancedMode ? \"visible\" : \"hidden\";\n    });\n    form.query(ADVANCED_FORM_KEY).take((field) => {\n      field.display = advancedMode ? \"visible\" : \"hidden\";\n    });\n\n    const formValues = form.getState().values;\n    const formData = defaultTransform(\n      transformValueRef.current ?? formValues,\n      advancedMode\n    );\n\n    form.setValues(formData, \"overwrite\");\n    advancedChangeRef.current = false;\n  }, [advancedMode, form, defaultTransform, Editor]);\n\n  useEffect(() => {\n    form.addEffects(\"onValueChange\", () => {\n      onFormValuesChange((form) => {\n        if (advancedChangeRef.current) return;\n        handleValuesChange(form.values);\n      });\n    });\n  }, [form, handleValuesChange]);\n\n  if (!Editor) return null;\n\n  return (\n    <div className=\"property-form-wrapper\">\n      <ConfigProvider\n        prefixCls=\"antdV5\"\n        theme={{\n          algorithm:\n            currentTheme === \"dark-v2\"\n              ? theme.darkAlgorithm\n              : theme.defaultAlgorithm,\n          components: {\n            // Form: {\n            //   not work\n            //   itemMarginBottom: 10,\n            // }\n            InputNumber: {\n              handleVisible: true,\n            },\n          },\n        }}\n        getPopupContainer={(trigger) => trigger!}\n      >\n        <StyleProvider cache={cache}>\n          <FormProvider form={form}>\n            <Editor\n              advancedMode={advancedMode}\n              SchemaFieldComponent={SchemaField}\n              form={form}\n              scope={{\n                dataList,\n                advancedMode,\n                childSlots,\n                extraLibs,\n                links,\n                tokenClick: (event: CustomEvent<string>) =>\n                  handleTokenClick(event.detail),\n                triggerAction: handleTriggerAction,\n              }}\n              effects={{\n                onFieldInit,\n                onFieldValueChange,\n                onFieldInitialValueChange,\n                onFormInitialValuesChange,\n                onFormValidateSuccess,\n                onFormValuesChange,\n                onSubmit: onSubmitEffect,\n                onAdvancedChange: onAdvancedChangeEffect,\n              }}\n              formilySchemaFormatter={formilySchemaFormatter}\n            />\n          </FormProvider>\n        </StyleProvider>\n      </ConfigProvider>\n    </div>\n  );\n}\n"],"names":["defineElement","property","method","event","createDecorators","PropertyEditorComponent","React","LegacyPropertyEditor","BEFORE_SUBMIT_KEY","ADVANCED_CHANGE_KEY","SchemaField","createSchemaField","components","FormLayout","Input","FormItem","AdvancedFormItem","FormItemWithoutAdvanced","FormCollapse","NumberPicker","Radio","Select","Switch","CategoryTitle","CodeEditor","CodeEditorComponent","IconSelect","IconSelectComponent","ColorPicker","ColorPickerComponent","UseChildrenSelect","UseChildrenSelectComponent","InputWithUrl","InputWithUrlComponent","InputWithUnit","InputWithUnitComponent","TextAlignRadio","TextAlignRadioComponent","CustomOptions","CustomOptionsComponent","BoxSize","BoxSizeComponent","CustomTab","cacheCustomEditor","_PropertyEditor","_formRef","WeakMap","_A","_B","_C","_D","_E","_F","_G","_H","_I","_PropertyEditor_brand","WeakSet","_J","_K","_handleValuesChange","_L","_handleTokenClick","_submitValue","_onSubmitEffect","_M","_handleTriggerAction","_filterData","PropertyEditor","ReactNextElement","constructor","arguments","_classPrivateMethodInitSpec","_classPrivateFieldInitSpec","_initProto","createRef","_init_editorName","_init_extra_editorName","_init_values","_init_extra_values","_init_advancedMode","_init_extra_advancedMode","_init_dataList","_init_extra_dataList","_init_editorPackages","_init_extra_editorPackages","_init_links","_init_extra_links","_init_extraLibs","_init_extra_extraLibs","_init_childSlots","_init_extra_childSlots","_init_successEvent","_init_extra_successEvent","_init_errorEvent","_init_extra_errorEvent","_init_valuesChangeEvent","_init_extra_valuesChangeEvent","value","_classPrivateGetter","this","_get_valuesChangeEvent","emit","_init_tokenClick","_init_extra_tokenClick","_get_tokenClick","createEffectHook","values","form","listener","_classPrivateFieldSet","_init_triggerActionEvent","_init_extra_triggerActionEvent","action","_get_triggerActionEvent","data","transformData","undefined","omit","shouldFilterFields","isEmpty","dataset","push","style","filterData","editorName","_classPrivateFieldGet","v","advancedMode","dataList","editorPackages","links","extraLibs","childSlots","validate","_classPrivateFieldGet2","current","getFormInstance","then","_get_successEvent","ADVANCED_FORM_KEY","_","notify","catch","err","_get_errorEvent","render","ref","call","handleValuesChange","handleTokenClick","handleTriggerAction","onSubmitEffect","_ref","Editor","setEditor","useState","currentTheme","useCurrentTheme","cache","useMemo","createCache","createForm","transformValueRef","useRef","advancedChangeRef","onAdvancedChangeEffect","useImperativeHandle","load","useCallback","async","customEditors","get","_customEditors$get","__secret_internals","loadEditors","_customEditors$get2","defaultTransform","filterValue","useEffect","setInitialValues","query","NORMAL_FORM_KEY","take","field","display","formValues","getState","formData","setValues","addEffects","onFormValuesChange","className","ConfigProvider","prefixCls","theme","algorithm","darkAlgorithm","defaultAlgorithm","InputNumber","handleVisible","getPopupContainer","trigger","StyleProvider","FormProvider","SchemaFieldComponent","scope","tokenClick","detail","triggerAction","effects","onFieldInit","onFieldValueChange","onFieldInitialValueChange","onFormInitialValuesChange","onFormValidateSuccess","onSubmit","onAdvancedChange","formilySchemaFormatter","_PropertyEditor2","e","_set_successEvent","_set_errorEvent","_set_valuesChangeEvent","_set_tokenClick","_set_triggerActionEvent","c","_initClass","_applyDecs","shadowOptions","dependencies","attribute","type","Boolean","o","has","_checkInRHS"],"sourceRoot":""}