"use strict";(self.webpackChunk_next_bricks_visual_builder=self.webpackChunk_next_bricks_visual_builder||[]).push([[206],{894:(e,t,r)=>{r.d(t,{k:()=>a});var n=r(6107),o=r(6530),i=r(2812);function a(e){var t=function(e){var t=new Set;return(0,o.f)(e,(e=>{switch(e.type){case"Resolvable":case"EventHandler":var r,n=null===(r=e.raw)||void 0===r?void 0:r.useProvider;n&&t.add(n)}})),t}((0,i.ud)(e)),r=[];for(var n of t)n.includes("@")&&r.push(n);return r}customElements.define("visual-builder.collect-used-contracts",(0,n.createProviderClass)(a))},206:(e,t,r)=>{r.d(t,{Z:()=>_});var n,o=r(4795),i=r(3028),a=r(5062),s=r(5178),d=r(1763),l=r.n(d)();function p(){return(p=(0,o.Z)((function*(e,t){var r,n=yield l(document.body,{logging:!1,scale:1,width:window.innerWidth,height:window.innerHeight,foreignObjectRendering:!0}),o=document.createElement("canvas");return function(e,t,r,n){var o=r/n,{width:i,height:a}=e,s=i/a,d=s>=o,l=d?r:n*s,p=d?r/s:n;t.width=l,t.height=p,t.getContext("2d").drawImage(e,0,0,i,a,0,0,l,p),t.toDataURL()}(n,o,e,t),yield(r=o,new Promise((function(e,t){r.toBlob((function(r){r?e(r):t()}))})))}))).apply(this,arguments)}function c(e){var t;e.preventDefault(),e.stopPropagation(),(t=y(e.target)).length>0&&window.parent.postMessage({sender:"previewer",type:"select-brick",iidList:t},n)}function u(e){e.preventDefault(),e.stopPropagation()}var v=(0,s.throttle)((e=>{var t=y(e.target);t.length>0&&window.parent.postMessage({sender:"previewer",type:"hover-on-brick",iidList:t},n)}),100,{leading:!1});function w(e){e.preventDefault(),e.stopPropagation(),v(e)}function h(e){e.preventDefault(),e.stopPropagation(),v(e)}function g(e){e.preventDefault(),e.stopPropagation(),window.parent.postMessage({sender:"previewer",type:"hover-on-brick",iidList:[]},n)}function m(e){var t,r,o;e.preventDefault(),e.stopPropagation(),t=e.target,r={x:e.clientX,y:e.clientY},(o=y(t)).length>0&&window.parent.postMessage({sender:"previewer",type:"context-menu-on-brick",iidList:o,position:r},n)}function y(e){for(var t=[],r=e;r;)"string"==typeof r.dataset.iid&&t.push(r.dataset.iid),r=r.parentElement;return t}var f=r(894),b=!1,S=a.getHistory,k=a.matchPath,E=a.__secret_internals,L=!1;try{var x,I=window.dll;if(I&&null!==(x=window.BRICK_NEXT_VERSIONS)&&void 0!==x&&null!==(x=x["brick-container"])&&void 0!==x&&x.startsWith("2.")){var{getHistory:P,developHelper:C}=I("tYg3"),{matchPath:D}=I("A+yw");S=P,k=D,E=(0,i.Z)((0,i.Z)({},C),{},{getContextValue(e,t){var{tplStateStoreId:r}=t;return C.getContextValue(e,{tplContextId:r})},getAllContextValues(e){var{tplStateStoreId:t}=e,r=C.getAllContextValues({tplContextId:t});return Object.fromEntries([...r].map((e=>{var[t,r]=e;return[t,r.value]})))}}),L=!0}}catch(e){console.error("Try to use v2 runtime APIs failed:",e)}var T=null,N=null;function _(e,t){return A.apply(this,arguments)}function A(){return A=(0,o.Z)((function*(e,t){if(!b){b=!0;var r,d,l,v,x=t=>{window.parent.postMessage((0,i.Z)({sender:"previewer"},t),e)};x({type:"preview-started"}),n=e;var I,P=(e,t,r)=>{var n=M(t);x({type:"highlight-brick",highlightType:e,outlines:n,iid:t,alias:r})};t.templateId&&(I=t.settings);var C=()=>{E.updateTemplatePreviewSettings(t.appId,t.templateId,I),S().reload()},D=()=>{E.updateSnippetPreviewSettings(t.appId,JSON.parse(t.snippetData)),S().reload()},_=S();window.addEventListener("message",function(){var i=(0,o.Z)((function*(o){var i,b,k,{data:T,origin:N}=o;if(N===e&&T&&"preview-container"===T.sender)if("builder"===T.forwardedFor)switch(T.type){case"hover-on-brick":r=T.iid,d=T.alias,P("hover",T.iid,T.alias);break;case"hover-on-main":P("hover","#main-mount-point","root");break;case"hover-on-context":k=T.highlightNodes.map((e=>M(e.iid,e.alias))).flat(),x({type:"highlight-context",outlines:k});break;case"select-brick":l=T.iid,v=T.alias,P("active",T.iid,T.alias);break;case"hover-on-iframe":(e=>{var t=document.elementFromPoint(e.x,e.y);if("BODY"===(null==t?void 0:t.tagName))window.parent.postMessage({sender:"previewer",type:"hover-on-main",isDirection:!0,position:{x:e.x,y:e.y}},n);else{var r=y(t);window.parent.postMessage({sender:"previewer",type:"hover-on-brick",iidList:r,isDirection:!0,position:{x:e.x,y:e.y}},n)}})(T.position)}else switch(T.type){case"toggle-inspecting":T.enabled?(window.addEventListener("click",c,!0),window.addEventListener("mousedown",u,!0),window.addEventListener("mouseover",u,!0),window.addEventListener("mouseup",u,!0),window.addEventListener("pointerdown",w,!0),window.addEventListener("pointerover",h,!0),window.addEventListener("pointerup",u,!0),window.addEventListener("pointerleave",g,!0),window.addEventListener("contextmenu",m,!0)):(window.removeEventListener("click",c,!0),window.removeEventListener("mousedown",u,!0),window.removeEventListener("mouseover",u,!0),window.removeEventListener("mouseup",u,!0),window.removeEventListener("pointerdown",w,!0),window.removeEventListener("pointerover",h,!0),window.removeEventListener("pointerup",u,!0),window.removeEventListener("pointerleave",g,!0),window.removeEventListener("contextmenu",m,!0));break;case"refresh":if(null!==(i=T.options)&&void 0!==i&&i.updateStoryboardType){var A,B;"route"===T.options.updateStoryboardType?E.updateStoryboardByRoute(t.appId,T.storyboardPatch):"template"===T.options.updateStoryboardType?E.updateStoryboardByTemplate(t.appId,T.storyboardPatch,T.options.settings):"snippet"===T.options.updateStoryboardType&&E.updateStoryboardBySnippet(t.appId,T.storyboardPatch);var O=yield null===(A=(B=E).getAddedContracts)||void 0===A?void 0:A.call(B,T.storyboardPatch,{appId:t.appId,updateStoryboardType:T.options.updateStoryboardType,formId:t.formId,collectUsedContracts:f.k});(0,s.isEmpty)(O)?S().reload():x({type:"contract-update",data:{add:O}});break}E.updateStoryboard(t.appId,T.storyboardPatch),t.templateId?(I=T.settings,C()):null!==(b=T.options)&&void 0!==b&&b.snippetData?(t.snippetData=T.options.snippetData,D()):S().reload();break;case"reload":location.reload();break;case"back":_.goBack();break;case"forward":_.goForward();break;case"capture":(function(e,t){return p.apply(this,arguments)})(T.maxWidth,T.maxHeight).then((e=>{x({type:"capture-ok",screenshot:e})}),(()=>{x({type:"capture-failed"})}));break;case"inspect-data-value":((e,t)=>{try{var r,n,o,{dataType:i}=t,a=L?"tplContextId":"tplStateStoreId";if("state"===i&&!(r=document.querySelector("#main-mount-point").firstChild.dataset[a]))return void x({type:"inspect-data-value-error",data:{error:{message:"tplStateStoreId not found, unable to preview STATE value"}}});if(e)o="inspect-single-data-value-success",n=E.getContextValue(e,{tplStateStoreId:r});else{o="inspect-all-data-values-success";var s=E.getAllContextValues({tplStateStoreId:r});n=Object.entries(s).map((e=>{var[t,r]=e;return{name:t,value:r}}))}x({type:o,data:{name:e,value:n}})}catch(e){x({type:"inspect-data-value-error",data:{message:e.message}})}})(T.name,T.option);break;case"update-preview-url":var H=T.previewUrl.startsWith(window.origin)?T.previewUrl.substring(window.origin.length):T.previewUrl,R=(0,a.getBasePath)(),V=H.startsWith(R)?H.substring(R.length-1):H;S().push(V);break;case"update-preview-route":t.routePath=T.routePath,t.routeExact=T.routeExact,Z()}}));return function(e){return i.apply(this,arguments)}}()),window.addEventListener("scroll",(()=>{x({type:"scroll",scroll:{x:window.scrollX,y:window.scrollY}})}));var A,B=!0,O=e=>{x({type:"url-change",url:location.origin+_.createHref(e)}),A=e,Z()};O(_.location),_.listen(O),t.templateId&&C(),t.snippetData&&D(),H(),new MutationObserver((0,s.throttle)((()=>{H(),r&&P("hover",r,d),l&&P("active",l,v)}),100,{leading:!1})).observe(document.body,{subtree:!0,childList:!0})}function Z(){if(t.routePath){var e=!!k(A.pathname,{path:t.routePath,exact:t.routeExact});if(x({type:"route-match-change",match:e}),t.templateId&&!B&&e){var r=document.querySelector("#main-mount-point"),n=new MutationObserver((()=>{1===r.childNodes.length&&"SPAN"===r.firstChild.tagName&&0===r.firstChild.childNodes.length&&(C(),n.disconnect())}));n.observe(r,{childList:!0})}if(t.snippetData&&!B&&e){var o=document.querySelector("#main-mount-point"),i=new MutationObserver((()=>{1===o.childNodes.length&&"SPAN"===o.firstChild.tagName&&0===o.firstChild.childNodes.length&&(D(),i.disconnect())}));i.observe(o,{childList:!0})}B=e}}function H(){var e,t,r,n=document.querySelector("eo-page-view"),o=null!==(e=null==n||null===(t=n.shadowRoot)||void 0===t?void 0:t.querySelector(".content"))&&void 0!==e?e:null;o!==T&&(null===(r=T)||void 0===r||r.removeEventListener("scroll",R),null==o||o.addEventListener("scroll",R),T=o,N=n)}function R(){x({type:"content-scroll",scroll:{x:this.scrollLeft,y:this.scrollTop}})}})),A.apply(this,arguments)}function M(e,t){if(!e)return[];var r=e.includes("#"),n=function(e,t){return[...e].map((e=>{var r,n=null===(r=N)||void 0===r?void 0:r.contains(e),{width:o,height:i,left:a,top:s}=e.getBoundingClientRect();return{width:o,height:i,left:a+window.scrollX+(n?T.scrollLeft:0),top:s+window.scrollY+(n?T.scrollTop:0),alias:t,hasContentScroll:n}}))}(document.querySelectorAll(r?e:'[data-iid="'.concat(e,'"]')),t);return r?n.map((e=>(0,i.Z)((0,i.Z)({},e),{},{height:window.innerHeight-e.top}))):n}}}]);
//# sourceMappingURL=206.7e426998.js.map