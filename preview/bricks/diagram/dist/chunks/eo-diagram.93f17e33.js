"use strict";(globalThis.webpackChunk_next_bricks_diagram=globalThis.webpackChunk_next_bricks_diagram||[]).push([[3039],{1508:(e,t,n)=>{n.r(t),n.d(t,{EoDiagram:()=>Ye,EoDiagramComponent:()=>je,LegacyEoDiagramComponent:()=>wt});var a,s=n(4635),i=n(918),o=n(6902),r=n(5536),l=n(6121),c=n(829),d=n(2740),u=n(8769),h=n.n(u),m=n(300),A=n(4295),p=(n(6477),n(7566)),g=n(9047),f=n(3373),y=n.n(f),k=n(1030),b=n(9126),v=n(8892),w=n(5157),M=n(8308),E=n(1518),W=n(9137),L=n(2547),S=n(1803),N=n(3739),R=n(9191),C=n(6671),x=n(8060),T=n(2448),z=n(8657),D=n(8069),$=n(1324),B=n(821),O=n(6753),P=n(2673),I=n(5987);let H,V,_,K,j,Y,X,Z,q,F,G,U,J,Q,ee,te,ne,ae,se,ie,oe,re,le,ce,de,ue,he,me,Ae,pe,ge,fe,ye,ke,be,ve,we,Me,Ee,We,Le,Se,Ne,Re,Ce,xe,Te,ze,De,$e,Be,Oe,Pe,Ie;const{defineElement:He,property:Ve,event:_e,method:Ke}=(0,m.createDecorators)(),je=(0,u.forwardRef)(wt);let Ye;var Xe=new WeakMap,Ze=new WeakMap,qe=new WeakMap,Fe=new WeakMap,Ge=new WeakMap,Ue=new WeakMap,Je=new WeakMap,Qe=new WeakMap,et=new WeakMap,tt=new WeakMap,nt=new WeakMap,at=new WeakMap,st=new WeakMap,it=new WeakMap,ot=new WeakMap,rt=new WeakSet,lt=new WeakMap,ct=new WeakMap,dt=new WeakMap,ut=new WeakMap,ht=new WeakMap,mt=new WeakMap,At=new WeakMap,pt=new WeakMap,gt=new WeakMap,ft=new WeakMap,yt=new WeakMap,kt=new WeakMap,bt=new WeakMap;class vt extends A.ReactNextElement{constructor(){super(...arguments),(0,s.A)(this,rt),(0,i.A)(this,Xe,(H(this),_(this))),(0,i.A)(this,Ze,(K(this),j(this))),(0,i.A)(this,qe,(Y(this),X(this))),(0,i.A)(this,Fe,(Z(this),q(this))),(0,i.A)(this,Ge,(F(this),G(this))),(0,i.A)(this,Ue,(U(this),J(this))),(0,i.A)(this,Je,(Q(this),ee(this))),(0,i.A)(this,Qe,(te(this),ne(this))),(0,i.A)(this,et,(ae(this),se(this))),(0,i.A)(this,tt,(ie(this),oe(this))),(0,i.A)(this,nt,(re(this),le(this,!0))),(0,i.A)(this,at,(ce(this),de(this,!0))),(0,i.A)(this,st,(ue(this),he(this,!0))),(0,i.A)(this,it,(me(this),Ae(this))),(0,i.A)(this,ot,(pe(this),ge(this))),(0,i.A)(this,lt,(ke(this),e=>{(0,r.A)(rt,this,fe).emit(e)})),(0,i.A)(this,ct,be(this)),(0,i.A)(this,dt,(Me(this),e=>{(0,r.A)(rt,this,ve).emit(e)})),(0,i.A)(this,ut,Ee(this)),(0,i.A)(this,ht,(Se(this),e=>{(0,r.A)(rt,this,We).emit(e)})),(0,i.A)(this,mt,Ne(this)),(0,i.A)(this,At,(xe(this),e=>{(0,r.A)(rt,this,Re).emit(e)})),(0,i.A)(this,pt,Te(this)),(0,i.A)(this,gt,($e(this),e=>{(0,r.A)(rt,this,ze).emit(e)})),(0,i.A)(this,ft,Be(this)),(0,i.A)(this,yt,(Ie(this),e=>{(0,r.A)(rt,this,Oe).emit(e)})),(0,i.A)(this,kt,(e=>{(0,P.c)(e,this.activeTarget)||(this.activeTarget=e)})),(0,i.A)(this,bt,(0,u.createRef)())}get layout(){return(0,c.A)(Xe,this)}set layout(e){(0,l.A)(Xe,this,e)}get nodes(){return(0,c.A)(Ze,this)}set nodes(e){(0,l.A)(Ze,this,e)}get edges(){return(0,c.A)(qe,this)}set edges(e){(0,l.A)(qe,this,e)}get nodeBricks(){return(0,c.A)(Fe,this)}set nodeBricks(e){(0,l.A)(Fe,this,e)}get lines(){return(0,c.A)(Ge,this)}set lines(e){(0,l.A)(Ge,this,e)}get layoutOptions(){return(0,c.A)(Ue,this)}set layoutOptions(e){(0,l.A)(Ue,this,e)}get activeTarget(){return(0,c.A)(Je,this)}set activeTarget(e){(0,l.A)(Je,this,e)}get disableKeyboardAction(){return(0,c.A)(Qe,this)}set disableKeyboardAction(e){(0,l.A)(Qe,this,e)}get connectNodes(){return(0,c.A)(et,this)}set connectNodes(e){(0,l.A)(et,this,e)}get dragNodes(){return(0,c.A)(tt,this)}set dragNodes(e){(0,l.A)(tt,this,e)}get zoomable(){return(0,c.A)(nt,this)}set zoomable(e){(0,l.A)(nt,this,e)}get scrollable(){return(0,c.A)(at,this)}set scrollable(e){(0,l.A)(at,this,e)}get pannable(){return(0,c.A)(st,this)}set pannable(e){(0,l.A)(st,this,e)}get scaleRange(){return(0,c.A)(it,this)}set scaleRange(e){(0,l.A)(it,this,e)}callOnLineLabel(e,t){for(var n,a=arguments.length,s=new Array(a>2?a-2:0),i=2;i<a;i++)s[i-2]=arguments[i];null===(n=(0,c.A)(bt,this).current)||void 0===n||n.callOnLineLabel(e,t,...s)}render(){return h().createElement(je,{ref:(0,c.A)(bt,this),layout:this.layout,nodes:this.nodes,edges:this.edges,nodeBricks:this.nodeBricks,lines:this.lines,layoutOptions:this.layoutOptions,connectNodes:this.connectNodes,dragNodes:this.dragNodes,activeTarget:this.activeTarget,disableKeyboardAction:this.disableKeyboardAction,zoomable:this.zoomable,scrollable:this.scrollable,pannable:this.pannable,scaleRange:this.scaleRange,onActiveTargetChange:(0,c.A)(lt,this),onSwitchActiveTarget:(0,c.A)(kt,this),onNodeDelete:(0,c.A)(dt,this),onEdgeDelete:(0,c.A)(ht,this),onLineClick:(0,c.A)(At,this),onLineDoubleClick:(0,c.A)(gt,this),onNodesConnect:(0,c.A)(yt,this)})}}function wt(e,t){let{layout:n,nodes:a,edges:s,nodeBricks:i,lines:o,layoutOptions:r,connectNodes:l,dragNodes:c,activeTarget:d,disableKeyboardAction:m,zoomable:A,scrollable:f,pannable:B,scaleRange:H,onActiveTargetChange:V,onSwitchActiveTarget:_,onNodeDelete:K,onEdgeDelete:j,onLineClick:Y,onLineDoubleClick:X,onNodesConnect:Z}=e;const[q,F]=(0,u.useState)(!1),[G,U]=(0,u.useState)(0),[J,Q]=(0,u.useState)(null),[ee,te]=(0,u.useState)(!1),[ne,ae]=(0,u.useState)(0),[se,ie]=(0,u.useState)(null),[oe,re]=(0,u.useState)([]),[le,ce]=(0,u.useState)(!1),[de,ue]=(0,u.useState)({k:1,x:0,y:0}),he=(0,u.useRef)(new Map),me=(0,u.useRef)(null),Ae=(0,u.useRef)(null),[pe,ge]=(0,u.useState)(!1),{userViewReady:fe,userViewNodesMap:ye,saveUserView:ke}=(0,O._)(null==c?void 0:c.save),[be,ve]=(0,u.useState)([0,0]),[we,Me]=(0,u.useState)(null),[Ee,We]=(0,u.useState)("initial"),[Le,Se]=(0,u.useState)(null);(0,u.useImperativeHandle)(t,(()=>({callOnLineLabel(e,t){for(var n,a=arguments.length,s=new Array(a>2?a-2:0),i=2;i<a;i++)s[i-2]=arguments[i];null==se||null===(n=se.get(e))||void 0===n||null===(n=n.firstElementChild)||void 0===n||n[t](...s)}}))),(0,u.useEffect)((()=>{const e=e=>{(0,T.P)(e,{nodes:a,nodesRefRepository:J,connectNodes:l,dragNodes:c,scale:de.k,setConnectLineState:Me,setConnectLineTo:ve,setManualLayoutStatus:We,setNodeMovement:Se,onSwitchActiveTarget:_,onNodesConnect:Z})},t=Ae.current;return null==t||t.addEventListener("mousedown",e),()=>{null==t||t.removeEventListener("mousedown",e)}}),[a,l,c,de.k,J,Z,_]);const{normalizedLines:Ne,normalizedLinesMap:Re,markers:Ce}=(0,u.useMemo)((()=>(0,W.t)(s,o)),[s,o]),xe=(0,u.useMemo)((()=>Ne.flatMap((e=>{let t,n,{line:{text:a,label:s,$id:i},edge:o}=e;return a||s?(s?(t="label",n=[].concat(s)):(t="text",n=[].concat(a)),n.map((e=>({[t]:e,id:`${i}-${e.placement??"center"}`,edge:o})))):[]}))),[Ne]),{nodes:Te,edges:ze}=(0,D.o)({layout:n,nodes:a,edges:s,manualLayoutStatus:Ee,userViewReady:fe,userViewNodesMap:ye,nodeMovement:Le,nodesRefRepository:J,lineLabelsRefRepository:se,normalizedLinesMap:Re,layoutOptions:r,nodesRenderId:G,lineLabelsRenderId:ne});(0,u.useEffect)((()=>{"finished"===Ee&&ke(Te.map((e=>({id:e.id,x:e.x,y:e.y}))))}),[Ee]);const De=(0,u.useMemo)((()=>(0,E.R)(ze,Te,Ne)),[Ne,Te,ze]),$e=d??null,[Be,Oe]=(0,u.useState)($e);(0,u.useEffect)((()=>{Oe((e=>(0,P.c)(e,$e)?e:$e))}),[$e]);const Pe=(0,u.useRef)(!1);(0,u.useEffect)((()=>{Pe.current?null==V||V(Be):Pe.current=!0}),[Be,V]),(0,u.useEffect)((()=>{const e=me.current;if(!e||m)return;const t=e=>{const t=(0,w.a)(e,{renderedNodes:Te,activeTarget:Be});"delete-node"===(null==t?void 0:t.action)?null==K||K(t.node):"delete-edge"===(null==t?void 0:t.action)?null==j||j(t.edge):"switch-active-node"===(null==t?void 0:t.action)&&t.node&&(null==_||_({type:"node",nodeId:t.node.id}))};return e.addEventListener("keydown",t),()=>{e.removeEventListener("keydown",t)}}),[Be,Te,m,_,K,j]);const Ie=(0,u.useCallback)((e=>{e&&(U((e=>e+1)),Q(e)),F((t=>t||!!e))}),[]),He=(0,u.useCallback)((e=>{e&&(ae((e=>e+1)),ie(e)),te((t=>t||!!e))}),[]),Ve=(0,u.useMemo)((()=>H??[z.sS,z.Yt]),[H]),_e=(0,u.useMemo)((()=>(0,g.s_)()),[]);(0,u.useEffect)((()=>{let e=!1;_e.scaleExtent(A?Ve:[1,1]).on("start",(()=>{e=!1,ce(!0)})).on("zoom",(t=>{e=!0,ue(t.transform)})).on("end",(()=>{ce(!1),e||null==_||_(null)}))}),[_,Ve,A,_e]),(0,u.useEffect)((()=>{const e=me.current;if(!e)return;const t=(0,p.A)(e),n=()=>{t.on(".zoom",null).on(".zoom.custom",null).on("wheel",null)};if(A||f||B)return(A||f)&&t.on("wheel.zoom.custom",(e=>{e.ctrlKey||(e.stopImmediatePropagation(),f&&(e.preventDefault(),_e.translateBy(t,e.wheelDeltaX/5,e.wheelDeltaY/5)))})),t.call(_e).on("wheel",(e=>e.preventDefault())).on("dblclick.zoom",null),B||t.on("mousedown.zoom",null).on("touchstart.zoom",null).on("touchmove.zoom",null).on("touchend.zoom",null),n;n()}),[B,f,A,_e]),(0,u.useEffect)((()=>{const e=me.current;if(0===Te.length||!e||pe)return;const{k:t,x:n,y:a}=(0,M.r)(Te,{canvasWidth:e.clientWidth,canvasHeight:e.clientHeight,scaleRange:A?Ve:void 0});_e.transform((0,p.A)(e),new g.uV(t,n,a)),ge(!0)}),[pe,Te,Ve,A,_e]);const Ke=(0,u.useMemo)((()=>`${(0,k.uniqueId)("diagram-")}-`),[]),je=`${Ke}line-arrow-`,Ye=`${Ke}mask-`,Xe=`${Ke}active-line-`;(0,u.useEffect)((()=>{re((e=>(0,x.z)(e,De,he.current)))}),[De]);const[Ze,qe]=h().useState(new Map);return(0,u.useEffect)((()=>{if(!se)return;(0,$.F)(oe,se);const e=new b.A((()=>{qe((0,I.G)(oe,se))}));for(const t of se.values())e.observe(t);return()=>{e.disconnect()}}),[ne,se,oe]),"dagre"!==n&&"force"!==n?h().createElement("div",null,`Diagram layout not supported: "${n}"`):h().createElement("div",{className:y()("diagram",{ready:q&&pe,grabbing:le,pannable:B}),tabIndex:-1,ref:me},h().createElement("svg",{width:"100%",height:"100%",className:"lines"},h().createElement("defs",null,Ce.map(((e,t)=>{let{type:n,strokeColor:a}=e;return h().createElement(N.c,{key:t,id:`${je}${t}`,type:n,strokeColor:a})})),[...Ze].map((e=>{let[t,n]=e;return h().createElement(R.y,{key:t,lineId:t,rects:n,maskPrefix:Ye,renderedLineLabels:oe})})),h().createElement("marker",{id:`${Xe}start`,viewBox:"0 0 8 8",refX:4,refY:4,markerWidth:8,markerHeight:8,orient:"auto"},h().createElement("path",{d:"M 0.5 0.5 H 7.5 V 7.5 H 0.5 Z",stroke:"var(--palette-gray-7)",strokeWidth:1,fill:"var(--palette-gray-1)"})),h().createElement("marker",{id:`${Xe}end`,viewBox:"0 0 14 8",refX:3,refY:4,markerWidth:14,markerHeight:8,orient:"auto"},h().createElement("path",{d:"M 0.5 1.5 L 5.5 4 L 0.5 6.5 z",stroke:"var(--palette-blue-3)",strokeWidth:1,fill:"var(--palette-blue-3)"}),h().createElement("path",{d:"M 6.5 0.5 H 13.5 V 7.5 H 6.5 Z",stroke:"var(--palette-gray-7)",strokeWidth:1,fill:"var(--palette-gray-1)"}))),h().createElement("g",{transform:`translate(${de.x} ${de.y}) scale(${de.k})`},De.map((e=>h().createElement(S.m,{key:e.line.$id,line:e,linePaths:he.current,lineMaskRects:Ze,maskPrefix:Ye,markerPrefix:je,activeLineMarkerPrefix:Xe,active:"edge"===(null==Be?void 0:Be.type)&&Be.edge.source===e.edge.source&&Be.edge.target===e.edge.target,activeRelated:"node"===(null==Be?void 0:Be.type)&&(e.edge.source===Be.nodeId||e.edge.target===Be.nodeId),onLineClick:Y,onLineDoubleClick:X}))))),h().createElement("div",{className:y()("line-labels",{ready:ee}),style:{left:de.x,top:de.y,transform:`scale(${de.k})`}},h().createElement(L.d2,{labels:xe,onRendered:He})),h().createElement("div",{className:"nodes",ref:Ae,style:{left:de.x,top:de.y,transform:`scale(${de.k})`}},h().createElement(v.p,{nodes:a,nodeBricks:i,onRendered:Ie})),h().createElement(C.w,{connectLineState:we,connectLineTo:be,markerPrefix:je}))}a=vt,({e:[_,K,j,Y,X,Z,q,F,G,U,J,Q,ee,te,ne,ae,se,ie,oe,re,le,ce,de,ue,he,me,Ae,pe,ge,fe,ye,ke,be,ve,we,Me,Ee,We,Le,Se,Ne,Re,Ce,xe,Te,ze,De,$e,Be,Oe,Pe,Ie,H],c:[Ye,V]}=(0,d.A)(a,[He("eo-diagram",{styleTexts:[B.A]})],[[Ve({type:String}),1,"layout"],[Ve({attribute:!1}),1,"nodes"],[Ve({attribute:!1}),1,"edges"],[Ve({attribute:!1}),1,"nodeBricks"],[Ve({attribute:!1}),1,"lines"],[Ve({attribute:!1}),1,"layoutOptions"],[Ve({attribute:!1}),1,"activeTarget"],[Ve({type:Boolean}),1,"disableKeyboardAction"],[Ve({attribute:!1}),1,"connectNodes"],[Ve({attribute:!1}),1,"dragNodes"],[Ve({type:Boolean}),1,"zoomable"],[Ve({type:Boolean}),1,"scrollable"],[Ve({type:Boolean}),1,"pannable"],[Ve({attribute:!1}),1,"scaleRange"],[_e({type:"activeTarget.change"}),1,"activeTargetChangeEvent",e=>(0,c.A)(ot,e),(e,t)=>(0,l.A)(ot,e,t)],[_e({type:"node.delete"}),1,"nodeDelete",e=>(0,c.A)(ct,e),(e,t)=>(0,l.A)(ct,e,t)],[_e({type:"edge.delete"}),1,"edgeDelete",e=>(0,c.A)(ut,e),(e,t)=>(0,l.A)(ut,e,t)],[_e({type:"line.click"}),1,"lineClick",e=>(0,c.A)(mt,e),(e,t)=>(0,l.A)(mt,e,t)],[_e({type:"line.dblclick"}),1,"lineDoubleClick",e=>(0,c.A)(pt,e),(e,t)=>(0,l.A)(pt,e,t)],[_e({type:"nodes.connect"}),1,"connectNodes",e=>(0,c.A)(ft,e),(e,t)=>(0,l.A)(ft,e,t)],[Ke(),2,"callOnLineLabel"]],0,(e=>bt.has((0,o.A)(e))),A.ReactNextElement)),V()},2559:(e,t,n)=>{function a(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}n.d(t,{A:()=>a})},2016:(e,t,n)=>{function a(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}n.d(t,{A:()=>a})},829:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(2559);function s(e,t){return e.get((0,a.A)(e,t))}},918:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(2016);function s(e,t,n){(0,a.A)(e,t),t.set(e,n)}},6121:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(2559);function s(e,t,n){return e.set((0,a.A)(e,t),n),n}},4635:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(2016);function s(e,t){(0,a.A)(e,t),t.add(e)}},1369:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(7545);function s(e){var t=function(e,t){if("object"!=(0,a.A)(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=(0,a.A)(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==(0,a.A)(t)?t:t+""}},7545:(e,t,n)=>{function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}n.d(t,{A:()=>a})}}]);
//# sourceMappingURL=eo-diagram.93f17e33.js.map