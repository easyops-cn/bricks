{"version":3,"file":"chunks/push-history.a3eb8178.js","mappings":"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","sources":["webpack:///./src/data-providers/visit-history.ts","webpack:///./src/utils.ts","webpack:///../../src/JsonStorage.ts"],"sourcesContent":["import { createProviderClass } from \"@next-core/utils/general\";\nimport { VisitHistoryData, VisitHistory } from \"../utils.js\";\n\nexport function getAllHistory(\n  namespace: string,\n  capacity?: number\n): VisitHistoryData[] {\n  return new VisitHistory(namespace, capacity).getAll();\n}\n\nexport function pushHistory(\n  namespace: string,\n  capacity: number,\n  data: VisitHistoryData\n): void {\n  new VisitHistory(namespace, capacity).set(data);\n}\n\nexport function clearHistory(namespace: string): void {\n  new VisitHistory(namespace).clear();\n}\n\ncustomElements.define(\n  \"recent-history.get-all-history\",\n  createProviderClass(getAllHistory)\n);\n\ncustomElements.define(\n  \"recent-history.push-history\",\n  createProviderClass(pushHistory)\n);\n\ncustomElements.define(\n  \"recent-history.clear-history\",\n  createProviderClass(clearHistory)\n);\n","import { JsonStorage } from \"@next-shared/general/JsonStorage\";\nimport { LRUCacheWithDelete } from \"mnemonist\";\n\nexport interface VisitHistoryData {\n  key: string;\n  name: string;\n  [key: string]: any;\n}\n\nexport const VISIT_HISTORY_NAME_SPACE = \"recent-history\";\n\nconst storage = new JsonStorage(localStorage);\n\nexport class VisitHistory {\n  #namespace: string;\n  #storageNamespace: string;\n  #capacity: number;\n  #LRUCache: LRUCacheWithDelete<string, VisitHistoryData>;\n\n  constructor(namespace: string, capacity = 100) {\n    this.#namespace = namespace;\n    this.#storageNamespace = `${VISIT_HISTORY_NAME_SPACE}-${namespace}`;\n    this.#capacity = capacity;\n\n    if (!storage.getItem(this.#storageNamespace)) {\n      storage.setItem(this.#storageNamespace, []);\n    }\n\n    const history = storage.getItem(\n      this.#storageNamespace\n    ) as VisitHistoryData[];\n\n    this.#LRUCache = new LRUCacheWithDelete(this.#capacity);\n    history.reverse().forEach((h) => {\n      this.#LRUCache.set(h.key, h);\n    });\n  }\n\n  #updateStorage() {\n    const list = [...this.#LRUCache.values()];\n    storage.setItem(this.#storageNamespace, list);\n    window.dispatchEvent(\n      new CustomEvent<{ namespace: string; list: VisitHistoryData[] }>(\n        \"recent-history-change\",\n        { detail: { namespace: this.#namespace, list } }\n      )\n    );\n  }\n\n  set(data: VisitHistoryData) {\n    this.#LRUCache.set(data.key, data);\n    this.#updateStorage();\n  }\n\n  get(key: string) {\n    const data = this.#LRUCache.get(key);\n    this.#updateStorage();\n    return data;\n  }\n\n  getAll() {\n    return [...this.#LRUCache.values()];\n  }\n\n  peek(key: string) {\n    return this.#LRUCache.peek(key);\n  }\n\n  has(key: string) {\n    return this.#LRUCache.has(key);\n  }\n\n  delete(key: string) {\n    const result = this.#LRUCache.delete(key);\n    this.#updateStorage();\n    return result;\n  }\n\n  remove(key: string) {\n    const data = this.#LRUCache.remove(key);\n    this.#updateStorage();\n    return data;\n  }\n\n  clear() {\n    this.#LRUCache.clear();\n    this.#updateStorage();\n  }\n}\n","export class JsonStorage {\n  constructor(\n    private storage: Storage,\n    private prefix: string = \"brick-next-\"\n  ) {}\n\n  setItem<T = any>(name: string, value: T): void {\n    this.storage.setItem(this.prefix + name, JSON.stringify(value));\n  }\n\n  getItem<T = any>(name: string): T {\n    return JSON.parse(this.storage.getItem(this.prefix + name) as string) as T;\n  }\n\n  removeItem(name: string): void {\n    return this.storage.removeItem(this.prefix + name);\n  }\n\n  clear(): void {\n    return this.storage.clear();\n  }\n}\n"],"names":["getAllHistory","namespace","capacity","VisitHistory","getAll","pushHistory","data","set","clearHistory","clear","customElements","define","createProviderClass","storage","JsonStorage","localStorage","_namespace","WeakMap","_storageNamespace","_capacity","_LRUCache","_VisitHistory_brand","WeakSet","constructor","arguments","length","undefined","_classPrivateMethodInitSpec","_classPrivateFieldInitSpec","_classPrivateFieldSet","this","getItem","_classPrivateFieldGet","setItem","history","LRUCacheWithDelete","reverse","forEach","h","key","_assertClassBrand","_updateStorage","call","get","values","peek","has","delete","result","remove","list","window","dispatchEvent","CustomEvent","detail","prefix","name","value","JSON","stringify","parse","removeItem"],"sourceRoot":""}