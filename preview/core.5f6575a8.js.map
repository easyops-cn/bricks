{"version":3,"file":"core.5f6575a8.js","mappings":"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","sources":["webpack:///../brick-container/src/replaceChildren.ts","webpack:///./src/replaceUseChildren.ts","webpack:///./src/bootstrap.ts","webpack:///../../src/ExecutionContext.ts","webpack:///../../src/traverse.ts","webpack:///../../src/context-free.ts","webpack:///../../src/sanitize.ts","webpack:///../../src/cook.ts","webpack:///../../src/AnalysisContext.ts","webpack:///../../src/precook.ts","webpack:///../../src/hasOwnProperty.ts","webpack:///../../src/precookFunction.ts","webpack:///../../src/parse.ts","webpack:///../../src/preevaluate.ts","webpack:///../../src/fetch.ts","webpack:///../../src/errors.ts","webpack:///../../src/InterceptorManager.ts","webpack:///../../src/http.ts","webpack:///../../src/index.ts","webpack:///../../src/init.ts","webpack:///../../src/text.ts","webpack:///../../src/interfaces.ts","webpack:///../../src/lexical.ts","webpack:///../../src/compile.ts","webpack:///../../src/syntax.ts","webpack:///../../src/loadScriptOrStyle.ts","webpack:///../../src/loadScript.ts","webpack:///../../src/loadStyle.ts","webpack:///../../src/loadSharedModule.ts","webpack:///../../src/stableLoadBricks.ts","webpack:///../../src/getBasePath.ts","webpack:///../../../src/internal/matchStoryboard.ts","webpack:///../../../src/internal/historyExtended.ts","webpack:///../../src/history.ts","webpack:///../../../src/internal/Runtime.ts","webpack:///../../src/getV2RuntimeFromDll.ts","webpack:///../../src/CustomProcessors.ts","webpack:///../../../src/internal/registerAppI18n.ts","webpack:///../../../../src/internal/compute/WidgetI18n.ts","webpack:///../../../src/internal/devtools.ts","webpack:///../../../src/internal/proxyFactories.ts","webpack:///../../src/themeAndMode.ts","webpack:///../../../../src/internal/compute/getGeneralGlobals.ts","webpack:///../../src/StoryboardFunctionRegistry.ts","webpack:///../../../../src/internal/compute/StoryboardFunctions.ts","webpack:///../../../src/internal/mediaQuery.ts","webpack:///../../../../src/internal/compute/getStorageItem.ts","webpack:///../../src/isStrictMode.ts","webpack:///../../src/CustomTemplates.ts","webpack:///../../../../src/internal/CustomTemplates/utils.ts","webpack:///../../../../src/internal/compute/WidgetFunctions.ts","webpack:///../../../src/internal/hasInstalledApp.ts","webpack:///../../../../src/internal/FormRenderer/utils.ts","webpack:///../../../../src/internal/data/getProviderBrick.ts","webpack:///../../../../src/internal/compute/markAsComputed.ts","webpack:///../../../../src/internal/data/resolveData.ts","webpack:///../../../../src/internal/compute/evaluate.ts","webpack:///../../../../src/internal/compute/getNextStateOfUseBrick.ts","webpack:///../../../../src/internal/compute/computeRealValue.ts","webpack:///../../../../src/internal/compute/checkIf.ts","webpack:///../../../../src/internal/compute/getTracks.ts","webpack:///../../../../src/internal/compute/computeRealProperties.ts","webpack:///../../../../src/internal/compute/setRealProperties.ts","webpack:///../../../../src/internal/compute/setProperties.ts","webpack:///../../../../src/internal/compute/listenOnTrackingContext.ts","webpack:///../../../src/internal/matchPath.ts","webpack:///../../../src/internal/matchRoutes.ts","webpack:///../../../../src/internal/CustomTemplates/constants.ts","webpack:///../../../src/internal/poll.ts","webpack:///../../../src/internal/i18n.ts","webpack:///../../src/Dialog.ts","webpack:///../../src/setLoginStateCookie.ts","webpack:///../../src/handleHttpError.ts","webpack:///../../src/Notification.ts","webpack:///../../../src/internal/bindListeners.ts","webpack:///../../../src/internal/sse.ts","webpack:///../../../../src/internal/CustomTemplates/bindTemplateProxy.ts","webpack:///../../../src/internal/enums.ts","webpack:///../../../src/internal/mount.ts","webpack:///../../../src/internal/RendererContext.ts","webpack:///../../../src/internal/routeMatchedMap.ts","webpack:///../../../src/internal/secret_internals.ts","webpack:///../../../../src/internal/data/realTimeDataInspect.ts","webpack:///../../../../src/internal/data/DataStore.ts","webpack:///../../../../src/internal/data/resolveDataStore.ts","webpack:///../../../../src/internal/CustomTemplates/setupTemplateProxy.ts","webpack:///../../../../src/internal/CustomTemplates/setupUseBrickInTemplate.ts","webpack:///../../../../src/internal/CustomTemplates/expandCustomTemplate.ts","webpack:///../../../../src/internal/FormRenderer/constants.ts","webpack:///../../../../src/internal/FormRenderer/expandFormRenderer.ts","webpack:///../../../../src/internal/FormRenderer/getDefaultProperties.ts","webpack:///../../../../src/internal/FormRenderer/registerFormRenderer.ts","webpack:///../../../src/internal/ErrorNode.ts","webpack:///../../../src/internal/Renderer.ts","webpack:///../../../src/internal/setupRootRuntimeContext.ts","webpack:///../../src/getPageInfo.ts","webpack:///../../../src/internal/abortController.ts","webpack:///../../src/setWatermark.ts","webpack:///../../../src/internal/registerCustomTemplates.ts","webpack:///../../src/setUIVersion.ts","webpack:///../../../src/internal/Router.ts","webpack:///../../src/setAppVariable.ts","webpack:///../../../src/internal/fulfilStoryboard.ts","webpack:///../../../src/internal/insertPreviewRoutes.ts","webpack:///../../../src/internal/injected.ts","webpack:///../../../src/internal/customizeColorTheme.ts","webpack:///../../src/auth.ts","webpack:///../../src/CustomEditors.ts","webpack:///../../src/fetchByProvider.ts","webpack:///../../src/createRoot.ts","webpack:///../../src/getRealValue.ts","webpack:///../../../src/general/createProviderClass.ts","webpack:///../../../src/general/createSSEStream.ts","webpack:///../../../src/general/deepFreeze.ts","webpack:///../../../src/general/hasOwnProperty.ts","webpack:///../../../src/general/isObject.ts","webpack:///../../../src/general/JsonStorage.ts","webpack:///../../../src/general/unwrapProvider.ts","webpack:///../../../../src/storyboard/expressions/beforeVisitGlobalMember.ts","webpack:///../../../../src/storyboard/expressions/collectMemberCallUsage.ts","webpack:///../../../../src/storyboard/expressions/traverse.ts","webpack:///../../../../src/storyboard/expressions/collectMemberUsage.ts","webpack:///../../../../src/storyboard/expressions/track.ts","webpack:///../../../../src/storyboard/functions/traverse.ts","webpack:///../../../../src/storyboard/functions/collectMemberUsageInFunction.ts","webpack:///../../../src/storyboard/permissions.ts"],"sourcesContent":["// polyfill for replaceChildren\nif (Element.prototype.replaceChildren === undefined) {\n  Element.prototype.replaceChildren = function (...nodes: (string | Node)[]) {\n    while (this.lastChild) {\n      this.removeChild(this.lastChild);\n    }\n    if (nodes.length > 0) {\n      this.append(...nodes);\n    }\n  };\n}\nif (DocumentFragment.prototype.replaceChildren === undefined) {\n  DocumentFragment.prototype.replaceChildren = function (\n    ...nodes: (string | Node)[]\n  ) {\n    while (this.lastChild) {\n      this.removeChild(this.lastChild);\n    }\n    if (nodes.length > 0) {\n      this.append(...nodes);\n    }\n  };\n}\n","import type { BrickConf, SlotConfOfBricks } from \"@next-core/types\";\nimport { isObject } from \"@next-core/utils/general\";\nimport { pull } from \"lodash\";\n\nconst USE_CHILDREN_SLOT_REGEXP = /^\\[\\w+\\]$/;\n\n/**\n * Replace `useChildren: \"[xxx]\"` with `useBrick`.\n */\nexport function replaceUseChildren(bricks: BrickConf[]) {\n  for (const brick of bricks) {\n    replaceInBrick(brick);\n  }\n}\n\nfunction replaceInBrick(brick: BrickConf) {\n  let slots = brick.slots;\n  const useChildrenMap = new Map<string, BrickConf[]>();\n  if (Array.isArray(brick.children) && !slots) {\n    const removeBricks: BrickConf[] = [];\n    for (const child of brick.children) {\n      const slot = child.slot ?? \"\";\n      if (USE_CHILDREN_SLOT_REGEXP.test(slot)) {\n        delete child.slot;\n        const children = useChildrenMap.get(slot);\n        if (children) {\n          children.push(child);\n        } else {\n          useChildrenMap.set(slot, [child]);\n        }\n        removeBricks.push(child);\n      }\n      replaceInBrick(child);\n    }\n    pull(brick.children, ...removeBricks);\n  } else {\n    slots ??= {};\n    for (const [slot, slotConf] of Object.entries(slots)) {\n      if (USE_CHILDREN_SLOT_REGEXP.test(slot)) {\n        const { bricks: children } = slotConf as SlotConfOfBricks;\n        if (Array.isArray(children) && children.length > 0) {\n          useChildrenMap.set(slot, children);\n          replaceUseChildren(children);\n        }\n        delete slots[slot];\n      }\n\n      if (Array.isArray((slotConf as SlotConfOfBricks).bricks)) {\n        replaceUseChildren((slotConf as SlotConfOfBricks).bricks);\n      }\n    }\n  }\n\n  if (useChildrenMap.size > 0) {\n    replaceInProperties(brick.properties, useChildrenMap);\n  }\n}\n\nfunction replaceInProperties(\n  value: unknown,\n  useChildrenMap: Map<string, BrickConf[]>\n) {\n  if (Array.isArray(value)) {\n    for (const item of value) {\n      replaceInProperties(item, useChildrenMap);\n    }\n  } else if (isObject(value)) {\n    for (const [k, v] of Object.entries(value)) {\n      if (k === \"useChildren\") {\n        const children = useChildrenMap.get(v as string);\n        if (children) {\n          delete value[k];\n          value.useBrick = children.length === 1 ? children[0] : children;\n        }\n      } else {\n        replaceInProperties(v, useChildrenMap);\n      }\n    }\n  }\n}\n","// istanbul ignore file\nimport {\n  createRuntime,\n  applyTheme,\n  setUIVersion,\n  unstable_createRoot,\n} from \"@next-core/runtime\";\nimport { http, HttpRequestConfig } from \"@next-core/http\";\nimport { loadBricksImperatively } from \"@next-core/loader\";\nimport type {\n  BootstrapData,\n  BrickConf,\n  BrickPackage,\n  ContextConf,\n  CustomTemplate,\n  MetaI18n,\n  StoryboardFunction,\n} from \"@next-core/types\";\nimport { i18n } from \"@next-core/i18n\";\nimport { safeLoad, JSON_SCHEMA } from \"js-yaml\";\nimport \"@next-core/theme\";\nimport type {\n  RenderType,\n  Sources,\n  RenderOptions,\n  PreviewWindow,\n} from \"../types.d.ts\";\nimport { get } from \"lodash\";\nimport { replaceUseChildren } from \"./replaceUseChildren.js\";\n// Chrome supports `Element.prototype.replaceChildren` since version 86\nimport \"../../brick-container/src/replaceChildren.js\";\n\ninterface RenderRequest {\n  type: RenderType;\n  sources: Sources;\n  options?: RenderOptions;\n}\n\nhttp.interceptors.request.use((config) => {\n  dispatchRequestEventByConfig(\"request.start\", config);\n  return config;\n});\n\nhttp.interceptors.response.use(\n  function (response, config) {\n    dispatchRequestEventByConfig(\"request.end\", config);\n    return response;\n  },\n  function (error, config) {\n    dispatchRequestEventByConfig(\"request.end\", config);\n    return Promise.reject(error);\n  }\n);\n\nfunction dispatchRequestEventByConfig(type: string, config: HttpRequestConfig) {\n  if (!config.options?.interceptorParams?.ignoreLoadingBar) {\n    window.dispatchEvent(new Event(type));\n  }\n}\n\nconst loadingBar = document.querySelector(\"#global-loading-bar\");\nloadingBar.classList.add(\"rendered\");\n\nlet loading = false;\nlet count = 0;\nfunction updateLoadingStatus() {\n  const hasRemainingRequests = count > 0;\n  if (hasRemainingRequests !== loading) {\n    loading = hasRemainingRequests;\n    loadingBar.classList[hasRemainingRequests ? \"add\" : \"remove\"](\"loading\");\n  }\n}\nconst requestStart = (): void => {\n  count++;\n  updateLoadingStatus();\n};\nconst requestEnd = (): void => {\n  // 兼容 loading bar 在某些请求开始和结束之间初始化时，`count` 可能小于 0 的情况\n  if (count > 0) {\n    count--;\n    updateLoadingStatus();\n  }\n};\nwindow.addEventListener(\"request.start\", requestStart);\nwindow.addEventListener(\"request.end\", requestEnd);\n\nconst runtime = createRuntime();\n\nconst container = document.querySelector(\"#preview-root\") as HTMLElement;\nconst portal = document.querySelector(\"#portal-mount-point\") as HTMLElement;\nconst root = unstable_createRoot(container, {\n  portal,\n  scope: \"page\",\n  unknownBricks: \"silent\",\n});\n\nconst bootstrap = http\n  .get<BootstrapData>(window.BOOTSTRAP_FILE, {\n    responseType: \"json\",\n  })\n  .then((data) => {\n    runtime.initialize(\n      (window.BOOTSTRAP_FILE_FIELD\n        ? get(data, window.BOOTSTRAP_FILE_FIELD)\n        : data) as BootstrapData\n    );\n  });\n\nlet rendering = false;\nlet nextRequest: RenderRequest;\n\n(window as PreviewWindow)._preview_only_render = (type, sources, options) => {\n  if (rendering) {\n    nextRequest = { type, sources, options };\n  } else {\n    queuedRender({ type, sources, options });\n  }\n};\n\n(window as PreviewWindow)._preview_only_inject = async (\n  brick,\n  pkg,\n  options,\n  noResolve\n) => {\n  await loadBricksImperatively([brick], ([] as BrickPackage[]).concat(pkg));\n  if (noResolve) {\n    return;\n  }\n  const element = document.createElement(brick) as HTMLElement & {\n    resolve: (options: unknown) => Promise<void>;\n  };\n  await element.resolve(options);\n};\n\nasync function queuedRender(request: RenderRequest) {\n  rendering = true;\n  try {\n    const { type, sources, options } = request;\n    // Assert: `render()` will not throw\n    await render(type, sources, options);\n  } finally {\n    rendering = false;\n    if (nextRequest) {\n      const req = nextRequest;\n      nextRequest = undefined;\n      queuedRender(req);\n    }\n  }\n}\n\nlet initialized = false;\n\nasync function render(\n  type: \"html\" | \"yaml\",\n  { yaml, html }: Sources,\n  {\n    theme,\n    uiVersion,\n    language,\n    context,\n    functions,\n    templates,\n    i18n: i18nData,\n    url,\n    app,\n    styleText,\n    templatesAreArrayOfYaml,\n  }: RenderOptions = {}\n): Promise<void> {\n  try {\n    if (!initialized) {\n      initialized = true;\n      document.body.classList.add(\"bootstrap-ready\");\n      applyTheme(theme === \"light\" ? theme : \"dark-v2\");\n    }\n    document.body.classList.remove(\"bootstrap-error\");\n    if (type === \"html\") {\n      applyTheme(theme === \"light\" ? theme : \"dark-v2\");\n      setUIVersion(uiVersion);\n      if (language) {\n        await i18n.changeLanguage(language);\n      }\n      // Note: if use DOMParser, script tags will not be executed, while using\n      const parser = new DOMParser();\n      const dom = parser.parseFromString(html, \"text/html\");\n      const bricks = new Set<string>();\n      for (const node of dom.body.querySelectorAll(\"*\")) {\n        if (node.tagName.includes(\"-\")) {\n          const lowerTagName = node.tagName.toLowerCase();\n          bricks.add(lowerTagName);\n        } else if (node.tagName === \"SCRIPT\") {\n          const bricksInScript = (node as HTMLScriptElement).text.matchAll(\n            /\\bdocument\\.createElement\\(\\s*\"([a-zA-Z0-9.]+-[-a-zA-Z0-9.]+)\"\\s*\\)/g\n          );\n          for (const match of bricksInScript) {\n            bricks.add(match[1]);\n          }\n        }\n      }\n\n      await bootstrap;\n\n      await runtime.loadBricks(bricks);\n      container.replaceChildren();\n      portal.replaceChildren();\n      const scripts: HTMLScriptElement[] = [];\n      const scriptTags = dom.querySelectorAll(\"script\");\n      for (const scriptTag of scriptTags) {\n        const newScriptTag = document.createElement(\"script\");\n        newScriptTag.text = scriptTag.text;\n        newScriptTag.type = \"module\";\n        scripts.push(newScriptTag);\n        scriptTag.remove();\n      }\n      container.append(\n        ...dom.head.querySelectorAll(\"style\"),\n        ...dom.body.childNodes,\n        ...scripts\n      );\n    } else {\n      const parsed = yaml\n        ? (safeLoad(yaml, { schema: JSON_SCHEMA, json: true }) as\n            | BrickConf\n            | BrickConf[])\n        : null;\n      const bricks = [].concat(parsed ?? []);\n      replaceUseChildren(bricks);\n      if (styleText) {\n        bricks.push({\n          brick: \"style\",\n          portal: true,\n          properties: {\n            textContent: styleText,\n          },\n        });\n      }\n\n      const parsedContext = loadYaml(context) as ContextConf[];\n      const parsedFunctions = loadYaml(functions) as StoryboardFunction[];\n      const parsedTemplates = loadYaml(\n        templates,\n        templatesAreArrayOfYaml\n      ) as CustomTemplate[];\n      const parsedI18n = loadYaml(i18nData) as MetaI18n;\n\n      if (Array.isArray(parsedTemplates)) {\n        for (const template of parsedTemplates) {\n          if (Array.isArray(template.bricks)) {\n            replaceUseChildren(template.bricks);\n          }\n        }\n      }\n\n      await bootstrap;\n      await root.render(bricks, {\n        theme: theme === \"light\" ? theme : \"dark-v2\",\n        uiVersion,\n        language,\n        context: parsedContext,\n        functions: parsedFunctions,\n        templates: parsedTemplates,\n        i18n: parsedI18n,\n        url,\n        app,\n      });\n    }\n  } catch (e) {\n    // eslint-disable-next-line no-console\n    console.error(\"Render failed:\", e);\n\n    // `.bootstrap-error` makes loading-bar invisible.\n    document.body.classList.add(\"bootstrap-error\");\n\n    portal.textContent = \"\";\n    container.textContent = `Render failed: ${String(e)}`;\n  }\n}\n\ninterface YamlTemplate {\n  name: string;\n  yaml: string;\n}\n\nfunction loadYaml(content: unknown, templatesAreArrayOfYaml?: boolean) {\n  return typeof content === \"string\"\n    ? safeLoad(content, { schema: JSON_SCHEMA, json: true })\n    : templatesAreArrayOfYaml\n      ? (content as YamlTemplate[]).map((item) =>\n          typeof item.yaml === \"string\"\n            ? {\n                ...(safeLoad(item.yaml, {\n                  schema: JSON_SCHEMA,\n                  json: true,\n                }) as CustomTemplate),\n                name: item.name,\n              }\n            : item\n        )\n      : content;\n}\n","import type {\n  ArrowFunctionExpression,\n  Expression,\n  FunctionDeclaration,\n  FunctionExpression,\n  Statement,\n} from \"@babel/types\";\nimport type { EstreeNode } from \"./interfaces.js\";\n\nexport enum Mode {\n  LEXICAL,\n  STRICT,\n}\n\nexport const SourceNode = Symbol.for(\"SourceNode\");\nexport const FormalParameters = Symbol.for(\"FormalParameters\");\nexport const ECMAScriptCode = Symbol.for(\"ECMAScriptCode\");\nexport const Environment = Symbol.for(\"Environment\");\nexport const IsConstructor = Symbol.for(\"IsConstructor\");\nexport const ThisMode = Symbol.for(\"ThisMode\");\nexport const DebuggerCall = Symbol.for(\"$DebuggerCall$\");\nexport const DebuggerScope = Symbol.for(\"$DebuggerScope$\");\nexport const DebuggerNode = Symbol.for(\"$DebuggerNode$\");\nexport const DebuggerReturn = Symbol.for(\"$DebuggerReturn$\");\n\n// https://tc39.es/ecma262/#sec-execution-contexts\nexport class ExecutionContext {\n  VariableEnvironment?: EnvironmentRecord;\n  LexicalEnvironment?: EnvironmentRecord;\n  Function?: FunctionObject;\n}\n\nexport type EnvironmentRecordType = \"function\" | \"declarative\";\n\nexport enum BindingStatus {\n  UNINITIALIZED,\n  LEXICAL,\n  INITIALIZED,\n}\n\n// https://tc39.es/ecma262/#sec-environment-records\nexport class EnvironmentRecord {\n  readonly OuterEnv: EnvironmentRecord | null | undefined;\n  private readonly bindingMap = new Map<string, BindingState>();\n  protected ThisValue: unknown = undefined;\n  protected ThisBindingStatus: BindingStatus | undefined;\n\n  constructor(outer: EnvironmentRecord | null | undefined) {\n    this.OuterEnv = outer;\n  }\n\n  HasBinding(name: string): boolean {\n    return this.bindingMap.has(name);\n  }\n\n  CreateMutableBinding(name: string, deletable: boolean): CompletionRecord {\n    // Assert: binding does not exist.\n    this.bindingMap.set(name, {\n      mutable: true,\n      deletable,\n    });\n    return NormalCompletion(undefined);\n  }\n\n  /**\n   * Create an immutable binding.\n   *\n   * @param name - The binding name.\n   * @param strict - For named function expressions, strict is false, otherwise it's true.\n   * @returns CompletionRecord.\n   */\n  CreateImmutableBinding(name: string, strict: boolean): CompletionRecord {\n    // Assert: binding does not exist.\n    this.bindingMap.set(name, {\n      strict,\n    });\n    return NormalCompletion(undefined);\n  }\n\n  InitializeBinding(name: string, value: unknown): CompletionRecord {\n    const binding = this.bindingMap.get(name) as BindingState;\n    // Assert: binding exists and uninitialized.\n    Object.assign<BindingState, Partial<BindingState>>(binding, {\n      initialized: true,\n      value,\n    });\n    return NormalCompletion(undefined);\n  }\n\n  /**\n   * Update a mutable binding value, including function declarations.\n   *\n   * @param name - The binding name.\n   * @param value - The binding value.\n   * @param strict - For functions, strict is always false, otherwise it depends on strict-mode.\n   * @returns\n   */\n  SetMutableBinding(\n    name: string,\n    value: unknown,\n    _strict?: boolean\n  ): CompletionRecord {\n    const binding = this.bindingMap.get(name) as BindingState;\n    // Assert: binding exists.\n    if (!binding.initialized) {\n      throw new ReferenceError(`${name} is not initialized`);\n    } else if (binding.mutable) {\n      binding.value = value;\n    } else {\n      throw new TypeError(`Assignment to constant variable`);\n    }\n    return NormalCompletion(undefined);\n  }\n\n  GetBindingValue(name: string, _strict?: boolean): unknown {\n    const binding = this.bindingMap.get(name) as BindingState;\n    // Assert: binding exists.\n    if (!binding.initialized) {\n      throw new ReferenceError(`${name} is not initialized`);\n    }\n    return binding.value;\n  }\n\n  HasThisBinding() {\n    return false;\n  }\n}\n\nexport class DeclarativeEnvironment extends EnvironmentRecord {}\n\nexport class FunctionEnvironment extends EnvironmentRecord {\n  constructor(F: FunctionObject) {\n    super(F[Environment]);\n    if (F[ThisMode] === Mode.LEXICAL) {\n      this.ThisBindingStatus = BindingStatus.LEXICAL;\n    } else {\n      this.ThisBindingStatus = BindingStatus.UNINITIALIZED;\n    }\n  }\n\n  HasThisBinding() {\n    return this.ThisBindingStatus !== BindingStatus.LEXICAL;\n  }\n\n  BindThisValue(value: unknown) {\n    // Assert: envRec.[[ThisBindingStatus]] is not LEXICAL.\n    if (this.ThisBindingStatus === BindingStatus.INITIALIZED) {\n      throw new Error(\"This binding has been initialized\");\n    }\n    this.ThisValue = value;\n    this.ThisBindingStatus = BindingStatus.INITIALIZED;\n  }\n\n  GetThisBinding() {\n    // Assert: envRec.[[ThisBindingStatus]] is not LEXICAL.\n    if (this.ThisBindingStatus === BindingStatus.UNINITIALIZED) {\n      throw new Error(\"This binding is not initialized\");\n    }\n    return this.ThisValue;\n  }\n}\n\nexport interface BindingState {\n  initialized?: boolean;\n  value?: unknown;\n  mutable?: boolean;\n\n  /** This is used for mutable bindings only. */\n  deletable?: boolean;\n\n  /**\n   * This is used for immutable bindings only.\n   * For named function expressions, `strict` is false,\n   * otherwise it's true.\n   */\n  strict?: boolean;\n}\n\nexport interface FunctionObject {\n  (...args: unknown[]): unknown;\n  [SourceNode]:\n    | FunctionDeclaration\n    | FunctionExpression\n    | ArrowFunctionExpression;\n  [FormalParameters]: FunctionDeclaration[\"params\"];\n  [ECMAScriptCode]: Statement[] | Expression;\n  [Environment]: EnvironmentRecord;\n  [IsConstructor]: boolean;\n  [ThisMode]?: Mode;\n  [DebuggerCall]?: (...args: unknown[]) => IterableIterator<unknown>;\n  [DebuggerScope]?: () => EnvironmentRecord | null | undefined;\n  [DebuggerNode]?: () => EstreeNode | undefined;\n}\n\n// https://tc39.es/ecma262/#sec-reference-record-specification-type\nexport class ReferenceRecord {\n  readonly Base:\n    | Record<PropertyKey, unknown>\n    | EnvironmentRecord\n    | \"unresolvable\";\n  readonly ReferenceName: PropertyKey;\n  /** Whether the reference is in strict mode. */\n  readonly Strict?: boolean;\n\n  constructor(\n    base: Record<PropertyKey, unknown> | EnvironmentRecord | \"unresolvable\",\n    referenceName: PropertyKey,\n    strict: boolean\n  ) {\n    this.Base = base;\n    this.ReferenceName = referenceName;\n    this.Strict = strict;\n  }\n}\n\n// https://tc39.es/ecma262/#sec-completion-record-specification-type\nexport class CompletionRecord {\n  readonly Type: CompletionRecordType;\n  readonly Value: unknown;\n\n  constructor(type: CompletionRecordType, value: unknown) {\n    this.Type = type;\n    this.Value = value;\n  }\n}\n\nexport type CompletionRecordType =\n  | \"normal\"\n  | \"break\"\n  | \"continue\"\n  | \"return\"\n  | \"throw\";\n\n// https://tc39.es/ecma262/#sec-normalcompletion\nexport function NormalCompletion(value: unknown): CompletionRecord {\n  return new CompletionRecord(\"normal\", value);\n}\n\nexport const Empty = Symbol(\"empty completion\");\n\nexport interface OptionalChainRef {\n  skipped?: boolean;\n}\n","import { FunctionDeclaration, VariableDeclaration } from \"@babel/types\";\nimport { EstreeNode, NodeWithBoundNames } from \"./interfaces.js\";\n\ntype InternalCollect<T = void, O = unknown> = (\n  node: EstreeNode | null | undefined | (EstreeNode | null)[],\n  options?: O\n) => T;\ntype InternalCollectWithOptions<T = void, O = unknown> = (\n  node: EstreeNode | null | undefined | (EstreeNode | null)[],\n  options: O\n) => T;\n\nexport function collectBoundNames(\n  root: NodeWithBoundNames | NodeWithBoundNames[] | null | undefined\n): string[] {\n  const names = new Set<string>();\n  const collect: InternalCollect = (node) => {\n    if (Array.isArray(node)) {\n      for (const n of node) {\n        collect(n);\n      }\n    } else if (node) {\n      // `node` maybe `null` in some cases.\n      switch (node.type) {\n        case \"Identifier\":\n          names.add(node.name);\n          return;\n        case \"VariableDeclaration\":\n          return collect(node.declarations);\n        case \"VariableDeclarator\":\n          return collect(node.id);\n        case \"ArrayPattern\":\n          return collect(node.elements);\n        case \"AssignmentPattern\":\n          return collect(node.left);\n        case \"ObjectPattern\":\n          return collect(node.properties);\n        case \"Property\":\n          return collect(node.value);\n        case \"RestElement\":\n          return collect(node.argument);\n        case \"FunctionDeclaration\":\n          return collect(node.id);\n      }\n    }\n  };\n  collect(root);\n  return Array.from(names);\n}\n\nexport function containsExpression(\n  root: EstreeNode | EstreeNode[]\n): boolean | undefined {\n  const collect: InternalCollect<boolean | undefined> = (node) => {\n    if (Array.isArray(node)) {\n      return node.some(collect);\n    } else if (node) {\n      // `node` maybe `null` in some cases.\n      switch (node.type) {\n        case \"ArrayPattern\":\n          return collect(node.elements);\n        case \"AssignmentPattern\":\n          return true;\n        case \"ObjectPattern\":\n          return collect(node.properties);\n        case \"Property\":\n          return node.computed || collect(node.value);\n        case \"RestElement\":\n          return collect(node.argument);\n      }\n    }\n  };\n  return collect(root);\n}\n\ninterface ScopedDeclarationOptions {\n  var?: boolean;\n  topLevel?: boolean;\n}\n\ntype ScopedDeclaration = VariableDeclaration | FunctionDeclaration;\n\nexport function collectScopedDeclarations(\n  root: EstreeNode | EstreeNode[],\n  options: ScopedDeclarationOptions\n): ScopedDeclaration[] {\n  const declarations: ScopedDeclaration[] = [];\n  const nextOptions = { var: options.var };\n  const collect: InternalCollectWithOptions<void, ScopedDeclarationOptions> = (\n    node,\n    options\n  ): void => {\n    if (Array.isArray(node)) {\n      for (const n of node) {\n        collect(n, options);\n      }\n    } else if (node) {\n      // `node` maybe `null` in some cases.\n      switch (node.type) {\n        case \"FunctionDeclaration\":\n          // At the top level of a function, or script, function declarations are\n          // treated like var declarations rather than like lexical declarations.\n          // See https://tc39.es/ecma262/#sec-static-semantics-toplevellexicallydeclarednames\n          if (Number(!options.var) ^ Number(options.topLevel)) {\n            declarations.push(node);\n          }\n          return;\n        case \"VariableDeclaration\":\n          if (Number(!options.var) ^ Number(node.kind === \"var\")) {\n            declarations.push(node);\n          }\n          return;\n        case \"SwitchCase\":\n          collect(node.consequent, nextOptions);\n          return;\n        case \"CatchClause\":\n          collect(node.body, nextOptions);\n          return;\n      }\n      if (options.var) {\n        switch (node.type) {\n          case \"BlockStatement\":\n            collect(node.body, nextOptions);\n            return;\n          case \"IfStatement\":\n            collect(node.consequent, nextOptions);\n            collect(node.alternate, nextOptions);\n            return;\n          case \"DoWhileStatement\":\n          case \"WhileStatement\":\n            collect(node.body, nextOptions);\n            return;\n          case \"ForStatement\":\n            collect(node.init, nextOptions);\n            collect(node.body, nextOptions);\n            return;\n          case \"ForInStatement\":\n          case \"ForOfStatement\":\n            collect(node.left, nextOptions);\n            collect(node.body, nextOptions);\n            return;\n          case \"SwitchStatement\":\n            collect(node.cases, nextOptions);\n            return;\n          case \"TryStatement\":\n            collect(node.block, nextOptions);\n            collect(node.handler, nextOptions);\n            collect(node.finalizer, nextOptions);\n            return;\n        }\n      }\n    }\n  };\n  collect(root, options);\n  return declarations;\n}\n","import {\n  BinaryExpression,\n  UnaryExpression,\n  VariableDeclaration,\n} from \"@babel/types\";\nimport {\n  CompletionRecord,\n  Empty,\n  EnvironmentRecord,\n  NormalCompletion,\n  ReferenceRecord,\n} from \"./ExecutionContext.js\";\nimport { collectBoundNames } from \"./traverse.js\";\n\n// https://tc39.es/ecma262/#sec-ispropertyreference\nexport function IsPropertyReference(V: ReferenceRecord): boolean {\n  return V.Base !== \"unresolvable\" && !(V.Base instanceof EnvironmentRecord);\n}\n\n// https://tc39.es/ecma262/#sec-initializereferencedbinding\nexport function InitializeReferencedBinding(\n  V: ReferenceRecord,\n  W: unknown\n): CompletionRecord {\n  const base = V.Base as EnvironmentRecord;\n  return base.InitializeBinding(V.ReferenceName as string, W);\n}\n\n// https://tc39.es/ecma262/#sec-copydataproperties\nexport function CopyDataProperties(\n  target: Record<PropertyKey, unknown>,\n  source: unknown,\n  excludedItems: Set<PropertyKey>\n): Record<PropertyKey, unknown> {\n  if (source === undefined || source === null) {\n    return target;\n  }\n  const keys = (Object.getOwnPropertyNames(source) as PropertyKey[]).concat(\n    Object.getOwnPropertySymbols(source)\n  );\n  for (const nextKey of keys) {\n    if (!excludedItems.has(nextKey)) {\n      const desc = Object.getOwnPropertyDescriptor(source, nextKey);\n      if (desc?.enumerable) {\n        target[nextKey] = (source as Record<PropertyKey, unknown>)[nextKey];\n      }\n    }\n  }\n  return target;\n}\n\n// https://tc39.es/ecma262/#sec-runtime-semantics-fordeclarationbindinginstantiation\nexport function ForDeclarationBindingInstantiation(\n  forDeclaration: VariableDeclaration,\n  env: EnvironmentRecord\n): void {\n  const isConst = forDeclaration.kind === \"const\";\n  for (const name of collectBoundNames(forDeclaration)) {\n    if (isConst) {\n      env.CreateImmutableBinding(name, true);\n    } else {\n      env.CreateMutableBinding(name, false);\n    }\n  }\n}\n\n// https://tc39.es/ecma262/#sec-loopcontinues\nexport function LoopContinues(completion: CompletionRecord): boolean {\n  return completion.Type === \"normal\" || completion.Type == \"continue\";\n}\n\n// https://tc39.es/ecma262/#sec-updateempty\nexport function UpdateEmpty(\n  completion: CompletionRecord,\n  value: unknown\n): CompletionRecord {\n  if (completion.Value !== Empty) {\n    return completion;\n  }\n  return new CompletionRecord(completion.Type, value);\n}\n\n// https://tc39.es/ecma262/#sec-getvalue\nexport function GetValue(\n  V: CompletionRecord | ReferenceRecord | unknown\n): unknown {\n  if (V instanceof CompletionRecord) {\n    // Assert: V.Type is normal.\n    V = V.Value;\n  }\n  if (!(V instanceof ReferenceRecord)) {\n    return V;\n  }\n  if (V.Base === \"unresolvable\") {\n    throw new ReferenceError(`${V.ReferenceName as string} is not defined`);\n  }\n  if (V.Base instanceof EnvironmentRecord) {\n    const base = V.Base as EnvironmentRecord;\n    return base.GetBindingValue(V.ReferenceName as string, V.Strict);\n  }\n  return V.Base[V.ReferenceName];\n}\n\n// https://tc39.es/ecma262/#sec-topropertykey\nexport function ToPropertyKey(arg: unknown): string | symbol {\n  if (typeof arg === \"symbol\") {\n    return arg;\n  }\n  return String(arg);\n}\n\n// https://tc39.es/ecma262/#sec-getv\nexport function GetV(V: unknown, P: PropertyKey): unknown {\n  return (V as Record<PropertyKey, unknown>)[P];\n}\n\n// https://tc39.es/ecma262/#sec-putvalue\nexport function PutValue(V: ReferenceRecord, W: unknown): CompletionRecord {\n  // Assert: V is a ReferenceRecord.\n  if (V.Base === \"unresolvable\") {\n    throw new ReferenceError(`${V.ReferenceName as string} is not defined`);\n  }\n  if (V.Base instanceof EnvironmentRecord) {\n    return V.Base.SetMutableBinding(V.ReferenceName as string, W, V.Strict);\n  }\n  V.Base[V.ReferenceName] = W;\n  return NormalCompletion(undefined);\n}\n\n// https://tc39.es/ecma262/#sec-createlistiteratorRecord\nexport function CreateListIteratorRecord(\n  args: Iterable<unknown>\n): Iterator<unknown> {\n  if (!isIterable(args)) {\n    throw new TypeError(`${typeof args} is not iterable`);\n  }\n  return args[Symbol.iterator]();\n}\n\n// https://tc39.es/ecma262/#sec-requireobjectcoercible\nexport function RequireObjectCoercible(arg: unknown): void {\n  if (arg === null || arg === undefined) {\n    throw new TypeError(\"Cannot destructure properties of undefined or null\");\n  }\n}\n\n// https://tc39.es/ecma262/#sec-getidentifierreference\nexport function GetIdentifierReference(\n  env: EnvironmentRecord | null | undefined,\n  name: string,\n  strict: boolean\n): ReferenceRecord {\n  if (!env) {\n    return new ReferenceRecord(\"unresolvable\", name, strict);\n  }\n  if (env.HasBinding(name)) {\n    return new ReferenceRecord(env, name, strict);\n  }\n  return GetIdentifierReference(env.OuterEnv, name, strict);\n}\n\n// https://tc39.es/ecma262/#sec-applystringornumericbinaryoperator\nexport function ApplyStringOrNumericBinaryOperator(\n  leftValue: number,\n  operator: BinaryExpression[\"operator\"] | \"|>\",\n  rightValue: number\n): unknown {\n  switch (operator) {\n    case \"+\":\n      return leftValue + rightValue;\n    case \"-\":\n      return leftValue - rightValue;\n    case \"/\":\n      return leftValue / rightValue;\n    case \"%\":\n      return leftValue % rightValue;\n    case \"*\":\n      return leftValue * rightValue;\n    case \"**\":\n      return leftValue ** rightValue;\n    case \"==\":\n      return leftValue == rightValue;\n    case \"===\":\n      return leftValue === rightValue;\n    case \"!=\":\n      return leftValue != rightValue;\n    case \"!==\":\n      return leftValue !== rightValue;\n    case \">\":\n      return leftValue > rightValue;\n    case \"<\":\n      return leftValue < rightValue;\n    case \">=\":\n      return leftValue >= rightValue;\n    case \"<=\":\n      return leftValue <= rightValue;\n    case \"in\":\n      return leftValue in (rightValue as unknown as Record<number, unknown>);\n  }\n  throw new SyntaxError(`Unsupported binary operator \\`${operator}\\``);\n}\n\n// https://tc39.es/ecma262/#sec-assignment-operators\nexport function ApplyStringOrNumericAssignment(\n  leftValue: string | number,\n  operator: string,\n  rightValue: string | number\n): unknown {\n  switch (operator) {\n    case \"+=\":\n    case \"-=\":\n    case \"*=\":\n    case \"/=\":\n    case \"%=\":\n    case \"**=\":\n      return ApplyStringOrNumericBinaryOperator(\n        leftValue as number,\n        operator.substr(0, operator.length - 1) as BinaryExpression[\"operator\"],\n        rightValue as number\n      );\n  }\n\n  throw new SyntaxError(`Unsupported assignment operator \\`${operator}\\``);\n}\n\n// https://tc39.es/ecma262/#sec-unary-operators\nexport function ApplyUnaryOperator(\n  target: unknown,\n  operator: UnaryExpression[\"operator\"]\n): unknown {\n  switch (operator) {\n    case \"!\":\n      return !target;\n    case \"+\":\n      return +(target as string | number);\n    case \"-\":\n      return -(target as string | number);\n    case \"void\":\n      return undefined;\n  }\n  throw new SyntaxError(`Unsupported unary operator \\`${operator}\\``);\n}\n\nexport function isIterable(cooked: unknown): boolean {\n  if (Array.isArray(cooked)) {\n    return true;\n  }\n  if (cooked === null || cooked === undefined) {\n    return false;\n  }\n  return typeof (cooked as Iterable<unknown>)[Symbol.iterator] === \"function\";\n}\n","// Ref https://github.com/tc39/proposal-global\n// In addition, the es6-shim had to switch from Function('return this')()\n// due to CSP concerns, such that the current check to handle browsers,\n// node, web workers, and frames is:\n// istanbul ignore next\n// eslint-disable-next-line @typescript-eslint/ban-types\nfunction getGlobal(): object {\n  // the only reliable means to get the global object is\n  // `Function('return this')()`\n  // However, this causes CSP violations in Chrome apps.\n  if (typeof self !== \"undefined\") {\n    return self;\n  }\n  if (typeof window !== \"undefined\") {\n    return window;\n  }\n  if (typeof global !== \"undefined\") {\n    return global;\n  }\n  throw new Error(\"unable to locate global object\");\n}\n\n/**\n * There are chances to construct a `Function` from a string, etc.\n * ```\n * ((a,b)=>a[b])(()=>1, 'constructor')('console.log(`yo`)')()\n * ```\n */\nconst reservedObjects = new WeakSet([\n  // `Function(\"...\")` is considered *extremely vulnerable*.\n  Function,\n  // `Object.assign()` is considered vulnerable.\n  Object,\n  // `prototype` is considered vulnerable.\n  Function.prototype,\n  Object.prototype,\n  // Global `window` is considered vulnerable, too.\n  getGlobal(),\n]);\n\nexport function sanitize(cooked: unknown): void {\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  if (reservedObjects.has(cooked as object)) {\n    throw new TypeError(\"Cannot access reserved objects such as `Function`.\");\n  }\n}\n\nconst allowedConstructors = new WeakSet([\n  Array,\n  Map,\n  Set,\n  URL,\n  URLSearchParams,\n  WeakMap,\n  WeakSet,\n  RegExp,\n]);\n\nexport function isAllowedConstructor(constructor: unknown): boolean {\n  // `Date` maybe mocked when running tests for storyboard functions.\n  return (\n    allowedConstructors.has(constructor as ArrayConstructor) ||\n    constructor === Date\n  );\n}\n","import type {\n  ArrayPattern,\n  ArrowFunctionExpression,\n  CallExpression,\n  CatchClause,\n  DoWhileStatement,\n  Expression,\n  ForInStatement,\n  ForOfStatement,\n  ForStatement,\n  FunctionDeclaration,\n  FunctionExpression,\n  Identifier,\n  LVal,\n  NewExpression,\n  ObjectPattern,\n  Pattern,\n  PatternLike,\n  RestElement,\n  Statement,\n  SwitchCase,\n  TemplateLiteral,\n  VariableDeclaration,\n  WhileStatement,\n} from \"@babel/types\";\nimport {\n  ApplyStringOrNumericAssignment,\n  CreateListIteratorRecord,\n  ApplyStringOrNumericBinaryOperator,\n  GetV,\n  GetValue,\n  InitializeReferencedBinding,\n  IsPropertyReference,\n  LoopContinues,\n  PutValue,\n  RequireObjectCoercible,\n  ToPropertyKey,\n  UpdateEmpty,\n  ApplyUnaryOperator,\n  GetIdentifierReference,\n  ForDeclarationBindingInstantiation,\n  CopyDataProperties,\n} from \"./context-free.js\";\nimport {\n  CompletionRecord,\n  DebuggerCall,\n  DebuggerNode,\n  DebuggerReturn,\n  DebuggerScope,\n  DeclarativeEnvironment,\n  ECMAScriptCode,\n  Empty,\n  Environment,\n  EnvironmentRecord,\n  ExecutionContext,\n  FormalParameters,\n  FunctionEnvironment,\n  FunctionObject,\n  IsConstructor,\n  NormalCompletion,\n  OptionalChainRef,\n  ReferenceRecord,\n  SourceNode,\n  Mode,\n  ThisMode,\n} from \"./ExecutionContext.js\";\nimport type {\n  EstreeLVal,\n  EstreeNode,\n  EstreeObjectExpression,\n  EstreeObjectPattern,\n  EstreeProperty,\n  CookRules,\n  FunctionDefinition,\n} from \"./interfaces.js\";\nimport { sanitize, isAllowedConstructor } from \"./sanitize.js\";\nimport {\n  collectBoundNames,\n  collectScopedDeclarations,\n  containsExpression,\n} from \"./traverse.js\";\n\nexport interface CookOptions {\n  rules?: CookRules;\n  globalVariables?: Record<string, unknown>;\n  hooks?: CookHooks;\n  debug?: boolean;\n  externalSourceForDebug?: boolean;\n  ArrayConstructor?: typeof Array;\n}\n\nexport interface CookHooks {\n  beforeEvaluate?(node: EstreeNode): void;\n  beforeCall?(node: EstreeNode): void;\n  beforeBranch?(node: EstreeNode, branch: \"if\" | \"else\"): void;\n}\n\ninterface EvaluateResult<T, TReturn> extends Iterator<T, TReturn> {\n  [Symbol.iterator](): EvaluateResult<T, TReturn>;\n}\n\ntype CompletionRecordResult<T = unknown> = EvaluateResult<T, CompletionRecord>;\n\nconst globalExecutionContextStack: ExecutionContext[] = [];\n\nexport function __dev_only_clearGlobalExecutionContextStack() {\n  globalExecutionContextStack.length = 0;\n}\n\nexport function __dev_only_getGlobalExecutionContextStack() {\n  return globalExecutionContextStack;\n}\n\n/** For next-core internal usage only. */\nexport function cook(\n  rootAst: FunctionDeclaration | Expression,\n  codeSource: string,\n  {\n    rules,\n    debug,\n    externalSourceForDebug,\n    globalVariables = {},\n    // Allow debugger to override Array constructor.\n    ArrayConstructor = Array,\n    hooks = {},\n  }: CookOptions = {}\n): unknown {\n  const expressionOnly = rootAst.type !== \"FunctionDeclaration\";\n\n  function doSanitize(cooked: unknown) {\n    if (!externalSourceForDebug) {\n      sanitize(cooked);\n    }\n  }\n\n  const rootEnv = new DeclarativeEnvironment(null);\n  const rootContext = new ExecutionContext();\n  rootContext.VariableEnvironment = rootEnv;\n  rootContext.LexicalEnvironment = rootEnv;\n  const executionContextStack = [rootContext];\n\n  for (const [key, value] of Object.entries(globalVariables)) {\n    rootEnv.CreateImmutableBinding(key, true);\n    rootEnv.InitializeBinding(key, value);\n  }\n\n  const TemplateMap = new WeakMap<TemplateLiteral, string[]>();\n\n  // https://tc39.es/ecma262/#sec-gettemplateobject\n  function GetTemplateObject(templateLiteral: TemplateLiteral): string[] {\n    const memo = TemplateMap.get(templateLiteral);\n    if (memo) {\n      return memo;\n    }\n    const rawObj = templateLiteral.quasis.map((quasi) => quasi.value.raw);\n    const template = templateLiteral.quasis.map((quasi) => quasi.value.cooked!);\n    Object.freeze(rawObj);\n    Object.defineProperty(template, \"raw\", {\n      value: rawObj,\n      writable: false,\n      enumerable: false,\n      configurable: false,\n    });\n    Object.freeze(template);\n    TemplateMap.set(templateLiteral, template);\n    return template;\n  }\n\n  let currentNode: EstreeNode | undefined;\n\n  function* Evaluate(\n    node: EstreeNode,\n    optionalChainRef?: OptionalChainRef,\n    forceYield?: boolean\n  ): CompletionRecordResult {\n    hooks.beforeEvaluate?.(node);\n    currentNode = node;\n    if (\n      debug &&\n      (forceYield ||\n        (node.type.endsWith(\"Statement\") &&\n          !(\n            node.type === \"ExpressionStatement\" &&\n            (node.expression.type === \"CallExpression\" ||\n              node.expression.type === \"TaggedTemplateExpression\")\n          ) &&\n          node.type !== \"TryStatement\" &&\n          node.type !== \"BlockStatement\" &&\n          node.type !== \"DoWhileStatement\" &&\n          node.type !== \"WhileStatement\" &&\n          node.type !== \"ForStatement\" &&\n          node.type !== \"ForInStatement\" &&\n          node.type !== \"ForOfStatement\"))\n    ) {\n      yield;\n    }\n    // Expressions:\n    switch (node.type) {\n      case \"ArrayExpression\": {\n        // https://tc39.es/ecma262/#sec-array-initializer\n        const array = new ArrayConstructor();\n        for (const element of node.elements) {\n          if (!element) {\n            array.length += 1;\n          } else if (element.type === \"SpreadElement\") {\n            const spreadValues = GetValue(\n              yield* Evaluate(element.argument)\n            ) as unknown[];\n            array.push(...spreadValues);\n          } else {\n            array.push(GetValue(yield* Evaluate(element)));\n          }\n        }\n        return NormalCompletion(array);\n      }\n      case \"ArrowFunctionExpression\": {\n        // https://tc39.es/ecma262/#sec-arrow-function-definitions\n        ThrowIfFunctionIsInvalid(node);\n        const closure = InstantiateArrowFunctionExpression(node);\n        return NormalCompletion(closure);\n      }\n      case \"BinaryExpression\": {\n        const leftRef = yield* Evaluate(node.left);\n        const leftValue = GetValue(leftRef);\n        const rightRef = yield* Evaluate(node.right);\n        const rightValue = GetValue(rightRef);\n        if (expressionOnly && (node.operator as unknown) === \"|>\") {\n          // Minimal pipeline operator is supported only in expression-only mode.\n          // See https://tc39.es/proposal-pipeline-operator\n          // and https://github.com/tc39/proposal-pipeline-operator\n          if (typeof rightValue !== \"function\") {\n            const funcName = codeSource.substring(\n              node.right.start!,\n              node.right.end!\n            );\n            throw new TypeError(`${funcName} is not a function`);\n          }\n          let thisValue;\n          if (rightRef instanceof ReferenceRecord) {\n            if (IsPropertyReference(rightRef)) {\n              thisValue = rightRef.Base;\n            }\n          }\n          return NormalCompletion(\n            (rightValue as unknown as Function).call(thisValue, leftValue)\n          );\n        }\n        // https://tc39.es/ecma262/#sec-additive-operators\n        const result = ApplyStringOrNumericBinaryOperator(\n          leftValue as number,\n          node.operator,\n          rightValue as number\n        );\n        return NormalCompletion(result);\n      }\n      case \"CallExpression\": {\n        // https://tc39.es/ecma262/#sec-function-calls\n        const ref = (yield* Evaluate(node.callee, optionalChainRef))\n          .Value as ReferenceRecord;\n        const func = GetValue(ref) as Function;\n        if (\n          (func === undefined || func === null) &&\n          (node.optional || optionalChainRef?.skipped)\n        ) {\n          optionalChainRef!.skipped = true;\n          return NormalCompletion(undefined);\n        }\n        doSanitize(func);\n\n        if (debug) yield;\n\n        return yield* EvaluateCall(func, ref, node.arguments, node.callee);\n      }\n      case \"ChainExpression\":\n        // https://tc39.es/ecma262/#sec-optional-chains\n        return yield* Evaluate(node.expression, {});\n      case \"ConditionalExpression\":\n        // https://tc39.es/ecma262/#sec-conditional-operator\n        return NormalCompletion(\n          GetValue(\n            yield* Evaluate(\n              GetValue(yield* Evaluate(node.test))\n                ? node.consequent\n                : node.alternate\n            )\n          )\n        );\n      case \"Identifier\":\n        // https://tc39.es/ecma262/#sec-identifiers\n        return NormalCompletion(ResolveBinding(node.name));\n      case \"Literal\": {\n        // https://tc39.es/ecma262/#sec-primary-expression-literals\n        if (node.regex) {\n          if (node.value === null) {\n            // Invalid regular expression fails silently in @babel/parser.\n            throw new SyntaxError(`Invalid regular expression: ${node.raw}`);\n          }\n          if (node.regex.flags.includes(\"u\")) {\n            // Currently unicode flag is not fully supported across major browsers.\n            throw new SyntaxError(\n              `Unsupported unicode flag in regular expression: ${node.raw}`\n            );\n          }\n          // Always create a new RegExp, because the AST will be reused.\n          return NormalCompletion(\n            new RegExp(node.regex.pattern, node.regex.flags)\n          );\n        }\n        return NormalCompletion(node.value);\n      }\n      case \"LogicalExpression\": {\n        // https://tc39.es/ecma262/#sec-binary-logical-operators\n        const leftValue = GetValue(yield* Evaluate(node.left));\n        switch (node.operator) {\n          case \"&&\":\n            return NormalCompletion(\n              leftValue && GetValue(yield* Evaluate(node.right))\n            );\n          case \"||\":\n            return NormalCompletion(\n              leftValue || GetValue(yield* Evaluate(node.right))\n            );\n          case \"??\":\n            return NormalCompletion(\n              leftValue ?? GetValue(yield* Evaluate(node.right))\n            );\n          // istanbul ignore next\n          default:\n            throw new SyntaxError(\n              // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n              // @ts-ignore never reach here.\n              `Unsupported logical operator '${node.operator}'`\n            );\n        }\n      }\n      case \"MemberExpression\": {\n        // https://tc39.es/ecma262/#sec-property-accessors\n        const baseReference = (yield* Evaluate(node.object, optionalChainRef))\n          .Value as ReferenceRecord;\n        const baseValue = GetValue(baseReference) as Record<\n          PropertyKey,\n          unknown\n        >;\n        if (\n          (baseValue === undefined || baseValue === null) &&\n          (node.optional || optionalChainRef?.skipped)\n        ) {\n          optionalChainRef!.skipped = true;\n          return NormalCompletion(undefined);\n        }\n        doSanitize(baseValue);\n        const result = node.computed\n          ? yield* EvaluatePropertyAccessWithExpressionKey(\n              baseValue,\n              node.property as Expression,\n              true\n            )\n          : EvaluatePropertyAccessWithIdentifierKey(\n              baseValue,\n              node.property as Identifier,\n              true\n            );\n        doSanitize(result);\n        return NormalCompletion(result);\n      }\n      case \"NewExpression\":\n        // https://tc39.es/ecma262/#sec-new-operator\n        return yield* EvaluateNew(node.callee, node.arguments);\n      case \"ObjectExpression\": {\n        // https://tc39.es/ecma262/#sec-object-initializer\n        const object: Record<PropertyKey, unknown> = {};\n        for (const prop of (node as EstreeObjectExpression).properties) {\n          if (prop.type === \"SpreadElement\") {\n            const fromValue = GetValue(yield* Evaluate(prop.argument));\n            CopyDataProperties(object, fromValue, new Set());\n          } else {\n            if (prop.kind !== \"init\") {\n              throw new SyntaxError(\"Unsupported object getter/setter\");\n            }\n            const propName =\n              !prop.computed && prop.key.type === \"Identifier\"\n                ? prop.key.name\n                : yield* EvaluateComputedPropertyName(prop.key as Expression);\n            if (propName === \"__proto__\") {\n              throw new TypeError(\n                \"Setting '__proto__' property is not allowed\"\n              );\n            }\n            const propValue = GetValue(yield* Evaluate(prop.value));\n            if (prop.method && typeof propValue === \"function\") {\n              SetFunctionName(propValue as FunctionObject, propName as string);\n            }\n            object[propName] = propValue;\n          }\n        }\n        return NormalCompletion(object);\n      }\n      case \"SequenceExpression\": {\n        // https://tc39.es/ecma262/#sec-comma-operator\n        let result: CompletionRecord | undefined;\n        for (const expr of node.expressions) {\n          result = NormalCompletion(GetValue(yield* Evaluate(expr)));\n        }\n        return result!;\n      }\n      case \"TemplateLiteral\": {\n        // https://tc39.es/ecma262/#sec-template-literals\n        const chunks: string[] = [node.quasis[0].value.cooked!];\n        let index = 0;\n        for (const expr of node.expressions) {\n          const val = GetValue(yield* Evaluate(expr));\n          chunks.push(String(val));\n          chunks.push(node.quasis[(index += 1)].value.cooked!);\n        }\n        return NormalCompletion(chunks.join(\"\"));\n      }\n      case \"TaggedTemplateExpression\": {\n        // https://tc39.es/ecma262/#sec-tagged-templates\n        const tagRef = (yield* Evaluate(node.tag)).Value as ReferenceRecord;\n        const tagFunc = GetValue(tagRef) as Function;\n        doSanitize(tagFunc);\n        if (debug) yield;\n        return yield* EvaluateCall(tagFunc, tagRef, node.quasi, node.tag);\n      }\n      case \"UnaryExpression\": {\n        // https://tc39.es/ecma262/#sec-unary-operators\n        const ref = (yield* Evaluate(node.argument)).Value as ReferenceRecord;\n        if (!expressionOnly && node.operator === \"delete\") {\n          // Delete operator is supported only in function mode.\n          if (!(ref instanceof ReferenceRecord)) {\n            return NormalCompletion(true);\n          }\n          // istanbul ignore else\n          if (IsPropertyReference(ref)) {\n            const deleteStatus = delete (\n              ref.Base as Record<PropertyKey, unknown>\n            )[ref.ReferenceName];\n            return NormalCompletion(deleteStatus);\n          }\n          // Should never reach here in strict mode.\n        }\n        if (node.operator === \"typeof\") {\n          if (ref instanceof ReferenceRecord && ref.Base === \"unresolvable\") {\n            return NormalCompletion(\"undefined\");\n          }\n          return NormalCompletion(typeof GetValue(ref));\n        }\n        return NormalCompletion(\n          ApplyUnaryOperator(GetValue(ref), node.operator)\n        );\n      }\n    }\n    if (!expressionOnly) {\n      // Statements and assignments:\n      switch (node.type) {\n        case \"AssignmentExpression\": {\n          // https://tc39.es/ecma262/#sec-assignment-operators\n          if (node.operator === \"=\") {\n            if (\n              !(\n                node.left.type === \"ArrayPattern\" ||\n                node.left.type === \"ObjectPattern\"\n              )\n            ) {\n              const lref = (yield* Evaluate(node.left))\n                .Value as ReferenceRecord;\n              let rval: unknown;\n              if (\n                IsAnonymousFunctionDefinition(node.right) &&\n                node.left.type === \"Identifier\"\n              ) {\n                rval = NamedEvaluation(node.right, node.left.name);\n              } else {\n                const rref = yield* Evaluate(node.right);\n                rval = GetValue(rref);\n              }\n              PutValue(lref, rval);\n              return NormalCompletion(rval);\n            }\n            const rref = yield* Evaluate(node.right);\n            const rval = GetValue(rref) as string | number;\n            yield* DestructuringAssignmentEvaluation(node.left, rval);\n            return NormalCompletion(rval);\n          }\n          // Operators other than `=`.\n          const lref = (yield* Evaluate(node.left)).Value as ReferenceRecord;\n          const lval = GetValue(lref) as string | number;\n          const rref = yield* Evaluate(node.right);\n          const rval = GetValue(rref) as string | number;\n          const r = ApplyStringOrNumericAssignment(lval, node.operator, rval);\n          PutValue(lref, r);\n          return NormalCompletion(r);\n        }\n        case \"BlockStatement\": {\n          // https://tc39.es/ecma262/#sec-block\n          if (!node.body.length) {\n            return NormalCompletion(Empty);\n          }\n          const oldEnv = getRunningContext().LexicalEnvironment;\n          const blockEnv = new DeclarativeEnvironment(oldEnv);\n          BlockDeclarationInstantiation(node.body, blockEnv);\n          getRunningContext().LexicalEnvironment = blockEnv;\n          const blockValue = yield* EvaluateStatementList(node.body);\n          getRunningContext().LexicalEnvironment = oldEnv;\n          return blockValue;\n        }\n        case \"BreakStatement\":\n          // https://tc39.es/ecma262/#sec-break-statement\n          return new CompletionRecord(\"break\", Empty);\n        case \"ContinueStatement\":\n          // https://tc39.es/ecma262/#sec-continue-statement\n          return new CompletionRecord(\"continue\", Empty);\n        case \"EmptyStatement\":\n          // https://tc39.es/ecma262/#sec-empty-statement\n          return NormalCompletion(Empty);\n        case \"DoWhileStatement\":\n          // https://tc39.es/ecma262/#sec-do-while-statement\n          return EvaluateBreakableStatement(yield* DoWhileLoopEvaluation(node));\n        case \"ExpressionStatement\":\n        case \"TSAsExpression\":\n          // https://tc39.es/ecma262/#sec-expression-statement\n          return yield* Evaluate(node.expression);\n        case \"ForInStatement\":\n        case \"ForOfStatement\":\n          // https://tc39.es/ecma262/#sec-for-in-and-for-of-statements\n          return EvaluateBreakableStatement(yield* ForInOfLoopEvaluation(node));\n        case \"ForStatement\":\n          // https://tc39.es/ecma262/#sec-for-statement\n          return EvaluateBreakableStatement(yield* ForLoopEvaluation(node));\n        case \"FunctionDeclaration\":\n          // https://tc39.es/ecma262/#sec-function-definitions\n          return NormalCompletion(Empty);\n        case \"FunctionExpression\":\n          // https://tc39.es/ecma262/#sec-function-defining-expressions\n          ThrowIfFunctionIsInvalid(node);\n          return NormalCompletion(InstantiateOrdinaryFunctionExpression(node));\n        case \"IfStatement\":\n          // https://tc39.es/ecma262/#sec-if-statement\n          if (GetValue(yield* Evaluate(node.test))) {\n            hooks.beforeBranch?.(node, \"if\");\n            return UpdateEmpty(yield* Evaluate(node.consequent), undefined);\n          }\n          hooks.beforeBranch?.(node, \"else\");\n          if (node.alternate) {\n            return UpdateEmpty(yield* Evaluate(node.alternate), undefined);\n          }\n          return NormalCompletion(undefined);\n        case \"ReturnStatement\": {\n          // https://tc39.es/ecma262/#sec-return-statement\n          let v: unknown;\n          if (node.argument) {\n            const exprRef = yield* Evaluate(node.argument);\n            v = GetValue(exprRef);\n          }\n          return new CompletionRecord(\"return\", v);\n        }\n        case \"ThisExpression\": {\n          if (!externalSourceForDebug) {\n            break;\n          }\n          const envRec = GetThisEnvironment();\n          return NormalCompletion(envRec.GetThisBinding());\n        }\n        case \"ThrowStatement\":\n          // https://tc39.es/ecma262/#sec-throw-statement\n          throw GetValue(yield* Evaluate(node.argument));\n        case \"UpdateExpression\": {\n          // https://tc39.es/ecma262/#sec-update-expressions\n          const lhs = (yield* Evaluate(node.argument)).Value as ReferenceRecord;\n          const oldValue = Number(GetValue(lhs));\n          const newValue = node.operator === \"++\" ? oldValue + 1 : oldValue - 1;\n          PutValue(lhs, newValue);\n          return NormalCompletion(node.prefix ? newValue : oldValue);\n        }\n        case \"SwitchCase\":\n          return yield* EvaluateStatementList(node.consequent);\n        case \"SwitchStatement\": {\n          // https://tc39.es/ecma262/#sec-switch-statement\n          const exprRef = yield* Evaluate(node.discriminant);\n          const switchValue = GetValue(exprRef);\n          const oldEnv = getRunningContext().LexicalEnvironment;\n          const blockEnv = new DeclarativeEnvironment(oldEnv);\n          BlockDeclarationInstantiation(node.cases, blockEnv);\n          getRunningContext().LexicalEnvironment = blockEnv;\n          const R = yield* CaseBlockEvaluation(node.cases, switchValue);\n          getRunningContext().LexicalEnvironment = oldEnv;\n          return EvaluateBreakableStatement(R);\n        }\n        case \"TryStatement\": {\n          // https://tc39.es/ecma262/#sec-try-statement\n          let R: CompletionRecord;\n          try {\n            R = yield* Evaluate(node.block);\n          } catch (error) {\n            if (node.handler) {\n              currentNode = node.handler;\n              hooks.beforeEvaluate?.(node.handler);\n              R = yield* CatchClauseEvaluation(node.handler, error);\n            } else {\n              throw error;\n            }\n          } finally {\n            if (node.finalizer) {\n              const F = yield* Evaluate(node.finalizer);\n              if (F.Type !== \"normal\") {\n                R = F;\n              }\n            }\n          }\n          return R;\n        }\n        case \"VariableDeclaration\": {\n          // https://tc39.es/ecma262/#sec-declarations-and-the-variable-statement\n          let result: CompletionRecord | undefined;\n          for (const declarator of node.declarations) {\n            currentNode = declarator;\n            if (!declarator.init) {\n              // Assert: a declarator without init is always an identifier.\n              if (node.kind === \"var\") {\n                result = NormalCompletion(Empty);\n              } else {\n                const lhs = ResolveBinding((declarator.id as Identifier).name);\n                result = InitializeReferencedBinding(lhs, undefined);\n              }\n            } else if (declarator.id.type === \"Identifier\") {\n              currentNode = declarator.init;\n              if (\n                debug &&\n                currentNode.type !== \"CallExpression\" &&\n                currentNode.type !== \"TaggedTemplateExpression\"\n              )\n                yield;\n              const bindingId = declarator.id.name;\n              const lhs = ResolveBinding(bindingId);\n              let value: unknown;\n              if (IsAnonymousFunctionDefinition(declarator.init)) {\n                value = NamedEvaluation(declarator.init, bindingId);\n              } else {\n                const rhs = yield* Evaluate(declarator.init);\n                value = GetValue(rhs);\n              }\n              result =\n                node.kind === \"var\"\n                  ? PutValue(lhs, value)\n                  : InitializeReferencedBinding(lhs, value);\n            } else {\n              currentNode = declarator.init;\n              if (\n                debug &&\n                currentNode.type !== \"CallExpression\" &&\n                currentNode.type !== \"TaggedTemplateExpression\"\n              )\n                yield;\n              const rhs = yield* Evaluate(declarator.init);\n              const rval = GetValue(rhs);\n              result = yield* BindingInitialization(\n                declarator.id,\n                rval,\n                node.kind === \"var\"\n                  ? undefined\n                  : getRunningContext().LexicalEnvironment\n              );\n            }\n          }\n          return result!;\n        }\n        case \"WhileStatement\":\n          // https://tc39.es/ecma262/#sec-while-statement\n          return EvaluateBreakableStatement(yield* WhileLoopEvaluation(node));\n      }\n    }\n    // eslint-disable-next-line no-console\n    throw new SyntaxError(`Unsupported node type \\`${node.type}\\``);\n  }\n\n  // https://tc39.es/ecma262/#sec-execution-contexts\n  function getRunningContext(): ExecutionContext {\n    return executionContextStack[executionContextStack.length - 1];\n  }\n\n  // https://tc39.es/ecma262/#sec-resolvebinding\n  function ResolveBinding(\n    name: string,\n    env?: EnvironmentRecord\n  ): ReferenceRecord {\n    if (!env) {\n      env = getRunningContext().LexicalEnvironment;\n    }\n    return GetIdentifierReference(env, name, true);\n  }\n\n  // Try statements.\n  // https://tc39.es/ecma262/#sec-runtime-semantics-catchclauseevaluation\n  function* CatchClauseEvaluation(\n    node: CatchClause,\n    thrownValue: unknown\n  ): CompletionRecordResult {\n    if (!node.param) {\n      return yield* Evaluate(node.body);\n    }\n    const oldEnv = getRunningContext().LexicalEnvironment;\n    const catchEnv = new DeclarativeEnvironment(oldEnv);\n    for (const argName of collectBoundNames(node.param)) {\n      catchEnv.CreateMutableBinding(argName, false);\n    }\n    getRunningContext().LexicalEnvironment = catchEnv;\n    yield* BindingInitialization(node.param, thrownValue, catchEnv);\n    const B = yield* Evaluate(node.body);\n    getRunningContext().LexicalEnvironment = oldEnv;\n    return B;\n  }\n\n  // Iteration statements and switch statements.\n  // https://tc39.es/ecma262/#prod-BreakableStatement\n  function EvaluateBreakableStatement(\n    stmtResult: CompletionRecord\n  ): CompletionRecord {\n    return stmtResult.Type === \"break\"\n      ? stmtResult.Value === Empty\n        ? NormalCompletion(undefined)\n        : NormalCompletion(stmtResult.Value)\n      : stmtResult;\n  }\n\n  // Switch statements.\n  // https://tc39.es/ecma262/#sec-runtime-semantics-caseblockevaluation\n  function* CaseBlockEvaluation(\n    cases: SwitchCase[],\n    input: unknown\n  ): CompletionRecordResult {\n    let V: unknown;\n\n    const defaultCaseIndex = cases.findIndex((switchCase) => !switchCase.test);\n    const hasDefaultCase = defaultCaseIndex >= 0;\n    const A = hasDefaultCase ? cases.slice(0, defaultCaseIndex) : cases;\n    let found = false;\n    for (const C of A) {\n      if (!found) {\n        found = yield* CaseClauseIsSelected(C, input);\n      }\n      if (found) {\n        const R = yield* Evaluate(C);\n        if (R.Value !== Empty) {\n          V = R.Value;\n        }\n        if (R.Type !== \"normal\") {\n          return UpdateEmpty(R, V);\n        }\n      }\n    }\n\n    if (!hasDefaultCase) {\n      return NormalCompletion(V);\n    }\n\n    let foundInB = false;\n    const B = cases.slice(defaultCaseIndex + 1);\n    if (!found) {\n      for (const C of B) {\n        if (!foundInB) {\n          foundInB = yield* CaseClauseIsSelected(C, input);\n        }\n        if (foundInB) {\n          const R = yield* Evaluate(C);\n          if (R.Value !== Empty) {\n            V = R.Value;\n          }\n          if (R.Type !== \"normal\") {\n            return UpdateEmpty(R, V);\n          }\n        }\n      }\n    }\n\n    if (foundInB) {\n      return NormalCompletion(V);\n    }\n    const R = yield* Evaluate(cases[defaultCaseIndex]);\n    if (R.Value !== Empty) {\n      V = R.Value;\n    }\n    if (R.Type !== \"normal\") {\n      return UpdateEmpty(R, V);\n    }\n\n    // NOTE: The following is another complete iteration of the second CaseClauses.\n    for (const C of B) {\n      const R = yield* Evaluate(C);\n      if (R.Value !== Empty) {\n        V = R.Value;\n      }\n      if (R.Type !== \"normal\") {\n        return UpdateEmpty(R, V);\n      }\n    }\n    return NormalCompletion(V);\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-caseclauseisselected\n  function* CaseClauseIsSelected(\n    C: SwitchCase,\n    input: unknown\n  ): EvaluateResult<unknown, boolean> {\n    const clauseSelector = GetValue(yield* Evaluate(C.test!));\n    return input === clauseSelector;\n  }\n\n  // While statements.\n  // https://tc39.es/ecma262/#sec-runtime-semantics-whileloopevaluation\n  function* WhileLoopEvaluation(node: WhileStatement): CompletionRecordResult {\n    let V: unknown;\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      const exprValue = GetValue(yield* Evaluate(node.test, undefined, true));\n      if (!exprValue) {\n        return NormalCompletion(V);\n      }\n      const stmtResult = yield* Evaluate(node.body);\n      if (!LoopContinues(stmtResult)) {\n        return UpdateEmpty(stmtResult, V);\n      }\n      if (stmtResult.Value !== Empty) {\n        V = stmtResult.Value;\n      }\n    }\n  }\n\n  // Do-while Statements.\n  // https://tc39.es/ecma262/#sec-runtime-semantics-dowhileloopevaluation\n  function* DoWhileLoopEvaluation(\n    node: DoWhileStatement\n  ): CompletionRecordResult {\n    let V: unknown;\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      const stmtResult = yield* Evaluate(node.body);\n      if (!LoopContinues(stmtResult)) {\n        return UpdateEmpty(stmtResult, V);\n      }\n      if (stmtResult.Value !== Empty) {\n        V = stmtResult.Value;\n      }\n      const exprValue = GetValue(yield* Evaluate(node.test, undefined, true));\n      if (!exprValue) {\n        return NormalCompletion(V);\n      }\n    }\n  }\n\n  // For in/of statements.\n  // https://tc39.es/ecma262/#sec-runtime-semantics-forinofloopevaluation\n  function* ForInOfLoopEvaluation(\n    node: ForInStatement | ForOfStatement\n  ): CompletionRecordResult {\n    const lhs = node.left;\n    const isVariableDeclaration = lhs.type === \"VariableDeclaration\";\n    const lhsKind = isVariableDeclaration\n      ? lhs.kind === \"var\"\n        ? \"varBinding\"\n        : \"lexicalBinding\"\n      : \"assignment\";\n    const uninitializedBoundNames =\n      lhsKind === \"lexicalBinding\" ? collectBoundNames(lhs) : [];\n    const iterationKind =\n      node.type === \"ForInStatement\" ? \"enumerate\" : \"iterate\";\n    const keyResult = yield* ForInOfHeadEvaluation(\n      uninitializedBoundNames,\n      node.right,\n      iterationKind\n    );\n    if (keyResult.Type !== \"normal\") {\n      // When enumerate, if the target is nil, a break completion will be returned.\n      return keyResult;\n    }\n    return yield* ForInOfBodyEvaluation(\n      lhs,\n      node.body,\n      keyResult.Value as Iterator<unknown>,\n      iterationKind,\n      lhsKind\n    );\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-forinofheadevaluation\n  function* ForInOfHeadEvaluation(\n    uninitializedBoundNames: string[],\n    expr: Expression,\n    iterationKind: \"enumerate\" | \"iterate\"\n  ): CompletionRecordResult {\n    const runningContext = getRunningContext();\n    const oldEnv = runningContext.LexicalEnvironment;\n    if (uninitializedBoundNames.length > 0) {\n      const newEnv = new DeclarativeEnvironment(oldEnv);\n      for (const name of uninitializedBoundNames) {\n        newEnv.CreateMutableBinding(name, false);\n      }\n      runningContext.LexicalEnvironment = newEnv;\n    }\n    const exprRef = yield* Evaluate(expr, undefined, true);\n    runningContext.LexicalEnvironment = oldEnv;\n    const exprValue = GetValue(exprRef);\n    if (iterationKind === \"enumerate\") {\n      if (exprValue === null || exprValue === undefined) {\n        return new CompletionRecord(\"break\", Empty);\n      }\n      const iterator = EnumerateObjectProperties(exprValue);\n      return NormalCompletion(iterator);\n    }\n    const iterator = CreateListIteratorRecord(exprValue as Iterable<unknown>);\n    return NormalCompletion(iterator);\n  }\n\n  function* ForInOfBodyEvaluation(\n    node: VariableDeclaration | EstreeLVal,\n    stmt: Statement,\n    iteratorRecord: Iterator<unknown>,\n    iterationKind: \"enumerate\" | \"iterate\",\n    lhsKind: \"varBinding\" | \"lexicalBinding\" | \"assignment\"\n  ): CompletionRecordResult {\n    const lhs =\n      lhsKind === \"assignment\"\n        ? (node as EstreeLVal)\n        : (node as VariableDeclaration).declarations[0].id;\n    const oldEnv = getRunningContext().LexicalEnvironment;\n    let V: unknown;\n    // When `destructuring` is false,\n    // For `node` whose `kind` is assignment:\n    //   `lhs` is an `Identifier` or a `MemberExpression`,\n    // Otherwise:\n    //   `lhs` is an `Identifier`.\n    const destructuring =\n      lhs.type === \"ObjectPattern\" || lhs.type === \"ArrayPattern\";\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      currentNode = lhs;\n      const { done, value: nextValue } = iteratorRecord.next();\n      if (done) {\n        if (debug) yield;\n        return NormalCompletion(V);\n      }\n      let lhsRef: ReferenceRecord | undefined;\n      let iterationEnv: DeclarativeEnvironment | undefined;\n      if (lhsKind === \"lexicalBinding\") {\n        iterationEnv = new DeclarativeEnvironment(oldEnv);\n        ForDeclarationBindingInstantiation(\n          node as VariableDeclaration,\n          iterationEnv\n        );\n        getRunningContext().LexicalEnvironment = iterationEnv;\n        if (debug) yield;\n        if (!destructuring) {\n          const [lhsName] = collectBoundNames(lhs);\n          lhsRef = ResolveBinding(lhsName);\n        }\n      } else {\n        if (debug) yield;\n        if (!destructuring) {\n          lhsRef = (yield* Evaluate(lhs)).Value as ReferenceRecord;\n        }\n      }\n\n      destructuring\n        ? lhsKind === \"assignment\"\n          ? yield* DestructuringAssignmentEvaluation(lhs, nextValue)\n          : lhsKind === \"varBinding\"\n            ? yield* BindingInitialization(lhs, nextValue, undefined)\n            : yield* BindingInitialization(lhs, nextValue, iterationEnv)\n        : lhsKind === \"lexicalBinding\"\n          ? InitializeReferencedBinding(lhsRef!, nextValue)\n          : PutValue(lhsRef!, nextValue);\n\n      const result = yield* Evaluate(stmt);\n      getRunningContext().LexicalEnvironment = oldEnv;\n      if (!LoopContinues(result)) {\n        const status = UpdateEmpty(result, V);\n        if (\n          !(\n            iterationKind === \"enumerate\" || iteratorRecord.return === undefined\n          )\n        ) {\n          // Perform *IteratorClose*\n          // https://tc39.es/ecma262/#sec-iteratorclose\n          const innerResult = iteratorRecord.return();\n          if (\n            !innerResult ||\n            ![\"object\", \"function\"].includes(typeof innerResult)\n          ) {\n            throw new TypeError(`Iterator result is not an object`);\n          }\n        }\n        return status;\n      }\n      if (result.Value !== Empty) {\n        V = result.Value;\n      }\n    }\n  }\n\n  // https://tc39.es/ecma262/#sec-enumerate-object-properties\n  function* EnumerateObjectProperties(value: any): Iterator<PropertyKey> {\n    for (const key in value) {\n      yield key;\n    }\n  }\n\n  // For statements.\n  // https://tc39.es/ecma262/#sec-runtime-semantics-forloopevaluation\n  function* ForLoopEvaluation(node: ForStatement): CompletionRecordResult {\n    if (node.init?.type === \"VariableDeclaration\") {\n      // `for (var … ; … ; … ) …`\n      if (node.init.kind === \"var\") {\n        yield* Evaluate(node.init);\n        return yield* ForBodyEvaluation(node.test, node.update, node.body, []);\n      }\n      // `for (let/const … ; … ; … ) …`\n      const oldEnv = getRunningContext().LexicalEnvironment;\n      const loopEnv = new DeclarativeEnvironment(oldEnv);\n      const isConst = node.init.kind === \"const\";\n      const boundNames = collectBoundNames(node.init);\n      for (const dn of boundNames) {\n        if (isConst) {\n          loopEnv.CreateImmutableBinding(dn, true);\n        } else {\n          loopEnv.CreateMutableBinding(dn, false);\n        }\n      }\n      getRunningContext().LexicalEnvironment = loopEnv;\n      yield* Evaluate(node.init);\n      const perIterationLets = isConst ? [] : Array.from(boundNames);\n      const bodyResult = yield* ForBodyEvaluation(\n        node.test,\n        node.update,\n        node.body,\n        perIterationLets\n      );\n      getRunningContext().LexicalEnvironment = oldEnv;\n      return bodyResult;\n    }\n    // `for ( … ; … ; … ) …`\n    if (node.init) {\n      const exprRef = yield* Evaluate(node.init);\n      GetValue(exprRef);\n    }\n    return yield* ForBodyEvaluation(node.test, node.update, node.body, []);\n  }\n\n  // https://tc39.es/ecma262/#sec-forbodyevaluation\n  function* ForBodyEvaluation(\n    test: Expression | null | undefined,\n    increment: Expression | null | undefined,\n    stmt: Statement,\n    perIterationBindings: string[]\n  ): CompletionRecordResult {\n    CreatePerIterationEnvironment(perIterationBindings);\n    let V: unknown;\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      if (test) {\n        const testRef = yield* Evaluate(test, undefined, true);\n        const testValue = GetValue(testRef);\n        if (!testValue) {\n          return NormalCompletion(V);\n        }\n      }\n      const result = yield* Evaluate(stmt);\n      if (!LoopContinues(result)) {\n        return UpdateEmpty(result, V);\n      }\n      if (result.Value) {\n        V = result.Value;\n      }\n      CreatePerIterationEnvironment(perIterationBindings);\n      if (increment) {\n        const incRef = yield* Evaluate(increment, undefined, true);\n        GetValue(incRef);\n      }\n    }\n  }\n\n  // https://tc39.es/ecma262/#sec-createperiterationenvironment\n  function CreatePerIterationEnvironment(\n    perIterationBindings: string[]\n  ): unknown {\n    if (perIterationBindings.length === 0) {\n      return;\n    }\n    const lastIterationEnv = getRunningContext().LexicalEnvironment!;\n    const outer = lastIterationEnv.OuterEnv;\n    const thisIterationEnv = new DeclarativeEnvironment(outer);\n    for (const bn of perIterationBindings) {\n      thisIterationEnv.CreateMutableBinding(bn, false);\n      const lastValue = lastIterationEnv.GetBindingValue(bn, false);\n      thisIterationEnv.InitializeBinding(bn, lastValue);\n    }\n    getRunningContext().LexicalEnvironment = thisIterationEnv;\n  }\n\n  // Destructuring assignments.\n  // https://tc39.es/ecma262/#sec-runtime-semantics-destructuringassignmentevaluation\n  function* DestructuringAssignmentEvaluation(\n    pattern: ObjectPattern | EstreeObjectPattern | ArrayPattern,\n    value: unknown\n  ): CompletionRecordResult {\n    if (pattern.type === \"ObjectPattern\") {\n      RequireObjectCoercible(value);\n      if (pattern.properties.length > 0) {\n        yield* PropertyDestructuringAssignmentEvaluation(\n          (pattern as EstreeObjectPattern).properties,\n          value\n        );\n      }\n      return NormalCompletion(Empty);\n    }\n    const iteratorRecord = CreateListIteratorRecord(value as Iterable<unknown>);\n    return yield* IteratorDestructuringAssignmentEvaluation(\n      pattern.elements,\n      iteratorRecord\n    );\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-propertydestructuringassignmentevaluation\n  function* PropertyDestructuringAssignmentEvaluation(\n    properties: (EstreeProperty | RestElement)[],\n    value: unknown\n  ): EvaluateResult<unknown, void> {\n    const excludedNames = new Set<PropertyKey>();\n    for (const prop of properties) {\n      if (prop.type === \"Property\") {\n        const propName =\n          !prop.computed && prop.key.type === \"Identifier\"\n            ? prop.key.name\n            : ((yield* EvaluateComputedPropertyName(\n                prop.key as Expression\n              )) as string);\n        const valueTarget =\n          prop.value.type === \"AssignmentPattern\"\n            ? prop.value.left\n            : prop.value;\n        if (valueTarget.type === \"Identifier\") {\n          const lref = ResolveBinding(valueTarget.name);\n          let v = GetV(value, propName);\n          if (prop.value.type === \"AssignmentPattern\" && v === undefined) {\n            if (IsAnonymousFunctionDefinition(prop.value.right)) {\n              v = NamedEvaluation(prop.value.right, valueTarget.name);\n            } else {\n              const defaultValue = yield* Evaluate(prop.value.right);\n              v = GetValue(defaultValue);\n            }\n          }\n          PutValue(lref, v);\n          excludedNames.add(propName);\n        } else {\n          yield* KeyedDestructuringAssignmentEvaluation(\n            prop.value,\n            value,\n            propName\n          );\n          excludedNames.add(propName);\n        }\n      } else {\n        yield* RestDestructuringAssignmentEvaluation(\n          prop,\n          value,\n          excludedNames\n        );\n      }\n    }\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-keyeddestructuringassignmentevaluation\n  function* KeyedDestructuringAssignmentEvaluation(\n    node: EstreeNode,\n    value: unknown,\n    propertyName: PropertyKey\n  ): CompletionRecordResult {\n    const assignmentTarget =\n      node.type === \"AssignmentPattern\" ? node.left : node;\n    const isObjectOrArray =\n      assignmentTarget.type === \"ArrayPattern\" ||\n      assignmentTarget.type === \"ObjectPattern\";\n    let lref: ReferenceRecord | undefined;\n    if (!isObjectOrArray) {\n      lref = (yield* Evaluate(assignmentTarget)).Value as ReferenceRecord;\n    }\n    const v = GetV(value, propertyName);\n    let rhsValue;\n    if (node.type === \"AssignmentPattern\" && v === undefined) {\n      // `assignmentTarget.type` is never \"Identifier\" here.\n      const defaultValue = yield* Evaluate(node.right);\n      rhsValue = GetValue(defaultValue);\n    } else {\n      rhsValue = v;\n    }\n    if (isObjectOrArray) {\n      return yield* DestructuringAssignmentEvaluation(\n        assignmentTarget,\n        rhsValue\n      );\n    }\n    return PutValue(lref!, rhsValue);\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-restdestructuringassignmentevaluation\n  function* RestDestructuringAssignmentEvaluation(\n    restProperty: RestElement,\n    value: unknown,\n    excludedNames: Set<PropertyKey>\n  ): CompletionRecordResult {\n    const lref = (yield* Evaluate(restProperty.argument))\n      .Value as ReferenceRecord;\n    const restObj = CopyDataProperties({}, value, excludedNames);\n    return PutValue(lref, restObj);\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-iteratordestructuringassignmentevaluation\n  function* IteratorDestructuringAssignmentEvaluation(\n    elements: (PatternLike | LVal | null)[],\n    iteratorRecord: Iterator<unknown>\n  ): CompletionRecordResult {\n    let status = NormalCompletion(Empty);\n    for (const element of elements) {\n      if (!element) {\n        iteratorRecord.next();\n        status = NormalCompletion(Empty);\n        continue;\n      }\n      const assignmentTarget =\n        element.type === \"RestElement\"\n          ? element.argument\n          : element.type === \"AssignmentPattern\"\n            ? element.left\n            : element;\n      const isObjectOrArray =\n        assignmentTarget.type === \"ArrayPattern\" ||\n        assignmentTarget.type === \"ObjectPattern\";\n      let lref: ReferenceRecord | undefined;\n      if (!isObjectOrArray) {\n        lref = (yield* Evaluate(assignmentTarget)).Value as ReferenceRecord;\n      }\n      let v: unknown;\n      if (element.type !== \"RestElement\") {\n        const { done, value: nextValue } = iteratorRecord.next();\n        const value = done ? undefined : nextValue;\n        if (element.type === \"AssignmentPattern\" && value === undefined) {\n          if (\n            IsAnonymousFunctionDefinition(element.right) &&\n            assignmentTarget.type === \"Identifier\"\n          ) {\n            v = NamedEvaluation(element.right, assignmentTarget.name);\n          } else {\n            const defaultValue = yield* Evaluate(element.right);\n            v = GetValue(defaultValue);\n          }\n        } else {\n          v = value;\n        }\n      } else {\n        // RestElement\n        v = new ArrayConstructor();\n        let n = 0;\n        // eslint-disable-next-line no-constant-condition\n        while (true) {\n          const { done, value: nextValue } = iteratorRecord.next();\n          if (done) {\n            break;\n          }\n          (v as unknown[])[n] = nextValue;\n          n++;\n        }\n      }\n      if (isObjectOrArray) {\n        status = yield* DestructuringAssignmentEvaluation(assignmentTarget, v);\n      } else {\n        status = PutValue(lref!, v);\n      }\n    }\n    return status;\n  }\n\n  // Object expressions.\n  // https://tc39.es/ecma262/#sec-evaluate-property-access-with-expression-key\n  function* EvaluatePropertyAccessWithExpressionKey(\n    baseValue: Record<PropertyKey, unknown>,\n    expression: Expression,\n    strict: boolean\n  ): EvaluateResult<unknown, ReferenceRecord> {\n    const propertyNameReference = yield* Evaluate(expression);\n    const propertyNameValue = GetValue(propertyNameReference);\n    const propertyKey = ToPropertyKey(propertyNameValue);\n    return new ReferenceRecord(baseValue, propertyKey, strict);\n  }\n\n  // https://tc39.es/ecma262/#sec-evaluate-property-access-with-identifier-key\n  function EvaluatePropertyAccessWithIdentifierKey(\n    baseValue: Record<PropertyKey, unknown>,\n    identifier: Identifier,\n    strict: boolean\n  ): ReferenceRecord {\n    currentNode = identifier;\n    const propertyNameString = identifier.name;\n    return new ReferenceRecord(baseValue, propertyNameString, strict);\n  }\n\n  // Block statements.\n  // https://tc39.es/ecma262/#sec-blockdeclarationinstantiation\n  function BlockDeclarationInstantiation(\n    code: Statement[] | SwitchCase[],\n    env: EnvironmentRecord\n  ): void {\n    const declarations = collectScopedDeclarations(code, {\n      var: false,\n      topLevel: false,\n    });\n    for (const d of declarations) {\n      const IsConstantDeclaration =\n        d.type === \"VariableDeclaration\" && d.kind === \"const\";\n      for (const dn of collectBoundNames(d)) {\n        if (IsConstantDeclaration) {\n          env.CreateImmutableBinding(dn, true);\n        } else {\n          env.CreateMutableBinding(dn, false);\n        }\n      }\n      if (d.type === \"FunctionDeclaration\") {\n        const [fn] = collectBoundNames(d);\n        const fo = InstantiateFunctionObject(d, env);\n        env.InitializeBinding(fn, fo);\n      }\n    }\n  }\n\n  // Function declarations and expressions.\n  // https://tc39.es/ecma262/#sec-evaluatecall\n  function* EvaluateCall(\n    func: Function,\n    ref: ReferenceRecord,\n    args: CallExpression[\"arguments\"] | TemplateLiteral,\n    callee: CallExpression[\"callee\"]\n  ): CompletionRecordResult {\n    let thisValue;\n    if (ref instanceof ReferenceRecord) {\n      if (IsPropertyReference(ref)) {\n        thisValue = ref.Base;\n      }\n    }\n    const argList = yield* ArgumentListEvaluation(args);\n    if (typeof func !== \"function\") {\n      const funcName = codeSource.substring(callee.start!, callee.end!);\n      throw new TypeError(`${funcName} is not a function`);\n    }\n\n    if (debug || externalSourceForDebug) {\n      const debuggerCall = (func as FunctionObject)[DebuggerCall];\n      if (debuggerCall) {\n        const result = yield* (debuggerCall as Function).apply(\n          thisValue,\n          argList\n        );\n        doSanitize(result);\n        return NormalCompletion(result);\n      }\n    }\n\n    const result = func.apply(thisValue, argList);\n    doSanitize(result);\n    return NormalCompletion(result);\n  }\n\n  // https://tc39.es/ecma262/#sec-evaluatenew\n  function* EvaluateNew(\n    constructExpr: CallExpression[\"callee\"],\n    args: NewExpression[\"arguments\"]\n  ): CompletionRecordResult {\n    const ref = yield* Evaluate(constructExpr);\n    const constructor = GetValue(ref) as new (...args: unknown[]) => unknown;\n    const argList = yield* ArgumentListEvaluation(args);\n    if (\n      typeof constructor !== \"function\" ||\n      (constructor as unknown as FunctionObject)[IsConstructor] === false\n    ) {\n      const constructorName = codeSource.substring(\n        constructExpr.start!,\n        constructExpr.end!\n      );\n      throw new TypeError(`${constructorName} is not a constructor`);\n    }\n    if (\n      !externalSourceForDebug &&\n      !isAllowedConstructor(constructor) &&\n      constructor !== ArrayConstructor\n    ) {\n      const constructorName = codeSource.substring(\n        constructExpr.start!,\n        constructExpr.end!\n      );\n      throw new TypeError(`${constructorName} is not an allowed constructor`);\n    }\n\n    return NormalCompletion(new constructor(...argList));\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-argumentlistevaluation\n  function* ArgumentListEvaluation(\n    args: CallExpression[\"arguments\"] | TemplateLiteral\n  ): EvaluateResult<unknown, unknown[]> {\n    const array: unknown[] = [];\n    if (Array.isArray(args)) {\n      for (const arg of args) {\n        if (arg.type === \"SpreadElement\") {\n          const spreadValues = GetValue(\n            yield* Evaluate(arg.argument)\n          ) as unknown[];\n          array.push(...spreadValues);\n        } else {\n          array.push(GetValue(yield* Evaluate(arg)));\n        }\n      }\n    } else {\n      array.push(GetTemplateObject(args));\n      for (const expr of args.expressions) {\n        array.push(GetValue(yield* Evaluate(expr)));\n      }\n    }\n    return array;\n  }\n\n  // https://tc39.es/ecma262/#sec-ecmascript-function-objects-call-thisargument-argumentslist\n  function* CallFunction(\n    closure: FunctionObject,\n    thisArgument: unknown,\n    args: Iterable<unknown>\n  ): EvaluateResult<unknown, unknown> {\n    hooks.beforeCall?.(closure[SourceNode]);\n    const calleeContext = PrepareForOrdinaryCall(closure);\n    OrdinaryCallBindThis(closure, calleeContext, thisArgument);\n    const result = yield* OrdinaryCallEvaluateBody(closure, args);\n    if (debug) {\n      currentNode = {\n        ...closure[SourceNode],\n        [DebuggerReturn]: true,\n      } as EstreeNode & {\n        [DebuggerReturn]?: boolean;\n      };\n      yield {\n        type: \"return\",\n        value: result.Type === \"return\" ? result.Value : undefined,\n      };\n    }\n    executionContextStack.pop();\n    globalExecutionContextStack.pop();\n    if (result.Type === \"return\") {\n      return result.Value;\n    }\n    return undefined;\n  }\n\n  // https://tc39.es/ecma262/#sec-prepareforordinarycall\n  function PrepareForOrdinaryCall(F: FunctionObject): ExecutionContext {\n    const calleeContext = new ExecutionContext();\n    calleeContext.Function = F;\n    const localEnv = new FunctionEnvironment(F);\n    calleeContext.VariableEnvironment = localEnv;\n    calleeContext.LexicalEnvironment = localEnv;\n    executionContextStack.push(calleeContext);\n    globalExecutionContextStack.push(calleeContext);\n    return calleeContext;\n  }\n\n  function OrdinaryCallBindThis(\n    F: FunctionObject,\n    calleeContext: ExecutionContext,\n    thisArgument: unknown\n  ) {\n    if (F[ThisMode] === Mode.LEXICAL) {\n      return;\n    }\n    const localEnv = calleeContext.LexicalEnvironment;\n    (localEnv as FunctionEnvironment)?.BindThisValue(thisArgument);\n  }\n\n  // https://tc39.es/ecma262/#sec-ordinarycallevaluatebody\n  function* OrdinaryCallEvaluateBody(\n    F: FunctionObject,\n    args: Iterable<unknown>\n  ): CompletionRecordResult {\n    return yield* EvaluateFunctionBody(F[ECMAScriptCode], F, args);\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-evaluatefunctionbody\n  function* EvaluateFunctionBody(\n    body: Statement[] | Expression,\n    F: FunctionObject,\n    args: Iterable<unknown>\n  ): CompletionRecordResult {\n    yield* FunctionDeclarationInstantiation(F, args);\n    if (Array.isArray(body)) {\n      return yield* EvaluateStatementList(body);\n    }\n    return new CompletionRecord(\"return\", GetValue(yield* Evaluate(body)));\n  }\n\n  // https://tc39.es/ecma262/#sec-block-runtime-semantics-evaluation\n  function* EvaluateStatementList(\n    statements: Statement[]\n  ): CompletionRecordResult {\n    let result = NormalCompletion(Empty);\n    for (const stmt of statements) {\n      const s = yield* Evaluate(stmt);\n      if (s.Type !== \"normal\") {\n        return s;\n      }\n      result = UpdateEmpty(result, s.Value);\n    }\n    return result;\n  }\n\n  function GetThisEnvironment(): FunctionEnvironment {\n    let env: EnvironmentRecord | null | undefined =\n      getRunningContext().LexicalEnvironment;\n    while (env) {\n      if (env.HasThisBinding()) {\n        return env as FunctionEnvironment;\n      }\n      env = env.OuterEnv;\n    }\n    throw new Error(\"Accessing global this is forbidden\");\n  }\n\n  // https://tc39.es/ecma262/#sec-isanonymousfunctiondefinition\n  function IsAnonymousFunctionDefinition(\n    node: EstreeNode\n  ): node is FunctionDefinition {\n    // No ParenthesizedExpression in ESTree.\n    return (\n      (node.type === \"FunctionExpression\" && !node.id) ||\n      node.type === \"ArrowFunctionExpression\"\n    );\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-namedevaluation\n  function NamedEvaluation(node: FunctionDefinition, name: string) {\n    hooks.beforeEvaluate?.(node);\n    // No ParenthesizedExpression in ESTree.\n    switch (node.type) {\n      case \"FunctionExpression\":\n        return InstantiateOrdinaryFunctionExpression(node, name);\n      case \"ArrowFunctionExpression\":\n        return InstantiateArrowFunctionExpression(node, name);\n      // istanbul ignore next: should never happen\n      default:\n        throw new Error(\n          `Unexpected node type for NamedEvaluation: ${(node as FunctionDefinition).type}`\n        );\n    }\n  }\n\n  // https://tc39.es/ecma262/#sec-functiondeclarationinstantiation\n  function* FunctionDeclarationInstantiation(\n    func: FunctionObject,\n    args: Iterable<unknown>\n  ): EvaluateResult<unknown, void> {\n    const calleeContext = getRunningContext();\n    const code = func[ECMAScriptCode];\n    const formals = func[FormalParameters] as FunctionDeclaration[\"params\"];\n    const parameterNames = collectBoundNames(formals);\n    const hasParameterExpressions = containsExpression(formals);\n    const varDeclarations = collectScopedDeclarations(code, {\n      var: true,\n      topLevel: true,\n    });\n    const varNames = collectBoundNames(varDeclarations);\n\n    // `functionNames` ∈ `varNames`\n    // `functionsToInitialize` ≈ `functionNames`\n    const functionNames: string[] = [];\n    const functionsToInitialize: FunctionDeclaration[] = [];\n    for (let i = varDeclarations.length - 1; i >= 0; i--) {\n      const d = varDeclarations[i];\n      if (d.type === \"FunctionDeclaration\") {\n        ThrowIfFunctionIsInvalid(d);\n        const [fn] = collectBoundNames(d);\n        if (!functionNames.includes(fn)) {\n          functionNames.unshift(fn);\n          functionsToInitialize.unshift(d);\n        }\n      } else if (rules?.noVar) {\n        throw new SyntaxError(\n          \"Var declaration is not recommended, use `let` or `const` instead\"\n        );\n      }\n    }\n\n    // let argumentsObjectNeeded = true;\n    // if (func[ThisMode] === Mode.LEXICAL) {\n    //   // NOTE: Arrow functions never have an arguments object.\n    //   argumentsObjectNeeded = false;\n    // } else if (parameterNames.includes(\"arguments\")) {\n    //   argumentsObjectNeeded = false;\n    // } else if (!hasParameterExpressions && (\n    //   varNames.includes(\"arguments\") ||\n    //   collectBoundNames(collectScopedDeclarations(code, { var: false })).includes(\"arguments\")\n    // )) {\n    //   argumentsObjectNeeded = false;\n    // }\n    // NOTE: In strict mode, no parameter/function/var/lexical names can be \"arguments\".\n    const argumentsObjectNeeded =\n      !!externalSourceForDebug && func[ThisMode] !== Mode.LEXICAL;\n\n    const env = calleeContext.LexicalEnvironment!;\n    for (const paramName of parameterNames) {\n      // In strict mode, it's guaranteed no duplicate params exist.\n      env.CreateMutableBinding(paramName, false);\n    }\n\n    let parameterBindings = parameterNames;\n    if (argumentsObjectNeeded) {\n      const ao = CreateUnmappedArgumentsObject(args);\n      env.CreateImmutableBinding(\"arguments\", false);\n      env.InitializeBinding(\"arguments\", ao);\n      parameterBindings = parameterNames.concat(\"arguments\");\n    }\n\n    const iteratorRecord = CreateListIteratorRecord(args);\n    yield* IteratorBindingInitialization(formals, iteratorRecord, env);\n\n    let varEnv: EnvironmentRecord;\n    if (!hasParameterExpressions) {\n      // NOTE: Only a single Environment Record is needed for the parameters\n      // and top-level vars.\n      // `varNames` are unique.\n      const instantiatedVarNames = [...parameterBindings];\n      for (const n of varNames) {\n        if (!instantiatedVarNames.includes(n)) {\n          instantiatedVarNames.push(n);\n          env.CreateMutableBinding(n, false);\n          env.InitializeBinding(n, undefined);\n        }\n      }\n      varEnv = env;\n    } else {\n      // NOTE: A separate Environment Record is needed to ensure that closures\n      // created by expressions in the formal parameter list do not have\n      // visibility of declarations in the function body.\n      varEnv = new DeclarativeEnvironment(env);\n      calleeContext.VariableEnvironment = varEnv;\n      // `varNames` are unique.\n      const instantiatedVarNames: string[] = [];\n      for (const n of varNames) {\n        if (!instantiatedVarNames.includes(n)) {\n          instantiatedVarNames.push(n);\n          varEnv.CreateMutableBinding(n, false);\n          let initialValue: unknown;\n          if (parameterBindings.includes(n) && !functionNames.includes(n)) {\n            initialValue = env.GetBindingValue(n, false);\n          }\n          varEnv.InitializeBinding(n, initialValue);\n          // NOTE: A var with the same name as a formal parameter initially has\n          // the same value as the corresponding initialized parameter.\n        }\n      }\n    }\n    const lexEnv = varEnv;\n    calleeContext.LexicalEnvironment = lexEnv;\n\n    const lexDeclarations = collectScopedDeclarations(code, {\n      var: false,\n      topLevel: true,\n    });\n    for (const d of lexDeclarations) {\n      for (const dn of collectBoundNames(d)) {\n        // Only lexical VariableDeclaration here in top-level.\n        if ((d as VariableDeclaration).kind === \"const\") {\n          lexEnv.CreateImmutableBinding(dn, true);\n        } else {\n          lexEnv.CreateMutableBinding(dn, false);\n        }\n      }\n    }\n\n    for (const f of functionsToInitialize) {\n      const [fn] = collectBoundNames(f);\n      const fo = InstantiateFunctionObject(f, lexEnv);\n      varEnv.SetMutableBinding(fn, fo, false);\n    }\n  }\n\n  function CreateUnmappedArgumentsObject(args: Iterable<unknown>) {\n    const argList = [...args];\n    const argumentObject: Record<string, unknown> = {};\n    Object.defineProperty(argumentObject, \"length\", {\n      value: argList.length,\n      writable: true,\n      configurable: true,\n    });\n    for (let index = 0; index < argList.length; index++) {\n      argumentObject[String(index)] = argList[index];\n    }\n    Object.defineProperty(argumentObject, Symbol.iterator, {\n      value: Array.prototype.values,\n      writable: true,\n      configurable: true,\n    });\n    const ThrowTypeError = () => {\n      throw new TypeError(\n        \"'caller', 'callee', and 'arguments' properties may not be accessed on strict mode functions or the arguments objects for calls to them\"\n      );\n    };\n    Object.defineProperty(argumentObject, \"callee\", {\n      get: ThrowTypeError,\n      set: ThrowTypeError,\n    });\n    return argumentObject;\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-instantiatefunctionobject\n  function InstantiateFunctionObject(\n    func: FunctionDeclaration,\n    scope: EnvironmentRecord\n  ): FunctionObject {\n    const F = OrdinaryFunctionCreate(func, scope, true, false);\n\n    if (func.id) {\n      SetFunctionName(F, func.id.name);\n    }\n\n    return F;\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-instantiateordinaryfunctionexpression\n  function InstantiateOrdinaryFunctionExpression(\n    functionExpression: FunctionExpression,\n    name?: string\n  ): FunctionObject {\n    const scope = getRunningContext().LexicalEnvironment!;\n    if (functionExpression.id) {\n      const name = functionExpression.id.name;\n      const funcEnv = new DeclarativeEnvironment(scope);\n      funcEnv.CreateImmutableBinding(name, false);\n      const closure = OrdinaryFunctionCreate(\n        functionExpression,\n        funcEnv,\n        true,\n        false\n      );\n      SetFunctionName(closure, name);\n      funcEnv.InitializeBinding(name, closure);\n      return closure;\n    } else {\n      const closure = OrdinaryFunctionCreate(\n        functionExpression,\n        scope,\n        true,\n        false\n      );\n      SetFunctionName(closure, name ?? \"\");\n      return closure;\n    }\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-instantiatearrowfunctionexpression\n  function InstantiateArrowFunctionExpression(\n    arrowFunction: ArrowFunctionExpression,\n    name?: string\n  ): FunctionObject {\n    const scope = getRunningContext().LexicalEnvironment!;\n    const closure = OrdinaryFunctionCreate(arrowFunction, scope, false, true);\n    SetFunctionName(closure, name ?? \"\");\n    return closure;\n  }\n\n  function SetFunctionName(F: FunctionObject, name: string) {\n    Object.defineProperty(F, \"name\", {\n      value: name,\n      configurable: true,\n    });\n  }\n\n  // https://tc39.es/ecma262/#sec-ordinaryfunctioncreate\n  function OrdinaryFunctionCreate(\n    sourceNode:\n      | FunctionDeclaration\n      | FunctionExpression\n      | ArrowFunctionExpression,\n    scope: EnvironmentRecord,\n    isConstructor: boolean,\n    lexicalThis: boolean\n  ): FunctionObject {\n    const F = function (this: unknown) {\n      // eslint-disable-next-line prefer-rest-params\n      return unwind(CallFunction(F, this, arguments));\n    } as FunctionObject;\n    Object.defineProperties(F, {\n      [SourceNode]: {\n        value: sourceNode,\n      },\n      [FormalParameters]: {\n        value: sourceNode.params,\n      },\n      [ECMAScriptCode]: {\n        value:\n          sourceNode.body.type === \"BlockStatement\"\n            ? sourceNode.body.body\n            : sourceNode.body,\n      },\n      [Environment]: {\n        value: scope,\n      },\n      [IsConstructor]: {\n        value: isConstructor,\n      },\n      [ThisMode]: {\n        value: lexicalThis ? Mode.LEXICAL : Mode.STRICT,\n      },\n    });\n\n    const len = ExpectedArgumentCount(sourceNode.params);\n    Object.defineProperty(F, \"length\", {\n      configurable: true,\n      value: len,\n    });\n\n    if (debug || externalSourceForDebug) {\n      Object.defineProperty(F, DebuggerCall, {\n        value: function () {\n          // eslint-disable-next-line prefer-rest-params\n          return CallFunction(F, this, arguments);\n        },\n      });\n    }\n    return F;\n  }\n\n  function ExpectedArgumentCount(\n    params: (Identifier | Pattern | RestElement)[]\n  ) {\n    let count = 0;\n    for (const param of params) {\n      switch (param.type) {\n        case \"AssignmentPattern\":\n        case \"RestElement\":\n          return count;\n        default:\n          count++;\n      }\n    }\n    return count;\n  }\n\n  // Patterns initialization.\n  // https://tc39.es/ecma262/#sec-runtime-semantics-bindinginitialization\n  function* BindingInitialization(\n    node: EstreeLVal,\n    value: unknown,\n    environment?: EnvironmentRecord\n  ): EvaluateResult<unknown, CompletionRecord | undefined> {\n    switch (node.type) {\n      case \"Identifier\":\n        return InitializeBoundName(node.name, value, environment);\n      case \"ObjectPattern\":\n        RequireObjectCoercible(value);\n        return yield* PropertyBindingInitialization(\n          (node as EstreeObjectPattern).properties,\n          value,\n          environment\n        );\n      case \"ArrayPattern\": {\n        const iteratorRecord = CreateListIteratorRecord(\n          value as Iterable<unknown>\n        );\n        return yield* IteratorBindingInitialization(\n          node.elements,\n          iteratorRecord,\n          environment\n        );\n      }\n    }\n  }\n\n  // https://tc39.es/ecma262/#sec-destructuring-binding-patterns-runtime-semantics-propertybindinginitialization\n  function* PropertyBindingInitialization(\n    properties: (EstreeProperty | RestElement)[],\n    value: unknown,\n    environment?: EnvironmentRecord\n  ): CompletionRecordResult {\n    const excludedNames = new Set<PropertyKey>();\n    for (const prop of properties) {\n      if (prop.type === \"RestElement\") {\n        return RestBindingInitialization(\n          prop,\n          value,\n          environment,\n          excludedNames\n        );\n      }\n      if (!prop.computed && prop.key.type === \"Identifier\") {\n        yield* KeyedBindingInitialization(\n          prop.value as EstreeLVal,\n          value,\n          environment,\n          prop.key.name\n        );\n        excludedNames.add(prop.key.name);\n      } else {\n        const P = yield* EvaluateComputedPropertyName(prop.key as Expression);\n        yield* KeyedBindingInitialization(\n          prop.value as EstreeLVal,\n          value,\n          environment,\n          P\n        );\n        excludedNames.add(P);\n      }\n    }\n    return NormalCompletion(Empty);\n  }\n\n  // https://tc39.es/ecma262/#prod-ComputedPropertyName\n  function* EvaluateComputedPropertyName(\n    node: Expression\n  ): EvaluateResult<unknown, PropertyKey> {\n    const propName = GetValue(yield* Evaluate(node));\n    return ToPropertyKey(propName);\n  }\n\n  // https://tc39.es/ecma262/#sec-destructuring-binding-patterns-runtime-semantics-restbindinginitialization\n  function RestBindingInitialization(\n    restProperty: RestElement,\n    value: unknown,\n    environment: EnvironmentRecord | undefined,\n    excludedNames: Set<PropertyKey>\n  ): CompletionRecord {\n    const lhs = ResolveBinding(\n      (restProperty.argument as Identifier).name,\n      environment\n    );\n    const restObj = CopyDataProperties({}, value, excludedNames);\n    if (!environment) {\n      return PutValue(lhs, restObj);\n    }\n    return InitializeReferencedBinding(lhs, restObj);\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-iteratorbindinginitialization\n  function* IteratorBindingInitialization(\n    elements: (PatternLike | LVal | null)[],\n    iteratorRecord: Iterator<unknown>,\n    environment?: EnvironmentRecord\n  ): EvaluateResult<unknown, CompletionRecord | undefined> {\n    if (elements.length === 0) {\n      return NormalCompletion(Empty);\n    }\n    let result;\n    for (const node of elements) {\n      if (!node) {\n        // Elision element.\n        iteratorRecord.next();\n        result = NormalCompletion(Empty);\n      } else if (node.type === \"RestElement\") {\n        // Rest element.\n        if (node.argument.type === \"Identifier\") {\n          const lhs = ResolveBinding(node.argument.name, environment);\n          const A: unknown[] = new ArrayConstructor();\n          let n = 0;\n          // eslint-disable-next-line no-constant-condition\n          while (true) {\n            const { done, value } = iteratorRecord.next();\n            if (done) {\n              result = environment\n                ? InitializeReferencedBinding(lhs, A)\n                : PutValue(lhs, A);\n              break;\n            }\n            A[n] = value;\n            n++;\n          }\n        } else {\n          const A: unknown[] = new ArrayConstructor();\n          let n = 0;\n          // eslint-disable-next-line no-constant-condition\n          while (true) {\n            const { done, value } = iteratorRecord.next();\n            if (done) {\n              result = yield* BindingInitialization(\n                node.argument,\n                A,\n                environment\n              );\n              break;\n            }\n            A[n] = value;\n            n++;\n          }\n        }\n      } else {\n        // Normal element.\n        const bindingElement =\n          node.type === \"AssignmentPattern\" ? node.left : node;\n        switch (bindingElement.type) {\n          case \"ObjectPattern\":\n          case \"ArrayPattern\": {\n            let v: unknown;\n            const { done, value } = iteratorRecord.next();\n            if (!done) {\n              v = value;\n            }\n            if (node.type === \"AssignmentPattern\" && v === undefined) {\n              const defaultValue = yield* Evaluate(node.right);\n              v = GetValue(defaultValue);\n            }\n            result = yield* BindingInitialization(\n              bindingElement,\n              v,\n              environment\n            );\n            break;\n          }\n          case \"Identifier\": {\n            const bindingId = bindingElement.name;\n            const lhs = ResolveBinding(bindingId, environment);\n            let v: unknown;\n            const { done, value } = iteratorRecord.next();\n            if (!done) {\n              v = value;\n            }\n            if (node.type === \"AssignmentPattern\" && v === undefined) {\n              if (IsAnonymousFunctionDefinition(node.right)) {\n                v = NamedEvaluation(node.right, bindingId);\n              } else {\n                const defaultValue = yield* Evaluate(node.right);\n                v = GetValue(defaultValue);\n              }\n            }\n            result = environment\n              ? InitializeReferencedBinding(lhs, v)\n              : PutValue(lhs, v);\n            break;\n          }\n        }\n      }\n    }\n    return result;\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-keyedbindinginitialization\n  function* KeyedBindingInitialization(\n    node: EstreeLVal,\n    value: unknown,\n    environment: EnvironmentRecord | undefined,\n    propertyName: PropertyKey\n  ): EvaluateResult<unknown, CompletionRecord | undefined> {\n    const isIdentifier =\n      node.type === \"Identifier\" ||\n      (node.type === \"AssignmentPattern\" && node.left.type === \"Identifier\");\n    if (isIdentifier) {\n      const bindingId =\n        node.type === \"Identifier\" ? node.name : (node.left as Identifier).name;\n      const lhs = ResolveBinding(bindingId, environment);\n      let v = GetV(value, propertyName);\n      if (node.type === \"AssignmentPattern\" && v === undefined) {\n        if (IsAnonymousFunctionDefinition(node.right)) {\n          v = NamedEvaluation(node.right, bindingId);\n        } else {\n          const defaultValue = yield* Evaluate(node.right);\n          v = GetValue(defaultValue);\n        }\n      }\n      if (!environment) {\n        return PutValue(lhs, v);\n      }\n      return InitializeReferencedBinding(lhs, v);\n    }\n\n    let v = GetV(value, propertyName);\n    if (node.type === \"AssignmentPattern\" && v === undefined) {\n      const defaultValue = yield* Evaluate(node.right);\n      v = GetValue(defaultValue);\n    }\n    return yield* BindingInitialization(\n      node.type === \"AssignmentPattern\" ? node.left : node,\n      v,\n      environment\n    );\n  }\n\n  // https://tc39.es/ecma262/#sec-initializeboundname\n  function InitializeBoundName(\n    name: string,\n    value: unknown,\n    environment?: EnvironmentRecord\n  ): CompletionRecord {\n    // Assert: environment is always present.\n    environment!.InitializeBinding(name, value);\n    return NormalCompletion(Empty);\n  }\n\n  function ThrowIfFunctionIsInvalid(\n    func: FunctionDeclaration | FunctionExpression | ArrowFunctionExpression\n  ): void {\n    if (func.async || func.generator) {\n      throw new SyntaxError(\n        `${func.async ? \"Async\" : \"Generator\"} function is not allowed`\n      );\n    }\n    if (expressionOnly && !(func as ArrowFunctionExpression).expression) {\n      throw new SyntaxError(\n        \"Only an `Expression` is allowed in `ArrowFunctionExpression`'s body\"\n      );\n    }\n  }\n\n  if (expressionOnly) {\n    return GetValue(unwind(Evaluate(rootAst)));\n  }\n\n  hooks.beforeEvaluate?.(rootAst);\n  ThrowIfFunctionIsInvalid(rootAst);\n  const [fn] = collectBoundNames(rootAst);\n  // Create an immutable binding for the root function.\n  rootEnv.CreateImmutableBinding(fn, true);\n  const fo = InstantiateFunctionObject(rootAst, rootEnv);\n  rootEnv.InitializeBinding(fn, fo);\n\n  if (debug) {\n    Object.defineProperties(fo, {\n      [DebuggerScope]: {\n        value: function () {\n          return getRunningContext().LexicalEnvironment;\n        },\n      },\n      [DebuggerNode]: {\n        value: function () {\n          return currentNode;\n        },\n      },\n    });\n  }\n\n  return fo;\n}\n\nfunction unwind(iterator: EvaluateResult<unknown, unknown>): unknown {\n  // eslint-disable-next-line no-constant-condition\n  while (true) {\n    const { done, value } = iterator.next();\n    if (done) {\n      return value;\n    }\n  }\n}\n","import {\n  ArrowFunctionExpression,\n  Expression,\n  FunctionDeclaration,\n  FunctionExpression,\n  Statement,\n} from \"@babel/types\";\n\n// https://tc39.es/ecma262/#sec-execution-contexts\nexport class AnalysisContext {\n  VariableEnvironment?: AnalysisEnvironment;\n  LexicalEnvironment?: AnalysisEnvironment;\n}\n\n// https://tc39.es/ecma262/#sec-environment-records\nexport class AnalysisEnvironment {\n  readonly OuterEnv: AnalysisEnvironment | null | undefined;\n  private readonly bindingSet = new Set<string>();\n\n  constructor(outer: AnalysisEnvironment | null | undefined) {\n    this.OuterEnv = outer;\n  }\n\n  HasBinding(name: string): boolean {\n    return this.bindingSet.has(name);\n  }\n\n  CreateBinding(name: string): void {\n    this.bindingSet.add(name);\n  }\n}\n\nexport interface AnalysisFunctionObject {\n  Function: FunctionDeclaration | FunctionExpression | ArrowFunctionExpression;\n  FormalParameters: FunctionDeclaration[\"params\"];\n  ECMAScriptCode: Statement[] | Expression;\n  Environment?: AnalysisEnvironment;\n  ThisMode: \"LEXICAL\" | \"STRICT\";\n}\n","import {\n  ArrowFunctionExpression,\n  Expression,\n  FunctionDeclaration,\n  FunctionExpression,\n  Identifier,\n  Statement,\n  SwitchCase,\n  VariableDeclaration,\n} from \"@babel/types\";\nimport { hasOwnProperty } from \"./hasOwnProperty.js\";\nimport {\n  AnalysisContext,\n  AnalysisEnvironment,\n  AnalysisFunctionObject,\n} from \"./AnalysisContext.js\";\nimport {\n  EstreeNode,\n  EstreeVisitors,\n  NodeWithBoundNames,\n} from \"./interfaces.js\";\nimport {\n  collectBoundNames,\n  collectScopedDeclarations,\n  containsExpression,\n} from \"./traverse.js\";\n\nexport interface PrecookOptions {\n  expressionOnly?: boolean;\n  /** @deprecated Use hooks instead. */\n  visitors?: EstreeVisitors;\n  hooks?: PrecookHooks;\n  withParent?: boolean;\n  externalSourceForDebug?: boolean;\n}\n\nexport type EstreeParent = EstreeParentItem[];\n\nexport interface EstreeParentItem {\n  node: EstreeNode;\n  key: string;\n  index?: number;\n}\n\nexport interface PrecookHooks {\n  beforeVisit?(node: EstreeNode, parent?: EstreeParent): void;\n  beforeVisitGlobal?(node: Identifier, parent?: EstreeParent): void;\n  /** Return true if want to silent warnings for unknown nodes. */\n  beforeVisitUnknown?(node: EstreeNode, parent?: EstreeParent): boolean | void;\n}\n\n/**\n * Analysis an AST of a storyboard function or an evaluation expression.\n *\n * @param rootAst - The root AST.\n * @param options - Analysis options.\n * @returns A set of global variables the root AST attempts to access.\n */\nexport function precook(\n  rootAst: Expression | FunctionDeclaration,\n  {\n    expressionOnly,\n    visitors,\n    withParent,\n    externalSourceForDebug,\n    hooks = {},\n  }: PrecookOptions = {}\n): Set<string> {\n  const attemptToVisitGlobals = new Set<string>();\n  const analysisContextStack: AnalysisContext[] = [];\n  const rootEnv = new AnalysisEnvironment(null);\n  const rootContext = new AnalysisContext();\n  rootContext.VariableEnvironment = rootEnv;\n  rootContext.LexicalEnvironment = rootEnv;\n  analysisContextStack.push(rootContext);\n\n  function getRunningContext(): AnalysisContext {\n    return analysisContextStack[analysisContextStack.length - 1];\n  }\n\n  function visit(node: EstreeNode): void {\n    if (visitors && hasOwnProperty(visitors, node.type)) {\n      visitors[node.type](node);\n    }\n  }\n\n  function EvaluateChildren<T extends EstreeNode>(\n    node: T,\n    keys: (keyof T)[],\n    parent?: EstreeParent\n  ): void {\n    for (const key of keys) {\n      Evaluate(\n        node[key] as unknown as EstreeNode | EstreeNode[],\n        parent?.concat({ node, key } as EstreeParentItem)\n      );\n    }\n  }\n\n  function Evaluate(\n    node: EstreeNode | EstreeNode[],\n    parent?: EstreeParent\n  ): void {\n    if (Array.isArray(node)) {\n      node.forEach((n, index) => {\n        Evaluate(\n          n,\n          parent\n            ? parent.slice(0, -1).concat({\n                ...parent[parent.length - 1],\n                index,\n              })\n            : parent\n        );\n      });\n    } else if (node) {\n      // `node` maybe `null` in some cases.\n      hooks.beforeVisit?.(node, parent);\n      visit(node);\n      // Expressions:\n      switch (node.type) {\n        case \"Identifier\":\n          if (!ResolveBinding(node.name)) {\n            hooks.beforeVisitGlobal?.(node, parent);\n            attemptToVisitGlobals.add(node.name);\n          }\n          return;\n        case \"ArrayExpression\":\n        case \"ArrayPattern\":\n          EvaluateChildren(node, [\"elements\"], parent);\n          return;\n        case \"ArrowFunctionExpression\": {\n          const env = getRunningContext().LexicalEnvironment;\n          const closure = OrdinaryFunctionCreate(node, env, true);\n          CallFunction(closure, parent);\n          return;\n        }\n        case \"AssignmentPattern\":\n        case \"BinaryExpression\":\n        case \"LogicalExpression\":\n          EvaluateChildren(node, [\"left\", \"right\"], parent);\n          return;\n        case \"CallExpression\":\n        case \"NewExpression\":\n          EvaluateChildren(node, [\"callee\", \"arguments\"], parent);\n          return;\n        case \"ChainExpression\":\n          EvaluateChildren(node, [\"expression\"], parent);\n          return;\n        case \"ConditionalExpression\":\n          EvaluateChildren(node, [\"test\", \"consequent\", \"alternate\"], parent);\n          return;\n        case \"MemberExpression\":\n          EvaluateChildren(node, [\"object\"], parent);\n          if (node.computed) {\n            EvaluateChildren(node, [\"property\"], parent);\n          }\n          return;\n        case \"ObjectExpression\":\n        case \"ObjectPattern\":\n          EvaluateChildren(node, [\"properties\"], parent);\n          return;\n        case \"Property\":\n          if (node.computed) {\n            EvaluateChildren(node, [\"key\"], parent);\n          }\n          EvaluateChildren(node, [\"value\"], parent);\n          return;\n        case \"RestElement\":\n        case \"SpreadElement\":\n        case \"UnaryExpression\":\n          EvaluateChildren(node, [\"argument\"], parent);\n          return;\n        case \"SequenceExpression\":\n        case \"TemplateLiteral\":\n          EvaluateChildren(node, [\"expressions\"], parent);\n          return;\n        case \"TaggedTemplateExpression\":\n          EvaluateChildren(node, [\"tag\", \"quasi\"], parent);\n          return;\n        case \"Literal\":\n          return;\n      }\n      if (!expressionOnly) {\n        // Statements and assignments:\n        switch (node.type) {\n          case \"AssignmentExpression\":\n            EvaluateChildren(node, [\"right\", \"left\"], parent);\n            return;\n          case \"BlockStatement\": {\n            if (!node.body.length) {\n              return;\n            }\n            const runningContext = getRunningContext();\n            const oldEnv = runningContext.LexicalEnvironment;\n            const blockEnv = new AnalysisEnvironment(oldEnv);\n            BlockDeclarationInstantiation(node.body, blockEnv);\n            runningContext.LexicalEnvironment = blockEnv;\n            EvaluateChildren(node, [\"body\"], parent);\n            runningContext.LexicalEnvironment = oldEnv;\n            return;\n          }\n          case \"BreakStatement\":\n          case \"ContinueStatement\":\n          case \"EmptyStatement\":\n            return;\n          case \"CatchClause\": {\n            const runningContext = getRunningContext();\n            const oldEnv = runningContext.LexicalEnvironment;\n            const catchEnv = new AnalysisEnvironment(oldEnv);\n            BoundNamesInstantiation(node.param, catchEnv);\n            runningContext.LexicalEnvironment = catchEnv;\n            EvaluateChildren(node, [\"param\", \"body\"], parent);\n            runningContext.LexicalEnvironment = oldEnv;\n            return;\n          }\n          case \"DoWhileStatement\":\n            EvaluateChildren(node, [\"body\", \"test\"], parent);\n            return;\n          case \"ExpressionStatement\":\n          case \"TSAsExpression\":\n            EvaluateChildren(node, [\"expression\"], parent);\n            return;\n          case \"ForInStatement\":\n          case \"ForOfStatement\": {\n            // ForIn/OfHeadEvaluation\n            const lexicalBinding =\n              node.left.type === \"VariableDeclaration\" &&\n              node.left.kind !== \"var\";\n            const runningContext = getRunningContext();\n            const oldEnv = runningContext.LexicalEnvironment;\n            if (lexicalBinding) {\n              const newEnv = new AnalysisEnvironment(oldEnv);\n              BoundNamesInstantiation(node.left, newEnv);\n              runningContext.LexicalEnvironment = newEnv;\n            }\n            EvaluateChildren(node, [\"right\"], parent);\n            runningContext.LexicalEnvironment = oldEnv;\n\n            // ForIn/OfBodyEvaluation\n            if (lexicalBinding) {\n              const iterationEnv = new AnalysisEnvironment(oldEnv);\n              BoundNamesInstantiation(node.left, iterationEnv);\n              runningContext.LexicalEnvironment = iterationEnv;\n            }\n            EvaluateChildren(node, [\"left\", \"body\"], parent);\n            runningContext.LexicalEnvironment = oldEnv;\n            return;\n          }\n          case \"ForStatement\": {\n            const lexicalBinding =\n              node.init?.type === \"VariableDeclaration\" &&\n              node.init.kind !== \"var\";\n            const runningContext = getRunningContext();\n            const oldEnv = runningContext.LexicalEnvironment;\n            if (lexicalBinding) {\n              const loopEnv = new AnalysisEnvironment(oldEnv);\n              BoundNamesInstantiation(\n                node.init as VariableDeclaration,\n                loopEnv\n              );\n              runningContext.LexicalEnvironment = loopEnv;\n            }\n            EvaluateChildren(node, [\"init\", \"test\", \"body\", \"update\"], parent);\n            runningContext.LexicalEnvironment = oldEnv;\n            return;\n          }\n          case \"FunctionDeclaration\": {\n            const [fn] = collectBoundNames(node);\n            const env = getRunningContext().LexicalEnvironment!;\n            const fo = OrdinaryFunctionCreate(node, env);\n            env.CreateBinding(fn);\n            CallFunction(fo, parent);\n            return;\n          }\n          case \"FunctionExpression\": {\n            const closure = InstantiateOrdinaryFunctionExpression(node);\n            CallFunction(closure, parent);\n            return;\n          }\n          case \"IfStatement\":\n            EvaluateChildren(node, [\"test\", \"consequent\", \"alternate\"], parent);\n            return;\n          case \"ReturnStatement\":\n          case \"ThrowStatement\":\n          case \"UpdateExpression\":\n            EvaluateChildren(node, [\"argument\"], parent);\n            return;\n          case \"SwitchCase\":\n            EvaluateChildren(node, [\"test\", \"consequent\"], parent);\n            return;\n          case \"SwitchStatement\": {\n            EvaluateChildren(node, [\"discriminant\"], parent);\n            const runningContext = getRunningContext();\n            const oldEnv = runningContext.LexicalEnvironment;\n            const blockEnv = new AnalysisEnvironment(oldEnv);\n            BlockDeclarationInstantiation(node.cases, blockEnv);\n            runningContext.LexicalEnvironment = blockEnv;\n            EvaluateChildren(node, [\"cases\"], parent);\n            runningContext.LexicalEnvironment = oldEnv;\n            return;\n          }\n          case \"ThisExpression\": {\n            if (!externalSourceForDebug) {\n              break;\n            }\n            return;\n          }\n          case \"TryStatement\":\n            EvaluateChildren(node, [\"block\", \"handler\", \"finalizer\"], parent);\n            return;\n          case \"VariableDeclaration\":\n            EvaluateChildren(node, [\"declarations\"], parent);\n            return;\n          case \"VariableDeclarator\":\n            EvaluateChildren(node, [\"id\", \"init\"], parent);\n            return;\n          case \"WhileStatement\":\n            EvaluateChildren(node, [\"test\", \"body\"], parent);\n            return;\n        }\n      }\n      const silent = hooks.beforeVisitUnknown?.(node, parent);\n      if (!silent) {\n        // eslint-disable-next-line no-console\n        console.warn(`Unsupported node type \\`${node.type}\\``);\n      }\n    }\n  }\n\n  function BoundNamesInstantiation(\n    declarations: NodeWithBoundNames | NodeWithBoundNames[] | null | undefined,\n    env: AnalysisEnvironment\n  ): void {\n    for (const name of collectBoundNames(declarations)) {\n      env.CreateBinding(name);\n    }\n  }\n\n  function ResolveBinding(name: string): boolean {\n    const env = getRunningContext().LexicalEnvironment;\n    return GetIdentifierReference(env, name);\n  }\n\n  function GetIdentifierReference(\n    env: AnalysisEnvironment | null | undefined,\n    name: string\n  ): boolean {\n    return (\n      !!env &&\n      (env.HasBinding(name) || GetIdentifierReference(env.OuterEnv, name))\n    );\n  }\n\n  function BlockDeclarationInstantiation(\n    code: Statement[] | SwitchCase[],\n    env: AnalysisEnvironment\n  ): void {\n    const declarations = collectScopedDeclarations(code, {\n      var: false,\n      topLevel: false,\n    });\n    BoundNamesInstantiation(declarations, env);\n  }\n\n  function CallFunction(\n    closure: AnalysisFunctionObject,\n    parent?: EstreeParent\n  ): void {\n    PrepareOrdinaryCall(closure);\n    FunctionDeclarationInstantiation(closure, parent);\n    Evaluate(\n      closure.ECMAScriptCode,\n      parent\n        ?.concat({\n          node: closure.Function,\n          key: \"body\",\n        })\n        .concat(\n          closure.Function.body.type === \"BlockStatement\"\n            ? {\n                node: closure.Function.body,\n                key: \"body\",\n              }\n            : []\n        )\n    );\n    analysisContextStack.pop();\n  }\n\n  function PrepareOrdinaryCall(F: AnalysisFunctionObject): void {\n    const calleeContext = new AnalysisContext();\n    const localEnv = new AnalysisEnvironment(F.Environment);\n    calleeContext.VariableEnvironment = localEnv;\n    calleeContext.LexicalEnvironment = localEnv;\n    analysisContextStack.push(calleeContext);\n  }\n\n  function FunctionDeclarationInstantiation(\n    func: AnalysisFunctionObject,\n    parent?: EstreeParent\n  ): void {\n    const calleeContext = getRunningContext();\n    const code = func.ECMAScriptCode;\n    const formals = func.FormalParameters;\n    const hasParameterExpressions = containsExpression(formals);\n    const varDeclarations = collectScopedDeclarations(code, {\n      var: true,\n      topLevel: true,\n    });\n    const varNames = collectBoundNames(varDeclarations);\n\n    const argumentsObjectNeeded =\n      !!externalSourceForDebug && func.ThisMode !== \"LEXICAL\";\n\n    const env = calleeContext.LexicalEnvironment!;\n    BoundNamesInstantiation(formals, env);\n\n    if (argumentsObjectNeeded) {\n      env.CreateBinding(\"arguments\");\n    }\n\n    Evaluate(formals, parent?.concat({ node: func.Function, key: \"params\" }));\n\n    let varEnv: AnalysisEnvironment;\n    if (!hasParameterExpressions) {\n      // NOTE: Only a single Environment Record is needed for the parameters\n      // and top-level vars.\n      for (const n of varNames) {\n        env.CreateBinding(n);\n      }\n      varEnv = env;\n    } else {\n      // NOTE: A separate Environment Record is needed to ensure that closures\n      // created by expressions in the formal parameter list do not have\n      // visibility of declarations in the function body.\n      varEnv = new AnalysisEnvironment(env);\n      calleeContext.VariableEnvironment = varEnv;\n      for (const n of varNames) {\n        varEnv.CreateBinding(n);\n      }\n    }\n    const lexEnv = varEnv;\n    calleeContext.LexicalEnvironment = lexEnv;\n\n    const lexDeclarations = collectScopedDeclarations(code, {\n      var: false,\n      topLevel: true,\n    });\n    BoundNamesInstantiation(lexDeclarations, lexEnv);\n  }\n\n  function InstantiateOrdinaryFunctionExpression(\n    functionExpression: FunctionExpression\n  ): AnalysisFunctionObject {\n    const scope = getRunningContext().LexicalEnvironment;\n    if (!functionExpression.id) {\n      return OrdinaryFunctionCreate(functionExpression, scope);\n    }\n    const name = functionExpression.id.name;\n    const funcEnv = new AnalysisEnvironment(scope);\n    funcEnv.CreateBinding(name);\n    return OrdinaryFunctionCreate(functionExpression, funcEnv);\n  }\n\n  function OrdinaryFunctionCreate(\n    func: FunctionDeclaration | FunctionExpression | ArrowFunctionExpression,\n    scope?: AnalysisEnvironment,\n    lexicalThis?: boolean\n  ): AnalysisFunctionObject {\n    return {\n      Function: func,\n      FormalParameters: func.params,\n      ECMAScriptCode:\n        func.body.type === \"BlockStatement\" ? func.body.body : func.body,\n      Environment: scope,\n      ThisMode: lexicalThis ? \"LEXICAL\" : \"STRICT\",\n    };\n  }\n\n  Evaluate(rootAst, withParent ? [] : undefined);\n\n  return attemptToVisitGlobals;\n}\n","export function hasOwnProperty(\n  object: unknown,\n  property: string | number | symbol\n): boolean {\n  return Object.prototype.hasOwnProperty.call(object, property);\n}\n","import type { FunctionDeclaration } from \"@babel/types\";\nimport { parseAsEstree } from \"./parse.js\";\nimport { precook, PrecookOptions } from \"./precook.js\";\n\nlet ASTCache = new WeakMap<object, FunctionDeclaration>();\n\nexport interface PrecookFunctionOptions extends PrecookOptions {\n  cacheKey?: object;\n  typescript?: boolean;\n}\n\nexport interface PrecookFunctionResult {\n  function: FunctionDeclaration;\n  attemptToVisitGlobals: Set<string>;\n}\n\nexport function precookFunction(\n  source: string,\n  { typescript, cacheKey, ...restOptions }: PrecookFunctionOptions = {}\n): PrecookFunctionResult {\n  let func = cacheKey ? ASTCache.get(cacheKey) : undefined;\n  if (!func) {\n    func = parseAsEstree(source, { typescript });\n    if (cacheKey) {\n      ASTCache.set(cacheKey, func);\n    }\n  }\n  const attemptToVisitGlobals = precook(func, restOptions);\n  return {\n    function: func,\n    attemptToVisitGlobals,\n  };\n}\n\nexport function clearFunctionASTCache(): void {\n  ASTCache = new WeakMap();\n}\n","import { parse, parseExpression, type ParserPlugin } from \"@babel/parser\";\nimport type { Expression, FunctionDeclaration, Statement } from \"@babel/types\";\n\nexport function parseAsEstreeExpression(source: string): Expression {\n  return parseExpression(source, {\n    plugins: [\"estree\", [\"pipelineOperator\", { proposal: \"minimal\" }]],\n    attachComment: false,\n  });\n}\n\nexport interface ParseEstreeOptions {\n  typescript?: boolean;\n}\n\nexport function parseAsEstree(\n  source: string,\n  { typescript }: ParseEstreeOptions = {}\n): FunctionDeclaration {\n  const file = parse(source, {\n    plugins: [\"estree\", typescript && \"typescript\"].filter(\n      Boolean\n    ) as ParserPlugin[],\n    strictMode: true,\n    attachComment: false,\n  });\n  const body = file.program.body;\n  const jsNodes: Statement[] = typescript ? [] : body;\n  if (typescript) {\n    for (const node of body) {\n      if (node.type.startsWith(\"TS\")) {\n        if (/Enum|Import|Export/.test(node.type)) {\n          throw new SyntaxError(`Unsupported TypeScript syntax: ${node.type}`);\n        }\n      } else {\n        jsNodes.push(node);\n      }\n    }\n  }\n  if (jsNodes.length === 0) {\n    throw new SyntaxError(\"Function declaration not found\");\n  }\n  if (jsNodes.length > 1 || jsNodes[0].type !== \"FunctionDeclaration\") {\n    throw new SyntaxError(\n      `Expect a single function declaration at top level, but received: ${jsNodes\n        .map((node) => `\"${node.type}\"`)\n        .join(\", \")}`\n    );\n  }\n  return jsNodes[0] as FunctionDeclaration;\n}\n","import type { Expression } from \"@babel/types\";\nimport { parseAsEstreeExpression } from \"./parse.js\";\nimport { precook, PrecookOptions } from \"./precook.js\";\n\nconst ASTCache = new Map<string, Expression>();\n\nexport type PreevaluateOptions = Omit<PrecookOptions, \"expressionOnly\"> & {\n  cache?: boolean;\n};\n\nexport interface PreevaluateResult {\n  expression: Expression;\n  attemptToVisitGlobals: Set<string>;\n  source: string;\n  prefix: string;\n  suffix: string;\n}\n\n// `raw` should always be asserted by `isEvaluable`.\nexport function preevaluate(\n  raw: string,\n  { cache, ...restOptions }: PreevaluateOptions = {}\n): PreevaluateResult {\n  const fixes: string[] = [];\n  const source = raw.replace(/^\\s*<%[~=]?\\s|\\s%>\\s*$/g, (m) => {\n    fixes.push(m);\n    return \"\";\n  });\n  let expression = cache ? ASTCache.get(source) : undefined;\n  if (!expression) {\n    expression = parseAsEstreeExpression(source);\n    if (cache) {\n      ASTCache.set(source, expression);\n    }\n  }\n  const attemptToVisitGlobals = precook(expression, {\n    ...restOptions,\n    expressionOnly: true,\n  });\n  return {\n    expression,\n    attemptToVisitGlobals,\n    source,\n    prefix: fixes[0],\n    suffix: fixes[1],\n  };\n}\n\nexport function isEvaluable(raw: string): boolean {\n  return /^\\s*<%[~=]?\\s/.test(raw) && /\\s%>\\s*$/.test(raw);\n}\n\nexport function shouldAllowRecursiveEvaluations(raw: string): boolean {\n  return /^\\s*<%~\\s/.test(raw);\n}\n\nexport function isTrackAll(raw: string): boolean {\n  return /^\\s*<%=\\s/.test(raw) && /\\s%>\\s*$/.test(raw);\n}\n\nexport function clearExpressionASTCache(): void {\n  ASTCache.clear();\n}\n","export const fetch = (\n  input: RequestInfo,\n  init?: RequestInit\n): Promise<Response> => {\n  // Support older browsers which default credentials is \"omit\".\n  // Ref https://github.com/whatwg/fetch/pull/585\n  const req = new Request(\n    input,\n    Object.assign<RequestInit, RequestInit | undefined>(\n      {\n        credentials: \"same-origin\",\n      },\n      init\n    )\n  );\n\n  return self.fetch(req);\n};\n","export class HttpFetchError extends Error {\n  constructor(message: string) {\n    // Pass remaining arguments (including vendor specific ones) to parent constructor\n    super(message);\n\n    this.name = \"HttpFetchError\";\n\n    // Maintains proper stack trace for where our error was thrown (only available on V8)\n    // istanbul ignore else\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, HttpFetchError);\n    }\n  }\n}\n\nexport class HttpResponseError extends Error {\n  response: Response;\n  responseJson: any;\n\n  constructor(response: Response, responseJson?: any) {\n    // Pass remaining arguments (including vendor specific ones) to parent constructor\n    super(response.statusText);\n\n    this.name = \"HttpResponseError\";\n\n    // Maintains proper stack trace for where our error was thrown (only available on V8)\n    // istanbul ignore else\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, HttpResponseError);\n    }\n\n    this.response = response;\n    this.responseJson = responseJson;\n  }\n}\n\nexport class HttpParseError extends Error {\n  response: Response;\n\n  constructor(response: Response) {\n    // Pass remaining arguments (including vendor specific ones) to parent constructor\n    super(response.statusText);\n\n    this.name = \"HttpParseError\";\n\n    // Maintains proper stack trace for where our error was thrown (only available on V8)\n    // istanbul ignore else\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, HttpParseError);\n    }\n\n    this.response = response;\n  }\n}\n\nexport class HttpAbortError extends Error {\n  constructor(message: string) {\n    super(message);\n    this.name = \"HttpAbortError\";\n  }\n}\n","import type { HttpError } from \"./http.js\";\n\nexport interface InterceptorHandlers<T, C = never> {\n  fulfilled?: (value: T, config: C) => T | Promise<T>;\n  rejected?: (error: HttpError, config: C) => HttpError | Promise<HttpError>;\n}\n\nexport default class InterceptorManager<T, C = never> {\n  handlers: (InterceptorHandlers<T, C> | null)[] = [];\n\n  use(\n    onFulfilled?: (value: T, config: C) => T | Promise<T>,\n    onRejected?: (error: HttpError, config: C) => HttpError | Promise<HttpError>\n  ): number {\n    this.handlers.push({\n      fulfilled: onFulfilled,\n      rejected: onRejected,\n    });\n\n    return this.handlers.length - 1;\n  }\n\n  eject(id: number): void {\n    // istanbul ignore else\n    if (this.handlers[id]) {\n      this.handlers[id] = null;\n    }\n  }\n\n  forEach(fn: (h: InterceptorHandlers<T, C>) => void): void {\n    this.handlers.forEach((handler) => {\n      // istanbul ignore else\n      if (handler !== null) {\n        fn(handler);\n      }\n    });\n  }\n}\n","import { fetch } from \"./fetch.js\";\nimport {\n  HttpAbortError,\n  HttpFetchError,\n  HttpParseError,\n  HttpResponseError,\n} from \"./errors.js\";\nimport InterceptorManager from \"./InterceptorManager.js\";\n\nexport interface HttpRequestConfig {\n  url: string;\n  method: string;\n  data?: unknown;\n  options?: HttpOptions;\n  [key: symbol]: unknown;\n}\n\nexport interface HttpResponse<T = unknown> {\n  data: T;\n  status: number;\n  statusText: string;\n  headers: Headers;\n}\n\nexport type HttpError =\n  | HttpFetchError\n  | HttpResponseError\n  | HttpParseError\n  | HttpAbortError;\n\nexport interface HttpAdapter {\n  (config: HttpRequestConfig): Promise<HttpResponse<unknown>>;\n}\n\nexport interface HttpConstructorOptions {\n  adapter?: HttpAdapter;\n}\n\nfunction isNil(value: unknown): value is null | undefined {\n  return value === undefined || value === null;\n}\n\nconst base = document.querySelector(\"base\");\nconst fullBaseHref = base ? base.href : location.origin + \"/\";\n\nexport type HttpParams = URLSearchParams | object;\n\nexport interface RequestCustomOptions {\n  observe?: \"data\" | \"response\";\n  responseType?: \"json\" | \"blob\" | \"arrayBuffer\" | \"text\";\n  interceptorParams?: {\n    ignoreLoadingBar?: boolean;\n  };\n  noAbortOnRouteChange?: boolean;\n  useCache?: boolean;\n}\n\nexport type HttpCustomOptions = RequestCustomOptions & {\n  params?: HttpParams;\n};\n\nexport type HttpOptions = HttpCustomOptions & RequestInit;\n\n/**\n * Detect whether the input is a native browser abort error.\n *\n * @ref https://developer.mozilla.org/en-US/docs/Web/API/DOMException\n */\nexport const isHttpAbortError = (error: any) =>\n  error instanceof DOMException && error.code === 20;\n\nconst request = async <T>(\n  url: string,\n  init: RequestInit,\n  config: HttpRequestConfig\n): Promise<HttpResponse<T>> => {\n  // eslint-disable-next-line no-async-promise-executor\n  return new Promise(async (resolve, reject) => {\n    let response: Response;\n    config.url = url;\n\n    let { responseType } = config.options || {};\n\n    if (!responseType) {\n      // Defaults to `json`\n      responseType = \"json\";\n    }\n\n    try {\n      response = await fetch(url, init);\n    } catch (e: any) {\n      reject(\n        isHttpAbortError(e)\n          ? new HttpAbortError(e.toString())\n          : new HttpFetchError(e.toString())\n      );\n      return;\n    }\n\n    if (!response.ok) {\n      let responseJson;\n      try {\n        responseJson = await response.json();\n      } catch {\n        // Do nothing.\n      }\n      reject(new HttpResponseError(response, responseJson));\n      return;\n    }\n\n    let data: T;\n    try {\n      data = await response[responseType]();\n    } catch (e: any) {\n      reject(\n        isHttpAbortError(e)\n          ? new HttpAbortError(e.toString())\n          : new HttpParseError(response)\n      );\n      return;\n    }\n\n    const res: HttpResponse<T> = {\n      status: response.status,\n      statusText: response.statusText,\n      headers: response.headers,\n      data,\n    };\n\n    resolve(res);\n  });\n};\n\nexport const getUrlWithParams = (url: string, params?: HttpParams): string => {\n  if (params) {\n    const parsedUrl = new URL(url, fullBaseHref);\n    if (params instanceof URLSearchParams) {\n      params.forEach(function (value, key) {\n        parsedUrl.searchParams.append(key, value);\n      });\n    } else {\n      Object.entries(params).forEach(([key, value]) => {\n        if (Array.isArray(value)) {\n          value.forEach((v) => {\n            parsedUrl.searchParams.append(key, isNil(v) ? \"\" : v);\n          });\n        } else {\n          parsedUrl.searchParams.append(key, isNil(value) ? \"\" : value);\n        }\n      });\n    }\n    const { href } = parsedUrl;\n    if (href.startsWith(fullBaseHref)) {\n      return href.substr(fullBaseHref.length);\n    }\n    return href;\n  }\n  return url;\n};\n\nconst getBodyAndHeaders = (\n  data: unknown,\n  headers?: HeadersInit\n): { body?: BodyInit; headers?: HeadersInit } => {\n  if (data !== undefined) {\n    // `new Headers(undefined)` will throw a TypeError in older browsers (chrome 58).\n    // https://bugs.chromium.org/p/chromium/issues/detail?id=335871\n    const parsedHeaders = new Headers(headers || {});\n    const contentTypeHeader = \"Content-Type\";\n    let body = data as BodyInit | undefined;\n    // If `Content-Type` already provided, ignore detecting content type.\n    if (!parsedHeaders.has(contentTypeHeader)) {\n      if (typeof data === \"string\") {\n        parsedHeaders.set(\n          contentTypeHeader,\n          \"application/x-www-form-urlencoded\"\n        );\n      } else if (data instanceof FormData) {\n        // Do nothing\n      } else {\n        parsedHeaders.set(contentTypeHeader, \"application/json\");\n        body = JSON.stringify(data);\n      }\n    }\n    return {\n      body,\n      headers: parsedHeaders,\n    };\n  }\n  return { headers };\n};\n\nconst simpleRequest = <T = unknown>(\n  method: string,\n  url: string,\n  config: HttpRequestConfig\n): Promise<HttpResponse<T>> => {\n  const {\n    params,\n    /* eslint-disable @typescript-eslint/no-unused-vars */\n    responseType,\n    interceptorParams,\n    observe,\n    noAbortOnRouteChange,\n    useCache,\n    /* eslint-enable @typescript-eslint/no-unused-vars */\n    ...requestInit\n  } = config.options || {};\n  return request<T>(\n    getUrlWithParams(url, params),\n    {\n      ...requestInit,\n      method,\n    },\n    config\n  );\n};\n\nconst requestWithBody = <T = unknown>(\n  method: string,\n  url: string,\n  data: unknown,\n  config: HttpRequestConfig\n): Promise<HttpResponse<T>> => {\n  const {\n    params,\n    headers,\n    /* eslint-disable @typescript-eslint/no-unused-vars */\n    responseType,\n    interceptorParams,\n    observe,\n    noAbortOnRouteChange,\n    useCache,\n    /* eslint-enable @typescript-eslint/no-unused-vars */\n    ...requestInit\n  } = config.options || {};\n  return request<T>(\n    getUrlWithParams(url, params),\n    {\n      ...requestInit,\n      method,\n      ...getBodyAndHeaders(data, headers),\n    },\n    config\n  );\n};\n\nconst defaultAdapter: HttpAdapter = <T>(config: HttpRequestConfig) => {\n  const { url, method, data } = config;\n\n  // \"DELETE\", \"GET\", \"HEAD\" methods.\n  if ([\"DELETE\", \"GET\", \"HEAD\"].includes(config.method)) {\n    return simpleRequest<T>(method, url, config);\n  }\n\n  // \"POST\", \"PUT\" , \"PATCH\" methods.\n  return requestWithBody<T>(method, url, data, config);\n};\n\nclass Http {\n  public readonly interceptors: {\n    request: InterceptorManager<HttpRequestConfig>;\n    response: InterceptorManager<HttpResponse, HttpRequestConfig>;\n  };\n\n  #adapter: HttpAdapter = defaultAdapter;\n\n  constructor(config?: HttpConstructorOptions) {\n    this.interceptors = {\n      request: new InterceptorManager(),\n      response: new InterceptorManager(),\n    };\n\n    if (config?.adapter) {\n      this.#adapter = config.adapter;\n    }\n  }\n\n  request = async <T = unknown>(\n    url: string,\n    init?: RequestInit,\n    options?: RequestCustomOptions\n  ): Promise<T> => {\n    const { body, method, ...requestInit } = init || {};\n    return this.#fetch<T>({\n      url,\n      data: body,\n      method: method || \"GET\",\n      options: { ...(options || {}), ...requestInit },\n    });\n  };\n\n  simpleRequest = <T = unknown>(\n    method: string,\n    url: string,\n    options: HttpOptions = {}\n  ): Promise<T> => {\n    return this.#fetch<T>({ url, method, options });\n  };\n\n  requestWithBody = <T = unknown>(\n    method: string,\n    url: string,\n    data?: unknown,\n    options: HttpOptions = {}\n  ): Promise<T> => {\n    return this.#fetch<T>({ url, method, data, options });\n  };\n\n  #fetch<T>(config: HttpRequestConfig): Promise<T> {\n    const chain: any[] = [];\n    let promise: Promise<any> = Promise.resolve(config);\n\n    this.interceptors.request.forEach((interceptor) => {\n      chain.push(interceptor.fulfilled, interceptor.rejected);\n    });\n\n    chain.push((config: HttpRequestConfig) => this.#adapter(config), undefined);\n\n    this.interceptors.response.forEach((interceptor) => {\n      chain.push(\n        (res: HttpResponse) => interceptor.fulfilled?.(res, config),\n        (error: HttpError) => interceptor.rejected?.(error, config)\n      );\n    });\n\n    chain.push((response: HttpResponse) => {\n      return config.options?.observe === \"response\" ? response : response.data;\n    }, undefined);\n\n    while (chain.length) {\n      promise = promise.then(chain.shift(), chain.shift());\n    }\n\n    return promise;\n  }\n\n  getUrlWithParams(url: string, params?: HttpParams): string {\n    return getUrlWithParams(url, params);\n  }\n\n  getBodyAndHeaders(\n    data: unknown,\n    headers?: HeadersInit\n  ): { body?: BodyInit; headers?: HeadersInit } {\n    return getBodyAndHeaders(data, headers);\n  }\n\n  get<T>(url: string, options?: HttpOptions): Promise<T> {\n    return this.#fetch({ url, method: \"GET\", options });\n  }\n\n  delete<T>(url: string, options?: HttpOptions): Promise<T> {\n    return this.#fetch({ url, method: \"DELETE\", options });\n  }\n\n  head<T>(url: string, options?: HttpOptions): Promise<T> {\n    return this.#fetch({ url, method: \"HEAD\", options });\n  }\n\n  post<T>(url: string, data?: unknown, options?: HttpOptions): Promise<T> {\n    return this.#fetch({ url, method: \"POST\", data, options });\n  }\n\n  put<T>(url: string, data?: unknown, options?: HttpOptions): Promise<T> {\n    return this.#fetch({ url, method: \"PUT\", data, options });\n  }\n\n  patch<T>(url: string, data?: unknown, options?: HttpOptions): Promise<T> {\n    return this.#fetch({\n      url,\n      method: \"PATCH\",\n      data,\n      options,\n    });\n  }\n}\n\nlet http = new Http();\nfunction createHttpInstance(config?: HttpConstructorOptions): void {\n  http = new Http(config);\n}\nexport { http, createHttpInstance, defaultAdapter };\n","export * from \"./cook.js\";\nexport * from \"./precook.js\";\nexport * from \"./precookFunction.js\";\nexport * from \"./preevaluate.js\";\nexport * from \"./interfaces.js\";\n// export { tokTypes } from \"@babel/parser\";\n","import { i18n } from \"@next-core/i18n\";\nimport LanguageDetector from \"i18next-browser-languagedetector\";\n\nlet initialized = false;\nconst initializedNamespaces = new Set<string>();\n\nexport type Locales = Record<string, Record<string, string | undefined>>;\n\nexport function initializeI18n(): void;\nexport function initializeI18n(NS: string, locales: Locales): void;\nexport function initializeI18n(NS?: string, locales?: Locales) {\n  if (!initialized) {\n    initialized = true;\n    i18n\n      // learn more: https://github.com/i18next/i18next-xhr-backend\n      // .use(Backend)\n      // learn more: https://github.com/i18next/i18next-browser-languageDetector\n      .use(\n        process.env.NODE_ENV === \"test\"\n          ? LanguageDetector\n          : /* istanbul ignore next */ (\n              LanguageDetector as unknown as { default: LanguageDetector }\n            ).default\n      )\n      // for all options read: https://www.i18next.com/overview/configuration-options\n      .init({\n        fallbackLng: \"zh\",\n        debug: process.env.NODE_ENV === \"development\",\n        supportedLngs: [\"zh\", \"en\"],\n        nonExplicitSupportedLngs: true,\n        interpolation: {\n          escapeValue: false, // not needed for react as it escapes by default\n        },\n        react: {\n          useSuspense: false,\n        },\n        compatibilityJSON: \"v3\",\n        resources: {},\n      });\n  }\n\n  if (!NS || !locales || initializedNamespaces.has(NS)) {\n    return;\n  }\n  initializedNamespaces.add(NS);\n  for (const [lang, resources] of Object.entries(locales)) {\n    i18n.addResourceBundle(lang, NS, resources);\n  }\n}\n","import { i18n } from \"@next-core/i18n\";\nimport { hasOwnProperty } from \"@next-core/utils/general\";\nimport { I18nData } from \"@next-core/types\";\n\nexport function i18nText(\n  data: I18nData | null | undefined\n): string | undefined {\n  if (!data) {\n    return;\n  }\n  const language = i18n.language ?? \"zh-CN\";\n  // First, make a perfect match.\n  if (hasOwnProperty(data, language)) {\n    return data[language];\n  }\n  // https://en.wikipedia.org/wiki/IETF_language_tag\n  const primaryLanguage = language.split(\"-\")[0];\n  if (primaryLanguage !== language) {\n    // Then, match the primary language (which omits other subtags).\n    // E.g., match `zh` if the current language is `zh-CN`.\n    return hasOwnProperty(data, primaryLanguage)\n      ? data[primaryLanguage]\n      : undefined;\n  }\n  // At last, match the first key which starts with the primary language,\n  // if the current language contains primary subtag only.\n  // E.g., match `zh-CN` if the current language is `zh`.\n  const prefix = `${primaryLanguage}-`;\n  for (const key of Object.keys(data)) {\n    if (key.startsWith(prefix)) {\n      return data[key];\n    }\n  }\n}\n","import { Node, SourceLocation, PipeCall } from \"@next-core/pipes\";\n\nexport enum LexicalStatus {\n  Initial,\n  ExpectField,\n  ExpectOptionalBeginDefault,\n  ExpectDefaultValue,\n  ExpectOptionalBeginPipe,\n  ExpectPipeIdentifier,\n  ExpectOptionalBeginPipeParameter,\n  ExpectPipeParameter,\n  ExpectPlaceholderEnd,\n}\n\nexport enum TokenType {\n  Raw = \"Raw\",\n  BeginPlaceHolder = \"BeginPlaceHolder\",\n  Field = \"Field\",\n  BeginDefault = \"BeginDefault\",\n  LiteralString = \"LiteralString\",\n  BeginPipe = \"BeginPipe\",\n  PipeIdentifier = \"PipeIdentifier\",\n  BeginPipeParameter = \"BeginPipeParameter\",\n  EndPlaceHolder = \"EndPlaceHolder\",\n  JsonValue = \"JsonValue\",\n}\n\nexport enum JsonValueType {\n  Array,\n  Object,\n  String,\n  Others,\n}\n\nexport interface LexicalContext {\n  beginPlaceholder: RegExp;\n  raw: string;\n  cursor: number;\n  status: LexicalStatus;\n  tokens: Token[];\n}\n\nexport interface Token {\n  type: TokenType;\n  value?: any;\n  loc?: SourceLocation;\n}\n\nexport interface InjectableString extends Node {\n  type: \"InjectableString\";\n  elements: (RawString | Placeholder)[];\n}\n\nexport interface RawString extends Node {\n  type: \"RawString\";\n  value: string;\n}\n\nexport interface Placeholder extends Node {\n  type: \"Placeholder\";\n  symbol: string;\n  field: string;\n  defaultValue: any;\n  pipes: PipeCall[];\n}\n","import { escapeRegExp } from \"lodash\";\nimport {\n  LexicalContext,\n  LexicalStatus,\n  Token,\n  TokenType,\n  JsonValueType,\n} from \"./interfaces.js\";\n\nexport function getRegExpOfPlaceholder(symbols: string | string[]): RegExp {\n  return new RegExp(\n    `(${([] as string[])\n      .concat(symbols)\n      .map((symbol) => escapeRegExp(symbol))\n      .join(\"|\")})\\\\{`\n  );\n}\n\nexport function tokenize(raw: string, symbols: string | string[]): Token[] {\n  const context: LexicalContext = {\n    beginPlaceholder: getRegExpOfPlaceholder(symbols),\n    raw,\n    cursor: 0,\n    status: LexicalStatus.Initial,\n    tokens: [],\n  };\n  while (context.cursor < raw.length) {\n    switch (context.status) {\n      case LexicalStatus.Initial:\n        eatOptionalRawAndOptionalPlaceholderBegin(context);\n        break;\n      case LexicalStatus.ExpectField:\n        eatWhitespace(context);\n        eatField(context);\n        break;\n      case LexicalStatus.ExpectOptionalBeginDefault:\n        eatWhitespace(context);\n        eatOptionalDefault(context);\n        break;\n      case LexicalStatus.ExpectDefaultValue:\n        eatWhitespace(context);\n        eatDefaultValue(context);\n        break;\n      case LexicalStatus.ExpectOptionalBeginPipe:\n        eatWhitespace(context);\n        eatOptionalBeginPipe(context);\n        break;\n      case LexicalStatus.ExpectPipeIdentifier:\n        eatWhitespace(context);\n        eatPipeIdentifier(context);\n        break;\n      case LexicalStatus.ExpectOptionalBeginPipeParameter:\n        eatWhitespace(context);\n        eatOptionalBeginPipeParameter(context);\n        break;\n      case LexicalStatus.ExpectPipeParameter:\n        eatWhitespace(context);\n        eatPipeParameter(context);\n        break;\n      case LexicalStatus.ExpectPlaceholderEnd:\n        eatWhitespace(context);\n        eatPlaceholderEnd(context);\n        break;\n    }\n  }\n  if (context.status !== LexicalStatus.Initial) {\n    throw new Error(\"Expected a placeholder end '}' at the end\");\n  }\n  return context.tokens;\n}\n\nfunction eatOptionalRawAndOptionalPlaceholderBegin(\n  context: LexicalContext\n): void {\n  const subRaw = getSubRaw(context);\n  const matchedPlaceholder = subRaw.match(context.beginPlaceholder)?.[0];\n  const subCursor = matchedPlaceholder\n    ? subRaw.indexOf(matchedPlaceholder)\n    : -1;\n  if (\n    subCursor >= 0 &&\n    matchedPlaceholder &&\n    subRaw.charAt(subCursor + matchedPlaceholder.length) !== \"{\"\n  ) {\n    const nextCursor = context.cursor + subCursor;\n    if (subCursor > 0) {\n      context.tokens.push({\n        type: TokenType.Raw,\n        value: subRaw.substring(0, subCursor),\n      });\n    }\n    context.tokens.push({\n      type: TokenType.BeginPlaceHolder,\n      loc: {\n        start: nextCursor,\n        end: nextCursor + matchedPlaceholder.length,\n      },\n      value: matchedPlaceholder.substring(0, matchedPlaceholder.length - 1),\n    });\n    context.cursor += subCursor + matchedPlaceholder.length;\n    context.status = LexicalStatus.ExpectField;\n  } else {\n    context.tokens.push({\n      type: TokenType.Raw,\n      value: subRaw,\n    });\n    context.cursor = context.raw.length;\n  }\n}\n\nfunction eatWhitespace(context: LexicalContext): void {\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  context.cursor += getSubRaw(context).match(/^[ \\r\\n\\t]*/)![0].length;\n}\n\nfunction eatField(context: LexicalContext): void {\n  // Only allow alphanumeric, `_`, `.`, `*`, `[`, `]`, `-` and other non-ascii.\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  const [value] = getSubRaw(context).match(/^[\\w.*[\\]\\-\\u{80}-\\u{10FFFF}]*/u)!;\n  context.tokens.push({\n    type: TokenType.Field,\n    value,\n  });\n  context.cursor += value.length;\n  context.status = LexicalStatus.ExpectOptionalBeginDefault;\n}\n\nfunction eatOptionalDefault(context: LexicalContext): void {\n  if (getSubRaw(context).charAt(0) === \"=\") {\n    context.tokens.push({\n      type: TokenType.BeginDefault,\n    });\n    context.cursor += 1;\n    context.status = LexicalStatus.ExpectDefaultValue;\n  } else {\n    context.status = LexicalStatus.ExpectOptionalBeginPipe;\n  }\n}\n\nfunction eatDefaultValue(context: LexicalContext): void {\n  eatJsonValueOrLiteralString(context, LexicalStatus.ExpectOptionalBeginPipe);\n}\n\nfunction eatOptionalBeginPipe(context: LexicalContext): void {\n  if (getSubRaw(context).charAt(0) === \"|\") {\n    context.tokens.push({\n      type: TokenType.BeginPipe,\n    });\n    context.cursor += 1;\n    context.status = LexicalStatus.ExpectPipeIdentifier;\n  } else {\n    context.status = LexicalStatus.ExpectPlaceholderEnd;\n  }\n}\n\nfunction eatPipeIdentifier(context: LexicalContext): void {\n  const matches = getSubRaw(context).match(/^[a-zA-Z]\\w*/);\n  if (!matches) {\n    throw new Error(\n      `Expected a pipe identifier at index ${\n        context.cursor\n      } near: ${JSON.stringify(context.raw.substring(context.cursor))}`\n    );\n  }\n  const value = matches[0];\n  context.tokens.push({\n    type: TokenType.PipeIdentifier,\n    value,\n  });\n  context.cursor += value.length;\n  context.status = LexicalStatus.ExpectOptionalBeginPipeParameter;\n}\n\nfunction eatOptionalBeginPipeParameter(context: LexicalContext): void {\n  if (getSubRaw(context).charAt(0) === \":\") {\n    context.tokens.push({\n      type: TokenType.BeginPipeParameter,\n    });\n    context.cursor += 1;\n    context.status = LexicalStatus.ExpectPipeParameter;\n  } else {\n    context.status = LexicalStatus.ExpectOptionalBeginPipe;\n  }\n}\n\nfunction eatPipeParameter(context: LexicalContext): void {\n  eatJsonValueOrLiteralString(\n    context,\n    LexicalStatus.ExpectOptionalBeginPipeParameter\n  );\n}\n\nfunction eatPlaceholderEnd(context: LexicalContext): void {\n  if (getSubRaw(context).charAt(0) === \"}\") {\n    context.tokens.push({\n      type: TokenType.EndPlaceHolder,\n      loc: {\n        start: context.cursor,\n        end: context.cursor + 1,\n      },\n    });\n    context.cursor += 1;\n    context.status = LexicalStatus.Initial;\n  } else {\n    throw new Error(\n      `Expected a placeholder end '}' at index ${\n        context.cursor\n      } near: ${JSON.stringify(context.raw.substring(context.cursor))}`\n    );\n  }\n}\n\nconst jsonLiteralMap = new Map([\n  [\"false\", false],\n  [\"null\", null],\n  [\"true\", true],\n]);\n\nfunction eatJsonValueOrLiteralString(\n  context: LexicalContext,\n  nextStatus: LexicalStatus\n): void {\n  const subRaw = getSubRaw(context);\n  if (\n    /[0-9[{\"]/.test(subRaw.charAt(0)) ||\n    /-[0-9]/.test(subRaw.substring(0, 2))\n  ) {\n    eatJsonValue(context, nextStatus);\n  } else {\n    // Accept any characters except controls and whitespace.\n    // Only allow alphanumeric, `_`, `-` and other non-ascii.\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    const [value] = getSubRaw(context).match(/^[\\w\\-\\u{80}-\\u{10FFFF}]*/u)!;\n\n    if (jsonLiteralMap.has(value)) {\n      context.tokens.push({\n        type: TokenType.JsonValue,\n        value: jsonLiteralMap.get(value),\n      });\n    } else {\n      context.tokens.push({\n        type: TokenType.LiteralString,\n        value,\n      });\n    }\n\n    context.cursor += value.length;\n    context.status = nextStatus;\n  }\n}\n\n// 我们不需要非常精确地在一段字符串中匹配出一段*完整合法的* JSON value，\n// 而只需要找到一段*可能是完整合法的* JSON value 即可，解析的工作交给 `JSON.parse()`。\n// 由于 JSON 中 object/array/string 的镜像起止符特性，我们尝试去完成这些符号匹配即可。\nfunction eatJsonValue(\n  context: LexicalContext,\n  nextStatus: LexicalStatus\n): void {\n  const subRaw = getSubRaw(context);\n  const firstChar = subRaw.charAt(0);\n  const valueType: JsonValueType =\n    firstChar === \"[\"\n      ? JsonValueType.Array\n      : firstChar === \"{\"\n      ? JsonValueType.Object\n      : firstChar === '\"'\n      ? JsonValueType.String\n      : JsonValueType.Others;\n\n  let subCursor = 0;\n  let objectBracesToMatch = 0;\n  let arrayBracketsToMatch = 0;\n  let stringQuotesToClose = false;\n  let stringBackslashToEscape = false;\n  let matched = false;\n\n  while (subCursor < subRaw.length) {\n    const char = subRaw.charAt(subCursor);\n    if (stringBackslashToEscape) {\n      stringBackslashToEscape = false;\n    } else if (stringQuotesToClose) {\n      if (char === '\"') {\n        stringQuotesToClose = false;\n      } else if (char === \"\\\\\") {\n        stringBackslashToEscape = true;\n      }\n    } else {\n      switch (char) {\n        case \"[\":\n          arrayBracketsToMatch += 1;\n          break;\n        case \"{\":\n          objectBracesToMatch += 1;\n          break;\n        case \"]\":\n          arrayBracketsToMatch -= 1;\n          break;\n        case \"}\":\n          objectBracesToMatch -= 1;\n          break;\n        case '\"':\n          stringQuotesToClose = true;\n          break;\n      }\n    }\n\n    subCursor += 1;\n\n    switch (valueType) {\n      case JsonValueType.Array:\n        matched = !arrayBracketsToMatch;\n        break;\n      case JsonValueType.Object:\n        matched = !objectBracesToMatch;\n        break;\n      case JsonValueType.String:\n        matched = !stringQuotesToClose;\n        break;\n      default:\n        // 对于其它类型，如果下一个字符不再是这些值类型可能的字符时，我们认为 JSON value 完成匹配。\n        // 其它可能的值类型：number/boolean/null/undefined。\n        matched =\n          subCursor < subRaw.length &&\n          /[^a-z0-9E.+-]/.test(subRaw.charAt(subCursor));\n    }\n\n    if (matched) {\n      break;\n    }\n  }\n\n  if (!matched) {\n    throw new Error(\n      `Failed to match a JSON value at index ${\n        context.cursor\n      } near: ${JSON.stringify(context.raw.substring(context.cursor))}`\n    );\n  }\n\n  context.tokens.push({\n    type: TokenType.JsonValue,\n    value: JSON.parse(subRaw.substring(0, subCursor)),\n  });\n  context.cursor += subCursor;\n  context.status = nextStatus;\n}\n\nfunction getSubRaw(context: LexicalContext): string {\n  return context.raw.substring(context.cursor);\n}\n","import { get } from \"lodash\";\nimport type { Location } from \"history\";\nimport type { FeatureFlags, MicroApp } from \"@next-core/types\";\nimport { processPipes } from \"@next-core/pipes\";\nimport { parseInjectableString } from \"./syntax.js\";\nimport type { Placeholder } from \"./interfaces.js\";\nimport { getRegExpOfPlaceholder } from \"./lexical.js\";\n\nexport interface LegacyCompatibleRuntimeContext {\n  app: MicroApp;\n  overrideApp?: MicroApp;\n  location: Location;\n  query: URLSearchParams;\n  /** {@inheritDoc FeatureFlags} */\n  flags: FeatureFlags;\n  /** 系统运行时信息，包括登录信息和页面信息。 */\n  sys: Record<string, unknown>;\n  match?: {\n    path: string;\n    url: string;\n    isExact: boolean;\n    params: Record<string, string>;\n  };\n  event?: Event;\n  data?: unknown;\n}\n\nexport function transform(\n  raw: string,\n  context: LegacyCompatibleRuntimeContext\n): unknown {\n  return compile(raw, \"@\", context);\n}\n\nexport function inject(\n  raw: string,\n  context: LegacyCompatibleRuntimeContext\n): unknown {\n  return compile(raw, \"$\", context);\n}\n\nexport function transformAndInject(\n  raw: string,\n  context: LegacyCompatibleRuntimeContext\n): unknown {\n  return compile(raw, [\"@\", \"$\"], context);\n}\n\ntype CompileNode = (node: Placeholder) => unknown;\n\nfunction compile(\n  raw: string,\n  symbols: string | string[],\n  context: LegacyCompatibleRuntimeContext\n): unknown {\n  // const symbols = [\"@\", \"$\"];\n  if (!isInjectable(raw, symbols)) {\n    return raw;\n  }\n\n  const transformNode = transformNodeFactory(context.data);\n  const injectNode = injectNodeFactory(context, raw);\n\n  const tree = parseInjectableString(raw, symbols);\n  const values = tree.elements.map((node) =>\n    node.type === \"RawString\"\n      ? node.value\n      : node.symbol === \"$\"\n      ? injectNode(node)\n      : transformNode(node)\n  );\n\n  return reduceCompiledValues(values);\n}\n\nfunction reduceCompiledValues(values: unknown[]): unknown {\n  // If the whole string is a placeholder, we should keep the original value.\n  if (values.length === 1) {\n    return values[0];\n  }\n\n  // If an element is `undefined`, `null` or an empty array `[]`, it is converted to an empty string.\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/join#Description\n  return values.join(\"\");\n}\n\nfunction isInjectable(raw: string, symbols?: string | string[]): boolean {\n  return getRegExpOfPlaceholder(symbols).test(raw);\n}\n\nfunction transformNodeFactory(data: unknown): CompileNode {\n  return function transformNode(node: Placeholder): unknown {\n    // If meet `@{}`, return `data`.\n    let result = node.field ? get(data, node.field) : data;\n\n    if (result === undefined) {\n      result = node.defaultValue;\n    }\n\n    return processPipes(result, node.pipes);\n  };\n}\n\nfunction injectNodeFactory(\n  context: LegacyCompatibleRuntimeContext,\n  raw: string\n): CompileNode {\n  return function injectNode(node: Placeholder): unknown {\n    const matches = node.field.match(\n      /^(?:(QUERY(?:_ARRAY)?|EVENT|query|event|APP|HASH|ANCHOR|SYS|FLAGS|CTX)\\.)?(.+)$/\n    );\n    if (!matches) {\n      // Keep the original raw partial when meet a unknown namespace.\n      return raw.substring(node.loc.start, node.loc.end);\n    }\n    let [, namespace, subField] = matches;\n\n    // Support namespace with no subfield such as `${ANCHOR}`.\n    // But distinguish with match params. E.g. `${query}` is a match param.\n    if (!namespace && /^[A-Z_]+$/.test(subField)) {\n      namespace = subField;\n      subField = \"*\";\n    }\n\n    let result: unknown;\n    const SimpleContextMap: Record<string, \"sys\" | \"flags\"> = {\n      SYS: \"sys\",\n      FLAGS: \"flags\",\n    };\n\n    switch (namespace) {\n      case \"QUERY\":\n      case \"query\":\n        if (subField === \"*\") {\n          result = context.query;\n        } else {\n          result = context.query.has(subField)\n            ? context.query.get(subField)\n            : undefined;\n        }\n        break;\n      case \"QUERY_ARRAY\":\n        result = context.query.has(subField)\n          ? context.query.getAll(subField)\n          : undefined;\n        break;\n      case \"EVENT\":\n      case \"event\":\n        if (context.event === undefined) {\n          // Keep the original raw partial when meet a `${EVENT}` in non-event context.\n          return raw.substring(node.loc.start, node.loc.end);\n        }\n        result =\n          subField === \"*\" ? context.event : get(context.event, subField);\n        break;\n      case \"APP\":\n        result =\n          subField === \"*\"\n            ? context.overrideApp ?? context.app\n            : get(context.overrideApp ?? context.app, subField);\n        break;\n      case \"HASH\":\n        result = context.location.hash;\n        break;\n      case \"SYS\":\n      case \"FLAGS\":\n        result =\n          subField === \"*\"\n            ? context[SimpleContextMap[namespace]]\n            : get(context[SimpleContextMap[namespace]], subField);\n        break;\n      case \"ANCHOR\": {\n        const anchor = context.location.hash\n          ? context.location.hash.substr(1)\n          : null;\n        result = subField === \"*\" ? anchor : get(anchor, subField);\n        break;\n      }\n      case \"CTX\": {\n        const original = raw.substring(node.loc.start, node.loc.end);\n        // eslint-disable-next-line no-console\n        console.error(\n          `CTX is not supported in placeholder any more: \"${original}\"`\n        );\n        return original;\n      }\n      default:\n        if (context.match) {\n          result = context.match.params[subField];\n        } else {\n          // If the context is empty, return the original raw partial.\n          return raw.substring(node.loc.start, node.loc.end);\n        }\n    }\n\n    if (result === undefined) {\n      result = node.defaultValue;\n    }\n\n    return processPipes(result, node.pipes);\n  };\n}\n","import { PipeCall } from \"@next-core/pipes\";\nimport { tokenize } from \"./lexical.js\";\nimport {\n  Token,\n  TokenType,\n  InjectableString,\n  Placeholder,\n} from \"./interfaces.js\";\n\nexport function parseInjectableString(\n  raw: string,\n  symbols: string | string[]\n): InjectableString {\n  return parseTokens(tokenize(raw, symbols));\n}\n\nfunction parseTokens(tokens: Token[]): InjectableString {\n  const tree: InjectableString = {\n    type: \"InjectableString\",\n    elements: [],\n  };\n\n  let token: Token | undefined;\n\n  function optionalToken(type: TokenType): boolean {\n    if (type === tokens[0].type) {\n      token = tokens.shift();\n      return true;\n    }\n    return false;\n  }\n\n  function acceptToken(type: TokenType | TokenType[]): void {\n    token = tokens.shift() as Token;\n    if (\n      Array.isArray(type) ? !type.includes(token.type) : type !== token.type\n    ) {\n      throw new Error(`Expected token: ${type}, received token: ${token.type}`);\n    }\n  }\n\n  while (tokens.length > 0) {\n    if (optionalToken(TokenType.Raw)) {\n      tree.elements.push({\n        type: \"RawString\",\n        value: token.value,\n      });\n    } else {\n      acceptToken(TokenType.BeginPlaceHolder);\n      const start = token.loc.start;\n      const symbol = token.value;\n      acceptToken(TokenType.Field);\n\n      const placeholder: Placeholder = {\n        type: \"Placeholder\",\n        symbol,\n        field: token.value,\n        defaultValue: undefined,\n        pipes: [],\n        loc: {\n          start,\n          end: start,\n        },\n      };\n      tree.elements.push(placeholder);\n\n      if (optionalToken(TokenType.BeginDefault)) {\n        acceptToken([TokenType.JsonValue, TokenType.LiteralString]);\n        placeholder.defaultValue = token.value;\n      }\n\n      while (optionalToken(TokenType.BeginPipe)) {\n        acceptToken(TokenType.PipeIdentifier);\n        const pipe: PipeCall = {\n          type: \"PipeCall\",\n          identifier: token.value,\n          parameters: [],\n        };\n        placeholder.pipes.push(pipe);\n\n        while (optionalToken(TokenType.BeginPipeParameter)) {\n          acceptToken([TokenType.JsonValue, TokenType.LiteralString]);\n          pipe.parameters.push(token.value);\n        }\n      }\n\n      acceptToken(TokenType.EndPlaceHolder);\n      placeholder.loc.end = token.loc.end;\n    }\n  }\n\n  return tree;\n}\n","const cache = new Map<string, Promise<string>>();\n\nexport default function loadScriptOrStyle(\n  type: \"script\" | \"style\",\n  src: string,\n  prefix?: string,\n  attrs?: Record<string, unknown>\n): Promise<string>;\nexport default function loadScriptOrStyle(\n  type: \"script\" | \"style\",\n  src: string[],\n  prefix?: string,\n  attrs?: Record<string, unknown>\n): Promise<string[]>;\nexport default function loadScriptOrStyle(\n  type: \"script\" | \"style\",\n  src: string | string[],\n  prefix?: string,\n  attrs?: Record<string, unknown>\n): Promise<string | string[]> {\n  if (Array.isArray(src)) {\n    return Promise.all(\n      src.map<Promise<string>>((item) => loadScriptOrStyle(type, item, prefix))\n    );\n  }\n  const fixedSrc = prefix && !/^https?:/.test(src) ? `${prefix}${src}` : src;\n  const cachedPromise = cache.get(fixedSrc);\n  if (cachedPromise) {\n    return cachedPromise;\n  }\n  const promise = new Promise<string>((resolve, reject) => {\n    const end = (): void => {\n      window.dispatchEvent(new Event(\"request.end\"));\n    };\n    const element = document.createElement(\n      type === \"style\" ? \"link\" : \"script\"\n    );\n    if (type === \"script\") {\n      Object.assign(element, {\n        type: \"text/javascript\",\n        async: true,\n        ...attrs,\n        src: fixedSrc,\n      });\n    } else {\n      Object.assign(element, {\n        rel: \"stylesheet\",\n        ...attrs,\n        href: fixedSrc,\n      });\n    }\n    element.onload = () => {\n      resolve(fixedSrc);\n      end();\n    };\n    element.onerror = (e) => {\n      reject(e);\n      end();\n    };\n    const firstScript =\n      document.currentScript || document.getElementsByTagName(\"script\")[0];\n    (firstScript.parentNode as Node).insertBefore(element, firstScript);\n    window.dispatchEvent(new Event(\"request.start\"));\n  });\n  cache.set(fixedSrc, promise);\n  return promise;\n}\n","import loadScriptOrStyle from \"./loadScriptOrStyle.js\";\n\nexport default function loadScript(\n  src: string,\n  prefix?: string,\n  attrs?: Record<string, unknown>\n): Promise<string>;\nexport default function loadScript(\n  src: string[],\n  prefix?: string,\n  attrs?: Record<string, unknown>\n): Promise<string[]>;\nexport default function loadScript(\n  src: string | string[],\n  prefix?: string,\n  attrs?: Record<string, unknown>\n): Promise<string | string[]> {\n  return loadScriptOrStyle(\"script\", src as string, prefix, attrs);\n}\n","import loadScriptOrStyle from \"./loadScriptOrStyle.js\";\n\nexport default function loadStyle(\n  src: string,\n  prefix?: string,\n  attrs?: Record<string, unknown>\n): Promise<string>;\nexport default function loadStyle(\n  src: string[],\n  prefix?: string,\n  attrs?: Record<string, unknown>\n): Promise<string[]>;\nexport default function loadStyle(\n  src: string | string[],\n  prefix?: string,\n  attrs?: Record<string, unknown>\n): Promise<string | string[]> {\n  return loadScriptOrStyle(\"style\", src as string, prefix, attrs);\n}\n","declare const __webpack_init_sharing__: (scope: string) => Promise<unknown>;\ndeclare const __webpack_share_scopes__: Record<string, unknown>;\n\ninterface WebpackRuntimeContainer {\n  init(arg: unknown): Promise<unknown>;\n  get(module: string): Promise<Function>;\n}\n\n// https://github.com/module-federation/module-federation-examples/blob/eda9493f3991a423479fd834cfb1d7b241d9d1f0/advanced-api/dynamic-remotes/app1/src/App.js\nexport default async function loadSharedModule(scope: string, module: string) {\n  // Initializes the share scope. This fills it with known provided modules from this build and all remotes\n  await __webpack_init_sharing__(\"default\");\n  const container = (window as unknown as Record<string, unknown>)[\n    scope\n  ] as WebpackRuntimeContainer; // or get the container somewhere else\n  // Initialize the container, it may provide shared modules\n  await container.init(__webpack_share_scopes__.default);\n  const factory = await container.get(module);\n  return factory();\n}\n","import loadScript from \"./loadScript.js\";\nimport loadSharedModule from \"./loadSharedModule.js\";\n\ninterface BrickPackage {\n  id: string;\n  filePath: string;\n  elements?: string[];\n  editors?: string[];\n  dependencies?: Record<string, string[]>;\n  deprecatedElements?: string[];\n\n  // Legacy v2 packages\n  propertyEditorsJsFilePath?: string;\n  propertyEditors?: string[];\n}\n\nlet resolveBasicPkg: () => void;\nlet rejectBasicPkg: (e: unknown) => void;\nlet basicPkgWillBeResolved = false;\nconst waitBasicPkg = new Promise<void>((resolve, reject) => {\n  resolveBasicPkg = resolve;\n  rejectBasicPkg = reject;\n});\n\nexport function flushStableLoadBricks(): void {\n  if (!basicPkgWillBeResolved) {\n    resolveBasicPkg();\n  }\n}\n\n/**\n * When loading bundles with webpack module federation concurrently, if\n * these bundles share some modules, webpack will load a singleton module\n * if versions are matched. Webpack will use the first bundle who started\n * to init the shared scope. Generally which bundle to use for a specific\n * module, does not matter. However, it may cause flaky result since the\n * shared module may from different bundles which maybe not exactly the\n * same, especially developers declare dependencies incorrectly sometimes.\n * So in order to make it less flaky, we try to make a BASIC package takes\n * precedence over others. We will always load the shared modules from the\n * basic package bundle if it contains the shared modules.\n */\nexport function enqueueStableLoadBricks(\n  bricks: string[] | Set<string>,\n  brickPackages: BrickPackage[]\n): Promise<void> {\n  const promise = enqueueStableLoad(\"bricks\", bricks, brickPackages);\n  return dispatchRequestStatus(promise);\n}\n\nexport function enqueueStableLoadProcessors(\n  processors: string[] | Set<string>,\n  brickPackages: BrickPackage[]\n): Promise<void> {\n  const promise = enqueueStableLoad(\"processors\", processors, brickPackages);\n  return dispatchRequestStatus(promise);\n}\n\nexport async function loadBricksImperatively(\n  bricks: string[] | Set<string>,\n  brickPackages: BrickPackage[]\n): Promise<void> {\n  const promise = enqueueStableLoad(\"bricks\", bricks, brickPackages);\n  flushStableLoadBricks();\n  return dispatchRequestStatus(promise);\n}\n\nexport function loadProcessorsImperatively(\n  processors: string[] | Set<string>,\n  brickPackages: BrickPackage[]\n): Promise<void> {\n  const promise = enqueueStableLoad(\"processors\", processors, brickPackages);\n  flushStableLoadBricks();\n  return dispatchRequestStatus(promise);\n}\n\nexport function loadEditorsImperatively(\n  editors: string[] | Set<string>,\n  brickPackages: BrickPackage[]\n): Promise<void> {\n  const promise = enqueueStableLoad(\"editors\", editors, brickPackages);\n  flushStableLoadBricks();\n  return dispatchRequestStatus(promise);\n}\n\nexport class BrickLoadError extends Error {\n  constructor(message: string) {\n    // Pass remaining arguments (including vendor specific ones) to parent constructor\n    super(message);\n\n    this.name = \"BrickLoadError\";\n\n    // Maintains proper stack trace for where our error was thrown (only available on V8)\n    // istanbul ignore else\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, BrickLoadError);\n    }\n  }\n}\n\ninterface V2AdapterBrick {\n  resolve(\n    adapterPkgFilePath: string,\n    brickPkgFilePath: string,\n    bricks: string[],\n    dlls: string[] | undefined,\n    brickPackages: BrickPackage[]\n  ): Promise<void>;\n}\n\nlet v2AdapterPromise: Promise<V2AdapterBrick> | undefined;\nconst V2_ADAPTER_LOAD_BRICKS = \"v2-adapter.load-bricks\";\n\ninterface BrickItem {\n  fullName: string;\n  lastName: string;\n}\n\n// Get brick/processor items including their dependencies\nfunction getItemsByPkg(\n  type: \"bricks\" | \"processors\" | \"editors\",\n  list: string[] | Set<string>,\n  brickPackagesMap: Map<string, BrickPackage>\n) {\n  const itemsByPkg = new Map<BrickPackage, BrickItem[]>();\n  const listToLoad = new Set<string>();\n  const add = (item: string) => {\n    if (listToLoad.has(item)) {\n      return;\n    }\n    listToLoad.add(item);\n    let pkg: BrickPackage | undefined;\n    let namespace: string;\n    let lastName: string | undefined;\n    if (type === \"editors\") {\n      lastName = item;\n      for (const p of brickPackagesMap.values()) {\n        if ((p.propertyEditors ?? p.editors)?.some((e) => e === lastName)) {\n          pkg = p;\n        }\n      }\n    } else if (type === \"processors\" || item.includes(\".\")) {\n      [namespace, lastName] = item.split(\".\");\n      const pkgId = `bricks/${\n        type === \"processors\" ? getProcessorPackageName(namespace) : namespace\n      }`;\n      pkg = brickPackagesMap.get(pkgId);\n    } else {\n      lastName = item;\n      let deprecatedBrickInThisPkg;\n      for (const p of brickPackagesMap.values()) {\n        if (p.elements?.some((e) => e === lastName)) {\n          if (p.deprecatedElements?.includes(item)) {\n            deprecatedBrickInThisPkg = p;\n          } else {\n            pkg = p;\n            break;\n          }\n        }\n      }\n      if (!pkg && deprecatedBrickInThisPkg) {\n        pkg = deprecatedBrickInThisPkg;\n      }\n    }\n\n    if (!pkg) {\n      // eslint-disable-next-line no-console\n      console.error(`Package for ${item} not found.`);\n      return;\n    }\n\n    let groupItems = itemsByPkg.get(pkg);\n    if (!groupItems) {\n      groupItems = [];\n      itemsByPkg.set(pkg, groupItems);\n    }\n    groupItems.push({ fullName: item, lastName });\n\n    // Load their dependencies too\n    const deps = pkg.dependencies?.[item];\n    if (deps) {\n      for (const dep of deps) {\n        add(dep);\n      }\n    }\n  };\n  for (const item of list) {\n    add(item);\n  }\n  return itemsByPkg;\n}\n\nasync function loadBrickModule(\n  type: \"bricks\" | \"processors\" | \"editors\",\n  pkgId: string,\n  item: BrickItem\n) {\n  const moduleName = `${type === \"processors\" || type === \"editors\" ? `./${type}/` : \"./\"}${\n    type === \"editors\" ? item.fullName : item.lastName\n  }`;\n  try {\n    await loadSharedModule(pkgId, moduleName);\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.error(error);\n    throw new BrickLoadError(\n      `Load ${type} of \"${item.fullName}\" failed: ${(error as Error)?.message}`\n    );\n  }\n}\n\nfunction loadRestBricks(\n  type: \"bricks\" | \"processors\" | \"editors\",\n  pkgs: BrickPackage[],\n  itemsMap: Map<BrickPackage, BrickItem[]>\n) {\n  return pkgs.map(async (pkg) => {\n    await loadScript(pkg.filePath, window.PUBLIC_ROOT ?? \"\");\n    await waitBasicPkg;\n    return Promise.all(\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      itemsMap.get(pkg)!.map((item) => loadBrickModule(type, pkg.id, item))\n    );\n  });\n}\n\nasync function enqueueStableLoad(\n  type: \"bricks\" | \"processors\" | \"editors\",\n  list: string[] | Set<string>,\n  brickPackages: BrickPackage[]\n): Promise<void> {\n  const brickPackagesMap = new Map<string, BrickPackage>();\n  for (const pkg of brickPackages) {\n    const pkgId = pkg.id || getPkgIdByFilePath(pkg.filePath);\n    brickPackagesMap.set(pkgId, pkg);\n  }\n\n  const itemsByPkg = getItemsByPkg(type, list, brickPackagesMap);\n\n  let foundBasicPkg: BrickPackage | undefined;\n  const v2Packages: BrickPackage[] = [];\n  const v3PackagesOtherThanBasic: BrickPackage[] = [];\n  let maybeV2Adapter: BrickPackage | undefined;\n  for (const pkg of itemsByPkg.keys()) {\n    if (pkg.id) {\n      if (pkg.id === \"bricks/basic\") {\n        foundBasicPkg = pkg;\n      } else {\n        v3PackagesOtherThanBasic.push(pkg);\n      }\n    } else {\n      // Brick packages of v2 has no `id`\n      v2Packages.push(pkg);\n      maybeV2Adapter = brickPackagesMap.get(\"bricks/v2-adapter\");\n      if (!maybeV2Adapter) {\n        throw new Error(\"Using v2 bricks, but v2-adapter not found\");\n      }\n    }\n  }\n  const v2Adapter = maybeV2Adapter;\n\n  let basicPkgPromise: Promise<unknown> | undefined;\n  const basicPkg = foundBasicPkg;\n  if (basicPkg) {\n    const tempPromise = loadScript(basicPkg.filePath, window.PUBLIC_ROOT ?? \"\");\n    // Packages other than BASIC will wait for an extra micro-task tick.\n    if (!basicPkgWillBeResolved) {\n      basicPkgWillBeResolved = true;\n      tempPromise\n        .then(() => Promise.resolve())\n        .then(resolveBasicPkg, rejectBasicPkg);\n    }\n    basicPkgPromise = tempPromise.then(() =>\n      Promise.all(\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        itemsByPkg\n          .get(basicPkg)!\n          .map((item) => loadBrickModule(type, basicPkg.id, item))\n      )\n    );\n  }\n\n  const pkgPromises = [basicPkgPromise].concat(\n    loadRestBricks(type, v3PackagesOtherThanBasic, itemsByPkg)\n  );\n\n  if (v2Adapter && v2Packages.length > 0) {\n    if (!v2AdapterPromise) {\n      // Load `v2-adapter.load-bricks` and its dependencies\n      const v2AdapterItemsByPkg = getItemsByPkg(\n        \"bricks\",\n        [V2_ADAPTER_LOAD_BRICKS],\n        brickPackagesMap\n      );\n      const v2AdapterPackages = [...v2AdapterItemsByPkg.keys()];\n\n      const loadV2Adapter = async () => {\n        await Promise.all(\n          loadRestBricks(\"bricks\", v2AdapterPackages, v2AdapterItemsByPkg)\n        );\n        return document.createElement(\n          V2_ADAPTER_LOAD_BRICKS\n        ) as unknown as V2AdapterBrick;\n      };\n      v2AdapterPromise = loadV2Adapter();\n    }\n\n    pkgPromises.push(\n      v2AdapterPromise.then((adapter) =>\n        Promise.all(\n          v2Packages.map((pkg) => {\n            const pkgId = getPkgIdByFilePath(pkg.filePath);\n            const pkgNamespace = pkgId.split(\"/\")[1];\n            return adapter.resolve(\n              v2Adapter.filePath,\n              type === \"editors\"\n                ? (pkg.propertyEditorsJsFilePath ?? pkg.filePath)\n                : pkg.filePath,\n              type === \"bricks\"\n                ? // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                  itemsByPkg\n                    .get(pkg)!\n                    .map((item) => `${pkgNamespace}.${item.lastName}`)\n                : [],\n              (pkg as { dll?: string[] }).dll,\n              // Todo: remove `brickPackages` as an argument\n              brickPackages\n            );\n          })\n        )\n      )\n    );\n  }\n\n  await Promise.all(pkgPromises);\n}\n\nasync function dispatchRequestStatus(promise: Promise<unknown>) {\n  window.dispatchEvent(new Event(\"request.start\"));\n  try {\n    await promise;\n  } finally {\n    window.dispatchEvent(new Event(\"request.end\"));\n  }\n}\n\nfunction getProcessorPackageName(camelPackageName: string): string {\n  return camelPackageName\n    .replace(/[A-Z]/g, (match) => `-${match[0].toLocaleLowerCase()}`)\n    .replace(/_[0-9]/g, (match) => `-${match[1]}`);\n}\n\nfunction getPkgIdByFilePath(filePath: string) {\n  return filePath.split(\"/\").slice(0, 2).join(\"/\");\n}\n","/**\n * Get site's base path, generally will be `/next/` or `/`.\n */\nexport function getBasePath(): string {\n  const base = document.querySelector(\"base\");\n  const basePath = base ? (base.getAttribute(\"href\") as string) : \"/\";\n  return basePath;\n}\n","import type { RuntimeStoryboard } from \"@next-core/types\";\nimport { orderBy } from \"lodash\";\nimport { getRuntime } from \"./Runtime.js\";\n\nexport function matchStoryboard(\n  storyboards: RuntimeStoryboard[],\n  pathname: string\n): RuntimeStoryboard | undefined {\n  // Put apps with longer homepage before shorter ones.\n  // E.g., `/legacy/tool` will match first before `/legacy`.\n  // This enables two apps with relationship of parent-child of homepage.\n  const sortedStoryboards = orderBy(\n    storyboards,\n    (storyboard) => storyboard.app.homepage?.length ?? 0,\n    \"desc\"\n  );\n  for (const storyboard of sortedStoryboards) {\n    const homepage = storyboard.app.homepage;\n    if (typeof homepage === \"string\" && homepage[0] === \"/\") {\n      if (matchHomepage(homepage, pathname)) {\n        return storyboard;\n      }\n    }\n  }\n}\n\nexport function matchHomepage(homepage: string, pathname: string) {\n  return homepage === \"/\"\n    ? pathname === homepage\n    : `${pathname.replace(/\\/+$/, \"\")}/`.startsWith(\n        `${homepage.replace(/\\/+$/, \"\")}/`\n      );\n}\n\n// istanbul ignore next\n/**\n * We say it's an outside app when at least one of the below conditions are true:\n *   - target app is not found.\n *   - target app is not the current app.\n *   - current app is non-standalone mode and target app is standalone mode.\n *\n * Note: when current app is standalone mode, other apps will not be found.\n */\nexport function isOutsideApp(\n  storyboard: RuntimeStoryboard | undefined\n): boolean | undefined {\n  if (process.env.NODE_ENV === \"test\") {\n    return false;\n  }\n  return (\n    !storyboard ||\n    // Sometimes `storyboard.app.standaloneMode` is incorrect.\n    (getRuntime().getCurrentApp()?.id !== storyboard.app.id &&\n      !window.STANDALONE_MICRO_APPS &&\n      storyboard.app.standaloneMode)\n  );\n}\n","import {\n  History,\n  LocationDescriptor,\n  LocationDescriptorObject,\n  parsePath,\n} from \"history\";\nimport { getBasePath } from \"../getBasePath.js\";\nimport { _internalApiMatchStoryboard } from \"./Runtime.js\";\nimport { isOutsideApp } from \"./matchStoryboard.js\";\n\nlet blocked = false;\nexport function getUserConfirmation(\n  message: string,\n  callback: (result: boolean) => void\n): void {\n  blocked = !confirm(message);\n  callback(!blocked);\n}\n\nexport function historyExtended(\n  browserHistory: History<NextHistoryState>\n): ExtendedHistory {\n  const { push: originalPush, replace: originalReplace } = browserHistory;\n\n  function push(\n    location: LocationDescriptor<NextHistoryState>,\n    state?: NextHistoryState,\n    callback?: (blocked: boolean) => void\n  ): void {\n    blocked = false;\n    originalPush(location, state);\n    callback?.(blocked);\n  }\n\n  function replace(\n    location: LocationDescriptor<NextHistoryState>,\n    state?: NextHistoryState,\n    callback?: (blocked: boolean) => void\n  ): void {\n    blocked = false;\n    originalReplace(location, state);\n    callback?.(blocked);\n  }\n\n  function updateQueryFactory(method: \"push\" | \"replace\"): UpdateQueryFunction {\n    return function updateQuery(query, options = {}, callback?): void {\n      const { extraQuery, clear, keepHash, ...state } = options;\n      const urlSearchParams = new URLSearchParams(\n        clear ? \"\" : browserHistory.location.search\n      );\n      const params: Record<string, string | string[]> = {};\n      Object.assign(params, query, extraQuery);\n      for (const [key, value] of Object.entries(params)) {\n        if (Array.isArray(value)) {\n          urlSearchParams.delete(key);\n          for (const item of value) {\n            urlSearchParams.append(key, item);\n          }\n        } else if (value === undefined || value === null || value === \"\") {\n          urlSearchParams.delete(key);\n        } else {\n          urlSearchParams.set(key, value);\n        }\n      }\n      (method === \"push\" ? push : replace)(\n        `?${urlSearchParams.toString()}${\n          keepHash ? browserHistory.location.hash : \"\"\n        }`,\n        state,\n        callback\n      );\n    };\n  }\n\n  function pushAnchor(\n    hash: string,\n    state?: NextHistoryState,\n    callback?: (blocked: boolean) => void\n  ): void {\n    push(\n      {\n        ...browserHistory.location,\n        key: undefined,\n        hash,\n        state: {\n          // The default notify is false\n          notify: false,\n          ...state,\n        },\n      },\n      undefined,\n      callback\n    );\n  }\n\n  function reload(callback?: (blocked: boolean) => void): void {\n    replace(\n      {\n        ...browserHistory.location,\n        state: {\n          ...browserHistory.location.state,\n          // Always notify\n          notify: true,\n          // Do not use incremental sub routes\n          noIncremental: true,\n        },\n      },\n      undefined,\n      callback\n    );\n  }\n\n  let blockMessage: string | undefined;\n\n  function setBlockMessage(message: string | undefined): void {\n    blockMessage = message;\n  }\n\n  function getBlockMessage(): string | undefined {\n    return blockMessage;\n  }\n\n  function unblock(): void {\n    blockMessage = undefined;\n  }\n\n  return {\n    pushQuery: updateQueryFactory(\"push\"),\n    replaceQuery: updateQueryFactory(\"replace\"),\n    pushAnchor: pushAnchor,\n    reload,\n    setBlockMessage,\n    getBlockMessage,\n    unblock,\n    ...historyOverridden({ ...browserHistory, push, replace }),\n  };\n}\n\n/**\n * Override history for standalone micro apps.\n *\n * when `push` or `replace` to other apps, force page refresh.\n */\nfunction historyOverridden(\n  browserHistory: History<NextHistoryState> &\n    Pick<ExtendedHistory, \"push\" | \"replace\">\n): Pick<ExtendedHistory, \"push\" | \"replace\"> {\n  const { push: originalPush, replace: originalReplace } = browserHistory;\n  function updateFactory(method: \"push\" | \"replace\"): ExtendedHistory[\"push\"] {\n    return function update(path, state?, callback?) {\n      let pathname: string | undefined;\n      const pathIsString = typeof path === \"string\";\n      if (pathIsString) {\n        pathname = parsePath(path).pathname;\n      } else {\n        pathname = path.pathname;\n      }\n\n      // When history.push or history.replace is performing with an absolute pathname,\n      // force load the target page when it is a page of an outside app.\n      if (\n        typeof pathname === \"string\" &&\n        pathname.startsWith(\"/\") &&\n        isOutsideApp(_internalApiMatchStoryboard(pathname))\n      ) {\n        // Going to outside apps.\n        return location[method === \"push\" ? \"assign\" : \"replace\"](\n          pathIsString\n            ? getBasePath() + path.substring(1)\n            : browserHistory.createHref(\n                path as LocationDescriptorObject<NextHistoryState>\n              )\n        );\n      }\n\n      return (method === \"push\" ? originalPush : originalReplace)(\n        path as string,\n        state,\n        callback\n      );\n    };\n  }\n  return {\n    push: updateFactory(\"push\"),\n    replace: updateFactory(\"replace\"),\n  };\n}\n\nexport interface NextHistoryState {\n  notify?: boolean;\n  from?: LocationDescriptor<NextHistoryState>;\n  noIncremental?: boolean;\n}\n\n/**\n * 扩展的系统会话对象。\n */\nexport interface ExtendedHistory {\n  /**\n   * 更新指定的 query 参数，会保留当前其它 query 参数，往浏览器会话历史栈中推入一条新记录。\n   */\n  pushQuery: UpdateQueryFunction;\n\n  /**\n   * 更新指定的 query 参数，会保留当前其它 query 参数，替换浏览器会话历史栈中最新的一条记录。\n   */\n  replaceQuery: UpdateQueryFunction;\n\n  /** {@inheritDoc UpdateAnchorFunction} */\n  pushAnchor: UpdateAnchorFunction;\n\n  /** 重载当前会话，即触发页面重新渲染。与 location.reload() 不同，它不会触发浏览器页面的重载。 */\n  reload: (callback?: (blocked: boolean) => void) => void;\n\n  /** @internal */\n  setBlockMessage: (message: string | undefined) => void;\n\n  /** @internal */\n  getBlockMessage: () => string | undefined;\n\n  /** 取消之前设置的阻止页面离开信息的设置。 */\n  unblock: () => void;\n\n  /** 推入一条记录。*/\n  push: (\n    location: LocationDescriptor<NextHistoryState>,\n    state?: NextHistoryState,\n    callback?: (blocked: boolean) => void\n  ) => void;\n\n  /** 替换一条记录。*/\n  replace: (\n    location: LocationDescriptor<NextHistoryState>,\n    state?: NextHistoryState,\n    callback?: (blocked: boolean) => void\n  ) => void;\n}\n\n/**\n * 更新指定的 query 参数。\n *\n * @param query - 要更新的 query 参数。\n * @param options - 选项。\n */\nexport type UpdateQueryFunction = (\n  query: Record<string, unknown>,\n  options?: UpdateQueryOptions,\n  callback?: (blocked: boolean) => void\n) => void;\n\n/** 更新 query 参数时的选项 */\nexport interface UpdateQueryOptions extends NextHistoryState {\n  /** 额外要更新的 query 参数。 */\n  extraQuery?: Record<string, unknown>;\n  /** 是否同时清除当前的所有其它 query 参数。 */\n  clear?: boolean;\n  /** 是否保留当前 hash 参数。 */\n  keepHash?: boolean;\n}\n\n/**\n * 设置指定的 anchor （URL hash）地址，此方法默认不会触发页面重新渲染。\n * 往浏览器会话历史栈中推入一条新记录。\n *\n * @param hash - Hash 地址。\n * @param state - 会话状态设置。\n */\nexport type UpdateAnchorFunction = (\n  hash: string,\n  state?: NextHistoryState,\n  callback?: (blocked: boolean) => void\n) => void;\n","import { History, Location, createBrowserHistory } from \"history\";\nimport { getBasePath } from \"./getBasePath.js\";\nimport {\n  type ExtendedHistory,\n  getUserConfirmation,\n  historyExtended,\n  NextHistoryState,\n} from \"./internal/historyExtended.js\";\nimport { getV2RuntimeFromDll } from \"./getV2RuntimeFromDll.js\";\n\nexport type NextHistory = History<NextHistoryState> & ExtendedHistory;\n\nlet history: NextHistory;\n\nexport function createHistory(): NextHistory {\n  if (!history) {\n    // https://github.com/remix-run/history/issues/810\n    const browserHistory = createBrowserHistory<NextHistoryState>({\n      basename: getBasePath().replace(/\\/$/, \"\"),\n      getUserConfirmation,\n    });\n    Object.assign(browserHistory, historyExtended(browserHistory));\n    history = browserHistory as NextHistory;\n  }\n  return history;\n}\n\nfunction getHistoryV3(): NextHistory {\n  return history;\n}\n\n/**\n * When using v3 bricks in v2 container, return history from v2 container.\n */\nfunction getHistoryV2Factory() {\n  const v2Kit = getV2RuntimeFromDll();\n  if (v2Kit) {\n    return v2Kit.getHistory;\n  }\n}\n\nexport const getHistory = getHistoryV2Factory() || getHistoryV3;\n\nexport type NextLocation = Location<NextHistoryState>;\n\nexport type { NextHistoryState };\n","import type {\n  RuntimeStoryboard,\n  BootstrapSettings,\n  FeatureFlags,\n  BootstrapData,\n  Contract,\n  Storyboard,\n  BrickConf,\n  RouteConf,\n  ResolveConf,\n  BrickPackage,\n} from \"@next-core/types\";\nimport { i18n, initializeI18n } from \"@next-core/i18n\";\nimport { loadBricksImperatively } from \"@next-core/loader\";\nimport { deepFreeze, isObject } from \"@next-core/utils/general\";\nimport type { PermissionApi_validatePermissions } from \"@next-api-sdk/micro-app-sdk\";\nimport moment from \"moment\";\nimport \"moment/locale/zh-cn.js\";\nimport { createHistory } from \"../history.js\";\nimport { matchStoryboard } from \"./matchStoryboard.js\";\nimport { Router } from \"./Router.js\";\nimport { NS, locales } from \"./i18n.js\";\nimport { loadNotificationService } from \"../Notification.js\";\nimport { loadDialogService } from \"../Dialog.js\";\nimport { injectedBrickPackages } from \"./injected.js\";\nimport { type AppForCheck, hasInstalledApp } from \"./hasInstalledApp.js\";\nimport type { RuntimeContext } from \"./interfaces.js\";\nimport { listenDevtoolsEagerly } from \"./devtools.js\";\nimport { getV2RuntimeFromDll } from \"../getV2RuntimeFromDll.js\";\nimport { ThemeSettings, customizeColorTheme } from \"./customizeColorTheme.js\";\n\nlet runtime: Runtime;\n\n// Allow inject bootstrap data in a runtime other than Brick Next.\nlet bootstrapData: BootstrapData | undefined;\nlet router: Router | undefined;\nlet processedBrickPackages: BrickPackage[] | undefined;\n\nexport interface RuntimeOptions {\n  hooks?: RuntimeHooks;\n}\n\nexport interface ImagesFactory {\n  get(name: string): string;\n}\n\nexport interface PageViewInfo {\n  status: \"ok\" | \"failed\" | \"redirected\" | \"not-found\";\n  path?: string;\n  pageTitle?: string;\n}\n\nexport interface RuntimeHooks {\n  auth?: {\n    getAuth(): object;\n    isLoggedIn(): boolean;\n    authenticate?(...args: unknown[]): unknown;\n    logout?(...args: unknown[]): unknown;\n  };\n  fulfilStoryboard?: (storyboard: RuntimeStoryboard) => Promise<void>;\n  validatePermissions?: typeof PermissionApi_validatePermissions;\n  checkPermissions?: {\n    checkPermissions(...actions: string[]): boolean;\n    preCheckPermissions(storyboard: Storyboard): Promise<void> | undefined;\n    preCheckPermissionsForBrickOrRoute(\n      container: BrickConf | RouteConf,\n      asyncComputeRealValue: (value: unknown) => Promise<unknown>\n    ): Promise<void> | undefined;\n  };\n  checkInstalledApps?: {\n    preCheckInstalledApps(\n      storyboard: Storyboard,\n      hasAppInBootstrap: (appId: string) => boolean\n    ): void;\n    waitForCheckingApps(appIds: string[]): Promise<void>;\n    getCheckedApp(appId: string): AppForCheck | undefined;\n  };\n  flowApi?: {\n    FLOW_API_PROVIDER: string;\n    registerFlowApiProvider(): void;\n    isFlowApiProvider(provider: string): boolean;\n    getArgsOfFlowApi(\n      provider: string,\n      originalArgs: unknown[],\n      method?: string,\n      stream?: boolean\n    ): Promise<unknown[]>;\n    collectContract(contracts: Contract[] | undefined): void;\n    collectWidgetContract(contracts: Contract[] | undefined): void;\n    clearCollectWidgetContract(): void;\n  };\n  menu?: {\n    getMenuById(menuId: string): unknown;\n    fetchMenuById(\n      menuId: string,\n      runtimeContext: RuntimeContext,\n      runtimeHelpers: RuntimeHooksMenuHelpers\n    ): Promise<unknown>;\n  };\n  images?: {\n    imagesFactory(\n      appId: string,\n      isBuildPush?: boolean,\n      version?: string\n    ): ImagesFactory;\n    widgetImagesFactory(\n      widgetId: string,\n      widgetVersion?: string\n    ): ImagesFactory;\n  };\n  messageDispatcher?: {\n    subscribe(...args: unknown[]): Promise<unknown>;\n    unsubscribe(...args: unknown[]): Promise<unknown>;\n    onMessage(channel: string, listener: (data: unknown) => void): void;\n    onClose(listener: () => void): void;\n    reset(): void;\n  };\n  pageView?: {\n    create(): (info: PageViewInfo) => void;\n  };\n}\n\nexport interface RuntimeHooksMenuHelpers {\n  getStoryboardByAppId(appId: string): Storyboard | undefined;\n  resolveData(\n    resolveConf: ResolveConf,\n    runtimeContext: RuntimeContext\n  ): Promise<unknown>;\n  asyncComputeRealValue(\n    value: unknown,\n    runtimeContext: RuntimeContext,\n    options?: { ignoreSymbols?: boolean; noInject?: boolean }\n  ): Promise<unknown>;\n}\n\nexport let hooks: RuntimeHooks | undefined;\n\nexport function createRuntime(options?: RuntimeOptions) {\n  if (runtime) {\n    throw new Error(\"Cannot create multiple runtimes\");\n  }\n  listenDevtoolsEagerly();\n  hooks = options?.hooks;\n  initializeI18n(NS, locales);\n  moment.locale(i18n.language);\n  i18n.on(\"languageChanged\", () => {\n    moment.locale(i18n.language);\n  });\n  createHistory();\n  runtime = new Runtime();\n  return runtime;\n}\n\nfunction getRuntimeV3() {\n  return runtime;\n}\n\n// istanbul ignore next\nfunction getRuntimeV2Factory() {\n  const v2Kit = getV2RuntimeFromDll();\n  if (v2Kit) {\n    return function getRuntimeV2() {\n      return new Proxy(v2Kit.getRuntime(), {\n        get(...args) {\n          const key = args[1];\n          switch (key) {\n            case \"getCurrentApp\":\n            case \"getRecentApps\":\n            case \"hasInstalledApp\":\n            case \"getDesktops\":\n            case \"getLaunchpadSettings\":\n            case \"getLaunchpadSiteMap\":\n            case \"toggleLaunchpadEffect\":\n            case \"applyPageTitle\":\n            case \"getNavConfig\":\n            case \"getFeatureFlags\":\n            case \"getMiscSettings\":\n            case \"getBrandSettings\":\n              return Reflect.get(...args);\n          }\n        },\n      }) as unknown as Runtime;\n    };\n  }\n}\n\n// istanbul ignore next\nexport const getRuntime = getRuntimeV2Factory() || getRuntimeV3;\n\nexport class Runtime {\n  #initialized = false;\n  #bootstrapped = false;\n\n  readonly version: number | undefined = 3;\n\n  initialize(data: BootstrapData) {\n    if (this.#initialized) {\n      throw new Error(\"The runtime cannot be initialized more than once\");\n    }\n    this.#initialized = true;\n    normalizeBootstrapData(data);\n    bootstrapData = data;\n    const { notification, dialog } = _internalApiGetPresetBricks();\n    if (notification !== false) {\n      loadNotificationService(\n        notification ?? \"basic.show-notification\",\n        this.loadBricks\n      );\n    }\n    if (dialog !== false) {\n      loadDialogService(dialog ?? \"basic.show-dialog\", this.loadBricks);\n    }\n    customizeColorTheme(data.settings?.misc?.theme as ThemeSettings);\n  }\n\n  async bootstrap(data?: BootstrapData) {\n    if (data) {\n      this.initialize(data);\n    }\n    if (this.#bootstrapped) {\n      throw new Error(\"The runtime cannot be bootstrapped more than once\");\n    }\n    this.#bootstrapped = true;\n    router = new Router(bootstrapData!.storyboards!);\n    await router.bootstrap();\n  }\n\n  getRecentApps() {\n    return router?.getRecentApps() ?? {};\n  }\n\n  getCurrentApp() {\n    return router?.getRecentApps().currentApp;\n  }\n\n  hasInstalledApp(appId: string, matchVersion?: string): boolean {\n    return hasInstalledApp(appId, matchVersion);\n  }\n\n  getFeatureFlags(): FeatureFlags {\n    return {\n      ...bootstrapData?.settings?.featureFlags,\n      ...(\n        router?.getRecentApps().currentApp?.config\n          ?.settings as BootstrapSettings\n      )?.featureFlags,\n      \"migrate-to-brick-next-v3\": true,\n    };\n  }\n\n  getMiscSettings() {\n    return {\n      ...bootstrapData?.settings?.misc,\n      ...(\n        router?.getRecentApps().currentApp?.config\n          ?.settings as BootstrapSettings\n      )?.misc,\n    };\n  }\n\n  getBrandSettings(): Record<string, string> {\n    return {\n      base_title: \"DevOps 管理专家\",\n      ...(bootstrapData?.settings?.brand as Record<string, string>),\n    };\n  }\n\n  getLaunchpadSettings() {\n    return {\n      columns: 7,\n      rows: 4,\n      ...bootstrapData?.settings?.launchpad,\n    };\n  }\n\n  getDesktops(): unknown[] {\n    return bootstrapData?.desktops ?? [];\n  }\n\n  getLaunchpadSiteMap(): unknown[] {\n    return bootstrapData?.siteSort ?? [];\n  }\n\n  toggleLaunchpadEffect(open: boolean): void {\n    document.body.classList.toggle(\"launchpad-open\", open);\n  }\n\n  applyPageTitle(pageTitle: string): void {\n    const baseTitle = this.getBrandSettings().base_title;\n\n    document.title =\n      (router?.getRecentApps().currentApp?.localeTitle as string) ||\n      (pageTitle ? `${pageTitle} - ${baseTitle}` : baseTitle);\n  }\n\n  getNavConfig() {\n    return router?.getNavConfig();\n  }\n\n  loadBricks(bricks: string[] | Set<string>) {\n    return loadBricksImperatively(bricks, getBrickPackages());\n  }\n}\n\nfunction normalizeBootstrapData(data: BootstrapData) {\n  if (isObject(data.settings)) {\n    deepFreeze(data.settings);\n  }\n  if (data.brickPackages) {\n    deepFreeze(data.brickPackages);\n  }\n}\n\nfunction processPublicDepsPackages(\n  brickPackages: BrickPackage[],\n  pubDeps: BrickPackage[] | undefined\n): BrickPackage[] {\n  if (!pubDeps?.length) return brickPackages;\n\n  const bricksMap = new Map();\n\n  // bootstrapData 数据和 pubDeps 中可能同时存在同一个包名，需要过滤去重， 以 pubDeps 中的包为准\n  [...pubDeps, ...brickPackages].forEach((pkg) => {\n    const pkgName = pkg.filePath.split(\"/\")[1];\n    // 始终将 pubDeps 放在前面\n    if (!bricksMap.has(pkgName)) {\n      bricksMap.set(pkgName, pkg);\n    }\n  });\n\n  return Array.from(bricksMap.values());\n}\n\nexport function getBrickPackages(): BrickPackage[] {\n  return (\n    // Not necessary to process brick packages multiple times.\n    processedBrickPackages ??\n    (processedBrickPackages = processPublicDepsPackages(\n      bootstrapData?.brickPackages ??\n        injectedBrickPackages ??\n        (window.STANDALONE_BRICK_PACKAGES as BrickPackage[] | undefined) ??\n        [],\n      window.PUBLIC_DEPS as BrickPackage[] | undefined\n    ))\n  );\n}\n\nexport function _internalApiGetPresetBricks() {\n  return (bootstrapData?.settings?.presetBricks ?? {}) as {\n    notification?: string | false;\n    dialog?: string | false;\n    error?: string | false;\n  };\n}\n\nexport function _internalApiGetRenderId(): string | undefined {\n  return router?.getRenderId();\n}\n\nexport function _internalApiMatchStoryboard(\n  pathname: string\n): RuntimeStoryboard | undefined {\n  return matchStoryboard(bootstrapData?.storyboards ?? [], pathname);\n}\n\nexport function _internalApiGetRuntimeContext() {\n  return router?.getRuntimeContext();\n}\n\nexport function _internalApiGetStoryboardInBootstrapData(appId: string) {\n  return bootstrapData?.storyboards?.find(\n    (storyboard) => storyboard.app.id === appId\n  );\n}\n\nexport function _internalApiGetAppInBootstrapData(appId: string) {\n  return _internalApiGetStoryboardInBootstrapData(appId)?.app;\n}\n\nexport let _test_only_setBootstrapData: (data: BootstrapData) => void;\n\n// istanbul ignore next\nif (process.env.NODE_ENV === \"test\") {\n  _test_only_setBootstrapData = (data) => {\n    bootstrapData = data as BootstrapData;\n  };\n}\n","import type {\n  CustomTemplateConstructor,\n  MetaI18n,\n  StoryboardFunction,\n} from \"@next-core/types\";\nimport type { NextHistory } from \"./history.js\";\nimport type { IfContainer } from \"./internal/compute/checkIf.js\";\n\ninterface DLL {\n  (moduleId: \"tYg3\"): Kit;\n}\n\ninterface Kit {\n  getRuntime(): {\n    registerCustomTemplate(\n      tagName: string,\n      constructor: CustomTemplateConstructor\n    ): void;\n    registerCustomProcessor(\n      processorFullName: string,\n      processorFunc: Function\n    ): void;\n    registerWidgetFunctions(\n      widgetId: string,\n      functions: StoryboardFunction[],\n      widgetVersion?: string\n    ): void;\n    registerWidgetI18n(widgetId: string, i18nData: MetaI18n): void;\n  };\n  getHistory(): NextHistory;\n  looseCheckIfByTransform(ifContainer: IfContainer, data: unknown): boolean;\n  SingleBrickAsComponentFactory: any;\n  BrickAsComponentFactory: any;\n  authenticate: any;\n  getAuth: any;\n  isLoggedIn: any;\n  logout: any;\n}\n\nexport function getV2RuntimeFromDll() {\n  const { dll } = window as { dll?: DLL };\n  if (\n    dll &&\n    window.BRICK_NEXT_VERSIONS?.[\"brick-container\"]?.startsWith(\"2.\")\n  ) {\n    return dll(\"tYg3\");\n  }\n}\n","import { getV2RuntimeFromDll } from \"./getV2RuntimeFromDll.js\";\n\nclass CustomProcessorRegistry {\n  readonly #registry = new Map<string, Map<string, Function>>();\n\n  define(processorFullName: string, processorFunc: Function) {\n    // `namespace` should be the camelCase of the package name.\n    const [namespace, processorName] = processorFullName.split(\".\");\n    let pkg = this.#registry.get(namespace);\n    if (!pkg) {\n      pkg = new Map();\n      this.#registry.set(namespace, pkg);\n    }\n    if (pkg.has(processorName)) {\n      // eslint-disable-next-line no-console\n      throw new Error(\n        `Custom processor of \"${processorFullName}\" already registered`\n      );\n    }\n    pkg.set(processorName, processorFunc);\n  }\n\n  get(namespace: string) {\n    return this.#registry.get(namespace);\n  }\n}\n\n// istanbul ignore next\nfunction getCustomProcessorsV2() {\n  const v2Kit = getV2RuntimeFromDll();\n  if (v2Kit) {\n    return Object.freeze({\n      define(processorFullName: string, processorFunc: Function) {\n        return v2Kit\n          .getRuntime()\n          .registerCustomProcessor(processorFullName, processorFunc);\n      },\n    }) as CustomProcessorRegistry;\n  }\n}\n\n// istanbul ignore next\nexport const customProcessors =\n  getCustomProcessorsV2() || new CustomProcessorRegistry();\n","import { i18n } from \"@next-core/i18n\";\nimport { Storyboard } from \"@next-core/types\";\n\nexport function registerAppI18n({ app, meta }: Storyboard) {\n  if (meta?.i18n) {\n    // Prefix to avoid conflict between brick package's i18n namespace.\n    const i18nNamespace = getI18nNamespace(\"app\", app.id);\n    // Support any language in `meta.i18n`.\n    const languages: string[] = [];\n    Object.entries(meta.i18n).forEach(([lang, resources]) => {\n      i18n.addResourceBundle(lang, i18nNamespace, resources);\n      languages.push(lang);\n    });\n    return () => {\n      for (const lang of languages) {\n        i18n.removeResourceBundle(lang, i18nNamespace);\n      }\n    };\n  }\n}\n\nexport function getI18nNamespace(\n  type: \"app\" | \"widget\" | \"menu\",\n  id: string\n): string {\n  return `${type}/${id}`;\n}\n","import { i18n } from \"@next-core/i18n\";\nimport type { MetaI18n } from \"@next-core/types\";\nimport { getI18nNamespace } from \"../registerAppI18n.js\";\nimport { getV2RuntimeFromDll } from \"../../getV2RuntimeFromDll.js\";\n\nfunction registerWidgetI18nV3(widgetId: string, i18nData: MetaI18n): void {\n  const ns = getI18nNamespace(\"widget\", widgetId);\n  Object.entries(i18nData).forEach(([lang, resources]) => {\n    i18n.addResourceBundle(lang, ns, resources);\n  });\n}\n\nexport function widgetI18nFactory(widgetId: string) {\n  return i18n.getFixedT(null, getI18nNamespace(\"widget\", widgetId));\n}\n\n// istanbul ignore next\nfunction registerWidgetI18nV2Factory() {\n  const v2Kit = getV2RuntimeFromDll();\n  if (v2Kit) {\n    return function (widgetId: string, i18nData: MetaI18n) {\n      return v2Kit.getRuntime().registerWidgetI18n(widgetId, i18nData);\n    };\n  }\n}\n\n// istanbul ignore next\nexport const registerWidgetI18n =\n  registerWidgetI18nV2Factory() || registerWidgetI18nV3;\n","export const MESSAGE_SOURCE_PANEL = \"brick-next-devtools-panel\";\nexport const FRAME_ACTIVE_CHANGE = \"devtools-frame-active-change\";\nexport const PANEL_CHANGE = \"devtools-panel-change\";\n\ninterface DevtoolsHookContainer {\n  __BRICK_NEXT_DEVTOOLS_HOOK__?: DevtoolsHook;\n}\n\ninterface DevtoolsHook {\n  emit: (message: unknown) => void;\n}\n\ntype DevtoolsMessagePayload = FrameActiveChangePayload | PanelChangePayload;\n\ninterface FrameActiveChangePayload {\n  type: typeof FRAME_ACTIVE_CHANGE;\n  active: boolean;\n  panel: PanelType;\n}\n\ntype PanelType = \"Bricks\" | \"Evaluations\" | \"Transformations\";\n\ninterface PanelChangePayload {\n  type: typeof PANEL_CHANGE;\n  panel: PanelType;\n}\n\nlet frameIsActive = true;\nlet selectedPanel: PanelType;\n\nexport function devtoolsHookEmit(type: string, payload?: unknown): void {\n  const devtools = getDevHook();\n  if (\n    !devtools ||\n    (type === \"evaluation\" &&\n      !(frameIsActive && (!selectedPanel || selectedPanel === \"Evaluations\")))\n  ) {\n    // Ignore messages if current devtools panel is not relevant.\n    return;\n  }\n\n  const emit = (): void => {\n    devtools.emit?.({\n      type,\n      payload,\n    });\n  };\n\n  // Try to emit only in idle time.\n  // istanbul ignore next\n  if (typeof window.requestIdleCallback === \"function\") {\n    window.requestIdleCallback(emit);\n  } else {\n    setTimeout(emit, 0);\n  }\n}\n\nexport function listenDevtoolsEagerly(): void {\n  window.addEventListener(\"message\", ({ data }: MessageEvent): void => {\n    if (data?.source !== MESSAGE_SOURCE_PANEL) {\n      return;\n    }\n    const payload: DevtoolsMessagePayload = data.payload;\n    switch (payload?.type) {\n      case FRAME_ACTIVE_CHANGE: {\n        frameIsActive = payload.active;\n        break;\n      }\n      case PANEL_CHANGE: {\n        selectedPanel = payload.panel;\n        break;\n      }\n    }\n  });\n}\n\nexport function getDevHook(): DevtoolsHook | undefined {\n  return (window as DevtoolsHookContainer).__BRICK_NEXT_DEVTOOLS_HOOK__;\n}\n","import { getDevHook } from \"./devtools.js\";\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst THROW = (): any => {\n  throw new Error(\"Can't modify read-only proxy object\");\n};\n\nconst readOnlyHandler: ProxyHandler<object> = {\n  set: THROW,\n  defineProperty: THROW,\n  deleteProperty: THROW,\n  setPrototypeOf: THROW,\n};\n\nexport function getReadOnlyProxy<T extends object>(object: T): T {\n  return new Proxy<T>(object, readOnlyHandler);\n}\n\n// First, we want to make accessing property of globals lazy,\n// So we use *Proxy* to make a dynamic accessor for each of these globals.\n// But we also want to keep them working in devtools.\nexport function getDynamicReadOnlyProxy({\n  get,\n  ownKeys,\n}: Required<Pick<ProxyHandler<object>, \"get\" | \"ownKeys\">>): unknown {\n  if (getDevHook()) {\n    // In devtools, we extract them at beginning.\n    const target = Object.fromEntries(\n      (ownKeys(null!) as string[]).map((key) => [key, get(null!, key, null)])\n    );\n    return getReadOnlyProxy(target);\n  }\n  return new Proxy(Object.freeze({}), { get });\n}\n","import type { SiteMode, SiteTheme } from \"@next-core/types\";\nimport { JsonStorage } from \"@next-core/utils/general\";\n\ninterface AppThemes {\n  [appId: string]: SiteTheme;\n}\n\n// Themes.\nlet theme: SiteTheme = \"light\";\nconst storage = new JsonStorage<Record<string, AppThemes>>(localStorage);\nconst LOCAL_STORAGE_APPS_THEME_KEY = \"apps-theme\";\n\nexport function setTheme(value: SiteTheme): void {\n  if (value !== \"dark\" && value !== \"light\" && value !== \"dark-v2\") {\n    throw new Error(`Unsupported theme: ${value}`);\n  }\n  theme = value;\n}\n\nexport function getTheme(): SiteTheme {\n  return theme;\n}\n\nexport function getCurrentTheme(): SiteTheme {\n  return document.documentElement.dataset.theme as SiteTheme;\n}\n\nexport function applyTheme(value?: SiteTheme): void {\n  if (value) {\n    setTheme(value);\n  } else {\n    value = getTheme();\n  }\n  if (value !== getCurrentTheme()) {\n    document.documentElement.dataset.theme = value;\n    window.dispatchEvent(\n      new CustomEvent<SiteTheme>(\"theme.change\", {\n        detail: value,\n      })\n    );\n  }\n}\n\nexport function batchSetAppsLocalTheme(appsTheme: AppThemes): void {\n  storage.setItem(LOCAL_STORAGE_APPS_THEME_KEY, {\n    ...getLocalAppsTheme(),\n    ...appsTheme,\n  });\n}\n\nexport function getLocalAppsTheme(): AppThemes {\n  let result: AppThemes | undefined;\n  try {\n    result = storage.getItem(LOCAL_STORAGE_APPS_THEME_KEY);\n  } catch {\n    // eslint-disable-next-line no-console\n    console.error(\"JSON parse error inside `getLocalAppsTheme()`\");\n  }\n\n  return result ?? {};\n}\n\n// Modes.\nlet mode: SiteMode = \"default\";\n\nexport function setMode(value: SiteMode): void {\n  if (value !== \"dashboard\" && value !== \"default\") {\n    throw new Error(`Unsupported mode: ${value}`);\n  }\n  mode = value;\n}\n\nexport function getMode(): SiteMode {\n  return mode;\n}\n\nexport function getCurrentMode(): SiteMode {\n  return document.documentElement.dataset.mode as SiteMode;\n}\n\nexport function applyMode(value?: SiteMode): void {\n  if (value) {\n    setMode(value);\n  } else {\n    value = getMode();\n  }\n  if (value !== getCurrentMode()) {\n    document.documentElement.dataset.mode = value;\n    window.dispatchEvent(\n      new CustomEvent<SiteMode>(\"mode.change\", {\n        detail: value,\n      })\n    );\n  }\n}\n\nexport function getCssPropertyValue(\n  name: string,\n  el = document.documentElement\n): string {\n  if (!el) return \"\";\n  return window.getComputedStyle(el)?.getPropertyValue(name) || \"\";\n}\n","import { identity } from \"lodash\";\nimport type { MicroApp } from \"@next-core/types\";\nimport { i18n, i18nText } from \"@next-core/i18n\";\nimport { widgetI18nFactory } from \"./WidgetI18n.js\";\nimport { getReadOnlyProxy } from \"../proxyFactories.js\";\nimport { getCssPropertyValue, getTheme } from \"../../themeAndMode.js\";\nimport { getBasePath } from \"../../getBasePath.js\";\nimport { getI18nNamespace } from \"../registerAppI18n.js\";\nimport { ImagesFactory, hooks } from \"../Runtime.js\";\n\nexport interface GeneralGlobalsOptions {\n  collectCoverage?: unknown;\n  widgetId?: string;\n  widgetVersion?: string;\n  app?: PartialMicroApp;\n  appendI18nNamespace?: string;\n  storyboardFunctions?: unknown;\n  isStoryboardFunction?: boolean;\n}\n\nexport type PartialMicroApp = Pick<MicroApp, \"id\" | \"isBuildPush\">;\n\n// `GeneralGlobals` are globals which are page-state-agnostic,\n// thus they can be used both in storyboard expressions and functions.\nexport function getGeneralGlobals(\n  attemptToVisitGlobals: Set<string>,\n  options: GeneralGlobalsOptions\n): Record<string, unknown> {\n  const globalVariables: Record<string, unknown> = {};\n  for (const variableName of attemptToVisitGlobals) {\n    const variable = getIndividualGlobal(variableName, options);\n    if (variable !== undefined) {\n      globalVariables[variableName] = variable;\n    }\n  }\n  return globalVariables;\n}\n\nfunction getIndividualGlobal(\n  variableName: string,\n  {\n    collectCoverage,\n    widgetId,\n    widgetVersion,\n    app,\n    appendI18nNamespace,\n    storyboardFunctions,\n    isStoryboardFunction,\n  }: GeneralGlobalsOptions\n): unknown {\n  switch (variableName) {\n    case \"BASE_URL\":\n      return collectCoverage ? \"/next\" : getBasePath().replace(/\\/$/, \"\");\n    case \"FN\":\n      return storyboardFunctions;\n    case \"IMG\":\n      return collectCoverage\n        ? fakeImageFactory()\n        : widgetId\n          ? hooks?.images?.widgetImagesFactory(widgetId, widgetVersion)\n          : hooks?.images?.imagesFactory(\n              app!.id,\n              app!.isBuildPush,\n              (app as { currentVersion?: string }).currentVersion\n            );\n    case \"I18N\":\n      return collectCoverage\n        ? identity\n        : widgetId\n          ? widgetI18nFactory(widgetId)\n          : i18n.getFixedT(\n              null,\n              [appendI18nNamespace, getI18nNamespace(\"app\", app!.id)].filter(\n                Boolean\n              ) as string[]\n            );\n    case \"I18N_TEXT\":\n      return collectCoverage ? fakeI18nText : i18nText;\n    case \"PERMISSIONS\":\n      return getReadOnlyProxy({\n        check: collectCoverage\n          ? fakeCheckPermissions\n          : hooks?.checkPermissions?.checkPermissions,\n      });\n    case \"THEME\":\n      return getReadOnlyProxy({\n        getTheme: collectCoverage ? () => \"light\" : getTheme,\n        getCssPropertyValue: collectCoverage ? () => \"\" : getCssPropertyValue,\n      });\n    case \"console\":\n      return isStoryboardFunction ? getReadOnlyProxy(console) : undefined;\n    case \"location\":\n      return collectCoverage\n        ? {\n            href: \"http://localhost:3000/functions/test\",\n            origin: \"http://localhost:3000\",\n            host: \"localhost:3000\",\n            hostname: \"localhost\",\n          }\n        : {\n            href: location.href,\n            origin: location.origin,\n            host: location.host,\n            hostname: location.hostname,\n          };\n  }\n}\n\nfunction fakeI18nText(data: Record<string, string>): string {\n  return data?.en;\n}\n\nfunction fakeImageFactory(): ImagesFactory {\n  return {\n    get(name: string) {\n      return `mock/images/${name}`;\n    },\n  };\n}\n\nfunction fakeCheckPermissions(): boolean {\n  return true;\n}\n","import type { MicroApp, StoryboardFunction } from \"@next-core/types\";\nimport {\n  cook,\n  precookFunction,\n  EstreeNode,\n  __dev_only_clearGlobalExecutionContextStack,\n  __dev_only_getGlobalExecutionContextStack,\n} from \"@next-core/cook\";\nimport { supply } from \"@next-core/supply\";\nimport { collectMemberUsageInFunction } from \"@next-core/utils/storyboard\";\nimport type _ from \"lodash\";\nimport { getGeneralGlobals } from \"./internal/compute/getGeneralGlobals.js\";\n\n/** @internal */\nexport type ReadonlyStoryboardFunctions = Readonly<Record<string, Function>>;\n\n/** @internal */\nexport type StoryboardFunctionPatch = Pick<\n  StoryboardFunction,\n  \"source\" | \"typescript\"\n>;\n\n/** @internal */\nexport interface StoryboardFunctionRegistry {\n  /** A readonly proxy for accessing cooked storyboard functions. */\n  storyboardFunctions: ReadonlyStoryboardFunctions;\n\n  /** Register storyboard functions. */\n  registerStoryboardFunctions(\n    functions: StoryboardFunction[] | undefined,\n    app?: PartialMicroApp\n  ): void;\n\n  /** Update a storyboard function during debugging. */\n  updateStoryboardFunction(name: string, data: StoryboardFunctionPatch): void;\n\n  checkPermissionsUsage(functionNames: string[]): boolean;\n\n  clearGlobalExecutionContextStack(): void;\n  getGlobalExecutionContextStack(): ReturnType<\n    typeof __dev_only_getGlobalExecutionContextStack\n  >;\n}\n\n/** @internal */\nexport interface RuntimeStoryboardFunction {\n  source: string;\n  typescript?: boolean;\n  processed?: boolean;\n  cooked?: Function;\n  deps: Set<string> | string[];\n  hasPermissionsCheck: boolean;\n}\n\n/** @internal */\nexport interface FunctionCoverageCollector {\n  beforeVisit(node: EstreeNode): void;\n  beforeEvaluate(node: EstreeNode): void;\n  beforeCall(node: EstreeNode): void;\n  beforeBranch(node: EstreeNode, branch: string): void;\n}\n\n/** @internal */\nexport interface FunctionCoverageSettings {\n  createCollector(name: string): FunctionCoverageCollector;\n}\n\n/** @internal */\nexport type PartialMicroApp = Pick<MicroApp, \"id\" | \"isBuildPush\">;\n\n/** @internal */\nexport function StoryboardFunctionRegistryFactory({\n  widgetId,\n  widgetVersion,\n  collectCoverage,\n  debuggerOverrides,\n}: {\n  widgetId?: string;\n  widgetVersion?: string;\n  collectCoverage?: FunctionCoverageSettings;\n  debuggerOverrides?: (ctx: {\n    precookFunction: typeof precookFunction;\n    cook: typeof cook;\n    supply: typeof supply;\n  }) => {\n    LodashWithStaticFields?: Partial<typeof _>;\n    ArrayConstructor?: typeof Array;\n    ObjectWithStaticFields?: Partial<typeof Object>;\n  };\n} = {}): StoryboardFunctionRegistry {\n  const registeredFunctions = new Map<string, RuntimeStoryboardFunction>();\n\n  const overrides = debuggerOverrides?.({\n    precookFunction,\n    cook,\n    supply,\n  });\n\n  // Use `Proxy` with a frozen target, to make a readonly function registry.\n  const storyboardFunctions = new Proxy(Object.freeze({}), {\n    get(_target, key) {\n      return getStoryboardFunction(key as string);\n    },\n  }) as ReadonlyStoryboardFunctions;\n\n  let currentApp: PartialMicroApp | undefined;\n\n  function registerStoryboardFunctions(\n    functions: StoryboardFunction[],\n    app?: PartialMicroApp\n  ): void {\n    if (app) {\n      currentApp = app;\n    }\n    registeredFunctions.clear();\n    if (Array.isArray(functions)) {\n      for (const fn of functions) {\n        let deps: Set<string> | string[] | undefined = fn.deps;\n        if (deps == null) {\n          deps = collectMemberUsageInFunction(fn, \"FN\", !!collectCoverage);\n          (deps as Set<string>).delete(fn.name);\n        }\n        const hasPermissionsCheck =\n          fn.perm ??\n          collectMemberUsageInFunction(\n            fn,\n            \"PERMISSIONS\",\n            !!collectCoverage\n          ).has(\"check\");\n        registeredFunctions.set(fn.name, {\n          source: fn.source,\n          typescript: fn.typescript,\n          deps,\n          hasPermissionsCheck,\n        });\n      }\n    }\n  }\n\n  function getStoryboardFunction(name: string): Function | undefined {\n    const fn = registeredFunctions.get(name);\n    if (!fn) {\n      return undefined;\n    }\n    if (fn.processed) {\n      return fn.cooked;\n    }\n    let collector: FunctionCoverageCollector | undefined;\n    if (collectCoverage) {\n      collector = collectCoverage.createCollector(name);\n    }\n    const precooked = precookFunction(fn.source, {\n      typescript: fn.typescript,\n      hooks: collector && {\n        beforeVisit: collector.beforeVisit,\n      },\n      cacheKey: fn,\n    });\n    const globalVariables = supply(\n      precooked.attemptToVisitGlobals,\n      getGeneralGlobals(precooked.attemptToVisitGlobals, {\n        collectCoverage,\n        widgetId,\n        widgetVersion,\n        app: currentApp,\n        storyboardFunctions,\n        isStoryboardFunction: true,\n      }),\n      !!collectCoverage\n    );\n\n    fn.cooked = cook(precooked.function, fn.source, {\n      rules: {\n        noVar: true,\n      },\n      globalVariables: overrides\n        ? {\n            ...globalVariables,\n            ...(overrides?.LodashWithStaticFields &&\n            precooked.attemptToVisitGlobals.has(\"_\")\n              ? {\n                  _: {\n                    ...(globalVariables._ as typeof _),\n                    ...overrides.LodashWithStaticFields,\n                  },\n                }\n              : null),\n            ...(overrides?.ArrayConstructor &&\n            precooked.attemptToVisitGlobals.has(\"Array\")\n              ? {\n                  Array: overrides.ArrayConstructor,\n                }\n              : null),\n            ...(overrides?.ObjectWithStaticFields &&\n            precooked.attemptToVisitGlobals.has(\"Object\")\n              ? {\n                  Object: {\n                    ...(globalVariables.Object as typeof Object),\n                    ...overrides.ObjectWithStaticFields,\n                  },\n                }\n              : null),\n          }\n        : globalVariables,\n      ArrayConstructor: overrides?.ArrayConstructor,\n      hooks: collector && {\n        beforeEvaluate: collector.beforeEvaluate,\n        beforeCall: collector.beforeCall,\n        beforeBranch: collector.beforeBranch,\n      },\n      debug: !!debuggerOverrides,\n    }) as Function;\n    fn.processed = true;\n    return fn.cooked;\n  }\n\n  return {\n    storyboardFunctions,\n    registerStoryboardFunctions,\n    updateStoryboardFunction(\n      name: string,\n      data: StoryboardFunctionPatch\n    ): void {\n      const newFn = {\n        ...data,\n        name,\n      };\n      const deps = collectMemberUsageInFunction(newFn, \"FN\", true);\n      const hasPermissionsCheck = collectMemberUsageInFunction(\n        newFn,\n        \"PERMISSIONS\",\n        true\n      ).has(\"check\");\n      registeredFunctions.set(name, {\n        source: data.source,\n        typescript: data.typescript,\n        deps,\n        hasPermissionsCheck,\n      });\n    },\n    /**\n     * Check whether listed functions attempt to call `PERMISSIONS.check()`,\n     * includes in nested `FN.*()` calls.\n     */\n    checkPermissionsUsage(functionNames) {\n      const checkedFunctions = new Set<string>();\n      const hasPermissionsCheck = (name: string): boolean => {\n        if (!checkedFunctions.has(name)) {\n          checkedFunctions.add(name);\n          const fn = registeredFunctions.get(name);\n          return (\n            !!fn &&\n            (fn.hasPermissionsCheck || [...fn.deps].some(hasPermissionsCheck))\n          );\n        }\n        return false;\n      };\n      return functionNames.some(hasPermissionsCheck);\n    },\n    clearGlobalExecutionContextStack() {\n      __dev_only_clearGlobalExecutionContextStack();\n    },\n    getGlobalExecutionContextStack() {\n      return __dev_only_getGlobalExecutionContextStack();\n    },\n  };\n}\n","import { StoryboardFunctionRegistryFactory } from \"../../StoryboardFunctionRegistry.js\";\n\nexport const {\n  storyboardFunctions,\n  registerStoryboardFunctions,\n  checkPermissionsUsage,\n} = StoryboardFunctionRegistryFactory();\n","import EventTarget from \"@ungap/event-target\";\n\nexport interface Media {\n  breakpoint?: MediaBreakpoint;\n}\n\nexport enum MediaBreakpoint {\n  xLarge = \"xLarge\",\n  large = \"large\",\n  medium = \"medium\",\n  small = \"small\",\n  xSmall = \"xSmall\",\n}\n\nexport const mediaBreakpointMinWidthMap = new Map<\n  MediaBreakpoint,\n  string | number\n>([\n  [MediaBreakpoint.xLarge, \"1920px\"],\n  [MediaBreakpoint.large, \"1600px\"],\n  [MediaBreakpoint.medium, \"1280px\"],\n  [MediaBreakpoint.small, \"1024px\"],\n  [MediaBreakpoint.xSmall, 0],\n]);\nexport const mediaEventTarget = new EventTarget();\n\nconst breakpointMatchesMap: Partial<Record<MediaBreakpoint, boolean>> = {};\nconst MEDIA: Media = {};\n\nfunction handleMatchesChange(\n  data: { readonly matches: boolean; readonly media: string },\n  breakpoint: MediaBreakpoint\n): void {\n  let changed = false;\n  breakpointMatchesMap[breakpoint] = data.matches;\n\n  for (const [breakpoint] of mediaBreakpointMinWidthMap) {\n    if (breakpointMatchesMap[breakpoint] && MEDIA.breakpoint !== breakpoint) {\n      MEDIA.breakpoint = breakpoint;\n      changed = true;\n      break;\n    }\n  }\n\n  if (changed) {\n    mediaEventTarget.dispatchEvent(\n      new CustomEvent(\"change\", { detail: MEDIA })\n    );\n  }\n}\n\nmediaBreakpointMinWidthMap.forEach((minWidth, breakpoint) => {\n  const mediaQueryList = window.matchMedia(`(min-width: ${minWidth})`);\n\n  handleMatchesChange(mediaQueryList, breakpoint);\n\n  if (mediaQueryList.addEventListener) {\n    mediaQueryList.addEventListener(\"change\", (event) => {\n      handleMatchesChange(event, breakpoint);\n    });\n  } else {\n    mediaQueryList.addListener((event) => {\n      handleMatchesChange(event, breakpoint);\n    });\n  }\n});\n\nexport const getMedia = (): Media => MEDIA;\n","export function getStorageItem(storageType: \"local\" | \"session\") {\n  return function (name: string) {\n    const storage = storageType === \"local\" ? localStorage : sessionStorage;\n    return JSON.parse(storage.getItem(name) ?? \"null\");\n  };\n}\n","import { getRuntime } from \"./index.js\";\nimport type { RuntimeContext } from \"./internal/interfaces.js\";\n\nexport function isStrictMode(runtimeContext?: RuntimeContext) {\n  return !!(\n    runtimeContext ? runtimeContext.flags : getRuntime()?.getFeatureFlags()\n  )?.[\"brick-next-v3-strict-mode\"];\n}\n\nexport function warnAboutStrictMode(\n  strict: boolean,\n  message: string,\n  ...extraLogs: unknown[]\n) {\n  const punctuation = extraLogs.length === 0 ? \"\" : \",\";\n  if (strict) {\n    // eslint-disable-next-line no-console\n    console.error(\n      `${message} is dropped in v3 strict mode${punctuation}`,\n      ...extraLogs\n    );\n  } else {\n    // eslint-disable-next-line no-console\n    console.warn(\n      `${message} is deprecated in v3 and will be dropped in strict mode${punctuation}`,\n      ...extraLogs\n    );\n  }\n}\n","import type {\n  ContextConf,\n  CustomTemplate,\n  CustomTemplateConstructor,\n  CustomTemplateProxyBasicProperty,\n} from \"@next-core/types\";\nimport { uniq } from \"lodash\";\nimport type { RuntimeBrickElement } from \"./internal/interfaces.js\";\nimport { isStrictMode, warnAboutStrictMode } from \"./isStrictMode.js\";\nimport { getV2RuntimeFromDll } from \"./getV2RuntimeFromDll.js\";\n\n// Note: `prefix` is a native prop on Element, but it's only used in XML documents.\nconst allowedNativeProps = new Set([\"prefix\"]);\n\ninterface LegacyTplPropProxy extends CustomTemplateProxyBasicProperty {\n  asVariable?: boolean;\n  mergeProperty?: unknown;\n  refTransform?: unknown;\n}\n\nclass CustomTemplateRegistry {\n  readonly #registry = new Map<string, CustomTemplate>();\n\n  define(tagName: string, constructor: CustomTemplateConstructor): void {\n    let registered = this.#registry.has(tagName);\n    if (registered) {\n      // When open launchpad, the storyboard will be updated.\n      // However, we can't *undefine* a custom element.\n      // Just ignore re-registering custom templates.\n      // eslint-disable-next-line no-console\n      console.warn(`Custom template of \"${tagName}\" already registered.`);\n    } else {\n      registered = !!customElements.get(tagName);\n      if (registered) {\n        // eslint-disable-next-line no-console\n        console.warn(\n          `Custom template of \"${tagName}\" already defined by customElements.`\n        );\n      }\n    }\n\n    // Transform legacy `proxy.properties[].asVariable` as states.\n    const strict = isStrictMode();\n    const proxyProperties = (constructor.proxy?.properties ?? {}) as {\n      [name: string]: LegacyTplPropProxy;\n    };\n    const validProxyProps: [string, CustomTemplateProxyBasicProperty][] = [];\n    const legacyTplVariables: string[] = [];\n    for (const [key, value] of Object.entries(proxyProperties)) {\n      if (value.asVariable) {\n        warnAboutStrictMode(strict, \"Template `asVariable`\", tagName, key);\n        // istanbul ignore next\n        if (!strict) {\n          // For existed TPL usage, treat it as a STATE.\n          legacyTplVariables.push(key);\n        }\n      } else if (value.mergeProperty || value.refTransform) {\n        // eslint-disable-next-line no-console\n        console.error(\n          \"Template `mergeProperty` and `refTransform` are dropped in v3:\",\n          tagName,\n          key\n        );\n      } else if (value.ref) {\n        validProxyProps.push([key, value]);\n      }\n      // Else: documentation only, for exposed states.\n    }\n\n    const compatibleConstructor = {\n      ...constructor,\n      proxy: {\n        ...constructor.proxy,\n        properties: Object.fromEntries(validProxyProps),\n      },\n      state: (constructor.state\n        ? strict\n          ? constructor.state\n          : constructor.state.map((item) => ({\n              // Make `expose` defaults to true in non-strict mode.\n              expose: true,\n              ...item,\n            }))\n        : []\n      ).concat(legacyTplVariables.map((tpl) => ({ name: tpl, expose: true }))),\n    };\n\n    // Now we allow re-register custom template\n    this.#registry.set(tagName, {\n      ...compatibleConstructor,\n      name: tagName,\n    });\n\n    const exposedStates = getExposedStates(compatibleConstructor.state);\n    const proxyMethods = Object.entries(\n      compatibleConstructor.proxy?.methods ?? {}\n    );\n\n    const props = exposedStates.concat(\n      validProxyProps.map((entry) => entry[0])\n    );\n    const methods = proxyMethods.map((entry) => entry[0]);\n\n    const nativeProps = props\n      .concat(methods)\n      .filter(\n        (prop) => prop in HTMLElement.prototype && !allowedNativeProps.has(prop)\n      );\n    if (nativeProps.length > 0) {\n      warnAboutStrictMode(\n        strict,\n        \"Using native HTMLElement properties as template properties or methods\",\n        tagName,\n        ...nativeProps\n      );\n      // istanbul ignore next\n      if (strict) {\n        throw new Error(\n          `In custom template \"${tagName}\", ${nativeProps\n            .map((p) => `\"${p}\"`)\n            .join(\n              \", \"\n            )} are native HTMLElement properties, and should be avoid to be used as brick properties or methods.`\n        );\n      }\n    }\n\n    if (registered) {\n      return;\n    }\n\n    class TplElement extends HTMLElement {\n      get $$typeof() {\n        return \"custom-template\" as const;\n      }\n\n      static get _dev_only_definedProperties(): string[] {\n        return props;\n      }\n\n      static get _dev_only_definedMethods(): string[] {\n        return methods;\n      }\n\n      $$getElementByRef(this: RuntimeBrickElement, ref: string) {\n        return this.$$tplStateStore?.hostBrick?.tplHostMetadata?.internalBricksByRef.get(\n          ref\n        )?.element;\n      }\n\n      connectedCallback() {\n        let shadowRoot = this.shadowRoot;\n        if (!shadowRoot) {\n          shadowRoot = this.attachShadow({ mode: \"open\" });\n        }\n        const fragment = document.createDocumentFragment();\n        const style = document.createElement(\"style\");\n        style.textContent = \":host{display:block}:host([hidden]){display:none}\";\n        const slot = document.createElement(\"slot\");\n        fragment.appendChild(style);\n        fragment.appendChild(slot);\n        shadowRoot.appendChild(fragment);\n      }\n\n      disconnectedCallback() {\n        if (this.shadowRoot) {\n          this.shadowRoot.textContent = \"\";\n        }\n      }\n    }\n\n    for (const propName of exposedStates) {\n      if (validProxyProps.some((entry) => entry[0] === propName)) {\n        // eslint-disable-next-line no-console\n        console.error(\n          `Cannot define an exposed state that is also a proxy property: \"${propName}\" in ${tagName}`\n        );\n        continue;\n      }\n      Object.defineProperty(TplElement.prototype, propName, {\n        get(this: RuntimeBrickElement) {\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          return this.$$tplStateStore!.getValue(propName);\n        },\n        set(this: RuntimeBrickElement, value: unknown) {\n          // 在 mount 过程中，先设置属性，再设置 `$$tplStateStore`，这样，当触发属性设置时，\n          // 避免初始化的一次 state update 操作及其 onChange 事件。\n          this.$$tplStateStore?.updateValue(propName, value, \"replace\");\n        },\n        enumerable: true,\n      });\n    }\n\n    for (const [from, to] of validProxyProps) {\n      Object.defineProperty(TplElement.prototype, from, {\n        get(this: TplElement) {\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          const element = this.$$getElementByRef!(to.ref) as unknown as Record<\n            string,\n            unknown\n          >;\n          return element[to.refProperty ?? from];\n        },\n        set(this: TplElement, value: unknown) {\n          // 同上 exposedState.set\n          const element = this.$$getElementByRef?.(to.ref) as unknown as Record<\n            string,\n            unknown\n          >;\n          if (element) {\n            element[to.refProperty ?? from] = value;\n          }\n        },\n        enumerable: true,\n      });\n    }\n\n    for (const [from, to] of proxyMethods) {\n      Object.defineProperty(TplElement.prototype, from, {\n        value(this: TplElement, ...args: unknown[]) {\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          const element = this.$$getElementByRef!(to.ref) as unknown as Record<\n            string,\n            Function\n          >;\n          return element[to.refMethod ?? from](...args);\n        },\n        enumerable: true,\n      });\n    }\n\n    customElements.define(tagName, TplElement);\n  }\n\n  get(tagName: string) {\n    return this.#registry.get(tagName);\n  }\n}\n\nfunction getExposedStates(state: ContextConf[] | undefined): string[] {\n  // Allow duplicated state names which maybe mutually exclusive.\n  return uniq(\n    state?.filter((item) => item.expose).map((item) => item.name) ?? []\n  );\n}\n\n// istanbul ignore next\nfunction getCustomTemplatesV2() {\n  const v2Kit = getV2RuntimeFromDll();\n  if (v2Kit) {\n    return Object.freeze({\n      define(tagName: string, constructor: CustomTemplateConstructor) {\n        return v2Kit.getRuntime().registerCustomTemplate(tagName, constructor);\n      },\n    }) as CustomTemplateRegistry;\n  }\n}\n\n// istanbul ignore next\nexport const customTemplates =\n  getCustomTemplatesV2() || new CustomTemplateRegistry();\n","import type { DataStore } from \"../data/DataStore.js\";\nimport type { RuntimeBrickElement, RuntimeContext } from \"../interfaces.js\";\nimport { customTemplates } from \"../../CustomTemplates.js\";\n\ntype MinimalTplStateStoreContext = Pick<\n  RuntimeContext,\n  \"tplStateStoreId\" | \"tplStateStoreMap\"\n>;\n\nexport function getTplStateStore(\n  { tplStateStoreId, tplStateStoreMap }: MinimalTplStateStoreContext,\n  using: string,\n  extraInfo?: string\n): DataStore<\"STATE\"> {\n  if (!tplStateStoreId) {\n    throw new Error(\n      `Using \"${using}\" outside of a custom template${extraInfo ?? \"\"}`\n    );\n  }\n  const store = tplStateStoreMap.get(tplStateStoreId);\n  if (!store) {\n    throw new Error(\n      `Template state store is not found when using \"${using}\"${\n        extraInfo ?? \"\"\n      }.\\nThis is a bug of Brick Next, please report it.`\n    );\n  }\n  return store;\n}\n\nexport function getTplHostElement(\n  runtimeContext: MinimalTplStateStoreContext,\n  using: string,\n  extraInfo?: string\n): RuntimeBrickElement {\n  const store = getTplStateStore(runtimeContext, using, extraInfo);\n  const hostElement = store.hostBrick!.element;\n  if (!hostElement) {\n    throw new Error(\n      `Template host element is gone when using \"${using}\"${\n        extraInfo ?? \"\"\n      }.\\nThis is a bug of Brick Next, please report it.`\n    );\n  }\n  return hostElement;\n}\n\nexport function getTagNameOfCustomTemplate(\n  brick: string,\n  appId?: string\n): false | string {\n  // When a template is registered by an app, it's namespace maybe missed.\n  if (!brick.includes(\".\") && brick.startsWith(\"tpl-\") && appId) {\n    const tagName = `${appId}.${brick}`;\n    if (customTemplates.get(tagName)) {\n      return tagName;\n    }\n  }\n  if (customTemplates.get(brick)) {\n    return brick;\n  }\n  return false;\n}\n","import { StoryboardFunction } from \"@next-core/types\";\nimport {\n  ReadonlyStoryboardFunctions,\n  StoryboardFunctionRegistryFactory,\n} from \"../../StoryboardFunctionRegistry.js\";\nimport { getV2RuntimeFromDll } from \"../../getV2RuntimeFromDll.js\";\n\nconst widgetFunctionRegistry = new Map<string, ReadonlyStoryboardFunctions>();\n\nexport const widgetFunctions = new Proxy(Object.freeze({}), {\n  get(target, key: string) {\n    return widgetFunctionRegistry.get(key);\n  },\n}) as Readonly<Record<string, ReadonlyStoryboardFunctions>>;\n\nfunction registerWidgetFunctionsV3(\n  widgetId: string,\n  functions: StoryboardFunction[],\n  widgetVersion?: string\n): void {\n  if (widgetFunctionRegistry.has(widgetId)) {\n    // eslint-disable-next-line no-console\n    throw new Error(`Widget functions of \"${widgetId}\" already registered`);\n  }\n  const { storyboardFunctions, registerStoryboardFunctions } =\n    StoryboardFunctionRegistryFactory({ widgetId, widgetVersion });\n  widgetFunctionRegistry.set(widgetId, storyboardFunctions);\n  registerStoryboardFunctions(functions);\n}\n\n// istanbul ignore next\nfunction registerWidgetFunctionsV2Factory() {\n  const v2Kit = getV2RuntimeFromDll();\n  if (v2Kit) {\n    return function (\n      widgetId: string,\n      functions: StoryboardFunction[],\n      widgetVersion?: string\n    ) {\n      return v2Kit\n        .getRuntime()\n        .registerWidgetFunctions(widgetId, functions, widgetVersion);\n    };\n  }\n}\n\n// istanbul ignore next\nexport const registerWidgetFunctions =\n  registerWidgetFunctionsV2Factory() || registerWidgetFunctionsV3;\n","import type { MicroApp } from \"@next-core/types\";\nimport { type CompareOperator, compare } from \"compare-versions\";\nimport { _internalApiGetAppInBootstrapData, hooks } from \"./Runtime.js\";\n\nexport type AppForCheck = Pick<\n  MicroApp,\n  \"id\" | \"currentVersion\" | \"installStatus\"\n>;\n\nexport function hasInstalledApp(appId: string, matchVersion?: string): boolean {\n  // First, check whether the app is in bootstrap already.\n  let app = _internalApiGetAppInBootstrapData(appId) as AppForCheck | undefined;\n  if (!app && hooks?.checkInstalledApps) {\n    app = hooks.checkInstalledApps.getCheckedApp(appId);\n  }\n  if (!app || app.installStatus === \"running\") {\n    return false;\n  }\n  // Todo: `currentVersion` maybe `\"\"`\n  if (!matchVersion || !app.currentVersion) {\n    return true;\n  }\n  // Valid `matchVersion`:\n  //   >=1.2.3\n  //   >1.2.3\n  //   =1.2.3\n  //   <=1.2.3\n  //   <1.2.3\n  const matches = matchVersion.match(/^([><]=?|=)(.*)$/);\n  try {\n    if (!matches) {\n      throw new TypeError(`Invalid match version: ${matchVersion}`);\n    }\n    return compare(\n      app.currentVersion,\n      matches[2],\n      matches[1] as CompareOperator\n    );\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.error(error);\n  }\n  return false;\n}\n","import type { DataStore } from \"../data/DataStore.js\";\nimport type { RuntimeContext } from \"../interfaces.js\";\n\ntype MinimalTplStateStoreContext = Pick<\n  RuntimeContext,\n  \"formStateStoreId\" | \"formStateStoreMap\"\n>;\n\nexport function getFormStateStore(\n  { formStateStoreId, formStateStoreMap }: MinimalTplStateStoreContext,\n  using: string,\n  extraInfo?: string\n): DataStore<\"FORM_STATE\"> {\n  if (!formStateStoreId) {\n    throw new Error(\n      `Using \"${using}\" outside of form renderer${extraInfo ?? \"\"}`\n    );\n  }\n  const store = formStateStoreMap.get(formStateStoreId);\n  if (!store) {\n    throw new Error(\n      `Form state store is not found when using \"${using}\"${\n        extraInfo ?? \"\"\n      }.\\nThis is a bug of Brick Next, please report it.`\n    );\n  }\n  return store;\n}\n","import { loadBricksImperatively } from \"@next-core/loader\";\nimport { getBrickPackages, hooks } from \"../Runtime.js\";\n\nconst pool = new Map<string, HTMLElement>();\nexport async function getProviderBrick(provider: string): Promise<HTMLElement> {\n  const isFlowApi = hooks?.flowApi?.isFlowApiProvider(provider);\n  if (isFlowApi) {\n    provider = hooks!.flowApi!.FLOW_API_PROVIDER;\n  }\n\n  let brick = pool.get(provider);\n  if (brick) {\n    return brick;\n  }\n\n  if (provider.includes(\"-\") && !customElements.get(provider)) {\n    if (isFlowApi) {\n      hooks!.flowApi!.registerFlowApiProvider();\n    } else {\n      await loadBricksImperatively([provider], getBrickPackages());\n\n      if (!customElements.get(provider)) {\n        throw new Error(`Provider not defined: \"${provider}\".`);\n      }\n    }\n  }\n\n  brick = document.createElement(provider);\n  pool.set(provider, brick);\n  return brick;\n}\n","import { isObject } from \"@next-core/utils/general\";\n\nlet computed = new WeakSet();\n\n// The computed (or transformed) result should never be *computed* again.\n// So does the fetched data from a remote api.\nexport function markAsComputed(value: unknown): void {\n  if (isObject(value)) {\n    if (!hasBeenComputed(value)) {\n      computed.add(value);\n      if (Array.isArray(value)) {\n        value.forEach(markAsComputed);\n      } else {\n        // Only mark pure objects.\n        const proto = Object.getPrototypeOf(value);\n        if (!proto || proto.constructor === Object) {\n          Object.values(value).forEach(markAsComputed);\n        }\n      }\n    }\n  }\n}\n\nexport function hasBeenComputed(object: unknown): boolean {\n  return computed.has(object as object);\n}\n\nexport function resetAllComputedMarks(): void {\n  computed = new WeakSet();\n}\n","import type {\n  HandleReject,\n  HandleRejectByTransform,\n  ResolveConf,\n} from \"@next-core/types\";\nimport { asyncComputeRealValue } from \"../compute/computeRealValue.js\";\nimport { getProviderBrick } from \"./getProviderBrick.js\";\nimport type { RuntimeContext } from \"../interfaces.js\";\nimport { _internalApiGetRenderId, hooks } from \"../Runtime.js\";\nimport { markAsComputed } from \"../compute/markAsComputed.js\";\nimport { get } from \"lodash\";\nimport { isStrictMode, warnAboutStrictMode } from \"../../isStrictMode.js\";\n\nconst cache = new Map<string, Promise<unknown>>();\n\nexport interface ResolveOptions {\n  /**\n   * Cache mode of resolve.\n   *\n   * See https://developer.mozilla.org/en-US/docs/Web/API/Request/cache\n   *\n   * - `default`: Looks for a matching cache.\n   * - `reload`: Without looking for a matching cache.\n   */\n  cache?: \"default\" | \"reload\";\n  renderId?: string;\n}\n\nexport async function resolveData(\n  resolveConf: ResolveConf,\n  runtimeContext: RuntimeContext,\n  options?: ResolveOptions\n) {\n  const { useProvider, method = \"resolve\", args = [], onReject } = resolveConf;\n\n  const { provider: legacyProvider, field: legacyField } = resolveConf as {\n    provider?: string;\n    field?: string | string[];\n  };\n  if (legacyProvider && !useProvider) {\n    throw new Error(\n      `You're using \"provider: ${legacyProvider}\" which is dropped in v3, please use \"useProvider\" instead`\n    );\n  }\n\n  const hasLegacyField = legacyField !== null && legacyField !== undefined;\n  if (hasLegacyField) {\n    const strict = isStrictMode();\n    warnAboutStrictMode(strict, \"`resolve.field`\");\n    // istanbul ignore next\n    if (strict) {\n      throw new Error(\"Using deprecated `resolve.field`\");\n    }\n  }\n\n  const [providerBrick, actualArgs] = await Promise.all([\n    getProviderBrick(useProvider) as unknown as Promise<\n      Record<string, Function>\n    >,\n    asyncComputeRealValue(args, runtimeContext) as Promise<unknown[]>,\n  ]);\n\n  // `clearResolveCache` maybe cleared during the above promise being\n  // fulfilled, so we manually mark it as stale for this case.\n  const renderId = options?.renderId;\n  const stale = !!renderId && renderId !== _internalApiGetRenderId();\n\n  const promise = resolveByProvider(\n    providerBrick,\n    useProvider,\n    method,\n    actualArgs,\n    options,\n    args,\n    stale\n  );\n\n  let { transform } = resolveConf;\n  let data: unknown;\n\n  try {\n    const value = await promise;\n    data = hasLegacyField ? get(value, legacyField) : value;\n    // The fetched data and its inner objects should never be *injected* again.\n    markAsComputed(data);\n  } catch (error) {\n    if (isHandleRejectByTransform(onReject)) {\n      transform = onReject.transform;\n      data = error;\n    } else {\n      throw error;\n    }\n  }\n\n  if (!transform) {\n    return data;\n  }\n\n  // Keep backward compatibility of string transform.\n  if (typeof transform === \"string\") {\n    return { [transform]: data };\n  }\n\n  return asyncComputeRealValue(transform, { ...runtimeContext, data });\n}\n\nexport function clearResolveCache() {\n  cache.clear();\n}\n\nexport async function resolveByProvider(\n  brick: Record<string, Function>,\n  useProvider: string,\n  method: string,\n  args: unknown[],\n  options?: ResolveOptions,\n  originalArgs?: unknown[],\n  stale?: boolean\n) {\n  let cacheKey: string;\n  try {\n    // `args` may contain circular references, which makes\n    // JSON stringify failed, thus we fallback to original args.\n    cacheKey = JSON.stringify({\n      useProvider,\n      method,\n      args,\n    });\n  } catch (e) {\n    if (!originalArgs) {\n      throw e;\n    }\n    cacheKey = JSON.stringify({\n      useProvider,\n      method,\n      originalArgs,\n    });\n  }\n\n  let promise: Promise<unknown> | undefined;\n  if (options?.cache !== \"reload\") {\n    promise = cache.get(cacheKey);\n  }\n  if (!promise) {\n    promise = (async () => {\n      const finalArgs = hooks?.flowApi?.isFlowApiProvider(useProvider)\n        ? await hooks.flowApi.getArgsOfFlowApi(useProvider, args, method)\n        : args;\n      return brick[method](...finalArgs);\n    })();\n\n    if (!stale) {\n      cache.set(cacheKey, promise);\n    }\n  }\n\n  return promise;\n}\n\nfunction isHandleRejectByTransform(\n  onReject: HandleReject | undefined\n): onReject is HandleRejectByTransform {\n  return !!(onReject as HandleRejectByTransform)?.transform;\n}\n","import {\n  cook,\n  preevaluate,\n  PreevaluateResult,\n  shouldAllowRecursiveEvaluations,\n} from \"@next-core/cook\";\nimport { loadProcessorsImperatively } from \"@next-core/loader\";\nimport { supply } from \"@next-core/supply\";\nimport { hasOwnProperty } from \"@next-core/utils/general\";\nimport {\n  strictCollectMemberUsage,\n  collectAppGetMenuUsage,\n  collectInstalledAppsHasUsage,\n  MemberCallUsage,\n} from \"@next-core/utils/storyboard\";\nimport { cloneDeep, omit } from \"lodash\";\nimport type { RuntimeContext } from \"../interfaces.js\";\nimport { customProcessors } from \"../../CustomProcessors.js\";\nimport {\n  checkPermissionsUsage,\n  storyboardFunctions,\n} from \"./StoryboardFunctions.js\";\nimport { getGeneralGlobals } from \"./getGeneralGlobals.js\";\nimport {\n  getDynamicReadOnlyProxy,\n  getReadOnlyProxy,\n} from \"../proxyFactories.js\";\nimport { devtoolsHookEmit, getDevHook } from \"../devtools.js\";\nimport { getMedia } from \"../mediaQuery.js\";\nimport { getStorageItem } from \"./getStorageItem.js\";\nimport {\n  _internalApiGetStoryboardInBootstrapData,\n  getBrickPackages,\n  getRuntime,\n  hooks,\n} from \"../Runtime.js\";\nimport type { DataStore } from \"../data/DataStore.js\";\nimport { getTplStateStore } from \"../CustomTemplates/utils.js\";\nimport { widgetFunctions } from \"./WidgetFunctions.js\";\nimport { widgetI18nFactory } from \"./WidgetI18n.js\";\nimport { hasInstalledApp } from \"../hasInstalledApp.js\";\nimport { isStrictMode, warnAboutStrictMode } from \"../../isStrictMode.js\";\nimport { getFormStateStore } from \"../FormRenderer/utils.js\";\nimport { resolveData } from \"../data/resolveData.js\";\nimport { asyncComputeRealValue } from \"./computeRealValue.js\";\n\nconst symbolForRaw = Symbol.for(\"pre.evaluated.raw\");\nconst symbolForContext = Symbol.for(\"pre.evaluated.context\");\n\nexport interface PreEvaluated {\n  [symbolForRaw]: string;\n  [symbolForContext]: RuntimeContext;\n}\n\nexport interface EvaluateOptions {\n  lazy?: boolean;\n  evaluationId?: number;\n}\n\nexport function isPreEvaluated(raw: unknown): raw is PreEvaluated {\n  return !!(raw as PreEvaluated)?.[symbolForRaw];\n}\n\nexport function getPreEvaluatedRaw(pre: PreEvaluated): string {\n  return pre[symbolForRaw];\n}\n\nexport function shouldDismissMarkingComputed(\n  raw: string | PreEvaluated\n): boolean {\n  if (typeof raw === \"string\") {\n    return shouldAllowRecursiveEvaluations(raw);\n  }\n  return shouldAllowRecursiveEvaluations(raw[symbolForRaw]);\n}\n\nconst possibleErrorConstructs = new WeakSet<ErrorConstructor>([\n  SyntaxError,\n  TypeError,\n  ReferenceError,\n]);\n\nexport function getCookErrorConstructor(error: any): ErrorConstructor {\n  return possibleErrorConstructs.has(error.constructor)\n    ? error.constructor\n    : TypeError;\n}\n\nexport async function asyncEvaluate(\n  raw: string | PreEvaluated, // string or pre-evaluated object.\n  runtimeContext: RuntimeContext,\n  options?: EvaluateOptions\n): Promise<unknown> {\n  const { blockingList, run } = lowLevelEvaluate(\n    raw,\n    runtimeContext,\n    options,\n    true\n  );\n  await Promise.all(blockingList);\n  return run();\n}\n\nexport function evaluate(\n  raw: string | PreEvaluated, // string or pre-evaluated object.\n  runtimeContext: RuntimeContext,\n  options?: EvaluateOptions\n): Promise<unknown> {\n  const { run } = lowLevelEvaluate(raw, runtimeContext, options, false);\n  return run();\n}\n\nfunction lowLevelEvaluate(\n  raw: string | PreEvaluated, // string or pre-evaluated object.\n  runtimeContext: RuntimeContext,\n  options: EvaluateOptions = {},\n  isAsync?: boolean\n): {\n  blockingList: (Promise<unknown> | undefined)[];\n  run: Function;\n} {\n  const blockingList: (Promise<unknown> | undefined)[] = [];\n  if (typeof raw !== \"string\") {\n    // If the `raw` is not a string, it must be a pre-evaluated object.\n    // Then fulfil the context, and restore the original `raw`.\n\n    const passByRuntimeContext = omit(runtimeContext, [\n      \"pendingPermissionsPreCheck\",\n      \"tplStateStoreMap\",\n      \"tplStateStoreScope\",\n      \"formStateStoreMap\",\n      \"formStateStoreScope\",\n    ]);\n\n    runtimeContext = {\n      ...raw[symbolForContext],\n      ...passByRuntimeContext,\n    };\n    raw = raw[symbolForRaw];\n  }\n\n  // Collect `APP.getMenu(...)` usage before evaluating.\n  const menuUsage: MemberCallUsage = {\n    usedArgs: new Set(),\n  };\n  const hasAppUsage: MemberCallUsage = {\n    usedArgs: new Set(),\n  };\n\n  // A `SyntaxError` maybe thrown.\n  let precooked: PreevaluateResult;\n  try {\n    precooked = preevaluate(raw, {\n      cache: true,\n      withParent: true,\n      hooks: {\n        beforeVisitGlobal(node, parent) {\n          collectAppGetMenuUsage(menuUsage, node, parent!);\n          collectInstalledAppsHasUsage(hasAppUsage, node, parent!);\n        },\n      },\n    });\n  } catch (error: any) {\n    const message = `${error.message}, in \"${raw}\"`;\n    const errorConstructor = getCookErrorConstructor(error);\n    throw new errorConstructor(message);\n  }\n\n  if (menuUsage.hasNonStaticUsage) {\n    throw new Error(\n      `Non-static usage of \"APP.getMenu\" is prohibited in v3, check your expression: \"${raw}\"`\n    );\n  }\n\n  if (hasAppUsage.hasNonStaticUsage) {\n    throw new Error(\n      `Non-static usage of \"INSTALLED_APPS.has\" is prohibited in v3, check your expression: \"${raw}\"`\n    );\n  }\n\n  const globalVariables: Record<string, unknown> = {};\n  const { attemptToVisitGlobals } = precooked;\n\n  // Ignore evaluating if required `event/DATA` is missing in\n  // context. Since they are are provided in different context, whenever\n  // missing one of them, memorize the current context for later consuming.\n  if (\n    options.lazy ||\n    (attemptToVisitGlobals.has(\"EVENT\") &&\n      !hasOwnProperty(runtimeContext, \"event\")) ||\n    (attemptToVisitGlobals.has(\"DATA\") &&\n      !hasOwnProperty(runtimeContext, \"data\"))\n  ) {\n    return {\n      blockingList,\n      run() {\n        return Object.keys(runtimeContext).length > 0\n          ? ({\n              [symbolForRaw]: raw,\n              [symbolForContext]: runtimeContext,\n            } as PreEvaluated)\n          : raw;\n      },\n    };\n  }\n\n  let usedCtx: Set<string>;\n  let usedProcessors: Set<string>;\n  let usedStates: Set<string>;\n  let tplStateStore: DataStore<\"STATE\"> | undefined;\n  const strict = isStrictMode(runtimeContext);\n\n  // For existed TPL usage, treat it as a STATE.\n  if (\n    attemptToVisitGlobals.has(\"STATE\") ||\n    (!strict && attemptToVisitGlobals.has(\"TPL\"))\n  ) {\n    tplStateStore = getTplStateStore(runtimeContext, \"STATE\", `: \"${raw}\"`);\n  }\n\n  let usedFormStates: Set<string>;\n  let formStateStore: DataStore<\"FORM_STATE\"> | undefined;\n  if (attemptToVisitGlobals.has(\"FORM_STATE\")) {\n    formStateStore = getFormStateStore(\n      runtimeContext,\n      \"FORM_STATE\",\n      `: \"${raw}\"`\n    );\n  }\n\n  const devHook = getDevHook();\n  if (isAsync || devHook) {\n    if (attemptToVisitGlobals.has(\"CTX\")) {\n      usedCtx = strictCollectMemberUsage(raw, \"CTX\");\n      isAsync && blockingList.push(runtimeContext.ctxStore.waitFor(usedCtx));\n    }\n\n    if (tplStateStore) {\n      usedStates = strictCollectMemberUsage(raw, \"STATE\");\n      // istanbul ignore if\n      if (!strict) {\n        const usedTpls = strictCollectMemberUsage(raw, \"TPL\");\n        for (const tpl of usedTpls) {\n          usedStates.add(tpl);\n        }\n      }\n      isAsync && blockingList.push(tplStateStore.waitFor(usedStates));\n    }\n\n    if (formStateStore) {\n      usedFormStates = strictCollectMemberUsage(raw, \"FORM_STATE\");\n      isAsync && blockingList.push(formStateStore.waitFor(usedFormStates));\n    }\n\n    if (attemptToVisitGlobals.has(\"PROCESSORS\")) {\n      usedProcessors = strictCollectMemberUsage(raw, \"PROCESSORS\", 2);\n      isAsync &&\n        blockingList.push(\n          loadProcessorsImperatively(usedProcessors, getBrickPackages())\n        );\n    }\n  }\n\n  if (isAsync) {\n    let attemptToCheckPermissions = attemptToVisitGlobals.has(\"PERMISSIONS\");\n    // There maybe `PERMISSIONS.check()` usage in functions\n    if (!attemptToCheckPermissions && attemptToVisitGlobals.has(\"FN\")) {\n      const usedFunctions = [...strictCollectMemberUsage(raw, \"FN\")];\n      attemptToCheckPermissions = checkPermissionsUsage(usedFunctions);\n    }\n\n    if (attemptToCheckPermissions) {\n      blockingList.push(...runtimeContext.pendingPermissionsPreCheck);\n    }\n\n    if (menuUsage.usedArgs.size > 0 && hooks?.menu) {\n      // Block evaluating if has `APP.getMenu(...)` usage.\n      const usedMenuIds = [...menuUsage.usedArgs];\n      blockingList.push(\n        Promise.all(\n          usedMenuIds.map((menuId) =>\n            hooks!.menu!.fetchMenuById(menuId, runtimeContext, {\n              getStoryboardByAppId: _internalApiGetStoryboardInBootstrapData,\n              resolveData,\n              asyncComputeRealValue,\n            })\n          )\n        )\n      );\n    }\n\n    if (hasAppUsage.usedArgs.size > 0) {\n      // Only wait for specific apps\n      blockingList.push(\n        hooks?.checkInstalledApps?.waitForCheckingApps([\n          ...hasAppUsage.usedArgs,\n        ])\n      );\n    }\n  }\n\n  return {\n    blockingList,\n    run() {\n      const {\n        app: currentApp,\n        location,\n        query,\n        match,\n        flags,\n        sys,\n        ctxStore,\n        data,\n        event,\n      } = runtimeContext;\n      const app = runtimeContext.overrideApp ?? currentApp;\n\n      for (const variableName of attemptToVisitGlobals) {\n        switch (variableName) {\n          // case \"ALIAS\":\n          case \"ANCHOR\":\n            globalVariables[variableName] = location.hash\n              ? location.hash.substring(1)\n              : null;\n            break;\n          case \"APP\":\n            if (app == null) {\n              throw new ReferenceError(`APP is not defined, in \"${raw}\"`);\n            }\n            globalVariables[variableName] = {\n              ...cloneDeep(app),\n              getMenu: hooks?.menu?.getMenuById,\n            };\n            break;\n          case \"CTX\":\n            globalVariables[variableName] = getDynamicReadOnlyProxy({\n              get(_target, key) {\n                return ctxStore.getValue(key as string);\n              },\n              ownKeys() {\n                return Array.from(usedCtx);\n              },\n            });\n            break;\n          case \"DATA\":\n            globalVariables[variableName] = data;\n            break;\n          case \"EVENT\":\n            globalVariables[variableName] = event;\n            break;\n          case \"FLAGS\":\n            globalVariables[variableName] = getReadOnlyProxy(flags);\n            break;\n          case \"FORM_STATE\":\n            globalVariables[variableName] = getDynamicReadOnlyProxy({\n              get(_target, key) {\n                return formStateStore!.getValue(key as string);\n              },\n              ownKeys() {\n                return Array.from(usedFormStates);\n              },\n            });\n            break;\n          case \"HASH\":\n            globalVariables[variableName] = location.hash;\n            break;\n          case \"INSTALLED_APPS\":\n            globalVariables[variableName] = getReadOnlyProxy({\n              has: hasInstalledApp,\n            });\n            break;\n          case \"ITEM\":\n          case \"INDEX\":\n          case \"SIZE\": {\n            const property =\n              variableName === \"ITEM\"\n                ? \"forEachItem\"\n                : variableName === \"INDEX\"\n                  ? \"forEachIndex\"\n                  : \"forEachSize\";\n            if (!hasOwnProperty(runtimeContext, property)) {\n              // eslint-disable-next-line no-console\n              console.error(\n                `Using \\`${variableName}\\` but no \\`:forEach\\` is found, check your expression: \"${raw}\"`\n              );\n            } else {\n              globalVariables[variableName] = runtimeContext[property];\n            }\n            break;\n          }\n          case \"LOCAL_STORAGE\":\n            globalVariables[variableName] = getReadOnlyProxy({\n              getItem: getStorageItem(\"local\"),\n            });\n            break;\n          case \"MEDIA\":\n            globalVariables[variableName] = getReadOnlyProxy(getMedia());\n            break;\n          case \"MISC\":\n            globalVariables[variableName] = getRuntime().getMiscSettings();\n            break;\n          case \"PARAMS\":\n            if (query == null) {\n              throw new ReferenceError(`PARAMS is not defined, in \"${raw}\"`);\n            }\n            globalVariables[variableName] = new URLSearchParams(query);\n            break;\n          case \"PATH\":\n            globalVariables[variableName] = getReadOnlyProxy(\n              match?.params ?? {}\n            );\n            break;\n          case \"PATH_NAME\":\n            globalVariables[variableName] = location.pathname;\n            break;\n          case \"PROCESSORS\":\n            globalVariables[variableName] = getDynamicReadOnlyProxy({\n              get(_target, key) {\n                const pkg = customProcessors.get(key as string);\n                if (!pkg) {\n                  throw new Error(\n                    `'PROCESSORS.${\n                      key as string\n                    }' is not registered! Have you installed the relevant brick package?`\n                  );\n                }\n                return getDynamicReadOnlyProxy({\n                  get(_t, k) {\n                    return pkg.get(k as string);\n                  },\n                  ownKeys() {\n                    return Array.from(pkg.keys());\n                  },\n                });\n              },\n              ownKeys() {\n                const keys = new Set<string>();\n                for (const processor of usedProcessors) {\n                  const namespace = processor.split(\".\")[0];\n                  keys.add(namespace);\n                }\n                return Array.from(keys);\n              },\n            });\n            break;\n          case \"QUERY\":\n            if (query == null) {\n              throw new ReferenceError(`QUERY is not defined, in \"${raw}\"`);\n            }\n            globalVariables[variableName] = Object.fromEntries(\n              Array.from(query.keys()).map((key) => [key, query.get(key)])\n            );\n            break;\n          case \"QUERY_ARRAY\":\n            if (query == null) {\n              throw new ReferenceError(\n                `QUERY_ARRAY is not defined, in \"${raw}\"`\n              );\n            }\n            globalVariables[variableName] = Object.fromEntries(\n              Array.from(query.keys()).map((key) => [key, query.getAll(key)])\n            );\n            // case \"SEGUE\":\n            break;\n          case \"SESSION_STORAGE\":\n            globalVariables[variableName] = getReadOnlyProxy({\n              getItem: getStorageItem(\"session\"),\n            });\n            break;\n          // istanbul ignore next\n          case \"TPL\":\n            warnAboutStrictMode(\n              strict,\n              'Using \"TPL\" in expression',\n              `check your expression: \"${raw}\"`\n            );\n            if (strict) {\n              break;\n            }\n          // eslint-disable-next-line no-fallthrough\n          case \"STATE\":\n            globalVariables[variableName] = getDynamicReadOnlyProxy({\n              get(_target, key) {\n                return tplStateStore!.getValue(key as string);\n              },\n              ownKeys() {\n                return Array.from(usedStates);\n              },\n            });\n            break;\n          case \"SYS\":\n            globalVariables[variableName] = getReadOnlyProxy(sys ?? {});\n            break;\n          case \"__WIDGET_FN__\":\n            globalVariables[variableName] = widgetFunctions;\n            break;\n          case \"__WIDGET_IMG__\":\n            globalVariables[variableName] = hooks?.images?.widgetImagesFactory;\n            break;\n          case \"__WIDGET_I18N__\":\n            globalVariables[variableName] = widgetI18nFactory;\n            break;\n        }\n      }\n\n      Object.assign(\n        globalVariables,\n        getGeneralGlobals(precooked.attemptToVisitGlobals, {\n          storyboardFunctions,\n          app: app,\n          appendI18nNamespace: runtimeContext.appendI18nNamespace,\n        })\n      );\n\n      try {\n        const result = cook(precooked.expression, precooked.source, {\n          globalVariables: supply(\n            precooked.attemptToVisitGlobals,\n            globalVariables\n          ),\n        });\n        const detail = { raw, context: globalVariables, result };\n        devtoolsHookEmit(\"evaluation\", detail);\n        return result;\n      } catch (error: any) {\n        const message = `${error.message}, in \"${raw}\"`;\n        const errorConstructor = getCookErrorConstructor(error);\n        throw new errorConstructor(message);\n      }\n    },\n  };\n}\n","export enum StateOfUseBrick {\n  INITIAL,\n  USE_BRICK,\n  USE_BRICK_ITEM,\n  USE_BRICK_PROPERTIES,\n  // Compatible mode\n  USE_BRICK_TRANSFORM,\n  USE_BRICK_EVENTS,\n  USE_BRICK_IF,\n  USE_BRICK_SLOTS,\n  USE_BRICK_SLOTS_ITEM,\n  USE_BRICK_SLOTS_ITEM_BRICKS,\n  USE_BRICK_SLOTS_ITEM_BRICKS_ITEM,\n  USE_BRICK_LIFECYCLE,\n  USE_BRICK_DATA_SOURCE,\n}\n\nexport function isLazyContentInUseBrick(\n  state: StateOfUseBrick | undefined\n): boolean {\n  switch (state) {\n    case StateOfUseBrick.USE_BRICK_PROPERTIES:\n    case StateOfUseBrick.USE_BRICK_TRANSFORM:\n    case StateOfUseBrick.USE_BRICK_EVENTS:\n    case StateOfUseBrick.USE_BRICK_IF:\n    case StateOfUseBrick.USE_BRICK_LIFECYCLE:\n    case StateOfUseBrick.USE_BRICK_DATA_SOURCE:\n      return true;\n  }\n  return false;\n}\n\nexport function getNextStateOfUseBrick(\n  state: StateOfUseBrick | undefined,\n  isArray?: boolean,\n  key?: string\n): StateOfUseBrick | undefined {\n  if (isLazyContentInUseBrick(state)) {\n    return state;\n  }\n  if (isArray) {\n    switch (state) {\n      case StateOfUseBrick.USE_BRICK:\n        return StateOfUseBrick.USE_BRICK_ITEM;\n      case StateOfUseBrick.USE_BRICK_SLOTS_ITEM_BRICKS:\n        return StateOfUseBrick.USE_BRICK_SLOTS_ITEM_BRICKS_ITEM;\n    }\n  } else {\n    switch (state) {\n      case StateOfUseBrick.INITIAL:\n        if (key === \"useBrick\") {\n          return StateOfUseBrick.USE_BRICK;\n        }\n        break;\n      case StateOfUseBrick.USE_BRICK:\n      case StateOfUseBrick.USE_BRICK_ITEM:\n      case StateOfUseBrick.USE_BRICK_SLOTS_ITEM_BRICKS_ITEM: {\n        switch (key) {\n          case \"properties\":\n            return StateOfUseBrick.USE_BRICK_PROPERTIES;\n          case \"transform\":\n            return StateOfUseBrick.USE_BRICK_TRANSFORM;\n          case \"dataSource\":\n            return StateOfUseBrick.USE_BRICK_DATA_SOURCE;\n          case \"events\":\n            return StateOfUseBrick.USE_BRICK_EVENTS;\n          case \"slots\":\n            return StateOfUseBrick.USE_BRICK_SLOTS;\n          case \"children\":\n            return StateOfUseBrick.USE_BRICK_SLOTS_ITEM_BRICKS;\n          case \"if\":\n            return StateOfUseBrick.USE_BRICK_IF;\n          case \"lifeCycle\":\n            return StateOfUseBrick.USE_BRICK_LIFECYCLE;\n        }\n        break;\n      }\n      case StateOfUseBrick.USE_BRICK_SLOTS:\n        return StateOfUseBrick.USE_BRICK_SLOTS_ITEM;\n      case StateOfUseBrick.USE_BRICK_SLOTS_ITEM:\n        if (key === \"bricks\") {\n          return StateOfUseBrick.USE_BRICK_SLOTS_ITEM_BRICKS;\n        }\n        break;\n    }\n  }\n  return StateOfUseBrick.INITIAL;\n}\n","import { isEvaluable } from \"@next-core/cook\";\nimport { hasOwnProperty, isObject } from \"@next-core/utils/general\";\nimport { transformAndInject, transform, inject } from \"@next-core/inject\";\nimport {\n  asyncEvaluate,\n  isPreEvaluated,\n  evaluate,\n  shouldDismissMarkingComputed,\n} from \"./evaluate.js\";\nimport type { RuntimeContext } from \"../interfaces.js\";\nimport {\n  StateOfUseBrick,\n  getNextStateOfUseBrick,\n  isLazyContentInUseBrick,\n} from \"./getNextStateOfUseBrick.js\";\nimport { hasBeenComputed, markAsComputed } from \"./markAsComputed.js\";\n\nexport interface ComputeOptions {\n  $$lazyForUseBrick?: boolean;\n  $$stateOfUseBrick?: StateOfUseBrick;\n  ignoreSymbols?: boolean;\n  noInject?: boolean;\n}\n\nexport async function asyncComputeRealValue(\n  value: unknown,\n  runtimeContext: RuntimeContext,\n  internalOptions: ComputeOptions = {}\n): Promise<unknown> {\n  const preEvaluated = isPreEvaluated(value);\n\n  if (preEvaluated || typeof value === \"string\") {\n    // For `useBrick`, some fields such as `properties`/`transform`/`events`/`if`,\n    // are kept and to be evaluated later.\n    const lazy =\n      internalOptions.$$lazyForUseBrick &&\n      isLazyContentInUseBrick(internalOptions.$$stateOfUseBrick);\n\n    let result: unknown;\n    let dismissMarkingComputed = lazy;\n\n    if (preEvaluated || isEvaluable(value as string)) {\n      result = await asyncEvaluate(value, runtimeContext, { lazy });\n      dismissMarkingComputed = shouldDismissMarkingComputed(value);\n    } else {\n      result = lazy\n        ? value\n        : (hasOwnProperty(runtimeContext, \"data\")\n            ? internalOptions.noInject\n              ? transform\n              : transformAndInject\n            : internalOptions.noInject\n            ? identity\n            : inject)(value, runtimeContext);\n    }\n\n    if (!dismissMarkingComputed) {\n      markAsComputed(result);\n    }\n\n    return result;\n  }\n\n  if (\n    !isObject(value) ||\n    hasBeenComputed(value) ||\n    typeof value === \"function\"\n  ) {\n    return value;\n  }\n\n  if (Array.isArray(value)) {\n    const nextOptions = getNextComputeOptions(internalOptions, true);\n    return Promise.all(\n      value.map((v) => asyncComputeRealValue(v, runtimeContext, nextOptions))\n    );\n  }\n\n  return Object.fromEntries(\n    (\n      await Promise.all(\n        Object.entries(value).map(([k, v]) =>\n          Promise.all([\n            asyncComputeRealValue(k, runtimeContext),\n            asyncComputeRealValue(\n              v,\n              runtimeContext,\n              getNextComputeOptions(internalOptions, false, k)\n            ),\n          ])\n        )\n      )\n    ).concat(\n      internalOptions.ignoreSymbols\n        ? []\n        : Object.getOwnPropertySymbols(value).map((k) => [\n            k,\n            (value as Record<string | symbol, unknown>)[k],\n          ])\n    )\n  );\n}\n\nexport function computeRealValue(\n  value: unknown,\n  runtimeContext: RuntimeContext,\n  internalOptions: ComputeOptions = {}\n): unknown {\n  const preEvaluated = isPreEvaluated(value);\n\n  if (preEvaluated || typeof value === \"string\") {\n    // For `useBrick`, some fields such as `properties`/`transform`/`events`/`if`,\n    // are kept and to be evaluated later.\n    const lazy =\n      internalOptions.$$lazyForUseBrick &&\n      isLazyContentInUseBrick(internalOptions.$$stateOfUseBrick);\n\n    let result: unknown;\n    let dismissMarkingComputed = lazy;\n\n    if (preEvaluated || isEvaluable(value as string)) {\n      result = evaluate(value, runtimeContext);\n      dismissMarkingComputed = shouldDismissMarkingComputed(value);\n    } else {\n      result = lazy\n        ? value\n        : (hasOwnProperty(runtimeContext, \"data\")\n            ? internalOptions.noInject\n              ? transform\n              : transformAndInject\n            : internalOptions.noInject\n            ? identity\n            : inject)(value, runtimeContext);\n    }\n\n    if (!dismissMarkingComputed) {\n      markAsComputed(result);\n    }\n\n    return result;\n  }\n\n  if (\n    !isObject(value) ||\n    hasBeenComputed(value) ||\n    typeof value === \"function\"\n  ) {\n    return value;\n  }\n\n  if (Array.isArray(value)) {\n    const nextOptions = getNextComputeOptions(internalOptions, true);\n    return value.map((v) => computeRealValue(v, runtimeContext, nextOptions));\n  }\n\n  return Object.fromEntries(\n    Object.entries(value)\n      .map(([k, v]) => [\n        computeRealValue(k, runtimeContext),\n        computeRealValue(\n          v,\n          runtimeContext,\n          getNextComputeOptions(internalOptions, false, k)\n        ),\n      ])\n      .concat(\n        internalOptions.ignoreSymbols\n          ? []\n          : Object.getOwnPropertySymbols(value).map((k) => [\n              k,\n              (value as Record<string | symbol, unknown>)[k],\n            ])\n      )\n  );\n}\n\nfunction getNextComputeOptions(\n  internalOptions: ComputeOptions,\n  isArray: boolean,\n  key?: string\n): ComputeOptions {\n  return internalOptions.$$lazyForUseBrick\n    ? {\n        ...internalOptions,\n        $$stateOfUseBrick: getNextStateOfUseBrick(\n          internalOptions.$$stateOfUseBrick,\n          isArray,\n          key\n        ),\n      }\n    : internalOptions;\n}\n\nfunction identity<T>(value: T): T {\n  return value;\n}\n","import { hasOwnProperty, isObject } from \"@next-core/utils/general\";\nimport type { BrickConf, ResolveConf } from \"@next-core/types\";\nimport { asyncComputeRealValue, computeRealValue } from \"./computeRealValue.js\";\nimport { isPreEvaluated } from \"./evaluate.js\";\nimport { resolveData } from \"../data/resolveData.js\";\nimport type { RuntimeContext } from \"../interfaces.js\";\nimport { getV2RuntimeFromDll } from \"../../getV2RuntimeFromDll.js\";\n\n/**\n * 包含 `if` 条件判断的对象。\n */\nexport interface IfContainer {\n  /**\n   * 条件判断，可以为表达式字符串。\n   *\n   * @example\n   *\n   * ```yaml\n   * - brick: your.any-brick\n   *   if: '<% FLAGS[\"your-feature-flag\"] %>'\n   * ```\n   */\n  if?: unknown;\n}\n\nexport async function asyncCheckIf(\n  ifContainer: IfContainer,\n  runtimeContext: RuntimeContext\n): Promise<boolean> {\n  return (\n    !hasOwnProperty(ifContainer, \"if\") ||\n    !!(typeof ifContainer.if === \"string\" || isPreEvaluated(ifContainer.if)\n      ? await asyncComputeRealValue(ifContainer.if, runtimeContext)\n      : ifContainer.if)\n  );\n}\n\nexport function checkIf(\n  ifContainer: IfContainer,\n  runtimeContext: RuntimeContext\n): boolean {\n  return (\n    !hasOwnProperty(ifContainer, \"if\") ||\n    !!(typeof ifContainer.if === \"string\" || isPreEvaluated(ifContainer.if)\n      ? computeRealValue(ifContainer.if, runtimeContext)\n      : ifContainer.if)\n  );\n}\n\nexport function checkIfOfComputed(ifContainer: IfContainer): boolean {\n  return !hasOwnProperty(ifContainer, \"if\") || !!ifContainer.if;\n}\n\nexport async function asyncCheckBrickIf(\n  brickConf: BrickConf,\n  runtimeContext: RuntimeContext\n): Promise<boolean> {\n  if (isObject(brickConf.if) && !isPreEvaluated(brickConf.if)) {\n    const resolved = (await resolveData(\n      brickConf.if as ResolveConf,\n      runtimeContext\n    )) as { if?: unknown };\n    return checkIfOfComputed(resolved);\n  }\n  return asyncCheckIf(brickConf, runtimeContext);\n}\n\nfunction checkIfByTransformV3(ifContainer: IfContainer, data: unknown) {\n  return checkIf(ifContainer, { data } as RuntimeContext);\n}\n\n// istanbul ignore next\nfunction checkIfByTransformV2Factory() {\n  const v2Kit = getV2RuntimeFromDll();\n  if (v2Kit) {\n    return v2Kit.looseCheckIfByTransform;\n  }\n}\n\n// istanbul ignore next\nexport const checkIfByTransform =\n  checkIfByTransformV2Factory() || checkIfByTransformV3;\n","import { isEvaluable, isTrackAll } from \"@next-core/cook\";\nimport { track, trackAll } from \"@next-core/utils/storyboard\";\nimport {\n  PreEvaluated,\n  getPreEvaluatedRaw,\n  isPreEvaluated,\n} from \"./evaluate.js\";\n\nexport function getTracks(value: unknown) {\n  let contextNames: string[] | Set<string> | false = false;\n  let stateNames: string[] | Set<string> | false = false;\n  let formStateNames: string[] | Set<string> | false = false;\n  if (typeof value === \"string\" ? isEvaluable(value) : isPreEvaluated(value)) {\n    const raw =\n      typeof value === \"string\"\n        ? value\n        : getPreEvaluatedRaw(value as PreEvaluated);\n    if (isTrackAll(raw)) {\n      const result = trackAll(raw);\n      if (result) {\n        contextNames = result.context;\n        stateNames = result.state;\n        formStateNames = result.formState;\n      }\n    } else {\n      contextNames = track(raw, \"track context\", \"CTX\");\n      stateNames = track(raw, \"track state\", \"STATE\");\n      formStateNames = track(raw, \"track formstate\", \"FORM_STATE\");\n    }\n  }\n\n  return { contextNames, stateNames, formStateNames };\n}\n","import { isObject } from \"@next-core/utils/general\";\nimport { asyncComputeRealValue, computeRealValue } from \"./computeRealValue.js\";\nimport { TrackingContextItem } from \"./listenOnTrackingContext.js\";\nimport type { AsyncPropertyEntry, RuntimeContext } from \"../interfaces.js\";\nimport { StateOfUseBrick } from \"./getNextStateOfUseBrick.js\";\nimport { getTracks } from \"./getTracks.js\";\n\nexport function asyncComputeRealPropertyEntries(\n  properties: Record<string, unknown> | undefined,\n  runtimeContext: RuntimeContext,\n  trackingContextList: TrackingContextItem[]\n): AsyncPropertyEntry[] {\n  if (isObject(properties)) {\n    return Object.entries(properties).map<[string, Promise<unknown>]>(\n      ([propName, propValue]) => {\n        const { contextNames, stateNames, formStateNames } =\n          getTracks(propValue);\n        if (contextNames || stateNames || formStateNames) {\n          trackingContextList.push({\n            contextNames,\n            stateNames,\n            formStateNames,\n            propName,\n            propValue,\n          });\n        }\n        // Related: https://github.com/facebook/react/issues/11347\n        const asyncValue = asyncComputeRealValue(propValue, runtimeContext, {\n          $$lazyForUseBrick: true,\n          $$stateOfUseBrick:\n            propName === \"useBrick\"\n              ? StateOfUseBrick.USE_BRICK\n              : StateOfUseBrick.INITIAL,\n        });\n        return [propName, asyncValue];\n      }\n    );\n  }\n\n  return [];\n}\n\nexport async function computePropertyValue(\n  asyncPropertyEntries: AsyncPropertyEntry[],\n  propName: string\n): Promise<unknown> {\n  for (const [name, asyncValue, ignoreUndefined] of asyncPropertyEntries) {\n    if (name === propName) {\n      const value = await asyncValue;\n      if (value !== undefined || !ignoreUndefined) {\n        return value;\n      }\n    }\n  }\n}\n\nexport async function constructAsyncProperties(\n  asyncPropertyEntries: AsyncPropertyEntry[]\n): Promise<Record<string, unknown>> {\n  const props: Record<string, unknown> = {};\n  for (const [propName, asyncValue, ignoreUndefined] of asyncPropertyEntries) {\n    const value = await asyncValue;\n    if (\n      (value !== undefined || !ignoreUndefined) &&\n      // For `style` and `dataset`, only object is acceptable.\n      ((propName !== \"style\" && propName !== \"dataset\") || isObject(value))\n    ) {\n      props[propName] = value;\n    }\n  }\n  return props;\n}\n\nexport function computeRealProperties(\n  properties: Record<string, unknown> | undefined,\n  runtimeContext: RuntimeContext\n): Record<string, unknown> {\n  if (isObject(properties)) {\n    return Object.fromEntries(\n      Object.entries(properties)\n        .map<[string, unknown] | undefined>(([propName, propValue]) => {\n          // Related: https://github.com/facebook/react/issues/11347\n          const realValue = computeRealValue(propValue, runtimeContext, {\n            $$lazyForUseBrick: true,\n            $$stateOfUseBrick:\n              propName === \"useBrick\"\n                ? StateOfUseBrick.USE_BRICK\n                : StateOfUseBrick.INITIAL,\n          });\n          // For `style` and `dataset`, only object is acceptable.\n          if (\n            (propName !== \"style\" && propName !== \"dataset\") ||\n            isObject(realValue)\n          ) {\n            return [propName, realValue];\n          }\n        })\n        .filter(Boolean) as [string, unknown][]\n    );\n  }\n\n  return {};\n}\n","export function setRealProperties(\n  brick: HTMLElement,\n  realProps: Record<string, unknown> | undefined\n): void {\n  if (!realProps) {\n    return;\n  }\n  for (const [propName, propValue] of Object.entries(realProps)) {\n    switch (propName) {\n      case \"style\":\n      case \"dataset\":\n        for (const [k, v] of Object.entries(\n          propValue as Record<string, unknown>\n        )) {\n          (brick[propName] as unknown as Record<string, unknown>)[k] = v;\n        }\n        break;\n      case \"constructor\":\n      case \"__proto__\":\n      case \"innerHTML\":\n        // `innerHTML` is dangerous, use `textContent` instead.\n        throw new Error(`set \\`${propName}\\` is prohibited`);\n      default:\n        (brick as unknown as Record<string, unknown>)[propName] = propValue;\n    }\n  }\n}\n","import { computeRealProperties } from \"./computeRealProperties.js\";\nimport { setRealProperties } from \"./setRealProperties.js\";\nimport type { RuntimeContext } from \"../interfaces.js\";\n\nexport function setProperties(\n  bricks: HTMLElement | HTMLElement[],\n  properties: Record<string, unknown>,\n  runtimeContext: RuntimeContext\n): void {\n  const realProps = computeRealProperties(properties, runtimeContext);\n  if (!Array.isArray(bricks)) {\n    bricks = [bricks];\n  }\n  bricks.forEach((brick) => {\n    setRealProperties(brick, realProps);\n  });\n}\n","import { setProperties } from \"./setProperties.js\";\nimport type { RuntimeBrick, RuntimeContext } from \"../interfaces.js\";\nimport { getTplStateStore } from \"../CustomTemplates/utils.js\";\nimport { getFormStateStore } from \"../FormRenderer/utils.js\";\n\nexport interface TrackingContextItem {\n  contextNames: string[] | Set<string> | false;\n  stateNames: string[] | Set<string> | false;\n  formStateNames: string[] | Set<string> | false;\n  propName: string;\n  propValue: unknown;\n}\n\nexport interface InitialTracker {\n  disposes: (() => void)[];\n  listener: () => void;\n}\n\nexport function listenOnTrackingContext(\n  brick: RuntimeBrick,\n  trackingContextList: TrackingContextItem[]\n): void {\n  for (const track of trackingContextList) {\n    const listener = (): void => {\n      if (brick.element) {\n        setProperties(\n          brick.element,\n          { [track.propName]: track.propValue },\n          brick.runtimeContext\n        );\n      }\n    };\n    brick.disposes ??= [];\n    if (track.contextNames) {\n      for (const contextName of track.contextNames) {\n        brick.disposes.push(\n          brick.runtimeContext.ctxStore.onChange(contextName, listener)\n        );\n      }\n    }\n    if (track.stateNames) {\n      const tplStateStore = getTplStateStore(\n        brick.runtimeContext,\n        \"STATE\",\n        `: \"${track.propValue}\"`\n      );\n      for (const stateName of track.stateNames) {\n        brick.disposes.push(tplStateStore.onChange(stateName, listener));\n      }\n    }\n    if (track.formStateNames) {\n      const formStateStore = getFormStateStore(\n        brick.runtimeContext,\n        \"FORM_STATE\",\n        `: \"${track.propValue}\"`\n      );\n      for (const stateName of track.formStateNames) {\n        brick.disposes.push(formStateStore.onChange(stateName, listener));\n      }\n    }\n  }\n}\n\nexport function trackAfterInitial(\n  runtimeContext: RuntimeContext,\n  trackingContextList: Pick<\n    TrackingContextItem,\n    \"contextNames\" | \"stateNames\" | \"propValue\"\n  >[],\n  initialTracker: InitialTracker | undefined\n) {\n  if (!initialTracker) {\n    return;\n  }\n  for (const { contextNames, stateNames, propValue } of trackingContextList) {\n    if (contextNames) {\n      for (const contextName of contextNames) {\n        initialTracker.disposes.push(\n          runtimeContext.ctxStore.onChange(contextName, initialTracker.listener)\n        );\n      }\n    }\n    if (stateNames) {\n      for (const stateName of stateNames) {\n        const tplStateStore = getTplStateStore(\n          runtimeContext,\n          \"STATE\",\n          `: \"${propValue}\"`\n        );\n        initialTracker.disposes.push(\n          tplStateStore.onChange(stateName, initialTracker.listener)\n        );\n      }\n    }\n  }\n}\n","// Ref https://github.com/ReactTraining/react-router/blob/master/packages/react-router/modules/matchPath.js\nimport type { LegacyCompatibleRuntimeContext } from \"@next-core/inject\";\nimport { pathToRegexp, Key, compile } from \"path-to-regexp\";\n\nconst cache: Map<string, Map<string, CompileResult>> = new Map();\nconst cacheLimit = 10000;\nlet cacheCount = 0;\n\nfunction compilePath(path: string, options: CompileOptions): CompileResult {\n  const cacheKey = `${options.end}${options.strict}${options.sensitive}`;\n  let pathCache = cache.get(cacheKey);\n  if (!pathCache) {\n    cache.set(cacheKey, (pathCache = new Map()));\n  }\n\n  const cacheResult = pathCache.get(path);\n  if (cacheResult) {\n    return cacheResult;\n  }\n\n  const keys: Key[] = [];\n  const regexp = pathToRegexp(path, keys, options);\n  const result = { regexp, keys };\n\n  if (cacheCount < cacheLimit) {\n    pathCache.set(path, result);\n    cacheCount++;\n  }\n\n  return result;\n}\n\n/**\n * Public API for matching a URL pathname to a path.\n */\nexport function matchPath(\n  pathname: string,\n  options: MatchPathOptions\n): MatchResult | null {\n  const { path: p, exact = false, strict = false, sensitive = true } = options;\n\n  const paths = Array.isArray(p) ? p : [p];\n\n  return paths.reduce<MatchResult | null>((matched, path) => {\n    if (matched) {\n      return matched;\n    }\n    const { regexp, keys } = compilePath(path, {\n      end: exact,\n      strict,\n      sensitive,\n    });\n    const match = regexp.exec(pathname);\n\n    if (!match) {\n      return null;\n    }\n\n    const [url, ...values] = match;\n    const isExact = pathname === url;\n\n    if (exact && !isExact) {\n      return null;\n    }\n\n    const initialParams: MatchResult[\"params\"] = {};\n    const result = {\n      path, // the path used to match\n      url: path === \"/\" && url === \"\" ? \"/\" : url, // the matched portion of the URL\n      isExact, // whether or not we matched exactly\n      params: keys.reduce((memo, key, index) => {\n        memo[key.name] = values[index];\n        return memo;\n      }, initialParams),\n    };\n\n    return result;\n  }, null);\n}\n\nexport function toPath(\n  path: string,\n  pathParams?: Record<string, unknown>\n): string {\n  return compile(path)(pathParams);\n}\n\ninterface CompileOptions {\n  end?: boolean;\n  strict?: boolean;\n  sensitive?: boolean;\n}\n\ninterface CompileResult {\n  regexp: RegExp;\n  keys: Key[];\n}\n\nexport interface MatchOptions {\n  path: string | string[];\n  exact?: boolean;\n}\n\nexport type MatchPathOptions = MatchOptions & CompileOptions;\n\nexport type MatchResult = Exclude<\n  LegacyCompatibleRuntimeContext[\"match\"],\n  undefined\n>;\n","import type { RouteConf } from \"@next-core/types\";\nimport { MatchResult, matchPath } from \"./matchPath.js\";\nimport { asyncCheckIf } from \"./compute/checkIf.js\";\nimport type { RuntimeContext } from \"./interfaces.js\";\nimport { hooks } from \"./Runtime.js\";\n\ntype MatchRoutesResult =\n  | {\n      match: MatchResult;\n      route: RouteConf;\n    }\n  | \"missed\"\n  | \"unauthenticated\";\n\nexport async function matchRoutes(\n  routes: RouteConf[],\n  runtimeContext: RuntimeContext\n): Promise<MatchRoutesResult> {\n  for (const route of routes) {\n    if (typeof route.path !== \"string\") {\n      // eslint-disable-next-line no-console\n      console.error(\"Invalid route with invalid path:\", route);\n      throw new Error(\n        `Invalid route with invalid type of path: ${typeof route.path}`\n      );\n    }\n    const match = matchRoute(\n      route,\n      runtimeContext.app.homepage,\n      runtimeContext.location.pathname\n    );\n    if (match && (await asyncCheckIf(route, runtimeContext))) {\n      if (\n        runtimeContext.app.noAuthGuard ||\n        route.public ||\n        !hooks?.auth ||\n        hooks.auth.isLoggedIn()\n      ) {\n        return { match, route };\n      }\n      return \"unauthenticated\";\n    }\n  }\n  return \"missed\";\n}\n\nexport function matchRoute(\n  route: RouteConf,\n  homepage: string,\n  pathname: string\n) {\n  const routePath = route.path.replace(/^\\$\\{APP.homepage\\}/, homepage);\n  return matchPath(pathname, {\n    path: routePath,\n    exact: route.exact,\n  });\n}\n","import type { BrickConf } from \"@next-core/types\";\nimport type { AsyncPropertyEntry } from \"../interfaces.js\";\n\nexport const symbolForAsyncComputedPropsFromHost = Symbol.for(\n  \"tpl.asyncComputedPropsFromHost\"\n);\nexport const symbolForTplStateStoreId = Symbol.for(\"tpl.stateStoreId\");\nexport const symbolForTPlExternalForEachItem = Symbol.for(\n  \"tpl.externalForEachItem\"\n);\nexport const symbolForTPlExternalForEachIndex = Symbol.for(\n  \"tpl.externalForEachIndex\"\n);\nexport const symbolForTPlExternalForEachSize = Symbol.for(\n  \"tpl.externalForEachSize\"\n);\n\nexport type RuntimeBrickConfWithTplSymbols = BrickConf &\n  RuntimeBrickConfOfTplSymbols;\n\nexport interface RuntimeBrickConfOfTplSymbols {\n  [symbolForAsyncComputedPropsFromHost]?: AsyncPropertyEntry[];\n  [symbolForTplStateStoreId]?: string;\n  [symbolForTPlExternalForEachItem]?: unknown;\n  [symbolForTPlExternalForEachIndex]?: number;\n  [symbolForTPlExternalForEachSize]?: number;\n}\n","import type { ProviderPollOptions } from \"@next-core/types\";\nimport { pick } from \"lodash\";\nimport { _internalApiGetRenderId } from \"./Runtime.js\";\nimport { computeRealValue } from \"./compute/computeRealValue.js\";\nimport { RuntimeContext } from \"./interfaces.js\";\n\nexport type PollableCallbackFunction = (result?: unknown) => unknown;\n\nexport interface PollableCallback {\n  progress?: PollableCallbackFunction;\n  success?: PollableCallbackFunction;\n  error?: PollableCallbackFunction;\n  finally?: PollableCallbackFunction;\n}\n\nconst timeoutIdList = new Set<number>();\n\nexport function startPoll(\n  task: () => unknown,\n  { progress, success, error, finally: finallyCallback }: PollableCallback,\n  pollOptions: ProviderPollOptions,\n  runtimeContext: RuntimeContext\n): void {\n  const { expectPollStopImmediately, expectPollEnd } = pollOptions;\n  const { interval, leadingRequestDelay, continueOnError, delegateLoadingBar } =\n    computeRealValue(\n      pick(pollOptions, [\n        \"interval\",\n        \"leadingRequestDelay\",\n        \"continueOnError\",\n        \"delegateLoadingBar\",\n      ]),\n      runtimeContext\n    ) as ProviderPollOptions;\n  const currentRenderId = _internalApiGetRenderId();\n  let currentTimeoutId: number;\n  async function poll(): Promise<void> {\n    timeoutIdList.delete(currentTimeoutId);\n    let shouldStop: boolean | undefined;\n    try {\n      shouldStop = (\n        computeRealValue(expectPollStopImmediately, runtimeContext) as\n          | (() => boolean)\n          | undefined\n      )?.();\n      // Stop polling immediately when the expectation is match before task.\n      if (!shouldStop) {\n        const result = await task();\n        const expectPollStopImmediatelyResult = (\n          computeRealValue(expectPollStopImmediately, runtimeContext) as\n            | (() => boolean)\n            | undefined\n        )?.();\n        // Stop polling immediately when the expectation is match or a different router\n        // is rendering after the task processed.\n        shouldStop =\n          expectPollStopImmediatelyResult ||\n          currentRenderId !== _internalApiGetRenderId();\n        if (!shouldStop) {\n          progress?.(result);\n          if (\n            (\n              computeRealValue(expectPollEnd, runtimeContext) as\n                | ((result: unknown) => boolean)\n                | undefined\n            )?.(result)\n          ) {\n            if (delegateLoadingBar) {\n              window.dispatchEvent(new Event(\"request.end\"));\n            }\n            success?.(result);\n            finallyCallback?.();\n          } else {\n            delayedPoll(interval ?? 3000);\n          }\n        } else if (expectPollStopImmediatelyResult) {\n          finallyCallback?.();\n        }\n      } else {\n        finallyCallback?.();\n      }\n    } catch (e) {\n      const expectPollStopImmediatelyResult = (\n        computeRealValue(expectPollStopImmediately, runtimeContext) as\n          | (() => boolean)\n          | undefined\n      )?.();\n      // Stop polling immediately when the expectation is match or a different router\n      // is rendering after the task processed.\n      shouldStop =\n        expectPollStopImmediatelyResult ||\n        currentRenderId !== _internalApiGetRenderId();\n      if (!shouldStop) {\n        error?.(e);\n        if (continueOnError) {\n          delayedPoll(interval ?? 3000);\n        } else {\n          finallyCallback?.();\n        }\n      } else if (expectPollStopImmediatelyResult) {\n        finallyCallback?.();\n      }\n    } finally {\n      // Manually dispatch an event of `request.end` when the polling is stopped immediately.\n      if (delegateLoadingBar && shouldStop) {\n        window.dispatchEvent(new Event(\"request.end\"));\n      }\n    }\n  }\n\n  function delayedPoll(delay: number): void {\n    currentTimeoutId = setTimeout(poll, delay) as unknown as number;\n    timeoutIdList.add(currentTimeoutId);\n  }\n\n  delayedPoll(leadingRequestDelay ?? 0);\n\n  if (delegateLoadingBar) {\n    window.dispatchEvent(new Event(\"request.start\"));\n  }\n}\n\nexport function clearPollTimeout(): void {\n  for (const timeoutId of timeoutIdList) {\n    clearTimeout(timeoutId);\n  }\n  timeoutIdList.clear();\n}\n","export enum K {\n  REQUEST_FAILED = \"REQUEST_FAILED\",\n  SOMETHING_WENT_WRONG = \"SOMETHING_WENT_WRONG\",\n  LOGIN_TIMEOUT_MESSAGE = \"LOGIN_TIMEOUT_MESSAGE\",\n  NETWORK_ERROR = \"NETWORK_ERROR\",\n  LICENSE_EXPIRED = \"LICENSE_EXPIRED\",\n  NO_PERMISSION = \"NO_PERMISSION\",\n  PAGE_NOT_FOUND = \"PAGE_NOT_FOUND\",\n  APP_NOT_FOUND = \"APP_NOT_FOUND\",\n  UNKNOWN_ERROR = \"UNKNOWN_ERROR\",\n  GO_BACK_TO_PREVIOUS_PAGE = \"GO_BACK_TO_PREVIOUS_PAGE\",\n  GO_BACK_HOME = \"GO_BACK_HOME\",\n  RELOAD = \"RELOAD\",\n}\n\nconst en: Locale = {\n  [K.REQUEST_FAILED]: \"Request Failed\",\n  [K.SOMETHING_WENT_WRONG]: \"Something went wrong!\",\n  [K.LOGIN_TIMEOUT_MESSAGE]:\n    \"You haven't logged in or your login session has expired. Login right now?\",\n  [K.NETWORK_ERROR]: \"Network error, please check your network.\",\n  [K.LICENSE_EXPIRED]:\n    \"The license authorization has expired, please contact the platform administrator\",\n  [K.NO_PERMISSION]:\n    \"Unauthorized access, unable to retrieve the required resources for this page\",\n  [K.PAGE_NOT_FOUND]: \"Page not found, please check the URL\",\n  [K.APP_NOT_FOUND]:\n    \"App not found, maybe the URL is wrong or you don't have permission to access\",\n  [K.UNKNOWN_ERROR]: \"Oops! Something went wrong\",\n  [K.GO_BACK_TO_PREVIOUS_PAGE]: \"Go back to previous page\",\n  [K.GO_BACK_HOME]: \"Go back to home page\",\n  [K.RELOAD]: \"Reload\",\n};\n\nconst zh: Locale = {\n  [K.REQUEST_FAILED]: \"请求失败\",\n  [K.SOMETHING_WENT_WRONG]: \"出现了一些问题！\",\n  [K.LOGIN_TIMEOUT_MESSAGE]: \"您还未登录或登录信息已过期，现在重新登录？\",\n  [K.NETWORK_ERROR]: \"网络错误，请检查您的网络连接。\",\n  [K.LICENSE_EXPIRED]: \"License 授权失效，请联系平台管理员\",\n  [K.NO_PERMISSION]: \"没有权限，无法获取页面所需要的资源\",\n  [K.PAGE_NOT_FOUND]: \"请求的页面未找到，请确认 URL 是否正确\",\n  [K.APP_NOT_FOUND]: \"请求的微应用无法找到, 可能是 URL 错误或者无权限访问\",\n  [K.UNKNOWN_ERROR]: \"糟糕！页面出现了一些问题\",\n  [K.GO_BACK_TO_PREVIOUS_PAGE]: \"回到上一页\",\n  [K.GO_BACK_HOME]: \"回到首页\",\n  [K.RELOAD]: \"刷新\",\n};\n\nexport const NS = \"core/runtime\";\n\nexport const locales = { en, zh };\n\ntype Locale = { [key in K]: string };\n","let brick: {\n  resolve(options: DialogOptions): Promise<void>;\n};\n\nfunction show(options: DialogOptions): Promise<void> {\n  if (brick) {\n    return brick.resolve(options);\n  } else {\n    if (options.type === \"confirm\") {\n      const confirmed = confirm(options.content);\n      return new Promise((resolve, reject) =>\n        setTimeout(() => {\n          (confirmed ? resolve : reject)();\n        }, 1)\n      );\n    } else {\n      alert(options.content);\n      return new Promise((resolve) =>\n        setTimeout(() => {\n          resolve();\n        }, 1)\n      );\n    }\n  }\n}\n\nexport function loadDialogService(\n  tagName: string,\n  loader: (bricks: string[]) => Promise<void>\n) {\n  loader([tagName]).then(\n    () => {\n      brick = document.createElement(tagName) as any;\n    },\n    (error: unknown) => {\n      // eslint-disable-next-line no-console\n      console.error(\"Load dialog service failed:\", error);\n    }\n  );\n}\n\nexport interface DialogOptions {\n  type?: \"success\" | \"error\" | \"warn\" | \"info\" | \"confirm\";\n  title?: string | null;\n  content: string;\n  contentStyle?: object;\n}\n\nexport const Dialog = Object.freeze({\n  show,\n});\n","import { NextLocation } from \"./history.js\";\n\nexport function setLoginStateCookie(location: NextLocation): void {\n  // 独立打包应用 登录时间超时后还是由前端控制跳转，后台无法处理设置登录前的 path 和 query 的 cookie 值\n  // 此这场景下前端做下处理\n\n  const { search, pathname } = location;\n\n  const pathValue = pathname ? window.btoa(encodeURIComponent(pathname)) : \"\";\n\n  const searchValue = search ? window.btoa(encodeURIComponent(search)) : \"\";\n\n  document.cookie = `SALOGINPATH=${pathValue}; path=/`;\n  document.cookie = `SALOGINQUERY=${searchValue}; path=/`;\n}\n","import {\n  HttpAbortError,\n  HttpFetchError,\n  HttpResponseError,\n} from \"@next-core/http\";\nimport { i18n } from \"@next-core/i18n\";\nimport { getRuntime } from \"./internal/Runtime.js\";\nimport { getHistory } from \"./history.js\";\nimport { K, NS } from \"./internal/i18n.js\";\nimport { Dialog } from \"./Dialog.js\";\nimport { setLoginStateCookie } from \"./setLoginStateCookie.js\";\n\n/**\n * 将 http 请求错误转换为可读的字符串。\n *\n * @remarks\n *\n * 将依次尝试读取返回的 JSON 格式数据的字符串类型的 `error` 和 `msg` 字段，如果没有找到则返回 `error.toString()` 的结果。\n *\n * @param error - 错误对象。\n *\n * @returns 转换为字符串的错误信息。\n */\nexport function httpErrorToString(error: unknown): string {\n  if (error instanceof Event && error.target instanceof HTMLScriptElement) {\n    return error.target.src;\n  }\n  if (error instanceof HttpFetchError) {\n    return i18n.t(`${NS}:${K.NETWORK_ERROR}`);\n  }\n  if (error instanceof HttpResponseError) {\n    if (error.responseJson) {\n      if (typeof error.responseJson.error === \"string\") {\n        return error.responseJson.error;\n      } else if (typeof error.responseJson.msg === \"string\") {\n        return error.responseJson.msg;\n      }\n    }\n  }\n  if (error == null) {\n    return \"Unknown error\";\n  }\n  return error.toString();\n}\n\nexport function isUnauthenticatedError(error: unknown): boolean {\n  return (\n    error instanceof HttpResponseError &&\n    error.response.status === 401 &&\n    !!error.responseJson &&\n    error.responseJson.code === 100003\n  );\n}\n\nlet unauthenticatedConfirming = false;\n\nlet lastErrorMessage: string | undefined;\n\n/**\n * 处理 http 请求错误（使用 AntDesign 模态框弹出错误信息）。\n *\n * @param error - 错误对象。\n */\nexport function handleHttpError(error: unknown) {\n  // Do nothing if aborted http requests\n  if (error instanceof HttpAbortError) {\n    return;\n  }\n\n  // Redirect to login page if not logged in.\n  if (isUnauthenticatedError(error) && !window.NO_AUTH_GUARD) {\n    if (unauthenticatedConfirming) {\n      return;\n    }\n    unauthenticatedConfirming = true;\n    Dialog.show({\n      type: \"confirm\",\n      content: i18n.t(`${NS}:${K.LOGIN_TIMEOUT_MESSAGE}`),\n    }).then(\n      () => {\n        redirectToLogin();\n        unauthenticatedConfirming = false;\n      },\n      () => {\n        unauthenticatedConfirming = false;\n      }\n    );\n    return;\n  }\n\n  // eslint-disable-next-line no-console\n  console.error(error);\n\n  const message = httpErrorToString(error);\n  if (message !== lastErrorMessage) {\n    lastErrorMessage = message;\n    Dialog.show({\n      type: \"error\",\n      title: i18n.t(`${NS}:${K.REQUEST_FAILED}`),\n      content: message,\n      contentStyle: {\n        whiteSpace: \"pre-wrap\",\n        wordBreak: \"break-word\",\n      },\n    }).then(() => {\n      lastErrorMessage = undefined;\n    });\n  }\n  return;\n}\n\nfunction redirectToLogin() {\n  const ssoEnabled = getRuntime().getFeatureFlags()[\"sso-enabled\"];\n  const history = getHistory();\n  setLoginStateCookie(history.location);\n  history.push(ssoEnabled ? \"/sso-auth/login\" : \"/auth/login\", {\n    from: {\n      ...history.location,\n      state: undefined,\n    },\n  });\n}\n","let brick: {\n  resolve(options: NotificationOptions): void;\n};\n\nfunction show(options: NotificationOptions) {\n  if (brick) {\n    brick.resolve(options);\n  } else {\n    alert(options.message);\n  }\n}\n\nexport function loadNotificationService(\n  tagName: string,\n  loader: (bricks: string[]) => Promise<void>\n) {\n  loader([tagName]).then(\n    () => {\n      brick = document.createElement(tagName) as any;\n    },\n    (error: unknown) => {\n      // eslint-disable-next-line no-console\n      console.error(\"Load notification service failed:\", error);\n    }\n  );\n}\n\nexport interface NotificationOptions {\n  type?: \"success\" | \"error\" | \"warn\" | \"info\";\n  message: string;\n}\n\nexport const Notification = Object.freeze({\n  show,\n});\n","import type {\n  BrickEventHandler,\n  BrickEventHandlerCallback,\n  BrickEventsMap,\n  BuiltinBrickEventHandler,\n  CustomBrickEventHandler,\n  ExecuteCustomBrickEventHandler,\n  ProviderPollOptions,\n  SetPropsCustomBrickEventHandler,\n  SiteTheme,\n  UseProviderEventHandler,\n  ConditionalEventHandler,\n  BatchUpdateContextItem,\n} from \"@next-core/types\";\nimport { isEvaluable } from \"@next-core/cook\";\nimport { isObject } from \"@next-core/utils/general\";\nimport { checkIf } from \"./compute/checkIf.js\";\nimport { computeRealValue } from \"./compute/computeRealValue.js\";\nimport { getHistory } from \"../history.js\";\nimport { getProviderBrick } from \"./data/getProviderBrick.js\";\nimport { PollableCallback, startPoll } from \"./poll.js\";\nimport { isPreEvaluated } from \"./compute/evaluate.js\";\nimport { setProperties } from \"./compute/setProperties.js\";\nimport { applyMode, applyTheme } from \"../themeAndMode.js\";\nimport type {\n  ElementHolder,\n  RuntimeBrickElement,\n  RuntimeContext,\n} from \"./interfaces.js\";\nimport {\n  getTplHostElement,\n  getTplStateStore,\n} from \"./CustomTemplates/utils.js\";\nimport { handleHttpError } from \"../handleHttpError.js\";\nimport { Notification } from \"../Notification.js\";\nimport { getFormStateStore } from \"./FormRenderer/utils.js\";\nimport { DataStore } from \"./data/DataStore.js\";\nimport { hooks } from \"./Runtime.js\";\nimport { startSSEStream } from \"./sse.js\";\n\nexport function bindListeners(\n  brick: RuntimeBrickElement,\n  eventsMap: BrickEventsMap | undefined,\n  runtimeContext: RuntimeContext\n): void {\n  if (!eventsMap) {\n    return;\n  }\n  Object.entries(eventsMap).forEach(([eventType, handlers]) => {\n    const listener = listenerFactory(handlers, runtimeContext, {\n      element: brick,\n    });\n    brick.addEventListener(eventType, listener);\n\n    // Remember added listeners for unbinding.\n    if (!brick.$$listeners) {\n      brick.$$listeners = [];\n    }\n    brick.$$listeners.push([eventType, listener]);\n\n    // Remember added listeners for devtools.\n    if (!brick.$$eventListeners) {\n      brick.$$eventListeners = [];\n    }\n    for (const handler of ([] as BrickEventHandler[]).concat(handlers)) {\n      brick.$$eventListeners.push([eventType, null, handler]);\n    }\n  });\n}\n\nexport function unbindListeners(brick: RuntimeBrickElement): void {\n  if (brick.$$listeners) {\n    for (const [eventType, listener] of brick.$$listeners) {\n      brick.removeEventListener(eventType, listener);\n    }\n    brick.$$listeners.length = 0;\n  }\n}\n\nexport function isBuiltinHandler(\n  handler: BrickEventHandler\n): handler is BuiltinBrickEventHandler {\n  return typeof (handler as BuiltinBrickEventHandler).action === \"string\";\n}\n\nexport function isUseProviderHandler(\n  handler: BrickEventHandler\n): handler is UseProviderEventHandler {\n  return typeof (handler as UseProviderEventHandler).useProvider === \"string\";\n}\n\nexport function isCustomHandler(\n  handler: BrickEventHandler\n): handler is CustomBrickEventHandler {\n  return !!(\n    ((handler as CustomBrickEventHandler).target ||\n      (handler as CustomBrickEventHandler).targetRef) &&\n    ((handler as ExecuteCustomBrickEventHandler).method ||\n      (handler as SetPropsCustomBrickEventHandler).properties)\n  );\n}\n\nexport function isExecuteCustomHandler(\n  handler: CustomBrickEventHandler\n): handler is ExecuteCustomBrickEventHandler {\n  return !!(handler as ExecuteCustomBrickEventHandler).method;\n}\n\nexport function isSetPropsCustomHandler(\n  handler: CustomBrickEventHandler\n): handler is SetPropsCustomBrickEventHandler {\n  return !!(handler as SetPropsCustomBrickEventHandler).properties;\n}\n\nexport function isConditionalEventHandler(\n  handler: BrickEventHandler\n): handler is ConditionalEventHandler {\n  return !!(handler as ConditionalEventHandler).then;\n}\n\nexport function listenerFactory(\n  handlers: BrickEventHandler | BrickEventHandler[],\n  runtimeContext: RuntimeContext,\n  runtimeBrick?: ElementHolder\n) {\n  return function (event: Event): void {\n    for (const handler of ([] as BrickEventHandler[]).concat(handlers)) {\n      if (!checkIf(handler, { ...runtimeContext, event })) {\n        if (handler.else) {\n          listenerFactory(handler.else, runtimeContext, runtimeBrick)(event);\n        }\n        continue;\n      }\n\n      if (isConditionalEventHandler(handler)) {\n        listenerFactory(handler.then, runtimeContext, runtimeBrick)(event);\n      } else if (isBuiltinHandler(handler)) {\n        const [object, method] = handler.action.split(\".\") as any;\n        switch (handler.action) {\n          case \"history.push\":\n          case \"history.replace\":\n          case \"history.pushQuery\":\n          case \"history.replaceQuery\":\n          case \"history.pushAnchor\":\n          case \"history.block\":\n          case \"history.goBack\":\n          case \"history.goForward\":\n          case \"history.reload\":\n          case \"history.unblock\":\n            handleHistoryAction(\n              event,\n              method,\n              handler.args,\n              handler.callback,\n              runtimeContext\n            );\n            break;\n\n          // case \"segue.push\":\n          // case \"segue.replace\":\n          // case \"alias.push\":\n          // case \"alias.replace\":\n\n          case \"window.open\":\n            handleWindowOpenAction(event, handler.args, runtimeContext);\n            break;\n\n          case \"window.postMessage\":\n            handleWindowPostMessageAction(event, handler.args, runtimeContext);\n            break;\n\n          case \"parent.postMessage\":\n            handleParentPostMessageAction(event, handler.args, runtimeContext);\n            break;\n\n          case \"location.reload\":\n          case \"location.assign\":\n            handleLocationAction(event, method, handler.args, runtimeContext);\n            break;\n\n          case \"localStorage.setItem\":\n          case \"localStorage.removeItem\":\n          case \"sessionStorage.setItem\":\n          case \"sessionStorage.removeItem\":\n            handleStorageAction(\n              event,\n              object,\n              method,\n              handler.args,\n              runtimeContext\n            );\n            break;\n\n          case \"event.preventDefault\":\n            event.preventDefault();\n            break;\n          case \"event.stopPropagation\":\n            event.stopPropagation();\n            break;\n\n          case \"console.log\":\n          case \"console.error\":\n          case \"console.warn\":\n          case \"console.info\":\n            handleConsoleAction(event, method, handler.args, runtimeContext);\n            break;\n\n          case \"message.success\":\n          case \"message.error\":\n          case \"message.info\":\n          case \"message.warn\":\n            handleMessageAction(event, method, handler.args, runtimeContext);\n            break;\n\n          case \"handleHttpError\":\n            handleHttpError((event as CustomEvent).detail);\n            break;\n\n          case \"context.assign\":\n          case \"context.replace\":\n          case \"context.refresh\":\n          case \"context.load\":\n            handleContextAction(\n              event,\n              method,\n              handler.args,\n              handler.batch ?? true,\n              handler.callback,\n              runtimeContext\n            );\n            break;\n\n          case \"state.update\":\n          case \"state.refresh\":\n          case \"state.load\":\n            handleTplStateAction(\n              event,\n              method,\n              handler.args,\n              handler.batch ?? true,\n              handler.callback,\n              runtimeContext\n            );\n            break;\n\n          case \"tpl.dispatchEvent\": {\n            const [type, init] = argsFactory(\n              handler.args,\n              runtimeContext,\n              event\n            ) as [string, CustomEventInit];\n            const tplHostElement = getTplHostElement(\n              runtimeContext,\n              handler.action,\n              `: ${type}`\n            );\n            tplHostElement.dispatchEvent(new CustomEvent(type, init));\n            break;\n          }\n\n          case \"formstate.update\":\n            handleFormStateAction(\n              event,\n              handler.args,\n              handler.callback,\n              runtimeContext\n            );\n            break;\n\n          case \"message.subscribe\":\n          case \"message.unsubscribe\":\n            handleMessageDispatcher(\n              event,\n              method,\n              handler.args,\n              runtimeContext,\n              runtimeBrick,\n              handler.callback\n            );\n            break;\n\n          case \"theme.setDarkTheme\":\n          case \"theme.setLightTheme\":\n            applyTheme(\n              handler.action === \"theme.setDarkTheme\" ? \"dark\" : \"light\"\n            );\n            break;\n          case \"theme.setTheme\": {\n            const [theme] = argsFactory(handler.args, runtimeContext, event);\n            applyTheme(theme as SiteTheme);\n            break;\n          }\n          case \"mode.setDashboardMode\":\n          case \"mode.setDefaultMode\":\n            applyMode(\n              handler.action === \"mode.setDashboardMode\"\n                ? \"dashboard\"\n                : \"default\"\n            );\n            break;\n\n          // case \"menu.clearMenuTitleCache\":\n          // case \"menu.clearMenuCache\":\n\n          // case \"analytics.event\":\n\n          // case \"preview.debug\":\n\n          default:\n            // eslint-disable-next-line no-console\n            console.error(\"unknown event listener action:\", handler.action);\n        }\n      } else if (isUseProviderHandler(handler)) {\n        handleUseProviderAction(event, handler, runtimeContext, runtimeBrick);\n      } else if (isCustomHandler(handler)) {\n        handleCustomAction(event, handler, runtimeContext, runtimeBrick!);\n      } else {\n        // eslint-disable-next-line no-console\n        console.error(\"unknown event handler:\", handler);\n      }\n    }\n  };\n}\n\nfunction handleUseProviderAction(\n  event: Event,\n  handler: UseProviderEventHandler,\n  runtimeContext: RuntimeContext,\n  runtimeBrick?: ElementHolder\n) {\n  const method = handler.method !== \"saveAs\" ? \"resolve\" : \"saveAs\";\n  brickCallback(\n    event,\n    handler.useProvider,\n    handler,\n    method,\n    runtimeContext,\n    runtimeBrick\n  );\n}\n\nfunction handleCustomAction(\n  event: Event,\n  handler: CustomBrickEventHandler,\n  runtimeContext: RuntimeContext,\n  runtimeBrick: ElementHolder\n) {\n  let targets: HTMLElement[] = [];\n  const rawTarget = handler.target;\n  const rawTargetRef = handler.targetRef;\n  let computedTarget = rawTarget;\n  // Allow `target` to be set as evaluable string.\n  if (\n    typeof rawTarget === \"string\"\n      ? isEvaluable(rawTarget)\n      : isPreEvaluated(rawTarget)\n  ) {\n    computedTarget = computeRealValue(rawTarget, { ...runtimeContext, event });\n  }\n  if (typeof computedTarget === \"string\") {\n    if (computedTarget === \"_self\") {\n      targets.push(runtimeBrick.element!);\n    } else if (handler.multiple) {\n      targets = Array.from(document.querySelectorAll(computedTarget));\n    } else {\n      const found = document.querySelector(computedTarget) as HTMLElement;\n      if (found !== null) {\n        targets.push(found);\n      }\n    }\n  } else if (computedTarget) {\n    if (computedTarget instanceof HTMLElement) {\n      targets.push(computedTarget as HTMLElement);\n    } else {\n      // eslint-disable-next-line no-console\n      console.error(\"unexpected target:\", computedTarget);\n    }\n  } else if (rawTargetRef) {\n    let computedTargetRef = rawTargetRef;\n    // Allow `targetRef` to be set as evaluable string.\n    if (\n      typeof rawTargetRef === \"string\"\n        ? isEvaluable(rawTargetRef)\n        : isPreEvaluated(rawTargetRef)\n    ) {\n      computedTargetRef = computeRealValue(rawTargetRef, {\n        ...runtimeContext,\n        event,\n      }) as string | string[];\n    }\n    const targetRefs = ([] as string[]).concat(computedTargetRef);\n    const tplHostElement = getTplHostElement(\n      runtimeContext,\n      \"targetRef\",\n      `: ${targetRefs.join(\", \")}`\n    );\n    targets.push(\n      ...(targetRefs\n        .map((ref) => tplHostElement.$$getElementByRef?.(ref))\n        .filter(Boolean) as HTMLElement[])\n    );\n  }\n  if (targets.length === 0) {\n    // eslint-disable-next-line no-console\n    console.error(\"target not found:\", rawTarget || rawTargetRef);\n    return;\n  }\n  if (isExecuteCustomHandler(handler)) {\n    targets.forEach((target) => {\n      brickCallback(\n        event,\n        target,\n        handler,\n        handler.method,\n        runtimeContext,\n        runtimeBrick,\n        {\n          useEventAsDefault: true,\n        }\n      );\n    });\n  } else if (isSetPropsCustomHandler(handler)) {\n    setProperties(targets, handler.properties, {\n      ...runtimeContext,\n      event,\n    });\n  }\n}\n\nasync function brickCallback(\n  event: Event,\n  targetOrProvider: HTMLElement | string,\n  handler: ExecuteCustomBrickEventHandler | UseProviderEventHandler,\n  method: string,\n  runtimeContext: RuntimeContext,\n  runtimeBrick?: ElementHolder,\n  options?: ArgsFactoryOptions\n): Promise<void> {\n  const isProvider = isUseProviderHandler(handler);\n\n  const task = async (): Promise<unknown> => {\n    const realTarget = isProvider\n      ? await getProviderBrick(targetOrProvider as string)\n      : (targetOrProvider as HTMLElement);\n\n    if (typeof (realTarget as any)[method] !== \"function\") {\n      throw new Error(\n        `target <${realTarget.tagName.toLowerCase()}> has no method: ${method}`\n      );\n    }\n\n    let computedArgs = argsFactory(\n      handler.args,\n      runtimeContext,\n      event,\n      options\n    );\n    if (\n      isUseProviderHandler(handler) &&\n      hooks?.flowApi?.isFlowApiProvider(handler.useProvider)\n    ) {\n      computedArgs = await hooks.flowApi.getArgsOfFlowApi(\n        handler.useProvider,\n        computedArgs,\n        method,\n        handler.sse?.stream\n      );\n    }\n    return (realTarget as any)[method](...computedArgs);\n  };\n\n  if (!handler.callback) {\n    task();\n    return;\n  }\n\n  const callbackFactory = eventCallbackFactory(\n    handler.callback,\n    runtimeContext,\n    runtimeBrick\n  );\n\n  const pollableCallback: Required<PollableCallback> = {\n    progress: callbackFactory(\"progress\"),\n    success: callbackFactory(\"success\"),\n    error: callbackFactory(\"error\"),\n    finally: callbackFactory(\"finally\"),\n  };\n\n  if (isProvider) {\n    const pollRuntimeContext = {\n      ...runtimeContext,\n      event,\n    };\n\n    const sseStream = computeRealValue(\n      handler.sse?.stream,\n      pollRuntimeContext\n    ) as boolean | undefined;\n\n    if (sseStream) {\n      startSSEStream(\n        task as () => Promise<AsyncIterable<unknown>>,\n        pollableCallback\n      );\n      return;\n    }\n\n    const pollEnabled = computeRealValue(\n      handler.poll?.enabled,\n      pollRuntimeContext\n    ) as boolean | undefined;\n\n    if (pollEnabled) {\n      startPoll(\n        task,\n        pollableCallback,\n        handler.poll as ProviderPollOptions,\n        pollRuntimeContext\n      );\n\n      return;\n    }\n  }\n\n  try {\n    // Try to catch synchronized tasks too.\n    const result = await task();\n    pollableCallback.success(result);\n  } catch (err) {\n    pollableCallback.error(err);\n  } finally {\n    pollableCallback[\"finally\"]();\n  }\n}\n\nfunction handleHistoryAction(\n  event: Event,\n  method:\n    | \"push\"\n    | \"replace\"\n    | \"pushQuery\"\n    | \"replaceQuery\"\n    | \"pushAnchor\"\n    | \"block\"\n    | \"goBack\"\n    | \"goForward\"\n    | \"reload\"\n    | \"unblock\",\n  args: unknown[] | undefined,\n  callback: BrickEventHandlerCallback | undefined,\n  runtimeContext: RuntimeContext\n) {\n  let baseArgsLength = 0;\n  let hasCallback = false;\n  let overrideMethod = method as \"setBlockMessage\";\n  switch (method) {\n    case \"push\":\n    case \"replace\":\n    case \"pushQuery\":\n    case \"replaceQuery\":\n    case \"pushAnchor\":\n      baseArgsLength = 2;\n      hasCallback = true;\n      break;\n    case \"reload\":\n      hasCallback = true;\n      break;\n    case \"block\":\n      baseArgsLength = 1;\n      overrideMethod = \"setBlockMessage\";\n      break;\n  }\n  let computedArgs: unknown[] = [];\n  if (baseArgsLength > 0) {\n    computedArgs = argsFactory(args, runtimeContext, event, {\n      useEventDetailAsDefault: true,\n    });\n    computedArgs.length = baseArgsLength;\n  }\n  if (hasCallback && callback) {\n    const callbackFactory = eventCallbackFactory(\n      callback,\n      runtimeContext,\n      undefined\n    );\n    computedArgs.push((blocked: boolean) => {\n      callbackFactory(blocked ? \"error\" : \"success\")({ blocked });\n      callbackFactory(\"finally\")({ blocked });\n    });\n  }\n  (getHistory()[overrideMethod] as (...args: unknown[]) => unknown)(\n    ...computedArgs\n  );\n}\n\nfunction handleWindowOpenAction(\n  event: Event,\n  args: unknown[] | undefined,\n  runtimeContext: RuntimeContext\n) {\n  const [url, target, features] = argsFactory(args, runtimeContext, event) as [\n    string,\n    string,\n    string,\n  ];\n  window.open(url, target || \"_self\", features);\n}\n\nfunction handleWindowPostMessageAction(\n  event: Event,\n  args: unknown[] | undefined,\n  runtimeContext: RuntimeContext\n) {\n  const computedArgs = argsFactory(args, runtimeContext, event) as Parameters<\n    typeof window.postMessage\n  >;\n  if (computedArgs.length === 1) {\n    // Add default target origin\n    computedArgs.push(location.origin);\n  }\n  window.postMessage(...computedArgs);\n}\n\nfunction handleParentPostMessageAction(\n  event: Event,\n  args: unknown[] | undefined,\n  runtimeContext: RuntimeContext\n) {\n  if (parent === window) {\n    throw new Error(\"parent is the window itself\");\n  }\n  const computedArgs = argsFactory(args, runtimeContext, event) as Parameters<\n    typeof window.postMessage\n  >;\n  parent.postMessage(...computedArgs);\n}\n\nfunction batchUpdate(\n  args: unknown[],\n  batch: boolean,\n  method: \"replace\" | \"assign\",\n  store: DataStore<\"CTX\" | \"STATE\">,\n  runtimeContext: RuntimeContext,\n  event: CustomEvent | Event\n): void {\n  if (batch) {\n    store.updateValues(\n      args as BatchUpdateContextItem[],\n      method,\n      (arg: unknown[]) => {\n        return argsFactory(\n          arg,\n          runtimeContext,\n          event\n        )[0] as BatchUpdateContextItem;\n      }\n    );\n  } else {\n    args.forEach((arg) => {\n      const { name, value } = argsFactory(\n        [arg],\n        runtimeContext,\n        event\n      )[0] as BatchUpdateContextItem;\n      store.updateValue(name, value, method);\n    });\n  }\n}\n\nfunction handleContextAction(\n  event: Event,\n  method: \"assign\" | \"replace\",\n  args: unknown[] | undefined,\n  batch: boolean,\n  callback: BrickEventHandlerCallback | undefined,\n  runtimeContext: RuntimeContext\n) {\n  const isBatch = Array.isArray(args) && args.every(isObject);\n  if (isBatch && (method === \"assign\" || method === \"replace\")) {\n    batchUpdate(\n      args,\n      batch,\n      method,\n      runtimeContext.ctxStore,\n      runtimeContext,\n      event\n    );\n  } else {\n    const [name, value] = argsFactory(args, runtimeContext, event);\n    runtimeContext.ctxStore.updateValue(\n      name as string,\n      value,\n      method,\n      callback,\n      runtimeContext\n    );\n  }\n}\n\nfunction handleTplStateAction(\n  event: Event,\n  method: \"update\" | \"refresh\" | \"load\",\n  args: unknown[] | undefined,\n  batch: boolean,\n  callback: BrickEventHandlerCallback | undefined,\n  runtimeContext: RuntimeContext\n) {\n  const isBatch = Array.isArray(args) && args.every(isObject);\n  if (isBatch && method === \"update\") {\n    const tplStateStore = getTplStateStore(\n      runtimeContext,\n      `state.${method}`,\n      `: ${JSON.stringify(args)}`\n    );\n    batchUpdate(args, batch, \"replace\", tplStateStore, runtimeContext, event);\n  } else {\n    const [name, value] = argsFactory(args, runtimeContext, event);\n    const tplStateStore = getTplStateStore(\n      runtimeContext,\n      `state.${method}`,\n      `: ${name}`\n    );\n    tplStateStore.updateValue(\n      name as string,\n      value,\n      method === \"update\" ? \"replace\" : method,\n      callback,\n      runtimeContext\n    );\n  }\n}\n\nfunction handleFormStateAction(\n  event: Event,\n  args: unknown[] | undefined,\n  callback: BrickEventHandlerCallback | undefined,\n  runtimeContext: RuntimeContext\n) {\n  const [name, value] = argsFactory(args, runtimeContext, event);\n  const formStateStore = getFormStateStore(\n    runtimeContext,\n    \"formstate.update\",\n    `: ${name}`\n  );\n  formStateStore.updateValue(\n    name as string,\n    value,\n    \"replace\",\n    callback,\n    runtimeContext\n  );\n}\n\nfunction handleLocationAction(\n  event: Event,\n  method: \"assign\" | \"reload\",\n  args: unknown[] | undefined,\n  runtimeContext: RuntimeContext\n) {\n  if (method === \"assign\") {\n    const [url] = argsFactory(args, runtimeContext, event) as [string];\n    location.assign(url);\n  } else {\n    location[method]();\n  }\n}\n\nfunction handleStorageAction(\n  event: Event,\n  object: \"localStorage\" | \"sessionStorage\",\n  method: \"setItem\" | \"removeItem\",\n  args: unknown[] | undefined,\n  runtimeContext: RuntimeContext\n) {\n  const storage = object === \"localStorage\" ? localStorage : sessionStorage;\n  const [name, value] = argsFactory(args, runtimeContext, event);\n  if (method === \"setItem\") {\n    if (value !== undefined) {\n      storage.setItem(name as string, JSON.stringify(value));\n    }\n  } else {\n    storage.removeItem(name as string);\n  }\n}\n\nfunction handleConsoleAction(\n  event: Event,\n  method: \"log\" | \"error\" | \"warn\" | \"info\",\n  args: unknown[] | undefined,\n  runtimeContext: RuntimeContext\n) {\n  // eslint-disable-next-line no-console\n  console[method](\n    ...argsFactory(args, runtimeContext, event, {\n      useEventAsDefault: true,\n    })\n  );\n}\n\nfunction handleMessageAction(\n  event: Event,\n  method: \"success\" | \"error\" | \"info\" | \"warn\",\n  args: unknown[] | undefined,\n  runtimeContext: RuntimeContext\n) {\n  const computedArgs = argsFactory(args, runtimeContext, event, {\n    useEventAsDefault: true,\n  });\n  Notification.show({\n    type: method,\n    message: computedArgs[0] as string,\n  });\n}\n\nasync function handleMessageDispatcher(\n  event: Event,\n  method: \"subscribe\" | \"unsubscribe\",\n  args: unknown[] | undefined,\n  runtimeContext: RuntimeContext,\n  runtimeBrick?: ElementHolder,\n  callback?: BrickEventHandlerCallback\n) {\n  const task = () => {\n    const computedArgs = argsFactory(args, runtimeContext, event);\n    return hooks?.messageDispatcher?.[method](...computedArgs);\n  };\n  if (!callback) {\n    task();\n    return;\n  }\n  const callbackFactory = eventCallbackFactory(\n    callback,\n    runtimeContext,\n    runtimeBrick\n  );\n  try {\n    const result = await task();\n    callbackFactory(\"success\")(result);\n  } catch (error) {\n    callbackFactory(\"error\")(error);\n  } finally {\n    callbackFactory(\"finally\")();\n  }\n}\n\nexport function eventCallbackFactory(\n  callback: BrickEventHandlerCallback,\n  runtimeContext: RuntimeContext,\n  runtimeBrick?: ElementHolder\n) {\n  return function callbackFactory(\n    type: \"success\" | \"error\" | \"finally\" | \"progress\"\n  ) {\n    return function (result?: unknown) {\n      const handlers = callback?.[type];\n      if (handlers) {\n        try {\n          const event = new CustomEvent(`callback.${type}`, {\n            detail: result,\n          });\n          listenerFactory(handlers, runtimeContext, runtimeBrick)(event);\n        } catch (err) {\n          // Do not throw errors in `callback.success` or `callback.progress`,\n          // to avoid the following triggering of `callback.error`.\n          // eslint-disable-next-line\n          console.error(err);\n        }\n      } else if (type === \"error\") {\n        // eslint-disable-next-line\n        console.error(\"Unhandled callback error:\", result);\n      }\n    };\n  };\n}\n\ninterface ArgsFactoryOptions {\n  useEventAsDefault?: boolean;\n  useEventDetailAsDefault?: boolean;\n}\n\nfunction argsFactory(\n  args: unknown[] | undefined,\n  runtimeContext: RuntimeContext,\n  event: Event,\n  options: ArgsFactoryOptions = {}\n): unknown[] {\n  return Array.isArray(args)\n    ? (computeRealValue(args, {\n        ...runtimeContext,\n        event,\n      }) as unknown[])\n    : options.useEventAsDefault\n      ? [event]\n      : options.useEventDetailAsDefault\n        ? [(event as CustomEvent).detail]\n        : [];\n}\n","import { _internalApiGetRenderId } from \"./Runtime.js\";\nimport type { PollableCallback } from \"./poll.js\";\n\nexport async function startSSEStream(\n  task: () => Promise<AsyncIterable<unknown>>,\n  { progress, success, error, finally: finallyCallback }: PollableCallback\n) {\n  const currentRenderId = _internalApiGetRenderId();\n  try {\n    const stream = await task();\n    for await (const value of stream) {\n      if (currentRenderId !== _internalApiGetRenderId()) {\n        return;\n      }\n      progress?.(value);\n    }\n    if (currentRenderId !== _internalApiGetRenderId()) {\n      return;\n    }\n    success?.();\n  } catch (e) {\n    if (currentRenderId !== _internalApiGetRenderId()) {\n      return;\n    }\n    error?.(e);\n  } finally {\n    finallyCallback?.();\n  }\n}\n","import type { RuntimeBrick } from \"../interfaces.js\";\nimport { getTplStateStore } from \"./utils.js\";\n\nexport function bindTemplateProxy(brick: RuntimeBrick) {\n  const { ref, runtimeContext, element } = brick;\n\n  // Error recovering brick may have no runtimeContext.\n  if (!ref || !runtimeContext.tplStateStoreId) {\n    return;\n  }\n\n  const { hostBrick } = getTplStateStore(runtimeContext, \"bindTemplateProxy\");\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  const tplHostMetadata = hostBrick!.tplHostMetadata!;\n\n  tplHostMetadata.internalBricksByRef.set(ref, brick);\n\n  const events = tplHostMetadata.proxy?.events;\n  if (events) {\n    for (const [from, to] of Object.entries(events)) {\n      if (to.ref === ref) {\n        const listener = (e: Event) => {\n          if (e.bubbles) {\n            e.stopPropagation();\n          }\n          hostBrick!.element!.dispatchEvent(\n            new CustomEvent(from, {\n              detail: (e as CustomEvent).detail,\n              bubbles: e.bubbles,\n              cancelable: e.cancelable,\n              composed: e.composed,\n            })\n          );\n        };\n        const eventType = to.refEvent ?? from;\n        element!.addEventListener(eventType, listener);\n        element!.$$proxyListeners ??= [];\n        element!.$$proxyListeners.push([eventType, listener]);\n      }\n    }\n  }\n}\n\nexport function unbindTemplateProxy(brick: RuntimeBrick) {\n  const { ref, runtimeContext, element } = brick;\n\n  if (!runtimeContext?.tplStateStoreId || !ref) {\n    return;\n  }\n\n  const { hostBrick } = getTplStateStore(runtimeContext, \"unbindTemplateProxy\");\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  const tplHostMetadata = hostBrick!.tplHostMetadata!;\n\n  tplHostMetadata.internalBricksByRef.delete(ref);\n\n  for (const [type, fn] of element!.$$proxyListeners ?? []) {\n    element!.removeEventListener(type, fn);\n  }\n  delete element!.$$proxyListeners;\n}\n","export enum RenderTag {\n  ROOT = 1,\n  BRICK = 2,\n  PLACEHOLDER = 3,\n}\n","import { bindTemplateProxy } from \"./CustomTemplates/bindTemplateProxy.js\";\nimport { getTplStateStore } from \"./CustomTemplates/utils.js\";\nimport { bindListeners } from \"./bindListeners.js\";\nimport { setRealProperties } from \"./compute/setRealProperties.js\";\nimport { RenderTag } from \"./enums.js\";\nimport type {\n  RenderReturnNode,\n  RenderRoot,\n  RuntimeBrickElement,\n} from \"./interfaces.js\";\n\nexport function unmountTree(mountPoint: HTMLElement | DocumentFragment) {\n  mountPoint.replaceChildren();\n}\n\nexport function mountTree(\n  root: RenderRoot,\n  initializedElement?: RuntimeBrickElement\n): void {\n  window.DISABLE_REACT_FLUSH_SYNC = false;\n  let current = root.child;\n  const portalElements: RuntimeBrickElement[] = [];\n  while (current) {\n    if (current.tag === RenderTag.BRICK) {\n      const tagName = current.type;\n\n      if (tagName.includes(\"-\") && !customElements.get(tagName)) {\n        // eslint-disable-next-line no-console\n        console.error(`Undefined custom element: ${tagName}`);\n      }\n\n      // istanbul ignore if\n      if (tagName === \"basic-bricks.script-brick\") {\n        // eslint-disable-next-line no-console\n        console.warn(\n          \"`basic-bricks.script-brick` is deprecated, please take caution when using it\"\n        );\n      }\n\n      const element: RuntimeBrickElement =\n        initializedElement && current === root.child\n          ? initializedElement\n          : document.createElement(tagName);\n      current.element = element;\n\n      if (current.slotId) {\n        element.setAttribute(\"slot\", current.slotId);\n      }\n      if (current.iid) {\n        element.dataset.iid = current.iid;\n      }\n      if (current.tplHostMetadata?.tplStateStoreId) {\n        element.dataset.tplStateStoreId =\n          current.tplHostMetadata.tplStateStoreId;\n      }\n      setRealProperties(element, current.properties);\n      bindListeners(element, current.events, current.runtimeContext);\n      if (current.tplHostMetadata) {\n        // 先设置属性，再设置 `$$tplStateStore`，这样，当触发属性设置时，\n        // 避免初始化的一次 state update 操作及其 onChange 事件。\n        element.$$tplStateStore = getTplStateStore(\n          {\n            tplStateStoreId: current.tplHostMetadata.tplStateStoreId,\n            tplStateStoreMap: current.runtimeContext.tplStateStoreMap,\n          },\n          \"mount\"\n        );\n      }\n      bindTemplateProxy(current);\n\n      if (current.portal) {\n        portalElements.push(element);\n      } else if (current.return) {\n        if (!current.return.childElements) {\n          current.return.childElements = [];\n        }\n        current.return.childElements.push(element);\n      }\n    }\n\n    if (current.child) {\n      current = current.child;\n    } else if (current.sibling) {\n      current = current.sibling;\n    } else {\n      let currentReturn: RenderReturnNode | null | undefined = current.return;\n      while (currentReturn) {\n        // Append elements inside out\n        if (currentReturn.childElements) {\n          if (currentReturn.tag === RenderTag.ROOT) {\n            currentReturn.container?.append(...currentReturn.childElements);\n          } else {\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            currentReturn.element!.append(...currentReturn.childElements);\n          }\n          currentReturn.childElements = undefined;\n        }\n\n        if (currentReturn.tag === RenderTag.ROOT && portalElements.length > 0) {\n          const portal =\n            typeof currentReturn.createPortal === \"function\"\n              ? currentReturn.createPortal()\n              : currentReturn.createPortal;\n          portal.append(...portalElements);\n        }\n\n        if (currentReturn.sibling) {\n          break;\n        }\n        currentReturn = currentReturn.return;\n      }\n      current = currentReturn?.sibling;\n    }\n  }\n  setTimeout(() => {\n    window.DISABLE_REACT_FLUSH_SYNC = true;\n  });\n}\n","import type {\n  BrickEventHandler,\n  BrickLifeCycle,\n  MessageConf,\n  RouteConf,\n  ScrollIntoViewConf,\n  SlotConfOfRoutes,\n  StaticMenuConf,\n} from \"@next-core/types\";\nimport type { Action, Location } from \"history\";\nimport { isEmpty, remove } from \"lodash\";\nimport { listenerFactory } from \"./bindListeners.js\";\nimport { NextHistoryState, NextLocation, getHistory } from \"../history.js\";\nimport { getReadOnlyProxy } from \"./proxyFactories.js\";\nimport { Media, mediaEventTarget } from \"./mediaQuery.js\";\nimport type {\n  MenuRequestNode,\n  RenderBrick,\n  RenderChildNode,\n  RenderNode,\n  RenderReturnNode,\n  RenderRoot,\n} from \"./interfaces.js\";\nimport { mountTree } from \"./mount.js\";\nimport { RenderTag } from \"./enums.js\";\nimport { unbindTemplateProxy } from \"./CustomTemplates/bindTemplateProxy.js\";\nimport { hooks } from \"./Runtime.js\";\nimport type { RenderOutput } from \"./Renderer.js\";\n\ntype MemoizedLifeCycle<T> = {\n  [Key in keyof T]: {\n    brick: RenderBrick;\n    handlers: T[Key];\n  }[];\n};\n\ntype LocationChangeCallback = (\n  location: Location<NextHistoryState>,\n  prevLocation: Location<NextHistoryState>\n) => Promise<boolean | null>;\n\ninterface IncrementalRenderState {\n  parentRoutes: RouteConf[];\n  callback: LocationChangeCallback;\n}\n\nconst commonLifeCycles = [\n  \"onMount\",\n  \"onUnmount\",\n  \"onMediaChange\",\n  \"onScrollIntoView\",\n  \"onMessage\",\n  \"onMessageClose\",\n] as const;\n\nconst pageOnlyLifeCycles = [\n  \"onBeforePageLoad\",\n  \"onPageLoad\",\n  \"onPageLeave\",\n  \"onBeforePageLeave\",\n  \"onAnchorLoad\",\n  \"onAnchorUnload\",\n] as const;\n\nexport interface RendererContextOptions {\n  unknownBricks?: \"silent\" | \"throw\";\n  routeHelper?: RouteHelper;\n  renderId?: string;\n}\n\nexport interface RouteHelper {\n  bailout: (output: RenderOutput) => true | undefined;\n  mergeMenus: (menuRequests: Promise<StaticMenuConf>[]) => Promise<void>;\n  /** Will always resolve */\n  catch: (\n    error: unknown,\n    returnNode: RenderReturnNode,\n    isCurrentBootstrap?: boolean,\n    isReCatch?: boolean\n  ) => Promise<\n    | undefined\n    | {\n        failed: true;\n        output: RenderOutput;\n      }\n  >;\n}\n\nexport class RendererContext {\n  /**\n   * - page: render as whole page, triggering page life cycles.\n   * - fragment: render as fragment, not triggering page life cycles.\n   */\n  public readonly scope: \"page\" | \"fragment\";\n\n  public readonly unknownBricks: \"silent\" | \"throw\";\n\n  public readonly renderId: string | undefined;\n\n  #routeHelper: RouteHelper | undefined;\n\n  constructor(scope: \"page\" | \"fragment\", options?: RendererContextOptions) {\n    this.scope = scope;\n    this.unknownBricks = options?.unknownBricks ?? \"throw\";\n    this.#routeHelper = options?.routeHelper;\n    this.renderId = options?.renderId;\n  }\n\n  #memoizedLifeCycle: MemoizedLifeCycle<\n    Required<\n      Pick<\n        BrickLifeCycle,\n        | \"onBeforePageLoad\"\n        | \"onPageLoad\"\n        | \"onPageLeave\"\n        | \"onBeforePageLeave\"\n        | \"onAnchorLoad\"\n        | \"onAnchorUnload\"\n        | \"onMediaChange\"\n        | \"onScrollIntoView\"\n        | \"onMount\"\n        | \"onUnmount\"\n        | \"onMessage\"\n        | \"onMessageClose\"\n      >\n    >\n  > = {\n    onBeforePageLoad: [],\n    onPageLoad: [],\n    onPageLeave: [],\n    onBeforePageLeave: [],\n    onAnchorLoad: [],\n    onAnchorUnload: [],\n    onMediaChange: [],\n    onScrollIntoView: [],\n    onMount: [],\n    onUnmount: [],\n    onMessage: [],\n    onMessageClose: [],\n  };\n  #observers = new Map<RenderBrick, IntersectionObserver[]>();\n  #mediaListener: EventListener | undefined;\n\n  #arbitraryLifeCycle = new Map<string, Set<() => void>>();\n\n  #memoized?: WeakMap<\n    RenderNode,\n    Map<\n      string,\n      {\n        node?: RenderChildNode;\n        last?: RenderChildNode;\n        lastNormal?: RenderBrick | undefined;\n        lastPortal?: RenderBrick | undefined;\n      }\n    >\n  >;\n\n  #initialMenuRequestNode?: MenuRequestNode;\n  #memoizedMenuRequestNodeMap?: WeakMap<\n    RouteConf[],\n    MenuRequestNode | undefined\n  > = new WeakMap<RouteConf[], MenuRequestNode | undefined>();\n\n  setInitialMenuRequestNode(menuRequestNode: MenuRequestNode) {\n    this.#initialMenuRequestNode = menuRequestNode;\n  }\n\n  memoizeMenuRequestNode(\n    routes: RouteConf[],\n    menuRequestNode: MenuRequestNode\n  ) {\n    this.#memoizedMenuRequestNodeMap!.set(routes, menuRequestNode);\n  }\n\n  getMenuRequests() {\n    const menuRequests: Promise<StaticMenuConf>[] = [];\n    let current = this.#initialMenuRequestNode;\n    while (current) {\n      if (current.request) {\n        menuRequests.push(current.request);\n      }\n      if (current.child) {\n        current = current.child;\n      } else {\n        while (current && !current.sibling) {\n          current = current.return;\n        }\n        current = current?.sibling;\n      }\n    }\n    return menuRequests;\n  }\n\n  async reMergeMenuRequestNodes(\n    parentMenuRequestNode: MenuRequestNode,\n    routes: RouteConf[],\n    menuRequestNode: MenuRequestNode = {}\n  ) {\n    const node = this.#memoizedMenuRequestNodeMap!.get(routes);\n    this.#memoizedMenuRequestNodeMap!.set(routes, menuRequestNode);\n\n    let current = parentMenuRequestNode.child;\n    let previousSibling: MenuRequestNode | undefined;\n\n    while (current) {\n      if (current === node) {\n        break;\n      }\n      previousSibling = current;\n      current = current.sibling;\n    }\n\n    if (previousSibling) {\n      previousSibling.sibling = menuRequestNode;\n      menuRequestNode.sibling = node?.sibling;\n    } else {\n      parentMenuRequestNode.child = menuRequestNode;\n    }\n\n    await this.#routeHelper!.mergeMenus(this.getMenuRequests());\n  }\n\n  reBailout(output: RenderOutput) {\n    return this.#routeHelper!.bailout(output);\n  }\n\n  /**\n   * Will always resolve\n   */\n  reCatch(error: unknown, returnNode: RenderReturnNode) {\n    return this.#routeHelper!.catch(error, returnNode, false, true);\n  }\n\n  #incrementalRenderStates = new Map<\n    SlotConfOfRoutes,\n    IncrementalRenderState\n  >();\n\n  async didPerformIncrementalRender(\n    location: Location<NextHistoryState>,\n    prevLocation: Location<NextHistoryState>\n  ) {\n    let finalResult = false;\n    const shouldIgnoreRoutes: RouteConf[] = [];\n    // Perform incremental rendering from inside out.\n    // This allows nested incremental sub-routes.\n    for (const { parentRoutes, callback } of [\n      ...this.#incrementalRenderStates.values(),\n    ].reverse()) {\n      const parentRoute = parentRoutes[parentRoutes.length - 1];\n      if (shouldIgnoreRoutes.includes(parentRoute)) {\n        // Do not re-render parent routes if any of its children has performed incremental rendering.\n        // In the meantime, allow sibling-routes to perform incremental rendering.\n        continue;\n      }\n      const result = await callback(location, prevLocation);\n      // When result is null, it means the incremental rendering is tried but routes missed.\n      // In this case, we should continue to re-render the parent routes.\n      if (result) {\n        shouldIgnoreRoutes.push(...parentRoutes.slice(0, -1));\n      }\n      // Mark incremental rendering as performed at final if result is true or null.\n      if (result !== false) {\n        finalResult = true;\n      }\n    }\n    return finalResult;\n  }\n\n  /**\n   * When `callback` resolved to `true` which means incremental rendering is performed,\n   * ignore normal rendering.\n   */\n  performIncrementalRender(\n    slotConf: SlotConfOfRoutes,\n    parentRoutes: RouteConf[],\n    callback: LocationChangeCallback\n  ) {\n    // Override stale incremental render callbacks\n    this.#incrementalRenderStates.set(slotConf, { parentRoutes, callback });\n  }\n\n  registerBrickLifeCycle(\n    brick: RenderBrick,\n    lifeCycle: BrickLifeCycle | undefined\n  ): void {\n    if (!lifeCycle) {\n      return;\n    }\n    const lifeCycleTypes = [\n      ...commonLifeCycles,\n      ...(this.scope === \"page\" ? pageOnlyLifeCycles : []),\n    ];\n    for (const key of lifeCycleTypes) {\n      const handlers = (lifeCycle as BrickLifeCycle)[key as \"onPageLoad\"];\n      if (handlers) {\n        this.#memoizedLifeCycle[key as \"onPageLoad\"].push({\n          brick,\n          handlers: handlers as BrickEventHandler | BrickEventHandler[],\n        });\n      }\n    }\n    // istanbul ignore next\n    if (!isEmpty((lifeCycle as { useResolves?: unknown }).useResolves)) {\n      // eslint-disable-next-line no-console\n      console.error(\"`lifeCycle.useResolves` is dropped in v3:\", lifeCycle);\n    }\n  }\n\n  registerArbitraryLifeCycle(lifeCycle: string, fn: () => void): void {\n    const arbitraryCallbacks = this.#arbitraryLifeCycle.get(lifeCycle);\n    if (arbitraryCallbacks) {\n      arbitraryCallbacks.add(fn);\n    } else {\n      this.#arbitraryLifeCycle.set(lifeCycle, new Set([fn]));\n    }\n  }\n\n  #unmountBricks(bricks: Set<RenderBrick>): void {\n    const lifeCycleTypes = [\n      ...commonLifeCycles,\n      ...(this.scope === \"page\" ? pageOnlyLifeCycles : []),\n    ];\n    const unmountList: {\n      brick: RenderBrick;\n      handlers: BrickEventHandler | BrickEventHandler[];\n    }[] = [];\n\n    // Clear life cycle handlers, record `onUnmount` at the same time\n    for (const key of lifeCycleTypes) {\n      const removed = remove(\n        this.#memoizedLifeCycle[key as \"onPageLoad\"],\n        (item) => bricks.has(item.brick)\n      );\n      if (key === \"onUnmount\") {\n        unmountList.push(...removed);\n      }\n    }\n\n    // Clear intersection observers\n    for (const brick of bricks) {\n      const observers = this.#observers.get(brick);\n      if (observers?.length) {\n        for (const observer of observers) {\n          observer.disconnect();\n        }\n        observers.length = 0;\n        this.#observers.delete(brick);\n      }\n\n      unbindTemplateProxy(brick);\n      delete brick.element?.$$tplStateStore;\n      // Also remove the element\n      brick.element?.remove();\n      // Dispose context listeners\n      brick.disposes?.forEach((dispose) => dispose());\n      delete brick.disposes;\n    }\n\n    // Dispatch unmount events\n    const unmountEvent = new CustomEvent(\"unmount\");\n    for (const { brick, handlers } of unmountList) {\n      listenerFactory(handlers, brick.runtimeContext, brick)(unmountEvent);\n    }\n  }\n\n  #initializeRerenderBricks(bricks: Set<RenderBrick>): void {\n    const mountEvent = new CustomEvent(\"mount\");\n    for (const { brick, handlers } of this.#memoizedLifeCycle.onMount) {\n      if (bricks.has(brick)) {\n        listenerFactory(handlers, brick.runtimeContext, brick)(mountEvent);\n      }\n    }\n\n    for (const { brick, handlers: conf } of this.#memoizedLifeCycle\n      .onScrollIntoView) {\n      if (bricks.has(brick)) {\n        this.#addObserver(brick, conf);\n      }\n    }\n  }\n\n  memoize(\n    slotId: string | undefined,\n    keyPath: number[],\n    node: RenderChildNode | undefined,\n    returnNode: RenderReturnNode\n  ) {\n    if (!this.#memoized) {\n      this.#memoized = new WeakMap();\n    }\n    const memKey = [slotId ?? \"\", ...keyPath].join(\".\");\n    let mem = this.#memoized.get(returnNode);\n    if (!mem) {\n      mem = new Map();\n      this.#memoized.set(returnNode, mem);\n    }\n\n    mem.set(memKey, {\n      node,\n      last: getLastNode(node),\n      lastNormal: getLastNormalNode(node),\n      lastPortal: getLastPortalNode(node),\n    });\n  }\n\n  reRender(\n    slotId: string | undefined,\n    keyPath: number[],\n    node: RenderChildNode | undefined,\n    returnNode: RenderReturnNode\n  ) {\n    const memKey = [slotId ?? \"\", ...keyPath].join(\".\");\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    const memoized = this.#memoized!.get(returnNode)!.get(memKey)!;\n    const {\n      node: prevNode,\n      last: prevLast,\n      lastNormal: prevLastNormal,\n      lastPortal: prevLastPortal,\n    } = memoized;\n\n    let insertBeforeChild: ChildNode | null;\n    const insertPortalBeforeChildCandidates: ChildNode[] = [];\n    if (prevNode?.tag === RenderTag.PLACEHOLDER) {\n      insertBeforeChild = getNextNormalNode(prevNode)?.element ?? null;\n      // Todo(steve): handle portal bricks from useBrick.\n      const nextSibling = getNextPortalNode(prevNode)?.element;\n      if (nextSibling) {\n        insertPortalBeforeChildCandidates.push(nextSibling);\n      }\n    } else {\n      insertBeforeChild = prevLastNormal?.element?.nextSibling ?? null;\n      let nextSibling = prevLastPortal?.element?.nextSibling;\n      while (nextSibling) {\n        insertPortalBeforeChildCandidates.push(nextSibling);\n        // Collect all portal bricks from useBrick, until found a normal portal\n        // brick other than from useBrick.\n        // Because useBrick could be removed during unmount.\n        if (\n          !(nextSibling instanceof HTMLElement && nextSibling.tagName === \"DIV\")\n        ) {\n          break;\n        }\n        nextSibling = nextSibling.nextSibling;\n      }\n    }\n\n    const last = getLastNode(node);\n    memoized.node = node;\n    memoized.last = last;\n    memoized.lastNormal = getLastNormalNode(node);\n    memoized.lastPortal = getLastPortalNode(node);\n\n    // Figure out the unchanged prev sibling and next sibling\n    let prevSibling: RenderChildNode | undefined;\n    let current = returnNode.child;\n    while (current && current !== prevLast) {\n      if (current.sibling === prevNode) {\n        prevSibling = current;\n        break;\n      }\n      current = current.sibling;\n    }\n\n    const fragment = document.createDocumentFragment();\n    const portalFragment = document.createDocumentFragment();\n    const renderRoot: RenderRoot = {\n      tag: RenderTag.ROOT,\n      container: fragment,\n      createPortal: portalFragment,\n      child: node,\n    };\n\n    // Override `return`\n    current = node;\n    while (current) {\n      current.return = renderRoot;\n      current = current.sibling;\n    }\n\n    // Unmount previous bricks, including their descendants\n    const removeBricks = getBrickRange(prevNode, prevLast);\n    this.#unmountBricks(removeBricks);\n\n    mountTree(renderRoot);\n\n    // Connect back\n    if (prevSibling) {\n      prevSibling.sibling = node;\n    } else {\n      returnNode.child = node;\n    }\n    if (last) {\n      last.sibling = prevLast?.sibling;\n    }\n\n    // Resume `return`\n    current = node;\n    while (current) {\n      current.return = returnNode;\n      current = current.sibling;\n    }\n\n    if (fragment.hasChildNodes()) {\n      if (returnNode.tag === RenderTag.ROOT) {\n        returnNode.container?.insertBefore(fragment, insertBeforeChild);\n      } else {\n        returnNode.element?.insertBefore(fragment, insertBeforeChild);\n      }\n    }\n\n    if (portalFragment.hasChildNodes()) {\n      let root: RenderNode | undefined = node;\n      while (root && root.return) {\n        root = root.return;\n      }\n      // istanbul ignore next\n      if (root?.tag !== RenderTag.ROOT) {\n        throw new Error(\n          \"Cannot find render root node. This is a bug of Brick Next, please report it.\"\n        );\n      }\n      const portal =\n        typeof root.createPortal === \"function\"\n          ? root.createPortal()\n          : root.createPortal;\n      let insertPortalBeforeChild: ChildNode | null = null;\n      for (const candidate of insertPortalBeforeChildCandidates) {\n        // Those candidates from useBrick could be removed during unmount.\n        // So we need to check if they are still in the portal.\n        if (portal.contains(candidate)) {\n          insertPortalBeforeChild = candidate;\n          break;\n        }\n      }\n      portal.insertBefore(portalFragment, insertPortalBeforeChild);\n    }\n\n    const newBricks = getBrickRange(node, last);\n    this.#initializeRerenderBricks(newBricks);\n  }\n\n  dispose(): void {\n    for (const list of Object.values(this.#memoizedLifeCycle)) {\n      list.length = 0;\n    }\n    for (const list of this.#observers.values()) {\n      for (const observer of list) {\n        observer.disconnect();\n      }\n      list.length = 0;\n    }\n    this.#observers.clear();\n    if (this.#mediaListener) {\n      mediaEventTarget.removeEventListener(\"change\", this.#mediaListener);\n      this.#mediaListener = undefined;\n    }\n    this.#memoized = undefined;\n    this.#arbitraryLifeCycle.clear();\n    this.#incrementalRenderStates.clear();\n    this.#memoizedMenuRequestNodeMap = undefined;\n  }\n\n  // Note: no `onScrollIntoView` and `onMessage`\n  #dispatchGeneralLifeCycle(\n    type:\n      | \"onBeforePageLoad\"\n      | \"onPageLoad\"\n      | \"onPageLeave\"\n      | \"onBeforePageLeave\"\n      | \"onAnchorLoad\"\n      | \"onAnchorUnload\"\n      | \"onMediaChange\"\n      | \"onMessageClose\"\n      | \"onMount\"\n      | \"onUnmount\",\n    event: Event\n  ): void {\n    // istanbul ignore next\n    if (\n      process.env.NODE_ENV === \"development\" &&\n      this.scope === \"fragment\" &&\n      pageOnlyLifeCycles.includes(type as \"onPageLoad\")\n    ) {\n      throw new Error(\n        `\\`lifeCycle.${type}\\` cannot be used in ${this.scope}.\\nThis is a bug of Brick Next, please report it.`\n      );\n    }\n    for (const { brick, handlers } of this.#memoizedLifeCycle[type]) {\n      listenerFactory(handlers, brick.runtimeContext, brick)(event);\n    }\n    const arbitraryCallbacks = this.#arbitraryLifeCycle.get(type);\n    if (arbitraryCallbacks) {\n      for (const fn of arbitraryCallbacks) {\n        fn();\n      }\n    }\n  }\n\n  dispatchBeforePageLoad(): void {\n    this.#dispatchGeneralLifeCycle(\n      \"onBeforePageLoad\",\n      new CustomEvent(\"page.beforeLoad\")\n    );\n  }\n\n  dispatchPageLoad(): void {\n    const event = new CustomEvent(\"page.load\");\n    this.#dispatchGeneralLifeCycle(\"onPageLoad\", event);\n    // Currently only for e2e testing\n    window.dispatchEvent(event);\n  }\n\n  dispatchBeforePageLeave(detail: {\n    location?: NextLocation;\n    action?: Action;\n  }): void {\n    this.#dispatchGeneralLifeCycle(\n      \"onBeforePageLeave\",\n      new CustomEvent(\"page.beforeLeave\", { detail })\n    );\n  }\n\n  dispatchPageLeave(): void {\n    this.#dispatchGeneralLifeCycle(\n      \"onPageLeave\",\n      new CustomEvent(\"page.leave\")\n    );\n  }\n\n  dispatchAnchorLoad(): void {\n    const { hash } = getHistory().location;\n    if (hash && hash !== \"#\") {\n      this.#dispatchGeneralLifeCycle(\n        \"onAnchorLoad\",\n        new CustomEvent(\"anchor.load\", {\n          detail: {\n            hash,\n            anchor: hash.substring(1),\n          },\n        })\n      );\n    } else {\n      this.#dispatchGeneralLifeCycle(\n        \"onAnchorUnload\",\n        new CustomEvent(\"anchor.unload\")\n      );\n    }\n  }\n\n  initializeScrollIntoView(): void {\n    for (const { brick, handlers: conf } of this.#memoizedLifeCycle\n      .onScrollIntoView) {\n      this.#addObserver(brick, conf);\n    }\n  }\n\n  #addObserver(brick: RenderBrick, conf: ScrollIntoViewConf) {\n    const threshold = conf.threshold ?? 0.1;\n    const observer = new IntersectionObserver(\n      (entries, observer) => {\n        entries.forEach((entry) => {\n          if (entry.isIntersecting) {\n            if (entry.intersectionRatio >= threshold) {\n              listenerFactory(\n                conf.handlers,\n                brick.runtimeContext,\n                brick\n              )(new CustomEvent(\"scroll.into.view\"));\n              observer.disconnect();\n            }\n          }\n        });\n      },\n      {\n        threshold,\n      }\n    );\n    observer.observe(brick.element!);\n    let list = this.#observers.get(brick);\n    if (!list) {\n      list = [];\n      this.#observers.set(brick, list);\n    }\n    list.push(observer);\n  }\n\n  initializeMediaChange(): void {\n    this.#mediaListener = (event) => {\n      this.#dispatchGeneralLifeCycle(\n        \"onMediaChange\",\n        new CustomEvent(\"media.change\", {\n          detail: getReadOnlyProxy((event as CustomEvent<Media>).detail),\n        })\n      );\n    };\n    mediaEventTarget.addEventListener(\"change\", this.#mediaListener);\n  }\n\n  initializeMessageDispatcher(): void {\n    for (const { brick, handlers: confList } of this.#memoizedLifeCycle\n      .onMessage) {\n      for (const conf of ([] as MessageConf[]).concat(confList)) {\n        hooks?.messageDispatcher?.onMessage(conf.channel, (detail) => {\n          listenerFactory(\n            conf.handlers,\n            brick.runtimeContext,\n            brick\n          )(new CustomEvent(\"message.push\", { detail }));\n        });\n      }\n    }\n\n    hooks?.messageDispatcher?.onClose(() => {\n      this.#dispatchGeneralLifeCycle(\n        \"onMessageClose\",\n        new CustomEvent(\"message.close\")\n      );\n    });\n  }\n\n  dispatchOnMount(): void {\n    this.#dispatchGeneralLifeCycle(\"onMount\", new CustomEvent(\"mount\"));\n  }\n\n  dispatchOnUnmount(): void {\n    this.#dispatchGeneralLifeCycle(\"onUnmount\", new CustomEvent(\"unmount\"));\n  }\n}\n\nfunction getLastNode(\n  node: RenderChildNode | undefined\n): RenderChildNode | undefined {\n  let last = node;\n  while (last?.sibling) {\n    last = last.sibling;\n  }\n  return last;\n}\n\nfunction getLastNormalNode(\n  node: RenderChildNode | undefined\n): RenderBrick | undefined {\n  return getSpecifiedNormalNode(node, false);\n}\n\nfunction getNextNormalNode(\n  node: RenderChildNode | undefined\n): RenderBrick | undefined {\n  return getSpecifiedNormalNode(node, true);\n}\n\nfunction getSpecifiedNormalNode(\n  node: RenderChildNode | undefined,\n  next: boolean\n): RenderBrick | undefined {\n  let last: RenderBrick | undefined;\n  let current = node;\n  while (current) {\n    if (current.tag === RenderTag.BRICK && !current.portal) {\n      if (next) {\n        return current;\n      }\n      last = current;\n    }\n    current = current.sibling;\n  }\n  return last;\n}\n\nfunction getLastPortalNode(\n  node: RenderChildNode | undefined\n): RenderBrick | undefined {\n  return getSpecifiedPortalNode(node, false);\n}\n\nfunction getNextPortalNode(\n  node: RenderChildNode | undefined\n): RenderBrick | undefined {\n  return getSpecifiedPortalNode(node, true);\n}\n\nfunction getSpecifiedPortalNode(\n  node: RenderChildNode | undefined,\n  next: boolean\n): RenderBrick | undefined {\n  let last: RenderBrick | undefined;\n  let current = node;\n  while (current) {\n    if (current.tag === RenderTag.BRICK && current.portal) {\n      if (next) {\n        return current;\n      }\n      last = current;\n    }\n    if (current.child) {\n      current = current.child;\n    } else if (current.sibling) {\n      current = current.sibling;\n    } else {\n      let currentReturn: RenderReturnNode | null | undefined = current.return;\n      while (currentReturn) {\n        if (currentReturn.sibling) {\n          break;\n        }\n        currentReturn = currentReturn.return;\n      }\n      current = currentReturn?.sibling;\n    }\n  }\n  return last;\n}\n\nfunction getBrickRange(\n  from: RenderChildNode | undefined,\n  to: RenderChildNode | undefined\n): Set<RenderBrick> {\n  const range = new Set<RenderBrick>();\n  let current = from;\n  while (current) {\n    if (current.tag === RenderTag.BRICK) {\n      range.add(current);\n    }\n    if (current.child) {\n      current = current.child;\n    } else if (current === to) {\n      break;\n    } else if (current.sibling) {\n      current = current.sibling;\n    } else {\n      let currentReturn: RenderReturnNode | null | undefined = current.return;\n      while (currentReturn && currentReturn !== to) {\n        if (currentReturn.sibling) {\n          break;\n        }\n        currentReturn = currentReturn.return;\n      }\n      if (currentReturn === to) {\n        break;\n      }\n      current = currentReturn?.sibling;\n    }\n  }\n  return range;\n}\n","import type { LegacyCompatibleRuntimeContext } from \"@next-core/inject\";\n\ntype RouteMatched = LegacyCompatibleRuntimeContext[\"match\"];\n\nconst routeMatchedMap = new Map<string, RouteMatched>();\n\nexport function setMatchedRoute(id: string, match: RouteMatched): void {\n  routeMatchedMap.set(id, match);\n}\n\nexport function getMatchedRoute(id: string): RouteMatched {\n  return routeMatchedMap.get(id);\n}\n\nexport function clearMatchedRoutes(): void {\n  return routeMatchedMap.clear();\n}\n","import type {\n  BrickConf,\n  CustomTemplate,\n  RouteConf,\n  Storyboard,\n  UseSingleBrickConf,\n  RuntimeSnippet,\n  ContextConf,\n  BrickPackage,\n  RouteConfOfBricks,\n} from \"@next-core/types\";\nimport { pick } from \"lodash\";\nimport {\n  _internalApiGetRenderId,\n  _internalApiGetRuntimeContext,\n  _internalApiGetStoryboardInBootstrapData,\n  getBrickPackages,\n} from \"./Runtime.js\";\nimport {\n  createScopedRuntimeContext,\n  postAsyncRender,\n  renderBrick,\n} from \"./Renderer.js\";\nimport { RendererContext } from \"./RendererContext.js\";\nimport type { DataStore } from \"./data/DataStore.js\";\nimport { resolveData } from \"./data/resolveData.js\";\nimport { asyncComputeRealValue } from \"./compute/computeRealValue.js\";\nimport type {\n  DataValueOption,\n  PreviewOption,\n  PreviewStoryboardPatch,\n  RenderRoot,\n  RuntimeContext,\n  DebugDataValue,\n  RuntimeDataVale,\n  RuntimeDataValueOption,\n} from \"./interfaces.js\";\nimport { mountTree, unmountTree } from \"./mount.js\";\nimport { RenderTag } from \"./enums.js\";\nimport { computeRealValue } from \"./compute/computeRealValue.js\";\nimport { isStrictMode, warnAboutStrictMode } from \"../isStrictMode.js\";\nimport { customTemplates } from \"../CustomTemplates.js\";\nimport { registerAppI18n } from \"./registerAppI18n.js\";\nimport { getTplStateStore } from \"./CustomTemplates/utils.js\";\nimport {\n  loadBricksImperatively,\n  loadEditorsImperatively,\n} from \"@next-core/loader\";\nimport { getMatchedRoute } from \"./routeMatchedMap.js\";\n\nexport type { DataValueOption, RuntimeContext };\n\nexport const symbolForRootRuntimeContext = Symbol.for(\"root.runtimeContext\");\n\nexport interface RuntimeUseBrickConfWithRootSymbols extends UseSingleBrickConf {\n  [symbolForRootRuntimeContext]?: RuntimeContext;\n}\n\nexport interface RenderUseBrickResult {\n  tagName: string | null;\n  renderRoot: RenderRoot;\n  rendererContext: RendererContext;\n  scopedStores: DataStore<\"STATE\" | \"FORM_STATE\">[];\n}\n\nexport async function renderUseBrick(\n  useBrick: RuntimeUseBrickConfWithRootSymbols,\n  data: unknown,\n  errorBoundary?: boolean\n): Promise<RenderUseBrickResult> {\n  const [scopedRuntimeContext, tplStateStoreScope, formStateStoreScope] =\n    createScopedRuntimeContext({\n      ...(useBrick[symbolForRootRuntimeContext] ??\n        _internalApiGetRuntimeContext()!),\n      data,\n      pendingPermissionsPreCheck: [],\n    });\n\n  scopedRuntimeContext.tplStateStoreMap ??= new Map();\n  scopedRuntimeContext.formStateStoreMap ??= new Map();\n\n  const rendererContext = new RendererContext(\"fragment\");\n\n  const renderRoot: RenderRoot = {\n    tag: RenderTag.ROOT,\n    // Will set during `mountUseBrick`\n    createPortal: null!,\n  };\n\n  const transform = (useBrick as { transform?: Record<string, unknown> })\n    .transform;\n  const strict = isStrictMode();\n  if (transform) {\n    warnAboutStrictMode(\n      strict,\n      \"`useBrick.transform`\",\n      'please use \"properties\" instead, check your useBrick:',\n      useBrick\n    );\n  }\n\n  const output = await renderBrick(\n    renderRoot,\n    strict && !errorBoundary\n      ? useBrick\n      : {\n          errorBoundary,\n          ...useBrick,\n          properties: {\n            ...useBrick.properties,\n            ...transform,\n          },\n        },\n    scopedRuntimeContext,\n    rendererContext,\n    [],\n    {}\n  );\n\n  const scopedStores = [...tplStateStoreScope, ...formStateStoreScope];\n\n  await postAsyncRender(output, scopedRuntimeContext, scopedStores);\n\n  if (output.node?.tag === RenderTag.PLACEHOLDER) {\n    throw new Error(\n      \"The root brick of useBrick cannot be an ignored control node\"\n    );\n  }\n\n  if (output.node?.portal) {\n    throw new Error(\"The root brick of useBrick cannot be a portal brick\");\n  }\n\n  renderRoot.child = output.node;\n\n  const tagName = output.node ? output.node.type : null;\n\n  return { tagName, renderRoot, rendererContext, scopedStores };\n}\n\nexport interface MountUseBrickResult {\n  portal?: HTMLElement;\n}\n\nexport function mountUseBrick(\n  { renderRoot, rendererContext, scopedStores }: RenderUseBrickResult,\n  element: HTMLElement\n): MountUseBrickResult {\n  let portal: HTMLElement | undefined;\n  renderRoot.createPortal = () => {\n    const portalRoot = document.querySelector(\n      \"#portal-mount-point\"\n    ) as HTMLElement;\n    portal = document.createElement(\"div\");\n    portalRoot.appendChild(portal);\n    return portal;\n  };\n\n  mountTree(renderRoot, element);\n\n  rendererContext.dispatchOnMount();\n  rendererContext.initializeScrollIntoView();\n  rendererContext.initializeMediaChange();\n  rendererContext.initializeMessageDispatcher();\n\n  for (const store of scopedStores) {\n    store.mountAsyncData();\n  }\n\n  return {\n    portal,\n  };\n}\n\nexport function unmountUseBrick(\n  { rendererContext }: RenderUseBrickResult,\n  mountResult: MountUseBrickResult\n): void {\n  // if (mountResult.mainBrick) {\n  //   mountResult.mainBrick.unmount();\n  // }\n  if (mountResult.portal) {\n    unmountTree(mountResult.portal);\n    mountResult.portal.remove();\n  }\n  rendererContext.dispatchOnUnmount();\n  rendererContext.dispose();\n}\n\n/** For v2 compatibility of `doTransform` from brick-kit. */\nexport function legacyDoTransform(\n  data: unknown,\n  to: unknown,\n  options?: unknown\n) {\n  if (options) {\n    throw new Error(\"Legacy doTransform does not support options in v3\");\n  }\n  return computeRealValue(\n    to,\n    {\n      ..._internalApiGetRuntimeContext()!,\n      data,\n    },\n    {\n      noInject: true,\n    }\n  );\n}\n\nexport function updateStoryboard(\n  appId: string,\n  storyboardPatch: Partial<Storyboard>\n): void {\n  const storyboard = _internalApiGetStoryboardInBootstrapData(appId)!;\n  Object.assign(storyboard, {\n    ...storyboardPatch,\n    meta: {\n      // Keep runtime fields such as `injectMenus`\n      ...storyboard.meta,\n      ...storyboardPatch.meta,\n    },\n    $$fulfilling: null,\n    $$fulfilled: true,\n    $$registerCustomTemplateProcessed: false,\n  });\n  registerAppI18n(storyboard);\n}\n\nexport function updateStoryboardByRoute(appId: string, newRoute: RouteConf) {\n  const storyboard = _internalApiGetStoryboardInBootstrapData(appId)!;\n  let matched = false;\n\n  function matchRoute(route: RouteConf) {\n    return route.path === newRoute.path && !route.exact === !newRoute.exact;\n  }\n\n  function replaceRoutes(routes: RouteConf[]) {\n    routes.forEach((route, index) => {\n      if (route.type === \"routes\") {\n        replaceRoutes(route.routes);\n      } else {\n        if (matchRoute(route)) {\n          matched = true;\n          routes[index] = newRoute;\n        } else if (Array.isArray((route as RouteConfOfBricks).bricks)) {\n          replaceBricks((route as RouteConfOfBricks).bricks);\n        }\n      }\n    });\n  }\n\n  function replaceBricks(bricks: BrickConf[]) {\n    bricks.forEach((brick) => {\n      if (brick.slots) {\n        for (const slotConf of Object.values(brick.slots)) {\n          if (slotConf.type === \"routes\") {\n            replaceRoutes(slotConf.routes);\n          } else {\n            replaceBricks(slotConf.bricks);\n          }\n        }\n      }\n    });\n  }\n\n  replaceRoutes(storyboard.routes);\n\n  if (!matched) {\n    storyboard.routes.unshift(newRoute);\n  }\n}\n\nexport function updateStoryboardByTemplate(\n  appId: string,\n  newTemplate: CustomTemplate,\n  settings: unknown\n): void {\n  const tplName = `${appId}.${newTemplate.name}`;\n  // customTemplateRegistry.delete(tplName);\n  customTemplates.define(tplName, {\n    bricks: newTemplate.bricks,\n    proxy: newTemplate.proxy,\n    state: newTemplate.state,\n  });\n  updateTemplatePreviewSettings(appId, newTemplate.name, settings);\n}\n\nexport function updateTemplatePreviewSettings(\n  appId: string,\n  templateId: string,\n  settings?: unknown\n): void {\n  _updatePreviewSettings(\n    appId,\n    `\\${APP.homepage}/_dev_only_/template-preview/${templateId}`,\n    [\n      {\n        brick: templateId,\n        ...pick(\n          settings,\n          \"properties\",\n          \"events\",\n          \"lifeCycle\",\n          \"context\",\n          \"slots\",\n          \"children\"\n        ),\n      },\n    ]\n  );\n}\n\nfunction getSnippetPreviewPath(snippetId: string): string {\n  return `\\${APP.homepage}/_dev_only_/snippet-preview/${snippetId}`;\n}\n\nexport function updateStoryboardBySnippet(\n  appId: string,\n  snippetData: {\n    snippetId: string;\n    bricks?: BrickConf[];\n    context?: ContextConf[];\n  }\n): void {\n  _updatePreviewSettings(\n    appId,\n    getSnippetPreviewPath(snippetData.snippetId),\n    snippetData.bricks?.length ? snippetData.bricks : [{ brick: \"span\" }],\n    snippetData.context\n  );\n}\n\nexport const updateSnippetPreviewSettings = updateStoryboardBySnippet;\n\nfunction _updatePreviewSettings(\n  appId: string,\n  path: string,\n  bricks: BrickConf[],\n  context?: ContextConf[]\n) {\n  const { routes } = _internalApiGetStoryboardInBootstrapData(appId)!;\n  const previewRouteIndex = routes.findIndex((route) => route.path === path);\n  const newPreviewRoute: RouteConf = {\n    path,\n    bricks,\n    context,\n    menu: false,\n    exact: true,\n  };\n  if (previewRouteIndex === -1) {\n    routes.unshift(newPreviewRoute);\n  } else {\n    routes.splice(previewRouteIndex, 1, newPreviewRoute);\n  }\n}\n\nexport function getContextValue(\n  name: string,\n  { tplStateStoreId }: DataValueOption\n): unknown {\n  const runtimeContext = _internalApiGetRuntimeContext()!;\n\n  if (tplStateStoreId) {\n    const tplStateStore = getTplStateStore(\n      {\n        ...runtimeContext,\n        tplStateStoreId,\n      },\n      \"STATE\"\n    );\n    return tplStateStore.getValue(name);\n  }\n\n  return runtimeContext.ctxStore.getValue(name);\n}\n\nexport function getAllContextValues({\n  tplStateStoreId,\n}: DataValueOption): Record<string, unknown> {\n  const runtimeContext = _internalApiGetRuntimeContext()!;\n\n  if (tplStateStoreId) {\n    const tplStateStore = getTplStateStore(\n      {\n        ...runtimeContext,\n        tplStateStoreId,\n      },\n      \"STATE\"\n    );\n    return tplStateStore.getAllValues();\n  }\n\n  return runtimeContext.ctxStore.getAllValues();\n}\n\nexport function getBrickPackagesById(id: string) {\n  return getBrickPackages().find((pkg) =>\n    pkg.id ? pkg.id === id : pkg.filePath.startsWith(`${id}/`)\n  );\n}\n\n/**\n * Support loading v3 bricks only.\n */\nexport function loadBricks(bricks: string[]) {\n  return loadBricksImperatively(bricks, getBrickPackages());\n}\n\n/**\n * Try the brick packages passed in, before using from bootstrap.\n */\nexport function loadEditors(\n  editors: string[] | Set<string>,\n  brickPackages?: BrickPackage[]\n) {\n  return loadEditorsImperatively(editors, brickPackages ?? getBrickPackages());\n}\n\nexport function getRenderId() {\n  return _internalApiGetRenderId();\n}\n\nexport async function getAddedContracts(\n  storyboardPatch: PreviewStoryboardPatch,\n  { appId, updateStoryboardType, collectUsedContracts }: PreviewOption\n): Promise<string[]> {\n  const storyboard = _internalApiGetStoryboardInBootstrapData(appId);\n  let updatedStoryboard;\n\n  // 拿到更新部分的 storyboard 配置，然后扫描一遍，找到新增的 contracts\n  if (updateStoryboardType === \"route\") {\n    updatedStoryboard = {\n      routes: [storyboardPatch as RouteConf],\n    } as Storyboard;\n  } else if (updateStoryboardType === \"template\") {\n    updatedStoryboard = {\n      meta: {\n        customTemplates: [storyboardPatch as CustomTemplate],\n      },\n    } as Storyboard;\n  } else if (updateStoryboardType === \"snippet\") {\n    // snippet 是放在挂载 route 里预览，通过 previewPath 拿到当前修改 route\n    const snippetPreviewPath = getSnippetPreviewPath(\n      (storyboardPatch as RuntimeSnippet).snippetId\n    );\n    const currentRoute = storyboard?.routes?.find(\n      (route) => route.path === snippetPreviewPath\n    );\n\n    updatedStoryboard = {\n      routes: [currentRoute],\n    } as Storyboard;\n  }\n\n  const addedContracts: string[] = [];\n\n  if (updatedStoryboard && collectUsedContracts) {\n    const contractApis = await collectUsedContracts(updatedStoryboard);\n\n    contractApis.forEach((api: string) => {\n      // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      const [_, namespaceId, name] = api.match(\n        /(.*)@(.*):\\d\\.\\d\\.\\d/\n      ) as string[];\n\n      if (\n        !storyboard?.meta?.contracts?.some(\n          (contract) =>\n            contract.namespaceId === namespaceId && contract.name === name\n        )\n      ) {\n        addedContracts.push(api);\n      }\n    });\n  }\n\n  return addedContracts;\n}\n\nexport async function debugDataValue(\n  debugData: DebugDataValue,\n  { tplStateStoreId, routeId }: DataValueOption\n): Promise<any> {\n  const runtimeContext = {\n    ..._internalApiGetRuntimeContext()!,\n    tplStateStoreId,\n    match: getMatchedRoute(routeId as string),\n  };\n\n  if (debugData.resolve) {\n    return resolveData(debugData.resolve!, runtimeContext, { cache: \"reload\" });\n  }\n\n  return asyncComputeRealValue(debugData.value, runtimeContext);\n}\n\nexport function getLegalRuntimeValue(\n  options?: RuntimeDataValueOption\n): RuntimeDataVale {\n  const runtimeContext = _internalApiGetRuntimeContext();\n\n  return {\n    app: runtimeContext?.overrideApp ?? runtimeContext?.app,\n    location: pick(location, [\"href\", \"origin\", \"hostname\", \"host\"]),\n    ...pick(runtimeContext, [\"query\", \"sys\"]),\n    match: getMatchedRoute(options?.routeId as string),\n  } as RuntimeDataVale;\n}\n\nexport {\n  setRealTimeDataInspectRoot,\n  addRealTimeDataInspectHook,\n} from \"./data/realTimeDataInspect.js\";\n","import { getAllContextValues } from \"../secret_internals.js\";\n\nexport interface RealTimeDataInspectRoot {\n  tplStateStoreId?: string;\n}\n\nexport type RealTimeDataInspectHook = (\n  detail: RealTimeDataInspectDetail\n) => void;\n\nexport type RealTimeDataInspectDetail =\n  | RealTimeDataInspectUpdateDetail\n  | RealTimeDataInspectInitializeDetail;\n\nexport interface RealTimeDataInspectUpdateDetail {\n  changeType: \"update\";\n  tplStateStoreId?: string;\n  detail: {\n    name: string;\n    value: unknown;\n  };\n}\n\nexport interface RealTimeDataInspectInitializeDetail {\n  changeType: \"initialize\";\n  tplStateStoreId?: string;\n  detail: {\n    data: Record<string, unknown>;\n  };\n}\n\nexport let realTimeDataInspectRoot: RealTimeDataInspectRoot | undefined;\n\nexport const RealTimeDataInspectHooks: RealTimeDataInspectHook[] = [];\n\nexport function setRealTimeDataInspectRoot(root: RealTimeDataInspectRoot) {\n  realTimeDataInspectRoot = root;\n\n  const data = getAllContextValues({ tplStateStoreId: root.tplStateStoreId });\n  callRealTimeDataInspectHooks({\n    changeType: \"initialize\",\n    tplStateStoreId: root.tplStateStoreId,\n    detail: { data },\n  });\n}\n\nexport function addRealTimeDataInspectHook(hook: RealTimeDataInspectHook) {\n  RealTimeDataInspectHooks.push(hook);\n}\n\nexport function callRealTimeDataInspectHooks(\n  detail: RealTimeDataInspectDetail\n) {\n  setTimeout(() => {\n    for (const hook of RealTimeDataInspectHooks) {\n      try {\n        hook(detail);\n      } catch (error) {\n        // eslint-disable-next-line no-console\n        console.error(\n          `RealTimeDataInspectHook failed (${detail.changeType}):`,\n          error\n        );\n      }\n    }\n  });\n}\n","import type {\n  BatchUpdateContextItem,\n  BrickEventHandlerCallback,\n  ContextConf,\n  ContextResolveTriggerBrickLifeCycle,\n  RouteConf,\n} from \"@next-core/types\";\nimport { hasOwnProperty, isObject } from \"@next-core/utils/general\";\nimport { strictCollectMemberUsage } from \"@next-core/utils/storyboard\";\nimport EventTarget from \"@ungap/event-target\";\nimport { eventCallbackFactory, listenerFactory } from \"../bindListeners.js\";\nimport { asyncCheckIf, checkIf } from \"../compute/checkIf.js\";\nimport {\n  asyncComputeRealValue,\n  computeRealValue,\n} from \"../compute/computeRealValue.js\";\nimport { ResolveOptions, resolveData } from \"./resolveData.js\";\nimport { resolveDataStore } from \"./resolveDataStore.js\";\nimport type {\n  AsyncPropertyEntry,\n  RuntimeBrick,\n  RuntimeContext,\n} from \"../interfaces.js\";\nimport { handleHttpError } from \"../../handleHttpError.js\";\nimport type { RendererContext } from \"../RendererContext.js\";\nimport { computePropertyValue } from \"../compute/computeRealProperties.js\";\nimport { _internalApiGetRenderId } from \"../Runtime.js\";\nimport {\n  callRealTimeDataInspectHooks,\n  realTimeDataInspectRoot,\n} from \"./realTimeDataInspect.js\";\nimport { isStrictMode } from \"../../isStrictMode.js\";\n\nconst supportContextResolveTriggerBrickLifeCycle = [\n  \"onBeforePageLoad\",\n  \"onPageLoad\",\n  \"onBeforePageLeave\",\n  \"onPageLeave\",\n  \"onAnchorLoad\",\n  \"onAnchorUnload\",\n] as ContextResolveTriggerBrickLifeCycle[];\n\nexport type DataStoreType = \"CTX\" | \"STATE\" | \"FORM_STATE\";\n\nexport interface DataStoreItem {\n  name: string;\n  value: unknown;\n  eventTarget: EventTarget;\n  useResolve?: boolean;\n  loaded?: boolean;\n  loading?: Promise<unknown>;\n  load?: (options?: ResolveOptions) => Promise<unknown>;\n  async?: boolean;\n  asyncMounted?: boolean;\n  deps: string[];\n}\n\nexport class DataStore<T extends DataStoreType = \"CTX\"> {\n  private readonly type: T;\n  private readonly data = new Map<string, DataStoreItem>();\n  private readonly changeEventType: string;\n  private readonly pendingStack: Array<ReturnType<typeof resolveDataStore>> =\n    [];\n  public readonly hostBrick?: RuntimeBrick;\n  private readonly stateStoreId?: string;\n  private batchUpdate = false;\n  private batchUpdateContextsNames: string[] = [];\n  private readonly rendererContext?: RendererContext;\n  private routeMap = new WeakMap<RouteConf, Set<string>>();\n\n  // 把 `rendererContext` 放在参数列表的最后，并作为可选，以减少测试文件的调整\n  constructor(\n    type: T,\n    hostBrick?: RuntimeBrick,\n    rendererContext?: RendererContext,\n    stateStoreId?: string\n  ) {\n    this.type = type;\n    this.changeEventType =\n      this.type === \"FORM_STATE\"\n        ? \"formstate.change\"\n        : this.type === \"STATE\"\n          ? \"state.change\"\n          : \"context.change\";\n    this.hostBrick = hostBrick;\n    this.rendererContext = rendererContext;\n    this.stateStoreId = stateStoreId;\n  }\n\n  getAllValues(): Record<string, unknown> {\n    return Object.fromEntries(\n      [...this.data.entries()].map(([name, { value }]) => [name, value])\n    );\n  }\n\n  getValue(name: string): unknown {\n    return this.data.get(name)?.value;\n  }\n\n  private notifyRealTimeDataChange(name: string, value: unknown) {\n    if (realTimeDataInspectRoot) {\n      const { tplStateStoreId } = realTimeDataInspectRoot;\n      if (\n        tplStateStoreId\n          ? this.type === \"STATE\" && this.stateStoreId === tplStateStoreId\n          : this.type === \"CTX\"\n      ) {\n        callRealTimeDataInspectHooks({\n          changeType: \"update\",\n          tplStateStoreId,\n          detail: {\n            name,\n            value,\n          },\n        });\n      }\n    }\n  }\n\n  private getAffectListByContext(name: string): string[] {\n    const affectNames = [name];\n    this.data.forEach((value, key) => {\n      if (value.deps) {\n        const isInDeps = value.deps.some((item) => affectNames.includes(item));\n        isInDeps &&\n          affectNames.push(key) &&\n          affectNames.push(...this.getAffectListByContext(key));\n      }\n    });\n    affectNames.shift();\n    return [...new Set(affectNames)];\n  }\n\n  updateValues(\n    values: BatchUpdateContextItem[],\n    method: \"assign\" | \"replace\",\n    argsFactory: (arg: unknown[]) => BatchUpdateContextItem\n  ): void {\n    this.batchUpdate = true;\n    this.batchUpdateContextsNames = values.map((item) => item.name);\n    if (\n      [...new Set(this.batchUpdateContextsNames)].length !==\n      this.batchUpdateContextsNames.length\n    ) {\n      throw new Error(`Batch update not allow to update same item`);\n    }\n\n    const updateContexts: Record<string, DataStoreItem> = {};\n    const affectContexts: Record<string, DataStoreItem> = {};\n    const affectDepsContextNames: string[] = [];\n\n    values.forEach((arg) => {\n      const { name, value } = argsFactory([arg]);\n      const updateContextItem = this.data.get(name);\n      affectDepsContextNames.push(...this.getAffectListByContext(name));\n      updateContextItem && (updateContexts[name] = updateContextItem);\n      this.updateValue(name as string, value, method);\n    });\n\n    affectDepsContextNames\n      .filter((item) => !updateContexts[item])\n      .forEach((name) => {\n        const affectContextItem = this.data.get(name);\n        affectContextItem && (affectContexts[name] = affectContextItem);\n      });\n\n    const triggerEvent = (contexts: Record<string, DataStoreItem>): void => {\n      for (const key in contexts) {\n        const context = contexts[key];\n        context.eventTarget?.dispatchEvent(\n          new CustomEvent(this.changeEventType, {\n            detail: context.value,\n          })\n        );\n      }\n    };\n\n    triggerEvent(updateContexts);\n    triggerEvent(affectContexts);\n\n    this.batchUpdate = false;\n\n    return;\n  }\n\n  updateValue(\n    name: string,\n    value: unknown,\n    method: \"assign\" | \"replace\" | \"refresh\" | \"load\",\n    callback?: BrickEventHandlerCallback,\n    callbackRuntimeContext?: RuntimeContext\n  ): void {\n    const item = this.data.get(name);\n    if (!item) {\n      throw new Error(`${this.type} '${name}' is not defined`);\n    }\n\n    if (method === \"refresh\" || method === \"load\") {\n      if (!item.useResolve) {\n        throw new Error(\n          `You can not ${method} \"${this.type}.${name}\" which is not using resolve`\n        );\n      }\n\n      let promise: Promise<unknown> | undefined;\n      if (method === \"load\") {\n        // Try to reuse previous request when calling `load`.\n        if (item.loaded) {\n          promise = Promise.resolve(item.value);\n        } else if (item.loading) {\n          promise = item.loading;\n        }\n      }\n\n      const shouldDismiss = (error: unknown) => {\n        // If render twice immediately, flow API contracts maybe cleared before\n        // the second rendering, while the page load handlers of the first\n        // rendering can't be cancelled, which throws `FlowApiNotFoundError`.\n        // So we ignore error reporting for this case.\n        let renderId: string | undefined;\n        return (\n          (error as Error)?.name === \"FlowApiNotFoundError\" &&\n          !!(renderId = this.rendererContext?.renderId) &&\n          renderId !== _internalApiGetRenderId()\n        );\n      };\n\n      if (!promise) {\n        promise = item.loading = item.load!({\n          cache: method === \"load\" ? \"default\" : \"reload\",\n          ...(value as ResolveOptions),\n        });\n        // Do not use the chained promise, since the callbacks need the original promise.\n        promise.then(\n          (val) => {\n            this.finishLoad(item, val);\n          },\n          (err) => {\n            // Let users override error handling.\n            if (item.useResolve && !shouldDismiss(err) && !callback?.error) {\n              handleHttpError(err);\n            }\n          }\n        );\n      }\n\n      if (callback) {\n        const callbackFactory = eventCallbackFactory(\n          callback,\n          callbackRuntimeContext!\n        );\n\n        promise.then(\n          (val) => {\n            callbackFactory(\"success\")({ value: val });\n            callbackFactory(\"finally\")();\n          },\n          (err) => {\n            if (!shouldDismiss(err) && callback.error) {\n              callbackFactory(\"error\")(err);\n            }\n            callbackFactory(\"finally\")();\n          }\n        );\n      }\n\n      return;\n    }\n\n    if (method === \"replace\") {\n      item.value = value;\n    } else {\n      if (isObject(item.value)) {\n        Object.assign(item.value, value);\n      } else {\n        // eslint-disable-next-line no-console\n        console.warn(\n          `Non-object current value of \"${this.type}.${name}\" for \"context.assign\", try \"context.replace\" instead.`\n        );\n        item.value = value;\n      }\n    }\n\n    if (this.batchUpdate) return;\n\n    item.eventTarget.dispatchEvent(\n      new CustomEvent(this.changeEventType, {\n        detail: item.value,\n      })\n    );\n  }\n\n  private finishLoad(item: DataStoreItem, value: unknown) {\n    if (!item.useResolve) {\n      // This happens when a tracked conditional resolve switches from\n      // resolve to fallback after an dep update triggered refresh but\n      // before it's been resolved.\n      return;\n    }\n    item.loaded = true;\n    item.value = value;\n    item.eventTarget.dispatchEvent(\n      new CustomEvent(this.changeEventType, {\n        detail: value,\n      })\n    );\n  }\n\n  define(\n    dataConfs: ContextConf[] | undefined,\n    runtimeContext: RuntimeContext,\n    asyncHostPropertyEntries?: AsyncPropertyEntry[],\n    routePath?: RouteConf[]\n  ): void {\n    if (Array.isArray(dataConfs) && dataConfs.length > 0) {\n      const pending = resolveDataStore(\n        dataConfs,\n        (dataConf: ContextConf) =>\n          this.resolve(\n            dataConf,\n            runtimeContext,\n            asyncHostPropertyEntries,\n            routePath\n          ),\n        this.type,\n        isStrictMode(runtimeContext)\n      );\n      this.pendingStack.push(pending);\n    }\n  }\n\n  onChange(dataName: string, listener: EventListener): () => void {\n    const eventTarget = this.data.get(dataName)?.eventTarget;\n    eventTarget?.addEventListener(this.changeEventType, listener);\n    return () => {\n      eventTarget?.removeEventListener(this.changeEventType, listener);\n    };\n  }\n\n  async waitFor(dataNames: string[] | Set<string>): Promise<void> {\n    for (const { pendingContexts } of this.pendingStack) {\n      await Promise.all(\n        [...dataNames].map((ctx) => {\n          const p = pendingContexts.get(ctx);\n          return p;\n        })\n      );\n    }\n  }\n\n  async waitForAll(): Promise<void> {\n    // Silent each pending contexts, since the error is handled by batched `pendingResult`\n    for (const { pendingContexts } of this.pendingStack) {\n      for (const p of pendingContexts.values()) {\n        p.catch(() => {\n          /* No-op */\n        });\n      }\n    }\n    for (const { pendingResult } of this.pendingStack) {\n      await pendingResult;\n    }\n  }\n\n  /**\n   * After mount, dispatch the change event when an async data is loaded.\n   *\n   * If param `route` is present, handle data defined in that route (or its descendants) only.\n   */\n  mountAsyncData(route?: RouteConf) {\n    this.data.forEach((item) => {\n      if (item.async && (!route || this.routeMap.get(route)?.has(item.name))) {\n        // istanbul ignore next\n        if (item.asyncMounted) {\n          // eslint-disable-next-line no-console\n          console.error(\n            `Async data \"${item.name}\" already mounted. This is a bug of Brick Next, please report it.`\n          );\n          return;\n        }\n        item.asyncMounted = true;\n        // An async data always has `loading`\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        item.loading!.then((value) => {\n          this.finishLoad(item, value);\n        });\n      }\n    });\n  }\n\n  private async resolve(\n    dataConf: ContextConf,\n    runtimeContext: RuntimeContext,\n    asyncHostPropertyEntries?: AsyncPropertyEntry[],\n    routePath?: RouteConf[]\n  ): Promise<boolean> {\n    if (!(await asyncCheckIf(dataConf, runtimeContext))) {\n      return false;\n    }\n    let value: unknown;\n    if (\n      asyncHostPropertyEntries &&\n      (this.type === \"STATE\" ? dataConf.expose : this.type === \"FORM_STATE\")\n    ) {\n      value = await computePropertyValue(\n        asyncHostPropertyEntries,\n        dataConf.name\n      );\n    }\n    let load: DataStoreItem[\"load\"];\n    let loading: Promise<unknown> | undefined;\n    let useResolve: boolean | undefined;\n    let trackConditionalResolve: boolean | undefined;\n    let resolvePolicy: \"eager\" | \"lazy\" | \"async\" | undefined;\n    if (value === undefined) {\n      if (dataConf.resolve) {\n        const hasFallbackValue = hasOwnProperty(dataConf, \"value\");\n        // Track conditional resolve only if all matches:\n        //   - Track enabled\n        //   - Has fallback value\n        //   - Referencing other data in `resolve.if`\n        trackConditionalResolve =\n          dataConf.track &&\n          hasFallbackValue &&\n          hasOwnProperty(dataConf.resolve, \"if\") &&\n          strictCollectMemberUsage(dataConf.resolve.if, this.type).size > 0;\n        const resolveConf = {\n          transform: \"value\",\n          ...dataConf.resolve,\n        };\n        useResolve = await asyncCheckIf(dataConf.resolve, runtimeContext);\n        if (useResolve || trackConditionalResolve) {\n          load = async (options) =>\n            (\n              (await resolveData(resolveConf, runtimeContext, {\n                ...options,\n                renderId: this.rendererContext?.renderId,\n              })) as {\n                value: unknown;\n              }\n            ).value;\n        }\n        if (useResolve) {\n          // `async` take precedence over `lazy`\n          resolvePolicy = dataConf.resolve.async\n            ? \"async\"\n            : dataConf.resolve.lazy\n              ? \"lazy\"\n              : \"eager\";\n          if (resolvePolicy === \"eager\") {\n            value = await load!();\n          } else if (resolvePolicy === \"async\") {\n            loading = load!();\n          }\n        } else if (!hasFallbackValue) {\n          return false;\n        }\n      }\n      if (\n        (!useResolve || resolvePolicy !== \"eager\") &&\n        dataConf.value !== undefined\n      ) {\n        // If the context has no resolve, just use its `value`.\n        // Or if the resolve is ignored or lazy, use its `value` as a fallback.\n        value = await asyncComputeRealValue(dataConf.value, runtimeContext);\n      }\n    }\n\n    if (this.data.has(dataConf.name)) {\n      throw new Error(\n        `${this.type} '${dataConf.name}' has already been declared`\n      );\n    }\n\n    const newData: DataStoreItem = {\n      name: dataConf.name,\n      value,\n      // This is required for tracking context, even if no `onChange` is specified.\n      eventTarget: new EventTarget(),\n      useResolve,\n      load,\n      loaded: resolvePolicy === \"eager\",\n      loading,\n      async: resolvePolicy === \"async\",\n      deps: [],\n    };\n\n    if (resolvePolicy === \"lazy\") {\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      const { trigger } = dataConf.resolve!;\n      if (\n        trigger &&\n        supportContextResolveTriggerBrickLifeCycle.includes(trigger)\n      ) {\n        this.rendererContext?.registerArbitraryLifeCycle(trigger, () => {\n          this.updateValue(dataConf.name, undefined, \"load\");\n        });\n      }\n    }\n\n    if (dataConf.onChange) {\n      newData.eventTarget.addEventListener(\n        this.changeEventType,\n        listenerFactory(dataConf.onChange, runtimeContext)\n      );\n    }\n\n    if (dataConf.track) {\n      const deps = strictCollectMemberUsage(\n        trackConditionalResolve\n          ? [dataConf.resolve, dataConf.value]\n          : load\n            ? dataConf.resolve\n            : dataConf.value,\n        this.type\n      );\n      !load && (newData.deps = [...deps]);\n      for (const dep of deps) {\n        this.onChange(\n          dep,\n          this.batchAddListener(() => {\n            newData.useResolve = trackConditionalResolve\n              ? checkIf(dataConf.resolve!, runtimeContext)\n              : !!load;\n            if (newData.useResolve) {\n              this.updateValue(dataConf.name, { cache: \"default\" }, \"refresh\");\n            } else {\n              this.updateValue(\n                dataConf.name,\n                computeRealValue(dataConf.value, runtimeContext),\n                \"replace\"\n              );\n            }\n          }, dataConf)\n        );\n      }\n    }\n\n    newData.eventTarget.addEventListener(this.changeEventType, (e) => {\n      this.notifyRealTimeDataChange(dataConf.name, (e as CustomEvent).detail);\n    });\n\n    this.data.set(dataConf.name, newData);\n\n    if (Array.isArray(routePath)) {\n      for (const route of routePath) {\n        const names = this.routeMap.get(route);\n        if (names) {\n          names.add(dataConf.name);\n        } else {\n          this.routeMap.set(route, new Set([dataConf.name]));\n        }\n      }\n    }\n\n    return true;\n  }\n\n  disposeDataInRoutes(routes: RouteConf[]) {\n    for (const route of routes) {\n      const names = this.routeMap.get(route);\n      if (names !== undefined) {\n        for (const name of names) {\n          this.data.delete(name);\n        }\n      }\n    }\n  }\n\n  private batchAddListener(\n    listener: EventListener,\n    contextConf: ContextConf\n  ): EventListener {\n    return (event: Event | CustomEvent): void => {\n      if (\n        this.batchUpdate &&\n        this.batchUpdateContextsNames.includes(contextConf.name)\n      ) {\n        return;\n      }\n      listener(event);\n    };\n  }\n}\n","import { ContextConf } from \"@next-core/types\";\nimport { collectMemberUsage, MemberUsage } from \"@next-core/utils/storyboard\";\n\nexport interface DeferredContext {\n  resolve(): void;\n  reject(e: unknown): void;\n}\n\nexport function resolveDataStore(\n  contextConfs: ContextConf[],\n  resolveContext: (contextConf: ContextConf) => Promise<boolean>,\n  keyword = \"CTX\",\n  strict?: boolean\n): {\n  pendingResult: Promise<void>;\n  pendingContexts: Map<string, Promise<void>>;\n} {\n  const dependencyMap = getDependencyMapOfContext(\n    contextConfs,\n    keyword,\n    strict\n  );\n  // There maybe multiple context confs for a specific name, since there are conditional contexts.\n  // This is a map of how many pending context confs for each context name.\n  const pendingDeps = new Map<string, number>();\n  for (const contextName of Array.from(dependencyMap.keys()).map(\n    (contextConf) => contextConf.name\n  )) {\n    pendingDeps.set(contextName, (pendingDeps.get(contextName) ?? 0) + 1);\n  }\n  const hasNonStaticUsage = Array.from(dependencyMap.values()).some(\n    (stats) => stats.hasNonStaticUsage\n  );\n  const processed = new WeakSet<ContextConf>();\n\n  const deferredContexts = new Map<string, DeferredContext>();\n  const pendingContexts = new Map(\n    [...new Set(contextConfs.map((contextConf) => contextConf.name))].map(\n      (contextName) => [\n        contextName,\n        new Promise<void>((resolve, reject) => {\n          deferredContexts.set(contextName, { resolve, reject });\n        }),\n      ]\n    )\n  );\n\n  const wrapResolve = async (contextConf: ContextConf): Promise<void> => {\n    processed.add(contextConf);\n    const resolved = await resolveContext(contextConf);\n    dependencyMap.delete(contextConf);\n    const left = pendingDeps.get(contextConf.name) ?? 0;\n    if (resolved) {\n      // Assert: contextConf.name exists in deferredContexts\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      deferredContexts.get(contextConf.name)!.resolve();\n      pendingDeps.delete(contextConf.name);\n      if (left === 0) {\n        throw new Error(`Duplicated context defined: ${contextConf.name}`);\n      }\n    } else {\n      // Assert: left >= 1\n      if (left === 1) {\n        // Assert: contextConf.name exists in deferredContexts\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        deferredContexts.get(contextConf.name)!.resolve();\n        pendingDeps.delete(contextConf.name);\n      } else {\n        pendingDeps.set(contextConf.name, left - 1);\n      }\n    }\n    await scheduleNext();\n  };\n\n  let scheduleAsSerial = hasNonStaticUsage;\n\n  async function scheduleNext(): Promise<void> {\n    const readyContexts = Array.from(dependencyMap.entries())\n      .filter(predicateNextResolveFactory(pendingDeps, scheduleAsSerial))\n      .map((entry) => entry[0])\n      .filter((contextConf) => !processed.has(contextConf));\n    await Promise.all(readyContexts.map(wrapResolve));\n  }\n\n  const pendingResult = scheduleNext()\n    .then(async () => {\n      // If there are still contexts left, it implies one of these situations:\n      //   - Circular contexts.\n      //     Such as: a depends on b, while b depends on a.\n      //   - Related contexts are all ignored.\n      //     Such as: a depends on b,\n      //     while both them are ignore by a falsy result of `if`.\n      if (dependencyMap.size > 0) {\n        // This will throw if circular contexts detected.\n        detectCircularContexts(dependencyMap, keyword);\n        scheduleAsSerial = true;\n        await scheduleNext();\n      }\n      // There maybe ignored contexts which are still not fulfilled.\n      // We treat them as RESOLVED.\n      for (const deferred of deferredContexts.values()) {\n        deferred.resolve();\n      }\n    })\n    .catch((error) => {\n      // There maybe contexts left not fulfilled, when an error occurred.\n      // We treat them as REJECTED.\n      for (const deferred of deferredContexts.values()) {\n        deferred.reject(error);\n      }\n      throw error;\n    });\n  return { pendingResult, pendingContexts };\n}\n\nfunction predicateNextResolveFactory(\n  pendingDeps: Map<string, number>,\n  scheduleAsSerial: boolean\n): (entry: [ContextConf, MemberUsage], index: number) => boolean {\n  return (entry, index) =>\n    // When contexts contain computed CTX accesses, it implies a dynamic dependency map.\n    // So make them process sequentially, keep the same behavior as before.\n    scheduleAsSerial\n      ? index === 0\n      : // A context is ready when it has no pending dependencies.\n        ![...entry[1].usedProperties].some((dep) => pendingDeps.has(dep));\n}\n\nexport function getDependencyMapOfContext(\n  contextConfs: ContextConf[],\n  keyword = \"CTX\",\n  strict?: boolean\n): Map<ContextConf, MemberUsage> {\n  const depsMap = new Map<ContextConf, MemberUsage>();\n  for (const contextConf of contextConfs) {\n    const data = [contextConf.if, contextConf.value, contextConf.resolve];\n    const stats = collectMemberUsage(data, keyword);\n    if (!strict && keyword === \"STATE\") {\n      const legacyTplStats = collectMemberUsage(data, \"TPL\");\n      // Merge stats with legacyTplStats\n      for (const prop of legacyTplStats.usedProperties) {\n        stats.usedProperties.add(prop);\n      }\n      if (legacyTplStats.hasNonStaticUsage) {\n        stats.hasNonStaticUsage = true;\n      }\n    }\n    depsMap.set(contextConf, stats);\n  }\n  return depsMap;\n}\n\nfunction detectCircularContexts(\n  dependencyMap: Map<ContextConf, MemberUsage>,\n  keyword: string\n): void {\n  const duplicatedMap = new Map(dependencyMap);\n  const pendingDeps = new Set<string>(\n    Array.from(duplicatedMap.keys()).map((contextConf) => contextConf.name)\n  );\n  const next = (): void => {\n    let processedAtLeastOne = false;\n    for (const [contextConf, stats] of duplicatedMap.entries()) {\n      if (![...stats.usedProperties].some((dep) => pendingDeps.has(dep))) {\n        duplicatedMap.delete(contextConf);\n        pendingDeps.delete(contextConf.name);\n        processedAtLeastOne = true;\n      }\n    }\n    if (processedAtLeastOne) {\n      next();\n    }\n  };\n  next();\n\n  if (duplicatedMap.size > 0) {\n    throw new ReferenceError(\n      `Circular ${keyword} detected: ${Array.from(duplicatedMap.keys())\n        .map((contextConf) => contextConf.name)\n        .join(\", \")}`\n    );\n  }\n}\n","import type { BrickConf, RouteConf, SlotsConfOfBricks } from \"@next-core/types\";\nimport { hasOwnProperty } from \"@next-core/utils/general\";\nimport { clamp } from \"lodash\";\nimport {\n  symbolForAsyncComputedPropsFromHost,\n  symbolForTPlExternalForEachIndex,\n  symbolForTPlExternalForEachItem,\n  symbolForTPlExternalForEachSize,\n  symbolForTplStateStoreId,\n  type RuntimeBrickConfWithTplSymbols,\n} from \"./constants.js\";\nimport type { AsyncPropertyEntry, TemplateHostContext } from \"../interfaces.js\";\nimport { computePropertyValue } from \"../compute/computeRealProperties.js\";\nimport { childrenToSlots } from \"../Renderer.js\";\n\nexport function setupTemplateProxy(\n  hostContext: TemplateHostContext,\n  ref: string | undefined,\n  slots: SlotsConfOfBricks\n) {\n  const {\n    reversedProxies,\n    asyncHostPropertyEntries,\n    externalSlots,\n    tplStateStoreId,\n    hostBrick,\n  } = hostContext;\n\n  let asyncComputedProps: AsyncPropertyEntry[] | undefined;\n\n  if (ref && reversedProxies) {\n    const propertyProxies = reversedProxies.properties.get(ref);\n    if (propertyProxies) {\n      const getComputedProps = (\n        asyncHostProps: AsyncPropertyEntry[]\n      ): AsyncPropertyEntry[] => {\n        return propertyProxies!\n          .map(({ from, to }) => {\n            const filtered = asyncHostProps.filter(\n              (entry) => entry[0] === from\n            );\n            if (filtered.length > 0 && to.refProperty) {\n              return [\n                to.refProperty,\n                computePropertyValue(filtered, from),\n                true,\n              ];\n            }\n          })\n          .filter(Boolean) as [string, Promise<unknown>][];\n      };\n\n      asyncComputedProps = getComputedProps(asyncHostPropertyEntries);\n    }\n\n    const slotProxies = reversedProxies.slots.get(ref);\n    if (slotProxies && externalSlots) {\n      // Use an approach like template-literal's quasis:\n      // `quasi0${0}quais1${1}quasi2...`\n      // Every quasi (indexed by `refPosition`) can be slotted with multiple bricks.\n      const quasisMap = new Map<string, BrickConf[][]>();\n\n      for (const { from, to } of slotProxies) {\n        const insertBricks = externalSlots[from]?.bricks ?? [];\n        if (!insertBricks.length) {\n          continue;\n        }\n        const refToSlot = to.refSlot ?? from;\n        let expandableSlot = quasisMap.get(refToSlot);\n        if (!expandableSlot) {\n          expandableSlot = [];\n          // The size of quasis should be the existed slotted bricks' size plus one.\n          const size = hasOwnProperty(slots, refToSlot)\n            ? slots[refToSlot].bricks.length + 1\n            : 1;\n          for (let i = 0; i < size; i += 1) {\n            expandableSlot.push([]);\n          }\n          quasisMap.set(refToSlot, expandableSlot);\n        }\n        const refPosition = to.refPosition ?? -1;\n        // External bricks of a template, should not access the template internal forEach `ITEM`.\n        // For some existing templates who is *USING* this bug, we keep the old behavior.\n        const hostHasForEach = hasOwnProperty(\n          hostBrick.runtimeContext,\n          \"forEachItem\"\n        );\n        expandableSlot[\n          clamp(\n            refPosition < 0 ? expandableSlot.length + refPosition : refPosition,\n            0,\n            expandableSlot.length - 1\n          )\n        ].push(\n          ...(!hostHasForEach\n            ? insertBricks\n            : setupTemplateExternalBricksWithForEach(\n                insertBricks,\n                hostBrick.runtimeContext.forEachItem,\n                hostBrick.runtimeContext.forEachIndex!,\n                hostBrick.runtimeContext.forEachSize!\n              ))\n        );\n      }\n\n      for (const [slotName, quasis] of quasisMap.entries()) {\n        if (!hasOwnProperty(slots, slotName)) {\n          slots[slotName] = {\n            type: \"bricks\",\n            bricks: [],\n          };\n        }\n        const slotConf = slots[slotName];\n        slotConf.bricks = quasis.flatMap((bricks, index) =>\n          index < slotConf.bricks.length\n            ? bricks.concat(slotConf.bricks[index])\n            : bricks\n        );\n\n        if (slotConf.bricks.length === 0) {\n          delete slots[slotName];\n        }\n      }\n    }\n  }\n\n  return {\n    [symbolForAsyncComputedPropsFromHost]: asyncComputedProps,\n    [symbolForTplStateStoreId]: tplStateStoreId,\n  };\n}\n\n// External bricks of a template, have the same forEachItem context as their host.\nfunction setupTemplateExternalBricksWithForEach(\n  bricks: BrickConf[],\n  forEachItem: unknown,\n  forEachIndex: number,\n  forEachSize: number\n): BrickConf[] {\n  return (bricks as RuntimeBrickConfWithTplSymbols[]).map(\n    ({ children, slots, ...brick }) => ({\n      ...brick,\n      [symbolForTPlExternalForEachItem]: forEachItem,\n      [symbolForTPlExternalForEachIndex]: forEachIndex,\n      [symbolForTPlExternalForEachSize]: forEachSize,\n      // Keep `:forEach` bricks as original, since they have their own forEachItem context.\n      slots:\n        brick.brick === \":forEach\"\n          ? childrenToSlots(children, slots)\n          : Object.fromEntries(\n              Object.entries(childrenToSlots(children, slots) ?? {}).map(\n                ([slotName, slotConf]) => [\n                  slotName,\n                  slotConf.type === \"routes\"\n                    ? {\n                        type: \"routes\",\n                        routes: setupTemplateExternalRoutesWithForEach(\n                          slotConf.routes,\n                          forEachItem,\n                          forEachIndex,\n                          forEachSize\n                        ),\n                      }\n                    : {\n                        type: \"bricks\",\n                        bricks: setupTemplateExternalBricksWithForEach(\n                          slotConf.bricks,\n                          forEachItem,\n                          forEachIndex,\n                          forEachSize\n                        ),\n                      },\n                ]\n              )\n            ),\n    })\n  );\n}\n\nfunction setupTemplateExternalRoutesWithForEach(\n  routes: RouteConf[],\n  forEachItem: unknown,\n  forEachIndex: number,\n  forEachSize: number\n): RouteConf[] {\n  return routes.map((route) =>\n    route.type === \"routes\"\n      ? {\n          ...route,\n          routes: setupTemplateExternalRoutesWithForEach(\n            route.routes,\n            forEachItem,\n            forEachIndex,\n            forEachSize\n          ),\n        }\n      : route.type === \"redirect\"\n        ? route\n        : {\n            ...route,\n            bricks: setupTemplateExternalBricksWithForEach(\n              route.bricks,\n              forEachItem,\n              forEachIndex,\n              forEachSize\n            ),\n          }\n  );\n}\n","import type { UseBrickSlotsConf, UseSingleBrickConf } from \"@next-core/types\";\nimport { isObject } from \"@next-core/utils/general\";\nimport type { TemplateHostContext } from \"../interfaces.js\";\nimport { setupTemplateProxy } from \"./setupTemplateProxy.js\";\nimport { childrenToSlots } from \"../Renderer.js\";\n\nexport function setupUseBrickInTemplate<T>(\n  props: T,\n  hostContext: TemplateHostContext\n): T {\n  function walk<P>(props: P): P {\n    if (!isObject(props) || typeof props === \"function\") {\n      return props;\n    }\n\n    if (Array.isArray(props)) {\n      return props.map(walk) as P;\n    }\n\n    return Object.fromEntries(\n      Object.entries(props)\n        .map(([key, value]) =>\n          isObject(value) && key === \"useBrick\"\n            ? Array.isArray(value)\n              ? [key, value.map(setup)]\n              : [key, setup(value as UseSingleBrickConf)]\n            : [key, walk(value)]\n        )\n        .concat(\n          Object.getOwnPropertySymbols(props).map((k) => [\n            k,\n            (props as Record<string | symbol, unknown>)[k],\n          ])\n        )\n    ) as P;\n  }\n\n  function setup(item: UseSingleBrickConf): UseSingleBrickConf {\n    const { properties, slots: originalSlots, children, ...restConf } = item;\n\n    const transpiledSlots = childrenToSlots(children, originalSlots) as\n      | UseBrickSlotsConf\n      | undefined;\n\n    const slots = Object.fromEntries(\n      Object.entries(transpiledSlots ?? {}).map(([slotName, slotConf]) => [\n        slotName,\n        {\n          type: \"bricks\",\n          bricks: (slotConf.bricks ?? []).map(setup),\n        },\n      ])\n    ) as UseBrickSlotsConf;\n\n    return {\n      ...restConf,\n      properties: walk(properties),\n      slots,\n      ...setupTemplateProxy(hostContext, restConf.ref, slots),\n    };\n  }\n\n  return walk(props);\n}\n","import type {\n  BrickConf,\n  BrickConfInTemplate,\n  SlotsConfInTemplate,\n  SlotsConfOfBricks,\n  UseSingleBrickConf,\n} from \"@next-core/types\";\nimport { uniqueId } from \"lodash\";\nimport { customTemplates } from \"../../CustomTemplates.js\";\nimport { DataStore } from \"../data/DataStore.js\";\nimport { RuntimeBrickConfWithTplSymbols } from \"./constants.js\";\nimport { setupTemplateProxy } from \"./setupTemplateProxy.js\";\nimport type {\n  AsyncPropertyEntry,\n  RuntimeBrick,\n  TemplateHostBrick,\n  TemplateHostContext,\n} from \"../interfaces.js\";\nimport { setupUseBrickInTemplate } from \"./setupUseBrickInTemplate.js\";\nimport { childrenToSlots } from \"../Renderer.js\";\nimport { hooks } from \"../Runtime.js\";\nimport type { RendererContext } from \"../RendererContext.js\";\n\nexport function expandCustomTemplate<T extends BrickConf | UseSingleBrickConf>(\n  tplTagName: string,\n  brickConf: T,\n  hostBrick: RuntimeBrick,\n  asyncHostPropertyEntries: AsyncPropertyEntry[],\n  rendererContext: RendererContext\n): T {\n  const tplStateStoreId = uniqueId(\"tpl-state-\");\n  const runtimeContext = {\n    ...hostBrick.runtimeContext,\n    tplStateStoreId,\n  };\n\n  // There is a boundary for `forEach*` and `FORM_STATE` between template internals and externals.\n  delete runtimeContext.forEachItem;\n  delete runtimeContext.forEachIndex;\n  delete runtimeContext.forEachSize;\n  delete runtimeContext.formStateStoreId;\n\n  const tplStateStore = new DataStore(\n    \"STATE\",\n    hostBrick,\n    rendererContext,\n    tplStateStoreId\n  );\n  runtimeContext.tplStateStoreMap.set(tplStateStoreId, tplStateStore);\n  if (runtimeContext.tplStateStoreScope) {\n    runtimeContext.tplStateStoreScope.push(tplStateStore);\n  }\n\n  const { bricks, proxy, state, contracts } = customTemplates.get(tplTagName)!;\n  hooks?.flowApi?.collectWidgetContract(contracts);\n  tplStateStore.define(state, runtimeContext, asyncHostPropertyEntries);\n\n  const {\n    slots: originalExternalSlots,\n    children: externalChildren,\n    ...restBrickConf\n  } = brickConf;\n\n  const newBrickConf = {\n    ...restBrickConf,\n    brick: tplTagName,\n  } as T;\n\n  hostBrick.tplHostMetadata = {\n    internalBricksByRef: new Map(),\n    tplStateStoreId,\n    proxy,\n  };\n\n  // Reversed proxies are used for expand storyboard before rendering page.\n  const reversedProxies: TemplateHostContext[\"reversedProxies\"] = {\n    properties: new Map(),\n    slots: new Map(),\n    // mergeBases: new Map(),\n  };\n\n  if (proxy?.properties) {\n    for (const [from, to] of Object.entries(proxy.properties)) {\n      let proxies = reversedProxies.properties.get(to.ref);\n      if (!proxies) {\n        proxies = [];\n        reversedProxies.properties.set(to.ref, proxies);\n      }\n      proxies.push({\n        from,\n        to,\n      });\n    }\n  }\n\n  if (proxy?.slots) {\n    for (const [from, to] of Object.entries(proxy.slots)) {\n      let proxies = reversedProxies.slots.get(to.ref);\n      if (!proxies) {\n        proxies = [];\n        reversedProxies.slots.set(to.ref, proxies);\n      }\n      proxies.push({\n        from,\n        to,\n      });\n    }\n  }\n\n  const hostContext: TemplateHostContext = {\n    reversedProxies,\n    asyncHostPropertyEntries,\n    externalSlots: childrenToSlots(externalChildren, originalExternalSlots) as\n      | SlotsConfOfBricks\n      | undefined,\n    tplStateStoreId,\n    hostBrick: hostBrick as TemplateHostBrick,\n  };\n\n  newBrickConf.slots = {\n    \"\": {\n      type: \"bricks\",\n      bricks: bricks.map((item) => expandBrickInTemplate(item, hostContext)),\n    },\n  };\n\n  return newBrickConf;\n}\n\nfunction expandBrickInTemplate(\n  brickConfInTemplate: BrickConfInTemplate,\n  hostContext: TemplateHostContext\n): RuntimeBrickConfWithTplSymbols {\n  // Ignore `if: null` to make `looseCheckIf` working.\n  if (brickConfInTemplate.if === null) {\n    delete brickConfInTemplate.if;\n  }\n  const {\n    properties,\n    slots: slotsInTemplate,\n    children: childrenInTemplate,\n    ...restBrickConfInTemplate\n  } = brickConfInTemplate;\n\n  const transpiledSlots = childrenToSlots(\n    childrenInTemplate,\n    slotsInTemplate\n  ) as SlotsConfInTemplate | undefined;\n\n  const slots: SlotsConfOfBricks = Object.fromEntries(\n    Object.entries(transpiledSlots ?? {}).map(([slotName, slotConf]) => [\n      slotName,\n      {\n        type: \"bricks\",\n        bricks: (slotConf.bricks ?? []).map((item) =>\n          expandBrickInTemplate(item, hostContext)\n        ),\n      },\n    ])\n  );\n\n  return {\n    ...restBrickConfInTemplate,\n    properties: setupUseBrickInTemplate(properties, hostContext),\n    slots,\n    ...setupTemplateProxy(hostContext, restBrickConfInTemplate.ref, slots),\n  };\n}\n","import type { BrickConf } from \"@next-core/types\";\n\nexport const FORM_RENDERER = \"form-renderer.form-renderer\";\nexport const symbolForFormStateStoreId = Symbol.for(\"form.stateStoreId\");\n\nexport type RuntimeBrickConfWithFormSymbols = BrickConf &\n  RuntimeBrickConfOfFormSymbols;\n\nexport interface RuntimeBrickConfOfFormSymbols {\n  [symbolForFormStateStoreId]?: string;\n}\n","import type { BrickConf, BrickEventsMap } from \"@next-core/types\";\nimport { hasOwnProperty } from \"@next-core/utils/general\";\nimport { uniqueId } from \"lodash\";\nimport { DataStore } from \"../data/DataStore.js\";\nimport type { AsyncPropertyEntry, RuntimeBrick } from \"../interfaces.js\";\nimport type {\n  FieldProperties,\n  FormDataProperties,\n  FormSchemaProperties,\n} from \"./interfaces.js\";\nimport { getDefaultProperties } from \"./getDefaultProperties.js\";\nimport { symbolForFormStateStoreId } from \"./constants.js\";\nimport type { RendererContext } from \"../RendererContext.js\";\n\nexport const formContainers = [\n  \"forms.general-form\",\n  \"form.general-form\",\n  \"eo-form\",\n];\n\nexport function expandFormRenderer(\n  formData: unknown,\n  hostBrickConf: BrickConf,\n  hostBrick: RuntimeBrick,\n  asyncHostPropertyEntries: AsyncPropertyEntry[],\n  rendererContext: RendererContext\n): BrickConf {\n  const normalizedFormData = (\n    typeof formData === \"string\" ? JSON.parse(formData) : formData\n  ) as FormDataProperties;\n\n  const formStateStoreId = uniqueId(\"form-state-\");\n  const runtimeContext = {\n    ...hostBrick.runtimeContext,\n    formStateStoreId,\n  };\n\n  // There is a boundary for `forEach*` and `STATE` between form internals and externals.\n  delete runtimeContext.forEachItem;\n  delete runtimeContext.forEachIndex;\n  delete runtimeContext.forEachSize;\n  delete runtimeContext.tplStateStoreId;\n\n  const formStateStore = new DataStore(\n    \"FORM_STATE\",\n    undefined,\n    rendererContext,\n    formStateStoreId\n  );\n  runtimeContext.formStateStoreMap.set(formStateStoreId, formStateStore);\n  if (runtimeContext.formStateStoreScope) {\n    runtimeContext.formStateStoreScope.push(formStateStore);\n  }\n\n  // Always add a state of `params`.\n  const context = normalizedFormData.context ?? [];\n  if (!context.some((ctx) => ctx.name === \"params\")) {\n    context.push({ name: \"params\" });\n  }\n\n  formStateStore.define(context, runtimeContext, asyncHostPropertyEntries);\n\n  const formConf = formSchemaToBrick(\n    normalizedFormData.formSchema,\n    normalizedFormData.fields,\n    formStateStoreId\n  );\n\n  if (formContainers.includes(formConf.brick) && hostBrickConf.events) {\n    formConf.events = mergeEvents(formConf.events, hostBrickConf.events);\n  }\n\n  const renderRoot =\n    typeof hostBrickConf.properties?.renderRoot !== \"boolean\" ||\n    hostBrickConf.properties.renderRoot;\n\n  if (renderRoot) {\n    return {\n      ...hostBrickConf,\n      slots: undefined,\n      children: [\n        {\n          brick: \"eo-micro-view\",\n          properties: { style: { padding: \"12px\" } },\n          children: [formConf],\n        },\n      ],\n    };\n  }\n\n  return {\n    ...hostBrickConf,\n    slots: undefined,\n    children: [formConf],\n  };\n}\n\nfunction formSchemaToBrick(\n  schema: FormSchemaProperties,\n  fields: FieldProperties[],\n  formStateStoreId: string\n): BrickConf {\n  const { id, bricks, events, context, mountPoint, instanceId: iid } = schema;\n  let { brick, properties } = schema;\n\n  // 根据字段类型获取默认配置\n  const field = fields.find((item: FieldProperties) => item.fieldId === id);\n  if (field) {\n    const defaults = getDefaultProperties(field);\n    if (!brick) {\n      brick = defaults.brick;\n    }\n    properties = {\n      ...defaults.properties,\n      ...properties,\n    };\n  }\n\n  const brickConf = {\n    brick,\n    properties,\n    iid,\n    slot: mountPoint,\n    events,\n    context,\n    children: formSchemasToBricks(bricks, fields, formStateStoreId),\n    [symbolForFormStateStoreId]: formStateStoreId,\n  } as BrickConf;\n\n  if (hasOwnProperty(schema, \"if\")) {\n    brickConf.if = schema.if;\n  }\n\n  return brickConf;\n}\n\nfunction formSchemasToBricks(\n  schemas: FormSchemaProperties[] | undefined,\n  fields: FieldProperties[],\n  formStateStoreId: string\n): BrickConf[] | undefined {\n  if (Array.isArray(schemas)) {\n    return schemas.map((schema) =>\n      formSchemaToBrick(schema, fields, formStateStoreId)\n    );\n  }\n}\n\nfunction mergeEvents(\n  targetEvents: BrickEventsMap | undefined,\n  sourceEvents: BrickEventsMap\n): BrickEventsMap {\n  const events = targetEvents ?? {};\n\n  for (const [eventType, handlers] of Object.entries(sourceEvents)) {\n    events[eventType] = hasOwnProperty(events, eventType)\n      ? [events[eventType], handlers].flat()\n      : handlers;\n  }\n\n  return events;\n}\n","import type { DefaultFieldProperties, FieldProperties } from \"./interfaces.js\";\n\nexport function getDefaultProperties(\n  field: FieldProperties\n): DefaultFieldProperties {\n  let defaultValue: DefaultFieldProperties;\n  const commonProps = {\n    id: field.fieldId,\n    name: field.fieldId,\n    label: field.name,\n    dataset: {\n      testid: field.fieldId,\n    },\n  };\n  const getReadOnlyAndRequired = () => ({\n    readOnly: field.limit?.includes(\"READONLY\"),\n    required: field.limit?.includes(\"REQUIRED\"),\n  });\n  switch (field.fieldType) {\n    case \"INT\":\n      defaultValue = {\n        brick: \"forms.general-input-number\",\n        properties: {\n          ...commonProps,\n          ...getReadOnlyAndRequired(),\n          placeholder: field.description,\n          precision: 0,\n          inputBoxStyle: { width: \"100%\" },\n        },\n      };\n      break;\n    case \"BOOLEAN\":\n      defaultValue = {\n        brick: \"forms.general-switch\",\n        properties: {\n          ...commonProps,\n          ...getReadOnlyAndRequired(),\n        },\n      };\n      break;\n    case \"FLOAT\":\n      defaultValue = {\n        brick: \"forms.general-input-number\",\n        properties: {\n          ...commonProps,\n          ...getReadOnlyAndRequired(),\n          placeholder: field.description,\n          inputBoxStyle: { width: \"100%\" },\n        },\n      };\n      break;\n    case \"ENUM\":\n      defaultValue = {\n        brick: \"forms.general-select\",\n        properties: {\n          ...commonProps,\n          ...getReadOnlyAndRequired(),\n          options: [\n            { label: \"选项一\", value: 1 },\n            { label: \"选项二\", value: 2 },\n          ],\n          placeholder: field.description,\n          inputBoxStyle: { width: \"100%\" },\n        },\n      };\n      break;\n    case \"ENUMS\":\n      defaultValue = {\n        brick: \"forms.general-select\",\n        properties: {\n          ...commonProps,\n          ...getReadOnlyAndRequired(),\n          mode: \"multiple\",\n          options: [\n            { label: \"选项一\", value: 1 },\n            { label: \"选项二\", value: 2 },\n          ],\n          placeholder: field.description,\n          inputBoxStyle: { width: \"100%\" },\n        },\n      };\n      break;\n    case \"DATE\":\n    case \"TIME\":\n      defaultValue = {\n        brick: \"forms.general-date-picker\",\n        properties: {\n          ...commonProps,\n          ...getReadOnlyAndRequired(),\n          placeholder: field.description,\n        },\n      };\n      break;\n    case \"IP\":\n      defaultValue = {\n        brick: \"forms.general-input\",\n        properties: {\n          ...commonProps,\n          ...getReadOnlyAndRequired(),\n          placeholder: field.description,\n          pattern:\n            \"((^s*((([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5]).){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5]))s*$)|(^s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:)))(%.+)?s*$))\",\n          message: {\n            pattern: \"输入字符不匹配IP格式\",\n          },\n        },\n      };\n      break;\n    case \"JSON\":\n      defaultValue = {\n        brick: \"forms.general-textarea\",\n        properties: {\n          ...commonProps,\n        },\n      };\n      break;\n    case \"ARRAY\":\n      defaultValue = {\n        brick: \"forms.general-select\",\n        properties: {\n          ...commonProps,\n        },\n      };\n      break;\n    case \"STRUCTURE\":\n    case \"STRUCTURE_ARRAY\":\n      defaultValue = {\n        brick: \"forms.cmdb-instance-select-panel\",\n        properties: {\n          ...commonProps,\n          ...getReadOnlyAndRequired(),\n        },\n      };\n      break;\n    default:\n      defaultValue = {\n        brick: \"forms.general-input\",\n        properties: {\n          ...commonProps,\n          ...getReadOnlyAndRequired(),\n          placeholder: field.description,\n        },\n      };\n  }\n  return defaultValue;\n}\n","import { FORM_RENDERER } from \"./constants.js\";\nimport { formContainers } from \"./expandFormRenderer.js\";\n\ninterface FormElementProps {\n  renderRoot?: boolean;\n}\n\nclass FormElement extends HTMLElement implements FormElementProps {\n  get $$typeof(): string {\n    return \"formRenderer\";\n  }\n\n  renderRoot?: boolean | undefined;\n\n  #proxyFormMethod(method: string, args: unknown[] = []): void {\n    const containerElement =\n      this.renderRoot !== false\n        ? this.firstElementChild?.firstElementChild\n        : this.firstElementChild;\n\n    const tagName = containerElement?.tagName?.toLowerCase();\n\n    if (formContainers.includes(tagName as string)) {\n      (containerElement as any)[method](...args);\n    } else {\n      // eslint-disable-next-line no-console\n      console.error(`no ${method} method in the container element`, {\n        container: tagName,\n      });\n    }\n  }\n\n  validate(): void {\n    this.#proxyFormMethod(\"validate\");\n  }\n\n  setInitValue(...args: unknown[]): void {\n    this.#proxyFormMethod(\"setInitValue\", args);\n  }\n\n  resetFields(...args: unknown[]): void {\n    this.#proxyFormMethod(\"resetFields\", args);\n  }\n}\n\nexport function registerFormRenderer(): void {\n  customElements.get(FORM_RENDERER) ||\n    customElements.define(FORM_RENDERER, FormElement);\n}\n","import { loadBricksImperatively, BrickLoadError } from \"@next-core/loader\";\nimport { HttpResponseError } from \"@next-core/http\";\nimport { i18n } from \"@next-core/i18n\";\nimport { httpErrorToString } from \"../handleHttpError.js\";\nimport { RenderTag } from \"./enums.js\";\nimport type { RenderChildNode, RenderReturnNode } from \"./interfaces.js\";\nimport { _internalApiGetPresetBricks, getBrickPackages } from \"./Runtime.js\";\nimport { K, NS } from \"./i18n.js\";\nimport { getBasePath } from \"../getBasePath.js\";\n\ntype ErrorMessageVariant =\n  | \"internet-disconnected\"\n  | \"no-permission\"\n  | \"license-expired\"\n  | \"not-found\"\n  | \"unknown-error\";\n\ninterface ErrorMessageConfig {\n  title: string;\n  variant: ErrorMessageVariant;\n  showLink?: LinkType;\n  showDescription?: boolean;\n}\n\ntype LinkType = \"home\" | \"previous\" | \"reload\";\n\nexport class PageNotFoundError extends Error {\n  constructor(message: \"page not found\" | \"app not found\") {\n    // Pass remaining arguments (including vendor specific ones) to parent constructor\n    super(message);\n\n    this.name = \"PageNotFoundError\";\n\n    // Maintains proper stack trace for where our error was thrown (only available on V8)\n    // istanbul ignore else\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, BrickLoadError);\n    }\n  }\n}\n\n/**\n * Will always resolve\n */\nexport async function ErrorNode(\n  error: unknown,\n  returnNode: RenderReturnNode,\n  pageLevel?: boolean\n): Promise<RenderChildNode> {\n  const { title, variant, showLink, showDescription } =\n    getRefinedErrorConf(error);\n\n  if (pageLevel) {\n    const presetBricks = _internalApiGetPresetBricks();\n    const errorBrick = presetBricks.error ?? \"illustrations.error-message\";\n    if (errorBrick !== false) {\n      const linkBrick = \"eo-link\";\n      const bricks = (showLink ? [errorBrick, linkBrick] : [errorBrick]).filter(\n        (brick) => !customElements.get(brick)\n      );\n      try {\n        await Promise.race([\n          loadBricksImperatively(bricks, getBrickPackages()),\n          // Timeout after 3 seconds\n          new Promise<void>((_resolve, reject) =>\n            setTimeout(() => {\n              reject(new Error(\"timeout\"));\n            }, 3e3)\n          ),\n        ]);\n        const node: RenderChildNode = {\n          tag: RenderTag.BRICK,\n          type: errorBrick,\n          properties: {\n            errorTitle: title,\n            description: showDescription ? httpErrorToString(error) : undefined,\n            variant,\n            dataset: {\n              errorBoundary: \"\",\n            },\n          },\n          runtimeContext: null!,\n          return: returnNode,\n        };\n\n        if (showLink) {\n          node.child = getLinkNode(showLink, linkBrick, node, \"\");\n        }\n\n        return node;\n      } catch (e) {\n        // eslint-disable-next-line no-console\n        console.error(\"Failed to load brick:\", bricks.join(\", \"), e);\n      }\n    }\n  }\n\n  const useDefaultError =\n    pageLevel && !!customElements.get(\"easyops-default-error\");\n\n  const node: RenderChildNode = {\n    tag: RenderTag.BRICK,\n    type: useDefaultError ? \"easyops-default-error\" : \"div\",\n    properties: {\n      errorTitle: title,\n      dataset: {\n        errorBoundary: \"\",\n      },\n      style: {\n        color: \"var(--color-error)\",\n      },\n    },\n    runtimeContext: null!,\n    return: returnNode,\n  };\n\n  const descriptionNode: RenderChildNode = {\n    tag: RenderTag.BRICK,\n    type: \"div\",\n    properties: {\n      textContent: useDefaultError\n        ? showDescription\n          ? httpErrorToString(error)\n          : \"\"\n        : showDescription\n          ? `${title}: ${httpErrorToString(error)}`\n          : title,\n    },\n    runtimeContext: null!,\n    return: node,\n  };\n\n  node.child = descriptionNode;\n\n  if (pageLevel && showLink) {\n    descriptionNode.sibling = getLinkNode(\n      showLink,\n      \"a\",\n      node,\n      useDefaultError ? \"link\" : \"\"\n    );\n  }\n\n  return node;\n}\n\nfunction getLinkNode(\n  showLink: LinkType | undefined,\n  brick: string,\n  parent: RenderReturnNode,\n  slotId: string\n): RenderChildNode {\n  return {\n    tag: RenderTag.BRICK,\n    type: brick,\n    slotId,\n    properties: {\n      textContent:\n        showLink === \"home\"\n          ? i18n.t(`${NS}:${K.GO_BACK_HOME}`)\n          : showLink === \"reload\"\n            ? i18n.t(`${NS}:${K.RELOAD}`)\n            : i18n.t(`${NS}:${K.GO_BACK_TO_PREVIOUS_PAGE}`),\n      href:\n        showLink === \"home\"\n          ? getBasePath()\n          : showLink === \"reload\"\n            ? location.href\n            : undefined,\n    },\n    events:\n      showLink === \"previous\"\n        ? {\n            click: {\n              action: \"history.goBack\",\n            },\n          }\n        : undefined,\n    runtimeContext: null!,\n    return: parent,\n  };\n}\n\nfunction getRefinedErrorConf(error: unknown): ErrorMessageConfig {\n  if (error instanceof PageNotFoundError) {\n    return error.message === \"app not found\"\n      ? {\n          showLink: \"home\",\n          title: i18n.t(`${NS}:${K.APP_NOT_FOUND}`),\n          variant: \"no-permission\",\n        }\n      : {\n          showLink: \"home\",\n          variant: \"not-found\",\n          title: i18n.t(`${NS}:${K.PAGE_NOT_FOUND}`),\n        };\n  }\n\n  if (\n    error instanceof BrickLoadError ||\n    (error instanceof Error && error.name === \"ChunkLoadError\") ||\n    (error instanceof Event &&\n      error.type === \"error\" &&\n      error.target instanceof HTMLScriptElement)\n  ) {\n    return {\n      showDescription: true,\n      title: i18n.t(`${NS}:${K.NETWORK_ERROR}`),\n      variant: \"internet-disconnected\",\n      showLink: \"reload\",\n    };\n  }\n\n  if (error instanceof HttpResponseError && error.response?.status === 403) {\n    return {\n      showLink: \"previous\",\n      showDescription: true,\n      title: i18n.t(`${NS}:${K.NO_PERMISSION}`),\n      variant: \"no-permission\",\n    };\n  }\n\n  if (\n    error instanceof HttpResponseError &&\n    error.responseJson?.code === \"200000\"\n  ) {\n    return {\n      showDescription: true,\n      title: i18n.t(`${NS}:${K.LICENSE_EXPIRED}`),\n      variant: \"license-expired\",\n    };\n  }\n\n  return {\n    showLink: \"previous\",\n    showDescription: true,\n    title: i18n.t(`${NS}:${K.UNKNOWN_ERROR}`),\n    variant: \"unknown-error\",\n  };\n}\n","import type {\n  BrickConf,\n  BrickConfInTemplate,\n  ContextConf,\n  MenuConf,\n  RouteConf,\n  RouteConfOfBricks,\n  SlotConfOfBricks,\n  SlotsConf,\n  StaticMenuConf,\n} from \"@next-core/types\";\nimport {\n  enqueueStableLoadBricks,\n  flushStableLoadBricks,\n  loadBricksImperatively,\n  loadProcessorsImperatively,\n  loadScript,\n  loadStyle,\n} from \"@next-core/loader\";\nimport { isTrackAll } from \"@next-core/cook\";\nimport { hasOwnProperty } from \"@next-core/utils/general\";\nimport { strictCollectMemberUsage } from \"@next-core/utils/storyboard\";\nimport { debounce, isEqual } from \"lodash\";\nimport { asyncCheckBrickIf } from \"./compute/checkIf.js\";\nimport {\n  asyncComputeRealPropertyEntries,\n  constructAsyncProperties,\n} from \"./compute/computeRealProperties.js\";\nimport { resolveData } from \"./data/resolveData.js\";\nimport { asyncComputeRealValue } from \"./compute/computeRealValue.js\";\nimport {\n  TrackingContextItem,\n  listenOnTrackingContext,\n  trackAfterInitial,\n  type InitialTracker,\n} from \"./compute/listenOnTrackingContext.js\";\nimport { RendererContext } from \"./RendererContext.js\";\nimport { matchRoute, matchRoutes } from \"./matchRoutes.js\";\nimport {\n  symbolForAsyncComputedPropsFromHost,\n  symbolForTPlExternalForEachIndex,\n  symbolForTPlExternalForEachItem,\n  symbolForTPlExternalForEachSize,\n  symbolForTplStateStoreId,\n} from \"./CustomTemplates/constants.js\";\nimport { expandCustomTemplate } from \"./CustomTemplates/expandCustomTemplate.js\";\nimport type {\n  MenuRequestNode,\n  RenderBrick,\n  RenderChildNode,\n  RenderReturnNode,\n  RuntimeBrickConfWithSymbols,\n  RuntimeContext,\n} from \"./interfaces.js\";\nimport {\n  getTagNameOfCustomTemplate,\n  getTplStateStore,\n} from \"./CustomTemplates/utils.js\";\nimport { customTemplates } from \"../CustomTemplates.js\";\nimport type { NextHistoryState } from \"./historyExtended.js\";\nimport { getBrickPackages, hooks } from \"./Runtime.js\";\nimport { RenderTag } from \"./enums.js\";\nimport { getTracks } from \"./compute/getTracks.js\";\nimport { isStrictMode, warnAboutStrictMode } from \"../isStrictMode.js\";\nimport {\n  FORM_RENDERER,\n  RuntimeBrickConfOfFormSymbols,\n  symbolForFormStateStoreId,\n} from \"./FormRenderer/constants.js\";\nimport { expandFormRenderer } from \"./FormRenderer/expandFormRenderer.js\";\nimport { registerFormRenderer } from \"./FormRenderer/registerFormRenderer.js\";\nimport { isPreEvaluated } from \"./compute/evaluate.js\";\nimport { getPreEvaluatedRaw } from \"./compute/evaluate.js\";\nimport { RuntimeBrickConfOfTplSymbols } from \"./CustomTemplates/constants.js\";\nimport { matchHomepage } from \"./matchStoryboard.js\";\nimport type { DataStore, DataStoreType } from \"./data/DataStore.js\";\nimport { listenerFactory } from \"./bindListeners.js\";\nimport type { MatchResult } from \"./matchPath.js\";\nimport { setupRootRuntimeContext } from \"./setupRootRuntimeContext.js\";\nimport { setMatchedRoute } from \"./routeMatchedMap.js\";\nimport { ErrorNode } from \"./ErrorNode.js\";\n\nexport interface RenderOutput {\n  node?: RenderChildNode;\n  unauthenticated?: boolean;\n  redirect?: {\n    path: string;\n    state?: NextHistoryState;\n  };\n  route?: RouteConf;\n  path?: string;\n  blockingList: (Promise<unknown> | undefined)[];\n  menuRequestNode?: MenuRequestNode;\n  hasTrackingControls?: boolean;\n}\n\nexport async function renderRoutes(\n  returnNode: RenderReturnNode,\n  routes: RouteConf[],\n  _runtimeContext: RuntimeContext,\n  rendererContext: RendererContext,\n  parentRoutes: RouteConf[],\n  menuRequestReturnNode: MenuRequestNode,\n  slotId?: string,\n  isIncremental?: boolean,\n  initialTracker?: InitialTracker\n): Promise<RenderOutput> {\n  const matched = await matchRoutes(routes, _runtimeContext);\n  const output = getEmptyRenderOutput();\n  const menuRequestNode: MenuRequestNode = (output.menuRequestNode = {\n    return: menuRequestReturnNode,\n  });\n  switch (matched) {\n    case \"missed\":\n      break;\n    case \"unauthenticated\":\n      output.unauthenticated = true;\n      break;\n    default: {\n      const route = (output.route = matched.route);\n      output.path = matched.match.path;\n      const runtimeContext = {\n        ..._runtimeContext,\n        match: matched.match,\n      };\n\n      if (route.iid) {\n        setMatchedRoute(route.iid, matched.match);\n      }\n\n      if (isIncremental) {\n        runtimeContext.ctxStore.disposeDataInRoutes(routes);\n      }\n      const routePath = parentRoutes.concat(route);\n      runtimeContext.ctxStore.define(\n        route.context,\n        runtimeContext,\n        undefined,\n        routePath\n      );\n      runtimeContext.pendingPermissionsPreCheck.push(\n        hooks?.checkPermissions?.preCheckPermissionsForBrickOrRoute(\n          route,\n          (value) => asyncComputeRealValue(value, runtimeContext)\n        )\n      );\n\n      // Currently, this is only used for brick size-checking: these bricks\n      // will be loaded before page rendering, but they will NOT be rendered.\n      const { preLoadBricks } = route as { preLoadBricks?: string[] };\n      if (Array.isArray(preLoadBricks)) {\n        output.blockingList.push(\n          loadBricksImperatively(preLoadBricks, getBrickPackages())\n        );\n      }\n\n      if (route.type === \"redirect\") {\n        let redirectTo: unknown;\n        if (typeof route.redirect === \"string\") {\n          redirectTo = await asyncComputeRealValue(\n            route.redirect,\n            runtimeContext\n          );\n        } else {\n          const resolved = (await resolveData(\n            {\n              transform: \"redirect\",\n              ...route.redirect,\n            },\n            runtimeContext\n          )) as { redirect?: unknown };\n          redirectTo = resolved.redirect;\n        }\n        if (typeof redirectTo !== \"string\") {\n          // eslint-disable-next-line no-console\n          console.error(\"Unexpected redirect result:\", redirectTo);\n          throw new Error(\n            `Unexpected type of redirect result: ${typeof redirectTo}`\n          );\n        }\n        output.redirect = { path: redirectTo };\n      } else {\n        const menuRequest = loadMenu(route.menu, runtimeContext);\n        if (menuRequest) {\n          menuRequestNode.request = menuRequest;\n        }\n\n        if (!isIncremental) {\n          rendererContext.memoizeMenuRequestNode(routes, menuRequestNode);\n        }\n\n        let newOutput: RenderOutput;\n        if (route.type === \"routes\") {\n          newOutput = await renderRoutes(\n            returnNode,\n            route.routes,\n            runtimeContext,\n            rendererContext,\n            routePath,\n            menuRequestNode,\n            slotId,\n            undefined,\n            initialTracker\n          );\n        } else {\n          newOutput = await renderBricks(\n            returnNode,\n            route.bricks,\n            runtimeContext,\n            rendererContext,\n            routePath,\n            menuRequestNode,\n            slotId,\n            undefined,\n            undefined,\n            initialTracker\n          );\n        }\n\n        mergeRenderOutput(output, newOutput);\n        appendMenuRequestNode(menuRequestNode, newOutput.menuRequestNode);\n      }\n    }\n  }\n\n  return output;\n}\n\nexport async function renderBricks(\n  returnNode: RenderReturnNode,\n  bricks: BrickConf[],\n  runtimeContext: RuntimeContext,\n  rendererContext: RendererContext,\n  parentRoutes: RouteConf[],\n  menuRequestReturnNode: MenuRequestNode,\n  slotId?: string,\n  tplStack?: Map<string, number>,\n  keyPath?: number[],\n  initialTracker?: InitialTracker\n): Promise<RenderOutput> {\n  setupRootRuntimeContext(bricks, runtimeContext, true);\n  const output = getEmptyRenderOutput();\n  const kPath = keyPath ?? [];\n  // 多个构件并行异步转换，但转换的结果按原顺序串行合并。\n  const rendered = await Promise.all(\n    bricks.map((brickConf, index) =>\n      renderBrick(\n        returnNode,\n        brickConf,\n        runtimeContext,\n        rendererContext,\n        parentRoutes,\n        menuRequestReturnNode,\n        slotId,\n        kPath.concat(index),\n        tplStack && new Map(tplStack),\n        initialTracker\n      )\n    )\n  );\n\n  rendered.forEach((item, index) => {\n    if (item.hasTrackingControls) {\n      // Memoize a render node before it's been merged.\n      rendererContext.memoize(\n        slotId,\n        kPath.concat(index),\n        item.node,\n        returnNode\n      );\n    }\n    mergeRenderOutput(output, item);\n  });\n\n  return output;\n}\n\nexport async function renderBrick(\n  returnNode: RenderReturnNode,\n  brickConf: RuntimeBrickConfWithSymbols,\n  _runtimeContext: RuntimeContext,\n  rendererContext: RendererContext,\n  parentRoutes: RouteConf[],\n  menuRequestReturnNode: MenuRequestNode,\n  slotId?: string,\n  keyPath: number[] = [],\n  tplStack = new Map<string, number>(),\n  initialTracker?: InitialTracker\n): Promise<RenderOutput> {\n  try {\n    return await legacyRenderBrick(\n      returnNode,\n      brickConf,\n      _runtimeContext,\n      rendererContext,\n      parentRoutes,\n      menuRequestReturnNode,\n      slotId,\n      keyPath,\n      tplStack,\n      initialTracker\n    );\n  } catch (error) {\n    if (brickConf.errorBoundary) {\n      // eslint-disable-next-line no-console\n      console.error(\"Error caught by error boundary:\", error);\n      return {\n        node: await ErrorNode(error, returnNode),\n        blockingList: [],\n      };\n    } else {\n      throw error;\n    }\n  }\n}\n\nasync function legacyRenderBrick(\n  returnNode: RenderReturnNode,\n  brickConf: RuntimeBrickConfWithSymbols,\n  _runtimeContext: RuntimeContext,\n  rendererContext: RendererContext,\n  parentRoutes: RouteConf[],\n  menuRequestReturnNode: MenuRequestNode,\n  slotId: string | undefined,\n  keyPath: number[],\n  tplStack: Map<string, number>,\n  initialTracker?: InitialTracker\n): Promise<RenderOutput> {\n  const output = getEmptyRenderOutput();\n\n  if (!brickConf.brick) {\n    if ((brickConf as { template?: string }).template) {\n      // eslint-disable-next-line no-console\n      console.error(\"Legacy templates are dropped in v3:\", brickConf);\n    } else {\n      // eslint-disable-next-line no-console\n      console.error(\"Invalid brick:\", brickConf);\n    }\n    return output;\n  }\n\n  // Translate `if: \"<%= ... %>\"` to `brick: \":if\", dataSource: \"<%= ... %>\"`.\n  // In other words, translate tracking if expressions to tracking control nodes of `:if`.\n  const { if: brickIf, permissionsPreCheck, ...restBrickConf } = brickConf;\n  if (isGeneralizedTrackAll(brickIf)) {\n    return renderBrick(\n      returnNode,\n      {\n        brick: \":if\",\n        dataSource: brickIf,\n        // `permissionsPreCheck` maybe required before computing `if`.\n        permissionsPreCheck,\n        slots: {\n          \"\": {\n            type: \"bricks\",\n            bricks: [restBrickConf],\n          },\n        },\n        // These symbols have to be copied to the new brick conf.\n        ...Object.getOwnPropertySymbols(brickConf).reduce(\n          (acc, symbol) => ({\n            ...acc,\n            [symbol]: brickConf[symbol as typeof symbolForTplStateStoreId],\n          }),\n          {} as RuntimeBrickConfOfTplSymbols & RuntimeBrickConfOfFormSymbols\n        ),\n      },\n      _runtimeContext,\n      rendererContext,\n      parentRoutes,\n      menuRequestReturnNode,\n      slotId,\n      keyPath,\n      tplStack,\n      initialTracker\n    );\n  }\n\n  const tplStateStoreId = brickConf[symbolForTplStateStoreId];\n  const formStateStoreId = brickConf[symbolForFormStateStoreId];\n  const runtimeContext = {\n    ..._runtimeContext,\n    tplStateStoreId,\n    formStateStoreId,\n  };\n\n  if (hasOwnProperty(brickConf, symbolForTPlExternalForEachItem)) {\n    // The external bricks of a template should restore their `forEach*` from their host.\n    runtimeContext.forEachItem = brickConf[symbolForTPlExternalForEachItem];\n    runtimeContext.forEachIndex = brickConf[symbolForTPlExternalForEachIndex];\n    runtimeContext.forEachSize = brickConf[symbolForTPlExternalForEachSize];\n  }\n\n  const { context } = brickConf as { context?: ContextConf[] };\n  // istanbul ignore next\n  if (Array.isArray(context) && context.length > 0) {\n    const strict = isStrictMode(runtimeContext);\n    warnAboutStrictMode(\n      strict,\n      \"Defining context on bricks\",\n      \"check your brick:\",\n      brickConf\n    );\n    if (!strict) {\n      runtimeContext.ctxStore.define(context, runtimeContext);\n    }\n  }\n\n  runtimeContext.pendingPermissionsPreCheck.push(\n    hooks?.checkPermissions?.preCheckPermissionsForBrickOrRoute(\n      brickConf,\n      (value) => asyncComputeRealValue(value, runtimeContext)\n    )\n  );\n\n  if (!(await asyncCheckBrickIf(brickConf, runtimeContext))) {\n    return output;\n  }\n\n  const brickName = brickConf.brick;\n  if (brickName.startsWith(\":\")) {\n    ensureValidControlBrick(brickName);\n\n    const { dataSource } = brickConf;\n    const { contextNames, stateNames } = getTracks(dataSource);\n\n    const lowerLevelRenderControlNode = async (\n      runtimeContext: RuntimeContext,\n      tracker: InitialTracker,\n      trackDataSource: boolean\n    ) => {\n      // First, compute the `dataSource`\n      const computedDataSource = await asyncComputeRealValue(\n        dataSource,\n        runtimeContext\n      );\n\n      if (trackDataSource) {\n        trackAfterInitial(\n          runtimeContext,\n          [{ contextNames, stateNames, propValue: dataSource }],\n          tracker\n        );\n      }\n\n      // Then, get the matched slot.\n      const slot =\n        brickName === \":forEach\"\n          ? \"\"\n          : brickName === \":switch\"\n            ? String(computedDataSource)\n            : computedDataSource\n              ? \"\"\n              : \"else\";\n\n      // Don't forget to transpile children to slots.\n      const slots = childrenToSlots(brickConf.children, brickConf.slots);\n\n      // Then, get the bricks in that matched slot.\n      const bricks =\n        slots &&\n        hasOwnProperty(slots, slot) &&\n        (slots[slot] as SlotConfOfBricks)?.bricks;\n\n      if (!Array.isArray(bricks)) {\n        return getEmptyRenderOutput();\n      }\n\n      switch (brickName) {\n        case \":forEach\": {\n          if (!Array.isArray(computedDataSource)) {\n            return getEmptyRenderOutput();\n          }\n          return renderForEach(\n            returnNode,\n            computedDataSource,\n            bricks,\n            runtimeContext,\n            rendererContext,\n            parentRoutes,\n            menuRequestReturnNode,\n            slotId,\n            tplStack,\n            keyPath,\n            tracker\n          );\n        }\n        case \":if\":\n        case \":switch\": {\n          return renderBricks(\n            returnNode,\n            bricks,\n            runtimeContext,\n            rendererContext,\n            parentRoutes,\n            menuRequestReturnNode,\n            slotId,\n            tplStack,\n            keyPath,\n            tracker\n          );\n        }\n      }\n    };\n\n    const renderControlNode = async (\n      runtimeContext: RuntimeContext,\n      type: \"initial\" | \"rerender\"\n    ) => {\n      let changedAfterInitial = false;\n      const tracker: InitialTracker = {\n        disposes: [],\n        listener: () => {\n          changedAfterInitial = true;\n        },\n      };\n      let rerenderCount = 0;\n      let rawOutput: RenderOutput;\n      let uninitialized = true;\n\n      // When perform an incremental sub-route render, for control nodes,\n      // context maybe changed just after their data source being computed,\n      // as well as props of their children bricks being computed, and before\n      // bricks being mounted. Thus these changes may not take any effects.\n      // So we need to track the context changes after the initial render,\n      // and perform re-renders for these control nodes if necessary.\n      while (uninitialized || changedAfterInitial) {\n        changedAfterInitial = false;\n        rawOutput = await lowerLevelRenderControlNode(\n          runtimeContext,\n          tracker,\n          uninitialized && type === \"initial\"\n        );\n        tracker.disposes.forEach((dispose) => dispose());\n        tracker.disposes.length = 0;\n        uninitialized = false;\n        // istanbul ignore next\n        if (++rerenderCount > 10) {\n          throw new Error(\n            `Maximum rerender stack overflowed (iid: ${brickConf.iid})`\n          );\n        }\n      }\n\n      rawOutput!.node ??= {\n        tag: RenderTag.PLACEHOLDER,\n        return: returnNode,\n      };\n      return rawOutput!;\n    };\n\n    const controlledOutput = await renderControlNode(runtimeContext, \"initial\");\n\n    const { onMount, onUnmount } = brickConf.lifeCycle ?? {};\n\n    if (contextNames || stateNames) {\n      controlledOutput.hasTrackingControls = true;\n      let renderId = 0;\n      const listener = async () => {\n        const currentRenderId = ++renderId;\n        const [scopedRuntimeContext, tplStateStoreScope, formStateStoreScope] =\n          createScopedRuntimeContext(runtimeContext);\n\n        const reControlledOutput = await renderControlNode(\n          scopedRuntimeContext,\n          \"rerender\"\n        );\n\n        const scopedStores = [...tplStateStoreScope, ...formStateStoreScope];\n        await postAsyncRender(\n          reControlledOutput,\n          scopedRuntimeContext,\n          scopedStores\n        );\n\n        // Ignore stale renders\n        if (renderId === currentRenderId) {\n          if (onUnmount) {\n            listenerFactory(\n              onUnmount,\n              runtimeContext\n            )(new CustomEvent(\"unmount\", { detail: { rerender: true } }));\n          }\n\n          rendererContext.reRender(\n            slotId,\n            keyPath,\n            reControlledOutput.node,\n            returnNode\n          );\n\n          if (onMount) {\n            listenerFactory(\n              onMount,\n              scopedRuntimeContext\n            )(new CustomEvent(\"mount\", { detail: { rerender: true } }));\n          }\n\n          for (const store of scopedStores) {\n            store.mountAsyncData();\n          }\n        }\n      };\n      // Enable leading invocation, to keep tracking orders.\n      const debouncedListener = debounce(listener, 0, {\n        leading: true,\n        trailing: true,\n      });\n      const runtimeBrick =\n        returnNode.tag === RenderTag.BRICK ? returnNode : null;\n      const disposes = runtimeBrick ? (runtimeBrick.disposes ??= []) : [];\n      if (contextNames) {\n        for (const contextName of contextNames) {\n          disposes.push(\n            runtimeContext.ctxStore.onChange(contextName, debouncedListener)\n          );\n        }\n      }\n      if (stateNames) {\n        for (const contextName of stateNames) {\n          const tplStateStore = getTplStateStore(\n            runtimeContext,\n            \"STATE\",\n            `: \"${dataSource}\"`\n          );\n          disposes.push(tplStateStore.onChange(contextName, debouncedListener));\n        }\n      }\n    }\n\n    if (onMount) {\n      rendererContext.registerArbitraryLifeCycle(\"onMount\", () => {\n        listenerFactory(\n          onMount,\n          runtimeContext\n        )(new CustomEvent(\"mount\", { detail: { rerender: false } }));\n      });\n    }\n\n    if (onUnmount) {\n      rendererContext.registerArbitraryLifeCycle(\"onUnmount\", () => {\n        listenerFactory(\n          onUnmount,\n          runtimeContext\n        )(new CustomEvent(\"unmount\", { detail: { rerender: false } }));\n      });\n    }\n\n    return controlledOutput;\n  }\n\n  // Widgets need to be defined before rendering.\n  if (/\\.tpl-/.test(brickName) && !customTemplates.get(brickName)) {\n    await catchLoad(\n      loadBricksImperatively([brickName], getBrickPackages()),\n      \"brick\",\n      brickName,\n      rendererContext.unknownBricks\n    );\n  }\n\n  const tplTagName = getTagNameOfCustomTemplate(\n    brickName,\n    runtimeContext.app?.id\n  );\n\n  if (tplTagName) {\n    const tplCount = tplStack.get(tplTagName) ?? 0;\n    if (tplCount >= 10) {\n      throw new Error(\n        `Maximum custom template stack overflowed: \"${tplTagName}\"`\n      );\n    }\n    tplStack.set(tplTagName, tplCount + 1);\n  } else if (brickName.includes(\"-\") && !customElements.get(brickName)) {\n    if (brickName === FORM_RENDERER) {\n      registerFormRenderer();\n    } else {\n      output.blockingList.push(\n        catchLoad(\n          enqueueStableLoadBricks([brickName], getBrickPackages()),\n          \"brick\",\n          brickName,\n          rendererContext.unknownBricks\n        )\n      );\n    }\n  }\n\n  let formData: unknown;\n  let confProps: Record<string, unknown> | undefined;\n  if (brickName === FORM_RENDERER) {\n    ({ formData, ...confProps } = brickConf.properties ?? {});\n\n    if (brickConf.properties?.compute) {\n      formData = await asyncComputeRealValue(formData, runtimeContext);\n    }\n  } else {\n    confProps = brickConf.properties;\n  }\n\n  const trackingContextList: TrackingContextItem[] = [];\n  const asyncPropertyEntries = asyncComputeRealPropertyEntries(\n    confProps,\n    runtimeContext,\n    trackingContextList\n  );\n\n  const computedPropsFromHost = brickConf[symbolForAsyncComputedPropsFromHost];\n  if (computedPropsFromHost) {\n    asyncPropertyEntries.push(...computedPropsFromHost);\n  }\n\n  const isScript = brickName === \"script\";\n  if (isScript || brickName === \"link\") {\n    const props = await constructAsyncProperties(asyncPropertyEntries);\n    if (isScript ? props.src : props.rel === \"stylesheet\" && props.href) {\n      const prefix = window.PUBLIC_ROOT ?? \"\";\n      if (isScript) {\n        const { src, ...attrs } = props;\n        await catchLoad(\n          loadScript(src as string, prefix, attrs),\n          \"script\",\n          src as string,\n          \"silent\"\n        );\n      } else {\n        const { href, ...attrs } = props;\n        await catchLoad(\n          loadStyle(href as string, prefix, attrs),\n          \"stylesheet\",\n          href as string,\n          \"silent\"\n        );\n      }\n      return output;\n    }\n  }\n\n  const brick: RenderBrick = {\n    tag: RenderTag.BRICK,\n    type: tplTagName || brickName,\n    return: returnNode,\n    slotId,\n    events: brickConf.events,\n    runtimeContext,\n    portal: brickConf.portal,\n    iid: brickConf.iid,\n    ref: (brickConf as BrickConfInTemplate).ref,\n  };\n\n  output.node = brick;\n\n  // 在最终挂载前，先加载所有可能用到的 processors。\n  const usedProcessors = strictCollectMemberUsage(\n    [brickConf.events, brickConf.lifeCycle],\n    \"PROCESSORS\",\n    2\n  );\n  if (usedProcessors.size > 0) {\n    output.blockingList.push(\n      catchLoad(\n        loadProcessorsImperatively(usedProcessors, getBrickPackages()),\n        \"processors\",\n        [...usedProcessors].join(\", \"),\n        rendererContext.unknownBricks\n      )\n    );\n  }\n\n  // 加载构件属性和加载子构件等任务，可以并行。\n  const blockingList: Promise<unknown>[] = [];\n\n  // Note: properties here has already been initialized.\n  trackAfterInitial(runtimeContext, trackingContextList, initialTracker);\n\n  const loadProperties = async () => {\n    brick.properties = await constructAsyncProperties(asyncPropertyEntries);\n    listenOnTrackingContext(brick, trackingContextList);\n  };\n  blockingList.push(loadProperties());\n\n  rendererContext.registerBrickLifeCycle(brick, brickConf.lifeCycle);\n\n  let expandedBrickConf = brickConf;\n  if (tplTagName) {\n    expandedBrickConf = expandCustomTemplate(\n      tplTagName,\n      brickConf,\n      brick,\n      asyncPropertyEntries,\n      rendererContext\n    );\n  } else if (brickName === FORM_RENDERER) {\n    expandedBrickConf = expandFormRenderer(\n      formData,\n      brickConf,\n      brick,\n      asyncPropertyEntries,\n      rendererContext\n    );\n  }\n\n  if (expandedBrickConf.portal) {\n    // A portal brick has no slotId.\n    brick.slotId = undefined;\n  }\n\n  let childRuntimeContext: RuntimeContext;\n  if (tplTagName) {\n    // There is a boundary for `forEachItem` between template internals and externals.\n    childRuntimeContext = {\n      ...runtimeContext,\n    };\n    delete childRuntimeContext.forEachItem;\n    delete childRuntimeContext.forEachIndex;\n    delete childRuntimeContext.forEachSize;\n  } else {\n    childRuntimeContext = runtimeContext;\n  }\n\n  const loadChildren = async () => {\n    const slots = childrenToSlots(\n      expandedBrickConf.children,\n      expandedBrickConf.slots\n    );\n    if (!slots) {\n      return;\n    }\n    const routeSlotFromIndexToSlotId = new Map<number, string>();\n    const rendered = await Promise.all(\n      Object.entries(slots).map(([childSlotId, slotConf], index) => {\n        if (slotConf.type !== \"routes\") {\n          return renderBricks(\n            brick,\n            (slotConf as SlotConfOfBricks).bricks,\n            childRuntimeContext,\n            rendererContext,\n            parentRoutes,\n            menuRequestReturnNode,\n            childSlotId,\n            tplStack,\n            undefined,\n            initialTracker\n          );\n        }\n\n        const parentRoute = parentRoutes[parentRoutes.length - 1] as\n          | RouteConfOfBricks\n          | undefined;\n        if (parentRoute?.incrementalSubRoutes) {\n          routeSlotFromIndexToSlotId.set(index, childSlotId);\n          rendererContext.performIncrementalRender(\n            slotConf,\n            parentRoutes,\n            async (location, prevLocation) => {\n              const { homepage } = childRuntimeContext.app;\n              const { pathname } = location;\n              // Ignore if any one of homepage and parent routes not matched.\n              if (\n                !matchHomepage(homepage, pathname) ||\n                !parentRoutes.every((route) => {\n                  let prevMatch: MatchResult | null;\n                  let newMatch: MatchResult | null;\n                  return (\n                    (prevMatch = matchRoute(\n                      route,\n                      homepage,\n                      prevLocation.pathname\n                    )) &&\n                    (newMatch = matchRoute(route, homepage, pathname)) &&\n                    (route !== parentRoute ||\n                      isEqual(prevMatch.params, newMatch.params))\n                  );\n                })\n              ) {\n                return false;\n              }\n\n              const [\n                scopedRuntimeContext,\n                tplStateStoreScope,\n                formStateStoreScope,\n              ] = createScopedRuntimeContext({\n                ...childRuntimeContext,\n                location,\n                query: new URLSearchParams(location.search),\n              });\n\n              let failed = false;\n              let incrementalOutput: RenderOutput;\n              let scopedStores: DataStore<\"STATE\" | \"FORM_STATE\">[] = [];\n\n              try {\n                incrementalOutput = await renderRoutes(\n                  brick,\n                  slotConf.routes,\n                  scopedRuntimeContext,\n                  rendererContext,\n                  parentRoutes,\n                  menuRequestReturnNode,\n                  childSlotId,\n                  true\n                );\n\n                // Do not ignore incremental rendering even if all sub-routes are missed.\n                // Since parent route is matched.\n                if (incrementalOutput.route) {\n                  // Bailout if redirect or unauthenticated is set\n                  if (rendererContext.reBailout(incrementalOutput)) {\n                    return true;\n                  }\n\n                  scopedStores = [\n                    ...tplStateStoreScope,\n                    ...formStateStoreScope,\n                  ];\n                  await postAsyncRender(\n                    incrementalOutput,\n                    scopedRuntimeContext,\n                    [scopedRuntimeContext.ctxStore, ...scopedStores]\n                  );\n                }\n\n                await rendererContext.reMergeMenuRequestNodes(\n                  menuRequestReturnNode,\n                  slotConf.routes,\n                  incrementalOutput.menuRequestNode\n                );\n              } catch (error) {\n                // eslint-disable-next-line no-console\n                console.error(\"Incremental sub-router failed:\", error);\n\n                const result = await rendererContext.reCatch(error, brick);\n                if (!result) {\n                  return true;\n                }\n                ({ failed, output: incrementalOutput } = result);\n\n                // Assert: no errors will be throw\n                await rendererContext.reMergeMenuRequestNodes(\n                  menuRequestReturnNode,\n                  slotConf.routes,\n                  incrementalOutput.menuRequestNode\n                );\n              }\n\n              rendererContext.reRender(\n                childSlotId,\n                [],\n                incrementalOutput.node,\n                brick\n              );\n\n              if (!failed) {\n                scopedRuntimeContext.ctxStore.mountAsyncData(\n                  incrementalOutput.route\n                );\n                for (const store of scopedStores) {\n                  store.mountAsyncData();\n                }\n              }\n\n              // When result is null, it means the incremental rendering is tried but routes missed.\n              // In this case, we should continue to re-render the parent routes.\n              return incrementalOutput.route ? true : null;\n            }\n          );\n        }\n\n        return renderRoutes(\n          brick,\n          slotConf.routes,\n          childRuntimeContext,\n          rendererContext,\n          parentRoutes,\n          menuRequestReturnNode,\n          childSlotId,\n          undefined,\n          initialTracker\n        );\n      })\n    );\n\n    const childrenOutput: RenderOutput = {\n      ...output,\n      node: undefined,\n      blockingList: [],\n      menuRequestNode: undefined,\n    };\n    rendered.forEach((item, index) => {\n      if (routeSlotFromIndexToSlotId.has(index)) {\n        // Memoize a render node before it's been merged.\n        rendererContext.memoize(\n          routeSlotFromIndexToSlotId.get(index),\n          [],\n          item.node,\n          brick\n        );\n      }\n      mergeRenderOutput(childrenOutput, item);\n      mergeSiblingRenderMenuRequest(childrenOutput, item);\n    });\n    if (childrenOutput.node) {\n      brick.child = childrenOutput.node;\n    }\n    mergeRenderOutput(output, {\n      ...childrenOutput,\n      node: undefined,\n    });\n\n    appendMenuRequestNode(\n      menuRequestReturnNode,\n      (output.menuRequestNode = childrenOutput.menuRequestNode)\n    );\n  };\n  blockingList.push(loadChildren());\n\n  await Promise.all(blockingList);\n\n  return output;\n}\n\nfunction isGeneralizedTrackAll(brickIf: unknown): boolean {\n  return typeof brickIf === \"string\"\n    ? isTrackAll(brickIf)\n    : isPreEvaluated(brickIf) &&\n        // istanbul ignore next: covered by e2e tests\n        isTrackAll(getPreEvaluatedRaw(brickIf));\n}\n\ntype ValidControlBrick = \":forEach\" | \":if\" | \":switch\";\n\nfunction ensureValidControlBrick(\n  brick: string\n): asserts brick is ValidControlBrick {\n  if (brick !== \":forEach\" && brick !== \":if\" && brick !== \":switch\") {\n    throw new Error(`Unknown storyboard control node: \"${brick}\"`);\n  }\n}\n\nasync function renderForEach(\n  returnNode: RenderReturnNode,\n  dataSource: unknown[],\n  bricks: BrickConf[],\n  runtimeContext: RuntimeContext,\n  rendererContext: RendererContext,\n  parentRoutes: RouteConf[],\n  menuRequestReturnNode: MenuRequestNode,\n  slotId: string | undefined,\n  tplStack: Map<string, number>,\n  keyPath: number[],\n  initialTracker?: InitialTracker\n): Promise<RenderOutput> {\n  const output = getEmptyRenderOutput();\n\n  const size = dataSource.length;\n  const rendered = await Promise.all(\n    dataSource.map((item, i) =>\n      Promise.all(\n        bricks.map((brickConf, j) =>\n          renderBrick(\n            returnNode,\n            brickConf,\n            {\n              ...runtimeContext,\n              forEachItem: item,\n              forEachIndex: i,\n              forEachSize: size,\n            },\n            rendererContext,\n            parentRoutes,\n            menuRequestReturnNode,\n            slotId,\n            keyPath.concat(i * size + j),\n            tplStack && new Map(tplStack),\n            initialTracker\n          )\n        )\n      )\n    )\n  );\n\n  // 多层构件并行异步转换，但转换的结果按原顺序串行合并。\n  rendered.flat().forEach((item, index) => {\n    if (item.hasTrackingControls) {\n      // Memoize a render node before it's been merged.\n      rendererContext.memoize(\n        slotId,\n        keyPath.concat(index),\n        item.node,\n        returnNode\n      );\n    }\n    mergeRenderOutput(output, item);\n  });\n\n  return output;\n}\n\nexport function getDataStores(runtimeContext: RuntimeContext) {\n  return [\n    runtimeContext.ctxStore,\n    ...runtimeContext.tplStateStoreMap.values(),\n    ...runtimeContext.formStateStoreMap.values(),\n  ];\n}\n\nexport function postAsyncRender(\n  output: RenderOutput,\n  runtimeContext: RuntimeContext,\n  stores: DataStore<DataStoreType>[]\n) {\n  flushStableLoadBricks();\n\n  return Promise.all([\n    ...output.blockingList,\n    ...stores.map((store) => store.waitForAll()),\n    ...runtimeContext.pendingPermissionsPreCheck,\n  ]);\n}\n\nexport function createScopedRuntimeContext(\n  runtimeContext: RuntimeContext\n): [\n  scopedRuntimeContext: RuntimeContext,\n  tplStateStoreScope: DataStore<\"STATE\">[],\n  formStateStoreScope: DataStore<\"FORM_STATE\">[],\n] {\n  const tplStateStoreScope: DataStore<\"STATE\">[] = [];\n  const formStateStoreScope: DataStore<\"FORM_STATE\">[] = [];\n  const scopedRuntimeContext: RuntimeContext = {\n    ...runtimeContext,\n    tplStateStoreScope,\n    formStateStoreScope,\n  };\n  return [scopedRuntimeContext, tplStateStoreScope, formStateStoreScope];\n}\n\nfunction loadMenu(\n  menuConf: MenuConf | undefined,\n  runtimeContext: RuntimeContext\n) {\n  if (!menuConf) {\n    return;\n  }\n\n  // istanbul ignore next\n  if ((menuConf as { type?: \"brick\" }).type === \"brick\") {\n    // eslint-disable-next-line no-console\n    console.error(\"Set menu with brick is dropped in v3:\", menuConf);\n    throw new Error(\"Set menu with brick is dropped in v3\");\n  }\n\n  // istanbul ignore next\n  if (menuConf.type === \"resolve\") {\n    // eslint-disable-next-line no-console\n    console.warn(\"Set menu with resolve is not supported in v3 yet:\", menuConf);\n    return;\n  }\n\n  return asyncComputeRealValue(\n    menuConf,\n    runtimeContext\n  ) as Promise<StaticMenuConf>;\n}\n\nfunction mergeRenderOutput(\n  output: RenderOutput,\n  newOutput: RenderOutput\n): void {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const { blockingList, node, menuRequestNode, hasTrackingControls, ...rest } =\n    newOutput;\n  output.blockingList.push(...blockingList);\n\n  if (node) {\n    if (output.node) {\n      let last = output.node;\n      while (last.sibling) {\n        last = last.sibling;\n      }\n      last.sibling = node;\n    } else {\n      output.node = node;\n    }\n  }\n\n  Object.assign(output, rest);\n}\n\nfunction mergeSiblingRenderMenuRequest(\n  output: RenderOutput,\n  newOutput: RenderOutput\n) {\n  const menuRequestNode = newOutput.menuRequestNode;\n  if (menuRequestNode) {\n    if (output.menuRequestNode) {\n      let last = output.menuRequestNode;\n      while (last.sibling) {\n        last = last.sibling;\n      }\n      last.sibling = menuRequestNode;\n    } else {\n      output.menuRequestNode = menuRequestNode;\n    }\n  }\n}\n\nfunction appendMenuRequestNode(\n  menuRequestReturnNode: MenuRequestNode,\n  menuRequestNode: MenuRequestNode | undefined\n) {\n  if (!menuRequestNode) {\n    return;\n  }\n  if (menuRequestReturnNode.child) {\n    let last = menuRequestReturnNode.child;\n    while (last.sibling) {\n      last = last.sibling;\n    }\n    last.sibling = menuRequestNode;\n  } else {\n    menuRequestReturnNode.child = menuRequestNode;\n  }\n}\n\nfunction getEmptyRenderOutput(): RenderOutput {\n  return { blockingList: [] };\n}\n\nexport function childrenToSlots(\n  children: BrickConf[] | undefined,\n  originalSlots: SlotsConf | undefined\n) {\n  let newSlots = originalSlots;\n  // istanbul ignore next\n  if (\n    process.env.NODE_ENV === \"development\" &&\n    children &&\n    !Array.isArray(children)\n  ) {\n    // eslint-disable-next-line no-console\n    console.warn(\n      \"Specified brick children but not array:\",\n      `<${typeof children}>`,\n      children\n    );\n  }\n  if (Array.isArray(children) && !newSlots) {\n    newSlots = {};\n    for (const child of children) {\n      const slot = child.slot ?? \"\";\n      if (!hasOwnProperty(newSlots, slot)) {\n        newSlots[slot] = {\n          type: \"bricks\",\n          bricks: [],\n        };\n      }\n      (newSlots[slot] as SlotConfOfBricks).bricks.push(child);\n    }\n  }\n  return newSlots;\n}\n\nfunction catchLoad(\n  promise: Promise<unknown>,\n  type: \"brick\" | \"processors\" | \"script\" | \"stylesheet\",\n  name: string,\n  unknownPolicy: RendererContext[\"unknownBricks\"]\n) {\n  return unknownPolicy === \"silent\"\n    ? promise.catch((e) => {\n        // eslint-disable-next-line no-console\n        console.error(`Load %s \"%s\" failed:`, type, name, e);\n      })\n    : promise;\n}\n","import { isObject } from \"@next-core/utils/general\";\nimport type {\n  BrickConf,\n  UseBrickSlotsConf,\n  UseSingleBrickConf,\n} from \"@next-core/types\";\nimport {\n  RuntimeContext,\n  RuntimeUseBrickConfWithRootSymbols,\n  symbolForRootRuntimeContext,\n} from \"./secret_internals.js\";\nimport { childrenToSlots } from \"./Renderer.js\";\n\nexport function setupRootRuntimeContext(\n  bricks: BrickConf[],\n  runtimeContext: RuntimeContext,\n  shallow?: boolean\n) {\n  function walk(props: unknown) {\n    if (!isObject(props) || typeof props === \"function\") {\n      return;\n    }\n\n    if (Array.isArray(props)) {\n      props.map(walk);\n      return;\n    }\n\n    for (const [key, value] of Object.entries(props)) {\n      if (isObject(value) && key === \"useBrick\") {\n        if (Array.isArray(value)) {\n          value.forEach((v) => setupBrick(v, true));\n        } else {\n          setupBrick(\n            value as UseSingleBrickConf as RuntimeUseBrickConfWithRootSymbols,\n            true,\n            // For inside useBrick, we always need to setup recursively.\n            true\n          );\n        }\n      } else {\n        walk(value);\n      }\n    }\n  }\n\n  function setupBrick(\n    brick: BrickConf,\n    inUseBrick?: boolean,\n    forceRecursive?: boolean\n  ) {\n    if (inUseBrick) {\n      (brick as RuntimeUseBrickConfWithRootSymbols)[\n        symbolForRootRuntimeContext\n      ] = runtimeContext;\n    }\n\n    walk(brick.properties);\n\n    if (shallow && !forceRecursive) {\n      return;\n    }\n\n    const transpiledSlots = childrenToSlots(brick.children, brick.slots) as\n      | UseBrickSlotsConf\n      | undefined;\n\n    for (const slotConf of Object.values(transpiledSlots ?? {})) {\n      for (const brick of slotConf.bricks ?? []) {\n        setupBrick(brick, inUseBrick);\n      }\n    }\n  }\n\n  for (const brick of bricks) {\n    setupBrick(brick);\n  }\n}\n","import { getBasePath } from \"./getBasePath.js\";\n\nlet misc: PageInfo;\n\n/** 运行时页面信息。*/\nexport interface PageInfo {\n  /** 当前是否处于 iframe 模式。 */\n  isInIframe: boolean;\n\n  /** 当前是否处于同域的 iframe 模式。 */\n  isInIframeOfSameSite: boolean;\n\n  /** 当前是否处于新框架下的 iframe 模式。 */\n  isInIframeOfNext: boolean;\n\n  /** 当前是否处于 Visual Builder 预览的 iframe 模式。 */\n  isInIframeOfVisualBuilder: boolean;\n\n  /** 当前是否处于老 console 下的 iframe 模式。 */\n  isInIframeOfLegacyConsole: boolean;\n}\n\nexport function getPageInfo(): PageInfo {\n  if (!misc) {\n    misc = {\n      isInIframe: false,\n      isInIframeOfSameSite: false,\n      isInIframeOfNext: false,\n      isInIframeOfVisualBuilder: false,\n      isInIframeOfLegacyConsole: false,\n    };\n\n    if (window !== window.parent) {\n      misc.isInIframe = true;\n      try {\n        // Handle:\n        // - Previewing in visual builder by iframe.\n        // - Nesting next in next.\n        // - Nesting console in next.\n        if (window.origin === window.parent.origin) {\n          misc.isInIframeOfSameSite = true;\n          const selfIsNext = getBasePath() === \"/next/\";\n          const parentPathname = window.parent.location.pathname;\n          const parentIsNext = parentPathname.startsWith(\"/next/\");\n          misc.isInIframeOfNext =\n            (Number(selfIsNext) ^ Number(parentIsNext)) === 0;\n          const prefix = parentIsNext ? \"/next\" : \"\";\n          // Allow visual-builder-* extension apps.\n          misc.isInIframeOfVisualBuilder =\n            parentPathname.startsWith(`${prefix}/visual-builder/`) ||\n            parentPathname.startsWith(`${prefix}/visual-builder-`);\n          misc.isInIframeOfLegacyConsole = selfIsNext && !parentIsNext;\n        }\n      } catch {\n        // do nothing\n      }\n    }\n\n    Object.freeze(misc);\n  }\n\n  return misc;\n}\n","import { http } from \"@next-core/http\";\n\nlet nativeController: AbortController;\n\nexport function initAbortController() {\n  if (!window.AbortController) {\n    return;\n  }\n\n  nativeController = new AbortController();\n\n  http.interceptors.request.use((config) => {\n    return {\n      ...config,\n      options: {\n        ...config.options,\n        signal: config.options?.noAbortOnRouteChange\n          ? null\n          : nativeController.signal,\n      },\n    };\n  });\n}\n\nexport function abortPendingRequest() {\n  if (nativeController) {\n    nativeController.abort();\n    nativeController = new AbortController();\n  }\n}\n","import { loadBricksImperatively } from \"@next-core/loader\";\nimport { getBrickPackages, getRuntime, hooks } from \"./internal/Runtime.js\";\nimport { omit } from \"lodash\";\n\ninterface WaterMarkProps {\n  container?: HTMLElement;\n  content?: string | string[];\n  zIndex?: number;\n  rotate?: number;\n  width?: number;\n  height?: number;\n  image?: string;\n  font?: {\n    color?: CanvasFillStrokeStyles[\"fillStyle\"];\n    fontSize?: number | string;\n    fontWeight?: \"normal\" | \"light\" | \"weight\" | number;\n    fontStyle?: \"none\" | \"normal\" | \"italic\" | \"oblique\";\n    fontFamily?: string;\n    textAlign?: CanvasTextAlign;\n  };\n  style?: React.CSSProperties;\n  gap?: [number, number];\n  offset?: [number, number];\n}\n\nlet brick: {\n  resolve(options: WaterMarkProps): void;\n};\n\nexport const WATEMARK_BRICKNAME = \"basic.show-watermark\";\n\nexport function setWatermark() {\n  const flags = getRuntime().getFeatureFlags();\n  const settings = getRuntime().getMiscSettings();\n  if (!flags[\"show-watermark\"]) {\n    return;\n  }\n  const isDeveloper =\n    window.APP_ROOT?.match(/versions\\/([^/]+)\\//)?.[1] === \"0.0.0\" ||\n    window.APP_ROOT?.match(/micro-apps\\/(?:v2|v3)\\/[^/]+\\/([^/]+)/)?.[1] ===\n      \"0.0.0\";\n  const username =\n    (hooks?.auth?.getAuth() as Record<string, any>)?.username ?? \"\";\n  const watermarkConfig = (settings.watermarkConfig ?? {\n    flags: {},\n  }) as WaterMarkProps & {\n    flags: {\n      \"show-development\"?: boolean;\n      \"show-user\"?: boolean;\n    };\n  };\n\n  const content = [\n    ...(typeof watermarkConfig.content === \"string\"\n      ? [watermarkConfig.content]\n      : watermarkConfig.content ?? []),\n    watermarkConfig.flags?.[\"show-development\"] && isDeveloper\n      ? \"Development\"\n      : \"\",\n    watermarkConfig.flags?.[\"show-user\"] ? username : \"\",\n  ].filter(Boolean);\n\n  // Do not call showWatermark if there is no content\n  if (content.length === 0) {\n    return;\n  }\n\n  const defaultProps: WaterMarkProps = {\n    content,\n    zIndex: 1001,\n    width: 200,\n    font: {\n      fontSize: 28,\n    },\n    gap: [190, 190],\n    ...omit(watermarkConfig, [\"content\", \"flags\"]),\n  };\n  if (brick) {\n    brick.resolve(defaultProps);\n  } else {\n    loadBricksImperatively([WATEMARK_BRICKNAME], getBrickPackages()).then(\n      () => {\n        brick = document.createElement(WATEMARK_BRICKNAME) as any;\n\n        brick.resolve(defaultProps);\n      },\n      // istanbul ignore next\n      (error: unknown) => {\n        // eslint-disable-next-line no-console\n        console.error(\"Load watermark service failed:\", error);\n      }\n    );\n  }\n}\n","import { RuntimeStoryboard } from \"@next-core/types\";\nimport { customTemplates } from \"../CustomTemplates.js\";\n\nexport function registerCustomTemplates(storyboard: RuntimeStoryboard) {\n  if (storyboard.$$registerCustomTemplateProcessed) {\n    return;\n  }\n  storyboard.$$registerCustomTemplateProcessed = true;\n  const templates = storyboard.meta?.customTemplates;\n  if (Array.isArray(templates)) {\n    for (const tpl of templates) {\n      const tagName = tpl.name.includes(\".\")\n        ? tpl.name\n        : `${storyboard.app.id}.${tpl.name}`;\n      customTemplates.define(tagName, tpl);\n    }\n  }\n}\n","export function setUIVersion(version: string | undefined | null) {\n  // 仅允许特定的 UI 版本\n  let ui: string;\n  switch (version) {\n    case \"8.2\":\n      ui = \"v8-2\";\n      break;\n    default:\n      ui = \"v8\";\n  }\n  document.documentElement.dataset.ui = ui;\n}\n","import { Action, locationsAreEqual } from \"history\";\nimport type {\n  BreadcrumbItemConf,\n  MicroApp,\n  StaticMenuConf,\n  Storyboard,\n} from \"@next-core/types\";\nimport { HttpAbortError } from \"@next-core/http\";\nimport {\n  clearExpressionASTCache,\n  clearFunctionASTCache,\n} from \"@next-core/cook\";\nimport { uniqueId } from \"lodash\";\nimport { NextHistoryState, NextLocation, getHistory } from \"../history.js\";\nimport {\n  RenderOutput,\n  getDataStores,\n  postAsyncRender,\n  renderRoutes,\n} from \"./Renderer.js\";\nimport { DataStore } from \"./data/DataStore.js\";\nimport { clearResolveCache } from \"./data/resolveData.js\";\nimport { mountTree, unmountTree } from \"./mount.js\";\nimport { isOutsideApp, matchStoryboard } from \"./matchStoryboard.js\";\nimport { registerStoryboardFunctions } from \"./compute/StoryboardFunctions.js\";\nimport { RendererContext, RouteHelper } from \"./RendererContext.js\";\nimport {\n  applyMode,\n  applyTheme,\n  getLocalAppsTheme,\n  setMode,\n  setTheme,\n} from \"../themeAndMode.js\";\nimport {\n  _internalApiGetAppInBootstrapData,\n  getRuntime,\n  hooks,\n} from \"./Runtime.js\";\nimport { getPageInfo } from \"../getPageInfo.js\";\nimport type {\n  MenuRequestNode,\n  RenderRoot,\n  RuntimeContext,\n} from \"./interfaces.js\";\nimport { resetAllComputedMarks } from \"./compute/markAsComputed.js\";\nimport { handleHttpError, isUnauthenticatedError } from \"../handleHttpError.js\";\nimport { abortPendingRequest, initAbortController } from \"./abortController.js\";\nimport { setLoginStateCookie } from \"../setLoginStateCookie.js\";\nimport { registerCustomTemplates } from \"./registerCustomTemplates.js\";\nimport { fulfilStoryboard } from \"./fulfilStoryboard.js\";\nimport { RenderTag } from \"./enums.js\";\nimport { insertPreviewRoutes } from \"./insertPreviewRoutes.js\";\nimport { devtoolsHookEmit } from \"./devtools.js\";\nimport { setUIVersion } from \"../setUIVersion.js\";\nimport { setAppVariable } from \"../setAppVariable.js\";\nimport { setWatermark } from \"../setWatermark.js\";\nimport { clearMatchedRoutes } from \"./routeMatchedMap.js\";\nimport { ErrorNode, PageNotFoundError } from \"./ErrorNode.js\";\n\ntype RenderTask = InitialRenderTask | SubsequentRenderTask;\n\ninterface InitialRenderTask {\n  location: NextLocation;\n  prevLocation?: undefined;\n  action?: undefined;\n}\n\ninterface SubsequentRenderTask {\n  location: NextLocation;\n  prevLocation: NextLocation;\n  action: Action;\n}\n\nexport class Router {\n  readonly #storyboards: Storyboard[];\n  #rendering = false;\n  #nextRender?: RenderTask;\n  #runtimeContext?: RuntimeContext;\n  #rendererContext?: RendererContext;\n  #rendererContextTrashCan = new Set<RendererContext | undefined>();\n  #redirectCount = 0;\n  #renderId?: string;\n  #currentApp?: MicroApp;\n  #previousApp?: MicroApp;\n  #navConfig?: {\n    breadcrumb?: BreadcrumbItemConf[];\n  };\n\n  constructor(storyboards: Storyboard[]) {\n    this.#storyboards = storyboards;\n\n    const history = getHistory();\n    window.addEventListener(\"beforeunload\", (event) => {\n      const message = this.#getBlockMessageBeforePageLave({});\n      // See examples in https://developer.mozilla.org/en-US/docs/Web/API/WindowEventHandlers/onbeforeunload\n      if (message) {\n        // Cancel the event\n        // If you prevent default behavior in Mozilla Firefox prompt will always be shown\n        event.preventDefault();\n        // Chrome requires returnValue to be set\n        event.returnValue = \"\";\n      } else {\n        // the absence of a returnValue property on the event will guarantee the browser unload happens\n        delete event.returnValue;\n      }\n    });\n\n    history.block((location, action) =>\n      this.#getBlockMessageBeforePageLave({ location, action })\n    );\n  }\n\n  getRenderId() {\n    return this.#renderId;\n  }\n\n  // istanbul ignore next\n  getRuntimeContext() {\n    return this.#runtimeContext;\n  }\n\n  getRecentApps() {\n    return {\n      currentApp: this.#currentApp,\n      previousApp: this.#previousApp,\n    };\n  }\n\n  getNavConfig() {\n    return this.#navConfig;\n  }\n\n  #getBlockMessageBeforePageLave(detail: {\n    location?: NextLocation;\n    action?: Action;\n  }): string | undefined {\n    const history = getHistory();\n    const previousMessage = history.getBlockMessage();\n    this.#rendererContext?.dispatchBeforePageLeave(detail);\n    const message = history.getBlockMessage();\n    if (!previousMessage && message) {\n      // Auto unblock only if new block was introduced by `onBeforePageLeave`.\n      history.unblock();\n    }\n    return message;\n  }\n\n  #safeRedirect(\n    to: string,\n    state: NextHistoryState | undefined,\n    from: NextLocation\n  ): void {\n    if (this.#redirectCount++ > 10) {\n      const message = `Infinite redirect detected: from \"${from.pathname}${from.search}${from.hash}\" to \"${to}\"`;\n      // istanbul ignore else: error cannot be caught in test\n      if (process.env.NODE_ENV === \"test\") {\n        // eslint-disable-next-line no-console\n        console.error(message);\n        return;\n      } else {\n        throw new Error(message);\n      }\n    }\n    getHistory().replace(to, state);\n  }\n\n  bootstrap() {\n    initAbortController();\n    const history = getHistory();\n    let nextPrevLocation = history.location;\n    history.listen((location, action) => {\n      const prevLocation = nextPrevLocation;\n      nextPrevLocation = location;\n      if (this.#rendering) {\n        this.#nextRender = { location, prevLocation, action };\n      } else {\n        this.#queuedRender({\n          location,\n          prevLocation,\n          action,\n        }).catch(handleHttpError);\n      }\n    });\n    return this.#queuedRender({ location: history.location });\n  }\n\n  async #queuedRender(next: RenderTask) {\n    this.#rendering = true;\n    try {\n      await this.#preRender(next);\n    } finally {\n      this.#rendering = false;\n      if (this.#nextRender) {\n        const nextRender = this.#nextRender;\n        this.#nextRender = undefined;\n        await this.#queuedRender(nextRender);\n      }\n    }\n  }\n\n  async #preRender({ location, prevLocation, action }: RenderTask) {\n    if (prevLocation) {\n      let ignoreRendering: boolean | undefined;\n      const omittedLocationProps: Partial<NextLocation> = {\n        hash: undefined,\n        state: undefined,\n      };\n      // Omit the \"key\" when checking whether locations are equal in certain situations.\n      if (\n        // When current location is triggered by browser action of hash link.\n        location.key === undefined ||\n        // When current location is triggered by browser action of non-push-or-replace,\n        // such as goBack or goForward,\n        (action === \"POP\" &&\n          // and the previous location was triggered by hash link,\n          (prevLocation.key === undefined ||\n            // or the previous location specified notify false.\n            prevLocation.state?.notify === false))\n      ) {\n        omittedLocationProps.key = undefined;\n      }\n      if (\n        locationsAreEqual(\n          { ...prevLocation, ...omittedLocationProps },\n          { ...location, ...omittedLocationProps }\n        ) ||\n        (action !== \"POP\" && location.state?.notify === false)\n      ) {\n        // Ignore rendering if location not changed except hash, state and optional key.\n        // Ignore rendering if notify is `false`.\n        ignoreRendering = true;\n      }\n\n      if (!ignoreRendering && !location.state?.noIncremental) {\n        ignoreRendering =\n          await this.#rendererContext?.didPerformIncrementalRender(\n            location,\n            prevLocation\n          );\n      }\n\n      if (ignoreRendering) {\n        return;\n      }\n\n      abortPendingRequest();\n      this.#rendererContext?.dispatchPageLeave();\n\n      if (action === \"POP\") {\n        const storyboard = matchStoryboard(\n          this.#storyboards,\n          location.pathname\n        );\n        // When a browser action of goBack or goForward is performing,\n        // force reload when the target page is a page of an outside app.\n        if (isOutsideApp(storyboard)) {\n          window.location.reload();\n          return;\n        }\n      }\n\n      devtoolsHookEmit(\"locationChange\");\n    }\n\n    return this.#render(location, !prevLocation);\n  }\n\n  async #render(location: NextLocation, isBootstrap: boolean): Promise<void> {\n    const renderId = (this.#renderId = uniqueId(\"render-id-\"));\n\n    resetAllComputedMarks();\n    clearResolveCache();\n    hooks?.flowApi?.clearCollectWidgetContract();\n\n    const history = getHistory();\n    history.unblock();\n\n    // const renderStartTime = performance.now();\n    const finishPageView = hooks?.pageView?.create();\n\n    const storyboard = matchStoryboard(this.#storyboards, location.pathname);\n\n    const previousApp = this.#runtimeContext?.app;\n    const currentAppId = storyboard?.app?.id;\n    //  dynamically change the value of the APP variable, if it's union app\n    if (\n      window.BOOTSTRAP_UNION_FILE &&\n      currentAppId &&\n      currentAppId !== previousApp?.id\n    ) {\n      setAppVariable({\n        appId: currentAppId,\n        version: storyboard.app.currentVersion!,\n      });\n    }\n\n    if (storyboard?.app) {\n      await fulfilStoryboard(storyboard);\n    }\n\n    const currentApp = (this.#currentApp = storyboard?.app);\n\n    setWatermark();\n\n    // Storyboard maybe re-assigned, e.g. when open launchpad.\n    const appChanged =\n      previousApp && currentApp\n        ? previousApp.id !== currentApp.id\n        : previousApp !== currentApp;\n\n    clearExpressionASTCache();\n    if (appChanged) {\n      clearFunctionASTCache();\n    }\n\n    // TODO: handle favicon\n\n    // Set `Router::#currentApp` before calling `getFeatureFlags()`\n    const flags = getRuntime().getFeatureFlags();\n    const prevRendererContext = this.#rendererContext;\n\n    const redirectTo = (to: string, state?: NextHistoryState): void => {\n      finishPageView?.({\n        status: \"redirected\",\n      });\n      this.#rendererContextTrashCan.add(prevRendererContext);\n      this.#safeRedirect(to, state, location);\n    };\n\n    const redirectToLogin = (): void => {\n      const to = flags[\"sso-enabled\"] ? \"/sso-auth/login\" : \"/auth/login\";\n      setLoginStateCookie(location);\n      redirectTo(to, { from: location });\n    };\n\n    const main = document.querySelector(\"#main-mount-point\") as HTMLElement;\n    const portal = document.querySelector(\"#portal-mount-point\") as HTMLElement;\n\n    const renderRoot: RenderRoot = {\n      tag: RenderTag.ROOT,\n      container: main,\n      createPortal: portal,\n    };\n\n    const cleanUpPreviousRender = (): void => {\n      unmountTree(main);\n      unmountTree(portal);\n\n      // Note: redirects can lead to multiple trash renderer contexts.\n      this.#rendererContextTrashCan.add(prevRendererContext);\n      for (const item of this.#rendererContextTrashCan) {\n        if (item) {\n          item.dispatchOnUnmount();\n          item.dispose();\n        }\n      }\n      this.#rendererContextTrashCan.clear();\n      hooks?.messageDispatcher?.reset();\n\n      if (appChanged) {\n        this.#previousApp = previousApp;\n        window.dispatchEvent(\n          new CustomEvent(\"app.change\", {\n            detail: {\n              previousApp,\n              currentApp,\n            },\n          })\n        );\n      }\n    };\n\n    setTheme(\n      (currentApp &&\n        (getLocalAppsTheme()[currentApp.id] || currentApp.theme)) ||\n        \"light\"\n    );\n    setMode(\"default\");\n\n    if (currentApp) {\n      hooks?.checkInstalledApps?.preCheckInstalledApps(\n        storyboard,\n        (appId) => !!_internalApiGetAppInBootstrapData(appId)\n      );\n\n      const routeHelper: RouteHelper = {\n        bailout: (output) => {\n          if (output.unauthenticated) {\n            redirectToLogin();\n            return true;\n          }\n          if (output.redirect) {\n            redirectTo(output.redirect.path, output.redirect.state);\n            return true;\n          }\n          // Reset redirect count if no redirect is set.\n          this.#redirectCount = 0;\n        },\n        mergeMenus: async (menuRequests) => {\n          const menuConfs = await Promise.all(menuRequests);\n          this.#navConfig = mergeMenuConfs(menuConfs);\n          window.dispatchEvent(\n            new CustomEvent(\"navConfig.change\", { detail: this.#navConfig })\n          );\n        },\n        catch: async (error, returnNode, isCurrentBootstrap, isReCatch) => {\n          if (isUnauthenticatedError(error) && !window.NO_AUTH_GUARD) {\n            redirectToLogin();\n            return;\n          } else if (error instanceof HttpAbortError) {\n            this.#rendererContextTrashCan.add(prevRendererContext);\n            return;\n          } else {\n            const noAuthGuardLoginPath =\n              getRuntime().getMiscSettings().noAuthGuardLoginPath;\n            if (isUnauthenticatedError(error) && noAuthGuardLoginPath) {\n              redirectTo(noAuthGuardLoginPath as string, { from: location });\n              return;\n            }\n            if (isCurrentBootstrap) {\n              throw error;\n            }\n            return {\n              failed: true,\n              output: {\n                node: await ErrorNode(error, returnNode, !isReCatch),\n                blockingList: [],\n              },\n            };\n          }\n        },\n      };\n\n      const rendererContext = (this.#rendererContext = new RendererContext(\n        \"page\",\n        { routeHelper, renderId }\n      ));\n\n      const runtimeContext: RuntimeContext = (this.#runtimeContext = {\n        app: currentApp,\n        location,\n        query: new URLSearchParams(location.search),\n        flags,\n        sys: {\n          ...hooks?.auth?.getAuth(),\n          ...getPageInfo(),\n          settings: {\n            brand: getRuntime().getBrandSettings(),\n          },\n        },\n        ctxStore: new DataStore(\"CTX\", undefined, rendererContext),\n        pendingPermissionsPreCheck: [\n          hooks?.checkPermissions?.preCheckPermissions(storyboard),\n        ],\n        tplStateStoreMap: new Map<string, DataStore<\"STATE\">>(),\n        formStateStoreMap: new Map<string, DataStore<\"FORM_STATE\">>(),\n      });\n\n      this.#navConfig = undefined;\n\n      registerCustomTemplates(storyboard);\n      registerStoryboardFunctions(storyboard.meta?.functions, currentApp);\n      hooks?.flowApi?.collectContract(storyboard.meta?.contracts);\n\n      let failed = false;\n      let output: RenderOutput;\n      let stores: DataStore<\"CTX\" | \"STATE\" | \"FORM_STATE\">[] = [];\n\n      try {\n        clearMatchedRoutes();\n        const rootMenuRequestNode: MenuRequestNode = {};\n        output = await renderRoutes(\n          renderRoot,\n          insertPreviewRoutes(storyboard.routes),\n          runtimeContext,\n          rendererContext,\n          [],\n          rootMenuRequestNode\n        );\n        if (routeHelper.bailout(output)) {\n          return;\n        }\n\n        stores = getDataStores(runtimeContext);\n\n        await postAsyncRender(output, runtimeContext, stores);\n\n        rootMenuRequestNode.child = output.menuRequestNode;\n        rendererContext.setInitialMenuRequestNode(rootMenuRequestNode);\n        await routeHelper.mergeMenus(rendererContext.getMenuRequests());\n      } catch (error) {\n        // eslint-disable-next-line no-console\n        console.error(\"Router failed:\", error);\n        const result = await routeHelper.catch(error, renderRoot, isBootstrap);\n        if (!result) {\n          return;\n        }\n        ({ failed, output } = result);\n      }\n      renderRoot.child = output.node;\n\n      cleanUpPreviousRender();\n\n      if ((output.route && output.route.type !== \"routes\") || failed) {\n        if (!failed) {\n          // There is a window to set theme and mode by `lifeCycle.onBeforePageLoad`.\n          rendererContext.dispatchBeforePageLoad();\n        }\n        applyTheme();\n        applyMode();\n\n        setUIVersion(currentApp?.uiVersion);\n        mountTree(renderRoot);\n\n        // Scroll to top after each rendering.\n        // See https://github.com/ReactTraining/react-router/blob/master/packages/react-router-dom/docs/guides/scroll-restoration.md\n        window.scrollTo(0, 0);\n\n        if (!failed) {\n          rendererContext.dispatchPageLoad();\n          rendererContext.dispatchAnchorLoad();\n          rendererContext.dispatchOnMount();\n          rendererContext.initializeScrollIntoView();\n          rendererContext.initializeMediaChange();\n          rendererContext.initializeMessageDispatcher();\n\n          for (const store of stores) {\n            store.mountAsyncData();\n          }\n\n          finishPageView?.({\n            status: \"ok\",\n            path: output.path,\n            pageTitle: document.title,\n          });\n        } else {\n          finishPageView?.({ status: \"failed\" });\n        }\n        devtoolsHookEmit(\"rendered\");\n\n        return;\n      }\n    } else if (\n      !window.NO_AUTH_GUARD &&\n      hooks?.auth &&\n      !hooks.auth.isLoggedIn()\n    ) {\n      // Todo(steve): refine after api-gateway supports fetching storyboards before logged in.\n      // Redirect to login if no storyboard is matched.\n      redirectToLogin();\n      return;\n    } else {\n      cleanUpPreviousRender();\n    }\n\n    applyTheme();\n    applyMode();\n\n    const node = await ErrorNode(\n      new PageNotFoundError(currentApp ? \"page not found\" : \"app not found\"),\n      renderRoot,\n      true\n    );\n    renderRoot.child = node;\n\n    mountTree(renderRoot);\n\n    // Scroll to top after each rendering.\n    window.scrollTo(0, 0);\n    finishPageView?.({ status: \"not-found\" });\n    devtoolsHookEmit(\"rendered\");\n  }\n}\n\nfunction mergeMenuConfs(menuConfs: StaticMenuConf[]) {\n  const navConfig = {\n    breadcrumb: [] as BreadcrumbItemConf[],\n  };\n  for (const menuConf of menuConfs) {\n    const { breadcrumb } = menuConf;\n    if (breadcrumb) {\n      if (breadcrumb.overwrite) {\n        navConfig.breadcrumb = breadcrumb.items;\n      } else {\n        navConfig.breadcrumb.push(...breadcrumb.items);\n      }\n    }\n  }\n  return navConfig;\n}\n","interface VariableParams {\n  appId: string;\n  version: string;\n}\n\nexport function setAppVariable(params: VariableParams) {\n  const { appId, version } = params;\n  if (window.APP_ROOT_TPL) {\n    window.APP_ID = appId;\n    window.APP_ROOT = window.APP_ROOT_TPL.replace(\"{id}\", appId).replace(\n      \"{version}\",\n      version\n    );\n  }\n}\n","import type { RuntimeStoryboard } from \"@next-core/types\";\nimport { hooks } from \"./Runtime.js\";\nimport { registerAppI18n } from \"./registerAppI18n.js\";\n\nexport async function fulfilStoryboard(storyboard: RuntimeStoryboard) {\n  if (storyboard.$$fulfilled) {\n    return;\n  }\n  if (!storyboard.$$fulfilling) {\n    storyboard.$$fulfilling = doFulfilStoryboard(storyboard);\n  }\n  return storyboard.$$fulfilling;\n}\n\nasync function doFulfilStoryboard(storyboard: RuntimeStoryboard) {\n  await hooks?.fulfilStoryboard?.(storyboard);\n  registerAppI18n(storyboard);\n  Object.assign(storyboard, {\n    $$fulfilled: true,\n    $$fulfilling: null,\n  });\n}\n","import { findLastIndex } from \"lodash\";\nimport type { RouteConf } from \"@next-core/types\";\n\nexport function insertPreviewRoutes(routes: RouteConf[]): RouteConf[] {\n  // Insert preview routes for iframe only.\n  if (window.parent === window) {\n    return routes;\n  }\n\n  let mergedRoutes = routes;\n\n  const specificTemplatePreviewIndex = findLastIndex(mergedRoutes, (route) =>\n    route.path.startsWith(\"${APP.homepage}/_dev_only_/template-preview/\")\n  );\n  mergedRoutes = [\n    ...mergedRoutes.slice(0, specificTemplatePreviewIndex + 1),\n    {\n      path: \"${APP.homepage}/_dev_only_/template-preview/:templateId\",\n      bricks: [{ brick: \"span\" }],\n      menu: false,\n      exact: true,\n    } as RouteConf,\n    ...mergedRoutes.slice(specificTemplatePreviewIndex + 1),\n  ];\n\n  const specificSnippetPreviewIndex = findLastIndex(mergedRoutes, (route) =>\n    route.path.startsWith(\"${APP.homepage}/_dev_only_/snippet-preview/\")\n  );\n  mergedRoutes = [\n    ...mergedRoutes.slice(0, specificSnippetPreviewIndex + 1),\n    {\n      path: \"${APP.homepage}/_dev_only_/snippet-preview/:snippetId\",\n      bricks: [{ brick: \"span\" }],\n      menu: false,\n      exact: true,\n    } as RouteConf,\n    ...mergedRoutes.slice(specificSnippetPreviewIndex + 1),\n  ];\n\n  return mergedRoutes;\n}\n","import type { BrickPackage } from \"@next-core/types\";\n\n// Allow inject brick packages in a runtime other than Brick Next.\nexport const injectedBrickPackages: BrickPackage[] | null =\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore\n  typeof BRICK_PACKAGES !== \"undefined\" ? BRICK_PACKAGES : null;\n","import {\n  BaseColors,\n  BrandColor,\n  getStyleByBaseColors,\n  getStyleByBrandColor,\n  getStyleByVariables,\n} from \"@next-core/color-theme\";\n\nexport type ColorThemeOptions =\n  | ColorThemeOptionsByBrand\n  | ColorThemeOptionsByBaseColors\n  | ColorThemeOptionsByVariables;\n\nexport interface ColorThemeOptionsByBrand {\n  type: \"brandColor\";\n  light?: BrandColor;\n  dark?: BrandColor;\n}\n\nexport interface ColorThemeOptionsByBaseColors {\n  type: \"baseColors\";\n  light?: BaseColors;\n  dark?: BaseColors;\n  backgroundColor?: string;\n}\n\nexport interface ColorThemeOptionsByVariables {\n  type: \"variables\";\n  light?: Record<string, string>;\n  dark?: Record<string, string>;\n}\n\nexport interface ThemeSettings {\n  brandColor?: Omit<ColorThemeOptionsByBrand, \"type\">;\n  baseColors?: Omit<ColorThemeOptionsByBaseColors, \"type\">;\n  variables?: Omit<ColorThemeOptionsByVariables, \"type\">;\n}\n\nexport function customizeColorTheme(theme: ThemeSettings | undefined): void {\n  if (!theme) {\n    return;\n  }\n  if (theme.brandColor) {\n    applyColorTheme({\n      type: \"brandColor\",\n      ...theme.brandColor,\n    });\n  } else if (theme.baseColors) {\n    applyColorTheme({\n      type: \"baseColors\",\n      ...theme.baseColors,\n    });\n  } else if (theme.variables) {\n    applyColorTheme({\n      type: \"variables\",\n      ...theme.variables,\n    });\n  }\n}\n\nexport function applyColorTheme(\n  options: ColorThemeOptions\n): (() => void) | undefined {\n  const style: string[] = [];\n  const themes = [\"light\", \"dark\"] as const;\n  themes.forEach((theme) => {\n    if (options[theme]) {\n      switch (options.type) {\n        case \"brandColor\":\n          style.push(getStyleByBrandColor(theme, options[theme]!));\n          break;\n        case \"baseColors\":\n          style.push(\n            getStyleByBaseColors(\n              theme,\n              options[theme]!,\n              options.backgroundColor\n            )\n          );\n          break;\n        case \"variables\":\n          style.push(getStyleByVariables(theme, options[theme]!));\n          break;\n      }\n    }\n  });\n\n  if (style.length > 0) {\n    const element = document.createElement(\"style\");\n    element.textContent = style.join(\"\\n\\n\");\n    document.head.appendChild(element);\n    return () => {\n      element.remove();\n    };\n  }\n}\n","// istanbul ignore file\n// Todo(steve): This file will be removed in the future.\nimport { hooks } from \"./internal/Runtime.js\";\n\n/** @deprecated import it from \"@next-core/easyops-runtime\" instead */\nexport function authenticate(...args: unknown[]): void {\n  hooks?.auth?.authenticate?.(...args);\n}\n\n/** @deprecated import it from \"@next-core/easyops-runtime\" instead */\nexport function getAuth() {\n  return hooks?.auth?.getAuth();\n}\n\n/** @deprecated import it from \"@next-core/easyops-runtime\" instead */\nexport function logout() {\n  return hooks?.auth?.logout?.();\n}\n\n/** @deprecated import it from \"@next-core/easyops-runtime\" instead */\nexport function isLoggedIn() {\n  return hooks?.auth?.isLoggedIn();\n}\n","class CustomEditorRegistry {\n  readonly #registry = new Map<string, Function>();\n\n  define(editorName: string, editorFunc: Function) {\n    if (this.#registry.has(editorName)) {\n      // eslint-disable-next-line no-console\n      console.error(`Custom editor of \"${editorName}\" already registered`);\n      return;\n    }\n\n    this.#registry.set(editorName, editorFunc);\n  }\n\n  get(editorName: string) {\n    return this.#registry.get(editorName);\n  }\n}\n\nexport const customEditors = new CustomEditorRegistry();\n","import { getProviderBrick } from \"./internal/data/getProviderBrick.js\";\nimport {\n  ResolveOptions,\n  resolveByProvider,\n} from \"./internal/data/resolveData.js\";\n\nexport async function fetchByProvider(\n  provider: string,\n  args: unknown[],\n  options?: ResolveOptions\n) {\n  const providerBrick = (await getProviderBrick(provider)) as unknown as Record<\n    string,\n    Function\n  >;\n  return resolveByProvider(providerBrick, provider, \"resolve\", args, options);\n}\n","import type {\n  BrickConf,\n  ContextConf,\n  CustomTemplate,\n  MetaI18n,\n  MicroApp,\n  SiteTheme,\n  Storyboard,\n  StoryboardFunction,\n} from \"@next-core/types\";\nimport { i18n } from \"@next-core/i18n\";\nimport { uniqueId } from \"lodash\";\nimport {\n  RenderOutput,\n  getDataStores,\n  postAsyncRender,\n  renderBricks,\n} from \"./internal/Renderer.js\";\nimport { RendererContext } from \"./internal/RendererContext.js\";\nimport { DataStore } from \"./internal/data/DataStore.js\";\nimport type { RenderRoot, RuntimeContext } from \"./internal/interfaces.js\";\nimport { mountTree, unmountTree } from \"./internal/mount.js\";\nimport { applyMode, applyTheme, setMode, setTheme } from \"./themeAndMode.js\";\nimport { RenderTag } from \"./internal/enums.js\";\nimport { registerStoryboardFunctions } from \"./internal/compute/StoryboardFunctions.js\";\nimport { registerAppI18n } from \"./internal/registerAppI18n.js\";\nimport { registerCustomTemplates } from \"./internal/registerCustomTemplates.js\";\nimport { setUIVersion } from \"./setUIVersion.js\";\nimport { ErrorNode } from \"./internal/ErrorNode.js\";\n\nexport interface CreateRootOptions {\n  portal?: HTMLElement;\n  /**\n   * Defaults to \"fragment\", only set it to \"page\" when the root is in a standalone iframe.\n   * - page: render as whole page, triggering page life cycles, and enable register of functions/templates/i18n.\n   * - fragment: render as fragment, not triggering page life cycles, and disable register of functions/templates/i18n.\n   */\n  scope?: \"page\" | \"fragment\";\n\n  /**\n   * Whether to throw error when encountering unknown bricks.\n   *\n   * Defaults to \"throw\".\n   */\n  unknownBricks?: \"silent\" | \"throw\";\n}\n\nexport interface RenderOptions {\n  theme?: SiteTheme;\n  uiVersion?: string;\n  language?: string;\n  context?: ContextConf[];\n  functions?: StoryboardFunction[];\n  templates?: CustomTemplate[];\n  i18n?: MetaI18n;\n  url?: string;\n  app?: MicroApp;\n}\n\nexport function unstable_createRoot(\n  container: HTMLElement | DocumentFragment,\n  { portal: _portal, scope = \"fragment\", unknownBricks }: CreateRootOptions = {}\n) {\n  let portal = _portal;\n  let createPortal: RenderRoot[\"createPortal\"];\n  if (_portal) {\n    createPortal = _portal;\n  } else {\n    // Create portal container when necessary.\n    createPortal = () => {\n      portal = document.createElement(\"div\");\n      portal.style.position = \"absolute\";\n      portal.style.width = portal.style.height = \"0\";\n      document.body.append(portal);\n      return portal;\n    };\n  }\n  let unmounted = false;\n  let rendererContext: RendererContext | undefined;\n  let clearI18nBundles: Function | undefined;\n\n  return {\n    async render(\n      brick: BrickConf | BrickConf[],\n      {\n        theme,\n        uiVersion,\n        language,\n        context,\n        functions,\n        templates,\n        i18n: i18nData,\n        url,\n        app,\n      }: RenderOptions = {}\n    ) {\n      if (unmounted) {\n        throw new Error(\n          \"The root is unmounted and cannot be rendered any more\"\n        );\n      }\n      const bricks = ([] as BrickConf[]).concat(brick);\n\n      const previousRendererContext = rendererContext;\n      const renderId = uniqueId(\"render-id-\");\n      rendererContext = new RendererContext(scope, { unknownBricks, renderId });\n\n      const runtimeContext = {\n        ctxStore: new DataStore(\"CTX\", undefined, rendererContext),\n        pendingPermissionsPreCheck: [],\n        tplStateStoreMap: new Map<string, DataStore<\"STATE\">>(),\n        formStateStoreMap: new Map<string, DataStore<\"FORM_STATE\">>(),\n      } as Partial<RuntimeContext> as RuntimeContext;\n\n      if (url) {\n        const urlObj = new URL(url);\n        runtimeContext.query = urlObj.searchParams;\n        runtimeContext.location = {\n          pathname: urlObj.pathname,\n          search: urlObj.search,\n          hash: urlObj.hash,\n          state: undefined,\n        };\n      }\n\n      const renderRoot: RenderRoot = {\n        tag: RenderTag.ROOT,\n        container,\n        createPortal,\n      };\n\n      if (scope === \"page\") {\n        setTheme(theme ?? \"light\");\n        setMode(\"default\");\n        setUIVersion(uiVersion);\n        if (language) {\n          await i18n.changeLanguage(language);\n        }\n\n        app ??= {\n          id: \"demo\",\n          homepage: \"/demo\",\n        } as MicroApp;\n        runtimeContext.app = app;\n        const demoStoryboard = {\n          app,\n          meta: {\n            i18n: i18nData,\n            customTemplates: templates,\n          },\n        } as Storyboard;\n\n        // Register i18n.\n        clearI18nBundles?.();\n        clearI18nBundles = registerAppI18n(demoStoryboard);\n\n        // Register custom templates.\n        registerCustomTemplates(demoStoryboard);\n\n        // Register functions.\n        registerStoryboardFunctions(functions, app);\n      }\n\n      runtimeContext.ctxStore.define(context, runtimeContext);\n\n      let failed = false;\n      let output: RenderOutput;\n      let stores: DataStore<\"CTX\" | \"STATE\" | \"FORM_STATE\">[] = [];\n\n      try {\n        output = await renderBricks(\n          renderRoot,\n          bricks,\n          runtimeContext,\n          rendererContext,\n          [],\n          {}\n        );\n\n        stores = getDataStores(runtimeContext);\n        await postAsyncRender(output, runtimeContext, stores);\n      } catch (error) {\n        failed = true;\n        output = {\n          node: await ErrorNode(error, renderRoot, scope === \"page\"),\n          blockingList: [],\n        };\n      }\n\n      renderRoot.child = output.node;\n\n      previousRendererContext?.dispatchOnUnmount();\n      previousRendererContext?.dispose();\n      unmountTree(container);\n      if (portal) {\n        unmountTree(portal);\n      }\n\n      if (scope === \"page\") {\n        if (!failed) {\n          rendererContext.dispatchBeforePageLoad();\n        }\n\n        applyTheme();\n        applyMode();\n      }\n\n      mountTree(renderRoot);\n\n      if (scope === \"page\") {\n        window.scrollTo(0, 0);\n      }\n\n      if (!failed) {\n        for (const store of stores) {\n          store.mountAsyncData();\n        }\n\n        if (scope === \"page\") {\n          rendererContext.dispatchPageLoad();\n          // rendererContext.dispatchAnchorLoad();\n        }\n        rendererContext.dispatchOnMount();\n        rendererContext.initializeScrollIntoView();\n        rendererContext.initializeMediaChange();\n        rendererContext.initializeMessageDispatcher();\n      }\n    },\n    unmount() {\n      if (unmounted) {\n        return;\n      }\n      unmounted = true;\n      unmountTree(container);\n      if (portal) {\n        unmountTree(portal);\n        // Only remove the portal from its parent when it's dynamic created.\n        if (!_portal) {\n          portal.remove();\n        }\n      }\n    },\n  };\n}\n","import { isEvaluable } from \"@next-core/cook\";\nimport { inject } from \"@next-core/inject\";\nimport { isObject } from \"@next-core/utils/general\";\nimport { getHistory } from \"./index.js\";\nimport { _internalApiGetRuntimeContext } from \"./internal/Runtime.js\";\nimport { evaluate } from \"./internal/compute/evaluate.js\";\nimport type { RuntimeContext } from \"./internal/interfaces.js\";\nimport {\n  hasBeenComputed,\n  markAsComputed,\n} from \"./internal/compute/markAsComputed.js\";\n\n/**\n * An equivalent of `computeRealValue` but for external usages, with no custom\n * context or options.\n *\n * @param value - Any value which may contains evaluations or placeholders.\n * @returns Computed real value.\n */\nexport function getRealValue(\n  value: unknown,\n  {\n    useRealTimeQuery,\n  }: {\n    useRealTimeQuery?: boolean;\n  } = {}\n): unknown {\n  const ctx: RuntimeContext = {\n    ..._internalApiGetRuntimeContext()!,\n  };\n  if (useRealTimeQuery) {\n    ctx.query = new URLSearchParams(getHistory().location.search);\n  }\n\n  const compute = (data: unknown): unknown => {\n    if (typeof data === \"string\") {\n      if (isEvaluable(data)) {\n        const result = evaluate(data, ctx);\n        markAsComputed(result);\n        return result;\n      }\n      return inject(data, ctx);\n    }\n\n    if (!isObject(data) || hasBeenComputed(value)) {\n      return data;\n    }\n\n    if (Array.isArray(data)) {\n      return data.map((v) => compute(v));\n    }\n\n    return Object.fromEntries(\n      Object.entries(data).map(([k, v]) => [compute(k), compute(v)])\n    );\n  };\n\n  return compute(value);\n}\n","import { saveAs } from \"file-saver\";\n\ninterface ProviderElement<T extends unknown[], U> extends HTMLElement {\n  resolve(...args: T): U;\n  saveAs(filename: string, ...args: T): Promise<void>;\n}\n\ninterface ProviderConstructor<T extends unknown[], U> {\n  new (): ProviderElement<T, U>;\n}\n\nexport function createProviderClass<T extends unknown[], U>(\n  api: (...args: T) => U\n): ProviderConstructor<T, U> {\n  return class extends HTMLElement {\n    get $$typeof(): string {\n      return \"provider\";\n    }\n\n    resolve(...args: T): U {\n      return api(...args);\n    }\n\n    async saveAs(filename: string, ...args: T): Promise<void> {\n      const blob = await api(...args);\n      saveAs(blob as unknown as Blob, filename);\n    }\n  };\n}\n","import { fetchEventSource } from \"@microsoft/fetch-event-source\";\n\ntype MessageIteratorResult<T> = IteratorResult<T, undefined>;\ntype ResolveIteratorResult<T> = (result: MessageIteratorResult<T>) => void;\ntype RejectIteratorResult = (reason: unknown) => void;\ntype PullQueueItem<T> = [\n  resolve: ResolveIteratorResult<T>,\n  reject: RejectIteratorResult,\n];\ntype PushQueueItem<T> =\n  | {\n      ok: true;\n      data: MessageIteratorResult<T>;\n    }\n  | {\n      ok: false;\n      reason: unknown;\n    };\n\nexport interface Options<T> extends RequestInit {\n  /**\n   * 请求头。\n   *\n   * 注意不同于原生 `fetch` 的 `headers` 参数，这里仅支持字符串键值对。\n   */\n  headers?: Record<string, string>;\n\n  /**\n   * 将消息数据转换为迭代器结果。\n   *\n   * 默认实现将消息数据解析为 JSON 对象，特例：消息为 \"[DONE]\" 时表示结束。\n   *\n   * @param data 消息数据\n   * @param event 事件\n   * @returns 迭代器结果\n   */\n  converter?: (data: string, event: string) => MessageIteratorResult<T>;\n}\n\n/**\n * 将 SSE 事件流转换为异步迭代器。\n */\nexport async function createSSEStream<T = unknown>(\n  url: string,\n  options?: Options<T>\n): Promise<AsyncIterableIterator<T>> {\n  // Reference https://github.com/withspectrum/callback-to-async-iterator/blob/master/src/index.js\n  const pushQueue: PushQueueItem<T>[] = [];\n  const pullQueue: PullQueueItem<T>[] = [];\n  let disposed = false;\n  let closed = false;\n\n  const { converter, ...fetchOptions } = options ?? {};\n\n  await new Promise<null>((resolve, reject) => {\n    fetchEventSource(url, {\n      ...fetchOptions,\n      openWhenHidden: true,\n      async onopen(response) {\n        if (response.ok) {\n          resolve(null);\n        } else {\n          // eslint-disable-next-line no-console\n          console.error(\"open error\", response.statusText);\n          throw new Error(response.statusText);\n        }\n      },\n      onmessage(msg) {\n        // istanbul ignore next\n        if (process.env.NODE_ENV === \"development\") {\n          // eslint-disable-next-line no-console\n          console.debug(\"[EventSource]\", msg);\n        }\n        let data: MessageIteratorResult<T> | undefined;\n        let reason: unknown;\n        let ok = true;\n        try {\n          data = (converter ?? defaultConverter<T>)(msg.data, msg.event);\n        } catch (e) {\n          ok = false;\n          reason = e;\n        }\n        if (pullQueue.length > 0) {\n          const [resolve, reject] = pullQueue.shift()!;\n          ok ? resolve(data!) : reject(reason);\n        } else {\n          pushQueue.push(\n            ok ? { ok: true, data: data! } : { ok: false, reason }\n          );\n        }\n      },\n      onclose() {\n        closed = true;\n        earlyDone();\n      },\n      onerror(err) {\n        throw err;\n      },\n    }).catch((reason) => {\n      reject(reason);\n      bailout(reason);\n    });\n  });\n\n  function bailout(reason: unknown) {\n    pullQueue.forEach(([_resolve, reject]) => reject(reason));\n    dispose();\n  }\n\n  function earlyDone() {\n    pullQueue.forEach(([resolve]) => resolve({ value: undefined, done: true }));\n  }\n\n  function dispose() {\n    disposed = true;\n    pullQueue.length = 0;\n    pushQueue.length = 0;\n  }\n\n  return {\n    next() {\n      return disposed\n        ? this.return!()\n        : new Promise<MessageIteratorResult<T>>((resolve, reject) => {\n            if (pushQueue.length > 0) {\n              const result = pushQueue.shift()!;\n              if (result.ok) {\n                resolve(result.data);\n              } else {\n                reject(result.reason);\n              }\n            } else if (closed) {\n              dispose();\n              resolve({ value: undefined, done: true });\n            } else {\n              pullQueue.push([resolve, reject]);\n            }\n          });\n    },\n    return() {\n      earlyDone();\n      dispose();\n      return Promise.resolve({ value: undefined, done: true });\n    },\n    throw(error) {\n      earlyDone();\n      dispose();\n      return Promise.reject(error);\n    },\n    [Symbol.asyncIterator]() {\n      return this;\n    },\n  } as AsyncIterableIterator<T>;\n}\n\nfunction defaultConverter<T>(\n  data: string,\n  event: string\n): MessageIteratorResult<T> {\n  if (event === \"error\") {\n    // eslint-disable-next-line no-console\n    console.error(\"Received error event:\", data);\n    let value: undefined | { error?: string };\n    try {\n      value = JSON.parse(data);\n    } catch {\n      // Ignore\n    }\n    throw new Error(typeof value?.error === \"string\" ? value.error : data);\n  }\n\n  // By default, `data: [DONE]` indicates the end of the stream\n  if (data === \"[DONE]\") {\n    return {\n      value: undefined,\n      done: true,\n    };\n  }\n\n  if (data.startsWith(\"[ERROR]\")) {\n    // eslint-disable-next-line no-console\n    console.error(\"Received error message:\", data);\n    throw new Error(data);\n  }\n\n  try {\n    const value = JSON.parse(data);\n    return {\n      value,\n      done: false,\n    };\n  } catch (e) {\n    // eslint-disable-next-line no-console\n    console.error(\"Failed to parse message:\", data);\n    throw e;\n  }\n}\n","// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze\n\n/** @internal */\nexport function deepFreeze<T>(object: T): T {\n  // Retrieve the property names defined on object\n  const propNames = Object.getOwnPropertyNames(object);\n\n  // Freeze properties before freezing self\n\n  for (const name of propNames) {\n    const value = (object as Record<string, unknown>)[name];\n\n    if (value && typeof value === \"object\") {\n      deepFreeze(value);\n    }\n  }\n\n  return Object.freeze(object);\n}\n","export function hasOwnProperty(\n  object: object,\n  property: string | number | symbol\n): boolean {\n  return Object.prototype.hasOwnProperty.call(object, property);\n}\n","// Ref https://github.com/lodash/lodash/blob/4.17.11/lodash.js#L11744\nexport function isObject(value: unknown): value is Record<string, unknown> {\n  const type = typeof value;\n  return value != null && (type == \"object\" || type == \"function\");\n}\n","// This is copied from\n// [@next-libs/storage](https://github.com/easyops-cn/next-libs/tree/master/libs/storage),\n// and the types is refined.\n// The usage of JsonStorage from @next-libs/storage should be deprecated,\n// and migrated to from @next-core/brick-utils.\nexport class JsonStorage<U = Record<string, unknown>> {\n  constructor(\n    private storage: Storage,\n    private prefix: string = \"brick-next-\"\n  ) {}\n\n  setItem<T extends string & keyof U>(name: T, value: U[T]): void {\n    this.storage.setItem(this.prefix + name, JSON.stringify(value));\n  }\n\n  getItem<T extends string & keyof U>(name: T): U[T] {\n    return JSON.parse(\n      this.storage.getItem(this.prefix + name) ?? \"null\"\n    ) as U[T];\n  }\n\n  removeItem<T extends string & keyof U>(name: T): void {\n    return this.storage.removeItem(this.prefix + name);\n  }\n\n  clear(): void {\n    return this.storage.clear();\n  }\n}\n","const pool = new Map<string, HTMLElement>();\n\nfunction getProviderBrick(provider: string) {\n  let brick = pool.get(provider);\n  if (brick) {\n    return brick;\n  }\n  brick = document.createElement(provider);\n  pool.set(provider, brick);\n  return brick;\n}\n\nexport function unwrapProvider<T extends (...args: any[]) => any>(\n  provider: string\n): (...args: Parameters<T>) => ReturnType<T> {\n  return function (...args: Parameters<T>): ReturnType<T> {\n    const brick = getProviderBrick(provider) as unknown as {\n      resolve(...args: Parameters<T>): ReturnType<T>;\n    };\n    return brick.resolve(...args);\n  };\n}\n","import type { Identifier } from \"@babel/types\";\nimport type { EstreeParent } from \"@next-core/cook\";\n\nexport interface MemberUsage {\n  usedProperties: Set<string>;\n  hasNonStaticUsage: boolean;\n}\n\nexport type BeforeVisitGlobal = (\n  node: Identifier,\n  parent: EstreeParent\n) => void;\n\nexport function beforeVisitGlobalMember(\n  usage: MemberUsage,\n  objectName: string | string[],\n  level: 1 | 2 = 1,\n  rememberObjectName = false\n): BeforeVisitGlobal {\n  return function beforeVisitGlobal(node, parent): void {\n    if (\n      typeof objectName === \"string\"\n        ? node.name === objectName\n        : objectName.includes(node.name)\n    ) {\n      const segments: string[] = [];\n      for (let i = 1; i <= level; i++) {\n        const memberParent = parent[parent.length - i];\n        if (\n          memberParent?.node.type === \"MemberExpression\" &&\n          memberParent.key === \"object\"\n        ) {\n          const memberNode = memberParent.node;\n          if (\n            !memberNode.computed &&\n            memberNode.property.type === \"Identifier\"\n          ) {\n            segments.push(\n              rememberObjectName\n                ? `${node.name}.${memberNode.property.name}`\n                : memberNode.property.name\n            );\n          } else if (\n            memberNode.computed &&\n            (memberNode.property as any).type === \"Literal\" &&\n            typeof (memberNode.property as any).value === \"string\"\n          ) {\n            segments.push(\n              rememberObjectName\n                ? `${node.name}.${(memberNode.property as any).value}`\n                : (memberNode.property as any).value\n            );\n          } else {\n            usage.hasNonStaticUsage = true;\n          }\n        } else {\n          usage.hasNonStaticUsage = true;\n        }\n      }\n      if (segments.length === level) {\n        usage.usedProperties.add(segments.join(\".\"));\n      }\n    }\n  };\n}\n","import type { Identifier } from \"@babel/types\";\nimport type { EstreeLiteral, EstreeParent } from \"@next-core/cook\";\n\nexport interface MemberCallUsage {\n  usedArgs: Set<string>;\n  hasNonStaticUsage?: boolean;\n}\n\nfunction collectMemberCallUsageFactory(object: string, property: string) {\n  return function collectMemberCallUsage(\n    usage: MemberCallUsage,\n    node: Identifier,\n    parent: EstreeParent\n  ) {\n    if (node.name === object) {\n      const memberParent = parent[parent.length - 1];\n      const callParent = parent[parent.length - 2];\n      if (\n        callParent?.node.type === \"CallExpression\" &&\n        callParent?.key === \"callee\" &&\n        memberParent?.node.type === \"MemberExpression\" &&\n        memberParent.key === \"object\" &&\n        (memberParent.node.computed\n          ? (memberParent.node.property as any).type === \"Literal\" &&\n            (memberParent.node.property as any).value === property\n          : memberParent.node.property.type === \"Identifier\" &&\n            memberParent.node.property.name === property)\n      ) {\n        const args = callParent.node.arguments as unknown as EstreeLiteral[];\n        if (args.length > 0) {\n          const firstArg = args[0];\n          if (\n            firstArg.type === \"Literal\" &&\n            typeof firstArg.value === \"string\"\n          ) {\n            usage.usedArgs.add(firstArg.value);\n          } else {\n            usage.hasNonStaticUsage = true;\n          }\n        }\n      }\n    }\n  };\n}\n\nexport const collectAppGetMenuUsage = collectMemberCallUsageFactory(\n  \"APP\",\n  \"getMenu\"\n);\n\nexport const collectInstalledAppsHasUsage = collectMemberCallUsageFactory(\n  \"INSTALLED_APPS\",\n  \"has\"\n);\n","import { Identifier } from \"@babel/types\";\nimport { isEvaluable, preevaluate, type EstreeParent } from \"@next-core/cook\";\nimport { isObject } from \"@next-core/utils/general\";\n\nexport interface TraverseStoryboardExpressionsOptions {\n  matchExpressionString: (v: string) => boolean;\n  visitNotMatchedExpressionString?: (v: string) => unknown;\n  visitNonExpressionString?: (v: string) => unknown;\n  visitObject?: (v: unknown[] | Record<string, unknown>) => unknown;\n}\n\nexport type BeforeVisitGlobalWithExpr = (\n  node: Identifier,\n  parent: EstreeParent,\n  expr: string\n) => void;\n\nexport function traverseStoryboardExpressions(\n  data: unknown,\n  beforeVisitGlobal: BeforeVisitGlobalWithExpr,\n  // If `options` is a string, it means the *keyword*.\n  options: string | TraverseStoryboardExpressionsOptions\n): void {\n  const memo = new WeakSet();\n  const {\n    matchExpressionString,\n    visitNotMatchedExpressionString,\n    visitNonExpressionString,\n    visitObject,\n  } =\n    typeof options === \"string\"\n      ? ({\n          matchExpressionString: (v: string) => v.includes(options),\n        } as TraverseStoryboardExpressionsOptions)\n      : options;\n  function traverse(value: unknown): void {\n    if (typeof value === \"string\") {\n      if (isEvaluable(value)) {\n        if (matchExpressionString(value)) {\n          try {\n            preevaluate(value, {\n              cache: true,\n              withParent: true,\n              hooks: {\n                beforeVisitGlobal(node, parent) {\n                  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                  beforeVisitGlobal(node, parent!, value);\n                },\n              },\n            });\n          } catch (error) {\n            // eslint-disable-next-line no-console\n            console.error(\"Parse storyboard expression failed:\", error);\n          }\n        } else {\n          visitNotMatchedExpressionString?.(value);\n        }\n      } else {\n        visitNonExpressionString?.(value);\n      }\n    } else if (isObject(value)) {\n      // Avoid call stack overflow.\n      if (memo.has(value)) {\n        return;\n      }\n      memo.add(value);\n      visitObject?.(value);\n      for (const item of Array.isArray(value) ? value : Object.values(value)) {\n        traverse(item);\n      }\n    }\n  }\n  traverse(data);\n}\n","import {\n  MemberUsage,\n  beforeVisitGlobalMember,\n} from \"./beforeVisitGlobalMember.js\";\nimport { traverseStoryboardExpressions } from \"./traverse.js\";\n\nexport interface MemberUsageInExpressions extends MemberUsage {\n  nonStaticUsage?: string;\n}\n\nexport function strictCollectMemberUsage(\n  data: unknown,\n  objectName: string,\n  level: 1 | 2 = 1\n): Set<string> {\n  const { hasNonStaticUsage, nonStaticUsage, usedProperties } =\n    collectMemberUsage(data, objectName, level);\n  if (hasNonStaticUsage) {\n    throw new Error(\n      `Non-static usage of ${objectName} is prohibited, check your expression: \"${nonStaticUsage}\"`\n    );\n  }\n  return usedProperties;\n}\n\nexport function collectMemberUsage(\n  data: unknown,\n  objectName: string,\n  level: 1 | 2 = 1\n): MemberUsageInExpressions {\n  const usage: MemberUsageInExpressions = {\n    usedProperties: new Set(),\n    hasNonStaticUsage: false,\n  };\n  const beforeVisitGlobal = beforeVisitGlobalMember(usage, objectName, level);\n  traverseStoryboardExpressions(\n    data,\n    (node, parent, expr) => {\n      beforeVisitGlobal(node, parent);\n      if (usage.hasNonStaticUsage) {\n        usage.nonStaticUsage = expr;\n      }\n    },\n    objectName\n  );\n  return usage;\n}\n","import { preevaluate } from \"@next-core/cook\";\nimport {\n  MemberUsage,\n  beforeVisitGlobalMember,\n} from \"./beforeVisitGlobalMember.js\";\n\ninterface trackAllResult {\n  context: string[] | false;\n  state: string[] | false;\n  formState: string[] | false;\n}\n\nconst TRACK_NAMES = [\"CTX\", \"STATE\", \"FORM_STATE\"];\n\nexport function track(\n  raw: string,\n  trackText: string,\n  variableName: string\n): Set<string> | false {\n  if (raw.includes(trackText)) {\n    const usage: MemberUsage = {\n      usedProperties: new Set(),\n      hasNonStaticUsage: false,\n    };\n    const { expression } = preevaluate(raw, {\n      cache: true,\n      withParent: true,\n      hooks: {\n        beforeVisitGlobal: beforeVisitGlobalMember(usage, variableName),\n      },\n    });\n    let trackCtxExp: any;\n    if (\n      expression.type === \"SequenceExpression\" &&\n      (trackCtxExp = expression.expressions[0] as unknown) &&\n      trackCtxExp.type === \"Literal\" &&\n      trackCtxExp.value === trackText\n    ) {\n      if (usage.usedProperties.size > 0) {\n        return usage.usedProperties;\n      } else {\n        // eslint-disable-next-line no-console\n        console.warn(\n          `You are using \"${trackText}\" but no \\`${variableName}\\` usage found in your expression: ${JSON.stringify(\n            raw\n          )}`\n        );\n      }\n    }\n  }\n  return false;\n}\n\nexport function trackAll(raw: string): trackAllResult | false {\n  // Do not pre-evaluate a string if it doesn't include track names.\n  if (TRACK_NAMES.some((name) => raw.includes(name))) {\n    const usage: MemberUsage = {\n      usedProperties: new Set(),\n      hasNonStaticUsage: false,\n    };\n    preevaluate(raw, {\n      cache: true,\n      withParent: true,\n      hooks: {\n        beforeVisitGlobal: beforeVisitGlobalMember(usage, TRACK_NAMES, 1, true),\n      },\n    });\n    if (usage.usedProperties.size > 0) {\n      const usedProperties = [...usage.usedProperties];\n      const result: trackAllResult = {\n        context: false,\n        state: false,\n        formState: false,\n      };\n      const keyMap: Record<string, keyof trackAllResult> = {\n        CTX: \"context\",\n        STATE: \"state\",\n        FORM_STATE: \"formState\",\n      };\n      usedProperties.forEach((item) => {\n        const [key, name] = item.split(\".\");\n        if (!result[keyMap[key]]) {\n          result[keyMap[key]] = [];\n        }\n        (result[keyMap[key]] as string[]).push(name);\n      });\n      return result;\n    } else {\n      // eslint-disable-next-line no-console\n      console.warn(\n        `You are using track all but no \"CTX\" or \"STATE\" or \"FORM_STATE\" usage found in your expression: ${JSON.stringify(\n          raw\n        )}`\n      );\n    }\n  }\n  return false;\n}\n","import type { StoryboardFunction } from \"@next-core/types\";\nimport { precookFunction } from \"@next-core/cook\";\nimport { BeforeVisitGlobal } from \"../index.js\";\n\nexport interface TraverseStoryboardFunctionsOptions {\n  matchSource?: (source: string) => boolean;\n}\n\nexport function traverseStoryboardFunctions(\n  functions: StoryboardFunction[] | null | undefined,\n  beforeVisitGlobal: BeforeVisitGlobal,\n  options?: TraverseStoryboardFunctionsOptions\n): void {\n  if (Array.isArray(functions)) {\n    for (const fn of functions) {\n      if (!options?.matchSource || options.matchSource(fn.source)) {\n        traverseStoryboardFunction(fn, beforeVisitGlobal);\n      }\n    }\n  }\n}\n\nexport function traverseStoryboardFunction(\n  fn: StoryboardFunction,\n  beforeVisitGlobal: BeforeVisitGlobal,\n  silentErrors?: boolean\n): void {\n  try {\n    precookFunction(fn.source, {\n      typescript: fn.typescript,\n      withParent: true,\n      hooks: { beforeVisitGlobal },\n      cacheKey: fn,\n    });\n  } catch (error) {\n    if (!silentErrors) {\n      // eslint-disable-next-line no-console\n      console.error(`Parse storyboard function \"${fn.name}\" failed:`, error);\n    }\n  }\n}\n","import type { StoryboardFunction } from \"@next-core/types\";\nimport {\n  MemberUsage,\n  beforeVisitGlobalMember,\n} from \"../expressions/beforeVisitGlobalMember.js\";\nimport { traverseStoryboardFunction } from \"./traverse.js\";\n\nexport function collectMemberUsageInFunction(\n  fn: StoryboardFunction,\n  objectName: string,\n  silentErrors?: boolean,\n  level: 1 | 2 = 1\n): Set<string> {\n  const usage: MemberUsage = {\n    usedProperties: new Set(),\n    hasNonStaticUsage: false,\n  };\n\n  if (fn.source.includes(objectName)) {\n    traverseStoryboardFunction(\n      fn,\n      beforeVisitGlobalMember(usage, objectName, level),\n      silentErrors\n    );\n  }\n\n  if (usage.hasNonStaticUsage && !silentErrors) {\n    throw new Error(\n      `Non-static usage of ${objectName} is prohibited, check your function: \"${fn.name}\"`\n    );\n  }\n\n  usage.usedProperties.delete(fn.name);\n\n  return usage.usedProperties;\n}\n","import type { Storyboard } from \"@next-core/types\";\nimport type { EstreeLiteral } from \"@next-core/cook\";\nimport {\n  traverseStoryboardExpressions,\n  BeforeVisitGlobal,\n} from \"./expressions/index.js\";\nimport { traverseStoryboardFunctions } from \"./functions/index.js\";\n\nconst PERMISSIONS = \"PERMISSIONS\";\nconst check = \"check\";\n\nexport function scanPermissionActionsInStoryboard(\n  storyboard: Storyboard\n): string[] {\n  const collection = new Set<string>();\n  const beforeVisitPermissions = beforeVisitPermissionsFactory(collection);\n  const { customTemplates, functions } = storyboard.meta ?? {};\n  traverseStoryboardExpressions(\n    [storyboard.routes, customTemplates],\n    beforeVisitPermissions,\n    PERMISSIONS\n  );\n  traverseStoryboardFunctions(functions, beforeVisitPermissions, {\n    matchSource(source) {\n      return source.includes(PERMISSIONS);\n    },\n  });\n  return Array.from(collection);\n}\n\nexport function scanPermissionActionsInAny(data: unknown): string[] {\n  const collection = new Set<string>();\n  traverseStoryboardExpressions(\n    data,\n    beforeVisitPermissionsFactory(collection),\n    PERMISSIONS\n  );\n  return Array.from(collection);\n}\n\nfunction beforeVisitPermissionsFactory(\n  collection: Set<string>\n): BeforeVisitGlobal {\n  return function beforeVisitPermissions(node, parent): void {\n    if (node.name === PERMISSIONS) {\n      const memberParent = parent[parent.length - 1];\n      const callParent = parent[parent.length - 2];\n      if (\n        callParent?.node.type === \"CallExpression\" &&\n        callParent?.key === \"callee\" &&\n        memberParent?.node.type === \"MemberExpression\" &&\n        memberParent.key === \"object\" &&\n        (memberParent.node.computed\n          ? (memberParent.node.property as any).type === \"Literal\" &&\n            (memberParent.node.property as any).value === check\n          : memberParent.node.property.type === \"Identifier\" &&\n            memberParent.node.property.name === check)\n      ) {\n        for (const arg of callParent.node\n          .arguments as unknown as EstreeLiteral[]) {\n          if (arg.type === \"Literal\" && typeof arg.value === \"string\") {\n            collection.add(arg.value);\n          }\n        }\n      }\n    }\n  };\n}\n"],"names":["undefined","Element","prototype","replaceChildren","this","lastChild","removeChild","arguments","length","append","DocumentFragment","USE_CHILDREN_SLOT_REGEXP","replaceUseChildren","bricks","brick","replaceInBrick","slots","useChildrenMap","Map","Array","isArray","children","removeBricks","child","slot","test","get","push","set","pull","slotConf","Object","entries","size","replaceInProperties","properties","value","item","isObject","k","v","useBrick","dispatchRequestEventByConfig","type","config","_config$options","options","interceptorParams","ignoreLoadingBar","window","dispatchEvent","Event","http","interceptors","request","use","response","error","Promise","reject","loadingBar","document","querySelector","classList","add","loading","count","updateLoadingStatus","hasRemainingRequests","addEventListener","requestStart","requestEnd","runtime","createRuntime","container","portal","root","unstable_createRoot","scope","unknownBricks","bootstrap","BOOTSTRAP_FILE","responseType","then","data","initialize","BOOTSTRAP_FILE_FIELD","nextRequest","rendering","async","queuedRender","sources","_ref","yaml","html","theme","uiVersion","language","context","functions","templates","i18n","i18nData","url","app","styleText","templatesAreArrayOfYaml","initialized","body","applyTheme","remove","setUIVersion","changeLanguage","dom","DOMParser","parseFromString","Set","node","querySelectorAll","tagName","includes","lowerTagName","toLowerCase","bricksInScript","text","matchAll","match","loadBricks","scripts","scriptTags","scriptTag","newScriptTag","createElement","head","childNodes","parsed","safeLoad","schema","JSON_SCHEMA","json","concat","textContent","parsedContext","loadYaml","parsedFunctions","parsedTemplates","parsedI18n","template","render","e","console","String","req","_preview_only_render","_preview_only_inject","pkg","noResolve","loadBricksImperatively","element","resolve","content","map","name","Mode","SourceNode","Symbol","for","FormalParameters","ECMAScriptCode","Environment","IsConstructor","ThisMode","DebuggerCall","DebuggerScope","DebuggerNode","DebuggerReturn","ExecutionContext","constructor","_defineProperty","BindingStatus","EnvironmentRecord","outer","OuterEnv","HasBinding","bindingMap","has","CreateMutableBinding","deletable","mutable","NormalCompletion","CreateImmutableBinding","strict","InitializeBinding","binding","assign","SetMutableBinding","_strict","ReferenceError","TypeError","GetBindingValue","HasThisBinding","DeclarativeEnvironment","FunctionEnvironment","F","super","LEXICAL","ThisBindingStatus","UNINITIALIZED","BindThisValue","INITIALIZED","Error","ThisValue","GetThisBinding","ReferenceRecord","base","referenceName","Base","ReferenceName","Strict","CompletionRecord","Type","Value","Empty","collectBoundNames","names","collect","n","declarations","id","elements","left","argument","from","containsExpression","some","computed","collectScopedDeclarations","nextOptions","var","Number","topLevel","kind","consequent","alternate","init","cases","block","handler","finalizer","IsPropertyReference","V","InitializeReferencedBinding","W","CopyDataProperties","target","source","excludedItems","keys","getOwnPropertyNames","getOwnPropertySymbols","nextKey","desc","getOwnPropertyDescriptor","enumerable","ForDeclarationBindingInstantiation","forDeclaration","env","isConst","LoopContinues","completion","UpdateEmpty","GetValue","ToPropertyKey","arg","GetV","P","PutValue","CreateListIteratorRecord","args","cooked","iterator","RequireObjectCoercible","GetIdentifierReference","ApplyStringOrNumericBinaryOperator","leftValue","operator","rightValue","SyntaxError","reservedObjects","WeakSet","Function","self","global","getGlobal","allowedConstructors","URL","URLSearchParams","WeakMap","RegExp","globalExecutionContextStack","__dev_only_clearGlobalExecutionContextStack","__dev_only_getGlobalExecutionContextStack","cook","rootAst","codeSource","_hooks$beforeEvaluate4","rules","debug","externalSourceForDebug","globalVariables","ArrayConstructor","hooks","expressionOnly","doSanitize","sanitize","rootEnv","rootContext","VariableEnvironment","LexicalEnvironment","executionContextStack","key","TemplateMap","currentNode","Evaluate","optionalChainRef","forceYield","_hooks$beforeEvaluate","_hooks$beforeBranch2","beforeEvaluate","call","endsWith","expression","array","spreadValues","ThrowIfFunctionIsInvalid","InstantiateArrowFunctionExpression","rightRef","right","funcName","substring","start","end","thisValue","ref","callee","func","optional","skipped","EvaluateCall","ResolveBinding","regex","raw","flags","pattern","baseValue","object","result","propertyKey","EvaluatePropertyAccessWithExpressionKey","property","identifier","propertyNameString","EvaluatePropertyAccessWithIdentifierKey","constructExpr","argList","ArgumentListEvaluation","constructorName","Date","isAllowedConstructor","EvaluateNew","prop","propName","EvaluateComputedPropertyName","propValue","method","SetFunctionName","expr","expressions","chunks","quasis","index","val","join","tagRef","tag","tagFunc","quasi","ApplyUnaryOperator","lref","rval","IsAnonymousFunctionDefinition","NamedEvaluation","DestructuringAssignmentEvaluation","lval","r","substr","ApplyStringOrNumericAssignment","oldEnv","getRunningContext","blockEnv","BlockDeclarationInstantiation","blockValue","EvaluateStatementList","EvaluateBreakableStatement","stmtResult","DoWhileLoopEvaluation","lhs","lhsKind","uninitializedBoundNames","iterationKind","keyResult","runningContext","newEnv","exprRef","exprValue","EnumerateObjectProperties","ForInOfHeadEvaluation","stmt","iteratorRecord","destructuring","done","nextValue","next","lhsRef","iterationEnv","lhsName","BindingInitialization","status","return","innerResult","ForInOfBodyEvaluation","ForInOfLoopEvaluation","_node$init","ForBodyEvaluation","update","loopEnv","boundNames","dn","perIterationLets","bodyResult","ForLoopEvaluation","InstantiateOrdinaryFunctionExpression","_hooks$beforeBranch","beforeBranch","GetThisEnvironment","oldValue","newValue","prefix","switchValue","discriminant","R","input","defaultCaseIndex","findIndex","switchCase","hasDefaultCase","A","slice","found","C","CaseClauseIsSelected","foundInB","B","CaseBlockEvaluation","_hooks$beforeEvaluate2","thrownValue","param","catchEnv","argName","CatchClauseEvaluation","declarator","bindingId","WhileLoopEvaluation","increment","perIterationBindings","CreatePerIterationEnvironment","lastIterationEnv","thisIterationEnv","bn","lastValue","excludedNames","valueTarget","KeyedDestructuringAssignmentEvaluation","RestDestructuringAssignmentEvaluation","PropertyDestructuringAssignmentEvaluation","assignmentTarget","isObjectOrArray","IteratorDestructuringAssignmentEvaluation","propertyName","rhsValue","restProperty","code","d","IsConstantDeclaration","fn","fo","InstantiateFunctionObject","debuggerCall","apply","templateLiteral","memo","rawObj","freeze","defineProperty","writable","configurable","GetTemplateObject","CallFunction","closure","thisArgument","_hooks$beforeCall","beforeCall","calleeContext","localEnv","OrdinaryCallBindThis","PrepareForOrdinaryCall","formals","parameterNames","hasParameterExpressions","varDeclarations","varNames","functionNames","functionsToInitialize","i","unshift","noVar","argumentsObjectNeeded","paramName","parameterBindings","ao","argumentObject","values","ThrowTypeError","CreateUnmappedArgumentsObject","varEnv","IteratorBindingInitialization","instantiatedVarNames","initialValue","lexEnv","lexDeclarations","f","FunctionDeclarationInstantiation","EvaluateFunctionBody","OrdinaryCallEvaluateBody","pop","statements","s","_hooks$beforeEvaluate3","OrdinaryFunctionCreate","functionExpression","funcEnv","arrowFunction","sourceNode","isConstructor","lexicalThis","unwind","defineProperties","params","STRICT","len","ExpectedArgumentCount","environment","InitializeBoundName","RestBindingInitialization","KeyedBindingInitialization","PropertyBindingInitialization","restObj","bindingElement","generator","AnalysisContext","AnalysisEnvironment","bindingSet","CreateBinding","precook","visitors","withParent","attemptToVisitGlobals","analysisContextStack","EvaluateChildren","parent","forEach","_hooks$beforeVisit","_hooks$beforeVisitUnk","beforeVisit","hasOwnProperty","visit","_hooks$beforeVisitGlo","beforeVisitGlobal","BoundNamesInstantiation","lexicalBinding","beforeVisitUnknown","warn","PrepareOrdinaryCall","ASTCache","precookFunction","typescript","cacheKey","restOptions","parse","plugins","filter","Boolean","strictMode","attachComment","program","jsNodes","startsWith","parseAsEstree","function","clearFunctionASTCache","preevaluate","cache","fixes","replace","m","parseExpression","proposal","parseAsEstreeExpression","suffix","isEvaluable","shouldAllowRecursiveEvaluations","isTrackAll","clearExpressionASTCache","clear","fetch","Request","credentials","HttpFetchError","message","captureStackTrace","HttpResponseError","responseJson","statusText","HttpParseError","HttpAbortError","InterceptorManager","onFulfilled","onRejected","handlers","fulfilled","rejected","eject","isNil","fullBaseHref","href","location","origin","isHttpAbortError","DOMException","toString","ok","headers","getUrlWithParams","parsedUrl","searchParams","getBodyAndHeaders","parsedHeaders","Headers","contentTypeHeader","FormData","JSON","stringify","defaultAdapter","simpleRequest","observe","noAbortOnRouteChange","useCache","requestInit","requestWithBody","_adapter","_Http_brand","Http","_config","_this","_classPrivateMethodInitSpec","_classPrivateFieldInitSpec","_assertClassBrand","_fetch","adapter","_classPrivateFieldSet","delete","post","put","patch","chain","promise","interceptor","_classPrivateFieldGet","res","_interceptor$fulfille","_interceptor$rejected","shift","createHttpInstance","HttpModule","HttpModuleV2","dll","_window$BRICK_NEXT_VE","BRICK_NEXT_VERSIONS","HttpModuleV3","initializedNamespaces","initializeI18n","NS","locales","LanguageDetector","fallbackLng","process","supportedLngs","nonExplicitSupportedLngs","interpolation","escapeValue","react","useSuspense","compatibilityJSON","resources","lang","addResourceBundle","i18nText","primaryLanguage","split","i18next","LexicalStatus","TokenType","JsonValueType","getRegExpOfPlaceholder","symbols","symbol","escapeRegExp","eatOptionalRawAndOptionalPlaceholderBegin","_subRaw$match","subRaw","getSubRaw","matchedPlaceholder","beginPlaceholder","subCursor","indexOf","charAt","nextCursor","cursor","tokens","Raw","BeginPlaceHolder","loc","ExpectField","eatWhitespace","eatField","Field","ExpectOptionalBeginDefault","eatOptionalDefault","BeginDefault","ExpectDefaultValue","ExpectOptionalBeginPipe","eatDefaultValue","eatJsonValueOrLiteralString","eatOptionalBeginPipe","BeginPipe","ExpectPipeIdentifier","ExpectPlaceholderEnd","eatPipeIdentifier","matches","PipeIdentifier","ExpectOptionalBeginPipeParameter","eatOptionalBeginPipeParameter","BeginPipeParameter","ExpectPipeParameter","eatPipeParameter","eatPlaceholderEnd","EndPlaceHolder","Initial","jsonLiteralMap","nextStatus","firstChar","valueType","Others","objectBracesToMatch","arrayBracketsToMatch","stringQuotesToClose","stringBackslashToEscape","matched","char","JsonValue","eatJsonValue","LiteralString","transform","compile","inject","transformAndInject","isInjectable","transformNode","field","defaultValue","processPipes","pipes","injectNode","namespace","subField","SimpleContextMap","SYS","FLAGS","query","getAll","event","overrideApp","hash","anchor","original","injectNodeFactory","tree","token","optionalToken","acceptToken","placeholder","pipe","parameters","parseTokens","tokenize","parseInjectableString","loadScriptOrStyle","src","attrs","all","fixedSrc","cachedPromise","rel","onload","onerror","firstScript","currentScript","getElementsByTagName","parentNode","insertBefore","loadScript","loadStyle","loadSharedModule","module","__webpack_init_sharing__","__webpack_share_scopes__","default","resolveBasicPkg","rejectBasicPkg","basicPkgWillBeResolved","waitBasicPkg","flushStableLoadBricks","enqueueStableLoadBricks","brickPackages","dispatchRequestStatus","enqueueStableLoad","enqueueStableLoadProcessors","processors","loadProcessorsImperatively","loadEditorsImperatively","editors","BrickLoadError","v2AdapterPromise","V2_ADAPTER_LOAD_BRICKS","getItemsByPkg","list","brickPackagesMap","itemsByPkg","listToLoad","_pkg$dependencies","lastName","p","propertyEditors","pkgId","camelPackageName","toLocaleLowerCase","deprecatedBrickInThisPkg","_p$elements","_p$deprecatedElements","deprecatedElements","groupItems","fullName","deps","dependencies","dep","loadBrickModule","moduleName","loadRestBricks","pkgs","itemsMap","filePath","PUBLIC_ROOT","getPkgIdByFilePath","foundBasicPkg","v2Packages","v3PackagesOtherThanBasic","maybeV2Adapter","v2Adapter","basicPkgPromise","basicPkg","tempPromise","pkgPromises","v2AdapterItemsByPkg","v2AdapterPackages","loadV2Adapter","pkgNamespace","propertyEditorsJsFilePath","PipeRegistry","registeredPipe","getBasePath","getAttribute","matchStoryboard","storyboards","pathname","sortedStoryboards","orderBy","storyboard","_storyboard$app$homep","homepage","matchHomepage","isOutsideApp","_getRuntime$getCurren","getRuntime","getCurrentApp","STANDALONE_MICRO_APPS","standaloneMode","history","blocked","getUserConfirmation","callback","confirm","historyOverridden","browserHistory","originalPush","originalReplace","updateFactory","path","state","pathIsString","parsePath","_bootstrapData9","bootstrapData","_internalApiMatchStoryboard","createHref","getV2RuntimeFromDll","createHistory","createBrowserHistory","basename","updateQueryFactory","extraQuery","keepHash","urlSearchParams","search","blockMessage","pushQuery","replaceQuery","pushAnchor","notify","reload","noIncremental","setBlockMessage","getBlockMessage","unblock","historyExtended","getHistory","v2Kit","getHistoryV2Factory","_registry","customProcessors","define","processorFullName","processorFunc","registerCustomProcessor","getCustomProcessorsV2","processorName","registerAppI18n","meta","i18nNamespace","getI18nNamespace","languages","_ref2","removeResourceBundle","widgetI18nFactory","widgetId","getFixedT","registerWidgetI18n","registerWidgetI18nV2Factory","ns","MESSAGE_SOURCE_PANEL","FRAME_ACTIVE_CHANGE","PANEL_CHANGE","selectedPanel","frameIsActive","devtoolsHookEmit","payload","devtools","getDevHook","emit","_devtools$emit","requestIdleCallback","setTimeout","__BRICK_NEXT_DEVTOOLS_HOOK__","THROW","readOnlyHandler","deleteProperty","setPrototypeOf","getReadOnlyProxy","Proxy","getDynamicReadOnlyProxy","ownKeys","fromEntries","storage","JsonStorage","localStorage","LOCAL_STORAGE_APPS_THEME_KEY","setTheme","getTheme","getCurrentTheme","documentElement","dataset","CustomEvent","detail","batchSetAppsLocalTheme","appsTheme","setItem","getLocalAppsTheme","getItem","mode","setMode","getCurrentMode","applyMode","getCssPropertyValue","_window$getComputedSt","el","getComputedStyle","getPropertyValue","getGeneralGlobals","variableName","variable","getIndividualGlobal","_hooks$images","_hooks$images2","_hooks$checkPermissio","collectCoverage","widgetVersion","appendI18nNamespace","storyboardFunctions","isStoryboardFunction","images","widgetImagesFactory","imagesFactory","isBuildPush","currentVersion","identity","fakeI18nText","check","fakeCheckPermissions","checkPermissions","host","hostname","en","StoryboardFunctionRegistryFactory","debuggerOverrides","registeredFunctions","overrides","supply","_target","processed","collector","createCollector","precooked","currentApp","LodashWithStaticFields","_","ObjectWithStaticFields","getStoryboardFunction","registerStoryboardFunctions","collectMemberUsageInFunction","hasPermissionsCheck","perm","updateStoryboardFunction","newFn","checkPermissionsUsage","checkedFunctions","clearGlobalExecutionContextStack","getGlobalExecutionContextStack","MediaBreakpoint","mediaBreakpointMinWidthMap","xLarge","large","medium","small","xSmall","mediaEventTarget","EventTarget","breakpointMatchesMap","MEDIA","handleMatchesChange","breakpoint","changed","minWidth","mediaQueryList","matchMedia","addListener","getMedia","getStorageItem","storageType","sessionStorage","isStrictMode","runtimeContext","_getRuntime","getFeatureFlags","warnAboutStrictMode","_len","extraLogs","_key","punctuation","allowedNativeProps","customTemplates","registerCustomTemplate","getCustomTemplatesV2","_constructor$proxy","_compatibleConstructo","registered","customElements","proxyProperties","proxy","validProxyProps","legacyTplVariables","asVariable","mergeProperty","refTransform","compatibleConstructor","expose","tpl","exposedStates","uniq","proxyMethods","methods","props","entry","nativeProps","HTMLElement","TplElement","$$typeof","_dev_only_definedProperties","_dev_only_definedMethods","$$getElementByRef","_this$$$tplStateStore","$$tplStateStore","hostBrick","tplHostMetadata","internalBricksByRef","connectedCallback","shadowRoot","attachShadow","fragment","createDocumentFragment","style","appendChild","disconnectedCallback","getValue","_this$$$tplStateStore2","updateValue","to","refProperty","_this$$$getElementByR","refMethod","getTplStateStore","using","extraInfo","tplStateStoreId","tplStateStoreMap","store","getTplHostElement","hostElement","widgetFunctionRegistry","widgetFunctions","registerWidgetFunctions","registerWidgetFunctionsV2Factory","hasInstalledApp","appId","matchVersion","_internalApiGetAppInBootstrapData","checkInstalledApps","getCheckedApp","installStatus","compare","getFormStateStore","formStateStoreId","formStateStoreMap","pool","getProviderBrick","provider","_hooks$flowApi","isFlowApi","flowApi","isFlowApiProvider","FLOW_API_PROVIDER","registerFlowApiProvider","getBrickPackages","markAsComputed","hasBeenComputed","proto","getPrototypeOf","resolveData","resolveConf","useProvider","onReject","legacyProvider","legacyField","hasLegacyField","providerBrick","actualArgs","asyncComputeRealValue","renderId","resolveByProvider","_internalApiGetRenderId","isHandleRejectByTransform","originalArgs","stale","finalArgs","getArgsOfFlowApi","symbolForRaw","symbolForContext","isPreEvaluated","getPreEvaluatedRaw","pre","shouldDismissMarkingComputed","possibleErrorConstructs","getCookErrorConstructor","evaluate","run","lowLevelEvaluate","isAsync","blockingList","passByRuntimeContext","omit","menuUsage","usedArgs","hasAppUsage","collectAppGetMenuUsage","collectInstalledAppsHasUsage","hasNonStaticUsage","lazy","usedCtx","usedProcessors","usedStates","tplStateStore","usedFormStates","formStateStore","devHook","strictCollectMemberUsage","ctxStore","waitFor","usedTpls","attemptToCheckPermissions","usedFunctions","pendingPermissionsPreCheck","menu","usedMenuIds","menuId","fetchMenuById","getStoryboardByAppId","_internalApiGetStoryboardInBootstrapData","_hooks$checkInstalled","waitForCheckingApps","_hooks$menu","sys","cloneDeep","getMenu","getMenuById","getMiscSettings","_t","processor","StateOfUseBrick","isLazyContentInUseBrick","USE_BRICK_PROPERTIES","USE_BRICK_TRANSFORM","USE_BRICK_EVENTS","USE_BRICK_IF","USE_BRICK_LIFECYCLE","USE_BRICK_DATA_SOURCE","getNextStateOfUseBrick","USE_BRICK","USE_BRICK_ITEM","USE_BRICK_SLOTS_ITEM_BRICKS","USE_BRICK_SLOTS_ITEM_BRICKS_ITEM","INITIAL","USE_BRICK_SLOTS","USE_BRICK_SLOTS_ITEM","internalOptions","preEvaluated","$$lazyForUseBrick","$$stateOfUseBrick","dismissMarkingComputed","asyncEvaluate","noInject","getNextComputeOptions","ignoreSymbols","computeRealValue","asyncCheckIf","ifContainer","if","checkIf","checkIfOfComputed","checkIfByTransform","looseCheckIfByTransform","checkIfByTransformV2Factory","getTracks","contextNames","stateNames","formStateNames","trackAll","formState","track","computePropertyValue","asyncPropertyEntries","asyncValue","ignoreUndefined","constructAsyncProperties","setRealProperties","realProps","setProperties","realValue","computeRealProperties","trackAfterInitial","trackingContextList","initialTracker","contextName","disposes","onChange","listener","stateName","cacheLimit","cacheCount","matchPath","exact","sensitive","reduce","regexp","pathCache","cacheResult","pathToRegexp","compilePath","exec","isExact","matchRoute","route","symbolForAsyncComputedPropsFromHost","symbolForTplStateStoreId","symbolForTPlExternalForEachItem","symbolForTPlExternalForEachIndex","symbolForTPlExternalForEachSize","timeoutIdList","K","REQUEST_FAILED","SOMETHING_WENT_WRONG","LOGIN_TIMEOUT_MESSAGE","NETWORK_ERROR","LICENSE_EXPIRED","NO_PERMISSION","PAGE_NOT_FOUND","APP_NOT_FOUND","UNKNOWN_ERROR","GO_BACK_TO_PREVIOUS_PAGE","GO_BACK_HOME","RELOAD","zh","Dialog","show","confirmed","alert","setLoginStateCookie","pathValue","btoa","encodeURIComponent","searchValue","cookie","httpErrorToString","HTMLScriptElement","t","msg","isUnauthenticatedError","lastErrorMessage","unauthenticatedConfirming","handleHttpError","NO_AUTH_GUARD","ssoEnabled","redirectToLogin","title","contentStyle","whiteSpace","wordBreak","Notification","bindListeners","eventsMap","eventType","listenerFactory","$$listeners","$$eventListeners","isBuiltinHandler","action","isUseProviderHandler","isCustomHandler","targetRef","isConditionalEventHandler","runtimeBrick","handleHistoryAction","handleWindowOpenAction","handleWindowPostMessageAction","handleParentPostMessageAction","handleLocationAction","handleStorageAction","preventDefault","stopPropagation","handleConsoleAction","handleMessageAction","handleContextAction","batch","handleTplStateAction","argsFactory","handleFormStateAction","handleMessageDispatcher","handleUseProviderAction","handleCustomAction","else","brickCallback","targets","rawTarget","rawTargetRef","computedTarget","multiple","computedTargetRef","targetRefs","tplHostElement","_tplHostElement$$$get","isExecuteCustomHandler","useEventAsDefault","isSetPropsCustomHandler","targetOrProvider","isProvider","task","realTarget","computedArgs","_handler$sse","sse","stream","callbackFactory","eventCallbackFactory","pollableCallback","progress","success","finally","_handler$sse2","_handler$poll","pollRuntimeContext","finallyCallback","currentRenderId","startSSEStream","poll","enabled","pollOptions","expectPollStopImmediately","expectPollEnd","interval","leadingRequestDelay","continueOnError","delegateLoadingBar","pick","currentTimeoutId","shouldStop","_computeRealValue","_computeRealValue2","expectPollStopImmediatelyResult","_computeRealValue3","delayedPoll","_computeRealValue4","delay","startPoll","err","baseArgsLength","hasCallback","overrideMethod","useEventDetailAsDefault","features","open","postMessage","batchUpdate","updateValues","every","removeItem","_hooks$messageDispatc","messageDispatcher","bindTemplateProxy","_tplHostMetadata$prox","events","bubbles","cancelable","composed","refEvent","$$proxyListeners","unbindTemplateProxy","removeEventListener","RenderTag","unmountTree","mountPoint","mountTree","initializedElement","DISABLE_REACT_FLUSH_SYNC","current","portalElements","BRICK","_current$tplHostMetad","slotId","setAttribute","iid","childElements","sibling","_currentReturn","currentReturn","_currentReturn$contai","ROOT","createPortal","commonLifeCycles","pageOnlyLifeCycles","_routeHelper","_memoizedLifeCycle","_observers","_mediaListener","_arbitraryLifeCycle","_memoized","_initialMenuRequestNode","_memoizedMenuRequestNodeMap","_incrementalRenderStates","_RendererContext_brand","RendererContext","onBeforePageLoad","onPageLoad","onPageLeave","onBeforePageLeave","onAnchorLoad","onAnchorUnload","onMediaChange","onScrollIntoView","onMount","onUnmount","onMessage","onMessageClose","routeHelper","setInitialMenuRequestNode","menuRequestNode","memoizeMenuRequestNode","routes","getMenuRequests","menuRequests","_current","reMergeMenuRequestNodes","parentMenuRequestNode","previousSibling","mergeMenus","reBailout","output","bailout","reCatch","returnNode","catch","didPerformIncrementalRender","prevLocation","finalResult","shouldIgnoreRoutes","parentRoutes","reverse","parentRoute","performIncrementalRender","registerBrickLifeCycle","lifeCycle","lifeCycleTypes","isEmpty","useResolves","registerArbitraryLifeCycle","arbitraryCallbacks","memoize","keyPath","memKey","mem","last","getLastNode","lastNormal","getLastNormalNode","lastPortal","getLastPortalNode","reRender","memoized","prevNode","prevLast","prevLastNormal","prevLastPortal","insertBeforeChild","insertPortalBeforeChildCandidates","PLACEHOLDER","_getNextNormalNode","_getNextPortalNode","getSpecifiedNormalNode","getNextNormalNode","nextSibling","getSpecifiedPortalNode","getNextPortalNode","_prevLastNormal$eleme","_prevLastPortal$eleme","prevSibling","portalFragment","renderRoot","getBrickRange","_unmountBricks","_returnNode$container","_returnNode$element","hasChildNodes","_root","insertPortalBeforeChild","candidate","contains","newBricks","_initializeRerenderBricks","dispose","observer","disconnect","dispatchBeforePageLoad","_dispatchGeneralLifeCycle","dispatchPageLoad","dispatchBeforePageLeave","dispatchPageLeave","dispatchAnchorLoad","initializeScrollIntoView","conf","_addObserver","initializeMediaChange","initializeMessageDispatcher","_hooks$messageDispatc2","confList","channel","onClose","dispatchOnMount","dispatchOnUnmount","unmountList","removed","_brick$element","_brick$element2","_brick$disposes","observers","unmountEvent","mountEvent","threshold","IntersectionObserver","isIntersecting","intersectionRatio","_last","range","_currentReturn2","routeMatchedMap","getMatchedRoute","symbolForRootRuntimeContext","renderUseBrick","errorBoundary","_output$node","_output$node2","scopedRuntimeContext","tplStateStoreScope","formStateStoreScope","createScopedRuntimeContext","_internalApiGetRuntimeContext","rendererContext","renderBrick","scopedStores","postAsyncRender","mountUseBrick","portalRoot","mountAsyncData","unmountUseBrick","mountResult","legacyDoTransform","updateStoryboard","storyboardPatch","$$fulfilling","$$fulfilled","$$registerCustomTemplateProcessed","updateStoryboardByRoute","newRoute","replaceRoutes","replaceBricks","updateStoryboardByTemplate","newTemplate","settings","tplName","updateTemplatePreviewSettings","templateId","_updatePreviewSettings","getSnippetPreviewPath","snippetId","updateStoryboardBySnippet","snippetData","_snippetData$bricks","updateSnippetPreviewSettings","previewRouteIndex","newPreviewRoute","splice","getContextValue","_ref3","getAllContextValues","_ref4","getAllValues","getBrickPackagesById","find","loadEditors","getRenderId","getAddedContracts","_ref5","updateStoryboardType","collectUsedContracts","updatedStoryboard","_storyboard$routes","snippetPreviewPath","addedContracts","api","_storyboard$meta","namespaceId","contracts","contract","debugDataValue","debugData","_ref6","routeId","getLegalRuntimeValue","realTimeDataInspectRoot","RealTimeDataInspectHooks","setRealTimeDataInspectRoot","callRealTimeDataInspectHooks","changeType","addRealTimeDataInspectHook","hook","supportContextResolveTriggerBrickLifeCycle","DataStore","stateStoreId","changeEventType","_this$data$get","notifyRealTimeDataChange","getAffectListByContext","affectNames","batchUpdateContextsNames","updateContexts","affectContexts","affectDepsContextNames","updateContextItem","affectContextItem","triggerEvent","contexts","_context$eventTarget","eventTarget","callbackRuntimeContext","useResolve","loaded","shouldDismiss","_this$rendererContext","load","finishLoad","dataConfs","asyncHostPropertyEntries","routePath","pending","contextConfs","resolveContext","keyword","dependencyMap","depsMap","contextConf","stats","collectMemberUsage","legacyTplStats","usedProperties","getDependencyMapOfContext","pendingDeps","deferredContexts","pendingContexts","wrapResolve","resolved","scheduleNext","scheduleAsSerial","readyContexts","predicateNextResolveFactory","pendingResult","duplicatedMap","processedAtLeastOne","detectCircularContexts","deferred","resolveDataStore","dataConf","pendingStack","dataName","_this$data$get2","dataNames","ctx","waitForAll","_this$routeMap$get","routeMap","asyncMounted","trackConditionalResolve","resolvePolicy","hasFallbackValue","_this$rendererContext2","newData","trigger","_this$rendererContext3","batchAddListener","disposeDataInRoutes","setupTemplateProxy","hostContext","reversedProxies","externalSlots","asyncComputedProps","propertyProxies","asyncHostProps","filtered","slotProxies","quasisMap","_externalSlots$from","insertBricks","refToSlot","refSlot","expandableSlot","refPosition","hostHasForEach","clamp","setupTemplateExternalBricksWithForEach","forEachItem","forEachIndex","forEachSize","slotName","flatMap","childrenToSlots","setupTemplateExternalRoutesWithForEach","setupUseBrickInTemplate","walk","setup","originalSlots","restConf","transpiledSlots","expandCustomTemplate","tplTagName","brickConf","uniqueId","collectWidgetContract","originalExternalSlots","externalChildren","restBrickConf","newBrickConf","proxies","expandBrickInTemplate","brickConfInTemplate","slotsInTemplate","childrenInTemplate","restBrickConfInTemplate","FORM_RENDERER","symbolForFormStateStoreId","formContainers","formSchemaToBrick","fields","instanceId","fieldId","defaults","commonProps","label","testid","getReadOnlyAndRequired","_field$limit","_field$limit2","readOnly","limit","required","fieldType","description","precision","inputBoxStyle","width","getDefaultProperties","formSchemasToBricks","schemas","_FormElement_brand","FormElement","validate","_proxyFormMethod","setInitValue","resetFields","_len2","_key2","_this$firstElementChi","_containerElement$tag","containerElement","firstElementChild","PageNotFoundError","ErrorNode","pageLevel","variant","showLink","showDescription","_error$response","_error$responseJson","getRefinedErrorConf","errorBrick","_internalApiGetPresetBricks","linkBrick","race","_resolve","errorTitle","getLinkNode","useDefaultError","color","descriptionNode","click","renderRoutes","_runtimeContext","menuRequestReturnNode","isIncremental","noAuthGuard","public","auth","isLoggedIn","matchRoutes","unauthenticated","preCheckPermissionsForBrickOrRoute","preLoadBricks","redirectTo","redirect","menuRequest","menuConf","loadMenu","newOutput","renderBricks","mergeRenderOutput","appendMenuRequestNode","tplStack","shallow","setupBrick","inUseBrick","forceRecursive","setupRootRuntimeContext","kPath","hasTrackingControls","_hooks$checkPermissio2","_runtimeContext$app","brickIf","permissionsPreCheck","isGeneralizedTrackAll","dataSource","acc","asyncCheckBrickIf","brickName","ensureValidControlBrick","lowerLevelRenderControlNode","tracker","trackDataSource","_slots$slot","computedDataSource","rendered","j","flat","renderForEach","renderControlNode","changedAfterInitial","rawOutput","rerenderCount","uninitialized","controlledOutput","reControlledOutput","rerender","debouncedListener","debounce","leading","trailing","catchLoad","getTagNameOfCustomTemplate","tplCount","formData","confProps","_brickConf$properties","compute","asyncComputeRealPropertyEntries","computedPropsFromHost","isScript","listenOnTrackingContext","loadProperties","childRuntimeContext","expandedBrickConf","hostBrickConf","_hostBrickConf$proper","normalizedFormData","formConf","formSchema","targetEvents","sourceEvents","mergeEvents","padding","expandFormRenderer","routeSlotFromIndexToSlotId","childSlotId","incrementalSubRoutes","prevMatch","newMatch","isEqual","incrementalOutput","failed","childrenOutput","mergeSiblingRenderMenuRequest","loadChildren","legacyRenderBrick","getDataStores","stores","rest","newSlots","unknownPolicy","misc","nativeController","getPageInfo","isInIframe","isInIframeOfSameSite","isInIframeOfNext","isInIframeOfVisualBuilder","isInIframeOfLegacyConsole","selfIsNext","parentPathname","parentIsNext","registerCustomTemplates","version","ui","WATEMARK_BRICKNAME","_storyboards","_rendering","_nextRender","_rendererContext","_rendererContextTrashCan","_redirectCount","_renderId","_currentApp","_previousApp","_navConfig","_Router_brand","Router","_history","_getBlockMessageBeforePageLave","returnValue","getRuntimeContext","getRecentApps","previousApp","getNavConfig","AbortController","signal","nextPrevLocation","listen","_queuedRender","_classPrivateFieldGet2","previousMessage","_safeRedirect","_this$redirectCount","_this$redirectCount2","_preRender","nextRender","_prevLocation$state","_location$state","_location$state2","_classPrivateFieldGet4","ignoreRendering","omittedLocationProps","_classPrivateFieldGet3","locationsAreEqual","abort","_render","isBootstrap","_hooks$pageView","_classPrivateFieldGet5","_storyboard$app","clearCollectWidgetContract","finishPageView","pageView","create","currentAppId","BOOTSTRAP_UNION_FILE","APP_ROOT_TPL","APP_ID","APP_ROOT","setAppVariable","_hooks$fulfilStoryboa","fulfilStoryboard","doFulfilStoryboard","_window$APP_ROOT","_window$APP_ROOT2","_hooks$auth","_watermarkConfig$flag","_watermarkConfig$flag2","isDeveloper","username","getAuth","watermarkConfig","defaultProps","zIndex","font","fontSize","gap","setWatermark","appChanged","prevRendererContext","main","cleanUpPreviousRender","reset","_hooks$flowApi2","_storyboard$meta2","preCheckInstalledApps","menuConfs","navConfig","breadcrumb","overwrite","items","mergeMenuConfs","isCurrentBootstrap","isReCatch","noAuthGuardLoginPath","brand","getBrandSettings","preCheckPermissions","collectContract","rootMenuRequestNode","mergedRoutes","specificTemplatePreviewIndex","findLastIndex","specificSnippetPreviewIndex","insertPreviewRoutes","scrollTo","pageTitle","injectedBrickPackages","BRICK_PACKAGES","applyColorTheme","getStyleByBrandColor","getStyleByBaseColors","backgroundColor","getStyleByVariables","router","processedBrickPackages","active","panel","moment","on","Runtime","Reflect","getRuntimeV2Factory","_initialized","_bootstrapped","_data$settings","deepFreeze","normalizeBootstrapData","notification","dialog","loadNotificationService","loader","loadDialogService","brandColor","baseColors","variables","customizeColorTheme","_router","_router2","_bootstrapData","_router3","featureFlags","_bootstrapData2","_router4","_bootstrapData3","base_title","getLaunchpadSettings","_bootstrapData4","columns","rows","launchpad","getDesktops","_bootstrapData5","desktops","getLaunchpadSiteMap","_bootstrapData6","siteSort","toggleLaunchpadEffect","toggle","applyPageTitle","_router5","baseTitle","localeTitle","_router6","_bootstrapData7","pubDeps","bricksMap","pkgName","processPublicDepsPackages","STANDALONE_BRICK_PACKAGES","PUBLIC_DEPS","_bootstrapData8","presetBricks","_router7","_router8","_bootstrapData10","_internalApiGetStoryb","authenticate","_hooks$auth$authentic","_hooks$auth2","logout","_hooks$auth3","_hooks$auth3$logout","_hooks$auth4","customEditors","editorName","editorFunc","fetchByProvider","_portal","position","height","clearI18nBundles","unmounted","previousRendererContext","urlObj","_clearI18nBundles","demoStoryboard","unmount","getRealValue","useRealTimeQuery","providedGlobalVariables","mock","supplyIndividual","shouldOmitInLodash","shouldOmitInMoment","allowedGlobalObjects","lodash","tagUrlFactory","ignoreSlashes","strings","partials","str","createProviderClass","saveAs","filename","blob","createSSEStream","pushQueue","pullQueue","disposed","closed","converter","fetchOptions","earlyDone","fetchEventSource","openWhenHidden","onopen","onmessage","reason","defaultConverter","onclose","throw","asyncIterator","_value","propNames","unwrapProvider","beforeVisitGlobalMember","usage","objectName","level","rememberObjectName","segments","memberParent","memberNode","collectMemberCallUsageFactory","callParent","firstArg","traverseStoryboardExpressions","matchExpressionString","visitNotMatchedExpressionString","visitNonExpressionString","visitObject","traverse","nonStaticUsage","TRACK_NAMES","trackText","trackCtxExp","keyMap","CTX","STATE","FORM_STATE","traverseStoryboardFunctions","matchSource","traverseStoryboardFunction","silentErrors","PERMISSIONS","scanPermissionActionsInStoryboard","collection","beforeVisitPermissions","beforeVisitPermissionsFactory","scanPermissionActionsInAny"],"sourceRoot":""}