{"version":3,"file":"core.991b57bb.js","mappings":"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","sources":["webpack:///./src/bootstrap.ts","webpack:///../../src/ExecutionContext.ts","webpack:///../../src/traverse.ts","webpack:///../../src/context-free.ts","webpack:///../../src/sanitize.ts","webpack:///../../src/cook.ts","webpack:///../../src/AnalysisContext.ts","webpack:///../../src/precook.ts","webpack:///../../src/hasOwnProperty.ts","webpack:///../../src/precookFunction.ts","webpack:///../../src/parse.ts","webpack:///../../src/preevaluate.ts","webpack:///../../src/fetch.ts","webpack:///../../src/errors.ts","webpack:///../../src/InterceptorManager.ts","webpack:///../../src/http.ts","webpack:///../../src/index.ts","webpack:///../../src/init.ts","webpack:///../../src/text.ts","webpack:///../../src/interfaces.ts","webpack:///../../src/lexical.ts","webpack:///../../src/compile.ts","webpack:///../../src/syntax.ts","webpack:///../../src/loadScriptOrStyle.ts","webpack:///../../src/loadScript.ts","webpack:///../../src/loadStyle.ts","webpack:///../../src/stableLoadBricks.ts","webpack:///../../src/loadSharedModule.ts","webpack:///../../src/getBasePath.ts","webpack:///../../../src/internal/matchStoryboard.ts","webpack:///../../src/history.ts","webpack:///../../../src/internal/historyExtended.ts","webpack:///../../src/getV2RuntimeFromDll.ts","webpack:///../../../src/internal/Runtime.ts","webpack:///../../src/CustomProcessors.ts","webpack:///../../../src/internal/registerAppI18n.ts","webpack:///../../../../src/internal/compute/WidgetI18n.ts","webpack:///../../../src/internal/devtools.ts","webpack:///../../../src/internal/proxyFactories.ts","webpack:///../../src/themeAndMode.ts","webpack:///../../../../src/internal/compute/getGeneralGlobals.ts","webpack:///../../src/StoryboardFunctionRegistry.ts","webpack:///../../../../src/internal/compute/StoryboardFunctions.ts","webpack:///../../../src/internal/mediaQuery.ts","webpack:///../../../../src/internal/compute/getStorageItem.ts","webpack:///../../src/isStrictMode.ts","webpack:///../../src/CustomTemplates.ts","webpack:///../../../../src/internal/CustomTemplates/utils.ts","webpack:///../../../../src/internal/compute/WidgetFunctions.ts","webpack:///../../../src/internal/hasInstalledApp.ts","webpack:///../../../../src/internal/FormRenderer/utils.ts","webpack:///../../../../src/internal/data/getProviderBrick.ts","webpack:///../../../../src/internal/compute/markAsComputed.ts","webpack:///../../../../src/internal/data/resolveData.ts","webpack:///../../../../src/internal/compute/evaluate.ts","webpack:///../../../../src/internal/compute/getNextStateOfUseBrick.ts","webpack:///../../../../src/internal/compute/computeRealValue.ts","webpack:///../../../../src/internal/compute/checkIf.ts","webpack:///../../../../src/internal/compute/getTracks.ts","webpack:///../../../../src/internal/compute/computeRealProperties.ts","webpack:///../../../../src/internal/compute/setRealProperties.ts","webpack:///../../../../src/internal/compute/setProperties.ts","webpack:///../../../src/internal/matchPath.ts","webpack:///../../../src/internal/matchRoutes.ts","webpack:///../../../../src/internal/CustomTemplates/constants.ts","webpack:///../../src/Dialog.ts","webpack:///../../../src/internal/poll.ts","webpack:///../../../src/internal/i18n.ts","webpack:///../../src/setLoginStateCookie.ts","webpack:///../../src/handleHttpError.ts","webpack:///../../src/Notification.ts","webpack:///../../../src/internal/bindListeners.ts","webpack:///../../../../src/internal/data/DataStore.ts","webpack:///../../../../src/internal/data/resolveDataStore.ts","webpack:///../../../../src/internal/CustomTemplates/setupTemplateProxy.ts","webpack:///../../../../src/internal/CustomTemplates/setupUseBrickInTemplate.ts","webpack:///../../../../src/internal/CustomTemplates/expandCustomTemplate.ts","webpack:///../../../src/internal/enums.ts","webpack:///../../../../src/internal/FormRenderer/constants.ts","webpack:///../../../../src/internal/FormRenderer/expandFormRenderer.ts","webpack:///../../../../src/internal/FormRenderer/getDefaultProperties.ts","webpack:///../../../src/internal/Renderer.ts","webpack:///../../../../src/internal/compute/listenOnTrackingContext.ts","webpack:///../../../../src/internal/CustomTemplates/bindTemplateProxy.ts","webpack:///../../../src/internal/mount.ts","webpack:///../../../src/internal/RendererContext.ts","webpack:///../../src/getPageInfo.ts","webpack:///../../../src/internal/abortController.ts","webpack:///../../../src/internal/registerCustomTemplates.ts","webpack:///../../../src/internal/fulfilStoryboard.ts","webpack:///../../src/setUIVersion.ts","webpack:///../../../src/internal/Router.ts","webpack:///../../../src/internal/insertPreviewRoutes.ts","webpack:///../../../src/internal/injected.ts","webpack:///../../../src/internal/customizeColorTheme.ts","webpack:///../../src/auth.ts","webpack:///../../src/fetchByProvider.ts","webpack:///../../src/createRoot.ts","webpack:///../../../src/internal/secret_internals.ts","webpack:///../../../src/general/createProviderClass.ts","webpack:///../../../src/general/deepFreeze.ts","webpack:///../../../src/general/hasOwnProperty.ts","webpack:///../../../src/general/isObject.ts","webpack:///../../../src/general/JsonStorage.ts","webpack:///../../../src/general/unwrapProvider.ts","webpack:///../../../../src/storyboard/expressions/beforeVisitGlobalMember.ts","webpack:///../../../../src/storyboard/expressions/collectMemberCallUsage.ts","webpack:///../../../../src/storyboard/expressions/traverse.ts","webpack:///../../../../src/storyboard/expressions/collectMemberUsage.ts","webpack:///../../../../src/storyboard/expressions/track.ts","webpack:///../../../../src/storyboard/functions/traverse.ts","webpack:///../../../../src/storyboard/functions/collectMemberUsageInFunction.ts","webpack:///../../../src/storyboard/permissions.ts"],"sourcesContent":["import {\n  createRuntime,\n  applyTheme,\n  setUIVersion,\n  unstable_createRoot,\n} from \"@next-core/runtime\";\nimport { http, HttpRequestConfig } from \"@next-core/http\";\nimport type { BootstrapData, CustomTemplate } from \"@next-core/types\";\nimport { safeLoad, JSON_SCHEMA } from \"js-yaml\";\nimport \"@next-core/theme\";\nimport type {\n  RenderType,\n  Sources,\n  RenderOptions,\n  PreviewWindow,\n} from \"../types.d.ts\";\nimport { get } from \"lodash\";\n\ninterface RenderRequest {\n  type: RenderType;\n  sources: Sources;\n  options?: RenderOptions;\n}\n\nhttp.interceptors.request.use((config) => {\n  dispatchRequestEventByConfig(\"request.start\", config);\n  return config;\n});\n\nhttp.interceptors.response.use(\n  function (response, config) {\n    dispatchRequestEventByConfig(\"request.end\", config);\n    return response;\n  },\n  function (error, config) {\n    dispatchRequestEventByConfig(\"request.end\", config);\n    return Promise.reject(error);\n  }\n);\n\nfunction dispatchRequestEventByConfig(type: string, config: HttpRequestConfig) {\n  if (!config.options?.interceptorParams?.ignoreLoadingBar) {\n    window.dispatchEvent(new Event(type));\n  }\n}\n\nconst loadingBar = document.querySelector(\"#global-loading-bar\");\nloadingBar.classList.add(\"rendered\");\n\nlet loading = false;\nlet count = 0;\nfunction updateLoadingStatus() {\n  const hasRemainingRequests = count > 0;\n  if (hasRemainingRequests !== loading) {\n    loading = hasRemainingRequests;\n    loadingBar.classList[hasRemainingRequests ? \"add\" : \"remove\"](\"loading\");\n  }\n}\nconst requestStart = (): void => {\n  count++;\n  updateLoadingStatus();\n};\nconst requestEnd = (): void => {\n  // 兼容 loading bar 在某些请求开始和结束之间初始化时，`count` 可能小于 0 的情况\n  if (count > 0) {\n    count--;\n    updateLoadingStatus();\n  }\n};\nwindow.addEventListener(\"request.start\", requestStart);\nwindow.addEventListener(\"request.end\", requestEnd);\n\nconst runtime = createRuntime();\n\nconst container = document.querySelector(\"#preview-root\") as HTMLElement;\nconst portal = document.querySelector(\"#portal-mount-point\") as HTMLElement;\nconst root = unstable_createRoot(container, {\n  portal,\n  scope: \"page\",\n  unknownBricks: \"silent\",\n});\n\nconst bootstrap = http\n  .get<any>(window.BOOTSTRAP_FILE, {\n    responseType: \"json\",\n  })\n  .then((data) => {\n    runtime.initialize(\n      (window.BOOTSTRAP_FILE_FIELD\n        ? get(data, window.BOOTSTRAP_FILE_FIELD)\n        : data) as BootstrapData\n    );\n  });\n\nlet rendering = false;\nlet nextRequest: RenderRequest;\n\n(window as unknown as PreviewWindow)._preview_only_render = (\n  type,\n  sources,\n  options\n) => {\n  if (rendering) {\n    nextRequest = { type, sources, options };\n  } else {\n    queuedRender({ type, sources, options });\n  }\n};\n\nasync function queuedRender(request: RenderRequest) {\n  rendering = true;\n  try {\n    const { type, sources, options } = request;\n    // Assert: `render()` will not throw\n    await render(type, sources, options);\n  } finally {\n    rendering = false;\n    if (nextRequest) {\n      const req = nextRequest;\n      nextRequest = undefined;\n      queuedRender(req);\n    }\n  }\n}\n\nlet initialized = false;\n\nasync function render(\n  type: \"html\" | \"yaml\",\n  { yaml, html }: Sources,\n  {\n    theme,\n    uiVersion,\n    context,\n    functions,\n    templates,\n    i18n,\n    styleText,\n    templatesAreArrayOfYaml,\n  }: RenderOptions = {}\n): Promise<void> {\n  try {\n    if (!initialized) {\n      initialized = true;\n      document.body.classList.add(\"bootstrap-ready\");\n      applyTheme(theme === \"light\" ? theme : \"dark-v2\");\n    }\n    document.body.classList.remove(\"bootstrap-error\");\n    if (type === \"html\") {\n      applyTheme(theme === \"light\" ? theme : \"dark-v2\");\n      setUIVersion(uiVersion);\n      // Note: if use DOMParser, script tags will not be executed, while using\n      const parser = new DOMParser();\n      const dom = parser.parseFromString(html, \"text/html\");\n      const bricks = new Set<string>();\n      for (const node of dom.body.querySelectorAll(\"*\")) {\n        if (node.tagName.includes(\"-\")) {\n          const lowerTagName = node.tagName.toLowerCase();\n          bricks.add(lowerTagName);\n        } else if (node.tagName === \"SCRIPT\") {\n          const bricksInScript = (node as HTMLScriptElement).text.matchAll(\n            /\\bdocument\\.createElement\\(\\s*\"([a-zA-Z0-9.]+-[-a-zA-Z0-9.]+)\"\\s*\\)/g\n          );\n          for (const match of bricksInScript) {\n            bricks.add(match[1]);\n          }\n        }\n      }\n\n      await bootstrap;\n\n      await runtime.loadBricks(bricks);\n      container.replaceChildren();\n      portal.replaceChildren();\n      const scripts: HTMLScriptElement[] = [];\n      const scriptTags = dom.querySelectorAll(\"script\");\n      for (const scriptTag of scriptTags) {\n        const newScriptTag = document.createElement(\"script\");\n        newScriptTag.text = scriptTag.text;\n        newScriptTag.type = \"module\";\n        scripts.push(newScriptTag);\n        scriptTag.remove();\n      }\n      container.append(\n        ...dom.head.querySelectorAll(\"style\"),\n        ...dom.body.childNodes,\n        ...scripts\n      );\n    } else {\n      const parsed = yaml\n        ? (safeLoad(yaml, { schema: JSON_SCHEMA, json: true }) as any)\n        : null;\n      const bricks = [].concat(parsed ?? []);\n      if (styleText) {\n        bricks.push({\n          brick: \"style\",\n          portal: true,\n          properties: {\n            textContent: styleText,\n          },\n        });\n      }\n\n      const parsedContext = loadYaml(context) as any[];\n      const parsedFunctions = loadYaml(functions) as any[];\n      const parsedTemplates = loadYaml(\n        templates,\n        templatesAreArrayOfYaml\n      ) as any[];\n      const parsedI18n = loadYaml(i18n) as any;\n\n      await bootstrap;\n      await root.render(bricks, {\n        theme: theme === \"light\" ? theme : \"dark-v2\",\n        uiVersion,\n        context: parsedContext,\n        functions: parsedFunctions,\n        templates: parsedTemplates,\n        i18n: parsedI18n,\n      });\n    }\n  } catch (e) {\n    // eslint-disable-next-line no-console\n    console.error(\"Render failed:\", e);\n\n    // `.bootstrap-error` makes loading-bar invisible.\n    document.body.classList.add(\"bootstrap-error\");\n\n    portal.textContent = \"\";\n    container.textContent = `Render failed: ${String(e)}`;\n  }\n}\n\ninterface YamlTemplate {\n  name: string;\n  yaml: string;\n}\n\nfunction loadYaml(content: unknown, templatesAreArrayOfYaml?: boolean) {\n  return typeof content === \"string\"\n    ? safeLoad(content, { schema: JSON_SCHEMA, json: true })\n    : templatesAreArrayOfYaml\n    ? (content as YamlTemplate[]).map((item) =>\n        typeof item.yaml === \"string\"\n          ? {\n              ...(safeLoad(item.yaml, {\n                schema: JSON_SCHEMA,\n                json: true,\n              }) as CustomTemplate),\n              name: item.name,\n            }\n          : item\n      )\n    : content;\n}\n","import {\n  ArrowFunctionExpression,\n  Expression,\n  FunctionDeclaration,\n  FunctionExpression,\n  Statement,\n} from \"@babel/types\";\n\n// https://tc39.es/ecma262/#sec-execution-contexts\nexport class ExecutionContext {\n  VariableEnvironment?: EnvironmentRecord;\n  LexicalEnvironment?: EnvironmentRecord;\n  Function?: FunctionObject;\n}\n\nexport type EnvironmentRecordType = \"function\" | \"declarative\";\n\n// https://tc39.es/ecma262/#sec-environment-records\nexport class EnvironmentRecord {\n  readonly OuterEnv: EnvironmentRecord | null | undefined;\n  private readonly bindingMap = new Map<string, BindingState>();\n\n  constructor(outer: EnvironmentRecord | null | undefined) {\n    this.OuterEnv = outer;\n  }\n\n  HasBinding(name: string): boolean {\n    return this.bindingMap.has(name);\n  }\n\n  CreateMutableBinding(name: string, deletable: boolean): CompletionRecord {\n    // Assert: binding does not exist.\n    this.bindingMap.set(name, {\n      mutable: true,\n      deletable,\n    });\n    return NormalCompletion(undefined);\n  }\n\n  /**\n   * Create an immutable binding.\n   *\n   * @param name - The binding name.\n   * @param strict - For named function expressions, strict is false, otherwise it's true.\n   * @returns CompletionRecord.\n   */\n  CreateImmutableBinding(name: string, strict: boolean): CompletionRecord {\n    // Assert: binding does not exist.\n    this.bindingMap.set(name, {\n      strict,\n    });\n    return NormalCompletion(undefined);\n  }\n\n  InitializeBinding(name: string, value: unknown): CompletionRecord {\n    const binding = this.bindingMap.get(name) as BindingState;\n    // Assert: binding exists and uninitialized.\n    Object.assign<BindingState, Partial<BindingState>>(binding, {\n      initialized: true,\n      value,\n    });\n    return NormalCompletion(undefined);\n  }\n\n  /**\n   * Update a mutable binding value, including function declarations.\n   *\n   * @param name - The binding name.\n   * @param value - The binding value.\n   * @param strict - For functions, strict is always false, otherwise it depends on strict-mode.\n   * @returns\n   */\n  SetMutableBinding(\n    name: string,\n    value: unknown,\n    strict?: boolean\n  ): CompletionRecord {\n    const binding = this.bindingMap.get(name) as BindingState;\n    // Assert: binding exists.\n    if (!binding.initialized) {\n      throw new ReferenceError(`${name} is not initialized`);\n    } else if (binding.mutable) {\n      binding.value = value;\n    } else {\n      throw new TypeError(`Assignment to constant variable`);\n    }\n    return NormalCompletion(undefined);\n  }\n\n  GetBindingValue(name: string, strict?: boolean): unknown {\n    const binding = this.bindingMap.get(name) as BindingState;\n    // Assert: binding exists.\n    if (!binding.initialized) {\n      throw new ReferenceError(`${name} is not initialized`);\n    }\n    return binding.value;\n  }\n}\n\nexport class DeclarativeEnvironment extends EnvironmentRecord {}\n\nexport class FunctionEnvironment extends EnvironmentRecord {}\n\nexport interface BindingState {\n  initialized?: boolean;\n  value?: unknown;\n  mutable?: boolean;\n\n  /** This is used for mutable bindings only. */\n  deletable?: boolean;\n\n  /**\n   * This is used for immutable bindings only.\n   * For named function expressions, `strict` is false,\n   * otherwise it's true.\n   */\n  strict?: boolean;\n}\n\nexport const SourceNode = Symbol.for(\"SourceNode\");\nexport const FormalParameters = Symbol.for(\"FormalParameters\");\nexport const ECMAScriptCode = Symbol.for(\"ECMAScriptCode\");\nexport const Environment = Symbol.for(\"Environment\");\nexport const IsConstructor = Symbol.for(\"IsConstructor\");\n\nexport interface FunctionObject {\n  (...args: unknown[]): unknown;\n  [SourceNode]:\n    | FunctionDeclaration\n    | FunctionExpression\n    | ArrowFunctionExpression;\n  [FormalParameters]: FunctionDeclaration[\"params\"];\n  [ECMAScriptCode]: Statement[] | Expression;\n  [Environment]: EnvironmentRecord;\n  [IsConstructor]: boolean;\n}\n\n// https://tc39.es/ecma262/#sec-reference-record-specification-type\nexport class ReferenceRecord {\n  readonly Base:\n    | Record<PropertyKey, unknown>\n    | EnvironmentRecord\n    | \"unresolvable\";\n  readonly ReferenceName: PropertyKey;\n  /** Whether the reference is in strict mode. */\n  readonly Strict?: boolean;\n\n  constructor(\n    base: Record<PropertyKey, unknown> | EnvironmentRecord | \"unresolvable\",\n    referenceName: PropertyKey,\n    strict: boolean\n  ) {\n    this.Base = base;\n    this.ReferenceName = referenceName;\n    this.Strict = strict;\n  }\n}\n\n// https://tc39.es/ecma262/#sec-completion-record-specification-type\nexport class CompletionRecord {\n  readonly Type: CompletionRecordType;\n  readonly Value: unknown;\n\n  constructor(type: CompletionRecordType, value: unknown) {\n    this.Type = type;\n    this.Value = value;\n  }\n}\n\nexport type CompletionRecordType =\n  | \"normal\"\n  | \"break\"\n  | \"continue\"\n  | \"return\"\n  | \"throw\";\n\n// https://tc39.es/ecma262/#sec-normalcompletion\nexport function NormalCompletion(value: unknown): CompletionRecord {\n  return new CompletionRecord(\"normal\", value);\n}\n\nexport const Empty = Symbol(\"empty completion\");\n\nexport interface OptionalChainRef {\n  skipped?: boolean;\n}\n","import { FunctionDeclaration, VariableDeclaration } from \"@babel/types\";\nimport { EstreeNode, NodeWithBoundNames } from \"./interfaces.js\";\n\ntype InternalCollect<T = void, O = unknown> = (\n  node: EstreeNode | null | undefined | (EstreeNode | null)[],\n  options?: O\n) => T;\ntype InternalCollectWithOptions<T = void, O = unknown> = (\n  node: EstreeNode | null | undefined | (EstreeNode | null)[],\n  options: O\n) => T;\n\nexport function collectBoundNames(\n  root: NodeWithBoundNames | NodeWithBoundNames[] | null | undefined\n): string[] {\n  const names = new Set<string>();\n  const collect: InternalCollect = (node) => {\n    if (Array.isArray(node)) {\n      for (const n of node) {\n        collect(n);\n      }\n    } else if (node) {\n      // `node` maybe `null` in some cases.\n      switch (node.type) {\n        case \"Identifier\":\n          names.add(node.name);\n          return;\n        case \"VariableDeclaration\":\n          return collect(node.declarations);\n        case \"VariableDeclarator\":\n          return collect(node.id);\n        case \"ArrayPattern\":\n          return collect(node.elements);\n        case \"AssignmentPattern\":\n          return collect(node.left);\n        case \"ObjectPattern\":\n          return collect(node.properties);\n        case \"Property\":\n          return collect(node.value);\n        case \"RestElement\":\n          return collect(node.argument);\n        case \"FunctionDeclaration\":\n          return collect(node.id);\n      }\n    }\n  };\n  collect(root);\n  return Array.from(names);\n}\n\nexport function containsExpression(\n  root: EstreeNode | EstreeNode[]\n): boolean | undefined {\n  const collect: InternalCollect<boolean | undefined> = (node) => {\n    if (Array.isArray(node)) {\n      return node.some(collect);\n    } else if (node) {\n      // `node` maybe `null` in some cases.\n      switch (node.type) {\n        case \"ArrayPattern\":\n          return collect(node.elements);\n        case \"AssignmentPattern\":\n          return true;\n        case \"ObjectPattern\":\n          return collect(node.properties);\n        case \"Property\":\n          return node.computed || collect(node.value);\n        case \"RestElement\":\n          return collect(node.argument);\n      }\n    }\n  };\n  return collect(root);\n}\n\ninterface ScopedDeclarationOptions {\n  var?: boolean;\n  topLevel?: boolean;\n}\n\ntype ScopedDeclaration = VariableDeclaration | FunctionDeclaration;\n\nexport function collectScopedDeclarations(\n  root: EstreeNode | EstreeNode[],\n  options: ScopedDeclarationOptions\n): ScopedDeclaration[] {\n  const declarations: ScopedDeclaration[] = [];\n  const nextOptions = { var: options.var };\n  const collect: InternalCollectWithOptions<void, ScopedDeclarationOptions> = (\n    node,\n    options\n  ): void => {\n    if (Array.isArray(node)) {\n      for (const n of node) {\n        collect(n, options);\n      }\n    } else if (node) {\n      // `node` maybe `null` in some cases.\n      switch (node.type) {\n        case \"FunctionDeclaration\":\n          // At the top level of a function, or script, function declarations are\n          // treated like var declarations rather than like lexical declarations.\n          // See https://tc39.es/ecma262/#sec-static-semantics-toplevellexicallydeclarednames\n          if (Number(!options.var) ^ Number(options.topLevel)) {\n            declarations.push(node);\n          }\n          return;\n        case \"VariableDeclaration\":\n          if (Number(!options.var) ^ Number(node.kind === \"var\")) {\n            declarations.push(node);\n          }\n          return;\n        case \"SwitchCase\":\n          collect(node.consequent, nextOptions);\n          return;\n        case \"CatchClause\":\n          collect(node.body, nextOptions);\n          return;\n      }\n      if (options.var) {\n        switch (node.type) {\n          case \"BlockStatement\":\n            collect(node.body, nextOptions);\n            return;\n          case \"IfStatement\":\n            collect(node.consequent, nextOptions);\n            collect(node.alternate, nextOptions);\n            return;\n          case \"DoWhileStatement\":\n          case \"WhileStatement\":\n            collect(node.body, nextOptions);\n            return;\n          case \"ForStatement\":\n            collect(node.init, nextOptions);\n            collect(node.body, nextOptions);\n            return;\n          case \"ForInStatement\":\n          case \"ForOfStatement\":\n            collect(node.left, nextOptions);\n            collect(node.body, nextOptions);\n            return;\n          case \"SwitchStatement\":\n            collect(node.cases, nextOptions);\n            return;\n          case \"TryStatement\":\n            collect(node.block, nextOptions);\n            collect(node.handler, nextOptions);\n            collect(node.finalizer, nextOptions);\n            return;\n        }\n      }\n    }\n  };\n  collect(root, options);\n  return declarations;\n}\n","import {\n  BinaryExpression,\n  UnaryExpression,\n  VariableDeclaration,\n} from \"@babel/types\";\nimport {\n  CompletionRecord,\n  Empty,\n  EnvironmentRecord,\n  NormalCompletion,\n  ReferenceRecord,\n} from \"./ExecutionContext.js\";\nimport { collectBoundNames } from \"./traverse.js\";\n\n// https://tc39.es/ecma262/#sec-ispropertyreference\nexport function IsPropertyReference(V: ReferenceRecord): boolean {\n  return V.Base !== \"unresolvable\" && !(V.Base instanceof EnvironmentRecord);\n}\n\n// https://tc39.es/ecma262/#sec-initializereferencedbinding\nexport function InitializeReferencedBinding(\n  V: ReferenceRecord,\n  W: unknown\n): CompletionRecord {\n  const base = V.Base as EnvironmentRecord;\n  return base.InitializeBinding(V.ReferenceName as string, W);\n}\n\n// https://tc39.es/ecma262/#sec-copydataproperties\nexport function CopyDataProperties(\n  target: Record<PropertyKey, unknown>,\n  source: unknown,\n  excludedItems: Set<PropertyKey>\n): Record<PropertyKey, unknown> {\n  if (source === undefined || source === null) {\n    return target;\n  }\n  const keys = (Object.getOwnPropertyNames(source) as PropertyKey[]).concat(\n    Object.getOwnPropertySymbols(source)\n  );\n  for (const nextKey of keys) {\n    if (!excludedItems.has(nextKey)) {\n      const desc = Object.getOwnPropertyDescriptor(source, nextKey);\n      if (desc?.enumerable) {\n        target[nextKey] = (source as Record<PropertyKey, unknown>)[nextKey];\n      }\n    }\n  }\n  return target;\n}\n\n// https://tc39.es/ecma262/#sec-runtime-semantics-fordeclarationbindinginstantiation\nexport function ForDeclarationBindingInstantiation(\n  forDeclaration: VariableDeclaration,\n  env: EnvironmentRecord\n): void {\n  const isConst = forDeclaration.kind === \"const\";\n  for (const name of collectBoundNames(forDeclaration)) {\n    if (isConst) {\n      env.CreateImmutableBinding(name, true);\n    } else {\n      env.CreateMutableBinding(name, false);\n    }\n  }\n}\n\n// https://tc39.es/ecma262/#sec-loopcontinues\nexport function LoopContinues(completion: CompletionRecord): boolean {\n  return completion.Type === \"normal\" || completion.Type == \"continue\";\n}\n\n// https://tc39.es/ecma262/#sec-updateempty\nexport function UpdateEmpty(\n  completion: CompletionRecord,\n  value: unknown\n): CompletionRecord {\n  if (completion.Value !== Empty) {\n    return completion;\n  }\n  return new CompletionRecord(completion.Type, value);\n}\n\n// https://tc39.es/ecma262/#sec-getvalue\nexport function GetValue(V: unknown): unknown {\n  if (V instanceof CompletionRecord) {\n    // Assert: V.Type is normal.\n    V = V.Value;\n  }\n  if (!(V instanceof ReferenceRecord)) {\n    return V;\n  }\n  if (V.Base === \"unresolvable\") {\n    throw new ReferenceError(`${V.ReferenceName as string} is not defined`);\n  }\n  if (V.Base instanceof EnvironmentRecord) {\n    const base = V.Base as EnvironmentRecord;\n    return base.GetBindingValue(V.ReferenceName as string, V.Strict);\n  }\n  return V.Base[V.ReferenceName];\n}\n\n// https://tc39.es/ecma262/#sec-topropertykey\nexport function ToPropertyKey(arg: unknown): string | symbol {\n  if (typeof arg === \"symbol\") {\n    return arg;\n  }\n  return String(arg);\n}\n\n// https://tc39.es/ecma262/#sec-getv\nexport function GetV(V: unknown, P: PropertyKey): unknown {\n  return (V as Record<PropertyKey, unknown>)[P];\n}\n\n// https://tc39.es/ecma262/#sec-putvalue\nexport function PutValue(V: ReferenceRecord, W: unknown): CompletionRecord {\n  // Assert: V is a ReferenceRecord.\n  if (V.Base === \"unresolvable\") {\n    throw new ReferenceError(`${V.ReferenceName as string} is not defined`);\n  }\n  if (V.Base instanceof EnvironmentRecord) {\n    return V.Base.SetMutableBinding(V.ReferenceName as string, W, V.Strict);\n  }\n  V.Base[V.ReferenceName] = W;\n  return NormalCompletion(undefined);\n}\n\n// https://tc39.es/ecma262/#sec-createlistiteratorRecord\nexport function CreateListIteratorRecord(\n  args: Iterable<unknown>\n): Iterator<unknown> {\n  if (!isIterable(args)) {\n    throw new TypeError(`${typeof args} is not iterable`);\n  }\n  return args[Symbol.iterator]();\n}\n\n// https://tc39.es/ecma262/#sec-requireobjectcoercible\nexport function RequireObjectCoercible(arg: unknown): void {\n  if (arg === null || arg === undefined) {\n    throw new TypeError(\"Cannot destructure properties of undefined or null\");\n  }\n}\n\n// https://tc39.es/ecma262/#sec-getidentifierreference\nexport function GetIdentifierReference(\n  env: EnvironmentRecord | null | undefined,\n  name: string,\n  strict: boolean\n): ReferenceRecord {\n  if (!env) {\n    return new ReferenceRecord(\"unresolvable\", name, strict);\n  }\n  if (env.HasBinding(name)) {\n    return new ReferenceRecord(env, name, strict);\n  }\n  return GetIdentifierReference(env.OuterEnv, name, strict);\n}\n\n// https://tc39.es/ecma262/#sec-applystringornumericbinaryoperator\nexport function ApplyStringOrNumericBinaryOperator(\n  leftValue: number,\n  operator: BinaryExpression[\"operator\"] | \"|>\",\n  rightValue: number\n): unknown {\n  switch (operator) {\n    case \"+\":\n      return leftValue + rightValue;\n    case \"-\":\n      return leftValue - rightValue;\n    case \"/\":\n      return leftValue / rightValue;\n    case \"%\":\n      return leftValue % rightValue;\n    case \"*\":\n      return leftValue * rightValue;\n    case \"**\":\n      return leftValue ** rightValue;\n    case \"==\":\n      return leftValue == rightValue;\n    case \"===\":\n      return leftValue === rightValue;\n    case \"!=\":\n      return leftValue != rightValue;\n    case \"!==\":\n      return leftValue !== rightValue;\n    case \">\":\n      return leftValue > rightValue;\n    case \"<\":\n      return leftValue < rightValue;\n    case \">=\":\n      return leftValue >= rightValue;\n    case \"<=\":\n      return leftValue <= rightValue;\n  }\n  throw new SyntaxError(`Unsupported binary operator \\`${operator}\\``);\n}\n\n// https://tc39.es/ecma262/#sec-assignment-operators\nexport function ApplyStringOrNumericAssignment(\n  leftValue: string | number,\n  operator: string,\n  rightValue: string | number\n): unknown {\n  switch (operator) {\n    case \"+=\":\n    case \"-=\":\n    case \"*=\":\n    case \"/=\":\n    case \"%=\":\n    case \"**=\":\n      return ApplyStringOrNumericBinaryOperator(\n        leftValue as number,\n        operator.substr(0, operator.length - 1) as BinaryExpression[\"operator\"],\n        rightValue as number\n      );\n  }\n\n  throw new SyntaxError(`Unsupported assignment operator \\`${operator}\\``);\n}\n\n// https://tc39.es/ecma262/#sec-unary-operators\nexport function ApplyUnaryOperator(\n  target: unknown,\n  operator: UnaryExpression[\"operator\"]\n): unknown {\n  switch (operator) {\n    case \"!\":\n      return !target;\n    case \"+\":\n      return +(target as string | number);\n    case \"-\":\n      return -(target as string | number);\n    case \"void\":\n      return undefined;\n  }\n  throw new SyntaxError(`Unsupported unary operator \\`${operator}\\``);\n}\n\nexport function isIterable(cooked: unknown): boolean {\n  if (Array.isArray(cooked)) {\n    return true;\n  }\n  if (cooked === null || cooked === undefined) {\n    return false;\n  }\n  return typeof (cooked as Iterable<unknown>)[Symbol.iterator] === \"function\";\n}\n","// Ref https://github.com/tc39/proposal-global\n// In addition, the es6-shim had to switch from Function('return this')()\n// due to CSP concerns, such that the current check to handle browsers,\n// node, web workers, and frames is:\n// istanbul ignore next\n// eslint-disable-next-line @typescript-eslint/ban-types\nfunction getGlobal(): object {\n  // the only reliable means to get the global object is\n  // `Function('return this')()`\n  // However, this causes CSP violations in Chrome apps.\n  if (typeof self !== \"undefined\") {\n    return self;\n  }\n  if (typeof window !== \"undefined\") {\n    return window;\n  }\n  if (typeof global !== \"undefined\") {\n    return global;\n  }\n  throw new Error(\"unable to locate global object\");\n}\n\n/**\n * There are chances to construct a `Function` from a string, etc.\n * ```\n * ((a,b)=>a[b])(()=>1, 'constructor')('console.log(`yo`)')()\n * ```\n */\nconst reservedObjects = new WeakSet([\n  // `Function(\"...\")` is considered *extremely vulnerable*.\n  Function,\n  // `Object.assign()` is considered vulnerable.\n  Object,\n  // `prototype` is considered vulnerable.\n  Function.prototype,\n  Object.prototype,\n  // Global `window` is considered vulnerable, too.\n  getGlobal(),\n]);\n\nexport function sanitize(cooked: unknown): void {\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  if (reservedObjects.has(cooked as object)) {\n    throw new TypeError(\"Cannot access reserved objects such as `Function`.\");\n  }\n}\n\nconst allowedConstructors = new WeakSet([\n  Array,\n  Map,\n  Set,\n  URLSearchParams,\n  WeakMap,\n  WeakSet,\n  RegExp,\n]);\n\nexport function isAllowedConstructor(constructor: unknown): boolean {\n  // `Date` maybe mocked when running tests for storyboard functions.\n  return (\n    allowedConstructors.has(constructor as ArrayConstructor) ||\n    constructor === Date\n  );\n}\n","import {\n  ArrayPattern,\n  ArrowFunctionExpression,\n  CallExpression,\n  CatchClause,\n  DoWhileStatement,\n  Expression,\n  ForInStatement,\n  ForOfStatement,\n  ForStatement,\n  FunctionDeclaration,\n  FunctionExpression,\n  Identifier,\n  LVal,\n  NewExpression,\n  ObjectPattern,\n  PatternLike,\n  RestElement,\n  Statement,\n  SwitchCase,\n  TemplateLiteral,\n  VariableDeclaration,\n  WhileStatement,\n} from \"@babel/types\";\nimport {\n  ApplyStringOrNumericAssignment,\n  CreateListIteratorRecord,\n  ApplyStringOrNumericBinaryOperator,\n  GetV,\n  GetValue,\n  InitializeReferencedBinding,\n  IsPropertyReference,\n  LoopContinues,\n  PutValue,\n  RequireObjectCoercible,\n  ToPropertyKey,\n  UpdateEmpty,\n  ApplyUnaryOperator,\n  GetIdentifierReference,\n  ForDeclarationBindingInstantiation,\n  CopyDataProperties,\n} from \"./context-free.js\";\nimport {\n  CompletionRecord,\n  DeclarativeEnvironment,\n  ECMAScriptCode,\n  Empty,\n  Environment,\n  EnvironmentRecord,\n  ExecutionContext,\n  FormalParameters,\n  FunctionEnvironment,\n  FunctionObject,\n  IsConstructor,\n  NormalCompletion,\n  OptionalChainRef,\n  ReferenceRecord,\n  SourceNode,\n} from \"./ExecutionContext.js\";\nimport {\n  EstreeLVal,\n  EstreeNode,\n  EstreeObjectExpression,\n  EstreeObjectPattern,\n  EstreeProperty,\n  CookRules,\n} from \"./interfaces.js\";\nimport { sanitize, isAllowedConstructor } from \"./sanitize.js\";\nimport {\n  collectBoundNames,\n  collectScopedDeclarations,\n  containsExpression,\n} from \"./traverse.js\";\n\nexport interface CookOptions {\n  rules?: CookRules;\n  globalVariables?: Record<string, unknown>;\n  hooks?: CookHooks;\n}\n\nexport interface CookHooks {\n  beforeEvaluate?(node: EstreeNode): void;\n  beforeCall?(node: EstreeNode): void;\n  beforeBranch?(node: EstreeNode, branch: \"if\" | \"else\"): void;\n}\n\n/** For next-core internal usage only. */\nexport function cook(\n  rootAst: FunctionDeclaration | Expression,\n  codeSource: string,\n  { rules, globalVariables = {}, hooks = {} }: CookOptions = {}\n): unknown {\n  const expressionOnly = rootAst.type !== \"FunctionDeclaration\";\n\n  const rootEnv = new DeclarativeEnvironment(null);\n  const rootContext = new ExecutionContext();\n  rootContext.VariableEnvironment = rootEnv;\n  rootContext.LexicalEnvironment = rootEnv;\n  const executionContextStack = [rootContext];\n\n  for (const [key, value] of Object.entries(globalVariables)) {\n    rootEnv.CreateImmutableBinding(key, true);\n    rootEnv.InitializeBinding(key, value);\n  }\n\n  const TemplateMap = new WeakMap<TemplateLiteral, string[]>();\n\n  // https://tc39.es/ecma262/#sec-gettemplateobject\n  function GetTemplateObject(templateLiteral: TemplateLiteral): string[] {\n    const memo = TemplateMap.get(templateLiteral);\n    if (memo) {\n      return memo;\n    }\n    const rawObj = templateLiteral.quasis.map((quasi) => quasi.value.raw);\n    const template = templateLiteral.quasis.map((quasi) => quasi.value.cooked!);\n    Object.freeze(rawObj);\n    Object.defineProperty(template, \"raw\", {\n      value: rawObj,\n      writable: false,\n      enumerable: false,\n      configurable: false,\n    });\n    Object.freeze(template);\n    TemplateMap.set(templateLiteral, template);\n    return template;\n  }\n\n  function Evaluate(\n    node: EstreeNode,\n    optionalChainRef?: OptionalChainRef\n  ): CompletionRecord {\n    hooks.beforeEvaluate?.(node);\n    // Expressions:\n    switch (node.type) {\n      case \"ArrayExpression\": {\n        // https://tc39.es/ecma262/#sec-array-initializer\n        const array = [];\n        for (const element of node.elements) {\n          if (!element) {\n            array.length += 1;\n          } else if (element.type === \"SpreadElement\") {\n            const spreadValues = GetValue(\n              Evaluate(element.argument)\n            ) as unknown[];\n            array.push(...spreadValues);\n          } else {\n            array.push(GetValue(Evaluate(element)));\n          }\n        }\n        return NormalCompletion(array);\n      }\n      case \"ArrowFunctionExpression\": {\n        // https://tc39.es/ecma262/#sec-arrow-function-definitions\n        ThrowIfFunctionIsInvalid(node);\n        const closure = InstantiateArrowFunctionExpression(node);\n        return NormalCompletion(closure);\n      }\n      case \"BinaryExpression\": {\n        const leftRef = Evaluate(node.left);\n        const leftValue = GetValue(leftRef);\n        const rightRef = Evaluate(node.right).Value;\n        const rightValue = GetValue(rightRef);\n        if (expressionOnly && (node.operator as unknown) === \"|>\") {\n          // Minimal pipeline operator is supported only in expression-only mode.\n          // See https://tc39.es/proposal-pipeline-operator\n          // and https://github.com/tc39/proposal-pipeline-operator\n          if (typeof rightValue !== \"function\") {\n            const funcName = codeSource.substring(\n              node.right.start!,\n              node.right.end!\n            );\n            throw new TypeError(`${funcName} is not a function`);\n          }\n          let thisValue;\n          if (rightRef instanceof ReferenceRecord) {\n            if (IsPropertyReference(rightRef)) {\n              thisValue = rightRef.Base;\n            }\n          }\n          return NormalCompletion(\n            (rightValue as unknown as Function).call(thisValue, leftValue)\n          );\n        }\n        // https://tc39.es/ecma262/#sec-additive-operators\n        const result = ApplyStringOrNumericBinaryOperator(\n          leftValue as number,\n          node.operator,\n          rightValue as number\n        );\n        return NormalCompletion(result);\n      }\n      case \"CallExpression\": {\n        // https://tc39.es/ecma262/#sec-function-calls\n        const ref = Evaluate(node.callee, optionalChainRef)\n          .Value as ReferenceRecord;\n        const func = GetValue(ref) as Function;\n        if (\n          (func === undefined || func === null) &&\n          (node.optional || optionalChainRef?.skipped)\n        ) {\n          optionalChainRef!.skipped = true;\n          return NormalCompletion(undefined);\n        }\n        sanitize(func);\n        return EvaluateCall(func, ref, node.arguments, node.callee);\n      }\n      case \"ChainExpression\":\n        // https://tc39.es/ecma262/#sec-optional-chains\n        return Evaluate(node.expression, {});\n      case \"ConditionalExpression\":\n        // https://tc39.es/ecma262/#sec-conditional-operator\n        return NormalCompletion(\n          GetValue(\n            Evaluate(\n              GetValue(Evaluate(node.test)) ? node.consequent : node.alternate\n            )\n          )\n        );\n      case \"Identifier\":\n        // https://tc39.es/ecma262/#sec-identifiers\n        return NormalCompletion(ResolveBinding(node.name));\n      case \"Literal\": {\n        // https://tc39.es/ecma262/#sec-primary-expression-literals\n        if (node.regex) {\n          if (node.value === null) {\n            // Invalid regular expression fails silently in @babel/parser.\n            throw new SyntaxError(`Invalid regular expression: ${node.raw}`);\n          }\n          if (node.regex.flags.includes(\"u\")) {\n            // Currently unicode flag is not fully supported across major browsers.\n            throw new SyntaxError(\n              `Unsupported unicode flag in regular expression: ${node.raw}`\n            );\n          }\n        }\n        return NormalCompletion(node.value);\n      }\n      case \"LogicalExpression\": {\n        // https://tc39.es/ecma262/#sec-binary-logical-operators\n        const leftValue = GetValue(Evaluate(node.left));\n        switch (node.operator) {\n          case \"&&\":\n            return NormalCompletion(\n              leftValue && GetValue(Evaluate(node.right))\n            );\n          case \"||\":\n            return NormalCompletion(\n              leftValue || GetValue(Evaluate(node.right))\n            );\n          case \"??\":\n            return NormalCompletion(\n              leftValue ?? GetValue(Evaluate(node.right))\n            );\n          // istanbul ignore next\n          default:\n            throw new SyntaxError(\n              // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n              // @ts-ignore never reach here.\n              `Unsupported logical operator '${node.operator}'`\n            );\n        }\n      }\n      case \"MemberExpression\": {\n        // https://tc39.es/ecma262/#sec-property-accessors\n        const baseReference = Evaluate(node.object, optionalChainRef)\n          .Value as ReferenceRecord;\n        const baseValue = GetValue(baseReference) as Record<\n          PropertyKey,\n          unknown\n        >;\n        if (\n          (baseValue === undefined || baseValue === null) &&\n          (node.optional || optionalChainRef?.skipped)\n        ) {\n          optionalChainRef!.skipped = true;\n          return NormalCompletion(undefined);\n        }\n        sanitize(baseValue);\n        const result = node.computed\n          ? EvaluatePropertyAccessWithExpressionKey(\n              baseValue,\n              node.property as Expression,\n              true\n            )\n          : EvaluatePropertyAccessWithIdentifierKey(\n              baseValue,\n              node.property as Identifier,\n              true\n            );\n        sanitize(result);\n        return NormalCompletion(result);\n      }\n      case \"NewExpression\":\n        // https://tc39.es/ecma262/#sec-new-operator\n        return EvaluateNew(node.callee, node.arguments);\n      case \"ObjectExpression\": {\n        // https://tc39.es/ecma262/#sec-object-initializer\n        const object: Record<PropertyKey, unknown> = {};\n        for (const prop of (node as EstreeObjectExpression).properties) {\n          if (prop.type === \"SpreadElement\") {\n            const fromValue = GetValue(Evaluate(prop.argument));\n            CopyDataProperties(object, fromValue, new Set());\n          } else {\n            if (prop.kind !== \"init\") {\n              throw new SyntaxError(\"Unsupported object getter/setter\");\n            }\n            const propName =\n              !prop.computed && prop.key.type === \"Identifier\"\n                ? prop.key.name\n                : EvaluateComputedPropertyName(prop.key as Expression);\n            if (propName === \"__proto__\") {\n              throw new TypeError(\n                \"Setting '__proto__' property is not allowed\"\n              );\n            }\n            object[propName] = GetValue(Evaluate(prop.value));\n          }\n        }\n        return NormalCompletion(object);\n      }\n      case \"SequenceExpression\": {\n        // https://tc39.es/ecma262/#sec-comma-operator\n        let result: CompletionRecord | undefined;\n        for (const expr of node.expressions) {\n          result = NormalCompletion(GetValue(Evaluate(expr)));\n        }\n        return result!;\n      }\n      case \"TemplateLiteral\": {\n        // https://tc39.es/ecma262/#sec-template-literals\n        const chunks: string[] = [node.quasis[0].value.cooked!];\n        let index = 0;\n        for (const expr of node.expressions) {\n          const val = GetValue(Evaluate(expr));\n          chunks.push(String(val));\n          chunks.push(node.quasis[(index += 1)].value.cooked!);\n        }\n        return NormalCompletion(chunks.join(\"\"));\n      }\n      case \"TaggedTemplateExpression\": {\n        // https://tc39.es/ecma262/#sec-tagged-templates\n        const tagRef = Evaluate(node.tag).Value as ReferenceRecord;\n        const tagFunc = GetValue(tagRef) as Function;\n        sanitize(tagFunc);\n        return EvaluateCall(tagFunc, tagRef, node.quasi, node.tag);\n      }\n      case \"UnaryExpression\": {\n        // https://tc39.es/ecma262/#sec-unary-operators\n        const ref = Evaluate(node.argument).Value as ReferenceRecord;\n        if (!expressionOnly && node.operator === \"delete\") {\n          // Delete operator is supported only in function mode.\n          if (!(ref instanceof ReferenceRecord)) {\n            return NormalCompletion(true);\n          }\n          // istanbul ignore else\n          if (IsPropertyReference(ref)) {\n            const deleteStatus = delete (\n              ref.Base as Record<PropertyKey, unknown>\n            )[ref.ReferenceName];\n            return NormalCompletion(deleteStatus);\n          }\n          // Should never reach here in strict mode.\n        }\n        if (node.operator === \"typeof\") {\n          if (ref instanceof ReferenceRecord && ref.Base === \"unresolvable\") {\n            return NormalCompletion(\"undefined\");\n          }\n          return NormalCompletion(typeof GetValue(ref));\n        }\n        return NormalCompletion(\n          ApplyUnaryOperator(GetValue(ref), node.operator)\n        );\n      }\n    }\n    if (!expressionOnly) {\n      // Statements and assignments:\n      switch (node.type) {\n        case \"AssignmentExpression\": {\n          // https://tc39.es/ecma262/#sec-assignment-operators\n          if (node.operator === \"=\") {\n            if (\n              !(\n                node.left.type === \"ArrayPattern\" ||\n                node.left.type === \"ObjectPattern\"\n              )\n            ) {\n              const lref = Evaluate(node.left).Value as ReferenceRecord;\n              // Todo: IsAnonymousFunctionDefinition(lref)\n              const rref = Evaluate(node.right);\n              const rval = GetValue(rref);\n\n              PutValue(lref, rval);\n              return NormalCompletion(rval);\n            }\n            const rref = Evaluate(node.right);\n            const rval = GetValue(rref) as string | number;\n            DestructuringAssignmentEvaluation(node.left, rval);\n            return NormalCompletion(rval);\n          }\n          // Operators other than `=`.\n          const lref = Evaluate(node.left).Value as ReferenceRecord;\n          const lval = GetValue(lref) as string | number;\n          const rref = Evaluate(node.right);\n          const rval = GetValue(rref) as string | number;\n          const r = ApplyStringOrNumericAssignment(lval, node.operator, rval);\n          PutValue(lref, r);\n          return NormalCompletion(r);\n        }\n        case \"BlockStatement\": {\n          // https://tc39.es/ecma262/#sec-block\n          if (!node.body.length) {\n            return NormalCompletion(Empty);\n          }\n          const oldEnv = getRunningContext().LexicalEnvironment;\n          const blockEnv = new DeclarativeEnvironment(oldEnv);\n          BlockDeclarationInstantiation(node.body, blockEnv);\n          getRunningContext().LexicalEnvironment = blockEnv;\n          const blockValue = EvaluateStatementList(node.body);\n          getRunningContext().LexicalEnvironment = oldEnv;\n          return blockValue;\n        }\n        case \"BreakStatement\":\n          // https://tc39.es/ecma262/#sec-break-statement\n          return new CompletionRecord(\"break\", Empty);\n        case \"ContinueStatement\":\n          // https://tc39.es/ecma262/#sec-continue-statement\n          return new CompletionRecord(\"continue\", Empty);\n        case \"EmptyStatement\":\n          // https://tc39.es/ecma262/#sec-empty-statement\n          return NormalCompletion(Empty);\n        case \"DoWhileStatement\":\n          // https://tc39.es/ecma262/#sec-do-while-statement\n          return EvaluateBreakableStatement(DoWhileLoopEvaluation(node));\n        case \"ExpressionStatement\":\n        case \"TSAsExpression\":\n          // https://tc39.es/ecma262/#sec-expression-statement\n          return Evaluate(node.expression);\n        case \"ForInStatement\":\n        case \"ForOfStatement\":\n          // https://tc39.es/ecma262/#sec-for-in-and-for-of-statements\n          return EvaluateBreakableStatement(ForInOfLoopEvaluation(node));\n        case \"ForStatement\":\n          // https://tc39.es/ecma262/#sec-for-statement\n          return EvaluateBreakableStatement(ForLoopEvaluation(node));\n        case \"FunctionDeclaration\":\n          // https://tc39.es/ecma262/#sec-function-definitions\n          return NormalCompletion(Empty);\n        case \"FunctionExpression\":\n          // https://tc39.es/ecma262/#sec-function-defining-expressions\n          ThrowIfFunctionIsInvalid(node);\n          return NormalCompletion(InstantiateOrdinaryFunctionExpression(node));\n        case \"IfStatement\":\n          // https://tc39.es/ecma262/#sec-if-statement\n          return GetValue(Evaluate(node.test))\n            ? (hooks.beforeBranch?.(node, \"if\"),\n              UpdateEmpty(Evaluate(node.consequent), undefined))\n            : (hooks.beforeBranch?.(node, \"else\"), node.alternate)\n            ? UpdateEmpty(Evaluate(node.alternate), undefined)\n            : NormalCompletion(undefined);\n        case \"ReturnStatement\": {\n          // https://tc39.es/ecma262/#sec-return-statement\n          let v: unknown;\n          if (node.argument) {\n            const exprRef = Evaluate(node.argument);\n            v = GetValue(exprRef);\n          }\n          return new CompletionRecord(\"return\", v);\n        }\n        case \"ThrowStatement\":\n          // https://tc39.es/ecma262/#sec-throw-statement\n          throw GetValue(Evaluate(node.argument));\n        case \"UpdateExpression\": {\n          // https://tc39.es/ecma262/#sec-update-expressions\n          const lhs = Evaluate(node.argument).Value as ReferenceRecord;\n          const oldValue = Number(GetValue(lhs));\n          const newValue = node.operator === \"++\" ? oldValue + 1 : oldValue - 1;\n          PutValue(lhs, newValue);\n          return NormalCompletion(node.prefix ? newValue : oldValue);\n        }\n        case \"SwitchCase\":\n          return EvaluateStatementList(node.consequent);\n        case \"SwitchStatement\": {\n          // https://tc39.es/ecma262/#sec-switch-statement\n          const exprRef = Evaluate(node.discriminant);\n          const switchValue = GetValue(exprRef);\n          const oldEnv = getRunningContext().LexicalEnvironment;\n          const blockEnv = new DeclarativeEnvironment(oldEnv);\n          BlockDeclarationInstantiation(node.cases, blockEnv);\n          getRunningContext().LexicalEnvironment = blockEnv;\n          const R = CaseBlockEvaluation(node.cases, switchValue);\n          getRunningContext().LexicalEnvironment = oldEnv;\n          return EvaluateBreakableStatement(R);\n        }\n        case \"TryStatement\": {\n          // https://tc39.es/ecma262/#sec-try-statement\n          let R: CompletionRecord;\n          try {\n            R = Evaluate(node.block);\n          } catch (error) {\n            if (node.handler) {\n              hooks.beforeEvaluate?.(node.handler);\n              R = CatchClauseEvaluation(node.handler, error);\n            } else {\n              throw error;\n            }\n          } finally {\n            if (node.finalizer) {\n              const F = Evaluate(node.finalizer);\n              if (F.Type !== \"normal\") {\n                R = F;\n              }\n            }\n          }\n          return R;\n        }\n        case \"VariableDeclaration\": {\n          // https://tc39.es/ecma262/#sec-declarations-and-the-variable-statement\n          let result: CompletionRecord | undefined;\n          for (const declarator of node.declarations) {\n            if (!declarator.init) {\n              // Assert: a declarator without init is always an identifier.\n              if (node.kind === \"var\") {\n                result = NormalCompletion(Empty);\n              } else {\n                const lhs = ResolveBinding((declarator.id as Identifier).name);\n                result = InitializeReferencedBinding(lhs, undefined);\n              }\n            } else if (declarator.id.type === \"Identifier\") {\n              const bindingId = declarator.id.name;\n              const lhs = ResolveBinding(bindingId);\n              // Todo: IsAnonymousFunctionDefinition(Initializer)\n              const rhs = Evaluate(declarator.init);\n              const value = GetValue(rhs);\n              result =\n                node.kind === \"var\"\n                  ? PutValue(lhs, value)\n                  : InitializeReferencedBinding(lhs, value);\n            } else {\n              const rhs = Evaluate(declarator.init);\n              const rval = GetValue(rhs);\n              result = BindingInitialization(\n                declarator.id,\n                rval,\n                node.kind === \"var\"\n                  ? undefined\n                  : getRunningContext().LexicalEnvironment\n              );\n            }\n          }\n          return result!;\n        }\n        case \"WhileStatement\":\n          // https://tc39.es/ecma262/#sec-while-statement\n          return EvaluateBreakableStatement(WhileLoopEvaluation(node));\n      }\n    }\n    // eslint-disable-next-line no-console\n    throw new SyntaxError(`Unsupported node type \\`${node.type}\\``);\n  }\n\n  // https://tc39.es/ecma262/#sec-execution-contexts\n  function getRunningContext(): ExecutionContext {\n    return executionContextStack[executionContextStack.length - 1];\n  }\n\n  // https://tc39.es/ecma262/#sec-resolvebinding\n  function ResolveBinding(\n    name: string,\n    env?: EnvironmentRecord\n  ): ReferenceRecord {\n    if (!env) {\n      env = getRunningContext().LexicalEnvironment;\n    }\n    return GetIdentifierReference(env, name, true);\n  }\n\n  // Try statements.\n  // https://tc39.es/ecma262/#sec-runtime-semantics-catchclauseevaluation\n  function CatchClauseEvaluation(\n    node: CatchClause,\n    thrownValue: unknown\n  ): CompletionRecord {\n    if (!node.param) {\n      return Evaluate(node.body);\n    }\n    const oldEnv = getRunningContext().LexicalEnvironment;\n    const catchEnv = new DeclarativeEnvironment(oldEnv);\n    for (const argName of collectBoundNames(node.param)) {\n      catchEnv.CreateMutableBinding(argName, false);\n    }\n    getRunningContext().LexicalEnvironment = catchEnv;\n    BindingInitialization(node.param, thrownValue, catchEnv);\n    const B = Evaluate(node.body);\n    getRunningContext().LexicalEnvironment = oldEnv;\n    return B;\n  }\n\n  // Iteration statements and switch statements.\n  // https://tc39.es/ecma262/#prod-BreakableStatement\n  function EvaluateBreakableStatement(\n    stmtResult: CompletionRecord\n  ): CompletionRecord {\n    return stmtResult.Type === \"break\"\n      ? stmtResult.Value === Empty\n        ? NormalCompletion(undefined)\n        : NormalCompletion(stmtResult.Value)\n      : stmtResult;\n  }\n\n  // Switch statements.\n  // https://tc39.es/ecma262/#sec-runtime-semantics-caseblockevaluation\n  function CaseBlockEvaluation(\n    cases: SwitchCase[],\n    input: unknown\n  ): CompletionRecord {\n    let V: unknown;\n\n    const defaultCaseIndex = cases.findIndex((switchCase) => !switchCase.test);\n    const hasDefaultCase = defaultCaseIndex >= 0;\n    const A = hasDefaultCase ? cases.slice(0, defaultCaseIndex) : cases;\n    let found = false;\n    for (const C of A) {\n      if (!found) {\n        found = CaseClauseIsSelected(C, input);\n      }\n      if (found) {\n        const R = Evaluate(C);\n        if (R.Value !== Empty) {\n          V = R.Value;\n        }\n        if (R.Type !== \"normal\") {\n          return UpdateEmpty(R, V);\n        }\n      }\n    }\n\n    if (!hasDefaultCase) {\n      return NormalCompletion(V);\n    }\n\n    let foundInB = false;\n    const B = cases.slice(defaultCaseIndex + 1);\n    if (!found) {\n      for (const C of B) {\n        if (!foundInB) {\n          foundInB = CaseClauseIsSelected(C, input);\n        }\n        if (foundInB) {\n          const R = Evaluate(C);\n          if (R.Value !== Empty) {\n            V = R.Value;\n          }\n          if (R.Type !== \"normal\") {\n            return UpdateEmpty(R, V);\n          }\n        }\n      }\n    }\n\n    if (foundInB) {\n      return NormalCompletion(V);\n    }\n    const R = Evaluate(cases[defaultCaseIndex]);\n    if (R.Value !== Empty) {\n      V = R.Value;\n    }\n    if (R.Type !== \"normal\") {\n      return UpdateEmpty(R, V);\n    }\n\n    // NOTE: The following is another complete iteration of the second CaseClauses.\n    for (const C of B) {\n      const R = Evaluate(C);\n      if (R.Value !== Empty) {\n        V = R.Value;\n      }\n      if (R.Type !== \"normal\") {\n        return UpdateEmpty(R, V);\n      }\n    }\n    return NormalCompletion(V);\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-caseclauseisselected\n  function CaseClauseIsSelected(C: SwitchCase, input: unknown): boolean {\n    const clauseSelector = GetValue(Evaluate(C.test!));\n    return input === clauseSelector;\n  }\n\n  // While statements.\n  // https://tc39.es/ecma262/#sec-runtime-semantics-whileloopevaluation\n  function WhileLoopEvaluation(node: WhileStatement): CompletionRecord {\n    let V: unknown;\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      const exprValue = GetValue(Evaluate(node.test));\n      if (!exprValue) {\n        return NormalCompletion(V);\n      }\n      const stmtResult = Evaluate(node.body);\n      if (!LoopContinues(stmtResult)) {\n        return UpdateEmpty(stmtResult, V);\n      }\n      if (stmtResult.Value !== Empty) {\n        V = stmtResult.Value;\n      }\n    }\n  }\n\n  // Do-while Statements.\n  // https://tc39.es/ecma262/#sec-runtime-semantics-dowhileloopevaluation\n  function DoWhileLoopEvaluation(node: DoWhileStatement): CompletionRecord {\n    let V: unknown;\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      const stmtResult = Evaluate(node.body);\n      if (!LoopContinues(stmtResult)) {\n        return UpdateEmpty(stmtResult, V);\n      }\n      if (stmtResult.Value !== Empty) {\n        V = stmtResult.Value;\n      }\n      const exprValue = GetValue(Evaluate(node.test));\n      if (!exprValue) {\n        return NormalCompletion(V);\n      }\n    }\n  }\n\n  // For in/of statements.\n  // https://tc39.es/ecma262/#sec-runtime-semantics-forinofloopevaluation\n  function ForInOfLoopEvaluation(\n    node: ForInStatement | ForOfStatement\n  ): CompletionRecord {\n    const lhs = node.left;\n    const isVariableDeclaration = lhs.type === \"VariableDeclaration\";\n    const lhsKind = isVariableDeclaration\n      ? lhs.kind === \"var\"\n        ? \"varBinding\"\n        : \"lexicalBinding\"\n      : \"assignment\";\n    const uninitializedBoundNames =\n      lhsKind === \"lexicalBinding\" ? collectBoundNames(lhs) : [];\n    const iterationKind =\n      node.type === \"ForInStatement\" ? \"enumerate\" : \"iterate\";\n    const keyResult = ForInOfHeadEvaluation(\n      uninitializedBoundNames,\n      node.right,\n      iterationKind\n    );\n    if (keyResult.Type !== \"normal\") {\n      // When enumerate, if the target is nil, a break completion will be returned.\n      return keyResult;\n    }\n    return ForInOfBodyEvaluation(\n      lhs,\n      node.body,\n      keyResult.Value as Iterator<unknown>,\n      iterationKind,\n      lhsKind\n    );\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-forinofheadevaluation\n  function ForInOfHeadEvaluation(\n    uninitializedBoundNames: string[],\n    expr: Expression,\n    iterationKind: \"enumerate\" | \"iterate\"\n  ): CompletionRecord {\n    const runningContext = getRunningContext();\n    const oldEnv = runningContext.LexicalEnvironment;\n    if (uninitializedBoundNames.length > 0) {\n      const newEnv = new DeclarativeEnvironment(oldEnv);\n      for (const name of uninitializedBoundNames) {\n        newEnv.CreateMutableBinding(name, false);\n      }\n      runningContext.LexicalEnvironment = newEnv;\n    }\n    const exprRef = Evaluate(expr);\n    runningContext.LexicalEnvironment = oldEnv;\n    const exprValue = GetValue(exprRef);\n    if (iterationKind === \"enumerate\") {\n      if (exprValue === null || exprValue === undefined) {\n        return new CompletionRecord(\"break\", Empty);\n      }\n      const iterator = EnumerateObjectProperties(exprValue);\n      return NormalCompletion(iterator);\n    }\n    const iterator = CreateListIteratorRecord(exprValue as Iterable<unknown>);\n    return NormalCompletion(iterator);\n  }\n\n  function ForInOfBodyEvaluation(\n    node: VariableDeclaration | EstreeLVal,\n    stmt: Statement,\n    iteratorRecord: Iterator<unknown>,\n    iterationKind: \"enumerate\" | \"iterate\",\n    lhsKind: \"varBinding\" | \"lexicalBinding\" | \"assignment\"\n  ): CompletionRecord {\n    const lhs =\n      lhsKind === \"assignment\"\n        ? (node as EstreeLVal)\n        : (node as VariableDeclaration).declarations[0].id;\n    const oldEnv = getRunningContext().LexicalEnvironment;\n    let V: unknown;\n    // When `destructuring` is false,\n    // For `node` whose `kind` is assignment:\n    //   `lhs` is an `Identifier` or a `MemberExpression`,\n    // Otherwise:\n    //   `lhs` is an `Identifier`.\n    const destructuring =\n      lhs.type === \"ObjectPattern\" || lhs.type === \"ArrayPattern\";\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      const { done, value: nextValue } = iteratorRecord.next();\n      if (done) {\n        return NormalCompletion(V);\n      }\n      let lhsRef: ReferenceRecord | undefined;\n      let iterationEnv: DeclarativeEnvironment | undefined;\n      if (lhsKind === \"lexicalBinding\") {\n        iterationEnv = new DeclarativeEnvironment(oldEnv);\n        ForDeclarationBindingInstantiation(\n          node as VariableDeclaration,\n          iterationEnv\n        );\n        getRunningContext().LexicalEnvironment = iterationEnv;\n        if (!destructuring) {\n          const [lhsName] = collectBoundNames(lhs);\n          lhsRef = ResolveBinding(lhsName);\n        }\n      } else if (!destructuring) {\n        lhsRef = Evaluate(lhs).Value as ReferenceRecord;\n      }\n      destructuring\n        ? lhsKind === \"assignment\"\n          ? DestructuringAssignmentEvaluation(lhs, nextValue)\n          : lhsKind === \"varBinding\"\n          ? BindingInitialization(lhs, nextValue, undefined)\n          : BindingInitialization(lhs, nextValue, iterationEnv)\n        : lhsKind === \"lexicalBinding\"\n        ? InitializeReferencedBinding(lhsRef!, nextValue)\n        : PutValue(lhsRef!, nextValue);\n\n      const result = Evaluate(stmt);\n      getRunningContext().LexicalEnvironment = oldEnv;\n      if (!LoopContinues(result)) {\n        const status = UpdateEmpty(result, V);\n        if (\n          !(\n            iterationKind === \"enumerate\" || iteratorRecord.return === undefined\n          )\n        ) {\n          // Perform *IteratorClose*\n          // https://tc39.es/ecma262/#sec-iteratorclose\n          const innerResult = iteratorRecord.return();\n          if (\n            !innerResult ||\n            ![\"object\", \"function\"].includes(typeof innerResult)\n          ) {\n            throw new TypeError(`Iterator result is not an object`);\n          }\n        }\n        return status;\n      }\n      if (result.Value !== Empty) {\n        V = result.Value;\n      }\n    }\n  }\n\n  // https://tc39.es/ecma262/#sec-enumerate-object-properties\n  function* EnumerateObjectProperties(value: any): Iterator<PropertyKey> {\n    for (const key in value) {\n      yield key;\n    }\n  }\n\n  // For statements.\n  // https://tc39.es/ecma262/#sec-runtime-semantics-forloopevaluation\n  function ForLoopEvaluation(node: ForStatement): CompletionRecord {\n    if (node.init?.type === \"VariableDeclaration\") {\n      // `for (var … ; … ; … ) …`\n      if (node.init.kind === \"var\") {\n        Evaluate(node.init);\n        return ForBodyEvaluation(node.test, node.update, node.body, []);\n      }\n      // `for (let/const … ; … ; … ) …`\n      const oldEnv = getRunningContext().LexicalEnvironment;\n      const loopEnv = new DeclarativeEnvironment(oldEnv);\n      const isConst = node.init.kind === \"const\";\n      const boundNames = collectBoundNames(node.init);\n      for (const dn of boundNames) {\n        if (isConst) {\n          loopEnv.CreateImmutableBinding(dn, true);\n        } else {\n          loopEnv.CreateMutableBinding(dn, false);\n        }\n      }\n      getRunningContext().LexicalEnvironment = loopEnv;\n      Evaluate(node.init);\n      const perIterationLets = isConst ? [] : Array.from(boundNames);\n      const bodyResult = ForBodyEvaluation(\n        node.test,\n        node.update,\n        node.body,\n        perIterationLets\n      );\n      getRunningContext().LexicalEnvironment = oldEnv;\n      return bodyResult;\n    }\n    // `for ( … ; … ; … ) …`\n    if (node.init) {\n      const exprRef = Evaluate(node.init);\n      GetValue(exprRef);\n    }\n    return ForBodyEvaluation(node.test, node.update, node.body, []);\n  }\n\n  // https://tc39.es/ecma262/#sec-forbodyevaluation\n  function ForBodyEvaluation(\n    test: Expression | null | undefined,\n    increment: Expression | null | undefined,\n    stmt: Statement,\n    perIterationBindings: string[]\n  ): CompletionRecord {\n    CreatePerIterationEnvironment(perIterationBindings);\n    let V: unknown;\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      if (test) {\n        const testRef = Evaluate(test);\n        const testValue = GetValue(testRef);\n        if (!testValue) {\n          return NormalCompletion(V);\n        }\n      }\n      const result = Evaluate(stmt) as CompletionRecord;\n      if (!LoopContinues(result)) {\n        return UpdateEmpty(result, V);\n      }\n      if (result.Value) {\n        V = result.Value;\n      }\n      CreatePerIterationEnvironment(perIterationBindings);\n      if (increment) {\n        const incRef = Evaluate(increment);\n        GetValue(incRef);\n      }\n    }\n  }\n\n  // https://tc39.es/ecma262/#sec-createperiterationenvironment\n  function CreatePerIterationEnvironment(\n    perIterationBindings: string[]\n  ): unknown {\n    if (perIterationBindings.length === 0) {\n      return;\n    }\n    const lastIterationEnv = getRunningContext().LexicalEnvironment!;\n    const outer = lastIterationEnv.OuterEnv;\n    const thisIterationEnv = new DeclarativeEnvironment(outer);\n    for (const bn of perIterationBindings) {\n      thisIterationEnv.CreateMutableBinding(bn, false);\n      const lastValue = lastIterationEnv.GetBindingValue(bn, false);\n      thisIterationEnv.InitializeBinding(bn, lastValue);\n    }\n    getRunningContext().LexicalEnvironment = thisIterationEnv;\n  }\n\n  // Destructuring assignments.\n  // https://tc39.es/ecma262/#sec-runtime-semantics-destructuringassignmentevaluation\n  function DestructuringAssignmentEvaluation(\n    pattern: ObjectPattern | EstreeObjectPattern | ArrayPattern,\n    value: unknown\n  ): CompletionRecord {\n    if (pattern.type === \"ObjectPattern\") {\n      RequireObjectCoercible(value);\n      if (pattern.properties.length > 0) {\n        PropertyDestructuringAssignmentEvaluation(\n          (pattern as EstreeObjectPattern).properties,\n          value\n        );\n      }\n      return NormalCompletion(Empty);\n    }\n    const iteratorRecord = CreateListIteratorRecord(value as Iterable<unknown>);\n    return IteratorDestructuringAssignmentEvaluation(\n      pattern.elements,\n      iteratorRecord\n    );\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-propertydestructuringassignmentevaluation\n  function PropertyDestructuringAssignmentEvaluation(\n    properties: (EstreeProperty | RestElement)[],\n    value: unknown\n  ): void {\n    const excludedNames = new Set<PropertyKey>();\n    for (const prop of properties) {\n      if (prop.type === \"Property\") {\n        const propName =\n          !prop.computed && prop.key.type === \"Identifier\"\n            ? prop.key.name\n            : (EvaluateComputedPropertyName(prop.key as Expression) as string);\n        const valueTarget =\n          prop.value.type === \"AssignmentPattern\"\n            ? prop.value.left\n            : prop.value;\n        if (valueTarget.type === \"Identifier\") {\n          const lref = ResolveBinding(valueTarget.name);\n          let v = GetV(value, propName);\n          if (prop.value.type === \"AssignmentPattern\" && v === undefined) {\n            // Todo(steve): check IsAnonymousFunctionDefinition(Initializer)\n            const defaultValue = Evaluate(prop.value.right);\n            v = GetValue(defaultValue);\n          }\n          PutValue(lref, v);\n          excludedNames.add(propName);\n        } else {\n          KeyedDestructuringAssignmentEvaluation(prop.value, value, propName);\n          excludedNames.add(propName);\n        }\n      } else {\n        RestDestructuringAssignmentEvaluation(prop, value, excludedNames);\n      }\n    }\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-keyeddestructuringassignmentevaluation\n  function KeyedDestructuringAssignmentEvaluation(\n    node: EstreeNode,\n    value: unknown,\n    propertyName: PropertyKey\n  ): CompletionRecord {\n    const assignmentTarget =\n      node.type === \"AssignmentPattern\" ? node.left : node;\n    const isObjectOrArray =\n      assignmentTarget.type === \"ArrayPattern\" ||\n      assignmentTarget.type === \"ObjectPattern\";\n    let lref: ReferenceRecord | undefined;\n    if (!isObjectOrArray) {\n      lref = Evaluate(assignmentTarget).Value as ReferenceRecord;\n    }\n    const v = GetV(value, propertyName);\n    let rhsValue;\n    if (node.type === \"AssignmentPattern\" && v === undefined) {\n      // Todo(steve): check IsAnonymousFunctionDefinition(Initializer)\n      const defaultValue = Evaluate(node.right);\n      rhsValue = GetValue(defaultValue);\n    } else {\n      rhsValue = v;\n    }\n    if (isObjectOrArray) {\n      return DestructuringAssignmentEvaluation(assignmentTarget, rhsValue);\n    }\n    return PutValue(lref!, rhsValue);\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-restdestructuringassignmentevaluation\n  function RestDestructuringAssignmentEvaluation(\n    restProperty: RestElement,\n    value: unknown,\n    excludedNames: Set<PropertyKey>\n  ): CompletionRecord {\n    const lref = Evaluate(restProperty.argument).Value as ReferenceRecord;\n    const restObj = CopyDataProperties({}, value, excludedNames);\n    return PutValue(lref, restObj);\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-iteratordestructuringassignmentevaluation\n  function IteratorDestructuringAssignmentEvaluation(\n    elements: (PatternLike | LVal | null)[],\n    iteratorRecord: Iterator<unknown>\n  ): CompletionRecord {\n    let status = NormalCompletion(Empty);\n    for (const element of elements) {\n      if (!element) {\n        iteratorRecord.next();\n        status = NormalCompletion(Empty);\n        continue;\n      }\n      const assignmentTarget =\n        element.type === \"RestElement\"\n          ? element.argument\n          : element.type === \"AssignmentPattern\"\n          ? element.left\n          : element;\n      const isObjectOrArray =\n        assignmentTarget.type === \"ArrayPattern\" ||\n        assignmentTarget.type === \"ObjectPattern\";\n      let lref: ReferenceRecord | undefined;\n      if (!isObjectOrArray) {\n        lref = Evaluate(assignmentTarget).Value as ReferenceRecord;\n      }\n      let v: unknown;\n      if (element.type !== \"RestElement\") {\n        const { done, value: nextValue } = iteratorRecord.next();\n        const value = done ? undefined : nextValue;\n        if (element.type === \"AssignmentPattern\" && value === undefined) {\n          // Todo(steve): check IsAnonymousFunctionDefinition(Initializer)\n          const defaultValue = Evaluate(element.right);\n          v = GetValue(defaultValue);\n        } else {\n          v = value;\n        }\n      } else {\n        // RestElement\n        v = [];\n        let n = 0;\n        // eslint-disable-next-line no-constant-condition\n        while (true) {\n          const { done, value: nextValue } = iteratorRecord.next();\n          if (done) {\n            break;\n          }\n          (v as unknown[])[n] = nextValue;\n          n++;\n        }\n      }\n      if (isObjectOrArray) {\n        status = DestructuringAssignmentEvaluation(assignmentTarget, v);\n      } else {\n        status = PutValue(lref!, v);\n      }\n    }\n    return status;\n  }\n\n  // Object expressions.\n  // https://tc39.es/ecma262/#sec-evaluate-property-access-with-expression-key\n  function EvaluatePropertyAccessWithExpressionKey(\n    baseValue: Record<PropertyKey, unknown>,\n    expression: Expression,\n    strict: boolean\n  ): ReferenceRecord {\n    const propertyNameReference = Evaluate(expression);\n    const propertyNameValue = GetValue(propertyNameReference);\n    const propertyKey = ToPropertyKey(propertyNameValue);\n    return new ReferenceRecord(baseValue, propertyKey, strict);\n  }\n\n  // https://tc39.es/ecma262/#sec-evaluate-property-access-with-identifier-key\n  function EvaluatePropertyAccessWithIdentifierKey(\n    baseValue: Record<PropertyKey, unknown>,\n    identifier: Identifier,\n    strict: boolean\n  ): ReferenceRecord {\n    const propertyNameString = identifier.name;\n    return new ReferenceRecord(baseValue, propertyNameString, strict);\n  }\n\n  // Block statements.\n  // https://tc39.es/ecma262/#sec-blockdeclarationinstantiation\n  function BlockDeclarationInstantiation(\n    code: Statement[] | SwitchCase[],\n    env: EnvironmentRecord\n  ): void {\n    const declarations = collectScopedDeclarations(code, {\n      var: false,\n      topLevel: false,\n    });\n    for (const d of declarations) {\n      const IsConstantDeclaration =\n        d.type === \"VariableDeclaration\" && d.kind === \"const\";\n      for (const dn of collectBoundNames(d)) {\n        if (IsConstantDeclaration) {\n          env.CreateImmutableBinding(dn, true);\n        } else {\n          env.CreateMutableBinding(dn, false);\n        }\n      }\n      if (d.type === \"FunctionDeclaration\") {\n        const [fn] = collectBoundNames(d);\n        const fo = InstantiateFunctionObject(d, env);\n        env.InitializeBinding(fn, fo);\n      }\n    }\n  }\n\n  // Function declarations and expressions.\n  // https://tc39.es/ecma262/#sec-evaluatecall\n  function EvaluateCall(\n    func: Function,\n    ref: ReferenceRecord,\n    args: CallExpression[\"arguments\"] | TemplateLiteral,\n    callee: CallExpression[\"callee\"]\n  ): CompletionRecord {\n    let thisValue;\n    if (ref instanceof ReferenceRecord) {\n      if (IsPropertyReference(ref)) {\n        thisValue = ref.Base;\n      }\n    }\n    const argList = ArgumentListEvaluation(args);\n    if (typeof func !== \"function\") {\n      const funcName = codeSource.substring(callee.start!, callee.end!);\n      throw new TypeError(`${funcName} is not a function`);\n    }\n    const result = func.apply(thisValue, argList);\n    sanitize(result);\n    return NormalCompletion(result);\n  }\n\n  // https://tc39.es/ecma262/#sec-evaluatenew\n  function EvaluateNew(\n    constructExpr: CallExpression[\"callee\"],\n    args: NewExpression[\"arguments\"]\n  ): CompletionRecord {\n    const ref = Evaluate(constructExpr);\n    const constructor = GetValue(ref) as new (...args: unknown[]) => unknown;\n    const argList = ArgumentListEvaluation(args);\n    if (\n      typeof constructor !== \"function\" ||\n      (constructor as unknown as FunctionObject)[IsConstructor] === false\n    ) {\n      const constructorName = codeSource.substring(\n        constructExpr.start!,\n        constructExpr.end!\n      );\n      throw new TypeError(`${constructorName} is not a constructor`);\n    }\n    if (!isAllowedConstructor(constructor)) {\n      const constructorName = codeSource.substring(\n        constructExpr.start!,\n        constructExpr.end!\n      );\n      throw new TypeError(`${constructorName} is not an allowed constructor`);\n    }\n    return NormalCompletion(new constructor(...argList));\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-argumentlistevaluation\n  function ArgumentListEvaluation(\n    args: CallExpression[\"arguments\"] | TemplateLiteral\n  ): unknown[] {\n    const array: unknown[] = [];\n    if (Array.isArray(args)) {\n      for (const arg of args) {\n        if (arg.type === \"SpreadElement\") {\n          const spreadValues = GetValue(Evaluate(arg.argument)) as unknown[];\n          array.push(...spreadValues);\n        } else {\n          array.push(GetValue(Evaluate(arg)));\n        }\n      }\n    } else {\n      array.push(GetTemplateObject(args));\n      for (const expr of args.expressions) {\n        array.push(GetValue(Evaluate(expr)));\n      }\n    }\n    return array;\n  }\n\n  // https://tc39.es/ecma262/#sec-ecmascript-function-objects-call-thisargument-argumentslist\n  function CallFunction(\n    closure: FunctionObject,\n    args: Iterable<unknown>\n  ): unknown {\n    hooks.beforeCall?.(closure[SourceNode]);\n    PrepareForOrdinaryCall(closure);\n    const result = OrdinaryCallEvaluateBody(closure, args);\n    executionContextStack.pop();\n    if (result.Type === \"return\") {\n      return result.Value;\n    }\n    return undefined;\n  }\n\n  // https://tc39.es/ecma262/#sec-prepareforordinarycall\n  function PrepareForOrdinaryCall(F: FunctionObject): ExecutionContext {\n    const calleeContext = new ExecutionContext();\n    calleeContext.Function = F;\n    const localEnv = new FunctionEnvironment(F[Environment]);\n    calleeContext.VariableEnvironment = localEnv;\n    calleeContext.LexicalEnvironment = localEnv;\n    executionContextStack.push(calleeContext);\n    return calleeContext;\n  }\n\n  // https://tc39.es/ecma262/#sec-ordinarycallevaluatebody\n  function OrdinaryCallEvaluateBody(\n    F: FunctionObject,\n    args: Iterable<unknown>\n  ): CompletionRecord {\n    return EvaluateFunctionBody(F[ECMAScriptCode], F, args);\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-evaluatefunctionbody\n  function EvaluateFunctionBody(\n    body: Statement[] | Expression,\n    F: FunctionObject,\n    args: Iterable<unknown>\n  ): CompletionRecord {\n    FunctionDeclarationInstantiation(F, args);\n    if (Array.isArray(body)) {\n      return EvaluateStatementList(body);\n    }\n    return new CompletionRecord(\"return\", GetValue(Evaluate(body)));\n  }\n\n  // https://tc39.es/ecma262/#sec-block-runtime-semantics-evaluation\n  function EvaluateStatementList(statements: Statement[]): CompletionRecord {\n    let result = NormalCompletion(Empty);\n    for (const stmt of statements) {\n      const s = Evaluate(stmt);\n      if (s.Type !== \"normal\") {\n        return s;\n      }\n      result = UpdateEmpty(result, s.Value);\n    }\n    return result;\n  }\n\n  // https://tc39.es/ecma262/#sec-functiondeclarationinstantiation\n  function FunctionDeclarationInstantiation(\n    func: FunctionObject,\n    args: Iterable<unknown>\n  ): void {\n    const calleeContext = getRunningContext();\n    const code = func[ECMAScriptCode];\n    const formals = func[FormalParameters] as FunctionDeclaration[\"params\"];\n    const parameterNames = collectBoundNames(formals);\n    const hasParameterExpressions = containsExpression(formals);\n    const varDeclarations = collectScopedDeclarations(code, {\n      var: true,\n      topLevel: true,\n    });\n    const varNames = collectBoundNames(varDeclarations);\n\n    // `functionNames` ∈ `varNames`\n    // `functionsToInitialize` ≈ `functionNames`\n    const functionNames: string[] = [];\n    const functionsToInitialize: FunctionDeclaration[] = [];\n    for (let i = varDeclarations.length - 1; i >= 0; i--) {\n      const d = varDeclarations[i];\n      if (d.type === \"FunctionDeclaration\") {\n        ThrowIfFunctionIsInvalid(d);\n        const [fn] = collectBoundNames(d);\n        if (!functionNames.includes(fn)) {\n          functionNames.unshift(fn);\n          functionsToInitialize.unshift(d);\n        }\n      } else if (rules?.noVar) {\n        throw new SyntaxError(\n          \"Var declaration is not recommended, use `let` or `const` instead\"\n        );\n      }\n    }\n\n    const env = calleeContext.LexicalEnvironment!;\n    for (const paramName of parameterNames) {\n      // In strict mode, it's guaranteed no duplicate params exist.\n      env.CreateMutableBinding(paramName, false);\n    }\n\n    const iteratorRecord = CreateListIteratorRecord(args);\n    IteratorBindingInitialization(formals, iteratorRecord, env);\n\n    let varEnv: EnvironmentRecord;\n    if (!hasParameterExpressions) {\n      // NOTE: Only a single Environment Record is needed for the parameters\n      // and top-level vars.\n      // `varNames` are unique.\n      for (const n of varNames) {\n        if (!parameterNames.includes(n)) {\n          env.CreateMutableBinding(n, false);\n          env.InitializeBinding(n, undefined);\n        }\n      }\n      varEnv = env;\n    } else {\n      // NOTE: A separate Environment Record is needed to ensure that closures\n      // created by expressions in the formal parameter list do not have\n      // visibility of declarations in the function body.\n      varEnv = new DeclarativeEnvironment(env);\n      calleeContext.VariableEnvironment = varEnv;\n      // `varNames` are unique.\n      for (const n of varNames) {\n        varEnv.CreateMutableBinding(n, false);\n        let initialValue: unknown;\n        if (parameterNames.includes(n) && !functionNames.includes(n)) {\n          initialValue = env.GetBindingValue(n, false);\n        }\n        varEnv.InitializeBinding(n, initialValue);\n        // NOTE: A var with the same name as a formal parameter initially has\n        // the same value as the corresponding initialized parameter.\n      }\n    }\n    const lexEnv = varEnv;\n    calleeContext.LexicalEnvironment = lexEnv;\n\n    const lexDeclarations = collectScopedDeclarations(code, {\n      var: false,\n      topLevel: true,\n    });\n    for (const d of lexDeclarations) {\n      for (const dn of collectBoundNames(d)) {\n        // Only lexical VariableDeclaration here in top-level.\n        if ((d as VariableDeclaration).kind === \"const\") {\n          lexEnv.CreateImmutableBinding(dn, true);\n        } else {\n          lexEnv.CreateMutableBinding(dn, false);\n        }\n      }\n    }\n\n    for (const f of functionsToInitialize) {\n      const [fn] = collectBoundNames(f);\n      const fo = InstantiateFunctionObject(f, lexEnv);\n      varEnv.SetMutableBinding(fn, fo, false);\n    }\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-instantiatefunctionobject\n  function InstantiateFunctionObject(\n    func: FunctionDeclaration,\n    scope: EnvironmentRecord\n  ): FunctionObject {\n    return OrdinaryFunctionCreate(func, scope, true);\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-instantiateordinaryfunctionexpression\n  function InstantiateOrdinaryFunctionExpression(\n    functionExpression: FunctionExpression\n  ): FunctionObject {\n    const scope = getRunningContext().LexicalEnvironment!;\n    if (functionExpression.id) {\n      const name = functionExpression.id.name;\n      const funcEnv = new DeclarativeEnvironment(scope);\n      funcEnv.CreateImmutableBinding(name, false);\n      const closure = OrdinaryFunctionCreate(functionExpression, funcEnv, true);\n      funcEnv.InitializeBinding(name, closure);\n      return closure;\n    } else {\n      const closure = OrdinaryFunctionCreate(functionExpression, scope, true);\n      return closure;\n    }\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-instantiatearrowfunctionexpression\n  function InstantiateArrowFunctionExpression(\n    arrowFunction: ArrowFunctionExpression\n  ): FunctionObject {\n    const scope = getRunningContext().LexicalEnvironment!;\n    const closure = OrdinaryFunctionCreate(arrowFunction, scope, false);\n    return closure;\n  }\n\n  // https://tc39.es/ecma262/#sec-ordinaryfunctioncreate\n  function OrdinaryFunctionCreate(\n    sourceNode:\n      | FunctionDeclaration\n      | FunctionExpression\n      | ArrowFunctionExpression,\n    scope: EnvironmentRecord,\n    isConstructor: boolean\n  ): FunctionObject {\n    const F = function () {\n      // eslint-disable-next-line prefer-rest-params\n      return CallFunction(F, arguments);\n    } as FunctionObject;\n    Object.defineProperties(F, {\n      [SourceNode]: {\n        value: sourceNode,\n      },\n      [FormalParameters]: {\n        value: sourceNode.params,\n      },\n      [ECMAScriptCode]: {\n        value:\n          sourceNode.body.type === \"BlockStatement\"\n            ? sourceNode.body.body\n            : sourceNode.body,\n      },\n      [Environment]: {\n        value: scope,\n      },\n      [IsConstructor]: {\n        value: isConstructor,\n      },\n    });\n    return F;\n  }\n\n  // Patterns initialization.\n  // https://tc39.es/ecma262/#sec-runtime-semantics-bindinginitialization\n  function BindingInitialization(\n    node: EstreeLVal,\n    value: unknown,\n    environment?: EnvironmentRecord\n  ): CompletionRecord | undefined {\n    switch (node.type) {\n      case \"Identifier\":\n        return InitializeBoundName(node.name, value, environment);\n      case \"ObjectPattern\":\n        RequireObjectCoercible(value);\n        return PropertyBindingInitialization(\n          (node as EstreeObjectPattern).properties,\n          value,\n          environment\n        );\n      case \"ArrayPattern\": {\n        const iteratorRecord = CreateListIteratorRecord(\n          value as Iterable<unknown>\n        );\n        return IteratorBindingInitialization(\n          node.elements,\n          iteratorRecord,\n          environment\n        );\n      }\n    }\n  }\n\n  // https://tc39.es/ecma262/#sec-destructuring-binding-patterns-runtime-semantics-propertybindinginitialization\n  function PropertyBindingInitialization(\n    properties: (EstreeProperty | RestElement)[],\n    value: unknown,\n    environment?: EnvironmentRecord\n  ): CompletionRecord {\n    const excludedNames = new Set<PropertyKey>();\n    for (const prop of properties) {\n      if (prop.type === \"RestElement\") {\n        return RestBindingInitialization(\n          prop,\n          value,\n          environment,\n          excludedNames\n        );\n      }\n      if (!prop.computed && prop.key.type === \"Identifier\") {\n        KeyedBindingInitialization(\n          prop.value as EstreeLVal,\n          value,\n          environment,\n          prop.key.name\n        );\n        excludedNames.add(prop.key.name);\n      } else {\n        const P = EvaluateComputedPropertyName(prop.key as Expression);\n        KeyedBindingInitialization(\n          prop.value as EstreeLVal,\n          value,\n          environment,\n          P\n        );\n        excludedNames.add(P);\n      }\n    }\n    return NormalCompletion(Empty);\n  }\n\n  // https://tc39.es/ecma262/#prod-ComputedPropertyName\n  function EvaluateComputedPropertyName(node: Expression): PropertyKey {\n    const propName = GetValue(Evaluate(node));\n    return ToPropertyKey(propName);\n  }\n\n  // https://tc39.es/ecma262/#sec-destructuring-binding-patterns-runtime-semantics-restbindinginitialization\n  function RestBindingInitialization(\n    restProperty: RestElement,\n    value: unknown,\n    environment: EnvironmentRecord | undefined,\n    excludedNames: Set<PropertyKey>\n  ): CompletionRecord {\n    const lhs = ResolveBinding(\n      (restProperty.argument as Identifier).name,\n      environment\n    );\n    const restObj = CopyDataProperties({}, value, excludedNames);\n    if (!environment) {\n      return PutValue(lhs, restObj);\n    }\n    return InitializeReferencedBinding(lhs, restObj);\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-iteratorbindinginitialization\n  function IteratorBindingInitialization(\n    elements: (PatternLike | LVal | null)[],\n    iteratorRecord: Iterator<unknown>,\n    environment?: EnvironmentRecord\n  ): CompletionRecord | undefined {\n    if (elements.length === 0) {\n      return NormalCompletion(Empty);\n    }\n    let result;\n    for (const node of elements) {\n      if (!node) {\n        // Elision element.\n        iteratorRecord.next();\n        result = NormalCompletion(Empty);\n      } else if (node.type === \"RestElement\") {\n        // Rest element.\n        if (node.argument.type === \"Identifier\") {\n          const lhs = ResolveBinding(node.argument.name, environment);\n          const A: unknown[] = [];\n          let n = 0;\n          // eslint-disable-next-line no-constant-condition\n          while (true) {\n            const { done, value } = iteratorRecord.next();\n            if (done) {\n              result = environment\n                ? InitializeReferencedBinding(lhs, A)\n                : PutValue(lhs, A);\n              break;\n            }\n            A[n] = value;\n            n++;\n          }\n        } else {\n          const A: unknown[] = [];\n          let n = 0;\n          // eslint-disable-next-line no-constant-condition\n          while (true) {\n            const { done, value } = iteratorRecord.next();\n            if (done) {\n              result = BindingInitialization(node.argument, A, environment);\n              break;\n            }\n            A[n] = value;\n            n++;\n          }\n        }\n      } else {\n        // Normal element.\n        const bindingElement =\n          node.type === \"AssignmentPattern\" ? node.left : node;\n        switch (bindingElement.type) {\n          case \"ObjectPattern\":\n          case \"ArrayPattern\": {\n            let v: unknown;\n            const { done, value } = iteratorRecord.next();\n            if (!done) {\n              v = value;\n            }\n            if (node.type === \"AssignmentPattern\" && v === undefined) {\n              const defaultValue = Evaluate(node.right);\n              v = GetValue(defaultValue);\n            }\n            result = BindingInitialization(bindingElement, v, environment);\n            break;\n          }\n          case \"Identifier\": {\n            const bindingId = bindingElement.name;\n            const lhs = ResolveBinding(bindingId, environment);\n            let v: unknown;\n            const { done, value } = iteratorRecord.next();\n            if (!done) {\n              v = value;\n            }\n            if (node.type === \"AssignmentPattern\" && v === undefined) {\n              // IsAnonymousFunctionDefinition(Initializer)\n              const defaultValue = Evaluate(node.right);\n              v = GetValue(defaultValue);\n            }\n            result = environment\n              ? InitializeReferencedBinding(lhs, v)\n              : PutValue(lhs, v);\n            break;\n          }\n        }\n      }\n    }\n    return result;\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-keyedbindinginitialization\n  function KeyedBindingInitialization(\n    node: EstreeLVal,\n    value: unknown,\n    environment: EnvironmentRecord | undefined,\n    propertyName: PropertyKey\n  ): CompletionRecord | undefined {\n    const isIdentifier =\n      node.type === \"Identifier\" ||\n      (node.type === \"AssignmentPattern\" && node.left.type === \"Identifier\");\n    if (isIdentifier) {\n      const bindingId =\n        node.type === \"Identifier\" ? node.name : (node.left as Identifier).name;\n      const lhs = ResolveBinding(bindingId, environment);\n      let v = GetV(value, propertyName);\n      if (node.type === \"AssignmentPattern\" && v === undefined) {\n        // If IsAnonymousFunctionDefinition(Initializer)\n        const defaultValue = Evaluate(node.right);\n        v = GetValue(defaultValue);\n      }\n      if (!environment) {\n        return PutValue(lhs, v);\n      }\n      return InitializeReferencedBinding(lhs, v);\n    }\n\n    let v = GetV(value, propertyName);\n    if (node.type === \"AssignmentPattern\" && v === undefined) {\n      const defaultValue = Evaluate(node.right);\n      v = GetValue(defaultValue);\n    }\n    return BindingInitialization(\n      node.type === \"AssignmentPattern\" ? node.left : node,\n      v,\n      environment\n    );\n  }\n\n  // https://tc39.es/ecma262/#sec-initializeboundname\n  function InitializeBoundName(\n    name: string,\n    value: unknown,\n    environment?: EnvironmentRecord\n  ): CompletionRecord {\n    // Assert: environment is always present.\n    environment!.InitializeBinding(name, value);\n    return NormalCompletion(Empty);\n  }\n\n  function ThrowIfFunctionIsInvalid(\n    func: FunctionDeclaration | FunctionExpression | ArrowFunctionExpression\n  ): void {\n    if (func.async || func.generator) {\n      throw new SyntaxError(\n        `${func.async ? \"Async\" : \"Generator\"} function is not allowed`\n      );\n    }\n    if (expressionOnly && !(func as ArrowFunctionExpression).expression) {\n      throw new SyntaxError(\n        \"Only an `Expression` is allowed in `ArrowFunctionExpression`'s body\"\n      );\n    }\n  }\n\n  if (expressionOnly) {\n    return GetValue(Evaluate(rootAst));\n  }\n\n  hooks.beforeEvaluate?.(rootAst);\n  ThrowIfFunctionIsInvalid(rootAst);\n  const [fn] = collectBoundNames(rootAst);\n  // Create an immutable binding for the root function.\n  rootEnv.CreateImmutableBinding(fn, true);\n  const fo = InstantiateFunctionObject(rootAst, rootEnv);\n  rootEnv.InitializeBinding(fn, fo);\n  return fo;\n}\n","import {\n  ArrowFunctionExpression,\n  Expression,\n  FunctionDeclaration,\n  FunctionExpression,\n  Statement,\n} from \"@babel/types\";\n\n// https://tc39.es/ecma262/#sec-execution-contexts\nexport class AnalysisContext {\n  VariableEnvironment?: AnalysisEnvironment;\n  LexicalEnvironment?: AnalysisEnvironment;\n}\n\n// https://tc39.es/ecma262/#sec-environment-records\nexport class AnalysisEnvironment {\n  readonly OuterEnv: AnalysisEnvironment | null | undefined;\n  private readonly bindingSet = new Set<string>();\n\n  constructor(outer: AnalysisEnvironment | null | undefined) {\n    this.OuterEnv = outer;\n  }\n\n  HasBinding(name: string): boolean {\n    return this.bindingSet.has(name);\n  }\n\n  CreateBinding(name: string): void {\n    this.bindingSet.add(name);\n  }\n}\n\nexport interface AnalysisFunctionObject {\n  Function: FunctionDeclaration | FunctionExpression | ArrowFunctionExpression;\n  FormalParameters: FunctionDeclaration[\"params\"];\n  ECMAScriptCode: Statement[] | Expression;\n  Environment?: AnalysisEnvironment;\n}\n","import {\n  ArrowFunctionExpression,\n  Expression,\n  FunctionDeclaration,\n  FunctionExpression,\n  Identifier,\n  Statement,\n  SwitchCase,\n  VariableDeclaration,\n} from \"@babel/types\";\nimport { hasOwnProperty } from \"./hasOwnProperty.js\";\nimport {\n  AnalysisContext,\n  AnalysisEnvironment,\n  AnalysisFunctionObject,\n} from \"./AnalysisContext.js\";\nimport {\n  EstreeNode,\n  EstreeVisitors,\n  NodeWithBoundNames,\n} from \"./interfaces.js\";\nimport {\n  collectBoundNames,\n  collectScopedDeclarations,\n  containsExpression,\n} from \"./traverse.js\";\n\nexport interface PrecookOptions {\n  expressionOnly?: boolean;\n  /** @deprecated Use hooks instead. */\n  visitors?: EstreeVisitors;\n  hooks?: PrecookHooks;\n  withParent?: boolean;\n}\n\nexport type EstreeParent = EstreeParentItem[];\n\nexport interface EstreeParentItem {\n  node: EstreeNode;\n  key: string;\n  index?: number;\n}\n\nexport interface PrecookHooks {\n  beforeVisit?(node: EstreeNode, parent?: EstreeParent): void;\n  beforeVisitGlobal?(node: Identifier, parent?: EstreeParent): void;\n  /** Return true if want to silent warnings for unknown nodes. */\n  beforeVisitUnknown?(node: EstreeNode, parent?: EstreeParent): boolean | void;\n}\n\n/**\n * Analysis an AST of a storyboard function or an evaluation expression.\n *\n * @param rootAst - The root AST.\n * @param options - Analysis options.\n * @returns A set of global variables the root AST attempts to access.\n */\nexport function precook(\n  rootAst: Expression | FunctionDeclaration,\n  { expressionOnly, visitors, withParent, hooks = {} }: PrecookOptions = {}\n): Set<string> {\n  const attemptToVisitGlobals = new Set<string>();\n  const analysisContextStack: AnalysisContext[] = [];\n  const rootEnv = new AnalysisEnvironment(null);\n  const rootContext = new AnalysisContext();\n  rootContext.VariableEnvironment = rootEnv;\n  rootContext.LexicalEnvironment = rootEnv;\n  analysisContextStack.push(rootContext);\n\n  function getRunningContext(): AnalysisContext {\n    return analysisContextStack[analysisContextStack.length - 1];\n  }\n\n  function visit(node: EstreeNode): void {\n    if (visitors && hasOwnProperty(visitors, node.type)) {\n      visitors[node.type](node);\n    }\n  }\n\n  function EvaluateChildren<T extends EstreeNode>(\n    node: T,\n    keys: (keyof T)[],\n    parent?: EstreeParent\n  ): void {\n    for (const key of keys) {\n      Evaluate(\n        node[key] as unknown as EstreeNode | EstreeNode[],\n        parent?.concat({ node, key } as EstreeParentItem)\n      );\n    }\n  }\n\n  function Evaluate(\n    node: EstreeNode | EstreeNode[],\n    parent?: EstreeParent\n  ): void {\n    if (Array.isArray(node)) {\n      node.forEach((n, index) => {\n        Evaluate(\n          n,\n          parent\n            ? parent.slice(0, -1).concat({\n                ...parent[parent.length - 1],\n                index,\n              })\n            : parent\n        );\n      });\n    } else if (node) {\n      // `node` maybe `null` in some cases.\n      hooks.beforeVisit?.(node, parent);\n      visit(node);\n      // Expressions:\n      switch (node.type) {\n        case \"Identifier\":\n          if (!ResolveBinding(node.name)) {\n            hooks.beforeVisitGlobal?.(node, parent);\n            attemptToVisitGlobals.add(node.name);\n          }\n          return;\n        case \"ArrayExpression\":\n        case \"ArrayPattern\":\n          EvaluateChildren(node, [\"elements\"], parent);\n          return;\n        case \"ArrowFunctionExpression\": {\n          const env = getRunningContext().LexicalEnvironment;\n          const closure = OrdinaryFunctionCreate(node, env);\n          CallFunction(closure, parent);\n          return;\n        }\n        case \"AssignmentPattern\":\n        case \"BinaryExpression\":\n        case \"LogicalExpression\":\n          EvaluateChildren(node, [\"left\", \"right\"], parent);\n          return;\n        case \"CallExpression\":\n        case \"NewExpression\":\n          EvaluateChildren(node, [\"callee\", \"arguments\"], parent);\n          return;\n        case \"ChainExpression\":\n          EvaluateChildren(node, [\"expression\"], parent);\n          return;\n        case \"ConditionalExpression\":\n          EvaluateChildren(node, [\"test\", \"consequent\", \"alternate\"], parent);\n          return;\n        case \"MemberExpression\":\n          EvaluateChildren(node, [\"object\"], parent);\n          if (node.computed) {\n            EvaluateChildren(node, [\"property\"], parent);\n          }\n          return;\n        case \"ObjectExpression\":\n        case \"ObjectPattern\":\n          EvaluateChildren(node, [\"properties\"], parent);\n          return;\n        case \"Property\":\n          if (node.computed) {\n            EvaluateChildren(node, [\"key\"], parent);\n          }\n          EvaluateChildren(node, [\"value\"], parent);\n          return;\n        case \"RestElement\":\n        case \"SpreadElement\":\n        case \"UnaryExpression\":\n          EvaluateChildren(node, [\"argument\"], parent);\n          return;\n        case \"SequenceExpression\":\n        case \"TemplateLiteral\":\n          EvaluateChildren(node, [\"expressions\"], parent);\n          return;\n        case \"TaggedTemplateExpression\":\n          EvaluateChildren(node, [\"tag\", \"quasi\"], parent);\n          return;\n        case \"Literal\":\n          return;\n      }\n      if (!expressionOnly) {\n        // Statements and assignments:\n        switch (node.type) {\n          case \"AssignmentExpression\":\n            EvaluateChildren(node, [\"right\", \"left\"], parent);\n            return;\n          case \"BlockStatement\": {\n            if (!node.body.length) {\n              return;\n            }\n            const runningContext = getRunningContext();\n            const oldEnv = runningContext.LexicalEnvironment;\n            const blockEnv = new AnalysisEnvironment(oldEnv);\n            BlockDeclarationInstantiation(node.body, blockEnv);\n            runningContext.LexicalEnvironment = blockEnv;\n            EvaluateChildren(node, [\"body\"], parent);\n            runningContext.LexicalEnvironment = oldEnv;\n            return;\n          }\n          case \"BreakStatement\":\n          case \"ContinueStatement\":\n          case \"EmptyStatement\":\n            return;\n          case \"CatchClause\": {\n            const runningContext = getRunningContext();\n            const oldEnv = runningContext.LexicalEnvironment;\n            const catchEnv = new AnalysisEnvironment(oldEnv);\n            BoundNamesInstantiation(node.param, catchEnv);\n            runningContext.LexicalEnvironment = catchEnv;\n            EvaluateChildren(node, [\"param\", \"body\"], parent);\n            runningContext.LexicalEnvironment = oldEnv;\n            return;\n          }\n          case \"DoWhileStatement\":\n            EvaluateChildren(node, [\"body\", \"test\"], parent);\n            return;\n          case \"ExpressionStatement\":\n          case \"TSAsExpression\":\n            EvaluateChildren(node, [\"expression\"], parent);\n            return;\n          case \"ForInStatement\":\n          case \"ForOfStatement\": {\n            // ForIn/OfHeadEvaluation\n            const lexicalBinding =\n              node.left.type === \"VariableDeclaration\" &&\n              node.left.kind !== \"var\";\n            const runningContext = getRunningContext();\n            const oldEnv = runningContext.LexicalEnvironment;\n            if (lexicalBinding) {\n              const newEnv = new AnalysisEnvironment(oldEnv);\n              BoundNamesInstantiation(node.left, newEnv);\n              runningContext.LexicalEnvironment = newEnv;\n            }\n            EvaluateChildren(node, [\"right\"], parent);\n            runningContext.LexicalEnvironment = oldEnv;\n\n            // ForIn/OfBodyEvaluation\n            if (lexicalBinding) {\n              const iterationEnv = new AnalysisEnvironment(oldEnv);\n              BoundNamesInstantiation(node.left, iterationEnv);\n              runningContext.LexicalEnvironment = iterationEnv;\n            }\n            EvaluateChildren(node, [\"left\", \"body\"], parent);\n            runningContext.LexicalEnvironment = oldEnv;\n            return;\n          }\n          case \"ForStatement\": {\n            const lexicalBinding =\n              node.init?.type === \"VariableDeclaration\" &&\n              node.init.kind !== \"var\";\n            const runningContext = getRunningContext();\n            const oldEnv = runningContext.LexicalEnvironment;\n            if (lexicalBinding) {\n              const loopEnv = new AnalysisEnvironment(oldEnv);\n              BoundNamesInstantiation(\n                node.init as VariableDeclaration,\n                loopEnv\n              );\n              runningContext.LexicalEnvironment = loopEnv;\n            }\n            EvaluateChildren(node, [\"init\", \"test\", \"body\", \"update\"], parent);\n            runningContext.LexicalEnvironment = oldEnv;\n            return;\n          }\n          case \"FunctionDeclaration\": {\n            const [fn] = collectBoundNames(node);\n            const env = getRunningContext().LexicalEnvironment!;\n            const fo = OrdinaryFunctionCreate(node, env);\n            env.CreateBinding(fn);\n            CallFunction(fo, parent);\n            return;\n          }\n          case \"FunctionExpression\": {\n            const closure = InstantiateOrdinaryFunctionExpression(node);\n            CallFunction(closure, parent);\n            return;\n          }\n          case \"IfStatement\":\n            EvaluateChildren(node, [\"test\", \"consequent\", \"alternate\"], parent);\n            return;\n          case \"ReturnStatement\":\n          case \"ThrowStatement\":\n          case \"UpdateExpression\":\n            EvaluateChildren(node, [\"argument\"], parent);\n            return;\n          case \"SwitchCase\":\n            EvaluateChildren(node, [\"test\", \"consequent\"], parent);\n            return;\n          case \"SwitchStatement\": {\n            EvaluateChildren(node, [\"discriminant\"], parent);\n            const runningContext = getRunningContext();\n            const oldEnv = runningContext.LexicalEnvironment;\n            const blockEnv = new AnalysisEnvironment(oldEnv);\n            BlockDeclarationInstantiation(node.cases, blockEnv);\n            runningContext.LexicalEnvironment = blockEnv;\n            EvaluateChildren(node, [\"cases\"], parent);\n            runningContext.LexicalEnvironment = oldEnv;\n            return;\n          }\n          case \"TryStatement\":\n            EvaluateChildren(node, [\"block\", \"handler\", \"finalizer\"], parent);\n            return;\n          case \"VariableDeclaration\":\n            EvaluateChildren(node, [\"declarations\"], parent);\n            return;\n          case \"VariableDeclarator\":\n            EvaluateChildren(node, [\"id\", \"init\"], parent);\n            return;\n          case \"WhileStatement\":\n            EvaluateChildren(node, [\"test\", \"body\"], parent);\n            return;\n        }\n      }\n      const silent = hooks.beforeVisitUnknown?.(node, parent);\n      if (!silent) {\n        // eslint-disable-next-line no-console\n        console.warn(`Unsupported node type \\`${node.type}\\``);\n      }\n    }\n  }\n\n  function BoundNamesInstantiation(\n    declarations: NodeWithBoundNames | NodeWithBoundNames[] | null | undefined,\n    env: AnalysisEnvironment\n  ): void {\n    for (const name of collectBoundNames(declarations)) {\n      env.CreateBinding(name);\n    }\n  }\n\n  function ResolveBinding(name: string): boolean {\n    const env = getRunningContext().LexicalEnvironment;\n    return GetIdentifierReference(env, name);\n  }\n\n  function GetIdentifierReference(\n    env: AnalysisEnvironment | null | undefined,\n    name: string\n  ): boolean {\n    return (\n      !!env &&\n      (env.HasBinding(name) || GetIdentifierReference(env.OuterEnv, name))\n    );\n  }\n\n  function BlockDeclarationInstantiation(\n    code: Statement[] | SwitchCase[],\n    env: AnalysisEnvironment\n  ): void {\n    const declarations = collectScopedDeclarations(code, {\n      var: false,\n      topLevel: false,\n    });\n    BoundNamesInstantiation(declarations, env);\n  }\n\n  function CallFunction(\n    closure: AnalysisFunctionObject,\n    parent?: EstreeParent\n  ): void {\n    PrepareOrdinaryCall(closure);\n    FunctionDeclarationInstantiation(closure, parent);\n    Evaluate(\n      closure.ECMAScriptCode,\n      parent\n        ?.concat({\n          node: closure.Function,\n          key: \"body\",\n        })\n        .concat(\n          closure.Function.body.type === \"BlockStatement\"\n            ? {\n                node: closure.Function.body,\n                key: \"body\",\n              }\n            : []\n        )\n    );\n    analysisContextStack.pop();\n  }\n\n  function PrepareOrdinaryCall(F: AnalysisFunctionObject): void {\n    const calleeContext = new AnalysisContext();\n    const localEnv = new AnalysisEnvironment(F.Environment);\n    calleeContext.VariableEnvironment = localEnv;\n    calleeContext.LexicalEnvironment = localEnv;\n    analysisContextStack.push(calleeContext);\n  }\n\n  function FunctionDeclarationInstantiation(\n    func: AnalysisFunctionObject,\n    parent?: EstreeParent\n  ): void {\n    const calleeContext = getRunningContext();\n    const code = func.ECMAScriptCode;\n    const formals = func.FormalParameters;\n    const hasParameterExpressions = containsExpression(formals);\n    const varDeclarations = collectScopedDeclarations(code, {\n      var: true,\n      topLevel: true,\n    });\n    const varNames = collectBoundNames(varDeclarations);\n\n    const env = calleeContext.LexicalEnvironment!;\n    BoundNamesInstantiation(formals, env);\n\n    Evaluate(formals, parent?.concat({ node: func.Function, key: \"params\" }));\n\n    let varEnv: AnalysisEnvironment;\n    if (!hasParameterExpressions) {\n      // NOTE: Only a single Environment Record is needed for the parameters\n      // and top-level vars.\n      for (const n of varNames) {\n        env.CreateBinding(n);\n      }\n      varEnv = env;\n    } else {\n      // NOTE: A separate Environment Record is needed to ensure that closures\n      // created by expressions in the formal parameter list do not have\n      // visibility of declarations in the function body.\n      varEnv = new AnalysisEnvironment(env);\n      calleeContext.VariableEnvironment = varEnv;\n      for (const n of varNames) {\n        varEnv.CreateBinding(n);\n      }\n    }\n    const lexEnv = varEnv;\n    calleeContext.LexicalEnvironment = lexEnv;\n\n    const lexDeclarations = collectScopedDeclarations(code, {\n      var: false,\n      topLevel: true,\n    });\n    BoundNamesInstantiation(lexDeclarations, lexEnv);\n  }\n\n  function InstantiateOrdinaryFunctionExpression(\n    functionExpression: FunctionExpression\n  ): AnalysisFunctionObject {\n    const scope = getRunningContext().LexicalEnvironment;\n    if (!functionExpression.id) {\n      return OrdinaryFunctionCreate(functionExpression, scope);\n    }\n    const name = functionExpression.id.name;\n    const funcEnv = new AnalysisEnvironment(scope);\n    funcEnv.CreateBinding(name);\n    return OrdinaryFunctionCreate(functionExpression, funcEnv);\n  }\n\n  function OrdinaryFunctionCreate(\n    func: FunctionDeclaration | FunctionExpression | ArrowFunctionExpression,\n    scope?: AnalysisEnvironment\n  ): AnalysisFunctionObject {\n    return {\n      Function: func,\n      FormalParameters: func.params,\n      ECMAScriptCode:\n        func.body.type === \"BlockStatement\" ? func.body.body : func.body,\n      Environment: scope,\n    };\n  }\n\n  Evaluate(rootAst, withParent ? [] : undefined);\n\n  return attemptToVisitGlobals;\n}\n","export function hasOwnProperty(\n  object: unknown,\n  property: string | number | symbol\n): boolean {\n  return Object.prototype.hasOwnProperty.call(object, property);\n}\n","import { FunctionDeclaration } from \"@babel/types\";\nimport { parseAsEstree } from \"./parse.js\";\nimport { precook, PrecookOptions } from \"./precook.js\";\n\nexport interface PrecookFunctionOptions extends PrecookOptions {\n  typescript?: boolean;\n}\n\nexport interface PrecookFunctionResult {\n  function: FunctionDeclaration;\n  attemptToVisitGlobals: Set<string>;\n}\n\nexport function precookFunction(\n  source: string,\n  { typescript, ...restOptions }: PrecookFunctionOptions = {}\n): PrecookFunctionResult {\n  const func = parseAsEstree(source, { typescript });\n  const attemptToVisitGlobals = precook(func, restOptions);\n  return {\n    function: func,\n    attemptToVisitGlobals,\n  };\n}\n","import { parse, parseExpression, type ParserPlugin } from \"@babel/parser\";\nimport type { Expression, FunctionDeclaration, Statement } from \"@babel/types\";\n\nexport function parseAsEstreeExpression(source: string): Expression {\n  return parseExpression(source, {\n    plugins: [\"estree\", [\"pipelineOperator\", { proposal: \"minimal\" }]],\n    attachComment: false,\n  });\n}\n\nexport interface ParseEstreeOptions {\n  typescript?: boolean;\n}\n\nexport function parseAsEstree(\n  source: string,\n  { typescript }: ParseEstreeOptions = {}\n): FunctionDeclaration {\n  const file = parse(source, {\n    plugins: [\"estree\", typescript && \"typescript\"].filter(\n      Boolean\n    ) as ParserPlugin[],\n    strictMode: true,\n    attachComment: false,\n  });\n  const body = file.program.body;\n  const jsNodes: Statement[] = typescript ? [] : body;\n  if (typescript) {\n    for (const node of body) {\n      if (node.type.startsWith(\"TS\")) {\n        if (/Enum|Import|Export/.test(node.type)) {\n          throw new SyntaxError(`Unsupported TypeScript syntax: ${node.type}`);\n        }\n      } else {\n        jsNodes.push(node);\n      }\n    }\n  }\n  if (jsNodes.length === 0) {\n    throw new SyntaxError(\"Function declaration not found\");\n  }\n  if (jsNodes.length > 1 || jsNodes[0].type !== \"FunctionDeclaration\") {\n    throw new SyntaxError(\n      `Expect a single function declaration at top level, but received: ${jsNodes\n        .map((node) => `\"${node.type}\"`)\n        .join(\", \")}`\n    );\n  }\n  return jsNodes[0] as FunctionDeclaration;\n}\n","import { Expression } from \"@babel/types\";\nimport { parseAsEstreeExpression } from \"./parse.js\";\nimport { precook, PrecookOptions } from \"./precook.js\";\n\nexport type PreevaluateOptions = Omit<PrecookOptions, \"expressionOnly\">;\n\nexport interface PreevaluateResult {\n  expression: Expression;\n  attemptToVisitGlobals: Set<string>;\n  source: string;\n  prefix: string;\n  suffix: string;\n}\n\n// `raw` should always be asserted by `isEvaluable`.\nexport function preevaluate(\n  raw: string,\n  options?: PreevaluateOptions\n): PreevaluateResult {\n  const fixes: string[] = [];\n  const source = raw.replace(/^\\s*<%[~=]?\\s|\\s%>\\s*$/g, (m) => {\n    fixes.push(m);\n    return \"\";\n  });\n  const expression = parseAsEstreeExpression(source);\n  const attemptToVisitGlobals = precook(expression, {\n    ...options,\n    expressionOnly: true,\n  });\n  return {\n    expression,\n    attemptToVisitGlobals,\n    source,\n    prefix: fixes[0],\n    suffix: fixes[1],\n  };\n}\n\nexport function isEvaluable(raw: string): boolean {\n  return /^\\s*<%[~=]?\\s/.test(raw) && /\\s%>\\s*$/.test(raw);\n}\n\nexport function shouldAllowRecursiveEvaluations(raw: string): boolean {\n  return /^\\s*<%~\\s/.test(raw);\n}\n\nexport function isTrackAll(raw: string): boolean {\n  return /^\\s*<%=\\s/.test(raw) && /\\s%>\\s*$/.test(raw);\n}\n","export const fetch = (\n  input: RequestInfo,\n  init?: RequestInit\n): Promise<Response> => {\n  // Support older browsers which default credentials is \"omit\".\n  // Ref https://github.com/whatwg/fetch/pull/585\n  const req = new Request(\n    input,\n    Object.assign<RequestInit, RequestInit | undefined>(\n      {\n        credentials: \"same-origin\",\n      },\n      init\n    )\n  );\n\n  return self.fetch(req);\n};\n","export class HttpFetchError extends Error {\n  constructor(message: string) {\n    // Pass remaining arguments (including vendor specific ones) to parent constructor\n    super(message);\n\n    this.name = \"HttpFetchError\";\n\n    // Maintains proper stack trace for where our error was thrown (only available on V8)\n    // istanbul ignore else\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, HttpFetchError);\n    }\n  }\n}\n\nexport class HttpResponseError extends Error {\n  response: Response;\n  responseJson: any;\n\n  constructor(response: Response, responseJson?: any) {\n    // Pass remaining arguments (including vendor specific ones) to parent constructor\n    super(response.statusText);\n\n    this.name = \"HttpResponseError\";\n\n    // Maintains proper stack trace for where our error was thrown (only available on V8)\n    // istanbul ignore else\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, HttpResponseError);\n    }\n\n    this.response = response;\n    this.responseJson = responseJson;\n  }\n}\n\nexport class HttpParseError extends Error {\n  response: Response;\n\n  constructor(response: Response) {\n    // Pass remaining arguments (including vendor specific ones) to parent constructor\n    super(response.statusText);\n\n    this.name = \"HttpParseError\";\n\n    // Maintains proper stack trace for where our error was thrown (only available on V8)\n    // istanbul ignore else\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, HttpParseError);\n    }\n\n    this.response = response;\n  }\n}\n\nexport class HttpAbortError extends Error {\n  constructor(message: string) {\n    super(message);\n    this.name = \"HttpAbortError\";\n  }\n}\n","import type { HttpError } from \"./http.js\";\n\nexport interface InterceptorHandlers<T, C = never> {\n  fulfilled?: (value: T, config: C) => T | Promise<T>;\n  rejected?: (error: HttpError, config: C) => HttpError | Promise<HttpError>;\n}\n\nexport default class InterceptorManager<T, C = never> {\n  handlers: (InterceptorHandlers<T, C> | null)[] = [];\n\n  use(\n    onFulfilled?: (value: T, config: C) => T | Promise<T>,\n    onRejected?: (error: HttpError, config: C) => HttpError | Promise<HttpError>\n  ): number {\n    this.handlers.push({\n      fulfilled: onFulfilled,\n      rejected: onRejected,\n    });\n\n    return this.handlers.length - 1;\n  }\n\n  eject(id: number): void {\n    // istanbul ignore else\n    if (this.handlers[id]) {\n      this.handlers[id] = null;\n    }\n  }\n\n  forEach(fn: (h: InterceptorHandlers<T, C>) => void): void {\n    this.handlers.forEach((handler) => {\n      // istanbul ignore else\n      if (handler !== null) {\n        fn(handler);\n      }\n    });\n  }\n}\n","import { fetch } from \"./fetch.js\";\nimport {\n  HttpAbortError,\n  HttpFetchError,\n  HttpParseError,\n  HttpResponseError,\n} from \"./errors.js\";\nimport InterceptorManager from \"./InterceptorManager.js\";\n\nexport interface HttpRequestConfig {\n  url: string;\n  method: string;\n  data?: unknown;\n  options?: HttpOptions;\n  [key: symbol]: unknown;\n}\n\nexport interface HttpResponse<T = unknown> {\n  data: T;\n  status: number;\n  statusText: string;\n  headers: Headers;\n}\n\nexport type HttpError =\n  | HttpFetchError\n  | HttpResponseError\n  | HttpParseError\n  | HttpAbortError;\n\nexport interface HttpAdapter {\n  (config: HttpRequestConfig): Promise<HttpResponse<unknown>>;\n}\n\nexport interface HttpConstructorOptions {\n  adapter?: HttpAdapter;\n}\n\nfunction isNil(value: unknown): value is null | undefined {\n  return value === undefined || value === null;\n}\n\nconst base = document.querySelector(\"base\");\nconst fullBaseHref = base ? base.href : location.origin + \"/\";\n\nexport type HttpParams = URLSearchParams | object;\n\nexport interface RequestCustomOptions {\n  observe?: \"data\" | \"response\";\n  responseType?: \"json\" | \"blob\" | \"arrayBuffer\" | \"text\";\n  interceptorParams?: {\n    ignoreLoadingBar?: boolean;\n  };\n  noAbortOnRouteChange?: boolean;\n  useCache?: boolean;\n}\n\nexport type HttpCustomOptions = RequestCustomOptions & {\n  params?: HttpParams;\n};\n\nexport type HttpOptions = HttpCustomOptions & RequestInit;\n\n/**\n * Detect whether the input is a native browser abort error.\n *\n * @ref https://developer.mozilla.org/en-US/docs/Web/API/DOMException\n */\nexport const isHttpAbortError = (error: any) =>\n  error instanceof DOMException && error.code === 20;\n\nconst request = async <T>(\n  url: string,\n  init: RequestInit,\n  config: HttpRequestConfig\n): Promise<HttpResponse<T>> => {\n  // eslint-disable-next-line no-async-promise-executor\n  return new Promise(async (resolve, reject) => {\n    let response: Response;\n    config.url = url;\n\n    let { responseType } = config.options || {};\n\n    if (!responseType) {\n      // Defaults to `json`\n      responseType = \"json\";\n    }\n\n    try {\n      response = await fetch(url, init);\n    } catch (e: any) {\n      reject(\n        isHttpAbortError(e)\n          ? new HttpAbortError(e.toString())\n          : new HttpFetchError(e.toString())\n      );\n      return;\n    }\n\n    if (!response.ok) {\n      let responseJson;\n      try {\n        responseJson = await response.json();\n      } catch (e) {\n        // Do nothing.\n      }\n      reject(new HttpResponseError(response, responseJson));\n      return;\n    }\n\n    let data: T;\n    try {\n      data = await response[responseType]();\n    } catch (e: any) {\n      reject(\n        isHttpAbortError(e)\n          ? new HttpAbortError(e.toString())\n          : new HttpParseError(response)\n      );\n      return;\n    }\n\n    const res: HttpResponse<T> = {\n      status: response.status,\n      statusText: response.statusText,\n      headers: response.headers,\n      data,\n    };\n\n    resolve(res);\n  });\n};\n\nexport const getUrlWithParams = (url: string, params?: HttpParams): string => {\n  if (params) {\n    const parsedUrl = new URL(url, fullBaseHref);\n    if (params instanceof URLSearchParams) {\n      params.forEach(function (value, key) {\n        parsedUrl.searchParams.append(key, value);\n      });\n    } else {\n      Object.entries(params).forEach(([key, value]) => {\n        if (Array.isArray(value)) {\n          value.forEach((v) => {\n            parsedUrl.searchParams.append(key, isNil(v) ? \"\" : v);\n          });\n        } else {\n          parsedUrl.searchParams.append(key, isNil(value) ? \"\" : value);\n        }\n      });\n    }\n    const { href } = parsedUrl;\n    if (href.startsWith(fullBaseHref)) {\n      return href.substr(fullBaseHref.length);\n    }\n    return href;\n  }\n  return url;\n};\n\nconst getBodyAndHeaders = (\n  data: unknown,\n  headers?: HeadersInit\n): { body?: BodyInit; headers?: HeadersInit } => {\n  if (data !== undefined) {\n    // `new Headers(undefined)` will throw a TypeError in older browsers (chrome 58).\n    // https://bugs.chromium.org/p/chromium/issues/detail?id=335871\n    const parsedHeaders = new Headers(headers || {});\n    const contentTypeHeader = \"Content-Type\";\n    let body = data as BodyInit | undefined;\n    // If `Content-Type` already provided, ignore detecting content type.\n    if (!parsedHeaders.has(contentTypeHeader)) {\n      if (typeof data === \"string\") {\n        parsedHeaders.set(\n          contentTypeHeader,\n          \"application/x-www-form-urlencoded\"\n        );\n      } else if (data instanceof FormData) {\n        // Do nothing\n      } else {\n        parsedHeaders.set(contentTypeHeader, \"application/json\");\n        body = JSON.stringify(data);\n      }\n    }\n    return {\n      body,\n      headers: parsedHeaders,\n    };\n  }\n  return { headers };\n};\n\nconst simpleRequest = <T = unknown>(\n  method: string,\n  url: string,\n  config: HttpRequestConfig\n): Promise<HttpResponse<T>> => {\n  const {\n    params,\n    /* eslint-disable @typescript-eslint/no-unused-vars */\n    responseType,\n    interceptorParams,\n    observe,\n    noAbortOnRouteChange,\n    useCache,\n    /* eslint-enable @typescript-eslint/no-unused-vars */\n    ...requestInit\n  } = config.options || {};\n  return request<T>(\n    getUrlWithParams(url, params),\n    {\n      ...requestInit,\n      method,\n    },\n    config\n  );\n};\n\nconst requestWithBody = <T = unknown>(\n  method: string,\n  url: string,\n  data: unknown,\n  config: HttpRequestConfig\n): Promise<HttpResponse<T>> => {\n  const {\n    params,\n    headers,\n    /* eslint-disable @typescript-eslint/no-unused-vars */\n    responseType,\n    interceptorParams,\n    observe,\n    noAbortOnRouteChange,\n    useCache,\n    /* eslint-enable @typescript-eslint/no-unused-vars */\n    ...requestInit\n  } = config.options || {};\n  return request<T>(\n    getUrlWithParams(url, params),\n    {\n      ...requestInit,\n      method,\n      ...getBodyAndHeaders(data, headers),\n    },\n    config\n  );\n};\n\nconst defaultAdapter: HttpAdapter = <T>(config: HttpRequestConfig) => {\n  const { url, method, data } = config;\n\n  // \"DELETE\", \"GET\", \"HEAD\" methods.\n  if ([\"DELETE\", \"GET\", \"HEAD\"].includes(config.method)) {\n    return simpleRequest<T>(method, url, config);\n  }\n\n  // \"POST\", \"PUT\" , \"PATCH\" methods.\n  return requestWithBody<T>(method, url, data, config);\n};\n\nclass Http {\n  public readonly interceptors: {\n    request: InterceptorManager<HttpRequestConfig>;\n    response: InterceptorManager<HttpResponse, HttpRequestConfig>;\n  };\n\n  #adapter: HttpAdapter = defaultAdapter;\n\n  constructor(config?: HttpConstructorOptions) {\n    this.interceptors = {\n      request: new InterceptorManager(),\n      response: new InterceptorManager(),\n    };\n\n    if (config?.adapter) {\n      this.#adapter = config.adapter;\n    }\n  }\n\n  request = async <T = unknown>(\n    url: string,\n    init?: RequestInit,\n    options?: RequestCustomOptions\n  ): Promise<T> => {\n    const { body, method, ...requestInit } = init || {};\n    return this.#fetch<T>({\n      url,\n      data: body,\n      method: method || \"GET\",\n      options: { ...(options || {}), ...requestInit },\n    });\n  };\n\n  simpleRequest = <T = unknown>(\n    method: string,\n    url: string,\n    options: HttpOptions = {}\n  ): Promise<T> => {\n    return this.#fetch<T>({ url, method, options });\n  };\n\n  requestWithBody = <T = unknown>(\n    method: string,\n    url: string,\n    data?: unknown,\n    options: HttpOptions = {}\n  ): Promise<T> => {\n    return this.#fetch<T>({ url, method, data, options });\n  };\n\n  #fetch<T>(config: HttpRequestConfig): Promise<T> {\n    const chain: any[] = [];\n    let promise: Promise<any> = Promise.resolve(config);\n\n    this.interceptors.request.forEach((interceptor) => {\n      chain.push(interceptor.fulfilled, interceptor.rejected);\n    });\n\n    chain.push((config: HttpRequestConfig) => this.#adapter(config), undefined);\n\n    this.interceptors.response.forEach((interceptor) => {\n      chain.push(\n        (res: HttpResponse) => interceptor.fulfilled?.(res, config),\n        (error: HttpError) => interceptor.rejected?.(error, config)\n      );\n    });\n\n    chain.push((response: HttpResponse) => {\n      return config.options?.observe === \"response\" ? response : response.data;\n    }, undefined);\n\n    while (chain.length) {\n      promise = promise.then(chain.shift(), chain.shift());\n    }\n\n    return promise;\n  }\n\n  getUrlWithParams(url: string, params?: HttpParams): string {\n    return getUrlWithParams(url, params);\n  }\n\n  getBodyAndHeaders(\n    data: unknown,\n    headers: HeadersInit\n  ): { body?: BodyInit; headers?: HeadersInit } {\n    return getBodyAndHeaders(data, headers);\n  }\n\n  get<T>(url: string, options?: HttpOptions): Promise<T> {\n    return this.#fetch({ url, method: \"GET\", options });\n  }\n\n  delete<T>(url: string, options?: HttpOptions): Promise<T> {\n    return this.#fetch({ url, method: \"DELETE\", options });\n  }\n\n  head<T>(url: string, options?: HttpOptions): Promise<T> {\n    return this.#fetch({ url, method: \"HEAD\", options });\n  }\n\n  post<T>(url: string, data?: unknown, options?: HttpOptions): Promise<T> {\n    return this.#fetch({ url, method: \"POST\", data, options });\n  }\n\n  put<T>(url: string, data?: unknown, options?: HttpOptions): Promise<T> {\n    return this.#fetch({ url, method: \"PUT\", data, options });\n  }\n\n  patch<T>(url: string, data?: unknown, options?: HttpOptions): Promise<T> {\n    return this.#fetch({\n      url,\n      method: \"PATCH\",\n      data,\n      options,\n    });\n  }\n}\n\nlet http = new Http();\nfunction createHttpInstance(config?: HttpConstructorOptions): void {\n  http = new Http(config);\n}\nexport { http, createHttpInstance, defaultAdapter };\n","export * from \"./cook.js\";\nexport * from \"./precook.js\";\nexport * from \"./precookFunction.js\";\nexport * from \"./preevaluate.js\";\nexport * from \"./interfaces.js\";\n// export { tokTypes } from \"@babel/parser\";\n","import { i18n } from \"@next-core/i18n\";\nimport LanguageDetector from \"i18next-browser-languagedetector\";\n\nlet initialized = false;\nconst initializedNamespaces = new Set<string>();\n\nexport type Locales = Record<string, Record<string, string>>;\n\nexport function initializeI18n(): void;\nexport function initializeI18n(NS: string, locales: Locales): void;\nexport function initializeI18n(NS?: string, locales?: Locales) {\n  if (!initialized) {\n    initialized = true;\n    i18n\n      // learn more: https://github.com/i18next/i18next-xhr-backend\n      // .use(Backend)\n      // learn more: https://github.com/i18next/i18next-browser-languageDetector\n      .use(\n        process.env.NODE_ENV === \"test\"\n          ? (LanguageDetector as unknown as LanguageDetector.default)\n          : /* istanbul ignore next */ LanguageDetector.default\n      )\n      // for all options read: https://www.i18next.com/overview/configuration-options\n      .init({\n        fallbackLng: \"zh\",\n        debug: process.env.NODE_ENV === \"development\",\n        supportedLngs: [\"zh\", \"en\"],\n        nonExplicitSupportedLngs: true,\n        interpolation: {\n          escapeValue: false, // not needed for react as it escapes by default\n        },\n        react: {\n          useSuspense: false,\n        },\n        compatibilityJSON: \"v3\",\n        resources: {},\n      });\n  }\n\n  if (!NS || !locales || initializedNamespaces.has(NS)) {\n    return;\n  }\n  initializedNamespaces.add(NS);\n  for (const [lang, resources] of Object.entries(locales)) {\n    i18n.addResourceBundle(lang, NS, resources);\n  }\n}\n","import { i18n } from \"@next-core/i18n\";\nimport { hasOwnProperty } from \"@next-core/utils/general\";\nimport { I18nData } from \"@next-core/types\";\n\nexport function i18nText(\n  data: I18nData | null | undefined\n): string | undefined {\n  if (!data) {\n    return;\n  }\n  const language = i18n.language ?? \"zh-CN\";\n  // First, make a perfect match.\n  if (hasOwnProperty(data, language)) {\n    return data[language];\n  }\n  // https://en.wikipedia.org/wiki/IETF_language_tag\n  const primaryLanguage = language.split(\"-\")[0];\n  if (primaryLanguage !== language) {\n    // Then, match the primary language (which omits other subtags).\n    // E.g., match `zh` if the current language is `zh-CN`.\n    return hasOwnProperty(data, primaryLanguage)\n      ? data[primaryLanguage]\n      : undefined;\n  }\n  // At last, match the first key which starts with the primary language,\n  // if the current language contains primary subtag only.\n  // E.g., match `zh-CN` if the current language is `zh`.\n  const prefix = `${primaryLanguage}-`;\n  for (const key of Object.keys(data)) {\n    if (key.startsWith(prefix)) {\n      return data[key];\n    }\n  }\n}\n","import { Node, SourceLocation, PipeCall } from \"@next-core/pipes\";\n\nexport enum LexicalStatus {\n  Initial,\n  ExpectField,\n  ExpectOptionalBeginDefault,\n  ExpectDefaultValue,\n  ExpectOptionalBeginPipe,\n  ExpectPipeIdentifier,\n  ExpectOptionalBeginPipeParameter,\n  ExpectPipeParameter,\n  ExpectPlaceholderEnd,\n}\n\nexport enum TokenType {\n  Raw = \"Raw\",\n  BeginPlaceHolder = \"BeginPlaceHolder\",\n  Field = \"Field\",\n  BeginDefault = \"BeginDefault\",\n  LiteralString = \"LiteralString\",\n  BeginPipe = \"BeginPipe\",\n  PipeIdentifier = \"PipeIdentifier\",\n  BeginPipeParameter = \"BeginPipeParameter\",\n  EndPlaceHolder = \"EndPlaceHolder\",\n  JsonValue = \"JsonValue\",\n}\n\nexport enum JsonValueType {\n  Array,\n  Object,\n  String,\n  Others,\n}\n\nexport interface LexicalContext {\n  beginPlaceholder: RegExp;\n  raw: string;\n  cursor: number;\n  status: LexicalStatus;\n  tokens: Token[];\n}\n\nexport interface Token {\n  type: TokenType;\n  value?: any;\n  loc?: SourceLocation;\n}\n\nexport interface InjectableString extends Node {\n  type: \"InjectableString\";\n  elements: (RawString | Placeholder)[];\n}\n\nexport interface RawString extends Node {\n  type: \"RawString\";\n  value: string;\n}\n\nexport interface Placeholder extends Node {\n  type: \"Placeholder\";\n  symbol: string;\n  field: string;\n  defaultValue: any;\n  pipes: PipeCall[];\n}\n","import { escapeRegExp } from \"lodash\";\nimport {\n  LexicalContext,\n  LexicalStatus,\n  Token,\n  TokenType,\n  JsonValueType,\n} from \"./interfaces.js\";\n\nexport function getRegExpOfPlaceholder(symbols: string | string[]): RegExp {\n  return new RegExp(\n    `(${([] as string[])\n      .concat(symbols)\n      .map((symbol) => escapeRegExp(symbol))\n      .join(\"|\")})\\\\{`\n  );\n}\n\nexport function tokenize(raw: string, symbols: string | string[]): Token[] {\n  const context: LexicalContext = {\n    beginPlaceholder: getRegExpOfPlaceholder(symbols),\n    raw,\n    cursor: 0,\n    status: LexicalStatus.Initial,\n    tokens: [],\n  };\n  while (context.cursor < raw.length) {\n    switch (context.status) {\n      case LexicalStatus.Initial:\n        eatOptionalRawAndOptionalPlaceholderBegin(context);\n        break;\n      case LexicalStatus.ExpectField:\n        eatWhitespace(context);\n        eatField(context);\n        break;\n      case LexicalStatus.ExpectOptionalBeginDefault:\n        eatWhitespace(context);\n        eatOptionalDefault(context);\n        break;\n      case LexicalStatus.ExpectDefaultValue:\n        eatWhitespace(context);\n        eatDefaultValue(context);\n        break;\n      case LexicalStatus.ExpectOptionalBeginPipe:\n        eatWhitespace(context);\n        eatOptionalBeginPipe(context);\n        break;\n      case LexicalStatus.ExpectPipeIdentifier:\n        eatWhitespace(context);\n        eatPipeIdentifier(context);\n        break;\n      case LexicalStatus.ExpectOptionalBeginPipeParameter:\n        eatWhitespace(context);\n        eatOptionalBeginPipeParameter(context);\n        break;\n      case LexicalStatus.ExpectPipeParameter:\n        eatWhitespace(context);\n        eatPipeParameter(context);\n        break;\n      case LexicalStatus.ExpectPlaceholderEnd:\n        eatWhitespace(context);\n        eatPlaceholderEnd(context);\n        break;\n    }\n  }\n  if (context.status !== LexicalStatus.Initial) {\n    throw new Error(\"Expected a placeholder end '}' at the end\");\n  }\n  return context.tokens;\n}\n\nfunction eatOptionalRawAndOptionalPlaceholderBegin(\n  context: LexicalContext\n): void {\n  const subRaw = getSubRaw(context);\n  const matchedPlaceholder = subRaw.match(context.beginPlaceholder)?.[0];\n  const subCursor = matchedPlaceholder\n    ? subRaw.indexOf(matchedPlaceholder)\n    : -1;\n  if (\n    subCursor >= 0 &&\n    matchedPlaceholder &&\n    subRaw.charAt(subCursor + matchedPlaceholder.length) !== \"{\"\n  ) {\n    const nextCursor = context.cursor + subCursor;\n    if (subCursor > 0) {\n      context.tokens.push({\n        type: TokenType.Raw,\n        value: subRaw.substring(0, subCursor),\n      });\n    }\n    context.tokens.push({\n      type: TokenType.BeginPlaceHolder,\n      loc: {\n        start: nextCursor,\n        end: nextCursor + matchedPlaceholder.length,\n      },\n      value: matchedPlaceholder.substring(0, matchedPlaceholder.length - 1),\n    });\n    context.cursor += subCursor + matchedPlaceholder.length;\n    context.status = LexicalStatus.ExpectField;\n  } else {\n    context.tokens.push({\n      type: TokenType.Raw,\n      value: subRaw,\n    });\n    context.cursor = context.raw.length;\n  }\n}\n\nfunction eatWhitespace(context: LexicalContext): void {\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  context.cursor += getSubRaw(context).match(/^[ \\r\\n\\t]*/)![0].length;\n}\n\nfunction eatField(context: LexicalContext): void {\n  // Only allow alphanumeric, `_`, `.`, `*`, `[`, `]`, `-` and other non-ascii.\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  const [value] = getSubRaw(context).match(/^[\\w.*[\\]\\-\\u{80}-\\u{10FFFF}]*/u)!;\n  context.tokens.push({\n    type: TokenType.Field,\n    value,\n  });\n  context.cursor += value.length;\n  context.status = LexicalStatus.ExpectOptionalBeginDefault;\n}\n\nfunction eatOptionalDefault(context: LexicalContext): void {\n  if (getSubRaw(context).charAt(0) === \"=\") {\n    context.tokens.push({\n      type: TokenType.BeginDefault,\n    });\n    context.cursor += 1;\n    context.status = LexicalStatus.ExpectDefaultValue;\n  } else {\n    context.status = LexicalStatus.ExpectOptionalBeginPipe;\n  }\n}\n\nfunction eatDefaultValue(context: LexicalContext): void {\n  eatJsonValueOrLiteralString(context, LexicalStatus.ExpectOptionalBeginPipe);\n}\n\nfunction eatOptionalBeginPipe(context: LexicalContext): void {\n  if (getSubRaw(context).charAt(0) === \"|\") {\n    context.tokens.push({\n      type: TokenType.BeginPipe,\n    });\n    context.cursor += 1;\n    context.status = LexicalStatus.ExpectPipeIdentifier;\n  } else {\n    context.status = LexicalStatus.ExpectPlaceholderEnd;\n  }\n}\n\nfunction eatPipeIdentifier(context: LexicalContext): void {\n  const matches = getSubRaw(context).match(/^[a-zA-Z]\\w*/);\n  if (!matches) {\n    throw new Error(\n      `Expected a pipe identifier at index ${\n        context.cursor\n      } near: ${JSON.stringify(context.raw.substring(context.cursor))}`\n    );\n  }\n  const value = matches[0];\n  context.tokens.push({\n    type: TokenType.PipeIdentifier,\n    value,\n  });\n  context.cursor += value.length;\n  context.status = LexicalStatus.ExpectOptionalBeginPipeParameter;\n}\n\nfunction eatOptionalBeginPipeParameter(context: LexicalContext): void {\n  if (getSubRaw(context).charAt(0) === \":\") {\n    context.tokens.push({\n      type: TokenType.BeginPipeParameter,\n    });\n    context.cursor += 1;\n    context.status = LexicalStatus.ExpectPipeParameter;\n  } else {\n    context.status = LexicalStatus.ExpectOptionalBeginPipe;\n  }\n}\n\nfunction eatPipeParameter(context: LexicalContext): void {\n  eatJsonValueOrLiteralString(\n    context,\n    LexicalStatus.ExpectOptionalBeginPipeParameter\n  );\n}\n\nfunction eatPlaceholderEnd(context: LexicalContext): void {\n  if (getSubRaw(context).charAt(0) === \"}\") {\n    context.tokens.push({\n      type: TokenType.EndPlaceHolder,\n      loc: {\n        start: context.cursor,\n        end: context.cursor + 1,\n      },\n    });\n    context.cursor += 1;\n    context.status = LexicalStatus.Initial;\n  } else {\n    throw new Error(\n      `Expected a placeholder end '}' at index ${\n        context.cursor\n      } near: ${JSON.stringify(context.raw.substring(context.cursor))}`\n    );\n  }\n}\n\nconst jsonLiteralMap = new Map([\n  [\"false\", false],\n  [\"null\", null],\n  [\"true\", true],\n]);\n\nfunction eatJsonValueOrLiteralString(\n  context: LexicalContext,\n  nextStatus: LexicalStatus\n): void {\n  const subRaw = getSubRaw(context);\n  if (\n    /[0-9[{\"]/.test(subRaw.charAt(0)) ||\n    /-[0-9]/.test(subRaw.substring(0, 2))\n  ) {\n    eatJsonValue(context, nextStatus);\n  } else {\n    // Accept any characters except controls and whitespace.\n    // Only allow alphanumeric, `_`, `-` and other non-ascii.\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    const [value] = getSubRaw(context).match(/^[\\w\\-\\u{80}-\\u{10FFFF}]*/u)!;\n\n    if (jsonLiteralMap.has(value)) {\n      context.tokens.push({\n        type: TokenType.JsonValue,\n        value: jsonLiteralMap.get(value),\n      });\n    } else {\n      context.tokens.push({\n        type: TokenType.LiteralString,\n        value,\n      });\n    }\n\n    context.cursor += value.length;\n    context.status = nextStatus;\n  }\n}\n\n// 我们不需要非常精确地在一段字符串中匹配出一段*完整合法的* JSON value，\n// 而只需要找到一段*可能是完整合法的* JSON value 即可，解析的工作交给 `JSON.parse()`。\n// 由于 JSON 中 object/array/string 的镜像起止符特性，我们尝试去完成这些符号匹配即可。\nfunction eatJsonValue(\n  context: LexicalContext,\n  nextStatus: LexicalStatus\n): void {\n  const subRaw = getSubRaw(context);\n  const firstChar = subRaw.charAt(0);\n  const valueType: JsonValueType =\n    firstChar === \"[\"\n      ? JsonValueType.Array\n      : firstChar === \"{\"\n      ? JsonValueType.Object\n      : firstChar === '\"'\n      ? JsonValueType.String\n      : JsonValueType.Others;\n\n  let subCursor = 0;\n  let objectBracesToMatch = 0;\n  let arrayBracketsToMatch = 0;\n  let stringQuotesToClose = false;\n  let stringBackslashToEscape = false;\n  let matched = false;\n\n  while (subCursor < subRaw.length) {\n    const char = subRaw.charAt(subCursor);\n    if (stringBackslashToEscape) {\n      stringBackslashToEscape = false;\n    } else if (stringQuotesToClose) {\n      if (char === '\"') {\n        stringQuotesToClose = false;\n      } else if (char === \"\\\\\") {\n        stringBackslashToEscape = true;\n      }\n    } else {\n      switch (char) {\n        case \"[\":\n          arrayBracketsToMatch += 1;\n          break;\n        case \"{\":\n          objectBracesToMatch += 1;\n          break;\n        case \"]\":\n          arrayBracketsToMatch -= 1;\n          break;\n        case \"}\":\n          objectBracesToMatch -= 1;\n          break;\n        case '\"':\n          stringQuotesToClose = true;\n          break;\n      }\n    }\n\n    subCursor += 1;\n\n    switch (valueType) {\n      case JsonValueType.Array:\n        matched = !arrayBracketsToMatch;\n        break;\n      case JsonValueType.Object:\n        matched = !objectBracesToMatch;\n        break;\n      case JsonValueType.String:\n        matched = !stringQuotesToClose;\n        break;\n      default:\n        // 对于其它类型，如果下一个字符不再是这些值类型可能的字符时，我们认为 JSON value 完成匹配。\n        // 其它可能的值类型：number/boolean/null/undefined。\n        matched =\n          subCursor < subRaw.length &&\n          /[^a-z0-9E.+-]/.test(subRaw.charAt(subCursor));\n    }\n\n    if (matched) {\n      break;\n    }\n  }\n\n  if (!matched) {\n    throw new Error(\n      `Failed to match a JSON value at index ${\n        context.cursor\n      } near: ${JSON.stringify(context.raw.substring(context.cursor))}`\n    );\n  }\n\n  context.tokens.push({\n    type: TokenType.JsonValue,\n    value: JSON.parse(subRaw.substring(0, subCursor)),\n  });\n  context.cursor += subCursor;\n  context.status = nextStatus;\n}\n\nfunction getSubRaw(context: LexicalContext): string {\n  return context.raw.substring(context.cursor);\n}\n","import { get } from \"lodash\";\nimport type { Location } from \"history\";\nimport type { FeatureFlags, MicroApp } from \"@next-core/types\";\nimport { processPipes } from \"@next-core/pipes\";\nimport { parseInjectableString } from \"./syntax.js\";\nimport type { Placeholder } from \"./interfaces.js\";\nimport { getRegExpOfPlaceholder } from \"./lexical.js\";\n\nexport interface LegacyCompatibleRuntimeContext {\n  app: MicroApp;\n  overrideApp?: MicroApp;\n  location: Location;\n  query: URLSearchParams;\n  /** {@inheritDoc FeatureFlags} */\n  flags: FeatureFlags;\n  /** 系统运行时信息，包括登录信息和页面信息。 */\n  sys: Record<string, unknown>;\n  match?: {\n    path: string;\n    url: string;\n    isExact: boolean;\n    params: Record<string, string>;\n  };\n  event?: Event;\n  data?: unknown;\n}\n\nexport function transform(\n  raw: string,\n  context: LegacyCompatibleRuntimeContext\n): unknown {\n  return compile(raw, \"@\", context);\n}\n\nexport function inject(\n  raw: string,\n  context: LegacyCompatibleRuntimeContext\n): unknown {\n  return compile(raw, \"$\", context);\n}\n\nexport function transformAndInject(\n  raw: string,\n  context: LegacyCompatibleRuntimeContext\n): unknown {\n  return compile(raw, [\"@\", \"$\"], context);\n}\n\ntype CompileNode = (node: Placeholder) => unknown;\n\nfunction compile(\n  raw: string,\n  symbols: string | string[],\n  context: LegacyCompatibleRuntimeContext\n): unknown {\n  // const symbols = [\"@\", \"$\"];\n  if (!isInjectable(raw, symbols)) {\n    return raw;\n  }\n\n  const transformNode = transformNodeFactory(context.data);\n  const injectNode = injectNodeFactory(context, raw);\n\n  const tree = parseInjectableString(raw, symbols);\n  const values = tree.elements.map((node) =>\n    node.type === \"RawString\"\n      ? node.value\n      : node.symbol === \"$\"\n      ? injectNode(node)\n      : transformNode(node)\n  );\n\n  return reduceCompiledValues(values);\n}\n\nfunction reduceCompiledValues(values: unknown[]): unknown {\n  // If the whole string is a placeholder, we should keep the original value.\n  if (values.length === 1) {\n    return values[0];\n  }\n\n  // If an element is `undefined`, `null` or an empty array `[]`, it is converted to an empty string.\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/join#Description\n  return values.join(\"\");\n}\n\nfunction isInjectable(raw: string, symbols?: string | string[]): boolean {\n  return getRegExpOfPlaceholder(symbols).test(raw);\n}\n\nfunction transformNodeFactory(data: unknown): CompileNode {\n  return function transformNode(node: Placeholder): unknown {\n    // If meet `@{}`, return `data`.\n    let result = node.field ? get(data, node.field) : data;\n\n    if (result === undefined) {\n      result = node.defaultValue;\n    }\n\n    return processPipes(result, node.pipes);\n  };\n}\n\nfunction injectNodeFactory(\n  context: LegacyCompatibleRuntimeContext,\n  raw: string\n): CompileNode {\n  return function injectNode(node: Placeholder): unknown {\n    const matches = node.field.match(\n      /^(?:(QUERY(?:_ARRAY)?|EVENT|query|event|APP|HASH|ANCHOR|SYS|FLAGS|CTX)\\.)?(.+)$/\n    );\n    if (!matches) {\n      // Keep the original raw partial when meet a unknown namespace.\n      return raw.substring(node.loc.start, node.loc.end);\n    }\n    let [, namespace, subField] = matches;\n\n    // Support namespace with no subfield such as `${ANCHOR}`.\n    // But distinguish with match params. E.g. `${query}` is a match param.\n    if (!namespace && /^[A-Z_]+$/.test(subField)) {\n      namespace = subField;\n      subField = \"*\";\n    }\n\n    let result: unknown;\n    const SimpleContextMap: Record<string, \"sys\" | \"flags\"> = {\n      SYS: \"sys\",\n      FLAGS: \"flags\",\n    };\n\n    switch (namespace) {\n      case \"QUERY\":\n      case \"query\":\n        if (subField === \"*\") {\n          result = context.query;\n        } else {\n          result = context.query.has(subField)\n            ? context.query.get(subField)\n            : undefined;\n        }\n        break;\n      case \"QUERY_ARRAY\":\n        result = context.query.has(subField)\n          ? context.query.getAll(subField)\n          : undefined;\n        break;\n      case \"EVENT\":\n      case \"event\":\n        if (context.event === undefined) {\n          // Keep the original raw partial when meet a `${EVENT}` in non-event context.\n          return raw.substring(node.loc.start, node.loc.end);\n        }\n        result =\n          subField === \"*\" ? context.event : get(context.event, subField);\n        break;\n      case \"APP\":\n        result =\n          subField === \"*\"\n            ? context.overrideApp ?? context.app\n            : get(context.overrideApp ?? context.app, subField);\n        break;\n      case \"HASH\":\n        result = context.location.hash;\n        break;\n      case \"SYS\":\n      case \"FLAGS\":\n        result =\n          subField === \"*\"\n            ? context[SimpleContextMap[namespace]]\n            : get(context[SimpleContextMap[namespace]], subField);\n        break;\n      case \"ANCHOR\": {\n        const anchor = context.location.hash\n          ? context.location.hash.substr(1)\n          : null;\n        result = subField === \"*\" ? anchor : get(anchor, subField);\n        break;\n      }\n      case \"CTX\": {\n        const original = raw.substring(node.loc.start, node.loc.end);\n        // eslint-disable-next-line no-console\n        console.error(\n          `CTX is not supported in placeholder any more: \"${original}\"`\n        );\n        return original;\n      }\n      default:\n        if (context.match) {\n          result = context.match.params[subField];\n        } else {\n          // If the context is empty, return the original raw partial.\n          return raw.substring(node.loc.start, node.loc.end);\n        }\n    }\n\n    if (result === undefined) {\n      result = node.defaultValue;\n    }\n\n    return processPipes(result, node.pipes);\n  };\n}\n","import { PipeCall } from \"@next-core/pipes\";\nimport { tokenize } from \"./lexical.js\";\nimport {\n  Token,\n  TokenType,\n  InjectableString,\n  Placeholder,\n} from \"./interfaces.js\";\n\nexport function parseInjectableString(\n  raw: string,\n  symbols: string | string[]\n): InjectableString {\n  return parseTokens(tokenize(raw, symbols));\n}\n\nfunction parseTokens(tokens: Token[]): InjectableString {\n  const tree: InjectableString = {\n    type: \"InjectableString\",\n    elements: [],\n  };\n\n  let token: Token | undefined;\n\n  function optionalToken(type: TokenType): boolean {\n    if (type === tokens[0].type) {\n      token = tokens.shift();\n      return true;\n    }\n    return false;\n  }\n\n  function acceptToken(type: TokenType | TokenType[]): void {\n    token = tokens.shift() as Token;\n    if (\n      Array.isArray(type) ? !type.includes(token.type) : type !== token.type\n    ) {\n      throw new Error(`Expected token: ${type}, received token: ${token.type}`);\n    }\n  }\n\n  while (tokens.length > 0) {\n    if (optionalToken(TokenType.Raw)) {\n      tree.elements.push({\n        type: \"RawString\",\n        value: token.value,\n      });\n    } else {\n      acceptToken(TokenType.BeginPlaceHolder);\n      const start = token.loc.start;\n      const symbol = token.value;\n      acceptToken(TokenType.Field);\n\n      const placeholder: Placeholder = {\n        type: \"Placeholder\",\n        symbol,\n        field: token.value,\n        defaultValue: undefined,\n        pipes: [],\n        loc: {\n          start,\n          end: start,\n        },\n      };\n      tree.elements.push(placeholder);\n\n      if (optionalToken(TokenType.BeginDefault)) {\n        acceptToken([TokenType.JsonValue, TokenType.LiteralString]);\n        placeholder.defaultValue = token.value;\n      }\n\n      while (optionalToken(TokenType.BeginPipe)) {\n        acceptToken(TokenType.PipeIdentifier);\n        const pipe: PipeCall = {\n          type: \"PipeCall\",\n          identifier: token.value,\n          parameters: [],\n        };\n        placeholder.pipes.push(pipe);\n\n        while (optionalToken(TokenType.BeginPipeParameter)) {\n          acceptToken([TokenType.JsonValue, TokenType.LiteralString]);\n          pipe.parameters.push(token.value);\n        }\n      }\n\n      acceptToken(TokenType.EndPlaceHolder);\n      placeholder.loc.end = token.loc.end;\n    }\n  }\n\n  return tree;\n}\n","const cache = new Map<string, Promise<string>>();\n\nexport default function loadScriptOrStyle(\n  type: \"script\" | \"style\",\n  src: string,\n  prefix?: string,\n  attrs?: Record<string, unknown>\n): Promise<string>;\nexport default function loadScriptOrStyle(\n  type: \"script\" | \"style\",\n  src: string[],\n  prefix?: string,\n  attrs?: Record<string, unknown>\n): Promise<string[]>;\nexport default function loadScriptOrStyle(\n  type: \"script\" | \"style\",\n  src: string | string[],\n  prefix?: string,\n  attrs?: Record<string, unknown>\n): Promise<string | string[]> {\n  if (Array.isArray(src)) {\n    return Promise.all(\n      src.map<Promise<string>>((item) => loadScriptOrStyle(type, item, prefix))\n    );\n  }\n  const fixedSrc = prefix && !/^https?:/.test(src) ? `${prefix}${src}` : src;\n  const cachedPromise = cache.get(fixedSrc);\n  if (cachedPromise) {\n    return cachedPromise;\n  }\n  const promise = new Promise<string>((resolve, reject) => {\n    const end = (): void => {\n      window.dispatchEvent(new Event(\"request.end\"));\n    };\n    const element = document.createElement(\n      type === \"style\" ? \"link\" : \"script\"\n    );\n    if (type === \"script\") {\n      Object.assign(element, {\n        type: \"text/javascript\",\n        async: true,\n        ...attrs,\n        src: fixedSrc,\n      });\n    } else {\n      Object.assign(element, {\n        rel: \"stylesheet\",\n        ...attrs,\n        href: fixedSrc,\n      });\n    }\n    element.onload = () => {\n      resolve(fixedSrc);\n      end();\n    };\n    element.onerror = (e) => {\n      reject(e);\n      end();\n    };\n    const firstScript =\n      document.currentScript || document.getElementsByTagName(\"script\")[0];\n    (firstScript.parentNode as Node).insertBefore(element, firstScript);\n    window.dispatchEvent(new Event(\"request.start\"));\n  });\n  cache.set(fixedSrc, promise);\n  return promise;\n}\n","import loadScriptOrStyle from \"./loadScriptOrStyle.js\";\n\nexport default function loadScript(\n  src: string,\n  prefix?: string,\n  attrs?: Record<string, unknown>\n): Promise<string>;\nexport default function loadScript(\n  src: string[],\n  prefix?: string,\n  attrs?: Record<string, unknown>\n): Promise<string[]>;\nexport default function loadScript(\n  src: string | string[],\n  prefix?: string,\n  attrs?: Record<string, unknown>\n): Promise<string | string[]> {\n  return loadScriptOrStyle(\"script\", src as string, prefix, attrs);\n}\n","import loadScriptOrStyle from \"./loadScriptOrStyle.js\";\n\nexport default function loadStyle(\n  src: string,\n  prefix?: string,\n  attrs?: Record<string, unknown>\n): Promise<string>;\nexport default function loadStyle(\n  src: string[],\n  prefix?: string,\n  attrs?: Record<string, unknown>\n): Promise<string[]>;\nexport default function loadStyle(\n  src: string | string[],\n  prefix?: string,\n  attrs?: Record<string, unknown>\n): Promise<string | string[]> {\n  return loadScriptOrStyle(\"style\", src as string, prefix, attrs);\n}\n","import loadScript from \"./loadScript.js\";\nimport loadSharedModule from \"./loadSharedModule.js\";\n\ninterface BrickPackage {\n  id: string;\n  filePath: string;\n  elements?: string[];\n  dependencies?: Record<string, string[]>;\n}\n\nlet resolveBasicPkg: () => void;\nlet basicPkgWillBeResolved = false;\nconst waitBasicPkg = new Promise<void>((resolve) => {\n  resolveBasicPkg = resolve;\n});\n\nexport function flushStableLoadBricks(): void {\n  if (!basicPkgWillBeResolved) {\n    resolveBasicPkg();\n  }\n}\n\n/**\n * When loading bundles with webpack module federation concurrently, if\n * these bundles share some modules, webpack will load a singleton module\n * if versions are matched. Webpack will use the first bundle who started\n * to init the shared scope. Generally which bundle to use for a specific\n * module, does not matter. However, it may cause flaky result since the\n * shared module may from different bundles which maybe not exactly the\n * same, especially developers declare dependencies incorrectly sometimes.\n * So in order to make it less flaky, we try to make a BASIC package takes\n * precedence over others. We will always load the shared modules from the\n * basic package bundle if it contains the shared modules.\n */\nexport function enqueueStableLoadBricks(\n  bricks: string[] | Set<string>,\n  brickPackages: BrickPackage[]\n): Promise<void> {\n  const promise = enqueueStableLoad(\"bricks\", bricks, brickPackages);\n  return dispatchRequestStatus(promise);\n}\n\nexport function enqueueStableLoadProcessors(\n  processors: string[] | Set<string>,\n  brickPackages: BrickPackage[]\n): Promise<void> {\n  const promise = enqueueStableLoad(\"processors\", processors, brickPackages);\n  return dispatchRequestStatus(promise);\n}\n\nexport async function loadBricksImperatively(\n  bricks: string[] | Set<string>,\n  brickPackages: BrickPackage[]\n): Promise<void> {\n  const promise = enqueueStableLoad(\"bricks\", bricks, brickPackages);\n  flushStableLoadBricks();\n  return dispatchRequestStatus(promise);\n}\n\nexport function loadProcessorsImperatively(\n  processors: string[] | Set<string>,\n  brickPackages: BrickPackage[]\n): Promise<void> {\n  const promise = enqueueStableLoad(\"processors\", processors, brickPackages);\n  flushStableLoadBricks();\n  return dispatchRequestStatus(promise);\n}\n\ninterface V2AdapterBrick {\n  resolve(\n    adapterPkgFilePath: string,\n    brickPkgFilePath: string,\n    bricks: string[],\n    dlls: string[] | undefined,\n    brickPackages: BrickPackage[]\n  ): Promise<void>;\n}\n\nlet v2AdapterPromise: Promise<V2AdapterBrick> | undefined;\nconst V2_ADAPTER_LOAD_BRICKS = \"v2-adapter.load-bricks\";\n\ninterface BrickItem {\n  fullName: string;\n  lastName: string;\n}\n\n// Get brick/processor items including their dependencies\nfunction getItemsByPkg(\n  type: \"bricks\" | \"processors\",\n  list: string[] | Set<string>,\n  brickPackagesMap: Map<string, BrickPackage>\n) {\n  const itemsByPkg = new Map<BrickPackage, BrickItem[]>();\n  const listToLoad = new Set<string>();\n  const add = (item: string) => {\n    if (listToLoad.has(item)) {\n      return;\n    }\n    listToLoad.add(item);\n    let pkg: BrickPackage | undefined;\n    let namespace: string;\n    let lastName: string | undefined;\n    if (type === \"processors\" || item.includes(\".\")) {\n      [namespace, lastName] = item.split(\".\");\n      const pkgId = `bricks/${\n        type === \"processors\" ? getProcessorPackageName(namespace) : namespace\n      }`;\n      pkg = brickPackagesMap.get(pkgId);\n    } else {\n      lastName = item;\n      for (const p of brickPackagesMap.values()) {\n        if (p.elements?.some((e) => e === lastName)) {\n          pkg = p;\n          break;\n        }\n      }\n    }\n\n    if (!pkg) {\n      // eslint-disable-next-line no-console\n      console.error(`Package for ${item} not found.`);\n      return;\n    }\n\n    let groupItems = itemsByPkg.get(pkg);\n    if (!groupItems) {\n      groupItems = [];\n      itemsByPkg.set(pkg, groupItems);\n    }\n    groupItems.push({ fullName: item, lastName });\n\n    // Load their dependencies too\n    const deps = pkg.dependencies?.[item];\n    if (deps) {\n      for (const dep of deps) {\n        add(dep);\n      }\n    }\n  };\n  for (const item of list) {\n    add(item);\n  }\n  return itemsByPkg;\n}\n\nasync function loadBrickModule(\n  type: \"bricks\" | \"processors\",\n  pkgId: string,\n  item: BrickItem\n) {\n  const moduleName = `${type === \"processors\" ? \"./processors/\" : \"./\"}${\n    item.lastName\n  }`;\n  try {\n    await loadSharedModule(pkgId, moduleName);\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.error(error);\n    throw new Error(`Load ${type} of \"${item.fullName}\" failed`);\n  }\n}\n\nfunction loadRestBricks(\n  type: \"bricks\" | \"processors\",\n  pkgs: BrickPackage[],\n  itemsMap: Map<BrickPackage, BrickItem[]>\n) {\n  return pkgs.map(async (pkg) => {\n    await loadScript(pkg.filePath, window.PUBLIC_ROOT ?? \"\");\n    await waitBasicPkg;\n    return Promise.all(\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      itemsMap.get(pkg)!.map((item) => loadBrickModule(type, pkg.id, item))\n    );\n  });\n}\n\nasync function enqueueStableLoad(\n  type: \"bricks\" | \"processors\",\n  list: string[] | Set<string>,\n  brickPackages: BrickPackage[]\n): Promise<void> {\n  const brickPackagesMap = new Map<string, BrickPackage>();\n  for (const pkg of brickPackages) {\n    const pkgId = pkg.id ?? getPkgIdByFilePath(pkg.filePath);\n    brickPackagesMap.set(pkgId, pkg);\n  }\n\n  const itemsByPkg = getItemsByPkg(type, list, brickPackagesMap);\n\n  let foundBasicPkg: BrickPackage | undefined;\n  const v2Packages: BrickPackage[] = [];\n  const v3PackagesOtherThanBasic: BrickPackage[] = [];\n  let maybeV2Adapter: BrickPackage | undefined;\n  for (const pkg of itemsByPkg.keys()) {\n    if (pkg.id) {\n      if (pkg.id === \"bricks/basic\") {\n        foundBasicPkg = pkg;\n      } else {\n        v3PackagesOtherThanBasic.push(pkg);\n      }\n    } else {\n      // Brick packages of v2 has no `id`\n      v2Packages.push(pkg);\n      maybeV2Adapter = brickPackagesMap.get(\"bricks/v2-adapter\");\n      if (!maybeV2Adapter) {\n        // eslint-disable-next-line no-console\n        console.error(\"Using v2 bricks, but v2-adapter not found\");\n      }\n    }\n  }\n  const v2Adapter = maybeV2Adapter;\n\n  let basicPkgPromise: Promise<unknown> | undefined;\n  const basicPkg = foundBasicPkg;\n  if (basicPkg) {\n    const tempPromise = loadScript(basicPkg.filePath, window.PUBLIC_ROOT ?? \"\");\n    // Packages other than BASIC will wait for an extra micro-task tick.\n    if (!basicPkgWillBeResolved) {\n      basicPkgWillBeResolved = true;\n      tempPromise.then(() => Promise.resolve()).then(resolveBasicPkg);\n    }\n    basicPkgPromise = tempPromise.then(() =>\n      Promise.all(\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        itemsByPkg\n          .get(basicPkg)!\n          .map((item) => loadBrickModule(type, basicPkg.id, item))\n      )\n    );\n  }\n\n  const pkgPromises = [basicPkgPromise].concat(\n    loadRestBricks(type, v3PackagesOtherThanBasic, itemsByPkg)\n  );\n\n  if (v2Adapter && v2Packages.length > 0) {\n    if (!v2AdapterPromise) {\n      // Load `v2-adapter.load-bricks` and its dependencies\n      const v2AdapterItemsByPkg = getItemsByPkg(\n        \"bricks\",\n        [V2_ADAPTER_LOAD_BRICKS],\n        brickPackagesMap\n      );\n      const v2AdapterPackages = [...v2AdapterItemsByPkg.keys()];\n\n      const loadV2Adapter = async () => {\n        await Promise.all(\n          loadRestBricks(\"bricks\", v2AdapterPackages, v2AdapterItemsByPkg)\n        );\n        return document.createElement(\n          V2_ADAPTER_LOAD_BRICKS\n        ) as unknown as V2AdapterBrick;\n      };\n      v2AdapterPromise = loadV2Adapter();\n    }\n\n    pkgPromises.push(\n      v2AdapterPromise.then((adapter) =>\n        Promise.all(\n          v2Packages.map((pkg) => {\n            const pkgId = getPkgIdByFilePath(pkg.filePath);\n            const pkgNamespace = pkgId.split(\"/\")[1];\n            return adapter.resolve(\n              v2Adapter.filePath,\n              pkg.filePath,\n              type === \"bricks\"\n                ? // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                  itemsByPkg\n                    .get(pkg)!\n                    .map((item) => `${pkgNamespace}.${item.lastName}`)\n                : [],\n              (pkg as { dll?: string[] }).dll,\n              // Todo: remove `brickPackages` as an argument\n              brickPackages\n            );\n          })\n        )\n      )\n    );\n  }\n\n  await Promise.all(pkgPromises);\n}\n\nasync function dispatchRequestStatus(promise: Promise<unknown>) {\n  window.dispatchEvent(new Event(\"request.start\"));\n  try {\n    await promise;\n  } finally {\n    window.dispatchEvent(new Event(\"request.end\"));\n  }\n}\n\nfunction getProcessorPackageName(camelPackageName: string): string {\n  return camelPackageName\n    .replace(/[A-Z]/g, (match) => `-${match[0].toLocaleLowerCase()}`)\n    .replace(/_[0-9]/g, (match) => `-${match[1]}`);\n}\n\nfunction getPkgIdByFilePath(filePath: string) {\n  return filePath.split(\"/\").slice(0, 2).join(\"/\");\n}\n","declare const __webpack_init_sharing__: (scope: string) => Promise<unknown>;\ndeclare const __webpack_share_scopes__: Record<string, unknown>;\n\ninterface WebpackRuntimeContainer {\n  init(arg: unknown): Promise<unknown>;\n  get(module: string): Promise<Function>;\n}\n\n// https://github.com/module-federation/module-federation-examples/blob/eda9493f3991a423479fd834cfb1d7b241d9d1f0/advanced-api/dynamic-remotes/app1/src/App.js\nexport default async function loadSharedModule(scope: string, module: string) {\n  // Initializes the share scope. This fills it with known provided modules from this build and all remotes\n  await __webpack_init_sharing__(\"default\");\n  const container = (window as unknown as Record<string, unknown>)[\n    scope\n  ] as WebpackRuntimeContainer; // or get the container somewhere else\n  // Initialize the container, it may provide shared modules\n  await container.init(__webpack_share_scopes__.default);\n  const factory = await container.get(module);\n  return factory();\n}\n","/**\n * Get site's base path, generally will be `/next/` or `/`.\n */\nexport function getBasePath(): string {\n  const base = document.querySelector(\"base\");\n  const basePath = base ? (base.getAttribute(\"href\") as string) : \"/\";\n  return basePath;\n}\n","import type { RuntimeStoryboard } from \"@next-core/types\";\nimport { orderBy } from \"lodash\";\nimport { getRuntime } from \"./Runtime.js\";\n\nexport function matchStoryboard(\n  storyboards: RuntimeStoryboard[],\n  pathname: string\n): RuntimeStoryboard | undefined {\n  // Put apps with longer homepage before shorter ones.\n  // E.g., `/legacy/tool` will match first before `/legacy`.\n  // This enables two apps with relationship of parent-child of homepage.\n  const sortedStoryboards = orderBy(\n    storyboards,\n    (storyboard) => storyboard.app.homepage?.length ?? 0,\n    \"desc\"\n  );\n  for (const storyboard of sortedStoryboards) {\n    const homepage = storyboard.app.homepage;\n    if (typeof homepage === \"string\" && homepage[0] === \"/\") {\n      if (matchHomepage(homepage, pathname)) {\n        return storyboard;\n      }\n    }\n  }\n}\n\nexport function matchHomepage(homepage: string, pathname: string) {\n  return homepage === \"/\"\n    ? pathname === homepage\n    : `${pathname.replace(/\\/+$/, \"\")}/`.startsWith(\n        `${homepage.replace(/\\/+$/, \"\")}/`\n      );\n}\n\n// istanbul ignore next\n/**\n * We say it's an outside app when at least one of the below conditions are true:\n *   - target app is not found.\n *   - target app is not the current app.\n *   - current app is non-standalone mode and target app is standalone mode.\n *\n * Note: when current app is standalone mode, other apps will not be found.\n */\nexport function isOutsideApp(\n  storyboard: RuntimeStoryboard | undefined\n): boolean | undefined {\n  if (process.env.NODE_ENV === \"test\") {\n    return false;\n  }\n  return (\n    !storyboard ||\n    // Sometimes `storyboard.app.standaloneMode` is incorrect.\n    (getRuntime().getCurrentApp()?.id !== storyboard.app.id &&\n      !window.STANDALONE_MICRO_APPS &&\n      storyboard.app.standaloneMode)\n  );\n}\n","import { History, Location, createBrowserHistory } from \"history\";\nimport { getBasePath } from \"./getBasePath.js\";\nimport {\n  type ExtendedHistory,\n  getUserConfirmation,\n  historyExtended,\n  NextHistoryState,\n} from \"./internal/historyExtended.js\";\nimport { getV2RuntimeFromDll } from \"./getV2RuntimeFromDll.js\";\n\nexport type NextHistory = History<NextHistoryState> & ExtendedHistory;\n\nlet history: NextHistory;\n\nexport function createHistory(): NextHistory {\n  if (!history) {\n    // https://github.com/remix-run/history/issues/810\n    const browserHistory = createBrowserHistory<NextHistoryState>({\n      basename: getBasePath().replace(/\\/$/, \"\"),\n      getUserConfirmation,\n    });\n    Object.assign(browserHistory, historyExtended(browserHistory));\n    history = browserHistory as NextHistory;\n  }\n  return history;\n}\n\nfunction getHistoryV3(): NextHistory {\n  return history;\n}\n\n/**\n * When using v3 bricks in v2 container, return history from v2 container.\n */\nfunction getHistoryV2Factory() {\n  const v2Kit = getV2RuntimeFromDll();\n  if (v2Kit) {\n    return v2Kit.getHistory;\n  }\n}\n\nexport const getHistory = getHistoryV2Factory() || getHistoryV3;\n\nexport type NextLocation = Location<NextHistoryState>;\n\nexport type { NextHistoryState };\n","import {\n  History,\n  LocationDescriptor,\n  LocationDescriptorObject,\n  parsePath,\n} from \"history\";\nimport { getBasePath } from \"../getBasePath.js\";\nimport { _internalApiMatchStoryboard } from \"./Runtime.js\";\nimport { isOutsideApp } from \"./matchStoryboard.js\";\n\nlet blocked = false;\nexport function getUserConfirmation(\n  message: string,\n  callback: (result: boolean) => void\n): void {\n  blocked = !confirm(message);\n  callback(!blocked);\n}\n\nexport function historyExtended(\n  browserHistory: History<NextHistoryState>\n): ExtendedHistory {\n  const { push: originalPush, replace: originalReplace } = browserHistory;\n\n  function push(\n    location: LocationDescriptor<NextHistoryState>,\n    state?: NextHistoryState,\n    callback?: (blocked: boolean) => void\n  ): void {\n    blocked = false;\n    originalPush(location, state);\n    callback?.(blocked);\n  }\n\n  function replace(\n    location: LocationDescriptor<NextHistoryState>,\n    state?: NextHistoryState,\n    callback?: (blocked: boolean) => void\n  ): void {\n    blocked = false;\n    originalReplace(location, state);\n    callback?.(blocked);\n  }\n\n  function updateQueryFactory(method: \"push\" | \"replace\"): UpdateQueryFunction {\n    return function updateQuery(query, options = {}, callback?): void {\n      const { extraQuery, clear, keepHash, ...state } = options;\n      const urlSearchParams = new URLSearchParams(\n        clear ? \"\" : browserHistory.location.search\n      );\n      const params: Record<string, string | string[]> = {};\n      Object.assign(params, query, extraQuery);\n      for (const [key, value] of Object.entries(params)) {\n        if (Array.isArray(value)) {\n          urlSearchParams.delete(key);\n          for (const item of value) {\n            urlSearchParams.append(key, item);\n          }\n        } else if (value === undefined || value === null || value === \"\") {\n          urlSearchParams.delete(key);\n        } else {\n          urlSearchParams.set(key, value);\n        }\n      }\n      (method === \"push\" ? push : replace)(\n        `?${urlSearchParams.toString()}${\n          keepHash ? browserHistory.location.hash : \"\"\n        }`,\n        state,\n        callback\n      );\n    };\n  }\n\n  function pushAnchor(\n    hash: string,\n    state?: NextHistoryState,\n    callback?: (blocked: boolean) => void\n  ): void {\n    push(\n      {\n        ...browserHistory.location,\n        key: undefined,\n        hash,\n        state: {\n          // The default notify is false\n          notify: false,\n          ...state,\n        },\n      },\n      undefined,\n      callback\n    );\n  }\n\n  function reload(callback?: (blocked: boolean) => void): void {\n    replace(\n      {\n        ...browserHistory.location,\n        state: {\n          ...browserHistory.location.state,\n          // Always notify\n          notify: true,\n        },\n      },\n      undefined,\n      callback\n    );\n  }\n\n  let blockMessage: string | undefined;\n\n  function setBlockMessage(message: string | undefined): void {\n    blockMessage = message;\n  }\n\n  function getBlockMessage(): string | undefined {\n    return blockMessage;\n  }\n\n  function unblock(): void {\n    blockMessage = undefined;\n  }\n\n  return {\n    pushQuery: updateQueryFactory(\"push\"),\n    replaceQuery: updateQueryFactory(\"replace\"),\n    pushAnchor: pushAnchor,\n    reload,\n    setBlockMessage,\n    getBlockMessage,\n    unblock,\n    ...historyOverridden({ ...browserHistory, push, replace }),\n  };\n}\n\n/**\n * Override history for standalone micro apps.\n *\n * when `push` or `replace` to other apps, force page refresh.\n */\nfunction historyOverridden(\n  browserHistory: History<NextHistoryState> &\n    Pick<ExtendedHistory, \"push\" | \"replace\">\n): Pick<ExtendedHistory, \"push\" | \"replace\"> {\n  const { push: originalPush, replace: originalReplace } = browserHistory;\n  function updateFactory(method: \"push\" | \"replace\"): ExtendedHistory[\"push\"] {\n    return function update(path, state?, callback?) {\n      let pathname: string | undefined;\n      const pathIsString = typeof path === \"string\";\n      if (pathIsString) {\n        pathname = parsePath(path).pathname;\n      } else {\n        pathname = path.pathname;\n      }\n\n      // When history.push or history.replace is performing with an absolute pathname,\n      // force load the target page when it is a page of an outside app.\n      if (\n        typeof pathname === \"string\" &&\n        pathname.startsWith(\"/\") &&\n        isOutsideApp(_internalApiMatchStoryboard(pathname))\n      ) {\n        // Going to outside apps.\n        return location[method === \"push\" ? \"assign\" : \"replace\"](\n          pathIsString\n            ? getBasePath() + path.substring(1)\n            : browserHistory.createHref(\n                path as LocationDescriptorObject<NextHistoryState>\n              )\n        );\n      }\n\n      return (method === \"push\" ? originalPush : originalReplace)(\n        path as string,\n        state,\n        callback\n      );\n    };\n  }\n  return {\n    push: updateFactory(\"push\"),\n    replace: updateFactory(\"replace\"),\n  };\n}\n\nexport interface NextHistoryState {\n  notify?: boolean;\n  from?: LocationDescriptor<NextHistoryState>;\n}\n\n/**\n * 扩展的系统会话对象。\n */\nexport interface ExtendedHistory {\n  /**\n   * 更新指定的 query 参数，会保留当前其它 query 参数，往浏览器会话历史栈中推入一条新记录。\n   */\n  pushQuery: UpdateQueryFunction;\n\n  /**\n   * 更新指定的 query 参数，会保留当前其它 query 参数，替换浏览器会话历史栈中最新的一条记录。\n   */\n  replaceQuery: UpdateQueryFunction;\n\n  /** {@inheritDoc UpdateAnchorFunction} */\n  pushAnchor: UpdateAnchorFunction;\n\n  /** 重载当前会话，即触发页面重新渲染。与 location.reload() 不同，它不会触发浏览器页面的重载。 */\n  reload: (callback?: (blocked: boolean) => void) => void;\n\n  /** @internal */\n  setBlockMessage: (message: string | undefined) => void;\n\n  /** @internal */\n  getBlockMessage: () => string | undefined;\n\n  /** 取消之前设置的阻止页面离开信息的设置。 */\n  unblock: () => void;\n\n  /** 推入一条记录。*/\n  push: (\n    location: LocationDescriptor<NextHistoryState>,\n    state?: NextHistoryState,\n    callback?: (blocked: boolean) => void\n  ) => void;\n\n  /** 替换一条记录。*/\n  replace: (\n    location: LocationDescriptor<NextHistoryState>,\n    state?: NextHistoryState,\n    callback?: (blocked: boolean) => void\n  ) => void;\n}\n\n/**\n * 更新指定的 query 参数。\n *\n * @param query - 要更新的 query 参数。\n * @param options - 选项。\n */\nexport type UpdateQueryFunction = (\n  query: Record<string, unknown>,\n  options?: UpdateQueryOptions,\n  callback?: (blocked: boolean) => void\n) => void;\n\n/** 更新 query 参数时的选项 */\nexport interface UpdateQueryOptions extends NextHistoryState {\n  /** 额外要更新的 query 参数。 */\n  extraQuery?: Record<string, unknown>;\n  /** 是否同时清除当前的所有其它 query 参数。 */\n  clear?: boolean;\n  /** 是否保留当前 hash 参数。 */\n  keepHash?: boolean;\n}\n\n/**\n * 设置指定的 anchor （URL hash）地址，此方法默认不会触发页面重新渲染。\n * 往浏览器会话历史栈中推入一条新记录。\n *\n * @param hash - Hash 地址。\n * @param state - 会话状态设置。\n */\nexport type UpdateAnchorFunction = (\n  hash: string,\n  state?: NextHistoryState,\n  callback?: (blocked: boolean) => void\n) => void;\n","import type {\n  CustomTemplateConstructor,\n  MetaI18n,\n  StoryboardFunction,\n} from \"@next-core/types\";\nimport type { NextHistory } from \"./history.js\";\nimport type { IfContainer } from \"./internal/compute/checkIf.js\";\n\ninterface DLL {\n  (moduleId: \"tYg3\"): Kit;\n}\n\ninterface Kit {\n  getRuntime(): {\n    registerCustomTemplate(\n      tagName: string,\n      constructor: CustomTemplateConstructor\n    ): void;\n    registerCustomProcessor(\n      processorFullName: string,\n      processorFunc: Function\n    ): void;\n    registerWidgetFunctions(\n      widgetId: string,\n      functions: StoryboardFunction[],\n      widgetVersion?: string\n    ): void;\n    registerWidgetI18n(widgetId: string, i18nData: MetaI18n): void;\n  };\n  getHistory(): NextHistory;\n  looseCheckIfByTransform(ifContainer: IfContainer, data: unknown): boolean;\n  SingleBrickAsComponentFactory: any;\n  BrickAsComponentFactory: any;\n  authenticate: any;\n  getAuth: any;\n  isLoggedIn: any;\n  logout: any;\n}\n\nexport function getV2RuntimeFromDll() {\n  const { dll } = window as { dll?: DLL };\n  if (\n    dll &&\n    window.BRICK_NEXT_VERSIONS?.[\"brick-container\"]?.startsWith(\"2.\")\n  ) {\n    return dll(\"tYg3\");\n  }\n}\n","import type {\n  RuntimeStoryboard,\n  BootstrapSettings,\n  FeatureFlags,\n  BootstrapData,\n  Contract,\n  Storyboard,\n  BrickConf,\n  RouteConf,\n  ResolveConf,\n  BrickPackage,\n} from \"@next-core/types\";\nimport { i18n, initializeI18n } from \"@next-core/i18n\";\nimport { loadBricksImperatively } from \"@next-core/loader\";\nimport { deepFreeze, isObject } from \"@next-core/utils/general\";\nimport type { PermissionApi_validatePermissions } from \"@next-api-sdk/micro-app-sdk\";\nimport moment from \"moment\";\nimport \"moment/locale/zh-cn.js\";\nimport { createHistory } from \"../history.js\";\nimport { matchStoryboard } from \"./matchStoryboard.js\";\nimport { Router } from \"./Router.js\";\nimport { NS, locales } from \"./i18n.js\";\nimport { loadNotificationService } from \"../Notification.js\";\nimport { loadDialogService } from \"../Dialog.js\";\nimport { injectedBrickPackages } from \"./injected.js\";\nimport { type AppForCheck, hasInstalledApp } from \"./hasInstalledApp.js\";\nimport type { RuntimeContext } from \"./interfaces.js\";\nimport { listenDevtoolsEagerly } from \"./devtools.js\";\nimport { getV2RuntimeFromDll } from \"../getV2RuntimeFromDll.js\";\nimport { ThemeSettings, customizeColorTheme } from \"./customizeColorTheme.js\";\n\nlet runtime: Runtime;\n\n// Allow inject bootstrap data in a runtime other than Brick Next.\nlet bootstrapData: BootstrapData | undefined;\nlet router: Router | undefined;\n\nexport interface RuntimeOptions {\n  hooks?: RuntimeHooks;\n}\n\nexport interface ImagesFactory {\n  get(name: string): string;\n}\n\nexport interface PageViewInfo {\n  status: \"ok\" | \"failed\" | \"redirected\" | \"not-found\";\n  path?: string;\n  pageTitle?: string;\n}\n\nexport interface RuntimeHooks {\n  auth?: {\n    getAuth(): object;\n    isLoggedIn(): boolean;\n    authenticate?(...args: unknown[]): unknown;\n    logout?(...args: unknown[]): unknown;\n  };\n  fulfilStoryboard?: (storyboard: RuntimeStoryboard) => Promise<void>;\n  validatePermissions?: typeof PermissionApi_validatePermissions;\n  checkPermissions?: {\n    checkPermissions(...actions: string[]): boolean;\n    preCheckPermissions(storyboard: Storyboard): Promise<void> | undefined;\n    preCheckPermissionsForBrickOrRoute(\n      container: BrickConf | RouteConf,\n      asyncComputeRealValue: (value: unknown) => Promise<unknown>\n    ): Promise<void> | undefined;\n  };\n  checkInstalledApps?: {\n    preCheckInstalledApps(\n      storyboard: Storyboard,\n      hasAppInBootstrap: (appId: string) => boolean\n    ): void;\n    waitForCheckingApps(appIds: string[]): Promise<void>;\n    getCheckedApp(appId: string): AppForCheck | undefined;\n  };\n  flowApi?: {\n    FLOW_API_PROVIDER: string;\n    registerFlowApiProvider(): void;\n    isFlowApiProvider(provider: string): boolean;\n    getArgsOfFlowApi(\n      provider: string,\n      originalArgs: unknown[],\n      method?: string\n    ): Promise<unknown[]>;\n    collectContract(contracts: Contract[] | undefined): void;\n    collectWidgetContract(contracts: Contract[] | undefined): void;\n    clearCollectWidgetContract(): void;\n  };\n  menu?: {\n    getMenuById(menuId: string): unknown;\n    fetchMenuById(\n      menuId: string,\n      runtimeContext: RuntimeContext,\n      runtimeHelpers: RuntimeHooksMenuHelpers\n    ): Promise<unknown>;\n  };\n  images?: {\n    imagesFactory(\n      appId: string,\n      isBuildPush?: boolean,\n      version?: string\n    ): ImagesFactory;\n    widgetImagesFactory(\n      widgetId: string,\n      widgetVersion?: string\n    ): ImagesFactory;\n  };\n  messageDispatcher?: {\n    subscribe(...args: unknown[]): Promise<unknown>;\n    unsubscribe(...args: unknown[]): Promise<unknown>;\n    onMessage(channel: string, listener: (data: unknown) => void): void;\n    onClose(listener: () => void): void;\n    reset(): void;\n  };\n  pageView?: {\n    create(): (info: PageViewInfo) => void;\n  };\n}\n\nexport interface RuntimeHooksMenuHelpers {\n  getStoryboardByAppId(appId: string): Storyboard | undefined;\n  resolveData(\n    resolveConf: ResolveConf,\n    runtimeContext: RuntimeContext\n  ): Promise<unknown>;\n  asyncComputeRealValue(\n    value: unknown,\n    runtimeContext: RuntimeContext,\n    options?: { ignoreSymbols?: boolean; noInject?: boolean }\n  ): Promise<unknown>;\n}\n\nexport let hooks: RuntimeHooks | undefined;\n\nexport function createRuntime(options?: RuntimeOptions) {\n  if (runtime) {\n    throw new Error(\"Cannot create multiple runtimes\");\n  }\n  listenDevtoolsEagerly();\n  hooks = options?.hooks;\n  initializeI18n(NS, locales);\n  moment.locale(i18n.language);\n  i18n.on(\"languageChanged\", () => {\n    moment.locale(i18n.language);\n  });\n  createHistory();\n  runtime = new Runtime();\n  return runtime;\n}\n\nfunction getRuntimeV3() {\n  return runtime;\n}\n\n// istanbul ignore next\nfunction getRuntimeV2Factory() {\n  const v2Kit = getV2RuntimeFromDll();\n  if (v2Kit) {\n    return function getRuntimeV2() {\n      return new Proxy(v2Kit.getRuntime(), {\n        get(...args) {\n          const key = args[1];\n          switch (key) {\n            case \"getCurrentApp\":\n            case \"getRecentApps\":\n            case \"hasInstalledApp\":\n            case \"getDesktops\":\n            case \"getLaunchpadSettings\":\n            case \"getLaunchpadSiteMap\":\n            case \"toggleLaunchpadEffect\":\n            case \"applyPageTitle\":\n            case \"getNavConfig\":\n            case \"getFeatureFlags\":\n            case \"getMiscSettings\":\n            case \"getBrandSettings\":\n              return Reflect.get(...args);\n          }\n        },\n      }) as unknown as Runtime;\n    };\n  }\n}\n\n// istanbul ignore next\nexport const getRuntime = getRuntimeV2Factory() || getRuntimeV3;\n\nexport class Runtime {\n  #initialized = false;\n  #bootstrapped = false;\n\n  initialize(data: BootstrapData) {\n    if (this.#initialized) {\n      throw new Error(\"The runtime cannot be initialized more than once\");\n    }\n    this.#initialized = true;\n    normalizeBootstrapData(data);\n    bootstrapData = data;\n    const { notification, dialog } = this.#getPresetBricks();\n    if (notification !== false) {\n      loadNotificationService(\n        notification ?? \"basic.show-notification\",\n        this.loadBricks\n      );\n    }\n    if (dialog !== false) {\n      loadDialogService(dialog ?? \"basic.show-dialog\", this.loadBricks);\n    }\n    customizeColorTheme(data.settings?.misc?.theme as ThemeSettings);\n  }\n\n  async bootstrap(data?: BootstrapData) {\n    if (data) {\n      this.initialize(data);\n    }\n    if (this.#bootstrapped) {\n      throw new Error(\"The runtime cannot be bootstrapped more than once\");\n    }\n    this.#bootstrapped = true;\n    router = new Router(bootstrapData!.storyboards!);\n    await router.bootstrap();\n  }\n\n  getRecentApps() {\n    return router?.getRecentApps() ?? {};\n  }\n\n  getCurrentApp() {\n    return router?.getRecentApps().currentApp;\n  }\n\n  hasInstalledApp(appId: string, matchVersion?: string): boolean {\n    return hasInstalledApp(appId, matchVersion);\n  }\n\n  getFeatureFlags(): FeatureFlags {\n    return {\n      ...bootstrapData?.settings?.featureFlags,\n      ...(\n        router?.getRecentApps().currentApp?.config\n          ?.settings as BootstrapSettings\n      )?.featureFlags,\n      \"migrate-to-brick-next-v3\": true,\n    };\n  }\n\n  getMiscSettings() {\n    return {\n      ...bootstrapData?.settings?.misc,\n      ...(\n        router?.getRecentApps().currentApp?.config\n          ?.settings as BootstrapSettings\n      )?.misc,\n    };\n  }\n\n  getBrandSettings(): Record<string, string> {\n    return {\n      base_title: \"DevOps 管理专家\",\n      ...(bootstrapData?.settings?.brand as Record<string, string>),\n    };\n  }\n\n  getLaunchpadSettings() {\n    return {\n      columns: 7,\n      rows: 4,\n      ...bootstrapData?.settings?.launchpad,\n    };\n  }\n\n  getDesktops(): unknown[] {\n    return bootstrapData?.desktops ?? [];\n  }\n\n  getLaunchpadSiteMap(): unknown[] {\n    return bootstrapData?.siteSort ?? [];\n  }\n\n  toggleLaunchpadEffect(open: boolean): void {\n    document.body.classList.toggle(\"launchpad-open\", open);\n  }\n\n  applyPageTitle(pageTitle: string): void {\n    const baseTitle = this.getBrandSettings().base_title;\n    document.title = pageTitle ? `${pageTitle} - ${baseTitle}` : baseTitle;\n  }\n\n  getNavConfig() {\n    return router?.getNavConfig();\n  }\n\n  loadBricks(bricks: string[] | Set<string>) {\n    return loadBricksImperatively(bricks, getBrickPackages());\n  }\n\n  #getPresetBricks() {\n    return (bootstrapData?.settings?.presetBricks ?? {}) as {\n      notification?: string | false;\n      dialog?: string | false;\n    };\n  }\n}\n\nfunction normalizeBootstrapData(data: BootstrapData) {\n  if (Array.isArray(data.storyboards)) {\n    for (const { app } of data.storyboards) {\n      if (app.locales) {\n        // Prefix to avoid conflict between brick package's i18n namespace.\n        const ns = `tmp/${app.id}`;\n        // Support any languages in `app.locales`.\n        Object.entries(app.locales).forEach(([lang, resources]) => {\n          i18n.addResourceBundle(lang, ns, resources);\n        });\n        // Use `app.name` as the fallback `app.localeName`.\n        app.localeName = i18n.getFixedT(null, ns)(\"name\", app.name) as string;\n        // Remove the temporary i18n resource bundles.\n        Object.keys(app.locales).forEach((lang) => {\n          i18n.removeResourceBundle(lang, ns);\n        });\n      } else {\n        app.localeName = app.name;\n      }\n    }\n  }\n  if (isObject(data.settings)) {\n    deepFreeze(data.settings);\n  }\n  if (data.brickPackages) {\n    deepFreeze(data.brickPackages);\n  }\n}\n\nexport function getBrickPackages() {\n  return (\n    bootstrapData?.brickPackages ??\n    injectedBrickPackages ??\n    (window.STANDALONE_BRICK_PACKAGES as BrickPackage[]) ??\n    []\n  );\n}\n\nexport function _internalApiGetRenderId(): string | undefined {\n  return router?.getRenderId();\n}\n\nexport function _internalApiMatchStoryboard(\n  pathname: string\n): RuntimeStoryboard | undefined {\n  return matchStoryboard(bootstrapData?.storyboards ?? [], pathname);\n}\n\nexport function _internalApiGetRuntimeContext() {\n  return router?.getRuntimeContext();\n}\n\nexport function _internalApiGetStoryboardInBootstrapData(appId: string) {\n  return bootstrapData?.storyboards?.find(\n    (storyboard) => storyboard.app.id === appId\n  );\n}\n\nexport function _internalApiGetAppInBootstrapData(appId: string) {\n  return _internalApiGetStoryboardInBootstrapData(appId)?.app;\n}\n\nexport let _test_only_setBootstrapData: (data: BootstrapData) => void;\n\n// istanbul ignore next\nif (process.env.NODE_ENV === \"test\") {\n  _test_only_setBootstrapData = (data) => {\n    bootstrapData = data as BootstrapData;\n  };\n}\n","import { getV2RuntimeFromDll } from \"./getV2RuntimeFromDll.js\";\n\nclass CustomProcessorRegistry {\n  readonly #registry = new Map<string, Map<string, Function>>();\n\n  define(processorFullName: string, processorFunc: Function) {\n    // `namespace` should be the camelCase of the package name.\n    const [namespace, processorName] = processorFullName.split(\".\");\n    let pkg = this.#registry.get(namespace);\n    if (!pkg) {\n      pkg = new Map();\n      this.#registry.set(namespace, pkg);\n    }\n    if (pkg.has(processorName)) {\n      // eslint-disable-next-line no-console\n      throw new Error(\n        `Custom processor of \"${processorFullName}\" already registered`\n      );\n    }\n    pkg.set(processorName, processorFunc);\n  }\n\n  get(namespace: string) {\n    return this.#registry.get(namespace);\n  }\n}\n\n// istanbul ignore next\nfunction getCustomProcessorsV2() {\n  const v2Kit = getV2RuntimeFromDll();\n  if (v2Kit) {\n    return Object.freeze({\n      define(processorFullName: string, processorFunc: Function) {\n        return v2Kit\n          .getRuntime()\n          .registerCustomProcessor(processorFullName, processorFunc);\n      },\n    }) as CustomProcessorRegistry;\n  }\n}\n\n// istanbul ignore next\nexport const customProcessors =\n  getCustomProcessorsV2() || new CustomProcessorRegistry();\n","import { i18n } from \"@next-core/i18n\";\nimport { Storyboard } from \"@next-core/types\";\n\nexport function registerAppI18n({ app, meta }: Storyboard) {\n  if (meta?.i18n) {\n    // Prefix to avoid conflict between brick package's i18n namespace.\n    const i18nNamespace = getI18nNamespace(\"app\", app.id);\n    // Support any language in `meta.i18n`.\n    const languages: string[] = [];\n    Object.entries(meta.i18n).forEach(([lang, resources]) => {\n      i18n.addResourceBundle(lang, i18nNamespace, resources);\n      languages.push(lang);\n    });\n    return () => {\n      for (const lang of languages) {\n        i18n.removeResourceBundle(lang, i18nNamespace);\n      }\n    };\n  }\n}\n\nexport function getI18nNamespace(\n  type: \"app\" | \"widget\" | \"menu\",\n  id: string\n): string {\n  return `${type}/${id}`;\n}\n","import { i18n } from \"@next-core/i18n\";\nimport type { MetaI18n } from \"@next-core/types\";\nimport { getI18nNamespace } from \"../registerAppI18n.js\";\nimport { getV2RuntimeFromDll } from \"../../getV2RuntimeFromDll.js\";\n\nfunction registerWidgetI18nV3(widgetId: string, i18nData: MetaI18n): void {\n  const ns = getI18nNamespace(\"widget\", widgetId);\n  Object.entries(i18nData).forEach(([lang, resources]) => {\n    i18n.addResourceBundle(lang, ns, resources);\n  });\n}\n\nexport function widgetI18nFactory(widgetId: string) {\n  return i18n.getFixedT(null, getI18nNamespace(\"widget\", widgetId));\n}\n\n// istanbul ignore next\nfunction registerWidgetI18nV2Factory() {\n  const v2Kit = getV2RuntimeFromDll();\n  if (v2Kit) {\n    return function (widgetId: string, i18nData: MetaI18n) {\n      return v2Kit.getRuntime().registerWidgetI18n(widgetId, i18nData);\n    };\n  }\n}\n\n// istanbul ignore next\nexport const registerWidgetI18n =\n  registerWidgetI18nV2Factory() || registerWidgetI18nV3;\n","export const MESSAGE_SOURCE_PANEL = \"brick-next-devtools-panel\";\nexport const FRAME_ACTIVE_CHANGE = \"devtools-frame-active-change\";\nexport const PANEL_CHANGE = \"devtools-panel-change\";\n\ninterface DevtoolsHookContainer {\n  __BRICK_NEXT_DEVTOOLS_HOOK__?: DevtoolsHook;\n}\n\ninterface DevtoolsHook {\n  emit: (message: unknown) => void;\n}\n\ntype DevtoolsMessagePayload = FrameActiveChangePayload | PanelChangePayload;\n\ninterface FrameActiveChangePayload {\n  type: typeof FRAME_ACTIVE_CHANGE;\n  active: boolean;\n  panel: PanelType;\n}\n\ntype PanelType = \"Bricks\" | \"Evaluations\" | \"Transformations\";\n\ninterface PanelChangePayload {\n  type: typeof PANEL_CHANGE;\n  panel: PanelType;\n}\n\nlet frameIsActive = true;\nlet selectedPanel: PanelType;\n\nexport function devtoolsHookEmit(type: string, payload?: unknown): void {\n  const devtools = getDevHook();\n  if (\n    !devtools ||\n    (type === \"evaluation\" &&\n      !(frameIsActive && (!selectedPanel || selectedPanel === \"Evaluations\")))\n  ) {\n    // Ignore messages if current devtools panel is not relevant.\n    return;\n  }\n\n  const emit = (): void => {\n    devtools.emit?.({\n      type,\n      payload,\n    });\n  };\n\n  // Try to emit only in idle time.\n  // istanbul ignore next\n  if (typeof window.requestIdleCallback === \"function\") {\n    window.requestIdleCallback(emit);\n  } else {\n    setTimeout(emit, 0);\n  }\n}\n\nexport function listenDevtoolsEagerly(): void {\n  window.addEventListener(\"message\", ({ data }: MessageEvent): void => {\n    if (data?.source !== MESSAGE_SOURCE_PANEL) {\n      return;\n    }\n    const payload: DevtoolsMessagePayload = data.payload;\n    switch (payload?.type) {\n      case FRAME_ACTIVE_CHANGE: {\n        frameIsActive = payload.active;\n        break;\n      }\n      case PANEL_CHANGE: {\n        selectedPanel = payload.panel;\n        break;\n      }\n    }\n  });\n}\n\nexport function getDevHook(): DevtoolsHook | undefined {\n  return (window as DevtoolsHookContainer).__BRICK_NEXT_DEVTOOLS_HOOK__;\n}\n","import { getDevHook } from \"./devtools.js\";\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst THROW = (): any => {\n  throw new Error(\"Can't modify read-only proxy object\");\n};\n\nconst readOnlyHandler: ProxyHandler<object> = {\n  set: THROW,\n  defineProperty: THROW,\n  deleteProperty: THROW,\n  setPrototypeOf: THROW,\n};\n\nexport function getReadOnlyProxy<T extends object>(object: T): T {\n  return new Proxy<T>(object, readOnlyHandler);\n}\n\n// First, we want to make accessing property of globals lazy,\n// So we use *Proxy* to make a dynamic accessor for each of these globals.\n// But we also want to keep them working in devtools.\nexport function getDynamicReadOnlyProxy({\n  get,\n  ownKeys,\n}: Required<Pick<ProxyHandler<object>, \"get\" | \"ownKeys\">>): unknown {\n  if (getDevHook()) {\n    // In devtools, we extract them at beginning.\n    const target = Object.fromEntries(\n      (ownKeys(null!) as string[]).map((key) => [key, get(null!, key, null)])\n    );\n    return getReadOnlyProxy(target);\n  }\n  return new Proxy(Object.freeze({}), { get });\n}\n","import type { SiteMode, SiteTheme } from \"@next-core/types\";\nimport { JsonStorage } from \"@next-core/utils/general\";\n\ninterface AppThemes {\n  [appId: string]: SiteTheme;\n}\n\n// Themes.\nlet theme: SiteTheme = \"light\";\nconst storage = new JsonStorage<Record<string, AppThemes>>(localStorage);\nconst LOCAL_STORAGE_APPS_THEME_KEY = \"apps-theme\";\n\nexport function setTheme(value: SiteTheme): void {\n  if (value !== \"dark\" && value !== \"light\" && value !== \"dark-v2\") {\n    throw new Error(`Unsupported theme: ${value}`);\n  }\n  theme = value;\n}\n\nexport function getTheme(): SiteTheme {\n  return theme;\n}\n\nexport function getCurrentTheme(): SiteTheme {\n  return document.documentElement.dataset.theme as SiteTheme;\n}\n\nexport function applyTheme(value?: SiteTheme): void {\n  if (value) {\n    setTheme(value);\n  } else {\n    value = getTheme();\n  }\n  if (value !== getCurrentTheme()) {\n    document.documentElement.dataset.theme = value;\n    window.dispatchEvent(\n      new CustomEvent<SiteTheme>(\"theme.change\", {\n        detail: value,\n      })\n    );\n  }\n}\n\nexport function batchSetAppsLocalTheme(appsTheme: AppThemes): void {\n  storage.setItem(LOCAL_STORAGE_APPS_THEME_KEY, {\n    ...getLocalAppsTheme(),\n    ...appsTheme,\n  });\n}\n\nexport function getLocalAppsTheme(): AppThemes {\n  let result: AppThemes | undefined;\n  try {\n    result = storage.getItem(LOCAL_STORAGE_APPS_THEME_KEY);\n  } catch {\n    // eslint-disable-next-line no-console\n    console.error(\"JSON parse error inside `getLocalAppsTheme()`\");\n  }\n\n  return result ?? {};\n}\n\n// Modes.\nlet mode: SiteMode = \"default\";\n\nexport function setMode(value: SiteMode): void {\n  if (value !== \"dashboard\" && value !== \"default\") {\n    throw new Error(`Unsupported mode: ${value}`);\n  }\n  mode = value;\n}\n\nexport function getMode(): SiteMode {\n  return mode;\n}\n\nexport function getCurrentMode(): SiteMode {\n  return document.documentElement.dataset.mode as SiteMode;\n}\n\nexport function applyMode(value?: SiteMode): void {\n  if (value) {\n    setMode(value);\n  } else {\n    value = getMode();\n  }\n  if (value !== getCurrentMode()) {\n    document.documentElement.dataset.mode = value;\n    window.dispatchEvent(\n      new CustomEvent<SiteMode>(\"mode.change\", {\n        detail: value,\n      })\n    );\n  }\n}\n\nexport function getCssPropertyValue(\n  name: string,\n  el = document.documentElement\n): string {\n  if (!el) return \"\";\n  return window.getComputedStyle(el)?.getPropertyValue(name) || \"\";\n}\n","import { identity } from \"lodash\";\nimport type { MicroApp } from \"@next-core/types\";\nimport { i18n, i18nText } from \"@next-core/i18n\";\nimport { widgetI18nFactory } from \"./WidgetI18n.js\";\nimport { getReadOnlyProxy } from \"../proxyFactories.js\";\nimport { getTheme } from \"../../themeAndMode.js\";\nimport { getBasePath } from \"../../getBasePath.js\";\nimport { getI18nNamespace } from \"../registerAppI18n.js\";\nimport { ImagesFactory, hooks } from \"../Runtime.js\";\n\nexport interface GeneralGlobalsOptions {\n  collectCoverage?: unknown;\n  widgetId?: string;\n  widgetVersion?: string;\n  app?: PartialMicroApp;\n  appendI18nNamespace?: string;\n  storyboardFunctions?: unknown;\n  isStoryboardFunction?: boolean;\n}\n\nexport type PartialMicroApp = Pick<MicroApp, \"id\" | \"isBuildPush\">;\n\n// `GeneralGlobals` are globals which are page-state-agnostic,\n// thus they can be used both in storyboard expressions and functions.\nexport function getGeneralGlobals(\n  attemptToVisitGlobals: Set<string>,\n  options: GeneralGlobalsOptions\n): Record<string, unknown> {\n  const globalVariables: Record<string, unknown> = {};\n  for (const variableName of attemptToVisitGlobals) {\n    const variable = getIndividualGlobal(variableName, options);\n    if (variable !== undefined) {\n      globalVariables[variableName] = variable;\n    }\n  }\n  return globalVariables;\n}\n\nfunction getIndividualGlobal(\n  variableName: string,\n  {\n    collectCoverage,\n    widgetId,\n    widgetVersion,\n    app,\n    appendI18nNamespace,\n    storyboardFunctions,\n    isStoryboardFunction,\n  }: GeneralGlobalsOptions\n): unknown {\n  switch (variableName) {\n    case \"BASE_URL\":\n      return collectCoverage ? \"/next\" : getBasePath().replace(/\\/$/, \"\");\n    case \"FN\":\n      return storyboardFunctions;\n    case \"IMG\":\n      return collectCoverage\n        ? fakeImageFactory()\n        : widgetId\n        ? hooks?.images?.widgetImagesFactory(widgetId, widgetVersion)\n        : hooks?.images?.imagesFactory(\n            app!.id,\n            app!.isBuildPush,\n            (app as { currentVersion?: string }).currentVersion\n          );\n    case \"I18N\":\n      return collectCoverage\n        ? identity\n        : widgetId\n        ? widgetI18nFactory(widgetId)\n        : i18n.getFixedT(\n            null,\n            [appendI18nNamespace, getI18nNamespace(\"app\", app!.id)].filter(\n              Boolean\n            ) as string[]\n          );\n    case \"I18N_TEXT\":\n      return collectCoverage ? fakeI18nText : i18nText;\n    case \"PERMISSIONS\":\n      return getReadOnlyProxy({\n        check: collectCoverage\n          ? fakeCheckPermissions\n          : hooks?.checkPermissions?.checkPermissions,\n      });\n    case \"THEME\":\n      return getReadOnlyProxy({\n        getTheme: collectCoverage ? () => \"light\" : getTheme,\n        // getCssPropertyValue: collectCoverage ? () => \"\" : getCssPropertyValue,\n      });\n    case \"console\":\n      return isStoryboardFunction ? getReadOnlyProxy(console) : undefined;\n    case \"location\":\n      return collectCoverage\n        ? {\n            href: \"http://localhost:3000/functions/test\",\n            origin: \"http://localhost:3000\",\n            host: \"localhost:3000\",\n            hostname: \"localhost\",\n          }\n        : {\n            href: location.href,\n            origin: location.origin,\n            host: location.host,\n            hostname: location.hostname,\n          };\n  }\n}\n\nfunction fakeI18nText(data: Record<string, string>): string {\n  return data?.en;\n}\n\nfunction fakeImageFactory(): ImagesFactory {\n  return {\n    get(name: string) {\n      return `mock/images/${name}`;\n    },\n  };\n}\n\nfunction fakeCheckPermissions(): boolean {\n  return true;\n}\n","import type { MicroApp, StoryboardFunction } from \"@next-core/types\";\nimport { cook, precookFunction, EstreeNode } from \"@next-core/cook\";\nimport { supply } from \"@next-core/supply\";\nimport { collectMemberUsageInFunction } from \"@next-core/utils/storyboard\";\nimport { getGeneralGlobals } from \"./internal/compute/getGeneralGlobals.js\";\n\n/** @internal */\nexport type ReadonlyStoryboardFunctions = Readonly<Record<string, Function>>;\n\n/** @internal */\nexport type StoryboardFunctionPatch = Pick<\n  StoryboardFunction,\n  \"source\" | \"typescript\"\n>;\n\n/** @internal */\nexport interface StoryboardFunctionRegistry {\n  /** A readonly proxy for accessing cooked storyboard functions. */\n  storyboardFunctions: ReadonlyStoryboardFunctions;\n\n  /** Register storyboard functions. */\n  registerStoryboardFunctions(\n    functions: StoryboardFunction[] | undefined,\n    app?: PartialMicroApp\n  ): void;\n\n  /** Update a storyboard function during debugging. */\n  updateStoryboardFunction(name: string, data: StoryboardFunctionPatch): void;\n\n  checkPermissionsUsage(functionNames: string[]): boolean;\n}\n\n/** @internal */\nexport interface RuntimeStoryboardFunction {\n  source: string;\n  typescript?: boolean;\n  processed?: boolean;\n  cooked?: Function;\n  deps: Set<string>;\n  hasPermissionsCheck: boolean;\n}\n\n/** @internal */\nexport interface FunctionCoverageCollector {\n  beforeVisit(node: EstreeNode): void;\n  beforeEvaluate(node: EstreeNode): void;\n  beforeCall(node: EstreeNode): void;\n  beforeBranch(node: EstreeNode, branch: string): void;\n}\n\n/** @internal */\nexport interface FunctionCoverageSettings {\n  createCollector(name: string): FunctionCoverageCollector;\n}\n\n/** @internal */\nexport type PartialMicroApp = Pick<MicroApp, \"id\" | \"isBuildPush\">;\n\n/** @internal */\nexport function StoryboardFunctionRegistryFactory({\n  widgetId,\n  widgetVersion,\n  collectCoverage,\n}: {\n  widgetId?: string;\n  widgetVersion?: string;\n  collectCoverage?: FunctionCoverageSettings;\n} = {}): StoryboardFunctionRegistry {\n  const registeredFunctions = new Map<string, RuntimeStoryboardFunction>();\n\n  // Use `Proxy` with a frozen target, to make a readonly function registry.\n  const storyboardFunctions = new Proxy(Object.freeze({}), {\n    get(target, key) {\n      return getStoryboardFunction(key as string);\n    },\n  }) as ReadonlyStoryboardFunctions;\n\n  let currentApp: PartialMicroApp | undefined;\n\n  function registerStoryboardFunctions(\n    functions: StoryboardFunction[],\n    app?: PartialMicroApp\n  ): void {\n    if (app) {\n      currentApp = app;\n    }\n    registeredFunctions.clear();\n    if (Array.isArray(functions)) {\n      for (const fn of functions) {\n        const deps = collectMemberUsageInFunction(fn, \"FN\", !!collectCoverage);\n        const hasPermissionsCheck = collectMemberUsageInFunction(\n          fn,\n          \"PERMISSIONS\",\n          !!collectCoverage\n        ).has(\"check\");\n        registeredFunctions.set(fn.name, {\n          source: fn.source,\n          typescript: fn.typescript,\n          deps,\n          hasPermissionsCheck,\n        });\n      }\n    }\n  }\n\n  function getStoryboardFunction(name: string): Function | undefined {\n    const fn = registeredFunctions.get(name);\n    if (!fn) {\n      return undefined;\n    }\n    if (fn.processed) {\n      return fn.cooked;\n    }\n    let collector: FunctionCoverageCollector | undefined;\n    if (collectCoverage) {\n      collector = collectCoverage.createCollector(name);\n    }\n    const precooked = precookFunction(fn.source, {\n      typescript: fn.typescript,\n      hooks: collector && {\n        beforeVisit: collector.beforeVisit,\n      },\n    });\n    fn.cooked = cook(precooked.function, fn.source, {\n      rules: {\n        noVar: true,\n      },\n      globalVariables: supply(\n        precooked.attemptToVisitGlobals,\n        getGeneralGlobals(precooked.attemptToVisitGlobals, {\n          collectCoverage,\n          widgetId,\n          widgetVersion,\n          app: currentApp,\n          storyboardFunctions,\n          isStoryboardFunction: true,\n        }),\n        !!collectCoverage\n      ),\n      hooks: collector && {\n        beforeEvaluate: collector.beforeEvaluate,\n        beforeCall: collector.beforeCall,\n        beforeBranch: collector.beforeBranch,\n      },\n    }) as Function;\n    fn.processed = true;\n    return fn.cooked;\n  }\n\n  return {\n    storyboardFunctions,\n    registerStoryboardFunctions,\n    updateStoryboardFunction(\n      name: string,\n      data: StoryboardFunctionPatch\n    ): void {\n      const newFn = {\n        ...data,\n        name,\n      };\n      const deps = collectMemberUsageInFunction(newFn, \"FN\", true);\n      const hasPermissionsCheck = collectMemberUsageInFunction(\n        newFn,\n        \"PERMISSIONS\",\n        true\n      ).has(\"check\");\n      registeredFunctions.set(name, {\n        source: data.source,\n        typescript: data.typescript,\n        deps,\n        hasPermissionsCheck,\n      });\n    },\n    /**\n     * Check whether listed functions attempt to call `PERMISSIONS.check()`,\n     * includes in nested `FN.*()` calls.\n     */\n    checkPermissionsUsage(functionNames) {\n      const checkedFunctions = new Set<string>();\n      const hasPermissionsCheck = (name: string): boolean => {\n        if (!checkedFunctions.has(name)) {\n          checkedFunctions.add(name);\n          const fn = registeredFunctions.get(name);\n          return (\n            !!fn &&\n            (fn.hasPermissionsCheck || [...fn.deps].some(hasPermissionsCheck))\n          );\n        }\n        return false;\n      };\n      return functionNames.some(hasPermissionsCheck);\n    },\n  };\n}\n","import { StoryboardFunctionRegistryFactory } from \"../../StoryboardFunctionRegistry.js\";\n\nexport const {\n  storyboardFunctions,\n  registerStoryboardFunctions,\n  checkPermissionsUsage,\n} = StoryboardFunctionRegistryFactory();\n","import EventTarget from \"@ungap/event-target\";\n\nexport interface Media {\n  breakpoint?: MediaBreakpoint;\n}\n\nexport enum MediaBreakpoint {\n  xLarge = \"xLarge\",\n  large = \"large\",\n  medium = \"medium\",\n  small = \"small\",\n  xSmall = \"xSmall\",\n}\n\nexport const mediaBreakpointMinWidthMap = new Map<\n  MediaBreakpoint,\n  string | number\n>([\n  [MediaBreakpoint.xLarge, \"1920px\"],\n  [MediaBreakpoint.large, \"1600px\"],\n  [MediaBreakpoint.medium, \"1280px\"],\n  [MediaBreakpoint.small, \"1024px\"],\n  [MediaBreakpoint.xSmall, 0],\n]);\nexport const mediaEventTarget = new EventTarget();\n\nconst breakpointMatchesMap: Partial<Record<MediaBreakpoint, boolean>> = {};\nconst MEDIA: Media = {};\n\nfunction handleMatchesChange(\n  data: { readonly matches: boolean; readonly media: string },\n  breakpoint: MediaBreakpoint\n): void {\n  let changed = false;\n  breakpointMatchesMap[breakpoint] = data.matches;\n\n  for (const [breakpoint] of mediaBreakpointMinWidthMap) {\n    if (breakpointMatchesMap[breakpoint] && MEDIA.breakpoint !== breakpoint) {\n      MEDIA.breakpoint = breakpoint;\n      changed = true;\n      break;\n    }\n  }\n\n  if (changed) {\n    mediaEventTarget.dispatchEvent(\n      new CustomEvent(\"change\", { detail: MEDIA })\n    );\n  }\n}\n\nmediaBreakpointMinWidthMap.forEach((minWidth, breakpoint) => {\n  const mediaQueryList = window.matchMedia(`(min-width: ${minWidth})`);\n\n  handleMatchesChange(mediaQueryList, breakpoint);\n\n  if (mediaQueryList.addEventListener) {\n    mediaQueryList.addEventListener(\"change\", (event) => {\n      handleMatchesChange(event, breakpoint);\n    });\n  } else {\n    mediaQueryList.addListener((event) => {\n      handleMatchesChange(event, breakpoint);\n    });\n  }\n});\n\nexport const getMedia = (): Media => MEDIA;\n","export function getStorageItem(storageType: \"local\" | \"session\") {\n  return function (name: string) {\n    const storage = storageType === \"local\" ? localStorage : sessionStorage;\n    return JSON.parse(storage.getItem(name) ?? \"null\");\n  };\n}\n","import { getRuntime } from \"./index.js\";\nimport type { RuntimeContext } from \"./internal/interfaces.js\";\n\nexport function isStrictMode(runtimeContext?: RuntimeContext) {\n  return !!(\n    runtimeContext ? runtimeContext.flags : getRuntime()?.getFeatureFlags()\n  )?.[\"brick-next-v3-strict-mode\"];\n}\n\nexport function warnAboutStrictMode(\n  strict: boolean,\n  message: string,\n  ...extraLogs: unknown[]\n) {\n  const punctuation = extraLogs.length === 0 ? \"\" : \",\";\n  if (strict) {\n    // eslint-disable-next-line no-console\n    console.error(\n      `${message} is dropped in v3 strict mode${punctuation}`,\n      ...extraLogs\n    );\n  } else {\n    // eslint-disable-next-line no-console\n    console.warn(\n      `${message} is deprecated in v3 and will be dropped in strict mode${punctuation}`,\n      ...extraLogs\n    );\n  }\n}\n","import type {\n  ContextConf,\n  CustomTemplate,\n  CustomTemplateConstructor,\n  CustomTemplateProxyBasicProperty,\n} from \"@next-core/types\";\nimport { uniq } from \"lodash\";\nimport type { RuntimeBrickElement } from \"./internal/interfaces.js\";\nimport { isStrictMode, warnAboutStrictMode } from \"./isStrictMode.js\";\nimport { getV2RuntimeFromDll } from \"./getV2RuntimeFromDll.js\";\n\n// Note: `prefix` is a native prop on Element, but it's only used in XML documents.\nconst allowedNativeProps = new Set([\"prefix\"]);\n\ninterface LegacyTplPropProxy extends CustomTemplateProxyBasicProperty {\n  asVariable?: boolean;\n  mergeProperty?: unknown;\n  refTransform?: unknown;\n}\n\nclass CustomTemplateRegistry {\n  readonly #registry = new Map<string, CustomTemplate>();\n\n  define(tagName: string, constructor: CustomTemplateConstructor): void {\n    let registered = this.#registry.has(tagName);\n    if (registered) {\n      // When open launchpad, the storyboard will be updated.\n      // However, we can't *undefine* a custom element.\n      // Just ignore re-registering custom templates.\n      // eslint-disable-next-line no-console\n      console.warn(`Custom template of \"${tagName}\" already registered.`);\n    } else {\n      registered = !!customElements.get(tagName);\n      if (registered) {\n        // eslint-disable-next-line no-console\n        console.warn(\n          `Custom template of \"${tagName}\" already defined by customElements.`\n        );\n      }\n    }\n\n    // Transform legacy `proxy.properties[].asVariable` as states.\n    const strict = isStrictMode();\n    const proxyProperties = (constructor.proxy?.properties ?? {}) as {\n      [name: string]: LegacyTplPropProxy;\n    };\n    const validProxyProps: [string, CustomTemplateProxyBasicProperty][] = [];\n    const legacyTplVariables: string[] = [];\n    for (const [key, value] of Object.entries(proxyProperties)) {\n      if (value.asVariable) {\n        warnAboutStrictMode(strict, \"Template `asVariable`\", tagName, key);\n        // istanbul ignore next\n        if (!strict) {\n          // For existed TPL usage, treat it as a STATE.\n          legacyTplVariables.push(key);\n        }\n      } else if (value.mergeProperty || value.refTransform) {\n        // eslint-disable-next-line no-console\n        console.error(\n          \"Template `mergeProperty` and `refTransform` are dropped in v3:\",\n          tagName,\n          key\n        );\n      } else if (value.ref) {\n        validProxyProps.push([key, value]);\n      }\n      // Else: documentation only, for exposed states.\n    }\n\n    const compatibleConstructor = {\n      ...constructor,\n      proxy: {\n        ...constructor.proxy,\n        properties: Object.fromEntries(validProxyProps),\n      },\n      state: (constructor.state\n        ? strict\n          ? constructor.state\n          : constructor.state.map((item) => ({\n              // Make `expose` defaults to true in non-strict mode.\n              expose: true,\n              ...item,\n            }))\n        : []\n      ).concat(legacyTplVariables.map((tpl) => ({ name: tpl, expose: true }))),\n    };\n\n    // Now we allow re-register custom template\n    this.#registry.set(tagName, {\n      ...compatibleConstructor,\n      name: tagName,\n    });\n\n    const exposedStates = getExposedStates(compatibleConstructor.state);\n    const proxyMethods = Object.entries(\n      compatibleConstructor.proxy?.methods ?? {}\n    );\n\n    const props = exposedStates.concat(\n      validProxyProps.map((entry) => entry[0])\n    );\n    const methods = proxyMethods.map((entry) => entry[0]);\n\n    const nativeProps = props\n      .concat(methods)\n      .filter(\n        (prop) => prop in HTMLElement.prototype && !allowedNativeProps.has(prop)\n      );\n    if (nativeProps.length > 0) {\n      warnAboutStrictMode(\n        strict,\n        \"Using native HTMLElement properties as template properties or methods\",\n        tagName,\n        ...nativeProps\n      );\n      // istanbul ignore next\n      if (strict) {\n        throw new Error(\n          `In custom template \"${tagName}\", ${nativeProps\n            .map((p) => `\"${p}\"`)\n            .join(\n              \", \"\n            )} are native HTMLElement properties, and should be avoid to be used as brick properties or methods.`\n        );\n      }\n    }\n\n    if (registered) {\n      return;\n    }\n\n    class TplElement extends HTMLElement {\n      get $$typeof() {\n        return \"custom-template\" as const;\n      }\n\n      static get _dev_only_definedProperties(): string[] {\n        return props;\n      }\n\n      static get _dev_only_definedMethods(): string[] {\n        return methods;\n      }\n\n      $$getElementByRef(this: RuntimeBrickElement, ref: string) {\n        return this.$$tplStateStore?.hostBrick?.tplHostMetadata?.internalBricksByRef.get(\n          ref\n        )?.element;\n      }\n\n      connectedCallback() {\n        let shadowRoot = this.shadowRoot;\n        if (!shadowRoot) {\n          shadowRoot = this.attachShadow({ mode: \"open\" });\n        }\n        const fragment = document.createDocumentFragment();\n        const style = document.createElement(\"style\");\n        style.textContent = \":host{display:block}:host([hidden]){display:none}\";\n        const slot = document.createElement(\"slot\");\n        fragment.appendChild(style);\n        fragment.appendChild(slot);\n        shadowRoot.appendChild(fragment);\n      }\n\n      disconnectedCallback() {\n        if (this.shadowRoot) {\n          this.shadowRoot.textContent = \"\";\n        }\n      }\n    }\n\n    for (const propName of exposedStates) {\n      if (validProxyProps.some((entry) => entry[0] === propName)) {\n        // eslint-disable-next-line no-console\n        console.error(\n          `Cannot define an exposed state that is also a proxy property: \"${propName}\" in ${tagName}`\n        );\n        continue;\n      }\n      Object.defineProperty(TplElement.prototype, propName, {\n        get(this: RuntimeBrickElement) {\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          return this.$$tplStateStore!.getValue(propName);\n        },\n        set(this: RuntimeBrickElement, value: unknown) {\n          // 在 mount 过程中，先设置属性，再设置 `$$tplStateStore`，这样，当触发属性设置时，\n          // 避免初始化的一次 state update 操作及其 onChange 事件。\n          this.$$tplStateStore?.updateValue(propName, value, \"replace\");\n        },\n        enumerable: true,\n      });\n    }\n\n    for (const [from, to] of validProxyProps) {\n      Object.defineProperty(TplElement.prototype, from, {\n        get(this: TplElement) {\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          const element = this.$$getElementByRef!(to.ref) as unknown as Record<\n            string,\n            unknown\n          >;\n          return element[to.refProperty ?? from];\n        },\n        set(this: TplElement, value: unknown) {\n          // 同上 exposedState.set\n          const element = this.$$getElementByRef?.(to.ref) as unknown as Record<\n            string,\n            unknown\n          >;\n          if (element) {\n            element[to.refProperty ?? from] = value;\n          }\n        },\n        enumerable: true,\n      });\n    }\n\n    for (const [from, to] of proxyMethods) {\n      Object.defineProperty(TplElement.prototype, from, {\n        value(this: TplElement, ...args: unknown[]) {\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          const element = this.$$getElementByRef!(to.ref) as unknown as Record<\n            string,\n            Function\n          >;\n          element[to.refMethod ?? from](...args);\n        },\n        enumerable: true,\n      });\n    }\n\n    customElements.define(tagName, TplElement);\n  }\n\n  get(tagName: string) {\n    return this.#registry.get(tagName);\n  }\n}\n\nfunction getExposedStates(state: ContextConf[] | undefined): string[] {\n  // Allow duplicated state names which maybe mutually exclusive.\n  return uniq(\n    state?.filter((item) => item.expose).map((item) => item.name) ?? []\n  );\n}\n\n// istanbul ignore next\nfunction getCustomTemplatesV2() {\n  const v2Kit = getV2RuntimeFromDll();\n  if (v2Kit) {\n    return Object.freeze({\n      define(tagName: string, constructor: CustomTemplateConstructor) {\n        return v2Kit.getRuntime().registerCustomTemplate(tagName, constructor);\n      },\n    }) as CustomTemplateRegistry;\n  }\n}\n\n// istanbul ignore next\nexport const customTemplates =\n  getCustomTemplatesV2() || new CustomTemplateRegistry();\n","import type { DataStore } from \"../data/DataStore.js\";\nimport type { RuntimeBrickElement, RuntimeContext } from \"../interfaces.js\";\nimport { customTemplates } from \"../../CustomTemplates.js\";\n\ntype MinimalTplStateStoreContext = Pick<\n  RuntimeContext,\n  \"tplStateStoreId\" | \"tplStateStoreMap\"\n>;\n\nexport function getTplStateStore(\n  { tplStateStoreId, tplStateStoreMap }: MinimalTplStateStoreContext,\n  using: string,\n  extraInfo?: string\n): DataStore<\"STATE\"> {\n  if (!tplStateStoreId) {\n    throw new Error(\n      `Using \"${using}\" outside of a custom template${extraInfo ?? \"\"}`\n    );\n  }\n  const store = tplStateStoreMap.get(tplStateStoreId);\n  if (!store) {\n    throw new Error(\n      `Template state store is not found when using \"${using}\"${\n        extraInfo ?? \"\"\n      }.\\nThis is a bug of Brick Next, please report it.`\n    );\n  }\n  return store;\n}\n\nexport function getTplHostElement(\n  runtimeContext: MinimalTplStateStoreContext,\n  using: string,\n  extraInfo?: string\n): RuntimeBrickElement {\n  const store = getTplStateStore(runtimeContext, using, extraInfo);\n  const hostElement = store.hostBrick!.element;\n  if (!hostElement) {\n    throw new Error(\n      `Template host element is gone when using \"${using}\"${\n        extraInfo ?? \"\"\n      }.\\nThis is a bug of Brick Next, please report it.`\n    );\n  }\n  return hostElement;\n}\n\nexport function getTagNameOfCustomTemplate(\n  brick: string,\n  appId?: string\n): false | string {\n  // When a template is registered by an app, it's namespace maybe missed.\n  if (!brick.includes(\".\") && brick.startsWith(\"tpl-\") && appId) {\n    const tagName = `${appId}.${brick}`;\n    if (customTemplates.get(tagName)) {\n      return tagName;\n    }\n  }\n  if (customTemplates.get(brick)) {\n    return brick;\n  }\n  return false;\n}\n","import { StoryboardFunction } from \"@next-core/types\";\nimport {\n  ReadonlyStoryboardFunctions,\n  StoryboardFunctionRegistryFactory,\n} from \"../../StoryboardFunctionRegistry.js\";\nimport { getV2RuntimeFromDll } from \"../../getV2RuntimeFromDll.js\";\n\nconst widgetFunctionRegistry = new Map<string, ReadonlyStoryboardFunctions>();\n\nexport const widgetFunctions = new Proxy(Object.freeze({}), {\n  get(target, key: string) {\n    return widgetFunctionRegistry.get(key);\n  },\n}) as Readonly<Record<string, ReadonlyStoryboardFunctions>>;\n\nfunction registerWidgetFunctionsV3(\n  widgetId: string,\n  functions: StoryboardFunction[],\n  widgetVersion?: string\n): void {\n  if (widgetFunctionRegistry.has(widgetId)) {\n    // eslint-disable-next-line no-console\n    throw new Error(`Widget functions of \"${widgetId}\" already registered`);\n  }\n  const { storyboardFunctions, registerStoryboardFunctions } =\n    StoryboardFunctionRegistryFactory({ widgetId, widgetVersion });\n  widgetFunctionRegistry.set(widgetId, storyboardFunctions);\n  registerStoryboardFunctions(functions);\n}\n\n// istanbul ignore next\nfunction registerWidgetFunctionsV2Factory() {\n  const v2Kit = getV2RuntimeFromDll();\n  if (v2Kit) {\n    return function (\n      widgetId: string,\n      functions: StoryboardFunction[],\n      widgetVersion?: string\n    ) {\n      return v2Kit\n        .getRuntime()\n        .registerWidgetFunctions(widgetId, functions, widgetVersion);\n    };\n  }\n}\n\n// istanbul ignore next\nexport const registerWidgetFunctions =\n  registerWidgetFunctionsV2Factory() || registerWidgetFunctionsV3;\n","import type { MicroApp } from \"@next-core/types\";\nimport { type CompareOperator, compare } from \"compare-versions\";\nimport { _internalApiGetAppInBootstrapData, hooks } from \"./Runtime.js\";\n\nexport type AppForCheck = Pick<\n  MicroApp,\n  \"id\" | \"currentVersion\" | \"installStatus\"\n>;\n\nexport function hasInstalledApp(appId: string, matchVersion?: string): boolean {\n  // First, check whether the app is in bootstrap already.\n  let app = _internalApiGetAppInBootstrapData(appId) as AppForCheck | undefined;\n  if (!app && hooks?.checkInstalledApps) {\n    app = hooks.checkInstalledApps.getCheckedApp(appId);\n  }\n  if (!app || app.installStatus === \"running\") {\n    return false;\n  }\n  // Todo: `currentVersion` maybe `\"\"`\n  if (!matchVersion || !app.currentVersion) {\n    return true;\n  }\n  // Valid `matchVersion`:\n  //   >=1.2.3\n  //   >1.2.3\n  //   =1.2.3\n  //   <=1.2.3\n  //   <1.2.3\n  const matches = matchVersion.match(/^([><]=?|=)(.*)$/);\n  try {\n    if (!matches) {\n      throw new TypeError(`Invalid match version: ${matchVersion}`);\n    }\n    return compare(\n      app.currentVersion,\n      matches[2],\n      matches[1] as CompareOperator\n    );\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.error(error);\n  }\n  return false;\n}\n","import type { DataStore } from \"../data/DataStore.js\";\nimport type { RuntimeContext } from \"../interfaces.js\";\n\ntype MinimalTplStateStoreContext = Pick<\n  RuntimeContext,\n  \"formStateStoreId\" | \"formStateStoreMap\"\n>;\n\nexport function getFormStateStore(\n  { formStateStoreId, formStateStoreMap }: MinimalTplStateStoreContext,\n  using: string,\n  extraInfo?: string\n): DataStore<\"FORM_STATE\"> {\n  if (!formStateStoreId) {\n    throw new Error(\n      `Using \"${using}\" outside of form renderer${extraInfo ?? \"\"}`\n    );\n  }\n  const store = formStateStoreMap.get(formStateStoreId);\n  if (!store) {\n    throw new Error(\n      `Form state store is not found when using \"${using}\"${\n        extraInfo ?? \"\"\n      }.\\nThis is a bug of Brick Next, please report it.`\n    );\n  }\n  return store;\n}\n","import { loadBricksImperatively } from \"@next-core/loader\";\nimport { getBrickPackages, hooks } from \"../Runtime.js\";\n\nconst pool = new Map<string, HTMLElement>();\nexport async function getProviderBrick(provider: string): Promise<HTMLElement> {\n  const isFlowApi = hooks?.flowApi?.isFlowApiProvider(provider);\n  if (isFlowApi) {\n    provider = hooks!.flowApi!.FLOW_API_PROVIDER;\n  }\n\n  let brick = pool.get(provider);\n  if (brick) {\n    return brick;\n  }\n\n  if (provider.includes(\"-\") && !customElements.get(provider)) {\n    if (isFlowApi) {\n      hooks!.flowApi!.registerFlowApiProvider();\n    } else {\n      await loadBricksImperatively([provider], getBrickPackages());\n\n      if (!customElements.get(provider)) {\n        throw new Error(`Provider not defined: \"${provider}\".`);\n      }\n    }\n  }\n\n  brick = document.createElement(provider);\n  pool.set(provider, brick);\n  return brick;\n}\n","import { isObject } from \"@next-core/utils/general\";\n\nlet computed = new WeakSet();\n\n// The computed (or transformed) result should never be *computed* again.\n// So does the fetched data from a remote api.\nexport function markAsComputed(value: unknown): void {\n  if (isObject(value)) {\n    if (!hasBeenComputed(value)) {\n      computed.add(value);\n      if (Array.isArray(value)) {\n        value.forEach(markAsComputed);\n      } else {\n        // Only mark pure objects.\n        const proto = Object.getPrototypeOf(value);\n        if (!proto || proto.constructor === Object) {\n          Object.values(value).forEach(markAsComputed);\n        }\n      }\n    }\n  }\n}\n\nexport function hasBeenComputed(object: unknown): boolean {\n  return computed.has(object as object);\n}\n\nexport function resetAllComputedMarks(): void {\n  computed = new WeakSet();\n}\n","import type {\n  HandleReject,\n  HandleRejectByTransform,\n  ResolveConf,\n} from \"@next-core/types\";\nimport { asyncComputeRealValue } from \"../compute/computeRealValue.js\";\nimport { getProviderBrick } from \"./getProviderBrick.js\";\nimport type { RuntimeContext } from \"../interfaces.js\";\nimport { _internalApiGetRenderId, hooks } from \"../Runtime.js\";\nimport { markAsComputed } from \"../compute/markAsComputed.js\";\nimport { get } from \"lodash\";\nimport { isStrictMode, warnAboutStrictMode } from \"../../isStrictMode.js\";\n\nconst cache = new Map<string, Promise<unknown>>();\n\nexport interface ResolveOptions {\n  /**\n   * Cache mode of resolve.\n   *\n   * See https://developer.mozilla.org/en-US/docs/Web/API/Request/cache\n   *\n   * - `default`: Looks for a matching cache.\n   * - `reload`: Without looking for a matching cache.\n   */\n  cache?: \"default\" | \"reload\";\n  renderId?: string;\n}\n\nexport async function resolveData(\n  resolveConf: ResolveConf,\n  runtimeContext: RuntimeContext,\n  options?: ResolveOptions\n) {\n  const { useProvider, method = \"resolve\", args = [], onReject } = resolveConf;\n\n  const { provider: legacyProvider, field: legacyField } = resolveConf as {\n    provider?: string;\n    field?: string | string[];\n  };\n  if (legacyProvider && !useProvider) {\n    throw new Error(\n      `You're using \"provider: ${legacyProvider}\" which is dropped in v3, please use \"useProvider\" instead`\n    );\n  }\n\n  const hasLegacyField = legacyField !== null && legacyField !== undefined;\n  if (hasLegacyField) {\n    const strict = isStrictMode();\n    warnAboutStrictMode(strict, \"`resolve.field`\");\n    // istanbul ignore next\n    if (strict) {\n      throw new Error(\"Using deprecated `resolve.field`\");\n    }\n  }\n\n  const [providerBrick, actualArgs] = await Promise.all([\n    getProviderBrick(useProvider) as unknown as Promise<\n      Record<string, Function>\n    >,\n    asyncComputeRealValue(args, runtimeContext) as Promise<unknown[]>,\n  ]);\n\n  // `clearResolveCache` maybe cleared during the above promise being\n  // fulfilled, so we manually mark it as stale for this case.\n  const renderId = options?.renderId;\n  const stale = !!renderId && renderId !== _internalApiGetRenderId();\n\n  const promise = resolveByProvider(\n    providerBrick,\n    useProvider,\n    method,\n    actualArgs,\n    options,\n    args,\n    stale\n  );\n\n  let { transform } = resolveConf;\n  let data: unknown;\n\n  try {\n    const value = await promise;\n    data = hasLegacyField ? get(value, legacyField) : value;\n    // The fetched data and its inner objects should never be *injected* again.\n    markAsComputed(data);\n  } catch (error) {\n    if (isHandleRejectByTransform(onReject)) {\n      transform = onReject.transform;\n      data = error;\n    } else {\n      throw error;\n    }\n  }\n\n  if (!transform) {\n    return data;\n  }\n\n  // Keep backward compatibility of string transform.\n  if (typeof transform === \"string\") {\n    return { [transform]: data };\n  }\n\n  return asyncComputeRealValue(transform, { ...runtimeContext, data });\n}\n\nexport function clearResolveCache() {\n  cache.clear();\n}\n\nexport async function resolveByProvider(\n  brick: Record<string, Function>,\n  useProvider: string,\n  method: string,\n  args: unknown[],\n  options?: ResolveOptions,\n  originalArgs?: unknown[],\n  stale?: boolean\n) {\n  let cacheKey: string;\n  try {\n    // `args` may contain circular references, which makes\n    // JSON stringify failed, thus we fallback to original args.\n    cacheKey = JSON.stringify({\n      useProvider,\n      method,\n      args,\n    });\n  } catch (e) {\n    if (!originalArgs) {\n      throw e;\n    }\n    cacheKey = JSON.stringify({\n      useProvider,\n      method,\n      originalArgs,\n    });\n  }\n\n  let promise: Promise<unknown> | undefined;\n  if (options?.cache !== \"reload\") {\n    promise = cache.get(cacheKey);\n  }\n  if (!promise) {\n    promise = (async () => {\n      const finalArgs = hooks?.flowApi?.isFlowApiProvider(useProvider)\n        ? await hooks.flowApi.getArgsOfFlowApi(useProvider, args, method)\n        : args;\n      return brick.resolve(...finalArgs);\n    })();\n\n    if (!stale) {\n      cache.set(cacheKey, promise);\n    }\n  }\n\n  return promise;\n}\n\nfunction isHandleRejectByTransform(\n  onReject: HandleReject | undefined\n): onReject is HandleRejectByTransform {\n  return !!(onReject as HandleRejectByTransform)?.transform;\n}\n","import {\n  cook,\n  preevaluate,\n  PreevaluateResult,\n  shouldAllowRecursiveEvaluations,\n} from \"@next-core/cook\";\nimport { loadProcessorsImperatively } from \"@next-core/loader\";\nimport { supply } from \"@next-core/supply\";\nimport { hasOwnProperty } from \"@next-core/utils/general\";\nimport {\n  strictCollectMemberUsage,\n  collectAppGetMenuUsage,\n  collectInstalledAppsHasUsage,\n  MemberCallUsage,\n} from \"@next-core/utils/storyboard\";\nimport { cloneDeep, omit } from \"lodash\";\nimport type { RuntimeContext } from \"../interfaces.js\";\nimport { customProcessors } from \"../../CustomProcessors.js\";\nimport {\n  checkPermissionsUsage,\n  storyboardFunctions,\n} from \"./StoryboardFunctions.js\";\nimport { getGeneralGlobals } from \"./getGeneralGlobals.js\";\nimport {\n  getDynamicReadOnlyProxy,\n  getReadOnlyProxy,\n} from \"../proxyFactories.js\";\nimport { devtoolsHookEmit, getDevHook } from \"../devtools.js\";\nimport { getMedia } from \"../mediaQuery.js\";\nimport { getStorageItem } from \"./getStorageItem.js\";\nimport {\n  _internalApiGetStoryboardInBootstrapData,\n  getBrickPackages,\n  getRuntime,\n  hooks,\n} from \"../Runtime.js\";\nimport type { DataStore } from \"../data/DataStore.js\";\nimport { getTplStateStore } from \"../CustomTemplates/utils.js\";\nimport { widgetFunctions } from \"./WidgetFunctions.js\";\nimport { widgetI18nFactory } from \"./WidgetI18n.js\";\nimport { hasInstalledApp } from \"../hasInstalledApp.js\";\nimport { isStrictMode, warnAboutStrictMode } from \"../../isStrictMode.js\";\nimport { getFormStateStore } from \"../FormRenderer/utils.js\";\nimport { resolveData } from \"../data/resolveData.js\";\nimport { asyncComputeRealValue } from \"./computeRealValue.js\";\n\nconst symbolForRaw = Symbol.for(\"pre.evaluated.raw\");\nconst symbolForContext = Symbol.for(\"pre.evaluated.context\");\n\nexport interface PreEvaluated {\n  [symbolForRaw]: string;\n  [symbolForContext]: RuntimeContext;\n}\n\nexport interface EvaluateOptions {\n  lazy?: boolean;\n  evaluationId?: number;\n}\n\nexport function isPreEvaluated(raw: unknown): raw is PreEvaluated {\n  return !!(raw as PreEvaluated)?.[symbolForRaw];\n}\n\nexport function getPreEvaluatedRaw(pre: PreEvaluated): string {\n  return pre[symbolForRaw];\n}\n\nexport function shouldDismissMarkingComputed(\n  raw: string | PreEvaluated\n): boolean {\n  if (typeof raw === \"string\") {\n    return shouldAllowRecursiveEvaluations(raw);\n  }\n  return shouldAllowRecursiveEvaluations(raw[symbolForRaw]);\n}\n\nconst possibleErrorConstructs = new WeakSet<ErrorConstructor>([\n  SyntaxError,\n  TypeError,\n  ReferenceError,\n]);\n\nexport function getCookErrorConstructor(error: any): ErrorConstructor {\n  return possibleErrorConstructs.has(error.constructor)\n    ? error.constructor\n    : TypeError;\n}\n\nexport async function asyncEvaluate(\n  raw: string | PreEvaluated, // string or pre-evaluated object.\n  runtimeContext: RuntimeContext,\n  options?: EvaluateOptions\n): Promise<unknown> {\n  const { blockingList, run } = lowLevelEvaluate(\n    raw,\n    runtimeContext,\n    options,\n    true\n  );\n  await Promise.all(blockingList);\n  return run();\n}\n\nexport function evaluate(\n  raw: string | PreEvaluated, // string or pre-evaluated object.\n  runtimeContext: RuntimeContext,\n  options?: EvaluateOptions\n): Promise<unknown> {\n  const { run } = lowLevelEvaluate(raw, runtimeContext, options, false);\n  return run();\n}\n\nfunction lowLevelEvaluate(\n  raw: string | PreEvaluated, // string or pre-evaluated object.\n  runtimeContext: RuntimeContext,\n  options: EvaluateOptions = {},\n  isAsync?: boolean\n): {\n  blockingList: (Promise<unknown> | undefined)[];\n  run: Function;\n} {\n  const blockingList: (Promise<unknown> | undefined)[] = [];\n  if (typeof raw !== \"string\") {\n    // If the `raw` is not a string, it must be a pre-evaluated object.\n    // Then fulfil the context, and restore the original `raw`.\n\n    const passByRuntimeContext = omit(runtimeContext, [\n      \"pendingPermissionsPreCheck\",\n      \"tplStateStoreMap\",\n      \"tplStateStoreScope\",\n      \"formStateStoreMap\",\n      \"formStateStoreScope\",\n    ]);\n\n    runtimeContext = {\n      ...raw[symbolForContext],\n      ...passByRuntimeContext,\n    };\n    raw = raw[symbolForRaw];\n  }\n\n  // Collect `APP.getMenu(...)` usage before evaluating.\n  const menuUsage: MemberCallUsage = {\n    usedArgs: new Set(),\n  };\n  const hasAppUsage: MemberCallUsage = {\n    usedArgs: new Set(),\n  };\n\n  // A `SyntaxError` maybe thrown.\n  let precooked: PreevaluateResult;\n  try {\n    precooked = preevaluate(raw, {\n      withParent: true,\n      hooks: {\n        beforeVisitGlobal(node, parent) {\n          collectAppGetMenuUsage(menuUsage, node, parent!);\n          collectInstalledAppsHasUsage(hasAppUsage, node, parent!);\n        },\n      },\n    });\n  } catch (error: any) {\n    const message = `${error.message}, in \"${raw}\"`;\n    const errorConstructor = getCookErrorConstructor(error);\n    throw new errorConstructor(message);\n  }\n\n  if (menuUsage.hasNonStaticUsage) {\n    throw new Error(\n      `Non-static usage of \"APP.getMenu\" is prohibited in v3, check your expression: \"${raw}\"`\n    );\n  }\n\n  if (hasAppUsage.hasNonStaticUsage) {\n    throw new Error(\n      `Non-static usage of \"INSTALLED_APPS.has\" is prohibited in v3, check your expression: \"${raw}\"`\n    );\n  }\n\n  const globalVariables: Record<string, unknown> = {};\n  const { attemptToVisitGlobals } = precooked;\n\n  // Ignore evaluating if required `event/DATA` is missing in\n  // context. Since they are are provided in different context, whenever\n  // missing one of them, memorize the current context for later consuming.\n  if (\n    options.lazy ||\n    (attemptToVisitGlobals.has(\"EVENT\") &&\n      !hasOwnProperty(runtimeContext, \"event\")) ||\n    (attemptToVisitGlobals.has(\"DATA\") &&\n      !hasOwnProperty(runtimeContext, \"data\"))\n  ) {\n    return {\n      blockingList,\n      run() {\n        return Object.keys(runtimeContext).length > 0\n          ? ({\n              [symbolForRaw]: raw,\n              [symbolForContext]: runtimeContext,\n            } as PreEvaluated)\n          : raw;\n      },\n    };\n  }\n\n  let usedCtx: Set<string>;\n  let usedProcessors: Set<string>;\n  let usedStates: Set<string>;\n  let tplStateStore: DataStore<\"STATE\"> | undefined;\n  const strict = isStrictMode(runtimeContext);\n\n  // For existed TPL usage, treat it as a STATE.\n  if (\n    attemptToVisitGlobals.has(\"STATE\") ||\n    (!strict && attemptToVisitGlobals.has(\"TPL\"))\n  ) {\n    tplStateStore = getTplStateStore(runtimeContext, \"STATE\", `: \"${raw}\"`);\n  }\n\n  let usedFormStates: Set<string>;\n  let formStateStore: DataStore<\"FORM_STATE\"> | undefined;\n  if (attemptToVisitGlobals.has(\"FORM_STATE\")) {\n    formStateStore = getFormStateStore(\n      runtimeContext,\n      \"FORM_STATE\",\n      `: \"${raw}\"`\n    );\n  }\n\n  const devHook = getDevHook();\n  if (isAsync || devHook) {\n    if (attemptToVisitGlobals.has(\"CTX\")) {\n      usedCtx = strictCollectMemberUsage(raw, \"CTX\");\n      isAsync && blockingList.push(runtimeContext.ctxStore.waitFor(usedCtx));\n    }\n\n    if (tplStateStore) {\n      usedStates = strictCollectMemberUsage(raw, \"STATE\");\n      // istanbul ignore if\n      if (!strict) {\n        const usedTpls = strictCollectMemberUsage(raw, \"TPL\");\n        for (const tpl of usedTpls) {\n          usedStates.add(tpl);\n        }\n      }\n      isAsync && blockingList.push(tplStateStore.waitFor(usedStates));\n    }\n\n    if (formStateStore) {\n      usedFormStates = strictCollectMemberUsage(raw, \"FORM_STATE\");\n      isAsync && blockingList.push(formStateStore.waitFor(usedFormStates));\n    }\n\n    if (attemptToVisitGlobals.has(\"PROCESSORS\")) {\n      usedProcessors = strictCollectMemberUsage(raw, \"PROCESSORS\", 2);\n      isAsync &&\n        blockingList.push(\n          loadProcessorsImperatively(usedProcessors, getBrickPackages())\n        );\n    }\n  }\n\n  if (isAsync) {\n    let attemptToCheckPermissions = attemptToVisitGlobals.has(\"PERMISSIONS\");\n    // There maybe `PERMISSIONS.check()` usage in functions\n    if (!attemptToCheckPermissions && attemptToVisitGlobals.has(\"FN\")) {\n      const usedFunctions = [...strictCollectMemberUsage(raw, \"FN\")];\n      attemptToCheckPermissions = checkPermissionsUsage(usedFunctions);\n    }\n\n    if (attemptToCheckPermissions) {\n      blockingList.push(...runtimeContext.pendingPermissionsPreCheck);\n    }\n\n    if (menuUsage.usedArgs.size > 0 && hooks?.menu) {\n      // Block evaluating if has `APP.getMenu(...)` usage.\n      const usedMenuIds = [...menuUsage.usedArgs];\n      blockingList.push(\n        Promise.all(\n          usedMenuIds.map((menuId) =>\n            hooks!.menu!.fetchMenuById(menuId, runtimeContext, {\n              getStoryboardByAppId: _internalApiGetStoryboardInBootstrapData,\n              resolveData,\n              asyncComputeRealValue,\n            })\n          )\n        )\n      );\n    }\n\n    if (hasAppUsage.usedArgs.size > 0) {\n      // Only wait for specific apps\n      blockingList.push(\n        hooks?.checkInstalledApps?.waitForCheckingApps([\n          ...hasAppUsage.usedArgs,\n        ])\n      );\n    }\n  }\n\n  return {\n    blockingList,\n    run() {\n      const {\n        app: currentApp,\n        location,\n        query,\n        match,\n        flags,\n        sys,\n        ctxStore,\n        data,\n        event,\n      } = runtimeContext;\n      const app = runtimeContext.overrideApp ?? currentApp;\n\n      for (const variableName of attemptToVisitGlobals) {\n        switch (variableName) {\n          // case \"ALIAS\":\n          case \"ANCHOR\":\n            globalVariables[variableName] = location.hash\n              ? location.hash.substring(1)\n              : null;\n            break;\n          case \"APP\":\n            globalVariables[variableName] = {\n              ...cloneDeep(app),\n              getMenu: hooks?.menu?.getMenuById,\n            };\n            break;\n          case \"CTX\":\n            globalVariables[variableName] = getDynamicReadOnlyProxy({\n              get(target, key) {\n                return ctxStore.getValue(key as string);\n              },\n              ownKeys() {\n                return Array.from(usedCtx);\n              },\n            });\n            break;\n          case \"DATA\":\n            globalVariables[variableName] = data;\n            break;\n          case \"EVENT\":\n            globalVariables[variableName] = event;\n            break;\n          case \"FLAGS\":\n            globalVariables[variableName] = getReadOnlyProxy(flags);\n            break;\n          case \"FORM_STATE\":\n            globalVariables[variableName] = getDynamicReadOnlyProxy({\n              get(target, key) {\n                return formStateStore!.getValue(key as string);\n              },\n              ownKeys() {\n                return Array.from(usedFormStates);\n              },\n            });\n            break;\n          case \"HASH\":\n            globalVariables[variableName] = location.hash;\n            break;\n          case \"INSTALLED_APPS\":\n            globalVariables[variableName] = getReadOnlyProxy({\n              has: hasInstalledApp,\n            });\n            break;\n          case \"ITEM\":\n          case \"INDEX\": {\n            const property =\n              variableName === \"ITEM\" ? \"forEachItem\" : \"forEachIndex\";\n            if (!hasOwnProperty(runtimeContext, property)) {\n              // eslint-disable-next-line no-console\n              console.error(\n                `Using \\`${variableName}\\` but no \\`:forEach\\` is found, check your expression: \"${raw}\"`\n              );\n            } else {\n              globalVariables[variableName] = runtimeContext[property];\n            }\n            break;\n          }\n          case \"LOCAL_STORAGE\":\n            globalVariables[variableName] = getReadOnlyProxy({\n              getItem: getStorageItem(\"local\"),\n            });\n            break;\n          case \"MEDIA\":\n            globalVariables[variableName] = getReadOnlyProxy(getMedia());\n            break;\n          case \"MISC\":\n            globalVariables[variableName] = getRuntime().getMiscSettings();\n            break;\n          case \"PARAMS\":\n            globalVariables[variableName] = new URLSearchParams(query);\n            break;\n          case \"PATH\":\n            globalVariables[variableName] = getReadOnlyProxy(\n              match?.params ?? {}\n            );\n            break;\n          case \"PATH_NAME\":\n            globalVariables[variableName] = location.pathname;\n            break;\n          case \"PROCESSORS\":\n            globalVariables[variableName] = getDynamicReadOnlyProxy({\n              get(target, key) {\n                const pkg = customProcessors.get(key as string);\n                if (!pkg) {\n                  throw new Error(\n                    `'PROCESSORS.${\n                      key as string\n                    }' is not registered! Have you installed the relevant brick package?`\n                  );\n                }\n                return getDynamicReadOnlyProxy({\n                  get(t, k) {\n                    return pkg.get(k as string);\n                  },\n                  ownKeys() {\n                    return Array.from(pkg.keys());\n                  },\n                });\n              },\n              ownKeys() {\n                const keys = new Set<string>();\n                for (const processor of usedProcessors) {\n                  const namespace = processor.split(\".\")[0];\n                  keys.add(namespace);\n                }\n                return Array.from(keys);\n              },\n            });\n            break;\n          case \"QUERY\":\n            globalVariables[variableName] = Object.fromEntries(\n              Array.from(query.keys()).map((key) => [key, query.get(key)])\n            );\n            break;\n          case \"QUERY_ARRAY\":\n            globalVariables[variableName] = Object.fromEntries(\n              Array.from(query.keys()).map((key) => [key, query.getAll(key)])\n            );\n            // case \"SEGUE\":\n            break;\n          case \"SESSION_STORAGE\":\n            globalVariables[variableName] = getReadOnlyProxy({\n              getItem: getStorageItem(\"session\"),\n            });\n            break;\n          // istanbul ignore next\n          case \"TPL\":\n            warnAboutStrictMode(\n              strict,\n              'Using \"TPL\" in expression',\n              `check your expression: \"${raw}\"`\n            );\n            if (strict) {\n              break;\n            }\n          // eslint-disable-next-line no-fallthrough\n          case \"STATE\":\n            globalVariables[variableName] = getDynamicReadOnlyProxy({\n              get(target, key) {\n                return tplStateStore!.getValue(key as string);\n              },\n              ownKeys() {\n                return Array.from(usedStates);\n              },\n            });\n            break;\n          case \"SYS\":\n            globalVariables[variableName] = getReadOnlyProxy(sys ?? {});\n            break;\n          case \"__WIDGET_FN__\":\n            globalVariables[variableName] = widgetFunctions;\n            break;\n          case \"__WIDGET_IMG__\":\n            globalVariables[variableName] = hooks?.images?.widgetImagesFactory;\n            break;\n          case \"__WIDGET_I18N__\":\n            globalVariables[variableName] = widgetI18nFactory;\n            break;\n        }\n      }\n\n      Object.assign(\n        globalVariables,\n        getGeneralGlobals(precooked.attemptToVisitGlobals, {\n          storyboardFunctions,\n          app: runtimeContext.app,\n          appendI18nNamespace: runtimeContext.appendI18nNamespace,\n        })\n      );\n\n      try {\n        const result = cook(precooked.expression, precooked.source, {\n          globalVariables: supply(\n            precooked.attemptToVisitGlobals,\n            globalVariables\n          ),\n        });\n        const detail = { raw, context: globalVariables, result };\n        devtoolsHookEmit(\"evaluation\", detail);\n        return result;\n      } catch (error: any) {\n        const message = `${error.message}, in \"${raw}\"`;\n        const errorConstructor = getCookErrorConstructor(error);\n        throw new errorConstructor(message);\n      }\n    },\n  };\n}\n","export enum StateOfUseBrick {\n  INITIAL,\n  USE_BRICK,\n  USE_BRICK_ITEM,\n  USE_BRICK_PROPERTIES,\n  // Compatible mode\n  USE_BRICK_TRANSFORM,\n  USE_BRICK_EVENTS,\n  USE_BRICK_IF,\n  USE_BRICK_SLOTS,\n  USE_BRICK_SLOTS_ITEM,\n  USE_BRICK_SLOTS_ITEM_BRICKS,\n  USE_BRICK_SLOTS_ITEM_BRICKS_ITEM,\n  USE_BRICK_LIFECYCLE,\n  USE_BRICK_DATA_SOURCE,\n}\n\nexport function isLazyContentInUseBrick(\n  state: StateOfUseBrick | undefined\n): boolean {\n  switch (state) {\n    case StateOfUseBrick.USE_BRICK_PROPERTIES:\n    case StateOfUseBrick.USE_BRICK_TRANSFORM:\n    case StateOfUseBrick.USE_BRICK_EVENTS:\n    case StateOfUseBrick.USE_BRICK_IF:\n    case StateOfUseBrick.USE_BRICK_LIFECYCLE:\n    case StateOfUseBrick.USE_BRICK_DATA_SOURCE:\n      return true;\n  }\n  return false;\n}\n\nexport function getNextStateOfUseBrick(\n  state: StateOfUseBrick | undefined,\n  isArray?: boolean,\n  key?: string\n): StateOfUseBrick | undefined {\n  if (isLazyContentInUseBrick(state)) {\n    return state;\n  }\n  if (isArray) {\n    switch (state) {\n      case StateOfUseBrick.USE_BRICK:\n        return StateOfUseBrick.USE_BRICK_ITEM;\n      case StateOfUseBrick.USE_BRICK_SLOTS_ITEM_BRICKS:\n        return StateOfUseBrick.USE_BRICK_SLOTS_ITEM_BRICKS_ITEM;\n    }\n  } else {\n    switch (state) {\n      case StateOfUseBrick.INITIAL:\n        if (key === \"useBrick\") {\n          return StateOfUseBrick.USE_BRICK;\n        }\n        break;\n      case StateOfUseBrick.USE_BRICK:\n      case StateOfUseBrick.USE_BRICK_ITEM:\n      case StateOfUseBrick.USE_BRICK_SLOTS_ITEM_BRICKS_ITEM: {\n        switch (key) {\n          case \"properties\":\n            return StateOfUseBrick.USE_BRICK_PROPERTIES;\n          case \"transform\":\n            return StateOfUseBrick.USE_BRICK_TRANSFORM;\n          case \"dataSource\":\n            return StateOfUseBrick.USE_BRICK_DATA_SOURCE;\n          case \"events\":\n            return StateOfUseBrick.USE_BRICK_EVENTS;\n          case \"slots\":\n            return StateOfUseBrick.USE_BRICK_SLOTS;\n          case \"children\":\n            return StateOfUseBrick.USE_BRICK_SLOTS_ITEM_BRICKS;\n          case \"if\":\n            return StateOfUseBrick.USE_BRICK_IF;\n          case \"lifeCycle\":\n            return StateOfUseBrick.USE_BRICK_LIFECYCLE;\n        }\n        break;\n      }\n      case StateOfUseBrick.USE_BRICK_SLOTS:\n        return StateOfUseBrick.USE_BRICK_SLOTS_ITEM;\n      case StateOfUseBrick.USE_BRICK_SLOTS_ITEM:\n        if (key === \"bricks\") {\n          return StateOfUseBrick.USE_BRICK_SLOTS_ITEM_BRICKS;\n        }\n        break;\n    }\n  }\n  return StateOfUseBrick.INITIAL;\n}\n","import { isEvaluable } from \"@next-core/cook\";\nimport { hasOwnProperty, isObject } from \"@next-core/utils/general\";\nimport { transformAndInject, transform, inject } from \"@next-core/inject\";\nimport {\n  asyncEvaluate,\n  isPreEvaluated,\n  evaluate,\n  shouldDismissMarkingComputed,\n} from \"./evaluate.js\";\nimport type { RuntimeContext } from \"../interfaces.js\";\nimport {\n  StateOfUseBrick,\n  getNextStateOfUseBrick,\n  isLazyContentInUseBrick,\n} from \"./getNextStateOfUseBrick.js\";\nimport { hasBeenComputed, markAsComputed } from \"./markAsComputed.js\";\n\nexport interface ComputeOptions {\n  $$lazyForUseBrick?: boolean;\n  $$stateOfUseBrick?: StateOfUseBrick;\n  ignoreSymbols?: boolean;\n  noInject?: boolean;\n}\n\nexport async function asyncComputeRealValue(\n  value: unknown,\n  runtimeContext: RuntimeContext,\n  internalOptions: ComputeOptions = {}\n): Promise<unknown> {\n  const preEvaluated = isPreEvaluated(value);\n\n  if (preEvaluated || typeof value === \"string\") {\n    // For `useBrick`, some fields such as `properties`/`transform`/`events`/`if`,\n    // are kept and to be evaluated later.\n    const lazy =\n      internalOptions.$$lazyForUseBrick &&\n      isLazyContentInUseBrick(internalOptions.$$stateOfUseBrick);\n\n    let result: unknown;\n    let dismissMarkingComputed = lazy;\n\n    if (preEvaluated || isEvaluable(value as string)) {\n      result = await asyncEvaluate(value, runtimeContext, { lazy });\n      dismissMarkingComputed = shouldDismissMarkingComputed(value);\n    } else {\n      result = lazy\n        ? value\n        : (hasOwnProperty(runtimeContext, \"data\")\n            ? internalOptions.noInject\n              ? transform\n              : transformAndInject\n            : internalOptions.noInject\n            ? identity\n            : inject)(value, runtimeContext);\n    }\n\n    if (!dismissMarkingComputed) {\n      markAsComputed(result);\n    }\n\n    return result;\n  }\n\n  if (\n    !isObject(value) ||\n    hasBeenComputed(value) ||\n    typeof value === \"function\"\n  ) {\n    return value;\n  }\n\n  if (Array.isArray(value)) {\n    const nextOptions = getNextComputeOptions(internalOptions, true);\n    return Promise.all(\n      value.map((v) => asyncComputeRealValue(v, runtimeContext, nextOptions))\n    );\n  }\n\n  return Object.fromEntries(\n    (\n      await Promise.all(\n        Object.entries(value).map(([k, v]) =>\n          Promise.all([\n            asyncComputeRealValue(k, runtimeContext),\n            asyncComputeRealValue(\n              v,\n              runtimeContext,\n              getNextComputeOptions(internalOptions, false, k)\n            ),\n          ])\n        )\n      )\n    ).concat(\n      internalOptions.ignoreSymbols\n        ? []\n        : Object.getOwnPropertySymbols(value).map((k) => [\n            k,\n            (value as Record<string | symbol, unknown>)[k],\n          ])\n    )\n  );\n}\n\nexport function computeRealValue(\n  value: unknown,\n  runtimeContext: RuntimeContext,\n  internalOptions: ComputeOptions = {}\n): unknown {\n  const preEvaluated = isPreEvaluated(value);\n\n  if (preEvaluated || typeof value === \"string\") {\n    // For `useBrick`, some fields such as `properties`/`transform`/`events`/`if`,\n    // are kept and to be evaluated later.\n    const lazy =\n      internalOptions.$$lazyForUseBrick &&\n      isLazyContentInUseBrick(internalOptions.$$stateOfUseBrick);\n\n    let result: unknown;\n    let dismissMarkingComputed = lazy;\n\n    if (preEvaluated || isEvaluable(value as string)) {\n      result = evaluate(value, runtimeContext);\n      dismissMarkingComputed = shouldDismissMarkingComputed(value);\n    } else {\n      result = lazy\n        ? value\n        : (hasOwnProperty(runtimeContext, \"data\")\n            ? internalOptions.noInject\n              ? transform\n              : transformAndInject\n            : internalOptions.noInject\n            ? identity\n            : inject)(value, runtimeContext);\n    }\n\n    if (!dismissMarkingComputed) {\n      markAsComputed(result);\n    }\n\n    return result;\n  }\n\n  if (\n    !isObject(value) ||\n    hasBeenComputed(value) ||\n    typeof value === \"function\"\n  ) {\n    return value;\n  }\n\n  if (Array.isArray(value)) {\n    const nextOptions = getNextComputeOptions(internalOptions, true);\n    return value.map((v) => computeRealValue(v, runtimeContext, nextOptions));\n  }\n\n  return Object.fromEntries(\n    Object.entries(value)\n      .map(([k, v]) => [\n        computeRealValue(k, runtimeContext),\n        computeRealValue(\n          v,\n          runtimeContext,\n          getNextComputeOptions(internalOptions, false, k)\n        ),\n      ])\n      .concat(\n        internalOptions.ignoreSymbols\n          ? []\n          : Object.getOwnPropertySymbols(value).map((k) => [\n              k,\n              (value as Record<string | symbol, unknown>)[k],\n            ])\n      )\n  );\n}\n\nfunction getNextComputeOptions(\n  internalOptions: ComputeOptions,\n  isArray: boolean,\n  key?: string\n): ComputeOptions {\n  return internalOptions.$$lazyForUseBrick\n    ? {\n        ...internalOptions,\n        $$stateOfUseBrick: getNextStateOfUseBrick(\n          internalOptions.$$stateOfUseBrick,\n          isArray,\n          key\n        ),\n      }\n    : internalOptions;\n}\n\nfunction identity<T>(value: T): T {\n  return value;\n}\n","import { hasOwnProperty, isObject } from \"@next-core/utils/general\";\nimport type { BrickConf, ResolveConf } from \"@next-core/types\";\nimport { asyncComputeRealValue, computeRealValue } from \"./computeRealValue.js\";\nimport { isPreEvaluated } from \"./evaluate.js\";\nimport { resolveData } from \"../data/resolveData.js\";\nimport type { RuntimeContext } from \"../interfaces.js\";\nimport { getV2RuntimeFromDll } from \"../../getV2RuntimeFromDll.js\";\n\n/**\n * 包含 `if` 条件判断的对象。\n */\nexport interface IfContainer {\n  /**\n   * 条件判断，可以为表达式字符串。\n   *\n   * @example\n   *\n   * ```yaml\n   * - brick: your.any-brick\n   *   if: '<% FLAGS[\"your-feature-flag\"] %>'\n   * ```\n   */\n  if?: unknown;\n}\n\nexport async function asyncCheckIf(\n  ifContainer: IfContainer,\n  runtimeContext: RuntimeContext\n): Promise<boolean> {\n  return (\n    !hasOwnProperty(ifContainer, \"if\") ||\n    !!(typeof ifContainer.if === \"string\" || isPreEvaluated(ifContainer.if)\n      ? await asyncComputeRealValue(ifContainer.if, runtimeContext)\n      : ifContainer.if)\n  );\n}\n\nexport function checkIf(\n  ifContainer: IfContainer,\n  runtimeContext: RuntimeContext\n): boolean {\n  return (\n    !hasOwnProperty(ifContainer, \"if\") ||\n    !!(typeof ifContainer.if === \"string\" || isPreEvaluated(ifContainer.if)\n      ? computeRealValue(ifContainer.if, runtimeContext)\n      : ifContainer.if)\n  );\n}\n\nexport function checkIfOfComputed(ifContainer: IfContainer): boolean {\n  return !hasOwnProperty(ifContainer, \"if\") || !!ifContainer.if;\n}\n\nexport async function asyncCheckBrickIf(\n  brickConf: BrickConf,\n  runtimeContext: RuntimeContext\n): Promise<boolean> {\n  if (isObject(brickConf.if) && !isPreEvaluated(brickConf.if)) {\n    const resolved = (await resolveData(\n      brickConf.if as ResolveConf,\n      runtimeContext\n    )) as { if?: unknown };\n    return checkIfOfComputed(resolved);\n  }\n  return asyncCheckIf(brickConf, runtimeContext);\n}\n\nfunction checkIfByTransformV3(ifContainer: IfContainer, data: unknown) {\n  return checkIf(ifContainer, { data } as RuntimeContext);\n}\n\n// istanbul ignore next\nfunction checkIfByTransformV2Factory() {\n  const v2Kit = getV2RuntimeFromDll();\n  if (v2Kit) {\n    return v2Kit.looseCheckIfByTransform;\n  }\n}\n\n// istanbul ignore next\nexport const checkIfByTransform =\n  checkIfByTransformV2Factory() || checkIfByTransformV3;\n","import { isEvaluable, isTrackAll } from \"@next-core/cook\";\nimport { track, trackAll } from \"@next-core/utils/storyboard\";\nimport {\n  PreEvaluated,\n  getPreEvaluatedRaw,\n  isPreEvaluated,\n} from \"./evaluate.js\";\n\nexport function getTracks(value: unknown) {\n  let contextNames: string[] | Set<string> | false = false;\n  let stateNames: string[] | Set<string> | false = false;\n  let formStateNames: string[] | Set<string> | false = false;\n  if (typeof value === \"string\" ? isEvaluable(value) : isPreEvaluated(value)) {\n    const raw =\n      typeof value === \"string\"\n        ? value\n        : getPreEvaluatedRaw(value as PreEvaluated);\n    if (isTrackAll(raw)) {\n      const result = trackAll(raw);\n      if (result) {\n        contextNames = result.context;\n        stateNames = result.state;\n        formStateNames = result.formState;\n      }\n    } else {\n      contextNames = track(raw, \"track context\", \"CTX\");\n      stateNames = track(raw, \"track state\", \"STATE\");\n      formStateNames = track(raw, \"track formstate\", \"FORM_STATE\");\n    }\n  }\n\n  return { contextNames, stateNames, formStateNames };\n}\n","import { isObject } from \"@next-core/utils/general\";\nimport { asyncComputeRealValue, computeRealValue } from \"./computeRealValue.js\";\nimport { TrackingContextItem } from \"./listenOnTrackingContext.js\";\nimport type { AsyncPropertyEntry, RuntimeContext } from \"../interfaces.js\";\nimport { StateOfUseBrick } from \"./getNextStateOfUseBrick.js\";\nimport { getTracks } from \"./getTracks.js\";\n\nexport function asyncComputeRealPropertyEntries(\n  properties: Record<string, unknown> | undefined,\n  runtimeContext: RuntimeContext,\n  trackingContextList: TrackingContextItem[]\n): AsyncPropertyEntry[] {\n  if (isObject(properties)) {\n    return Object.entries(properties).map<[string, Promise<unknown>]>(\n      ([propName, propValue]) => {\n        const { contextNames, stateNames, formStateNames } =\n          getTracks(propValue);\n        if (contextNames || stateNames || formStateNames) {\n          trackingContextList.push({\n            contextNames,\n            stateNames,\n            formStateNames,\n            propName,\n            propValue,\n          });\n        }\n        // Related: https://github.com/facebook/react/issues/11347\n        const asyncValue = asyncComputeRealValue(propValue, runtimeContext, {\n          $$lazyForUseBrick: true,\n          $$stateOfUseBrick:\n            propName === \"useBrick\"\n              ? StateOfUseBrick.USE_BRICK\n              : StateOfUseBrick.INITIAL,\n        });\n        return [propName, asyncValue];\n      }\n    );\n  }\n\n  return [];\n}\n\nexport async function computePropertyValue(\n  asyncPropertyEntries: AsyncPropertyEntry[],\n  propName: string\n): Promise<unknown> {\n  for (const [name, asyncValue, ignoreUndefined] of asyncPropertyEntries) {\n    if (name === propName) {\n      const value = await asyncValue;\n      if (value !== undefined || !ignoreUndefined) {\n        return value;\n      }\n    }\n  }\n}\n\nexport async function constructAsyncProperties(\n  asyncPropertyEntries: AsyncPropertyEntry[]\n): Promise<Record<string, unknown>> {\n  const props: Record<string, unknown> = {};\n  for (const [propName, asyncValue, ignoreUndefined] of asyncPropertyEntries) {\n    const value = await asyncValue;\n    if (\n      (value !== undefined || !ignoreUndefined) &&\n      // For `style` and `dataset`, only object is acceptable.\n      ((propName !== \"style\" && propName !== \"dataset\") || isObject(value))\n    ) {\n      props[propName] = value;\n    }\n  }\n  return props;\n}\n\nexport function computeRealProperties(\n  properties: Record<string, unknown> | undefined,\n  runtimeContext: RuntimeContext\n): Record<string, unknown> {\n  if (isObject(properties)) {\n    return Object.fromEntries(\n      Object.entries(properties)\n        .map<[string, unknown] | undefined>(([propName, propValue]) => {\n          // Related: https://github.com/facebook/react/issues/11347\n          const realValue = computeRealValue(propValue, runtimeContext, {\n            $$lazyForUseBrick: true,\n            $$stateOfUseBrick:\n              propName === \"useBrick\"\n                ? StateOfUseBrick.USE_BRICK\n                : StateOfUseBrick.INITIAL,\n          });\n          // For `style` and `dataset`, only object is acceptable.\n          if (\n            (propName !== \"style\" && propName !== \"dataset\") ||\n            isObject(realValue)\n          ) {\n            return [propName, realValue];\n          }\n        })\n        .filter(Boolean) as [string, unknown][]\n    );\n  }\n\n  return {};\n}\n","export function setRealProperties(\n  brick: HTMLElement,\n  realProps: Record<string, unknown> | undefined\n): void {\n  if (!realProps) {\n    return;\n  }\n  for (const [propName, propValue] of Object.entries(realProps)) {\n    switch (propName) {\n      case \"style\":\n      case \"dataset\":\n        for (const [k, v] of Object.entries(\n          propValue as Record<string, unknown>\n        )) {\n          (brick[propName] as unknown as Record<string, unknown>)[k] = v;\n        }\n        break;\n      case \"constructor\":\n      case \"__proto__\":\n      case \"innerHTML\":\n        // `innerHTML` is dangerous, use `textContent` instead.\n        throw new Error(`set \\`${propName}\\` is prohibited`);\n      default:\n        (brick as unknown as Record<string, unknown>)[propName] = propValue;\n    }\n  }\n}\n","import { computeRealProperties } from \"./computeRealProperties.js\";\nimport { setRealProperties } from \"./setRealProperties.js\";\nimport type { RuntimeContext } from \"../interfaces.js\";\n\nexport function setProperties(\n  bricks: HTMLElement | HTMLElement[],\n  properties: Record<string, unknown>,\n  runtimeContext: RuntimeContext\n): void {\n  const realProps = computeRealProperties(properties, runtimeContext);\n  if (!Array.isArray(bricks)) {\n    bricks = [bricks];\n  }\n  bricks.forEach((brick) => {\n    setRealProperties(brick, realProps);\n  });\n}\n","// Ref https://github.com/ReactTraining/react-router/blob/master/packages/react-router/modules/matchPath.js\nimport type { LegacyCompatibleRuntimeContext } from \"@next-core/inject\";\nimport { pathToRegexp, Key, compile } from \"path-to-regexp\";\n\nconst cache: Map<string, Map<string, CompileResult>> = new Map();\nconst cacheLimit = 10000;\nlet cacheCount = 0;\n\nfunction compilePath(path: string, options: CompileOptions): CompileResult {\n  const cacheKey = `${options.end}${options.strict}${options.sensitive}`;\n  let pathCache = cache.get(cacheKey);\n  if (!pathCache) {\n    cache.set(cacheKey, (pathCache = new Map()));\n  }\n\n  const cacheResult = pathCache.get(path);\n  if (cacheResult) {\n    return cacheResult;\n  }\n\n  const keys: Key[] = [];\n  const regexp = pathToRegexp(path, keys, options);\n  const result = { regexp, keys };\n\n  if (cacheCount < cacheLimit) {\n    pathCache.set(path, result);\n    cacheCount++;\n  }\n\n  return result;\n}\n\n/**\n * Public API for matching a URL pathname to a path.\n */\nexport function matchPath(\n  pathname: string,\n  options: MatchPathOptions\n): MatchResult | null {\n  const { path: p, exact = false, strict = false, sensitive = true } = options;\n\n  const paths = Array.isArray(p) ? p : [p];\n\n  return paths.reduce<MatchResult | null>((matched, path) => {\n    if (matched) {\n      return matched;\n    }\n    const { regexp, keys } = compilePath(path, {\n      end: exact,\n      strict,\n      sensitive,\n    });\n    const match = regexp.exec(pathname);\n\n    if (!match) {\n      return null;\n    }\n\n    const [url, ...values] = match;\n    const isExact = pathname === url;\n\n    if (exact && !isExact) {\n      return null;\n    }\n\n    const initialParams: MatchResult[\"params\"] = {};\n    const result = {\n      path, // the path used to match\n      url: path === \"/\" && url === \"\" ? \"/\" : url, // the matched portion of the URL\n      isExact, // whether or not we matched exactly\n      params: keys.reduce((memo, key, index) => {\n        memo[key.name] = values[index];\n        return memo;\n      }, initialParams),\n    };\n\n    return result;\n  }, null);\n}\n\nexport function toPath(\n  path: string,\n  pathParams?: Record<string, unknown>\n): string {\n  return compile(path)(pathParams);\n}\n\ninterface CompileOptions {\n  end?: boolean;\n  strict?: boolean;\n  sensitive?: boolean;\n}\n\ninterface CompileResult {\n  regexp: RegExp;\n  keys: Key[];\n}\n\ninterface MatchOptions {\n  path: string | string[];\n  exact?: boolean;\n}\n\nexport type MatchPathOptions = MatchOptions & CompileOptions;\n\nexport type MatchResult = Exclude<\n  LegacyCompatibleRuntimeContext[\"match\"],\n  undefined\n>;\n","import type { RouteConf } from \"@next-core/types\";\nimport { MatchResult, matchPath } from \"./matchPath.js\";\nimport { asyncCheckIf } from \"./compute/checkIf.js\";\nimport type { RuntimeContext } from \"./interfaces.js\";\nimport { hooks } from \"./Runtime.js\";\n\ntype MatchRoutesResult =\n  | {\n      match: MatchResult;\n      route: RouteConf;\n    }\n  | \"missed\"\n  | \"unauthenticated\";\n\nexport async function matchRoutes(\n  routes: RouteConf[],\n  runtimeContext: RuntimeContext\n): Promise<MatchRoutesResult> {\n  for (const route of routes) {\n    if (typeof route.path !== \"string\") {\n      // eslint-disable-next-line no-console\n      console.error(\"Invalid route with invalid path:\", route);\n      throw new Error(\n        `Invalid route with invalid type of path: ${typeof route.path}`\n      );\n    }\n    const match = matchRoute(\n      route,\n      runtimeContext.app.homepage,\n      runtimeContext.location.pathname\n    );\n    if (match && (await asyncCheckIf(route, runtimeContext))) {\n      if (\n        runtimeContext.app.noAuthGuard ||\n        route.public ||\n        !hooks?.auth ||\n        hooks.auth.isLoggedIn()\n      ) {\n        return { match, route };\n      }\n      return \"unauthenticated\";\n    }\n  }\n  return \"missed\";\n}\n\nexport function matchRoute(\n  route: RouteConf,\n  homepage: string,\n  pathname: string\n) {\n  const routePath = route.path.replace(/^\\$\\{APP.homepage\\}/, homepage);\n  return matchPath(pathname, {\n    path: routePath,\n    exact: route.exact,\n  });\n}\n","import type { BrickConf } from \"@next-core/types\";\nimport type { AsyncPropertyEntry } from \"../interfaces.js\";\n\nexport const symbolForAsyncComputedPropsFromHost = Symbol.for(\n  \"tpl.asyncComputedPropsFromHost\"\n);\nexport const symbolForTplStateStoreId = Symbol.for(\"tpl.stateStoreId\");\nexport const symbolForTPlExternalForEachItem = Symbol.for(\n  \"tpl.externalForEachItem\"\n);\nexport const symbolForTPlExternalForEachIndex = Symbol.for(\n  \"tpl.externalForEachIndex\"\n);\n\nexport type RuntimeBrickConfWithTplSymbols = BrickConf &\n  RuntimeBrickConfOfTplSymbols;\n\nexport interface RuntimeBrickConfOfTplSymbols {\n  [symbolForAsyncComputedPropsFromHost]?: AsyncPropertyEntry[];\n  [symbolForTplStateStoreId]?: string;\n  [symbolForTPlExternalForEachItem]?: unknown;\n  [symbolForTPlExternalForEachIndex]?: number;\n}\n","let brick: {\n  resolve(options: DialogOptions): Promise<void>;\n};\n\nfunction show(options: DialogOptions): Promise<void> {\n  if (brick) {\n    return brick.resolve(options);\n  } else {\n    if (options.type === \"confirm\") {\n      if (confirm(options.content)) {\n        return new Promise((resolve) =>\n          setTimeout(() => {\n            resolve();\n          }, 1)\n        );\n      } else {\n        return new Promise((resolve, reject) =>\n          setTimeout(() => {\n            reject();\n          }, 1)\n        );\n      }\n    } else {\n      alert(options.content);\n      return new Promise((resolve) =>\n        setTimeout(() => {\n          resolve();\n        }, 1000)\n      );\n    }\n  }\n}\n\nexport function loadDialogService(\n  tagName: string,\n  loader: (bricks: string[]) => Promise<void>\n) {\n  loader([tagName]).then(\n    () => {\n      brick = document.createElement(tagName) as any;\n    },\n    (error: unknown) => {\n      // eslint-disable-next-line no-console\n      console.error(\"Load dialog service failed:\", error);\n    }\n  );\n}\n\nexport interface DialogOptions {\n  type?: \"success\" | \"error\" | \"warn\" | \"info\" | \"confirm\";\n  title?: string | null;\n  content: string;\n  contentStyle?: object;\n}\n\nexport const Dialog = Object.freeze({\n  show,\n});\n","import type { ProviderPollOptions } from \"@next-core/types\";\nimport { _internalApiGetRenderId } from \"./Runtime.js\";\n\nexport type PollableCallbackFunction = (result?: unknown) => unknown;\n\nexport interface PollableCallback {\n  progress?: PollableCallbackFunction;\n  success?: PollableCallbackFunction;\n  error?: PollableCallbackFunction;\n  finally?: PollableCallbackFunction;\n}\n\nconst timeoutIdList = new Set<number>();\n\nexport function startPoll(\n  task: () => unknown,\n  { progress, success, error, finally: finallyCallback }: PollableCallback,\n  {\n    interval,\n    leadingRequestDelay,\n    continueOnError,\n    delegateLoadingBar,\n    expectPollEnd,\n    expectPollStopImmediately,\n  }: ProviderPollOptions\n): void {\n  const currentRenderId = _internalApiGetRenderId();\n  let currentTimeoutId: number;\n  async function poll(): Promise<void> {\n    timeoutIdList.delete(currentTimeoutId);\n    let shouldStop: boolean | undefined;\n    try {\n      shouldStop = expectPollStopImmediately?.();\n      // Stop polling immediately when the expectation is match before task.\n      if (!shouldStop) {\n        const result = await task();\n        // Stop polling immediately when the expectation is match or a different router\n        // is rendering after the task processed.\n        shouldStop =\n          expectPollStopImmediately?.() ||\n          currentRenderId !== _internalApiGetRenderId();\n        if (!shouldStop) {\n          progress?.(result);\n          if (expectPollEnd?.(result)) {\n            if (delegateLoadingBar) {\n              window.dispatchEvent(new Event(\"request.end\"));\n            }\n            success?.(result);\n            finallyCallback?.();\n          } else {\n            delayedPoll(interval ?? 3000);\n          }\n        }\n      }\n    } catch (e) {\n      // Stop polling immediately when the expectation is match or a different router\n      // is rendering after the task processed.\n      shouldStop =\n        expectPollStopImmediately?.() ||\n        currentRenderId !== _internalApiGetRenderId();\n      if (!shouldStop) {\n        error?.(e);\n        if (continueOnError) {\n          delayedPoll(interval ?? 3000);\n        } else {\n          finallyCallback?.();\n        }\n      }\n    } finally {\n      // Manually dispatch an event of `request.end` when the polling is stopped immediately.\n      if (delegateLoadingBar && shouldStop) {\n        window.dispatchEvent(new Event(\"request.end\"));\n      }\n    }\n  }\n\n  function delayedPoll(delay: number): void {\n    currentTimeoutId = setTimeout(poll, delay) as unknown as number;\n    timeoutIdList.add(currentTimeoutId);\n  }\n\n  delayedPoll(leadingRequestDelay ?? 0);\n\n  if (delegateLoadingBar) {\n    window.dispatchEvent(new Event(\"request.start\"));\n  }\n}\n\nexport function clearPollTimeout(): void {\n  for (const timeoutId of timeoutIdList) {\n    clearTimeout(timeoutId);\n  }\n  timeoutIdList.clear();\n}\n","export enum K {\n  REQUEST_FAILED = \"REQUEST_FAILED\",\n  SOMETHING_WENT_WRONG = \"SOMETHING_WENT_WRONG\",\n  LOGIN_TIMEOUT_MESSAGE = \"LOGIN_TIMEOUT_MESSAGE\",\n  NETWORK_ERROR = \"NETWORK_ERROR\",\n}\n\nconst en: Locale = {\n  [K.REQUEST_FAILED]: \"Request Failed\",\n  [K.SOMETHING_WENT_WRONG]: \"Something went wrong!\",\n  [K.LOGIN_TIMEOUT_MESSAGE]:\n    \"You haven't logged in or your login session has expired. Login right now?\",\n  [K.NETWORK_ERROR]: \"Network error, please check your network.\",\n};\n\nconst zh: Locale = {\n  [K.REQUEST_FAILED]: \"请求失败\",\n  [K.SOMETHING_WENT_WRONG]: \"出现了一些问题！\",\n  [K.LOGIN_TIMEOUT_MESSAGE]: \"您还未登录或登录信息已过期，现在重新登录？\",\n  [K.NETWORK_ERROR]: \"网络错误，请检查您的网络连接。\",\n};\n\nexport const NS = \"core/runtime\";\n\nexport const locales = { en, zh };\n\ntype Locale = { [key in K]: string };\n","import { NextLocation } from \"./history.js\";\n\nexport function setLoginStateCookie(location: NextLocation): void {\n  // 独立打包应用 登录时间超时后还是由前端控制跳转，后台无法处理设置登录前的 path 和 query 的 cookie 值\n  // 此这场景下前端做下处理\n\n  const { search, pathname } = location;\n\n  const pathValue = pathname ? window.btoa(encodeURIComponent(pathname)) : \"\";\n\n  const searchValue = search ? window.btoa(encodeURIComponent(search)) : \"\";\n\n  document.cookie = `SALOGINPATH=${pathValue}; path=/`;\n  document.cookie = `SALOGINQUERY=${searchValue}; path=/`;\n}\n","import {\n  HttpAbortError,\n  HttpFetchError,\n  HttpResponseError,\n} from \"@next-core/http\";\nimport { i18n } from \"@next-core/i18n\";\nimport { getRuntime } from \"./internal/Runtime.js\";\nimport { getHistory } from \"./history.js\";\nimport { K, NS } from \"./internal/i18n.js\";\nimport { Dialog } from \"./Dialog.js\";\nimport { setLoginStateCookie } from \"./setLoginStateCookie.js\";\n\n/**\n * 将 http 请求错误转换为可读的字符串。\n *\n * @remarks\n *\n * 将依次尝试读取返回的 JSON 格式数据的字符串类型的 `error` 和 `msg` 字段，如果没有找到则返回 `error.toString()` 的结果。\n *\n * @param error - 错误对象。\n *\n * @returns 转换为字符串的错误信息。\n */\nexport function httpErrorToString(error: unknown): string {\n  if (error instanceof Event && error.target instanceof HTMLScriptElement) {\n    return error.target.src;\n  }\n  if (error instanceof HttpFetchError) {\n    return i18n.t(`${NS}:${K.NETWORK_ERROR}`);\n  }\n  if (error instanceof HttpResponseError) {\n    if (error.responseJson) {\n      if (typeof error.responseJson.error === \"string\") {\n        return error.responseJson.error;\n      } else if (typeof error.responseJson.msg === \"string\") {\n        return error.responseJson.msg;\n      }\n    }\n  }\n  if (error == null) {\n    return \"Unknown error\";\n  }\n  return error.toString();\n}\n\nexport function isUnauthenticatedError(error: unknown): boolean {\n  return (\n    error instanceof HttpResponseError &&\n    error.response.status === 401 &&\n    !!error.responseJson &&\n    error.responseJson.code === 100003\n  );\n}\n\nlet unauthenticatedConfirming = false;\n\nlet lastErrorMessage: string | undefined;\n\n/**\n * 处理 http 请求错误（使用 AntDesign 模态框弹出错误信息）。\n *\n * @param error - 错误对象。\n */\nexport function handleHttpError(error: unknown) {\n  // Do nothing if aborted http requests\n  if (error instanceof HttpAbortError) {\n    return;\n  }\n\n  // Redirect to login page if not logged in.\n  if (isUnauthenticatedError(error) && !window.NO_AUTH_GUARD) {\n    if (unauthenticatedConfirming) {\n      return;\n    }\n    unauthenticatedConfirming = true;\n    Dialog.show({\n      type: \"confirm\",\n      content: i18n.t(`${NS}:${K.LOGIN_TIMEOUT_MESSAGE}`),\n    }).then(\n      () => {\n        redirectToLogin();\n        unauthenticatedConfirming = false;\n      },\n      () => {\n        unauthenticatedConfirming = false;\n      }\n    );\n    return;\n  }\n\n  // eslint-disable-next-line no-console\n  console.error(error);\n\n  const message = httpErrorToString(error);\n  if (message !== lastErrorMessage) {\n    lastErrorMessage = message;\n    Dialog.show({\n      type: \"error\",\n      title: i18n.t(`${NS}:${K.REQUEST_FAILED}`),\n      content: message,\n      contentStyle: {\n        whiteSpace: \"pre-wrap\",\n        wordBreak: \"break-word\",\n      },\n    }).then(() => {\n      lastErrorMessage = undefined;\n    });\n  }\n  return;\n}\n\nfunction redirectToLogin() {\n  const ssoEnabled = getRuntime().getFeatureFlags()[\"sso-enabled\"];\n  const history = getHistory();\n  setLoginStateCookie(history.location);\n  history.push(ssoEnabled ? \"/sso-auth/login\" : \"/auth/login\", {\n    from: {\n      ...history.location,\n      state: undefined,\n    },\n  });\n}\n","let brick: {\n  resolve(options: NotificationOptions): void;\n};\n\nfunction show(options: NotificationOptions) {\n  if (brick) {\n    brick.resolve(options);\n  } else {\n    alert(options.message);\n  }\n}\n\nexport function loadNotificationService(\n  tagName: string,\n  loader: (bricks: string[]) => Promise<void>\n) {\n  loader([tagName]).then(\n    () => {\n      brick = document.createElement(tagName) as any;\n    },\n    (error: unknown) => {\n      // eslint-disable-next-line no-console\n      console.error(\"Load notification service failed:\", error);\n    }\n  );\n}\n\nexport interface NotificationOptions {\n  type?: \"success\" | \"error\" | \"warn\" | \"info\";\n  message: string;\n}\n\nexport const Notification = Object.freeze({\n  show,\n});\n","import type {\n  BrickEventHandler,\n  BrickEventHandlerCallback,\n  BrickEventsMap,\n  BuiltinBrickEventHandler,\n  CustomBrickEventHandler,\n  ExecuteCustomBrickEventHandler,\n  ProviderPollOptions,\n  SetPropsCustomBrickEventHandler,\n  SiteTheme,\n  UseProviderEventHandler,\n  ConditionalEventHandler,\n  BatchUpdateContextItem,\n} from \"@next-core/types\";\nimport { isEvaluable } from \"@next-core/cook\";\nimport { isObject } from \"@next-core/utils/general\";\nimport { checkIf } from \"./compute/checkIf.js\";\nimport { computeRealValue } from \"./compute/computeRealValue.js\";\nimport { getHistory } from \"../history.js\";\nimport { getProviderBrick } from \"./data/getProviderBrick.js\";\nimport { PollableCallback, startPoll } from \"./poll.js\";\nimport { isPreEvaluated } from \"./compute/evaluate.js\";\nimport { setProperties } from \"./compute/setProperties.js\";\nimport { applyMode, applyTheme } from \"../themeAndMode.js\";\nimport type {\n  ElementHolder,\n  RuntimeBrickElement,\n  RuntimeContext,\n} from \"./interfaces.js\";\nimport {\n  getTplHostElement,\n  getTplStateStore,\n} from \"./CustomTemplates/utils.js\";\nimport { handleHttpError, httpErrorToString } from \"../handleHttpError.js\";\nimport { Notification } from \"../Notification.js\";\nimport { getFormStateStore } from \"./FormRenderer/utils.js\";\nimport { DataStore } from \"./data/DataStore.js\";\nimport { hooks } from \"./Runtime.js\";\n\nexport function bindListeners(\n  brick: RuntimeBrickElement,\n  eventsMap: BrickEventsMap | undefined,\n  runtimeContext: RuntimeContext\n): void {\n  if (!eventsMap) {\n    return;\n  }\n  Object.entries(eventsMap).forEach(([eventType, handlers]) => {\n    const listener = listenerFactory(handlers, runtimeContext, {\n      element: brick,\n    });\n    brick.addEventListener(eventType, listener);\n\n    // Remember added listeners for unbinding.\n    if (!brick.$$listeners) {\n      brick.$$listeners = [];\n    }\n    brick.$$listeners.push([eventType, listener]);\n\n    // Remember added listeners for devtools.\n    if (!brick.$$eventListeners) {\n      brick.$$eventListeners = [];\n    }\n    for (const handler of ([] as BrickEventHandler[]).concat(handlers)) {\n      brick.$$eventListeners.push([eventType, null, handler]);\n    }\n  });\n}\n\nexport function unbindListeners(brick: RuntimeBrickElement): void {\n  if (brick.$$listeners) {\n    for (const [eventType, listener] of brick.$$listeners) {\n      brick.removeEventListener(eventType, listener);\n    }\n    brick.$$listeners.length = 0;\n  }\n}\n\nexport function isBuiltinHandler(\n  handler: BrickEventHandler\n): handler is BuiltinBrickEventHandler {\n  return typeof (handler as BuiltinBrickEventHandler).action === \"string\";\n}\n\nexport function isUseProviderHandler(\n  handler: BrickEventHandler\n): handler is UseProviderEventHandler {\n  return typeof (handler as UseProviderEventHandler).useProvider === \"string\";\n}\n\nexport function isCustomHandler(\n  handler: BrickEventHandler\n): handler is CustomBrickEventHandler {\n  return !!(\n    ((handler as CustomBrickEventHandler).target ||\n      (handler as CustomBrickEventHandler).targetRef) &&\n    ((handler as ExecuteCustomBrickEventHandler).method ||\n      (handler as SetPropsCustomBrickEventHandler).properties)\n  );\n}\n\nexport function isExecuteCustomHandler(\n  handler: CustomBrickEventHandler\n): handler is ExecuteCustomBrickEventHandler {\n  return !!(handler as ExecuteCustomBrickEventHandler).method;\n}\n\nexport function isSetPropsCustomHandler(\n  handler: CustomBrickEventHandler\n): handler is SetPropsCustomBrickEventHandler {\n  return !!(handler as SetPropsCustomBrickEventHandler).properties;\n}\n\nexport function isConditionalEventHandler(\n  handler: BrickEventHandler\n): handler is ConditionalEventHandler {\n  return !!(handler as ConditionalEventHandler).then;\n}\n\nexport function listenerFactory(\n  handlers: BrickEventHandler | BrickEventHandler[],\n  runtimeContext: RuntimeContext,\n  runtimeBrick?: ElementHolder\n) {\n  return function (event: Event): void {\n    for (const handler of ([] as BrickEventHandler[]).concat(handlers)) {\n      if (!checkIf(handler, { ...runtimeContext, event })) {\n        if (handler.else) {\n          listenerFactory(handler.else, runtimeContext, runtimeBrick)(event);\n        }\n        continue;\n      }\n\n      if (isConditionalEventHandler(handler)) {\n        listenerFactory(handler.then, runtimeContext, runtimeBrick)(event);\n      } else if (isBuiltinHandler(handler)) {\n        const [object, method] = handler.action.split(\".\") as any;\n        switch (handler.action) {\n          case \"history.push\":\n          case \"history.replace\":\n          case \"history.pushQuery\":\n          case \"history.replaceQuery\":\n          case \"history.pushAnchor\":\n          case \"history.block\":\n          case \"history.goBack\":\n          case \"history.goForward\":\n          case \"history.reload\":\n          case \"history.unblock\":\n            handleHistoryAction(\n              event,\n              method,\n              handler.args,\n              handler.callback,\n              runtimeContext\n            );\n            break;\n\n          // case \"segue.push\":\n          // case \"segue.replace\":\n          // case \"alias.push\":\n          // case \"alias.replace\":\n\n          case \"window.open\":\n            handleWindowAction(event, handler.args, runtimeContext);\n            break;\n\n          case \"location.reload\":\n          case \"location.assign\":\n            handleLocationAction(event, method, handler.args, runtimeContext);\n            break;\n\n          case \"localStorage.setItem\":\n          case \"localStorage.removeItem\":\n          case \"sessionStorage.setItem\":\n          case \"sessionStorage.removeItem\":\n            handleStorageAction(\n              event,\n              object,\n              method,\n              handler.args,\n              runtimeContext\n            );\n            break;\n\n          case \"event.preventDefault\":\n            event.preventDefault();\n            break;\n\n          case \"console.log\":\n          case \"console.error\":\n          case \"console.warn\":\n          case \"console.info\":\n            handleConsoleAction(event, method, handler.args, runtimeContext);\n            break;\n\n          case \"message.success\":\n          case \"message.error\":\n          case \"message.info\":\n          case \"message.warn\":\n            handleMessageAction(event, method, handler.args, runtimeContext);\n            break;\n\n          case \"handleHttpError\":\n            handleHttpError((event as CustomEvent).detail);\n            break;\n\n          case \"context.assign\":\n          case \"context.replace\":\n          case \"context.refresh\":\n          case \"context.load\":\n            handleContextAction(\n              event,\n              method,\n              handler.args,\n              handler.batch ?? true,\n              handler.callback,\n              runtimeContext\n            );\n            break;\n\n          case \"state.update\":\n          case \"state.refresh\":\n          case \"state.load\":\n            handleTplStateAction(\n              event,\n              method,\n              handler.args,\n              handler.batch ?? true,\n              handler.callback,\n              runtimeContext\n            );\n            break;\n\n          case \"tpl.dispatchEvent\": {\n            const [type, init] = argsFactory(\n              handler.args,\n              runtimeContext,\n              event\n            ) as [string, CustomEventInit];\n            const tplHostElement = getTplHostElement(\n              runtimeContext,\n              handler.action,\n              `: ${type}`\n            );\n            tplHostElement.dispatchEvent(new CustomEvent(type, init));\n            break;\n          }\n\n          case \"formstate.update\":\n            handleFormStateAction(\n              event,\n              handler.args,\n              handler.callback,\n              runtimeContext\n            );\n            break;\n\n          case \"message.subscribe\":\n          case \"message.unsubscribe\":\n            handleMessageDispatcher(\n              event,\n              method,\n              handler.args,\n              runtimeContext,\n              runtimeBrick,\n              handler.callback\n            );\n            break;\n\n          case \"theme.setDarkTheme\":\n          case \"theme.setLightTheme\":\n            applyTheme(\n              handler.action === \"theme.setDarkTheme\" ? \"dark\" : \"light\"\n            );\n            break;\n          case \"theme.setTheme\": {\n            const [theme] = argsFactory(handler.args, runtimeContext, event);\n            applyTheme(theme as SiteTheme);\n            break;\n          }\n          case \"mode.setDashboardMode\":\n          case \"mode.setDefaultMode\":\n            applyMode(\n              handler.action === \"mode.setDashboardMode\"\n                ? \"dashboard\"\n                : \"default\"\n            );\n            break;\n\n          // case \"menu.clearMenuTitleCache\":\n          // case \"menu.clearMenuCache\":\n\n          // case \"analytics.event\":\n\n          // case \"preview.debug\":\n\n          default:\n            // eslint-disable-next-line no-console\n            console.error(\"unknown event listener action:\", handler.action);\n        }\n      } else if (isUseProviderHandler(handler)) {\n        handleUseProviderAction(event, handler, runtimeContext, runtimeBrick);\n      } else if (isCustomHandler(handler)) {\n        handleCustomAction(event, handler, runtimeContext, runtimeBrick!);\n      } else {\n        // eslint-disable-next-line no-console\n        console.error(\"unknown event handler:\", handler);\n      }\n    }\n  };\n}\n\nasync function handleUseProviderAction(\n  event: Event,\n  handler: UseProviderEventHandler,\n  runtimeContext: RuntimeContext,\n  runtimeBrick?: ElementHolder\n) {\n  try {\n    const providerBrick = await getProviderBrick(handler.useProvider);\n    const method = handler.method !== \"saveAs\" ? \"resolve\" : \"saveAs\";\n    brickCallback(\n      event,\n      providerBrick,\n      handler,\n      method,\n      runtimeContext,\n      runtimeBrick\n    );\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.error(httpErrorToString(error));\n  }\n}\n\nfunction handleCustomAction(\n  event: Event,\n  handler: CustomBrickEventHandler,\n  runtimeContext: RuntimeContext,\n  runtimeBrick: ElementHolder\n) {\n  let targets: HTMLElement[] = [];\n  const rawTarget = handler.target;\n  const rawTargetRef = handler.targetRef;\n  let computedTarget = rawTarget;\n  // Allow `target` to be set as evaluable string.\n  if (\n    typeof rawTarget === \"string\"\n      ? isEvaluable(rawTarget)\n      : isPreEvaluated(rawTarget)\n  ) {\n    computedTarget = computeRealValue(rawTarget, { ...runtimeContext, event });\n  }\n  if (typeof computedTarget === \"string\") {\n    if (computedTarget === \"_self\") {\n      targets.push(runtimeBrick.element!);\n    } else if (handler.multiple) {\n      targets = Array.from(document.querySelectorAll(computedTarget));\n    } else {\n      const found = document.querySelector(computedTarget) as HTMLElement;\n      if (found !== null) {\n        targets.push(found);\n      }\n    }\n  } else if (computedTarget) {\n    if (computedTarget instanceof HTMLElement) {\n      targets.push(computedTarget as HTMLElement);\n    } else {\n      // eslint-disable-next-line no-console\n      console.error(\"unexpected target:\", computedTarget);\n    }\n  } else if (rawTargetRef) {\n    let computedTargetRef = rawTargetRef;\n    // Allow `targetRef` to be set as evaluable string.\n    if (\n      typeof rawTargetRef === \"string\"\n        ? isEvaluable(rawTargetRef)\n        : isPreEvaluated(rawTargetRef)\n    ) {\n      computedTargetRef = computeRealValue(rawTargetRef, {\n        ...runtimeContext,\n        event,\n      }) as string | string[];\n    }\n    const targetRefs = ([] as string[]).concat(computedTargetRef);\n    const tplHostElement = getTplHostElement(\n      runtimeContext,\n      \"targetRef\",\n      `: ${targetRefs.join(\", \")}`\n    );\n    targets.push(\n      ...(targetRefs\n        .map((ref) => tplHostElement.$$getElementByRef?.(ref))\n        .filter(Boolean) as HTMLElement[])\n    );\n  }\n  if (targets.length === 0) {\n    // eslint-disable-next-line no-console\n    console.error(\"target not found:\", rawTarget || rawTargetRef);\n    return;\n  }\n  if (isExecuteCustomHandler(handler)) {\n    targets.forEach((target) => {\n      brickCallback(\n        event,\n        target,\n        handler,\n        handler.method,\n        runtimeContext,\n        runtimeBrick,\n        {\n          useEventAsDefault: true,\n        }\n      );\n    });\n  } else if (isSetPropsCustomHandler(handler)) {\n    setProperties(targets, handler.properties, {\n      ...runtimeContext,\n      event,\n    });\n  }\n}\n\nasync function brickCallback(\n  event: Event,\n  target: HTMLElement,\n  handler: ExecuteCustomBrickEventHandler | UseProviderEventHandler,\n  method: string,\n  runtimeContext: RuntimeContext,\n  runtimeBrick?: ElementHolder,\n  options?: ArgsFactoryOptions\n): Promise<void> {\n  if (typeof (target as any)[method] !== \"function\") {\n    // eslint-disable-next-line no-console\n    console.error(\"target has no method:\", {\n      target,\n      method: method,\n    });\n    return;\n  }\n\n  const task = async (): Promise<unknown> => {\n    let computedArgs = argsFactory(\n      handler.args,\n      runtimeContext,\n      event,\n      options\n    );\n    if (\n      isUseProviderHandler(handler) &&\n      hooks?.flowApi?.isFlowApiProvider(handler.useProvider)\n    ) {\n      computedArgs = await hooks.flowApi.getArgsOfFlowApi(\n        handler.useProvider,\n        computedArgs,\n        method\n      );\n    }\n    return (target as any)[method](...computedArgs);\n  };\n\n  if (!handler.callback) {\n    task();\n    return;\n  }\n\n  const callbackFactory = eventCallbackFactory(\n    handler.callback,\n    runtimeContext,\n    runtimeBrick\n  );\n\n  const pollableCallback: Required<PollableCallback> = {\n    progress: callbackFactory(\"progress\"),\n    success: callbackFactory(\"success\"),\n    error: callbackFactory(\"error\"),\n    finally: callbackFactory(\"finally\"),\n  };\n\n  let poll: ProviderPollOptions | undefined;\n  if (isUseProviderHandler(handler)) {\n    poll = computeRealValue(handler.poll, { ...runtimeContext, event }) as\n      | ProviderPollOptions\n      | undefined;\n  }\n\n  if (poll?.enabled) {\n    startPoll(task, pollableCallback, poll);\n  } else {\n    try {\n      // Try to catch synchronized tasks too.\n      const result = await task();\n      pollableCallback.success(result);\n    } catch (err) {\n      pollableCallback.error(err);\n    } finally {\n      pollableCallback[\"finally\"]();\n    }\n  }\n}\n\nfunction handleHistoryAction(\n  event: Event,\n  method:\n    | \"push\"\n    | \"replace\"\n    | \"pushQuery\"\n    | \"replaceQuery\"\n    | \"pushAnchor\"\n    | \"block\"\n    | \"goBack\"\n    | \"goForward\"\n    | \"reload\"\n    | \"unblock\",\n  args: unknown[] | undefined,\n  callback: BrickEventHandlerCallback | undefined,\n  runtimeContext: RuntimeContext\n) {\n  let baseArgsLength = 0;\n  let hasCallback = false;\n  let overrideMethod = method as \"setBlockMessage\";\n  switch (method) {\n    case \"push\":\n    case \"replace\":\n    case \"pushQuery\":\n    case \"replaceQuery\":\n    case \"pushAnchor\":\n      baseArgsLength = 2;\n      hasCallback = true;\n      break;\n    case \"reload\":\n      hasCallback = true;\n      break;\n    case \"block\":\n      baseArgsLength = 1;\n      overrideMethod = \"setBlockMessage\";\n      break;\n  }\n  let computedArgs: unknown[] = [];\n  if (baseArgsLength > 0) {\n    computedArgs = argsFactory(args, runtimeContext, event, {\n      useEventDetailAsDefault: true,\n    });\n    computedArgs.length = baseArgsLength;\n  }\n  if (hasCallback && callback) {\n    const callbackFactory = eventCallbackFactory(\n      callback,\n      runtimeContext,\n      undefined\n    );\n    computedArgs.push((blocked: boolean) => {\n      callbackFactory(blocked ? \"error\" : \"success\")({ blocked });\n      callbackFactory(\"finally\")({ blocked });\n    });\n  }\n  (getHistory()[overrideMethod] as (...args: unknown[]) => unknown)(\n    ...computedArgs\n  );\n}\n\nfunction handleWindowAction(\n  event: Event,\n  args: unknown[] | undefined,\n  runtimeContext: RuntimeContext\n) {\n  const [url, target, features] = argsFactory(args, runtimeContext, event) as [\n    string,\n    string,\n    string\n  ];\n  window.open(url, target || \"_self\", features);\n}\n\nfunction batchUpdate(\n  args: unknown[],\n  batch: boolean,\n  method: \"replace\" | \"assign\",\n  store: DataStore<\"CTX\" | \"STATE\">,\n  runtimeContext: RuntimeContext,\n  event: CustomEvent | Event\n): void {\n  if (batch) {\n    store.updateValues(\n      args as BatchUpdateContextItem[],\n      method,\n      (arg: unknown[]) => {\n        return argsFactory(\n          arg,\n          runtimeContext,\n          event\n        )[0] as BatchUpdateContextItem;\n      }\n    );\n  } else {\n    args.forEach((arg) => {\n      const { name, value } = argsFactory(\n        [arg],\n        runtimeContext,\n        event\n      )[0] as BatchUpdateContextItem;\n      store.updateValue(name, value, method);\n    });\n  }\n}\n\nfunction handleContextAction(\n  event: Event,\n  method: \"assign\" | \"replace\",\n  args: unknown[] | undefined,\n  batch: boolean,\n  callback: BrickEventHandlerCallback | undefined,\n  runtimeContext: RuntimeContext\n) {\n  const isBatch = Array.isArray(args) && args.every(isObject);\n  if (isBatch && (method === \"assign\" || method === \"replace\")) {\n    batchUpdate(\n      args,\n      batch,\n      method,\n      runtimeContext.ctxStore,\n      runtimeContext,\n      event\n    );\n  } else {\n    const [name, value] = argsFactory(args, runtimeContext, event);\n    runtimeContext.ctxStore.updateValue(\n      name as string,\n      value,\n      method,\n      callback,\n      runtimeContext\n    );\n  }\n}\n\nfunction handleTplStateAction(\n  event: Event,\n  method: \"update\" | \"refresh\" | \"load\",\n  args: unknown[] | undefined,\n  batch: boolean,\n  callback: BrickEventHandlerCallback | undefined,\n  runtimeContext: RuntimeContext\n) {\n  const isBatch = Array.isArray(args) && args.every(isObject);\n  if (isBatch && method === \"update\") {\n    const tplStateStore = getTplStateStore(\n      runtimeContext,\n      `state.${method}`,\n      `: ${JSON.stringify(args)}`\n    );\n    batchUpdate(args, batch, \"replace\", tplStateStore, runtimeContext, event);\n  } else {\n    const [name, value] = argsFactory(args, runtimeContext, event);\n    const tplStateStore = getTplStateStore(\n      runtimeContext,\n      `state.${method}`,\n      `: ${name}`\n    );\n    tplStateStore.updateValue(\n      name as string,\n      value,\n      method === \"update\" ? \"replace\" : method,\n      callback,\n      runtimeContext\n    );\n  }\n}\n\nfunction handleFormStateAction(\n  event: Event,\n  args: unknown[] | undefined,\n  callback: BrickEventHandlerCallback | undefined,\n  runtimeContext: RuntimeContext\n) {\n  const [name, value] = argsFactory(args, runtimeContext, event);\n  const formStateStore = getFormStateStore(\n    runtimeContext,\n    \"formstate.update\",\n    `: ${name}`\n  );\n  formStateStore.updateValue(\n    name as string,\n    value,\n    \"replace\",\n    callback,\n    runtimeContext\n  );\n}\n\nfunction handleLocationAction(\n  event: Event,\n  method: \"assign\" | \"reload\",\n  args: unknown[] | undefined,\n  runtimeContext: RuntimeContext\n) {\n  if (method === \"assign\") {\n    const [url] = argsFactory(args, runtimeContext, event) as [string];\n    location.assign(url);\n  } else {\n    location[method]();\n  }\n}\n\nfunction handleStorageAction(\n  event: Event,\n  object: \"localStorage\" | \"sessionStorage\",\n  method: \"setItem\" | \"removeItem\",\n  args: unknown[] | undefined,\n  runtimeContext: RuntimeContext\n) {\n  const storage = object === \"localStorage\" ? localStorage : sessionStorage;\n  const [name, value] = argsFactory(args, runtimeContext, event);\n  if (method === \"setItem\") {\n    if (value !== undefined) {\n      storage.setItem(name as string, JSON.stringify(value));\n    }\n  } else {\n    storage.removeItem(name as string);\n  }\n}\n\nfunction handleConsoleAction(\n  event: Event,\n  method: \"log\" | \"error\" | \"warn\" | \"info\",\n  args: unknown[] | undefined,\n  runtimeContext: RuntimeContext\n) {\n  // eslint-disable-next-line no-console\n  console[method](\n    ...argsFactory(args, runtimeContext, event, {\n      useEventAsDefault: true,\n    })\n  );\n}\n\nfunction handleMessageAction(\n  event: Event,\n  method: \"success\" | \"error\" | \"info\" | \"warn\",\n  args: unknown[] | undefined,\n  runtimeContext: RuntimeContext\n) {\n  const computedArgs = argsFactory(args, runtimeContext, event, {\n    useEventAsDefault: true,\n  });\n  Notification.show({\n    type: method,\n    message: computedArgs[0] as string,\n  });\n}\n\nasync function handleMessageDispatcher(\n  event: Event,\n  method: \"subscribe\" | \"unsubscribe\",\n  args: unknown[] | undefined,\n  runtimeContext: RuntimeContext,\n  runtimeBrick?: ElementHolder,\n  callback?: BrickEventHandlerCallback\n) {\n  const task = () => {\n    const computedArgs = argsFactory(args, runtimeContext, event);\n    return hooks?.messageDispatcher?.[method](...computedArgs);\n  };\n  if (!callback) {\n    task();\n    return;\n  }\n  const callbackFactory = eventCallbackFactory(\n    callback,\n    runtimeContext,\n    runtimeBrick\n  );\n  try {\n    const result = await task();\n    callbackFactory(\"success\")(result);\n  } catch (error) {\n    callbackFactory(\"error\")(error);\n  } finally {\n    callbackFactory(\"finally\")();\n  }\n}\n\nexport function eventCallbackFactory(\n  callback: BrickEventHandlerCallback,\n  runtimeContext: RuntimeContext,\n  runtimeBrick?: ElementHolder\n) {\n  return function callbackFactory(\n    type: \"success\" | \"error\" | \"finally\" | \"progress\"\n  ) {\n    return function (result?: unknown) {\n      const handlers = callback?.[type];\n      if (handlers) {\n        try {\n          const event = new CustomEvent(`callback.${type}`, {\n            detail: result,\n          });\n          listenerFactory(handlers, runtimeContext, runtimeBrick)(event);\n        } catch (err) {\n          // Do not throw errors in `callback.success` or `callback.progress`,\n          // to avoid the following triggering of `callback.error`.\n          // eslint-disable-next-line\n          console.error(err);\n        }\n      } else if (type === \"error\") {\n        // eslint-disable-next-line\n        console.error(\"Unhandled callback error:\", result);\n      }\n    };\n  };\n}\n\ninterface ArgsFactoryOptions {\n  useEventAsDefault?: boolean;\n  useEventDetailAsDefault?: boolean;\n}\n\nfunction argsFactory(\n  args: unknown[] | undefined,\n  runtimeContext: RuntimeContext,\n  event: Event,\n  options: ArgsFactoryOptions = {}\n): unknown[] {\n  return Array.isArray(args)\n    ? (computeRealValue(args, {\n        ...runtimeContext,\n        event,\n      }) as unknown[])\n    : options.useEventAsDefault\n    ? [event]\n    : options.useEventDetailAsDefault\n    ? [(event as CustomEvent).detail]\n    : [];\n}\n","import type {\n  BatchUpdateContextItem,\n  BrickEventHandlerCallback,\n  ContextConf,\n  ContextResolveTriggerBrickLifeCycle,\n  RouteConf,\n} from \"@next-core/types\";\nimport { hasOwnProperty, isObject } from \"@next-core/utils/general\";\nimport { strictCollectMemberUsage } from \"@next-core/utils/storyboard\";\nimport EventTarget from \"@ungap/event-target\";\nimport { eventCallbackFactory, listenerFactory } from \"../bindListeners.js\";\nimport { asyncCheckIf } from \"../compute/checkIf.js\";\nimport {\n  asyncComputeRealValue,\n  computeRealValue,\n} from \"../compute/computeRealValue.js\";\nimport { ResolveOptions, resolveData } from \"./resolveData.js\";\nimport { resolveDataStore } from \"./resolveDataStore.js\";\nimport type {\n  AsyncPropertyEntry,\n  RuntimeBrick,\n  RuntimeContext,\n} from \"../interfaces.js\";\nimport { handleHttpError } from \"../../handleHttpError.js\";\nimport type { RendererContext } from \"../RendererContext.js\";\nimport { computePropertyValue } from \"../compute/computeRealProperties.js\";\nimport { _internalApiGetRenderId } from \"../Runtime.js\";\n\nconst supportContextResolveTriggerBrickLifeCycle = [\n  \"onBeforePageLoad\",\n  \"onPageLoad\",\n  \"onBeforePageLeave\",\n  \"onPageLeave\",\n  \"onAnchorLoad\",\n  \"onAnchorUnload\",\n] as ContextResolveTriggerBrickLifeCycle[];\n\nexport type DataStoreType = \"CTX\" | \"STATE\" | \"FORM_STATE\";\n\nexport interface DataStoreItem {\n  name: string;\n  value: unknown;\n  eventTarget: EventTarget;\n  loaded?: boolean;\n  loading?: Promise<unknown>;\n  load?: (options?: ResolveOptions) => Promise<unknown>;\n  async?: boolean;\n  asyncMounted?: boolean;\n  deps: string[];\n}\n\nexport class DataStore<T extends DataStoreType = \"CTX\"> {\n  private readonly type: T;\n  private readonly data = new Map<string, DataStoreItem>();\n  private readonly changeEventType: string;\n  private readonly pendingStack: Array<ReturnType<typeof resolveDataStore>> =\n    [];\n  public readonly hostBrick?: RuntimeBrick;\n  public batchUpdate = false;\n  public batchUpdateContextsNames: string[] = [];\n  private readonly rendererContext?: RendererContext;\n  private routeMap = new WeakMap<RouteConf, Set<string>>();\n\n  // 把 `rendererContext` 放在参数列表的最后，并作为可选，以减少测试文件的调整\n  constructor(\n    type: T,\n    hostBrick?: RuntimeBrick,\n    rendererContext?: RendererContext\n  ) {\n    this.type = type;\n    this.changeEventType =\n      this.type === \"FORM_STATE\"\n        ? \"formstate.change\"\n        : this.type === \"STATE\"\n        ? \"state.change\"\n        : \"context.change\";\n    this.hostBrick = hostBrick;\n    this.rendererContext = rendererContext;\n  }\n\n  getAllValues(): Record<string, unknown> {\n    return Object.fromEntries(\n      [...this.data.entries()].map(([name, { value }]) => [name, value])\n    );\n  }\n\n  getValue(name: string): unknown {\n    return this.data.get(name)?.value;\n  }\n\n  private getAffectListByContext(name: string): string[] {\n    const affectNames = [name];\n    this.data.forEach((value, key) => {\n      if (value.deps) {\n        const isInDeps = value.deps.some((item) => affectNames.includes(item));\n        isInDeps &&\n          affectNames.push(key) &&\n          affectNames.push(...this.getAffectListByContext(key));\n      }\n    });\n    affectNames.shift();\n    return [...new Set(affectNames)];\n  }\n\n  updateValues(\n    values: BatchUpdateContextItem[],\n    method: \"assign\" | \"replace\",\n    argsFactory: (arg: unknown[]) => BatchUpdateContextItem\n  ): void {\n    this.batchUpdate = true;\n    this.batchUpdateContextsNames = values.map((item) => item.name);\n    if (\n      [...new Set(this.batchUpdateContextsNames)].length !==\n      this.batchUpdateContextsNames.length\n    ) {\n      throw new Error(`Batch update not allow to update same item`);\n    }\n\n    const updateContexts: Record<string, DataStoreItem> = {};\n    const affectContexts: Record<string, DataStoreItem> = {};\n    const affectDepsContextNames: string[] = [];\n\n    values.forEach((arg) => {\n      const { name, value } = argsFactory([arg]);\n      const updateContextItem = this.data.get(name);\n      affectDepsContextNames.push(...this.getAffectListByContext(name));\n      updateContextItem && (updateContexts[name] = updateContextItem);\n      this.updateValue(name as string, value, method);\n    });\n\n    affectDepsContextNames\n      .filter((item) => !updateContexts[item])\n      .forEach((name) => {\n        const affectContextItem = this.data.get(name);\n        affectContextItem && (affectContexts[name] = affectContextItem);\n      });\n\n    const triggerEvent = (contexts: Record<string, DataStoreItem>): void => {\n      for (const key in contexts) {\n        const context = contexts[key];\n        context.eventTarget?.dispatchEvent(\n          new CustomEvent(this.changeEventType, {\n            detail: context.value,\n          })\n        );\n      }\n    };\n\n    triggerEvent(updateContexts);\n    triggerEvent(affectContexts);\n\n    this.batchUpdate = false;\n\n    return;\n  }\n\n  updateValue(\n    name: string,\n    value: unknown,\n    method: \"assign\" | \"replace\" | \"refresh\" | \"load\",\n    callback?: BrickEventHandlerCallback,\n    callbackRuntimeContext?: RuntimeContext\n  ): void {\n    const item = this.data.get(name);\n    if (!item) {\n      throw new Error(`${this.type} '${name}' is not defined`);\n    }\n\n    if (method === \"refresh\" || method === \"load\") {\n      if (!item.load) {\n        throw new Error(\n          `You can not ${method} \"${this.type}.${name}\" which has no resolve`\n        );\n      }\n\n      let promise: Promise<unknown> | undefined;\n      if (method === \"load\") {\n        // Try to reuse previous request when calling `load`.\n        if (item.loaded) {\n          promise = Promise.resolve(item.value);\n        } else if (item.loading) {\n          promise = item.loading;\n        }\n      }\n\n      const shouldDismiss = (error: unknown) => {\n        // If render twice immediately, flow API contracts maybe cleared before\n        // the second rendering, while the page load handlers of the first\n        // rendering can't be cancelled, which throws `FlowApiNotFoundError`.\n        // So we ignore error reporting for this case.\n        let renderId: string | undefined;\n        return (\n          (error as Error)?.name === \"FlowApiNotFoundError\" &&\n          !!(renderId = this.rendererContext?.renderId) &&\n          renderId !== _internalApiGetRenderId()\n        );\n      };\n\n      if (!promise) {\n        promise = item.loading = item.load({\n          cache: method === \"load\" ? \"default\" : \"reload\",\n          ...(value as ResolveOptions),\n        });\n        // Do not use the chained promise, since the callbacks need the original promise.\n        promise.then(\n          (val) => {\n            item.loaded = true;\n            item.value = val;\n            item.eventTarget.dispatchEvent(\n              new CustomEvent(this.changeEventType, {\n                detail: item.value,\n              })\n            );\n          },\n          (err) => {\n            // Let users override error handling.\n            if (!shouldDismiss(err) && !callback?.error) {\n              handleHttpError(err);\n            }\n          }\n        );\n      }\n\n      if (callback) {\n        const callbackFactory = eventCallbackFactory(\n          callback,\n          callbackRuntimeContext!\n        );\n\n        promise.then(\n          (val) => {\n            callbackFactory(\"success\")({ value: val });\n            callbackFactory(\"finally\")();\n          },\n          (err) => {\n            if (!shouldDismiss(err) && callback.error) {\n              callbackFactory(\"error\")(err);\n            }\n            callbackFactory(\"finally\")();\n          }\n        );\n      }\n\n      return;\n    }\n\n    if (method === \"replace\") {\n      item.value = value;\n    } else {\n      if (isObject(item.value)) {\n        Object.assign(item.value, value);\n      } else {\n        // eslint-disable-next-line no-console\n        console.warn(\n          `Non-object current value of \"${this.type}.${name}\" for \"context.assign\", try \"context.replace\" instead.`\n        );\n        item.value = value;\n      }\n    }\n\n    if (this.batchUpdate) return;\n\n    item.eventTarget.dispatchEvent(\n      new CustomEvent(this.changeEventType, {\n        detail: item.value,\n      })\n    );\n  }\n\n  define(\n    dataConfs: ContextConf[] | undefined,\n    runtimeContext: RuntimeContext,\n    asyncHostPropertyEntries?: AsyncPropertyEntry[],\n    routePath?: RouteConf[]\n  ): void {\n    if (Array.isArray(dataConfs) && dataConfs.length > 0) {\n      const pending = resolveDataStore(\n        dataConfs,\n        (dataConf: ContextConf) =>\n          this.resolve(\n            dataConf,\n            runtimeContext,\n            asyncHostPropertyEntries,\n            routePath\n          ),\n        this.type\n      );\n      this.pendingStack.push(pending);\n    }\n  }\n\n  onChange(dataName: string, listener: EventListener): void {\n    this.data\n      .get(dataName)\n      ?.eventTarget.addEventListener(this.changeEventType, listener);\n  }\n\n  async waitFor(dataNames: string[] | Set<string>): Promise<void> {\n    for (const { pendingContexts } of this.pendingStack) {\n      await Promise.all(\n        [...dataNames].map((ctx) => {\n          const p = pendingContexts.get(ctx);\n          return p;\n        })\n      );\n    }\n  }\n\n  async waitForAll(): Promise<void> {\n    // Silent each pending contexts, since the error is handled by batched `pendingResult`\n    for (const { pendingContexts } of this.pendingStack) {\n      for (const p of pendingContexts.values()) {\n        p.catch(() => {\n          /* No-op */\n        });\n      }\n    }\n    for (const { pendingResult } of this.pendingStack) {\n      await pendingResult;\n    }\n  }\n\n  /**\n   * After mount, dispatch the change event when an async data is loaded.\n   *\n   * If param `route` is present, handle data defined in that route (or its descendants) only.\n   */\n  mountAsyncData(route?: RouteConf) {\n    this.data.forEach((item) => {\n      if (item.async && (!route || this.routeMap.get(route)?.has(item.name))) {\n        // istanbul ignore next\n        if (item.asyncMounted) {\n          // eslint-disable-next-line no-console\n          console.error(\n            `Async data \"${item.name}\" already mounted. This is a bug of Brick Next, please report it.`\n          );\n          return;\n        }\n        item.asyncMounted = true;\n        // An async data always has `loading`\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        item.loading!.then((value) => {\n          item.loaded = true;\n          item.value = value;\n          item.eventTarget.dispatchEvent(\n            new CustomEvent(this.changeEventType, {\n              detail: value,\n            })\n          );\n        });\n      }\n    });\n  }\n\n  private async resolve(\n    dataConf: ContextConf,\n    runtimeContext: RuntimeContext,\n    asyncHostPropertyEntries?: AsyncPropertyEntry[],\n    routePath?: RouteConf[]\n  ): Promise<boolean> {\n    if (!(await asyncCheckIf(dataConf, runtimeContext))) {\n      return false;\n    }\n    let value: unknown;\n    if (\n      asyncHostPropertyEntries &&\n      (this.type === \"STATE\" ? dataConf.expose : this.type === \"FORM_STATE\")\n    ) {\n      value = await computePropertyValue(\n        asyncHostPropertyEntries,\n        dataConf.name\n      );\n    }\n    let load: DataStoreItem[\"load\"];\n    let loading: Promise<unknown> | undefined;\n    let resolvePolicy: \"eager\" | \"lazy\" | \"async\" = \"eager\";\n    if (value === undefined) {\n      if (dataConf.resolve) {\n        const resolveConf = {\n          transform: \"value\",\n          ...dataConf.resolve,\n        };\n        if (await asyncCheckIf(dataConf.resolve, runtimeContext)) {\n          load = async (options) =>\n            (\n              (await resolveData(resolveConf, runtimeContext, {\n                ...options,\n                renderId: this.rendererContext?.renderId,\n              })) as {\n                value: unknown;\n              }\n            ).value;\n          // `async` take precedence over `lazy`\n          resolvePolicy = dataConf.resolve.async\n            ? \"async\"\n            : dataConf.resolve.lazy\n            ? \"lazy\"\n            : \"eager\";\n          if (resolvePolicy === \"eager\") {\n            value = await load();\n          } else if (resolvePolicy === \"async\") {\n            loading = load();\n          }\n        } else if (!hasOwnProperty(dataConf, \"value\")) {\n          return false;\n        }\n      }\n      if (\n        (!load || resolvePolicy !== \"eager\") &&\n        dataConf.value !== undefined\n      ) {\n        // If the context has no resolve, just use its `value`.\n        // Or if the resolve is ignored or lazy, use its `value` as a fallback.\n        value = await asyncComputeRealValue(dataConf.value, runtimeContext);\n      }\n    }\n\n    const newData: DataStoreItem = {\n      name: dataConf.name,\n      value,\n      // This is required for tracking context, even if no `onChange` is specified.\n      eventTarget: new EventTarget(),\n      load,\n      loaded: resolvePolicy === \"eager\",\n      loading,\n      async: resolvePolicy === \"async\",\n      deps: [],\n    };\n\n    if (resolvePolicy === \"lazy\") {\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      const { trigger } = dataConf.resolve!;\n      if (\n        trigger &&\n        supportContextResolveTriggerBrickLifeCycle.includes(trigger)\n      ) {\n        this.rendererContext?.registerArbitraryLifeCycle(trigger, () => {\n          this.updateValue(dataConf.name, undefined, \"load\");\n        });\n      }\n    }\n\n    if (dataConf.onChange) {\n      newData.eventTarget.addEventListener(\n        this.changeEventType,\n        listenerFactory(dataConf.onChange, runtimeContext)\n      );\n    }\n\n    if (dataConf.track) {\n      const deps = strictCollectMemberUsage(\n        load ? dataConf.resolve : dataConf.value,\n        this.type\n      );\n      !load && (newData.deps = [...deps]);\n      for (const dep of deps) {\n        this.onChange(\n          dep,\n          this.batchAddListener(() => {\n            if (load) {\n              this.updateValue(dataConf.name, { cache: \"default\" }, \"refresh\");\n            } else {\n              this.updateValue(\n                dataConf.name,\n                computeRealValue(dataConf.value, runtimeContext),\n                \"replace\"\n              );\n            }\n          }, dataConf)\n        );\n      }\n    }\n\n    if (this.data.has(dataConf.name)) {\n      throw new Error(\n        `${this.type} '${dataConf.name}' has already been declared`\n      );\n    }\n    this.data.set(dataConf.name, newData);\n\n    if (Array.isArray(routePath)) {\n      for (const route of routePath) {\n        const names = this.routeMap.get(route);\n        if (names) {\n          names.add(dataConf.name);\n        } else {\n          this.routeMap.set(route, new Set([dataConf.name]));\n        }\n      }\n    }\n\n    return true;\n  }\n\n  disposeDataInRoutes(routes: RouteConf[]) {\n    for (const route of routes) {\n      const names = this.routeMap.get(route);\n      if (names !== undefined) {\n        for (const name of names) {\n          this.data.delete(name);\n        }\n      }\n    }\n  }\n\n  private batchAddListener(\n    listener: EventListener,\n    contextConf: ContextConf\n  ): EventListener {\n    return (event: Event | CustomEvent): void => {\n      if (\n        this.batchUpdate &&\n        this.batchUpdateContextsNames.includes(contextConf.name)\n      ) {\n        return;\n      }\n      listener(event);\n    };\n  }\n}\n","import { ContextConf } from \"@next-core/types\";\nimport { collectMemberUsage, MemberUsage } from \"@next-core/utils/storyboard\";\n\nexport interface DeferredContext {\n  resolve(): void;\n  reject(e: unknown): void;\n}\n\nexport function resolveDataStore(\n  contextConfs: ContextConf[],\n  resolveContext: (contextConf: ContextConf) => Promise<boolean>,\n  keyword = \"CTX\"\n): {\n  pendingResult: Promise<void>;\n  pendingContexts: Map<string, Promise<void>>;\n} {\n  const dependencyMap = getDependencyMapOfContext(contextConfs, keyword);\n  // There maybe multiple context confs for a specific name, since there are conditional contexts.\n  // This is a map of how many pending context confs for each context name.\n  const pendingDeps = new Map<string, number>();\n  for (const contextName of Array.from(dependencyMap.keys()).map(\n    (contextConf) => contextConf.name\n  )) {\n    pendingDeps.set(contextName, (pendingDeps.get(contextName) ?? 0) + 1);\n  }\n  const hasNonStaticUsage = Array.from(dependencyMap.values()).some(\n    (stats) => stats.hasNonStaticUsage\n  );\n  const processed = new WeakSet<ContextConf>();\n\n  const deferredContexts = new Map<string, DeferredContext>();\n  const pendingContexts = new Map(\n    [...new Set(contextConfs.map((contextConf) => contextConf.name))].map(\n      (contextName) => [\n        contextName,\n        new Promise<void>((resolve, reject) => {\n          deferredContexts.set(contextName, { resolve, reject });\n        }),\n      ]\n    )\n  );\n\n  const wrapResolve = async (contextConf: ContextConf): Promise<void> => {\n    processed.add(contextConf);\n    const resolved = await resolveContext(contextConf);\n    dependencyMap.delete(contextConf);\n    const left = pendingDeps.get(contextConf.name) ?? 0;\n    if (resolved) {\n      // Assert: contextConf.name exists in deferredContexts\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      deferredContexts.get(contextConf.name)!.resolve();\n      pendingDeps.delete(contextConf.name);\n      if (left === 0) {\n        throw new Error(`Duplicated context defined: ${contextConf.name}`);\n      }\n    } else {\n      // Assert: left >= 1\n      if (left === 1) {\n        // Assert: contextConf.name exists in deferredContexts\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        deferredContexts.get(contextConf.name)!.resolve();\n        pendingDeps.delete(contextConf.name);\n      } else {\n        pendingDeps.set(contextConf.name, left - 1);\n      }\n    }\n    await scheduleNext();\n  };\n\n  let scheduleAsSerial = hasNonStaticUsage;\n\n  async function scheduleNext(): Promise<void> {\n    const readyContexts = Array.from(dependencyMap.entries())\n      .filter(predicateNextResolveFactory(pendingDeps, scheduleAsSerial))\n      .map((entry) => entry[0])\n      .filter((contextConf) => !processed.has(contextConf));\n    await Promise.all(readyContexts.map(wrapResolve));\n  }\n\n  const pendingResult = scheduleNext()\n    .then(async () => {\n      // If there are still contexts left, it implies one of these situations:\n      //   - Circular contexts.\n      //     Such as: a depends on b, while b depends on a.\n      //   - Related contexts are all ignored.\n      //     Such as: a depends on b,\n      //     while both them are ignore by a falsy result of `if`.\n      if (dependencyMap.size > 0) {\n        // This will throw if circular contexts detected.\n        detectCircularContexts(dependencyMap, keyword);\n        scheduleAsSerial = true;\n        await scheduleNext();\n      }\n      // There maybe ignored contexts which are still not fulfilled.\n      // We treat them as RESOLVED.\n      for (const deferred of deferredContexts.values()) {\n        deferred.resolve();\n      }\n    })\n    .catch((error) => {\n      // There maybe contexts left not fulfilled, when an error occurred.\n      // We treat them as REJECTED.\n      for (const deferred of deferredContexts.values()) {\n        deferred.reject(error);\n      }\n      throw error;\n    });\n  return { pendingResult, pendingContexts };\n}\n\nfunction predicateNextResolveFactory(\n  pendingDeps: Map<string, number>,\n  scheduleAsSerial: boolean\n): (entry: [ContextConf, MemberUsage], index: number) => boolean {\n  return (entry, index) =>\n    // When contexts contain computed CTX accesses, it implies a dynamic dependency map.\n    // So make them process sequentially, keep the same behavior as before.\n    scheduleAsSerial\n      ? index === 0\n      : // A context is ready when it has no pending dependencies.\n        ![...entry[1].usedProperties].some((dep) => pendingDeps.has(dep));\n}\n\nexport function getDependencyMapOfContext(\n  contextConfs: ContextConf[],\n  keyword = \"CTX\"\n): Map<ContextConf, MemberUsage> {\n  const depsMap = new Map<ContextConf, MemberUsage>();\n  for (const contextConf of contextConfs) {\n    const stats = collectMemberUsage(\n      [contextConf.if, contextConf.value, contextConf.resolve],\n      keyword\n    );\n    depsMap.set(contextConf, stats);\n  }\n  return depsMap;\n}\n\nfunction detectCircularContexts(\n  dependencyMap: Map<ContextConf, MemberUsage>,\n  keyword: string\n): void {\n  const duplicatedMap = new Map(dependencyMap);\n  const pendingDeps = new Set<string>(\n    Array.from(duplicatedMap.keys()).map((contextConf) => contextConf.name)\n  );\n  const next = (): void => {\n    let processedAtLeastOne = false;\n    for (const [contextConf, stats] of duplicatedMap.entries()) {\n      if (![...stats.usedProperties].some((dep) => pendingDeps.has(dep))) {\n        duplicatedMap.delete(contextConf);\n        pendingDeps.delete(contextConf.name);\n        processedAtLeastOne = true;\n      }\n    }\n    if (processedAtLeastOne) {\n      next();\n    }\n  };\n  next();\n\n  if (duplicatedMap.size > 0) {\n    throw new ReferenceError(\n      `Circular ${keyword} detected: ${Array.from(duplicatedMap.keys())\n        .map((contextConf) => contextConf.name)\n        .join(\", \")}`\n    );\n  }\n}\n","import type { BrickConf, RouteConf, SlotsConfOfBricks } from \"@next-core/types\";\nimport { hasOwnProperty } from \"@next-core/utils/general\";\nimport { clamp } from \"lodash\";\nimport {\n  symbolForAsyncComputedPropsFromHost,\n  symbolForTPlExternalForEachIndex,\n  symbolForTPlExternalForEachItem,\n  symbolForTplStateStoreId,\n} from \"./constants.js\";\nimport type { AsyncPropertyEntry, TemplateHostContext } from \"../interfaces.js\";\nimport { computePropertyValue } from \"../compute/computeRealProperties.js\";\n\nexport function setupTemplateProxy(\n  hostContext: TemplateHostContext,\n  ref: string | undefined,\n  slots: SlotsConfOfBricks\n) {\n  const {\n    reversedProxies,\n    asyncHostPropertyEntries,\n    externalSlots,\n    tplStateStoreId,\n    hostBrick,\n  } = hostContext;\n\n  let asyncComputedProps: AsyncPropertyEntry[] | undefined;\n\n  if (ref && reversedProxies) {\n    const propertyProxies = reversedProxies.properties.get(ref);\n    if (propertyProxies) {\n      const getComputedProps = (\n        asyncHostProps: AsyncPropertyEntry[]\n      ): AsyncPropertyEntry[] => {\n        return propertyProxies!\n          .map(({ from, to }) => {\n            const filtered = asyncHostProps.filter(\n              (entry) => entry[0] === from\n            );\n            if (filtered.length > 0 && to.refProperty) {\n              return [\n                to.refProperty,\n                computePropertyValue(filtered, from),\n                true,\n              ];\n            }\n          })\n          .filter(Boolean) as [string, Promise<unknown>][];\n      };\n\n      asyncComputedProps = getComputedProps(asyncHostPropertyEntries);\n    }\n\n    const slotProxies = reversedProxies.slots.get(ref);\n    if (slotProxies && externalSlots) {\n      // Use an approach like template-literal's quasis:\n      // `quasi0${0}quais1${1}quasi2...`\n      // Every quasi (indexed by `refPosition`) can be slotted with multiple bricks.\n      const quasisMap = new Map<string, BrickConf[][]>();\n\n      for (const { from, to } of slotProxies) {\n        const insertBricks = externalSlots[from]?.bricks ?? [];\n        if (!insertBricks.length) {\n          continue;\n        }\n        const refToSlot = to.refSlot ?? from;\n        let expandableSlot = quasisMap.get(refToSlot);\n        if (!expandableSlot) {\n          expandableSlot = [];\n          // The size of quasis should be the existed slotted bricks' size plus one.\n          const size = hasOwnProperty(slots, refToSlot)\n            ? slots[refToSlot].bricks.length + 1\n            : 1;\n          for (let i = 0; i < size; i += 1) {\n            expandableSlot.push([]);\n          }\n          quasisMap.set(refToSlot, expandableSlot);\n        }\n        const refPosition = to.refPosition ?? -1;\n        expandableSlot[\n          clamp(\n            refPosition < 0 ? expandableSlot.length + refPosition : refPosition,\n            0,\n            expandableSlot.length - 1\n          )\n        ].push(\n          ...(hasOwnProperty(hostBrick.runtimeContext, \"forEachItem\")\n            ? setupTemplateExternalBricks(\n                insertBricks,\n                hostBrick.runtimeContext.forEachItem,\n                hostBrick.runtimeContext.forEachIndex!\n              )\n            : insertBricks)\n        );\n      }\n\n      for (const [slotName, quasis] of quasisMap.entries()) {\n        if (!hasOwnProperty(slots, slotName)) {\n          slots[slotName] = {\n            type: \"bricks\",\n            bricks: [],\n          };\n        }\n        const slotConf = slots[slotName];\n        slotConf.bricks = quasis.flatMap((bricks, index) =>\n          index < slotConf.bricks.length\n            ? bricks.concat(slotConf.bricks[index])\n            : bricks\n        );\n\n        if (slotConf.bricks.length === 0) {\n          delete slots[slotName];\n        }\n      }\n    }\n  }\n\n  return {\n    [symbolForAsyncComputedPropsFromHost]: asyncComputedProps,\n    [symbolForTplStateStoreId]: tplStateStoreId,\n  };\n}\n\n// External bricks of a template, have the same forEachItem context as their host.\nfunction setupTemplateExternalBricks(\n  bricks: BrickConf[],\n  forEachItem: unknown,\n  forEachIndex: number\n): BrickConf[] {\n  return bricks.map((brick) => ({\n    ...brick,\n    [symbolForTPlExternalForEachItem]: forEachItem,\n    [symbolForTPlExternalForEachIndex]: forEachIndex,\n    slots: Object.fromEntries(\n      Object.entries(brick.slots ?? {}).map(([slotName, slotConf]) => [\n        slotName,\n        slotConf.type === \"routes\"\n          ? {\n              type: \"routes\",\n              routes: setupTemplateExternalRoutes(\n                slotConf.routes,\n                forEachItem,\n                forEachIndex\n              ),\n            }\n          : {\n              type: \"bricks\",\n              bricks: setupTemplateExternalBricks(\n                slotConf.bricks ?? [],\n                forEachItem,\n                forEachIndex\n              ),\n            },\n      ])\n    ),\n  }));\n}\n\nfunction setupTemplateExternalRoutes(\n  routes: RouteConf[],\n  forEachItem: unknown,\n  forEachIndex: number\n): RouteConf[] {\n  return routes.map((route) =>\n    route.type && route.type !== \"bricks\"\n      ? route\n      : {\n          ...route,\n          bricks: setupTemplateExternalBricks(\n            route.bricks,\n            forEachItem,\n            forEachIndex\n          ),\n        }\n  );\n}\n","import type { UseBrickSlotsConf, UseSingleBrickConf } from \"@next-core/types\";\nimport { isObject } from \"@next-core/utils/general\";\nimport type { TemplateHostContext } from \"../interfaces.js\";\nimport { setupTemplateProxy } from \"./setupTemplateProxy.js\";\nimport { childrenToSlots } from \"../Renderer.js\";\n\nexport function setupUseBrickInTemplate<T>(\n  props: T,\n  hostContext: TemplateHostContext\n): T {\n  function walk<P>(props: P): P {\n    if (!isObject(props) || typeof props === \"function\") {\n      return props;\n    }\n\n    if (Array.isArray(props)) {\n      return props.map(walk) as P;\n    }\n\n    return Object.fromEntries(\n      Object.entries(props)\n        .map(([key, value]) =>\n          isObject(value) && key === \"useBrick\"\n            ? Array.isArray(value)\n              ? [key, value.map(setup)]\n              : [key, setup(value as UseSingleBrickConf)]\n            : [key, walk(value)]\n        )\n        .concat(\n          Object.getOwnPropertySymbols(props).map((k) => [\n            k,\n            (props as Record<string | symbol, unknown>)[k],\n          ])\n        )\n    ) as P;\n  }\n\n  function setup(item: UseSingleBrickConf): UseSingleBrickConf {\n    const { properties, slots: originalSlots, children, ...restConf } = item;\n\n    const transpiledSlots = childrenToSlots(children, originalSlots) as\n      | UseBrickSlotsConf\n      | undefined;\n\n    const slots = Object.fromEntries(\n      Object.entries(transpiledSlots ?? {}).map(([slotName, slotConf]) => [\n        slotName,\n        {\n          type: \"bricks\",\n          bricks: (slotConf.bricks ?? []).map(setup),\n        },\n      ])\n    ) as UseBrickSlotsConf;\n\n    return {\n      ...restConf,\n      properties: walk(properties),\n      slots,\n      ...setupTemplateProxy(hostContext, restConf.ref, slots),\n    };\n  }\n\n  return walk(props);\n}\n","import type {\n  BrickConf,\n  BrickConfInTemplate,\n  SlotsConfInTemplate,\n  SlotsConfOfBricks,\n  UseSingleBrickConf,\n} from \"@next-core/types\";\nimport { uniqueId } from \"lodash\";\nimport { customTemplates } from \"../../CustomTemplates.js\";\nimport { DataStore } from \"../data/DataStore.js\";\nimport { RuntimeBrickConfWithTplSymbols } from \"./constants.js\";\nimport { setupTemplateProxy } from \"./setupTemplateProxy.js\";\nimport type {\n  AsyncPropertyEntry,\n  RuntimeBrick,\n  TemplateHostBrick,\n  TemplateHostContext,\n} from \"../interfaces.js\";\nimport { setupUseBrickInTemplate } from \"./setupUseBrickInTemplate.js\";\nimport { childrenToSlots } from \"../Renderer.js\";\nimport { hooks } from \"../Runtime.js\";\nimport type { RendererContext } from \"../RendererContext.js\";\n\nexport function expandCustomTemplate<T extends BrickConf | UseSingleBrickConf>(\n  tplTagName: string,\n  brickConf: T,\n  hostBrick: RuntimeBrick,\n  asyncHostPropertyEntries: AsyncPropertyEntry[],\n  rendererContext: RendererContext\n): T {\n  const tplStateStoreId = uniqueId(\"tpl-state-\");\n  const runtimeContext = {\n    ...hostBrick.runtimeContext,\n    tplStateStoreId,\n  };\n\n  // There is a boundary for `forEachItem` and `FORM_STATE` between template internals and externals.\n  delete runtimeContext.forEachItem;\n  delete runtimeContext.forEachIndex;\n  delete runtimeContext.formStateStoreId;\n\n  const tplStateStore = new DataStore(\"STATE\", hostBrick, rendererContext);\n  runtimeContext.tplStateStoreMap.set(tplStateStoreId, tplStateStore);\n  if (runtimeContext.tplStateStoreScope) {\n    runtimeContext.tplStateStoreScope.push(tplStateStore);\n  }\n\n  const { bricks, proxy, state, contracts } = customTemplates.get(tplTagName)!;\n  hooks?.flowApi?.collectWidgetContract(contracts);\n  tplStateStore.define(state, runtimeContext, asyncHostPropertyEntries);\n\n  const {\n    slots: originalExternalSlots,\n    children: externalChildren,\n    ...restBrickConf\n  } = brickConf;\n\n  const newBrickConf = {\n    ...restBrickConf,\n    brick: tplTagName,\n  } as T;\n\n  hostBrick.tplHostMetadata = {\n    internalBricksByRef: new Map(),\n    tplStateStoreId,\n    proxy,\n  };\n\n  // Reversed proxies are used for expand storyboard before rendering page.\n  const reversedProxies: TemplateHostContext[\"reversedProxies\"] = {\n    properties: new Map(),\n    slots: new Map(),\n    // mergeBases: new Map(),\n  };\n\n  if (proxy?.properties) {\n    for (const [from, to] of Object.entries(proxy.properties)) {\n      let proxies = reversedProxies.properties.get(to.ref);\n      if (!proxies) {\n        proxies = [];\n        reversedProxies.properties.set(to.ref, proxies);\n      }\n      proxies.push({\n        from,\n        to,\n      });\n    }\n  }\n\n  if (proxy?.slots) {\n    for (const [from, to] of Object.entries(proxy.slots)) {\n      let proxies = reversedProxies.slots.get(to.ref);\n      if (!proxies) {\n        proxies = [];\n        reversedProxies.slots.set(to.ref, proxies);\n      }\n      proxies.push({\n        from,\n        to,\n      });\n    }\n  }\n\n  const hostContext: TemplateHostContext = {\n    reversedProxies,\n    asyncHostPropertyEntries,\n    externalSlots: childrenToSlots(externalChildren, originalExternalSlots) as\n      | SlotsConfOfBricks\n      | undefined,\n    tplStateStoreId,\n    hostBrick: hostBrick as TemplateHostBrick,\n  };\n\n  newBrickConf.slots = {\n    \"\": {\n      type: \"bricks\",\n      bricks: bricks.map((item) => expandBrickInTemplate(item, hostContext)),\n    },\n  };\n\n  return newBrickConf;\n}\n\nfunction expandBrickInTemplate(\n  brickConfInTemplate: BrickConfInTemplate,\n  hostContext: TemplateHostContext\n): RuntimeBrickConfWithTplSymbols {\n  // Ignore `if: null` to make `looseCheckIf` working.\n  if (brickConfInTemplate.if === null) {\n    delete brickConfInTemplate.if;\n  }\n  const {\n    properties,\n    slots: slotsInTemplate,\n    children: childrenInTemplate,\n    ...restBrickConfInTemplate\n  } = brickConfInTemplate;\n\n  const transpiledSlots = childrenToSlots(\n    childrenInTemplate,\n    slotsInTemplate\n  ) as SlotsConfInTemplate | undefined;\n\n  const slots: SlotsConfOfBricks = Object.fromEntries(\n    Object.entries(transpiledSlots ?? {}).map(([slotName, slotConf]) => [\n      slotName,\n      {\n        type: \"bricks\",\n        bricks: (slotConf.bricks ?? []).map((item) =>\n          expandBrickInTemplate(item, hostContext)\n        ),\n      },\n    ])\n  );\n\n  return {\n    ...restBrickConfInTemplate,\n    properties: setupUseBrickInTemplate(properties, hostContext),\n    slots,\n    ...setupTemplateProxy(hostContext, restBrickConfInTemplate.ref, slots),\n  };\n}\n","export enum RenderTag {\n  ROOT = 1,\n  BRICK = 2,\n  PLACEHOLDER = 3,\n}\n","import type { BrickConf } from \"@next-core/types\";\n\nexport const FORM_RENDERER = \"form-renderer.form-renderer\";\nexport const symbolForFormStateStoreId = Symbol.for(\"form.stateStoreId\");\n\nexport type RuntimeBrickConfWithFormSymbols = BrickConf &\n  RuntimeBrickConfOfFormSymbols;\n\nexport interface RuntimeBrickConfOfFormSymbols {\n  [symbolForFormStateStoreId]?: string;\n}\n","import type { BrickConf, BrickEventsMap } from \"@next-core/types\";\nimport { hasOwnProperty } from \"@next-core/utils/general\";\nimport { uniqueId } from \"lodash\";\nimport { DataStore } from \"../data/DataStore.js\";\nimport type { AsyncPropertyEntry, RuntimeBrick } from \"../interfaces.js\";\nimport type {\n  FieldProperties,\n  FormDataProperties,\n  FormSchemaProperties,\n} from \"./interfaces.js\";\nimport { getDefaultProperties } from \"./getDefaultProperties.js\";\nimport { symbolForFormStateStoreId } from \"./constants.js\";\nimport type { RendererContext } from \"../RendererContext.js\";\n\nconst formContainers = [\"forms.general-form\", \"form.general-form\", \"eo-form\"];\n\nexport function expandFormRenderer(\n  formData: unknown,\n  hostBrickConf: BrickConf,\n  hostBrick: RuntimeBrick,\n  asyncHostPropertyEntries: AsyncPropertyEntry[],\n  rendererContext: RendererContext\n): BrickConf {\n  const normalizedFormData = (\n    typeof formData === \"string\" ? JSON.parse(formData) : formData\n  ) as FormDataProperties;\n\n  const formStateStoreId = uniqueId(\"form-state-\");\n  const runtimeContext = {\n    ...hostBrick.runtimeContext,\n    formStateStoreId,\n  };\n\n  // There is a boundary for `forEachItem` and `STATE` between form internals and externals.\n  delete runtimeContext.forEachItem;\n  delete runtimeContext.forEachIndex;\n  delete runtimeContext.tplStateStoreId;\n\n  const formStateStore = new DataStore(\n    \"FORM_STATE\",\n    undefined,\n    rendererContext\n  );\n  runtimeContext.formStateStoreMap.set(formStateStoreId, formStateStore);\n  if (runtimeContext.formStateStoreScope) {\n    runtimeContext.formStateStoreScope.push(formStateStore);\n  }\n\n  // Always add a state of `params`.\n  const context = normalizedFormData.context ?? [];\n  if (!context.some((ctx) => ctx.name === \"params\")) {\n    context.push({ name: \"params\" });\n  }\n\n  formStateStore.define(context, runtimeContext, asyncHostPropertyEntries);\n\n  const formConf = formSchemaToBrick(\n    normalizedFormData.formSchema,\n    normalizedFormData.fields,\n    formStateStoreId\n  );\n\n  if (formContainers.includes(formConf.brick) && hostBrickConf.events) {\n    formConf.events = mergeEvents(formConf.events, hostBrickConf.events);\n  }\n\n  const renderRoot =\n    typeof hostBrickConf.properties?.renderRoot !== \"boolean\" ||\n    hostBrickConf.properties.renderRoot;\n\n  if (renderRoot) {\n    return {\n      ...hostBrickConf,\n      slots: undefined,\n      children: [\n        {\n          brick: \"eo-micro-view\",\n          properties: { style: { padding: \"12px\" } },\n          children: [formConf],\n        },\n      ],\n    };\n  }\n\n  return {\n    ...hostBrickConf,\n    slots: undefined,\n    children: [formConf],\n  };\n}\n\nfunction formSchemaToBrick(\n  schema: FormSchemaProperties,\n  fields: FieldProperties[],\n  formStateStoreId: string\n): BrickConf {\n  const { id, bricks, events, context, mountPoint, instanceId: iid } = schema;\n  let { brick, properties } = schema;\n\n  // 根据字段类型获取默认配置\n  const field = fields.find((item: FieldProperties) => item.fieldId === id);\n  if (field) {\n    const defaults = getDefaultProperties(field);\n    if (!brick) {\n      brick = defaults.brick;\n    }\n    properties = {\n      ...defaults.properties,\n      ...properties,\n    };\n  }\n\n  const brickConf = {\n    brick,\n    properties,\n    iid,\n    slot: mountPoint,\n    events,\n    context,\n    children: formSchemasToBricks(bricks, fields, formStateStoreId),\n    [symbolForFormStateStoreId]: formStateStoreId,\n  } as BrickConf;\n\n  if (hasOwnProperty(schema, \"if\")) {\n    brickConf.if = schema.if;\n  }\n\n  return brickConf;\n}\n\nfunction formSchemasToBricks(\n  schemas: FormSchemaProperties[] | undefined,\n  fields: FieldProperties[],\n  formStateStoreId: string\n): BrickConf[] | undefined {\n  if (Array.isArray(schemas)) {\n    return schemas.map((schema) =>\n      formSchemaToBrick(schema, fields, formStateStoreId)\n    );\n  }\n}\n\nfunction mergeEvents(\n  targetEvents: BrickEventsMap | undefined,\n  sourceEvents: BrickEventsMap\n): BrickEventsMap {\n  const events = targetEvents ?? {};\n\n  for (const [eventType, handlers] of Object.entries(sourceEvents)) {\n    events[eventType] = hasOwnProperty(events, eventType)\n      ? [events[eventType], handlers].flat()\n      : handlers;\n  }\n\n  return events;\n}\n","import type { DefaultFieldProperties, FieldProperties } from \"./interfaces.js\";\n\nexport function getDefaultProperties(\n  field: FieldProperties\n): DefaultFieldProperties {\n  let defaultValue: DefaultFieldProperties;\n  const commonProps = {\n    id: field.fieldId,\n    name: field.fieldId,\n    label: field.name,\n    dataset: {\n      testid: field.fieldId,\n    },\n  };\n  const getReadOnlyAndRequired = () => ({\n    readOnly: field.limit?.includes(\"READONLY\"),\n    required: field.limit?.includes(\"REQUIRED\"),\n  });\n  switch (field.fieldType) {\n    case \"INT\":\n      defaultValue = {\n        brick: \"forms.general-input-number\",\n        properties: {\n          ...commonProps,\n          ...getReadOnlyAndRequired(),\n          placeholder: field.description,\n          precision: 0,\n          inputBoxStyle: { width: \"100%\" },\n        },\n      };\n      break;\n    case \"BOOLEAN\":\n      defaultValue = {\n        brick: \"forms.general-switch\",\n        properties: {\n          ...commonProps,\n          ...getReadOnlyAndRequired(),\n        },\n      };\n      break;\n    case \"FLOAT\":\n      defaultValue = {\n        brick: \"forms.general-input-number\",\n        properties: {\n          ...commonProps,\n          ...getReadOnlyAndRequired(),\n          placeholder: field.description,\n          inputBoxStyle: { width: \"100%\" },\n        },\n      };\n      break;\n    case \"ENUM\":\n      defaultValue = {\n        brick: \"forms.general-select\",\n        properties: {\n          ...commonProps,\n          ...getReadOnlyAndRequired(),\n          options: [\n            { label: \"选项一\", value: 1 },\n            { label: \"选项二\", value: 2 },\n          ],\n          placeholder: field.description,\n          inputBoxStyle: { width: \"100%\" },\n        },\n      };\n      break;\n    case \"ENUMS\":\n      defaultValue = {\n        brick: \"forms.general-select\",\n        properties: {\n          ...commonProps,\n          ...getReadOnlyAndRequired(),\n          mode: \"multiple\",\n          options: [\n            { label: \"选项一\", value: 1 },\n            { label: \"选项二\", value: 2 },\n          ],\n          placeholder: field.description,\n          inputBoxStyle: { width: \"100%\" },\n        },\n      };\n      break;\n    case \"DATE\":\n    case \"TIME\":\n      defaultValue = {\n        brick: \"forms.general-date-picker\",\n        properties: {\n          ...commonProps,\n          ...getReadOnlyAndRequired(),\n          placeholder: field.description,\n        },\n      };\n      break;\n    case \"IP\":\n      defaultValue = {\n        brick: \"forms.general-input\",\n        properties: {\n          ...commonProps,\n          ...getReadOnlyAndRequired(),\n          placeholder: field.description,\n          pattern:\n            \"((^s*((([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5]).){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5]))s*$)|(^s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:)))(%.+)?s*$))\",\n          message: {\n            pattern: \"输入字符不匹配IP格式\",\n          },\n        },\n      };\n      break;\n    case \"JSON\":\n      defaultValue = {\n        brick: \"forms.general-textarea\",\n        properties: {\n          ...commonProps,\n        },\n      };\n      break;\n    case \"ARRAY\":\n      defaultValue = {\n        brick: \"forms.general-select\",\n        properties: {\n          ...commonProps,\n        },\n      };\n      break;\n    case \"STRUCTURE\":\n    case \"STRUCTURE_ARRAY\":\n      defaultValue = {\n        brick: \"forms.cmdb-instance-select-panel\",\n        properties: {\n          ...commonProps,\n          ...getReadOnlyAndRequired(),\n        },\n      };\n      break;\n    default:\n      defaultValue = {\n        brick: \"forms.general-input\",\n        properties: {\n          ...commonProps,\n          ...getReadOnlyAndRequired(),\n          placeholder: field.description,\n        },\n      };\n  }\n  return defaultValue;\n}\n","import type {\n  BrickConf,\n  BrickConfInTemplate,\n  ContextConf,\n  MenuConf,\n  RouteConf,\n  SlotConfOfBricks,\n  SlotsConf,\n  StaticMenuConf,\n} from \"@next-core/types\";\nimport {\n  enqueueStableLoadBricks,\n  flushStableLoadBricks,\n  loadBricksImperatively,\n  loadProcessorsImperatively,\n  loadScript,\n  loadStyle,\n} from \"@next-core/loader\";\nimport { isTrackAll } from \"@next-core/cook\";\nimport { hasOwnProperty } from \"@next-core/utils/general\";\nimport { strictCollectMemberUsage } from \"@next-core/utils/storyboard\";\nimport { debounce } from \"lodash\";\nimport { asyncCheckBrickIf } from \"./compute/checkIf.js\";\nimport {\n  asyncComputeRealPropertyEntries,\n  constructAsyncProperties,\n} from \"./compute/computeRealProperties.js\";\nimport { resolveData } from \"./data/resolveData.js\";\nimport { asyncComputeRealValue } from \"./compute/computeRealValue.js\";\nimport {\n  TrackingContextItem,\n  listenOnTrackingContext,\n} from \"./compute/listenOnTrackingContext.js\";\nimport { RendererContext } from \"./RendererContext.js\";\nimport { matchRoute, matchRoutes } from \"./matchRoutes.js\";\nimport {\n  symbolForAsyncComputedPropsFromHost,\n  symbolForTPlExternalForEachIndex,\n  symbolForTPlExternalForEachItem,\n  symbolForTplStateStoreId,\n} from \"./CustomTemplates/constants.js\";\nimport { expandCustomTemplate } from \"./CustomTemplates/expandCustomTemplate.js\";\nimport type {\n  RenderBrick,\n  RenderChildNode,\n  RenderReturnNode,\n  RuntimeBrickConfWithSymbols,\n  RuntimeContext,\n} from \"./interfaces.js\";\nimport {\n  getTagNameOfCustomTemplate,\n  getTplStateStore,\n} from \"./CustomTemplates/utils.js\";\nimport { customTemplates } from \"../CustomTemplates.js\";\nimport type { NextHistoryState } from \"./historyExtended.js\";\nimport { getBrickPackages, hooks } from \"./Runtime.js\";\nimport { RenderTag } from \"./enums.js\";\nimport { getTracks } from \"./compute/getTracks.js\";\nimport { isStrictMode, warnAboutStrictMode } from \"../isStrictMode.js\";\nimport {\n  FORM_RENDERER,\n  RuntimeBrickConfOfFormSymbols,\n  symbolForFormStateStoreId,\n} from \"./FormRenderer/constants.js\";\nimport { expandFormRenderer } from \"./FormRenderer/expandFormRenderer.js\";\nimport { isPreEvaluated } from \"./compute/evaluate.js\";\nimport { getPreEvaluatedRaw } from \"./compute/evaluate.js\";\nimport { RuntimeBrickConfOfTplSymbols } from \"./CustomTemplates/constants.js\";\nimport { matchHomepage } from \"./matchStoryboard.js\";\nimport type { DataStore, DataStoreType } from \"./data/DataStore.js\";\nimport { listenerFactory } from \"./bindListeners.js\";\n\nexport interface RenderOutput {\n  node?: RenderChildNode;\n  unauthenticated?: boolean;\n  redirect?: {\n    path: string;\n    state?: NextHistoryState;\n  };\n  route?: RouteConf;\n  path?: string;\n  blockingList: (Promise<unknown> | undefined)[];\n  menuRequests: Promise<StaticMenuConf>[];\n  hasTrackingControls?: boolean;\n}\n\nexport async function renderRoutes(\n  returnNode: RenderReturnNode,\n  routes: RouteConf[],\n  _runtimeContext: RuntimeContext,\n  rendererContext: RendererContext,\n  parentRoutes: RouteConf[],\n  slotId?: string,\n  isIncremental?: boolean\n): Promise<RenderOutput> {\n  const matched = await matchRoutes(routes, _runtimeContext);\n  const output = getEmptyRenderOutput();\n  switch (matched) {\n    case \"missed\":\n      break;\n    case \"unauthenticated\":\n      output.unauthenticated = true;\n      break;\n    default: {\n      const route = (output.route = matched.route);\n      output.path = matched.match.path;\n      const runtimeContext = {\n        ..._runtimeContext,\n        match: matched.match,\n      };\n      if (isIncremental) {\n        runtimeContext.ctxStore.disposeDataInRoutes(routes);\n      }\n      const routePath = parentRoutes.concat(route);\n      runtimeContext.ctxStore.define(\n        route.context,\n        runtimeContext,\n        undefined,\n        routePath\n      );\n      runtimeContext.pendingPermissionsPreCheck.push(\n        hooks?.checkPermissions?.preCheckPermissionsForBrickOrRoute(\n          route,\n          (value) => asyncComputeRealValue(value, runtimeContext)\n        )\n      );\n\n      // Currently, this is only used for brick size-checking: these bricks\n      // will be loaded before page rendering, but they will NOT be rendered.\n      const { preLoadBricks } = route as { preLoadBricks?: string[] };\n      if (Array.isArray(preLoadBricks)) {\n        output.blockingList.push(\n          loadBricksImperatively(preLoadBricks, getBrickPackages())\n        );\n      }\n\n      if (route.type === \"redirect\") {\n        let redirectTo: unknown;\n        if (typeof route.redirect === \"string\") {\n          redirectTo = await asyncComputeRealValue(\n            route.redirect,\n            runtimeContext\n          );\n        } else {\n          const resolved = (await resolveData(\n            {\n              transform: \"redirect\",\n              ...route.redirect,\n            },\n            runtimeContext\n          )) as { redirect?: unknown };\n          redirectTo = resolved.redirect;\n        }\n        if (typeof redirectTo !== \"string\") {\n          // eslint-disable-next-line no-console\n          console.error(\"Unexpected redirect result:\", redirectTo);\n          throw new Error(\n            `Unexpected type of redirect result: ${typeof redirectTo}`\n          );\n        }\n        output.redirect = { path: redirectTo };\n      } else {\n        const menuRequest = loadMenu(route.menu, runtimeContext);\n        if (menuRequest) {\n          output.menuRequests.push(menuRequest);\n        }\n\n        if (route.type === \"routes\") {\n          const newOutput = await renderRoutes(\n            returnNode,\n            route.routes,\n            runtimeContext,\n            rendererContext,\n            routePath,\n            slotId\n          );\n          mergeRenderOutput(output, newOutput);\n        } else {\n          const newOutput = await renderBricks(\n            returnNode,\n            route.bricks,\n            runtimeContext,\n            rendererContext,\n            routePath,\n            slotId\n          );\n          mergeRenderOutput(output, newOutput);\n        }\n\n        if (returnNode.tag === RenderTag.BRICK) {\n          rendererContext.memoizeMenuRequests(route, output.menuRequests);\n        }\n      }\n    }\n  }\n\n  return output;\n}\n\nexport async function renderBricks(\n  returnNode: RenderReturnNode,\n  bricks: BrickConf[],\n  runtimeContext: RuntimeContext,\n  rendererContext: RendererContext,\n  parentRoutes: RouteConf[],\n  slotId?: string,\n  tplStack?: Map<string, number>,\n  keyPath?: number[]\n): Promise<RenderOutput> {\n  const output = getEmptyRenderOutput();\n  const kPath = keyPath ?? [];\n  // 多个构件并行异步转换，但转换的结果按原顺序串行合并。\n  const rendered = await Promise.all(\n    bricks.map((brickConf, index) =>\n      renderBrick(\n        returnNode,\n        brickConf,\n        runtimeContext,\n        rendererContext,\n        parentRoutes,\n        slotId,\n        kPath.concat(index),\n        tplStack && new Map(tplStack)\n      )\n    )\n  );\n\n  rendered.forEach((item, index) => {\n    if (item.hasTrackingControls) {\n      // Memoize a render node before it's been merged.\n      rendererContext.memoize(\n        slotId,\n        kPath.concat(index),\n        item.node,\n        returnNode\n      );\n    }\n    mergeRenderOutput(output, item);\n  });\n\n  return output;\n}\n\nexport async function renderBrick(\n  returnNode: RenderReturnNode,\n  brickConf: RuntimeBrickConfWithSymbols,\n  _runtimeContext: RuntimeContext,\n  rendererContext: RendererContext,\n  parentRoutes: RouteConf[],\n  slotId?: string,\n  keyPath: number[] = [],\n  tplStack = new Map<string, number>()\n): Promise<RenderOutput> {\n  const output = getEmptyRenderOutput();\n\n  if (!brickConf.brick) {\n    if ((brickConf as { template?: string }).template) {\n      // eslint-disable-next-line no-console\n      console.error(\"Legacy templates are dropped in v3:\", brickConf);\n    } else {\n      // eslint-disable-next-line no-console\n      console.error(\"Invalid brick:\", brickConf);\n    }\n    return output;\n  }\n\n  // Translate `if: \"<%= ... %>\"` to `brick: \":if\", dataSource: \"<%= ... %>\"`.\n  // In other words, translate tracking if expressions to tracking control nodes of `:if`.\n  const { if: brickIf, permissionsPreCheck, ...restBrickConf } = brickConf;\n  if (isGeneralizedTrackAll(brickIf)) {\n    return renderBrick(\n      returnNode,\n      {\n        brick: \":if\",\n        dataSource: brickIf,\n        // `permissionsPreCheck` maybe required before computing `if`.\n        permissionsPreCheck,\n        slots: {\n          \"\": {\n            type: \"bricks\",\n            bricks: [restBrickConf],\n          },\n        },\n        // These symbols have to be copied to the new brick conf.\n        ...Object.getOwnPropertySymbols(brickConf).reduce(\n          (acc, symbol) => ({\n            ...acc,\n            [symbol]: (brickConf as any)[symbol],\n          }),\n          {} as RuntimeBrickConfOfTplSymbols & RuntimeBrickConfOfFormSymbols\n        ),\n      },\n      _runtimeContext,\n      rendererContext,\n      parentRoutes,\n      slotId,\n      keyPath,\n      tplStack\n    );\n  }\n\n  const tplStateStoreId = brickConf[symbolForTplStateStoreId];\n  const formStateStoreId = brickConf[symbolForFormStateStoreId];\n  const runtimeContext = {\n    ..._runtimeContext,\n    tplStateStoreId,\n    formStateStoreId,\n  };\n\n  if (hasOwnProperty(brickConf, symbolForTPlExternalForEachItem)) {\n    // The external bricks of a template should restore their `forEachItem` and\n    // `forEachIndex` from their host.\n    runtimeContext.forEachItem = brickConf[symbolForTPlExternalForEachItem];\n    runtimeContext.forEachIndex = brickConf[symbolForTPlExternalForEachIndex];\n  }\n\n  const { context } = brickConf as { context?: ContextConf[] };\n  // istanbul ignore next\n  if (Array.isArray(context) && context.length > 0) {\n    const strict = isStrictMode(runtimeContext);\n    warnAboutStrictMode(\n      strict,\n      \"Defining context on bricks\",\n      \"check your brick:\",\n      brickConf\n    );\n    if (!strict) {\n      runtimeContext.ctxStore.define(context, runtimeContext);\n    }\n  }\n\n  runtimeContext.pendingPermissionsPreCheck.push(\n    hooks?.checkPermissions?.preCheckPermissionsForBrickOrRoute(\n      brickConf,\n      (value) => asyncComputeRealValue(value, runtimeContext)\n    )\n  );\n\n  if (!(await asyncCheckBrickIf(brickConf, runtimeContext))) {\n    return output;\n  }\n\n  const brickName = brickConf.brick;\n  if (brickName.startsWith(\":\")) {\n    ensureValidControlBrick(brickName);\n\n    const { dataSource } = brickConf;\n\n    const lowerLevelRenderControlNode = async (\n      runtimeContext: RuntimeContext\n    ) => {\n      // First, compute the `dataSource`\n      const computedDataSource = await asyncComputeRealValue(\n        dataSource,\n        runtimeContext\n      );\n\n      // Then, get the matched slot.\n      const slot =\n        brickName === \":forEach\"\n          ? \"\"\n          : brickName === \":switch\"\n          ? String(computedDataSource)\n          : computedDataSource\n          ? \"\"\n          : \"else\";\n\n      // Don't forget to transpile children to slots.\n      const slots = childrenToSlots(brickConf.children, brickConf.slots);\n\n      // Then, get the bricks in that matched slot.\n      const bricks =\n        slots &&\n        hasOwnProperty(slots, slot) &&\n        (slots[slot] as SlotConfOfBricks)?.bricks;\n\n      if (!Array.isArray(bricks)) {\n        return getEmptyRenderOutput();\n      }\n\n      switch (brickName) {\n        case \":forEach\": {\n          if (!Array.isArray(computedDataSource)) {\n            return getEmptyRenderOutput();\n          }\n          return renderForEach(\n            returnNode,\n            computedDataSource,\n            bricks,\n            runtimeContext,\n            rendererContext,\n            parentRoutes,\n            slotId,\n            tplStack,\n            keyPath\n          );\n        }\n        case \":if\":\n        case \":switch\": {\n          return renderBricks(\n            returnNode,\n            bricks,\n            runtimeContext,\n            rendererContext,\n            parentRoutes,\n            slotId,\n            tplStack,\n            keyPath\n          );\n        }\n      }\n    };\n\n    const renderControlNode = async (runtimeContext: RuntimeContext) => {\n      const rawOutput = await lowerLevelRenderControlNode(runtimeContext);\n      rawOutput.node ??= {\n        tag: RenderTag.PLACEHOLDER,\n        return: returnNode,\n      };\n      return rawOutput;\n    };\n\n    const controlledOutput = await renderControlNode(runtimeContext);\n    const { onMount, onUnmount } = brickConf.lifeCycle ?? {};\n\n    const { contextNames, stateNames } = getTracks(dataSource);\n    if (contextNames || stateNames) {\n      controlledOutput.hasTrackingControls = true;\n      let renderId = 0;\n      const listener = async () => {\n        const currentRenderId = ++renderId;\n        const [scopedRuntimeContext, tplStateStoreScope, formStateStoreScope] =\n          createScopedRuntimeContext(runtimeContext);\n\n        const reControlledOutput =\n          await renderControlNode(scopedRuntimeContext);\n\n        const scopedStores = [...tplStateStoreScope, ...formStateStoreScope];\n        await postAsyncRender(\n          reControlledOutput,\n          scopedRuntimeContext,\n          scopedStores\n        );\n\n        // Ignore stale renders\n        if (renderId === currentRenderId) {\n          if (onUnmount) {\n            listenerFactory(\n              onUnmount,\n              runtimeContext\n            )(new CustomEvent(\"unmount\", { detail: { rerender: true } }));\n          }\n\n          rendererContext.reRender(\n            slotId,\n            keyPath,\n            reControlledOutput.node,\n            returnNode\n          );\n\n          if (onMount) {\n            listenerFactory(\n              onMount,\n              scopedRuntimeContext\n            )(new CustomEvent(\"mount\", { detail: { rerender: true } }));\n          }\n\n          for (const store of scopedStores) {\n            store.mountAsyncData();\n          }\n        }\n      };\n      const debouncedListener = debounce(listener);\n      if (contextNames) {\n        for (const contextName of contextNames) {\n          runtimeContext.ctxStore.onChange(contextName, debouncedListener);\n        }\n      }\n      if (stateNames) {\n        for (const contextName of stateNames) {\n          const tplStateStore = getTplStateStore(\n            runtimeContext,\n            \"STATE\",\n            `: \"${dataSource}\"`\n          );\n          tplStateStore.onChange(contextName, debouncedListener);\n        }\n      }\n    }\n\n    if (onMount) {\n      rendererContext.registerArbitraryLifeCycle(\"onMount\", () => {\n        listenerFactory(\n          onMount,\n          runtimeContext\n        )(new CustomEvent(\"mount\", { detail: { rerender: false } }));\n      });\n    }\n\n    if (onUnmount) {\n      rendererContext.registerArbitraryLifeCycle(\"onUnmount\", () => {\n        listenerFactory(\n          onUnmount,\n          runtimeContext\n        )(new CustomEvent(\"unmount\", { detail: { rerender: false } }));\n      });\n    }\n\n    return controlledOutput;\n  }\n\n  // Widgets need to be defined before rendering.\n  if (/\\.tpl-/.test(brickName) && !customTemplates.get(brickName)) {\n    await catchLoad(\n      loadBricksImperatively([brickName], getBrickPackages()),\n      \"brick\",\n      brickName,\n      rendererContext.unknownBricks\n    );\n  }\n\n  const tplTagName = getTagNameOfCustomTemplate(\n    brickName,\n    runtimeContext.app?.id\n  );\n\n  if (tplTagName) {\n    const tplCount = tplStack.get(tplTagName) ?? 0;\n    if (tplCount >= 10) {\n      throw new Error(\n        `Maximum custom template stack overflowed: \"${tplTagName}\"`\n      );\n    }\n    tplStack.set(tplTagName, tplCount + 1);\n  } else if (brickName.includes(\"-\") && !customElements.get(brickName)) {\n    if (brickName === FORM_RENDERER) {\n      customElements.define(\n        FORM_RENDERER,\n        class FormRendererElement extends HTMLElement {\n          get $$typeof(): string {\n            return \"form-renderer\";\n          }\n        }\n      );\n    } else {\n      output.blockingList.push(\n        catchLoad(\n          enqueueStableLoadBricks([brickName], getBrickPackages()),\n          \"brick\",\n          brickName,\n          rendererContext.unknownBricks\n        )\n      );\n    }\n  }\n\n  let formData: unknown;\n  let confProps: Record<string, unknown> | undefined;\n  if (brickName === FORM_RENDERER) {\n    ({ formData, ...confProps } = brickConf.properties ?? {});\n  } else {\n    confProps = brickConf.properties;\n  }\n\n  const trackingContextList: TrackingContextItem[] = [];\n  const asyncPropertyEntries = asyncComputeRealPropertyEntries(\n    confProps,\n    runtimeContext,\n    trackingContextList\n  );\n\n  const computedPropsFromHost = brickConf[symbolForAsyncComputedPropsFromHost];\n  if (computedPropsFromHost) {\n    asyncPropertyEntries.push(...computedPropsFromHost);\n  }\n\n  const isScript = brickName === \"script\";\n  if (isScript || brickName === \"link\") {\n    const props = await constructAsyncProperties(asyncPropertyEntries);\n    if (isScript ? props.src : props.rel === \"stylesheet\" && props.href) {\n      const prefix = window.PUBLIC_ROOT ?? \"\";\n      if (isScript) {\n        const { src, ...attrs } = props;\n        await catchLoad(\n          loadScript(src as string, prefix, attrs),\n          \"script\",\n          src as string,\n          \"silent\"\n        );\n      } else {\n        const { href, ...attrs } = props;\n        await catchLoad(\n          loadStyle(href as string, prefix, attrs),\n          \"stylesheet\",\n          href as string,\n          \"silent\"\n        );\n      }\n      return output;\n    }\n  }\n\n  const brick: RenderBrick = {\n    tag: RenderTag.BRICK,\n    type: tplTagName || brickName,\n    return: returnNode,\n    slotId,\n    events: brickConf.events,\n    runtimeContext,\n    portal: brickConf.portal,\n    iid: brickConf.iid,\n    ref: (brickConf as BrickConfInTemplate).ref,\n  };\n\n  output.node = brick;\n\n  // 在最终挂载前，先加载所有可能用到的 processors。\n  const usedProcessors = strictCollectMemberUsage(\n    [brickConf.events, brickConf.lifeCycle],\n    \"PROCESSORS\",\n    2\n  );\n  if (usedProcessors.size > 0) {\n    output.blockingList.push(\n      catchLoad(\n        loadProcessorsImperatively(usedProcessors, getBrickPackages()),\n        \"processors\",\n        [...usedProcessors].join(\", \"),\n        rendererContext.unknownBricks\n      )\n    );\n  }\n\n  // 加载构件属性和加载子构件等任务，可以并行。\n  const blockingList: Promise<unknown>[] = [];\n\n  const loadProperties = async () => {\n    brick.properties = await constructAsyncProperties(asyncPropertyEntries);\n    listenOnTrackingContext(brick, trackingContextList);\n  };\n  blockingList.push(loadProperties());\n\n  rendererContext.registerBrickLifeCycle(brick, brickConf.lifeCycle);\n\n  let expandedBrickConf = brickConf;\n  if (tplTagName) {\n    expandedBrickConf = expandCustomTemplate(\n      tplTagName,\n      brickConf,\n      brick,\n      asyncPropertyEntries,\n      rendererContext\n    );\n  } else if (brickName === FORM_RENDERER) {\n    expandedBrickConf = expandFormRenderer(\n      formData,\n      brickConf,\n      brick,\n      asyncPropertyEntries,\n      rendererContext\n    );\n  }\n\n  if (expandedBrickConf.portal) {\n    // A portal brick has no slotId.\n    brick.slotId = undefined;\n  }\n\n  let childRuntimeContext: RuntimeContext;\n  if (tplTagName) {\n    // There is a boundary for `forEachItem` between template internals and externals.\n    childRuntimeContext = {\n      ...runtimeContext,\n    };\n    delete childRuntimeContext.forEachItem;\n    delete childRuntimeContext.forEachIndex;\n  } else {\n    childRuntimeContext = runtimeContext;\n  }\n\n  const loadChildren = async () => {\n    const slots = childrenToSlots(\n      expandedBrickConf.children,\n      expandedBrickConf.slots\n    );\n    if (!slots) {\n      return;\n    }\n    const routeSlotIndexes = new Set<number>();\n    const rendered = await Promise.all(\n      Object.entries(slots).map(([childSlotId, slotConf], index) => {\n        if (slotConf.type !== \"routes\") {\n          return renderBricks(\n            brick,\n            (slotConf as SlotConfOfBricks).bricks,\n            childRuntimeContext,\n            rendererContext,\n            parentRoutes,\n            childSlotId,\n            tplStack\n          );\n        }\n\n        if (runtimeContext.flags[\"incremental-sub-route-rendering\"]) {\n          routeSlotIndexes.add(index);\n          rendererContext.performIncrementalRender(async (location) => {\n            const { homepage } = childRuntimeContext.app;\n            const { pathname } = location;\n            // Ignore if any one of homepage and parent routes not matched.\n            if (\n              !matchHomepage(homepage, pathname) ||\n              !parentRoutes.every((route) =>\n                matchRoute(route, homepage, pathname)\n              )\n            ) {\n              return false;\n            }\n\n            const [\n              scopedRuntimeContext,\n              tplStateStoreScope,\n              formStateStoreScope,\n            ] = createScopedRuntimeContext({\n              ...childRuntimeContext,\n              location,\n              query: new URLSearchParams(location.search),\n            });\n\n            let failed = false;\n            let incrementalOutput: RenderOutput;\n            let scopedStores: DataStore<\"STATE\" | \"FORM_STATE\">[] = [];\n\n            try {\n              incrementalOutput = await renderRoutes(\n                brick,\n                slotConf.routes,\n                scopedRuntimeContext,\n                rendererContext,\n                parentRoutes,\n                childSlotId,\n                true\n              );\n\n              // If all sub-routes are missed, ignore incremental rendering\n              if (!incrementalOutput.route) {\n                return false;\n              }\n\n              // Bailout if redirect or unauthenticated is set\n              if (rendererContext.reBailout(incrementalOutput)) {\n                return true;\n              }\n\n              scopedStores = [...tplStateStoreScope, ...formStateStoreScope];\n              await postAsyncRender(incrementalOutput, scopedRuntimeContext, [\n                scopedRuntimeContext.ctxStore,\n                ...scopedStores,\n              ]);\n\n              await rendererContext.reMergeMenuRequests(\n                slotConf.routes,\n                incrementalOutput.route,\n                incrementalOutput.menuRequests\n              );\n            } catch (error) {\n              // eslint-disable-next-line no-console\n              console.error(\"Incremental sub-router failed:\", error);\n\n              const result = rendererContext.reCatch(error, brick);\n              if (!result) {\n                return true;\n              }\n              ({ failed, output: incrementalOutput } = result);\n\n              // Assert: no errors will be throw\n              await rendererContext.reMergeMenuRequests(\n                slotConf.routes,\n                incrementalOutput.route,\n                incrementalOutput.menuRequests\n              );\n            }\n\n            rendererContext.reRender(\n              childSlotId,\n              [],\n              incrementalOutput.node,\n              brick\n            );\n\n            if (!failed) {\n              scopedRuntimeContext.ctxStore.mountAsyncData(\n                incrementalOutput.route\n              );\n              for (const store of scopedStores) {\n                store.mountAsyncData();\n              }\n            }\n\n            return true;\n          });\n        }\n\n        return renderRoutes(\n          brick,\n          slotConf.routes,\n          childRuntimeContext,\n          rendererContext,\n          parentRoutes,\n          childSlotId\n        );\n      })\n    );\n\n    const childrenOutput: RenderOutput = {\n      ...output,\n      node: undefined,\n      blockingList: [],\n      menuRequests: [],\n    };\n    rendered.forEach((item, index) => {\n      if (routeSlotIndexes.has(index)) {\n        // Memoize a render node before it's been merged.\n        rendererContext.memoize(slotId, [], item.node, brick);\n      }\n      mergeRenderOutput(childrenOutput, item);\n    });\n    if (childrenOutput.node) {\n      brick.child = childrenOutput.node;\n    }\n    mergeRenderOutput(output, {\n      ...childrenOutput,\n      node: undefined,\n    });\n  };\n  blockingList.push(loadChildren());\n\n  await Promise.all(blockingList);\n\n  return output;\n}\n\nfunction isGeneralizedTrackAll(brickIf: unknown): boolean {\n  return typeof brickIf === \"string\"\n    ? isTrackAll(brickIf)\n    : isPreEvaluated(brickIf) &&\n        // istanbul ignore next: covered by e2e tests\n        isTrackAll(getPreEvaluatedRaw(brickIf));\n}\n\ntype ValidControlBrick = \":forEach\" | \":if\" | \":switch\";\n\nfunction ensureValidControlBrick(\n  brick: string\n): asserts brick is ValidControlBrick {\n  if (brick !== \":forEach\" && brick !== \":if\" && brick !== \":switch\") {\n    throw new Error(`Unknown storyboard control node: \"${brick}\"`);\n  }\n}\n\nasync function renderForEach(\n  returnNode: RenderReturnNode,\n  dataSource: unknown[],\n  bricks: BrickConf[],\n  runtimeContext: RuntimeContext,\n  rendererContext: RendererContext,\n  parentRoutes: RouteConf[],\n  slotId: string | undefined,\n  tplStack: Map<string, number>,\n  keyPath: number[]\n): Promise<RenderOutput> {\n  const output = getEmptyRenderOutput();\n\n  const rows = dataSource.length;\n  const rendered = await Promise.all(\n    dataSource.map((item, i) =>\n      Promise.all(\n        bricks.map((brickConf, j) =>\n          renderBrick(\n            returnNode,\n            brickConf,\n            {\n              ...runtimeContext,\n              forEachItem: item,\n              forEachIndex: i,\n            },\n            rendererContext,\n            parentRoutes,\n            slotId,\n            keyPath.concat(i * rows + j),\n            tplStack && new Map(tplStack)\n          )\n        )\n      )\n    )\n  );\n\n  // 多层构件并行异步转换，但转换的结果按原顺序串行合并。\n  rendered.flat().forEach((item, index) => {\n    if (item.hasTrackingControls) {\n      // Memoize a render node before it's been merged.\n      rendererContext.memoize(\n        slotId,\n        keyPath.concat(index),\n        item.node,\n        returnNode\n      );\n    }\n    mergeRenderOutput(output, item);\n  });\n\n  return output;\n}\n\nexport function getDataStores(runtimeContext: RuntimeContext) {\n  return [\n    runtimeContext.ctxStore,\n    ...runtimeContext.tplStateStoreMap.values(),\n    ...runtimeContext.formStateStoreMap.values(),\n  ];\n}\n\nexport function postAsyncRender(\n  output: RenderOutput,\n  runtimeContext: RuntimeContext,\n  stores: DataStore<DataStoreType>[]\n) {\n  flushStableLoadBricks();\n\n  return Promise.all([\n    ...output.blockingList,\n    ...stores.map((store) => store.waitForAll()),\n    ...runtimeContext.pendingPermissionsPreCheck,\n  ]);\n}\n\nexport function createScopedRuntimeContext(\n  runtimeContext: RuntimeContext\n): [\n  scopedRuntimeContext: RuntimeContext,\n  tplStateStoreScope: DataStore<\"STATE\">[],\n  formStateStoreScope: DataStore<\"FORM_STATE\">[],\n] {\n  const tplStateStoreScope: DataStore<\"STATE\">[] = [];\n  const formStateStoreScope: DataStore<\"FORM_STATE\">[] = [];\n  const scopedRuntimeContext: RuntimeContext = {\n    ...runtimeContext,\n    tplStateStoreScope,\n    formStateStoreScope,\n  };\n  return [scopedRuntimeContext, tplStateStoreScope, formStateStoreScope];\n}\n\nfunction loadMenu(\n  menuConf: MenuConf | undefined,\n  runtimeContext: RuntimeContext\n) {\n  if (!menuConf) {\n    return;\n  }\n\n  // istanbul ignore next\n  if ((menuConf as { type?: \"brick\" }).type === \"brick\") {\n    // eslint-disable-next-line no-console\n    console.error(\"Set menu with brick is dropped in v3:\", menuConf);\n    throw new Error(\"Set menu with brick is dropped in v3\");\n  }\n\n  // istanbul ignore next\n  if (menuConf.type === \"resolve\") {\n    // eslint-disable-next-line no-console\n    console.warn(\"Set menu with resolve is not supported in v3 yet:\", menuConf);\n    return;\n  }\n\n  return asyncComputeRealValue(\n    menuConf,\n    runtimeContext\n  ) as Promise<StaticMenuConf>;\n}\n\nfunction mergeRenderOutput(\n  output: RenderOutput,\n  newOutput: RenderOutput\n): void {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const { blockingList, node, menuRequests, hasTrackingControls, ...rest } =\n    newOutput;\n  output.blockingList.push(...blockingList);\n  output.menuRequests.push(...menuRequests);\n\n  if (node) {\n    if (output.node) {\n      let last = output.node;\n      while (last.sibling) {\n        last = last.sibling;\n      }\n      last.sibling = node;\n    } else {\n      output.node = node;\n    }\n  }\n\n  Object.assign(output, rest);\n}\n\nfunction getEmptyRenderOutput(): RenderOutput {\n  return {\n    blockingList: [],\n    menuRequests: [],\n  };\n}\n\nexport function childrenToSlots(\n  children: BrickConf[] | undefined,\n  originalSlots: SlotsConf | undefined\n) {\n  let newSlots = originalSlots;\n  // istanbul ignore next\n  if (\n    process.env.NODE_ENV === \"development\" &&\n    children &&\n    !Array.isArray(children)\n  ) {\n    // eslint-disable-next-line no-console\n    console.warn(\n      \"Specified brick children but not array:\",\n      `<${typeof children}>`,\n      children\n    );\n  }\n  if (Array.isArray(children) && !newSlots) {\n    newSlots = {};\n    for (const child of children) {\n      const slot = child.slot ?? \"\";\n      if (!hasOwnProperty(newSlots, slot)) {\n        newSlots[slot] = {\n          type: \"bricks\",\n          bricks: [],\n        };\n      }\n      (newSlots[slot] as SlotConfOfBricks).bricks.push(child);\n    }\n  }\n  return newSlots;\n}\n\nfunction catchLoad(\n  promise: Promise<unknown>,\n  type: \"brick\" | \"processors\" | \"script\" | \"stylesheet\",\n  name: string,\n  unknownPolicy: RendererContext[\"unknownBricks\"]\n) {\n  return unknownPolicy === \"silent\"\n    ? promise.catch((e) => {\n        // eslint-disable-next-line no-console\n        console.error(`Load ${type} \"${name}\" failed:`, e);\n      })\n    : promise;\n}\n","import { setProperties } from \"./setProperties.js\";\nimport type { RuntimeBrick } from \"../interfaces.js\";\nimport { getTplStateStore } from \"../CustomTemplates/utils.js\";\nimport { getFormStateStore } from \"../FormRenderer/utils.js\";\n\nexport interface TrackingContextItem {\n  contextNames: string[] | Set<string> | false;\n  stateNames: string[] | Set<string> | false;\n  formStateNames: string[] | Set<string> | false;\n  propName: string;\n  propValue: unknown;\n}\n\nexport function listenOnTrackingContext(\n  brick: RuntimeBrick,\n  trackingContextList: TrackingContextItem[]\n): void {\n  for (const track of trackingContextList) {\n    const listener = (): void => {\n      if (brick.element) {\n        setProperties(\n          brick.element,\n          { [track.propName]: track.propValue },\n          brick.runtimeContext\n        );\n      }\n    };\n    if (track.contextNames) {\n      for (const contextName of track.contextNames) {\n        brick.runtimeContext.ctxStore.onChange(contextName, listener);\n      }\n    }\n    if (track.stateNames) {\n      const tplStateStore = getTplStateStore(\n        brick.runtimeContext,\n        \"STATE\",\n        `: \"${track.propValue}\"`\n      );\n      for (const stateName of track.stateNames) {\n        tplStateStore.onChange(stateName, listener);\n      }\n    }\n    if (track.formStateNames) {\n      const formStateStore = getFormStateStore(\n        brick.runtimeContext,\n        \"FORM_STATE\",\n        `: \"${track.propValue}\"`\n      );\n      for (const stateName of track.formStateNames) {\n        formStateStore.onChange(stateName, listener);\n      }\n    }\n  }\n}\n","import type { RuntimeBrick } from \"../interfaces.js\";\nimport { getTplStateStore } from \"./utils.js\";\n\nexport function bindTemplateProxy(brick: RuntimeBrick) {\n  const { ref, runtimeContext, element } = brick;\n\n  // Error recovering brick may have no runtimeContext.\n  if (!ref || !runtimeContext.tplStateStoreId) {\n    return;\n  }\n\n  const { hostBrick } = getTplStateStore(runtimeContext, \"bindTemplateProxy\");\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  const tplHostMetadata = hostBrick!.tplHostMetadata!;\n\n  tplHostMetadata.internalBricksByRef.set(ref, brick);\n\n  const events = tplHostMetadata.proxy?.events;\n  if (events) {\n    for (const [from, to] of Object.entries(events)) {\n      if (to.ref === ref) {\n        const listener = (e: Event) => {\n          if (e.bubbles) {\n            e.stopPropagation();\n          }\n          hostBrick!.element!.dispatchEvent(\n            new CustomEvent(from, {\n              detail: (e as CustomEvent).detail,\n              bubbles: e.bubbles,\n              cancelable: e.cancelable,\n              composed: e.composed,\n            })\n          );\n        };\n        const eventType = to.refEvent ?? from;\n        element!.addEventListener(eventType, listener);\n        element!.$$proxyListeners ??= [];\n        element!.$$proxyListeners.push([eventType, listener]);\n      }\n    }\n  }\n}\n\nexport function unbindTemplateProxy(brick: RuntimeBrick) {\n  const { ref, runtimeContext, element } = brick;\n\n  if (!runtimeContext?.tplStateStoreId || !ref) {\n    return;\n  }\n\n  const { hostBrick } = getTplStateStore(runtimeContext, \"unbindTemplateProxy\");\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  const tplHostMetadata = hostBrick!.tplHostMetadata!;\n\n  tplHostMetadata.internalBricksByRef.delete(ref);\n\n  for (const [type, fn] of element!.$$proxyListeners ?? []) {\n    element!.removeEventListener(type, fn);\n  }\n  delete element!.$$proxyListeners;\n}\n","import { bindTemplateProxy } from \"./CustomTemplates/bindTemplateProxy.js\";\nimport { getTplStateStore } from \"./CustomTemplates/utils.js\";\nimport { bindListeners } from \"./bindListeners.js\";\nimport { setRealProperties } from \"./compute/setRealProperties.js\";\nimport { RenderTag } from \"./enums.js\";\nimport type {\n  RenderReturnNode,\n  RenderRoot,\n  RuntimeBrickElement,\n} from \"./interfaces.js\";\n\nexport function unmountTree(mountPoint: HTMLElement | DocumentFragment) {\n  mountPoint.replaceChildren();\n}\n\nexport function mountTree(\n  root: RenderRoot,\n  initializedElement?: RuntimeBrickElement\n): void {\n  let current = root.child;\n  const portalElements: RuntimeBrickElement[] = [];\n  while (current) {\n    if (current.tag === RenderTag.BRICK) {\n      const tagName = current.type;\n\n      if (tagName.includes(\"-\") && !customElements.get(tagName)) {\n        // eslint-disable-next-line no-console\n        console.error(`Undefined custom element: ${tagName}`);\n      }\n\n      // istanbul ignore if\n      if (tagName === \"basic-bricks.script-brick\") {\n        // eslint-disable-next-line no-console\n        console.warn(\n          \"`basic-bricks.script-brick` is deprecated, please take caution when using it\"\n        );\n      }\n\n      const element: RuntimeBrickElement =\n        initializedElement && current === root.child\n          ? initializedElement\n          : document.createElement(tagName);\n      current.element = element;\n\n      if (current.slotId) {\n        element.setAttribute(\"slot\", current.slotId);\n      }\n      if (current.iid) {\n        element.dataset.iid = current.iid;\n      }\n      if (current.tplHostMetadata?.tplStateStoreId) {\n        element.dataset.tplStateStoreId =\n          current.tplHostMetadata.tplStateStoreId;\n      }\n      setRealProperties(element, current.properties);\n      bindListeners(element, current.events, current.runtimeContext);\n      if (current.tplHostMetadata) {\n        // 先设置属性，再设置 `$$tplStateStore`，这样，当触发属性设置时，\n        // 避免初始化的一次 state update 操作及其 onChange 事件。\n        element.$$tplStateStore = getTplStateStore(\n          {\n            tplStateStoreId: current.tplHostMetadata.tplStateStoreId,\n            tplStateStoreMap: current.runtimeContext.tplStateStoreMap,\n          },\n          \"mount\"\n        );\n      }\n      bindTemplateProxy(current);\n\n      if (current.portal) {\n        portalElements.push(element);\n      } else if (current.return) {\n        if (!current.return.childElements) {\n          current.return.childElements = [];\n        }\n        current.return.childElements.push(element);\n      }\n    }\n\n    if (current.child) {\n      current = current.child;\n    } else if (current.sibling) {\n      current = current.sibling;\n    } else {\n      let currentReturn: RenderReturnNode | null | undefined = current.return;\n      while (currentReturn) {\n        // Append elements inside out\n        if (currentReturn.childElements) {\n          if (currentReturn.tag === RenderTag.ROOT) {\n            currentReturn.container?.append(...currentReturn.childElements);\n          } else {\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            currentReturn.element!.append(...currentReturn.childElements);\n          }\n          currentReturn.childElements = undefined;\n        }\n\n        if (currentReturn.tag === RenderTag.ROOT && portalElements.length > 0) {\n          const portal =\n            typeof currentReturn.createPortal === \"function\"\n              ? currentReturn.createPortal()\n              : currentReturn.createPortal;\n          portal.append(...portalElements);\n        }\n\n        if (currentReturn.sibling) {\n          break;\n        }\n        currentReturn = currentReturn.return;\n      }\n      current = currentReturn?.sibling;\n    }\n  }\n}\n","import type {\n  BrickEventHandler,\n  BrickLifeCycle,\n  MessageConf,\n  RouteConf,\n  ScrollIntoViewConf,\n  StaticMenuConf,\n} from \"@next-core/types\";\nimport type { Action, Location } from \"history\";\nimport { isEmpty, remove } from \"lodash\";\nimport { listenerFactory } from \"./bindListeners.js\";\nimport { NextHistoryState, NextLocation, getHistory } from \"../history.js\";\nimport { getReadOnlyProxy } from \"./proxyFactories.js\";\nimport { Media, mediaEventTarget } from \"./mediaQuery.js\";\nimport type {\n  RenderBrick,\n  RenderChildNode,\n  RenderNode,\n  RenderReturnNode,\n  RenderRoot,\n} from \"./interfaces.js\";\nimport { mountTree } from \"./mount.js\";\nimport { RenderTag } from \"./enums.js\";\nimport { unbindTemplateProxy } from \"./CustomTemplates/bindTemplateProxy.js\";\nimport { hooks } from \"./Runtime.js\";\nimport type { RenderOutput } from \"./Renderer.js\";\n\ntype MemoizedLifeCycle<T> = {\n  [Key in keyof T]: {\n    brick: RenderBrick;\n    handlers: T[Key];\n  }[];\n};\n\ntype LocationChangeCallback = (\n  location: Location<NextHistoryState>\n) => Promise<boolean>;\n\nconst commonLifeCycles = [\n  \"onMount\",\n  \"onUnmount\",\n  \"onMediaChange\",\n  \"onScrollIntoView\",\n  \"onMessage\",\n  \"onMessageClose\",\n] as const;\n\nconst pageOnlyLifeCycles = [\n  \"onBeforePageLoad\",\n  \"onPageLoad\",\n  \"onPageLeave\",\n  \"onBeforePageLeave\",\n  \"onAnchorLoad\",\n  \"onAnchorUnload\",\n] as const;\n\nexport interface RendererContextOptions {\n  unknownBricks?: \"silent\" | \"throw\";\n  routeHelper?: RouteHelper;\n  renderId?: string;\n}\n\nexport interface RouteHelper {\n  bailout: (output: RenderOutput) => true | undefined;\n  mergeMenus: (menuRequests: Promise<StaticMenuConf>[]) => Promise<void>;\n  catch: (\n    error: unknown,\n    returnNode: RenderReturnNode\n  ) =>\n    | undefined\n    | {\n        failed: true;\n        output: RenderOutput;\n      };\n}\n\nexport class RendererContext {\n  /**\n   * - page: render as whole page, triggering page life cycles.\n   * - fragment: render as fragment, not triggering page life cycles.\n   */\n  public readonly scope: \"page\" | \"fragment\";\n\n  public readonly unknownBricks: \"silent\" | \"throw\";\n\n  public readonly renderId: string | undefined;\n\n  #routeHelper: RouteHelper | undefined;\n\n  constructor(scope: \"page\" | \"fragment\", options?: RendererContextOptions) {\n    this.scope = scope;\n    this.unknownBricks = options?.unknownBricks ?? \"throw\";\n    this.#routeHelper = options?.routeHelper;\n    this.renderId = options?.renderId;\n  }\n\n  #memoizedLifeCycle: MemoizedLifeCycle<\n    Required<\n      Pick<\n        BrickLifeCycle,\n        | \"onBeforePageLoad\"\n        | \"onPageLoad\"\n        | \"onPageLeave\"\n        | \"onBeforePageLeave\"\n        | \"onAnchorLoad\"\n        | \"onAnchorUnload\"\n        | \"onMediaChange\"\n        | \"onScrollIntoView\"\n        | \"onMount\"\n        | \"onUnmount\"\n        | \"onMessage\"\n        | \"onMessageClose\"\n      >\n    >\n  > = {\n    onBeforePageLoad: [],\n    onPageLoad: [],\n    onPageLeave: [],\n    onBeforePageLeave: [],\n    onAnchorLoad: [],\n    onAnchorUnload: [],\n    onMediaChange: [],\n    onScrollIntoView: [],\n    onMount: [],\n    onUnmount: [],\n    onMessage: [],\n    onMessageClose: [],\n  };\n  #observers = new Map<RenderBrick, IntersectionObserver[]>();\n  #mediaListener: EventListener | undefined;\n\n  #arbitraryLifeCycle = new Map<string, Set<() => void>>();\n\n  #memoized?: WeakMap<\n    RenderNode,\n    Map<\n      string,\n      {\n        node?: RenderChildNode;\n        last?: RenderChildNode;\n        lastNormal?: RenderBrick | undefined;\n        lastPortal?: RenderBrick | undefined;\n      }\n    >\n  >;\n  #allMenuRequests?: Promise<StaticMenuConf>[];\n  #memoizedMenuRequestMap?: WeakMap<RouteConf, Promise<StaticMenuConf>>;\n\n  setInitialMenuRequests(menuRequests: Promise<StaticMenuConf>[]) {\n    this.#allMenuRequests = menuRequests;\n  }\n\n  memoizeMenuRequests(\n    route: RouteConf,\n    menuRequests: Promise<StaticMenuConf>[]\n  ) {\n    if (!this.#memoizedMenuRequestMap) {\n      this.#memoizedMenuRequestMap = new WeakMap();\n    }\n    this.#memoizedMenuRequestMap.set(route, menuRequests[0]);\n  }\n\n  async reMergeMenuRequests(\n    routes: RouteConf[],\n    currentRoute: RouteConf | undefined,\n    menuRequests: Promise<StaticMenuConf>[]\n  ) {\n    let previousMenuRequest: Promise<StaticMenuConf> | undefined;\n    let previousRoute: RouteConf | undefined;\n    for (const route of routes) {\n      previousMenuRequest = this.#memoizedMenuRequestMap!.get(route);\n      if (previousMenuRequest) {\n        previousRoute = route;\n        break;\n      }\n    }\n    const mergedMenuRequests = this.#allMenuRequests!;\n    const previousIndex = previousMenuRequest\n      ? mergedMenuRequests.indexOf(previousMenuRequest)\n      : -1;\n    if (previousIndex === -1) {\n      if (!menuRequests.length) {\n        return;\n      }\n      mergedMenuRequests.push(...menuRequests);\n    } else {\n      mergedMenuRequests.splice(\n        previousIndex,\n        mergedMenuRequests.length - previousIndex,\n        ...menuRequests\n      );\n    }\n    if (previousRoute && previousRoute !== currentRoute) {\n      this.#memoizedMenuRequestMap!.delete(previousRoute);\n    }\n    await this.#routeHelper!.mergeMenus(mergedMenuRequests);\n  }\n\n  reBailout(output: RenderOutput) {\n    return this.#routeHelper!.bailout(output);\n  }\n\n  reCatch(error: unknown, returnNode: RenderReturnNode) {\n    return this.#routeHelper!.catch(error, returnNode);\n  }\n\n  #locationChangeCallbacks: LocationChangeCallback[] = [];\n\n  async didPerformIncrementalRender(location: Location<NextHistoryState>) {\n    const results = await Promise.all(\n      this.#locationChangeCallbacks.map((callback) => callback(location))\n    );\n    return results.some((result) => result);\n  }\n\n  /**\n   * When `callback` resolved to `true` which means incremental rendering is performed,\n   * ignore normal rendering.\n   */\n  performIncrementalRender(callback: LocationChangeCallback) {\n    this.#locationChangeCallbacks.push(callback);\n  }\n\n  registerBrickLifeCycle(\n    brick: RenderBrick,\n    lifeCycle: BrickLifeCycle | undefined\n  ): void {\n    if (!lifeCycle) {\n      return;\n    }\n    const lifeCycleTypes = [\n      ...commonLifeCycles,\n      ...(this.scope === \"page\" ? pageOnlyLifeCycles : []),\n    ];\n    for (const key of lifeCycleTypes) {\n      const handlers = (lifeCycle as BrickLifeCycle)[key as \"onPageLoad\"];\n      if (handlers) {\n        this.#memoizedLifeCycle[key as \"onPageLoad\"].push({\n          brick,\n          handlers: handlers as BrickEventHandler | BrickEventHandler[],\n        });\n      }\n    }\n    // istanbul ignore next\n    if (!isEmpty((lifeCycle as { useResolves?: unknown }).useResolves)) {\n      // eslint-disable-next-line no-console\n      console.error(\"`lifeCycle.useResolves` is dropped in v3:\", lifeCycle);\n    }\n  }\n\n  registerArbitraryLifeCycle(lifeCycle: string, fn: () => void): void {\n    const arbitraryCallbacks = this.#arbitraryLifeCycle.get(lifeCycle);\n    if (arbitraryCallbacks) {\n      arbitraryCallbacks.add(fn);\n    } else {\n      this.#arbitraryLifeCycle.set(lifeCycle, new Set([fn]));\n    }\n  }\n\n  #unmountBricks(bricks: Set<RenderBrick>): void {\n    const lifeCycleTypes = [\n      ...commonLifeCycles,\n      ...(this.scope === \"page\" ? pageOnlyLifeCycles : []),\n    ];\n    const unmountList: {\n      brick: RenderBrick;\n      handlers: BrickEventHandler | BrickEventHandler[];\n    }[] = [];\n\n    // Clear life cycle handlers, record `onUnmount` at the same time\n    for (const key of lifeCycleTypes) {\n      const removed = remove(\n        this.#memoizedLifeCycle[key as \"onPageLoad\"],\n        (item) => bricks.has(item.brick)\n      );\n      if (key === \"onUnmount\") {\n        unmountList.push(...removed);\n      }\n    }\n\n    // Clear intersection observers\n    for (const brick of bricks) {\n      const observers = this.#observers.get(brick);\n      if (observers?.length) {\n        for (const observer of observers) {\n          observer.disconnect();\n        }\n        observers.length = 0;\n        this.#observers.delete(brick);\n      }\n\n      unbindTemplateProxy(brick);\n      delete brick.element?.$$tplStateStore;\n\n      // Also remove the element\n      brick.element?.remove();\n    }\n\n    // Dispatch unmount events\n    const unmountEvent = new CustomEvent(\"unmount\");\n    for (const { brick, handlers } of unmountList) {\n      listenerFactory(handlers, brick.runtimeContext, brick)(unmountEvent);\n    }\n  }\n\n  #initializeRerenderBricks(bricks: Set<RenderBrick>): void {\n    const mountEvent = new CustomEvent(\"mount\");\n    for (const { brick, handlers } of this.#memoizedLifeCycle.onMount) {\n      if (bricks.has(brick)) {\n        listenerFactory(handlers, brick.runtimeContext, brick)(mountEvent);\n      }\n    }\n\n    for (const { brick, handlers: conf } of this.#memoizedLifeCycle\n      .onScrollIntoView) {\n      if (bricks.has(brick)) {\n        this.#addObserver(brick, conf);\n      }\n    }\n  }\n\n  memoize(\n    slotId: string | undefined,\n    keyPath: number[],\n    node: RenderChildNode | undefined,\n    returnNode: RenderReturnNode\n  ) {\n    if (!this.#memoized) {\n      this.#memoized = new WeakMap();\n    }\n    const memKey = [slotId ?? \"\", ...keyPath].join(\".\");\n    let mem = this.#memoized.get(returnNode);\n    if (!mem) {\n      mem = new Map();\n      this.#memoized.set(returnNode, mem);\n    }\n\n    mem.set(memKey, {\n      node,\n      last: getLastNode(node),\n      lastNormal: getLastNormalNode(node),\n      lastPortal: getLastPortalNode(node),\n    });\n  }\n\n  reRender(\n    slotId: string | undefined,\n    keyPath: number[],\n    node: RenderChildNode | undefined,\n    returnNode: RenderReturnNode\n  ) {\n    const memKey = [slotId ?? \"\", ...keyPath].join(\".\");\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    const memoized = this.#memoized!.get(returnNode)!.get(memKey)!;\n    const {\n      node: prevNode,\n      last: prevLast,\n      lastNormal: prevLastNormal,\n      lastPortal: prevLastPortal,\n    } = memoized;\n\n    let insertBeforeChild: ChildNode | null;\n    let insertPortalBeforeChild: ChildNode | null;\n    if (prevNode?.tag === RenderTag.PLACEHOLDER) {\n      insertBeforeChild = getNextNormalNode(prevNode)?.element ?? null;\n      insertPortalBeforeChild = getNextPortalNode(prevNode)?.element ?? null;\n    } else {\n      insertBeforeChild = prevLastNormal?.element?.nextSibling ?? null;\n      insertPortalBeforeChild = prevLastPortal?.element?.nextSibling ?? null;\n    }\n\n    const last = getLastNode(node);\n    memoized.node = node;\n    memoized.last = last;\n    memoized.lastNormal = getLastNormalNode(node);\n    memoized.lastPortal = getLastPortalNode(node);\n\n    // Figure out the unchanged prev sibling and next sibling\n    let prevSibling: RenderChildNode | undefined;\n    let current = returnNode.child;\n    while (current && current !== prevLast) {\n      if (current.sibling === prevNode) {\n        prevSibling = current;\n        break;\n      }\n      current = current.sibling;\n    }\n\n    const fragment = document.createDocumentFragment();\n    const portalFragment = document.createDocumentFragment();\n    const renderRoot: RenderRoot = {\n      tag: RenderTag.ROOT,\n      container: fragment,\n      createPortal: portalFragment,\n      child: node,\n    };\n\n    // Override `return`\n    current = node;\n    while (current) {\n      current.return = renderRoot;\n      current = current.sibling;\n    }\n\n    // Unmount previous bricks, including their descendants\n    const removeBricks = getBrickRange(prevNode, prevLast);\n    this.#unmountBricks(removeBricks);\n\n    mountTree(renderRoot);\n\n    // Connect back\n    if (prevSibling) {\n      prevSibling.sibling = node;\n    } else {\n      returnNode.child = node;\n    }\n    if (last) {\n      last.sibling = prevLast?.sibling;\n    }\n\n    // Resume `return`\n    current = node;\n    while (current) {\n      current.return = returnNode;\n      current = current.sibling;\n    }\n\n    if (returnNode.tag === RenderTag.ROOT) {\n      returnNode.container?.insertBefore(fragment, insertBeforeChild);\n    } else {\n      returnNode.element?.insertBefore(fragment, insertBeforeChild);\n    }\n\n    if (portalFragment.childNodes.length > 0) {\n      let root: RenderNode | undefined = node;\n      while (root && root.return) {\n        root = root.return;\n      }\n      // istanbul ignore next\n      if (root?.tag !== RenderTag.ROOT) {\n        throw new Error(\n          \"Cannot find render root node. This is a bug of Brick Next, please report it.\"\n        );\n      }\n      const portal =\n        typeof root.createPortal === \"function\"\n          ? root.createPortal()\n          : root.createPortal;\n      portal.insertBefore(portalFragment, insertPortalBeforeChild);\n    }\n\n    const newBricks = getBrickRange(node, last);\n    this.#initializeRerenderBricks(newBricks);\n  }\n\n  dispose(): void {\n    for (const list of Object.values(this.#memoizedLifeCycle)) {\n      list.length = 0;\n    }\n    for (const list of this.#observers.values()) {\n      for (const observer of list) {\n        observer.disconnect();\n      }\n      list.length = 0;\n    }\n    this.#observers.clear();\n    if (this.#mediaListener) {\n      mediaEventTarget.removeEventListener(\"change\", this.#mediaListener);\n      this.#mediaListener = undefined;\n    }\n    this.#memoized = undefined;\n    this.#allMenuRequests = undefined;\n    this.#memoizedMenuRequestMap = undefined;\n    this.#arbitraryLifeCycle.clear();\n    this.#locationChangeCallbacks.length = 0;\n  }\n\n  // Note: no `onScrollIntoView` and `onMessage`\n  #dispatchGeneralLifeCycle(\n    type:\n      | \"onBeforePageLoad\"\n      | \"onPageLoad\"\n      | \"onPageLeave\"\n      | \"onBeforePageLeave\"\n      | \"onAnchorLoad\"\n      | \"onAnchorUnload\"\n      | \"onMediaChange\"\n      | \"onMessageClose\"\n      | \"onMount\"\n      | \"onUnmount\",\n    event: Event\n  ): void {\n    // istanbul ignore next\n    if (\n      process.env.NODE_ENV === \"development\" &&\n      this.scope === \"fragment\" &&\n      pageOnlyLifeCycles.includes(type as \"onPageLoad\")\n    ) {\n      throw new Error(\n        `\\`lifeCycle.${type}\\` cannot be used in ${this.scope}.\\nThis is a bug of Brick Next, please report it.`\n      );\n    }\n    for (const { brick, handlers } of this.#memoizedLifeCycle[type]) {\n      listenerFactory(handlers, brick.runtimeContext, brick)(event);\n    }\n    const arbitraryCallbacks = this.#arbitraryLifeCycle.get(type);\n    if (arbitraryCallbacks) {\n      for (const fn of arbitraryCallbacks) {\n        fn();\n      }\n    }\n  }\n\n  dispatchBeforePageLoad(): void {\n    this.#dispatchGeneralLifeCycle(\n      \"onBeforePageLoad\",\n      new CustomEvent(\"page.beforeLoad\")\n    );\n  }\n\n  dispatchPageLoad(): void {\n    const event = new CustomEvent(\"page.load\");\n    this.#dispatchGeneralLifeCycle(\"onPageLoad\", event);\n    // Currently only for e2e testing\n    window.dispatchEvent(event);\n  }\n\n  dispatchBeforePageLeave(detail: {\n    location?: NextLocation;\n    action?: Action;\n  }): void {\n    this.#dispatchGeneralLifeCycle(\n      \"onBeforePageLeave\",\n      new CustomEvent(\"page.beforeLeave\", { detail })\n    );\n  }\n\n  dispatchPageLeave(): void {\n    this.#dispatchGeneralLifeCycle(\n      \"onPageLeave\",\n      new CustomEvent(\"page.leave\")\n    );\n  }\n\n  dispatchAnchorLoad(): void {\n    const { hash } = getHistory().location;\n    if (hash && hash !== \"#\") {\n      this.#dispatchGeneralLifeCycle(\n        \"onAnchorLoad\",\n        new CustomEvent(\"anchor.load\", {\n          detail: {\n            hash,\n            anchor: hash.substring(1),\n          },\n        })\n      );\n    } else {\n      this.#dispatchGeneralLifeCycle(\n        \"onAnchorUnload\",\n        new CustomEvent(\"anchor.unload\")\n      );\n    }\n  }\n\n  initializeScrollIntoView(): void {\n    for (const { brick, handlers: conf } of this.#memoizedLifeCycle\n      .onScrollIntoView) {\n      this.#addObserver(brick, conf);\n    }\n  }\n\n  #addObserver(brick: RenderBrick, conf: ScrollIntoViewConf) {\n    const threshold = conf.threshold ?? 0.1;\n    const observer = new IntersectionObserver(\n      (entries, observer) => {\n        entries.forEach((entry) => {\n          if (entry.isIntersecting) {\n            if (entry.intersectionRatio >= threshold) {\n              listenerFactory(\n                conf.handlers,\n                brick.runtimeContext,\n                brick\n              )(new CustomEvent(\"scroll.into.view\"));\n              observer.disconnect();\n            }\n          }\n        });\n      },\n      {\n        threshold,\n      }\n    );\n    observer.observe(brick.element!);\n    let list = this.#observers.get(brick);\n    if (!list) {\n      list = [];\n      this.#observers.set(brick, list);\n    }\n    list.push(observer);\n  }\n\n  initializeMediaChange(): void {\n    this.#mediaListener = (event) => {\n      this.#dispatchGeneralLifeCycle(\n        \"onMediaChange\",\n        new CustomEvent(\"media.change\", {\n          detail: getReadOnlyProxy((event as CustomEvent<Media>).detail),\n        })\n      );\n    };\n    mediaEventTarget.addEventListener(\"change\", this.#mediaListener);\n  }\n\n  initializeMessageDispatcher(): void {\n    for (const { brick, handlers: confList } of this.#memoizedLifeCycle\n      .onMessage) {\n      for (const conf of ([] as MessageConf[]).concat(confList)) {\n        hooks?.messageDispatcher?.onMessage(conf.channel, (detail) => {\n          listenerFactory(\n            conf.handlers,\n            brick.runtimeContext,\n            brick\n          )(new CustomEvent(\"message.push\", { detail }));\n        });\n      }\n    }\n\n    hooks?.messageDispatcher?.onClose(() => {\n      this.#dispatchGeneralLifeCycle(\n        \"onMessageClose\",\n        new CustomEvent(\"message.close\")\n      );\n    });\n  }\n\n  dispatchOnMount(): void {\n    this.#dispatchGeneralLifeCycle(\"onMount\", new CustomEvent(\"mount\"));\n  }\n\n  dispatchOnUnmount(): void {\n    this.#dispatchGeneralLifeCycle(\"onUnmount\", new CustomEvent(\"unmount\"));\n  }\n}\n\nfunction getLastNode(\n  node: RenderChildNode | undefined\n): RenderChildNode | undefined {\n  let last = node;\n  while (last?.sibling) {\n    last = last.sibling;\n  }\n  return last;\n}\n\nfunction getLastNormalNode(\n  node: RenderChildNode | undefined\n): RenderBrick | undefined {\n  return getSpecifiedNormalNode(node, false);\n}\n\nfunction getNextNormalNode(\n  node: RenderChildNode | undefined\n): RenderBrick | undefined {\n  return getSpecifiedNormalNode(node, true);\n}\n\nfunction getSpecifiedNormalNode(\n  node: RenderChildNode | undefined,\n  next: boolean\n): RenderBrick | undefined {\n  let last: RenderBrick | undefined;\n  let current = node;\n  while (current) {\n    if (current.tag === RenderTag.BRICK && !current.portal) {\n      if (next) {\n        return current;\n      }\n      last = current;\n    }\n    current = current.sibling;\n  }\n  return last;\n}\n\nfunction getLastPortalNode(\n  node: RenderChildNode | undefined\n): RenderBrick | undefined {\n  return getSpecifiedPortalNode(node, false);\n}\n\nfunction getNextPortalNode(\n  node: RenderChildNode | undefined\n): RenderBrick | undefined {\n  return getSpecifiedPortalNode(node, true);\n}\n\nfunction getSpecifiedPortalNode(\n  node: RenderChildNode | undefined,\n  next: boolean\n): RenderBrick | undefined {\n  let last: RenderBrick | undefined;\n  let current = node;\n  while (current) {\n    if (current.tag === RenderTag.BRICK && current.portal) {\n      if (next) {\n        return current;\n      }\n      last = current;\n    }\n    if (current.child) {\n      current = current.child;\n    } else if (current.sibling) {\n      current = current.sibling;\n    } else {\n      let currentReturn: RenderReturnNode | null | undefined = current.return;\n      while (currentReturn) {\n        if (currentReturn.sibling) {\n          break;\n        }\n        currentReturn = currentReturn.return;\n      }\n      current = currentReturn?.sibling;\n    }\n  }\n  return last;\n}\n\nfunction getBrickRange(\n  from: RenderChildNode | undefined,\n  to: RenderChildNode | undefined\n): Set<RenderBrick> {\n  const range = new Set<RenderBrick>();\n  let current = from;\n  while (current) {\n    if (current.tag === RenderTag.BRICK) {\n      range.add(current);\n    }\n    if (current.child) {\n      current = current.child;\n    } else if (current === to) {\n      break;\n    } else if (current.sibling) {\n      current = current.sibling;\n    } else {\n      let currentReturn: RenderReturnNode | null | undefined = current.return;\n      while (currentReturn && currentReturn !== to) {\n        if (currentReturn.sibling) {\n          break;\n        }\n        currentReturn = currentReturn.return;\n      }\n      if (currentReturn === to) {\n        break;\n      }\n      current = currentReturn?.sibling;\n    }\n  }\n  return range;\n}\n","import { getBasePath } from \"./getBasePath.js\";\n\nlet misc: PageInfo;\n\n/** 运行时页面信息。*/\nexport interface PageInfo {\n  /** 当前是否处于 iframe 模式。 */\n  isInIframe: boolean;\n\n  /** 当前是否处于同域的 iframe 模式。 */\n  isInIframeOfSameSite: boolean;\n\n  /** 当前是否处于新框架下的 iframe 模式。 */\n  isInIframeOfNext: boolean;\n\n  /** 当前是否处于 Visual Builder 预览的 iframe 模式。 */\n  isInIframeOfVisualBuilder: boolean;\n\n  /** 当前是否处于老 console 下的 iframe 模式。 */\n  isInIframeOfLegacyConsole: boolean;\n}\n\nexport function getPageInfo(): PageInfo {\n  if (!misc) {\n    misc = {\n      isInIframe: false,\n      isInIframeOfSameSite: false,\n      isInIframeOfNext: false,\n      isInIframeOfVisualBuilder: false,\n      isInIframeOfLegacyConsole: false,\n    };\n\n    if (window !== window.parent) {\n      misc.isInIframe = true;\n      try {\n        // Handle:\n        // - Previewing in visual builder by iframe.\n        // - Nesting next in next.\n        // - Nesting console in next.\n        if (window.origin === window.parent.origin) {\n          misc.isInIframeOfSameSite = true;\n          const selfIsNext = getBasePath() === \"/next/\";\n          const parentPathname = window.parent.location.pathname;\n          const parentIsNext = parentPathname.startsWith(\"/next/\");\n          misc.isInIframeOfNext =\n            (Number(selfIsNext) ^ Number(parentIsNext)) === 0;\n          misc.isInIframeOfVisualBuilder = parentPathname.startsWith(\n            `${parentIsNext ? \"/next\" : \"\"}/visual-builder/`\n          );\n          misc.isInIframeOfLegacyConsole = selfIsNext && !parentIsNext;\n        }\n      } catch (e) {\n        // do nothing\n      }\n    }\n\n    Object.freeze(misc);\n  }\n\n  return misc;\n}\n","import { http } from \"@next-core/http\";\n\nlet nativeController: AbortController;\n\nexport function initAbortController() {\n  if (!window.AbortController) {\n    return;\n  }\n\n  nativeController = new AbortController();\n\n  http.interceptors.request.use((config) => {\n    return {\n      ...config,\n      options: {\n        ...config.options,\n        signal: config.options?.noAbortOnRouteChange\n          ? null\n          : nativeController.signal,\n      },\n    };\n  });\n}\n\nexport function abortPendingRequest() {\n  if (nativeController) {\n    nativeController.abort();\n    nativeController = new AbortController();\n  }\n}\n","import { RuntimeStoryboard } from \"@next-core/types\";\nimport { customTemplates } from \"../CustomTemplates.js\";\n\nexport function registerCustomTemplates(storyboard: RuntimeStoryboard) {\n  if (storyboard.$$registerCustomTemplateProcessed) {\n    return;\n  }\n  storyboard.$$registerCustomTemplateProcessed = true;\n  const templates = storyboard.meta?.customTemplates;\n  if (Array.isArray(templates)) {\n    for (const tpl of templates) {\n      const tagName = tpl.name.includes(\".\")\n        ? tpl.name\n        : `${storyboard.app.id}.${tpl.name}`;\n      customTemplates.define(tagName, tpl);\n    }\n  }\n}\n","import type { RuntimeStoryboard } from \"@next-core/types\";\nimport { hooks } from \"./Runtime.js\";\nimport { registerAppI18n } from \"./registerAppI18n.js\";\n\nexport async function fulfilStoryboard(storyboard: RuntimeStoryboard) {\n  if (storyboard.$$fulfilled) {\n    return;\n  }\n  if (!storyboard.$$fulfilling) {\n    storyboard.$$fulfilling = doFulfilStoryboard(storyboard);\n  }\n  return storyboard.$$fulfilling;\n}\n\nasync function doFulfilStoryboard(storyboard: RuntimeStoryboard) {\n  await hooks?.fulfilStoryboard?.(storyboard);\n  registerAppI18n(storyboard);\n  Object.assign(storyboard, {\n    $$fulfilled: true,\n    $$fulfilling: null,\n  });\n}\n","export function setUIVersion(version: string | undefined | null) {\n  // 仅允许特定的 UI 版本\n  let ui: string;\n  switch (version) {\n    case \"8.2\":\n      ui = \"v8-2\";\n      break;\n    default:\n      ui = \"v8\";\n  }\n  document.documentElement.dataset.ui = ui;\n}\n","import { Action, locationsAreEqual } from \"history\";\nimport type {\n  BreadcrumbItemConf,\n  MicroApp,\n  StaticMenuConf,\n  Storyboard,\n} from \"@next-core/types\";\nimport { HttpAbortError } from \"@next-core/http\";\nimport { uniqueId } from \"lodash\";\nimport { NextHistoryState, NextLocation, getHistory } from \"../history.js\";\nimport {\n  RenderOutput,\n  getDataStores,\n  postAsyncRender,\n  renderRoutes,\n} from \"./Renderer.js\";\nimport { DataStore } from \"./data/DataStore.js\";\nimport { clearResolveCache } from \"./data/resolveData.js\";\nimport { mountTree, unmountTree } from \"./mount.js\";\nimport { isOutsideApp, matchStoryboard } from \"./matchStoryboard.js\";\nimport { registerStoryboardFunctions } from \"./compute/StoryboardFunctions.js\";\nimport { RendererContext, RouteHelper } from \"./RendererContext.js\";\nimport {\n  applyMode,\n  applyTheme,\n  getLocalAppsTheme,\n  setMode,\n  setTheme,\n} from \"../themeAndMode.js\";\nimport {\n  _internalApiGetAppInBootstrapData,\n  getRuntime,\n  hooks,\n} from \"./Runtime.js\";\nimport { getPageInfo } from \"../getPageInfo.js\";\nimport type { RenderBrick, RenderRoot, RuntimeContext } from \"./interfaces.js\";\nimport { resetAllComputedMarks } from \"./compute/markAsComputed.js\";\nimport {\n  handleHttpError,\n  httpErrorToString,\n  isUnauthenticatedError,\n} from \"../handleHttpError.js\";\nimport { abortPendingRequest, initAbortController } from \"./abortController.js\";\nimport { setLoginStateCookie } from \"../setLoginStateCookie.js\";\nimport { registerCustomTemplates } from \"./registerCustomTemplates.js\";\nimport { fulfilStoryboard } from \"./fulfilStoryboard.js\";\nimport { RenderTag } from \"./enums.js\";\nimport { insertPreviewRoutes } from \"./insertPreviewRoutes.js\";\nimport { devtoolsHookEmit } from \"./devtools.js\";\nimport { setUIVersion } from \"../setUIVersion.js\";\n\nexport class Router {\n  readonly #storyboards: Storyboard[];\n  #rendering = false;\n  #prevLocation!: NextLocation;\n  #nextLocation?: NextLocation;\n  #runtimeContext?: RuntimeContext;\n  #rendererContext?: RendererContext;\n  #rendererContextTrashCan = new Set<RendererContext | undefined>();\n  #redirectCount = 0;\n  #renderId?: string;\n  #currentApp?: MicroApp;\n  #previousApp?: MicroApp;\n  #navConfig?: {\n    breadcrumb?: BreadcrumbItemConf[];\n  };\n\n  constructor(storyboards: Storyboard[]) {\n    this.#storyboards = storyboards;\n\n    const history = getHistory();\n    window.addEventListener(\"beforeunload\", (event) => {\n      const message = this.#getBlockMessageBeforePageLave({});\n      // See examples in https://developer.mozilla.org/en-US/docs/Web/API/WindowEventHandlers/onbeforeunload\n      if (message) {\n        // Cancel the event\n        // If you prevent default behavior in Mozilla Firefox prompt will always be shown\n        event.preventDefault();\n        // Chrome requires returnValue to be set\n        event.returnValue = \"\";\n      } else {\n        // the absence of a returnValue property on the event will guarantee the browser unload happens\n        delete event.returnValue;\n      }\n    });\n\n    history.block((location, action) =>\n      this.#getBlockMessageBeforePageLave({ location, action })\n    );\n  }\n\n  getRenderId() {\n    return this.#renderId;\n  }\n\n  getRuntimeContext() {\n    return this.#runtimeContext;\n  }\n\n  getRecentApps() {\n    return {\n      currentApp: this.#currentApp,\n      previousApp: this.#previousApp,\n    };\n  }\n\n  getNavConfig() {\n    return this.#navConfig;\n  }\n\n  #getBlockMessageBeforePageLave(detail: {\n    location?: NextLocation;\n    action?: Action;\n  }): string | undefined {\n    const history = getHistory();\n    const previousMessage = history.getBlockMessage();\n    this.#rendererContext?.dispatchBeforePageLeave(detail);\n    const message = history.getBlockMessage();\n    if (!previousMessage && message) {\n      // Auto unblock only if new block was introduced by `onBeforePageLeave`.\n      history.unblock();\n    }\n    return message;\n  }\n\n  #safeRedirect(\n    to: string,\n    state: NextHistoryState | undefined,\n    from: NextLocation\n  ): void {\n    if (this.#redirectCount++ > 10) {\n      const message = `Infinite redirect detected: from \"${from.pathname}${from.search}${from.hash}\" to \"${to}\"`;\n      // istanbul ignore else: error cannot be caught in test\n      if (process.env.NODE_ENV === \"test\") {\n        // eslint-disable-next-line no-console\n        console.error(message);\n        return;\n      } else {\n        throw new Error(message);\n      }\n    }\n    getHistory().replace(to, state);\n  }\n\n  bootstrap() {\n    initAbortController();\n    const history = getHistory();\n    this.#prevLocation = history.location;\n    let renderId = 0;\n    history.listen(async (location, action) => {\n      const currentRenderId = ++renderId;\n      let ignoreRendering: boolean | undefined;\n      const omittedLocationProps: Partial<NextLocation> = {\n        hash: undefined,\n        state: undefined,\n      };\n      // Omit the \"key\" when checking whether locations are equal in certain situations.\n      if (\n        // When current location is triggered by browser action of hash link.\n        location.key === undefined ||\n        // When current location is triggered by browser action of non-push-or-replace,\n        // such as goBack or goForward,\n        (action === \"POP\" &&\n          // and the previous location was triggered by hash link,\n          (this.#prevLocation.key === undefined ||\n            // or the previous location specified notify false.\n            this.#prevLocation.state?.notify === false))\n      ) {\n        omittedLocationProps.key = undefined;\n      }\n      if (\n        locationsAreEqual(\n          { ...this.#prevLocation, ...omittedLocationProps },\n          { ...location, ...omittedLocationProps }\n        ) ||\n        (action !== \"POP\" && location.state?.notify === false)\n      ) {\n        // Ignore rendering if location not changed except hash, state and optional key.\n        // Ignore rendering if notify is `false`.\n        ignoreRendering = true;\n      }\n\n      if (!ignoreRendering) {\n        ignoreRendering =\n          await this.#rendererContext?.didPerformIncrementalRender(location);\n      }\n\n      // Ignore stale renders\n      if (renderId !== currentRenderId) {\n        return;\n      }\n\n      if (ignoreRendering) {\n        this.#prevLocation = location;\n        return;\n      }\n\n      abortPendingRequest();\n      this.#prevLocation = location;\n      this.#rendererContext?.dispatchPageLeave();\n\n      if (action === \"POP\") {\n        const storyboard = matchStoryboard(\n          this.#storyboards,\n          location.pathname\n        );\n        // When a browser action of goBack or goForward is performing,\n        // force reload when the target page is a page of an outside app.\n        if (isOutsideApp(storyboard)) {\n          window.location.reload();\n          return;\n        }\n      }\n\n      if (this.#rendering) {\n        this.#nextLocation = location;\n      } else {\n        devtoolsHookEmit(\"locationChange\");\n        this.#queuedRender(location).catch(handleHttpError);\n      }\n    });\n    return this.#queuedRender(history.location);\n  }\n\n  async #queuedRender(location: NextLocation): Promise<void> {\n    this.#rendering = true;\n    try {\n      await this.#render(location);\n    } finally {\n      this.#rendering = false;\n      if (this.#nextLocation) {\n        const nextLocation = this.#nextLocation;\n        this.#nextLocation = undefined;\n        await this.#queuedRender(nextLocation);\n      }\n    }\n  }\n\n  async #render(location: NextLocation): Promise<void> {\n    const renderId = (this.#renderId = uniqueId(\"render-id-\"));\n\n    resetAllComputedMarks();\n    clearResolveCache();\n    hooks?.flowApi?.clearCollectWidgetContract();\n\n    const history = getHistory();\n    history.unblock();\n\n    // const renderStartTime = performance.now();\n    const finishPageView = hooks?.pageView?.create();\n\n    const storyboard = matchStoryboard(this.#storyboards, location.pathname);\n\n    const previousApp = this.#runtimeContext?.app;\n    if (storyboard?.app) {\n      await fulfilStoryboard(storyboard);\n    }\n    const currentApp = (this.#currentApp = storyboard?.app);\n\n    // Storyboard maybe re-assigned, e.g. when open launchpad.\n    const appChanged =\n      previousApp && currentApp\n        ? previousApp.id !== currentApp.id\n        : previousApp !== currentApp;\n\n    // TODO: handle favicon\n\n    // Set `Router::#currentApp` before calling `getFeatureFlags()`\n    const flags = getRuntime().getFeatureFlags();\n    const prevRendererContext = this.#rendererContext;\n\n    const redirectTo = (to: string, state?: NextHistoryState): void => {\n      finishPageView?.({\n        status: \"redirected\",\n      });\n      this.#rendererContextTrashCan.add(prevRendererContext);\n      this.#safeRedirect(to, state, location);\n    };\n\n    const redirectToLogin = (): void => {\n      const to = flags[\"sso-enabled\"] ? \"/sso-auth/login\" : \"/auth/login\";\n      setLoginStateCookie(location);\n      redirectTo(to, { from: location });\n    };\n\n    const main = document.querySelector(\"#main-mount-point\") as HTMLElement;\n    const portal = document.querySelector(\"#portal-mount-point\") as HTMLElement;\n\n    const renderRoot: RenderRoot = {\n      tag: RenderTag.ROOT,\n      container: main,\n      createPortal: portal,\n    };\n\n    const cleanUpPreviousRender = (): void => {\n      unmountTree(main);\n      unmountTree(portal);\n\n      // Note: redirects can lead to multiple trash renderer contexts.\n      this.#rendererContextTrashCan.add(prevRendererContext);\n      for (const item of this.#rendererContextTrashCan) {\n        if (item) {\n          item.dispatchOnUnmount();\n          item.dispose();\n        }\n      }\n      this.#rendererContextTrashCan.clear();\n      hooks?.messageDispatcher?.reset();\n\n      if (appChanged) {\n        this.#previousApp = previousApp;\n        window.dispatchEvent(\n          new CustomEvent(\"app.change\", {\n            detail: {\n              previousApp,\n              currentApp,\n            },\n          })\n        );\n      }\n    };\n\n    setTheme(\n      (currentApp &&\n        (getLocalAppsTheme()[currentApp.id] || currentApp.theme)) ||\n        \"light\"\n    );\n    setMode(\"default\");\n\n    if (currentApp) {\n      hooks?.checkInstalledApps?.preCheckInstalledApps(\n        storyboard,\n        (appId) => !!_internalApiGetAppInBootstrapData(appId)\n      );\n\n      const routeHelper: RouteHelper = {\n        bailout: (output) => {\n          if (output.unauthenticated) {\n            redirectToLogin();\n            return true;\n          }\n          if (output.redirect) {\n            redirectTo(output.redirect.path, output.redirect.state);\n            return true;\n          }\n          // Reset redirect count if no redirect is set.\n          this.#redirectCount = 0;\n        },\n        mergeMenus: async (menuRequests) => {\n          const menuConfs = await Promise.all(menuRequests);\n          this.#navConfig = mergeMenuConfs(menuConfs);\n        },\n        catch: (error, returnNode) => {\n          if (isUnauthenticatedError(error) && !window.NO_AUTH_GUARD) {\n            redirectToLogin();\n            return;\n          } else if (error instanceof HttpAbortError) {\n            this.#rendererContextTrashCan.add(prevRendererContext);\n            return;\n          } else {\n            const noAuthGuardLoginPath =\n              getRuntime().getMiscSettings().noAuthGuardLoginPath;\n            if (isUnauthenticatedError(error) && noAuthGuardLoginPath) {\n              redirectTo(noAuthGuardLoginPath as string, { from: location });\n              return;\n            }\n            return {\n              failed: true,\n              output: {\n                node: {\n                  tag: RenderTag.BRICK,\n                  type: \"div\",\n                  properties: {\n                    textContent: httpErrorToString(error),\n                  },\n                  runtimeContext: null!,\n                  return: returnNode,\n                },\n                blockingList: [],\n                menuRequests: [],\n              },\n            };\n          }\n        },\n      };\n\n      const rendererContext = (this.#rendererContext = new RendererContext(\n        \"page\",\n        { routeHelper, renderId }\n      ));\n\n      const runtimeContext: RuntimeContext = (this.#runtimeContext = {\n        app: currentApp,\n        location,\n        query: new URLSearchParams(location.search),\n        flags,\n        sys: {\n          ...hooks?.auth?.getAuth(),\n          ...getPageInfo(),\n          settings: {\n            brand: getRuntime().getBrandSettings(),\n          },\n        },\n        ctxStore: new DataStore(\"CTX\", undefined, rendererContext),\n        pendingPermissionsPreCheck: [\n          hooks?.checkPermissions?.preCheckPermissions(storyboard),\n        ],\n        tplStateStoreMap: new Map<string, DataStore<\"STATE\">>(),\n        formStateStoreMap: new Map<string, DataStore<\"FORM_STATE\">>(),\n      });\n\n      this.#navConfig = undefined;\n\n      registerCustomTemplates(storyboard);\n      registerStoryboardFunctions(storyboard.meta?.functions, currentApp);\n      hooks?.flowApi?.collectContract(storyboard.meta?.contracts);\n\n      let failed = false;\n      let output: RenderOutput;\n      let stores: DataStore<\"CTX\" | \"STATE\" | \"FORM_STATE\">[] = [];\n\n      try {\n        output = await renderRoutes(\n          renderRoot,\n          insertPreviewRoutes(storyboard.routes),\n          runtimeContext,\n          rendererContext,\n          []\n        );\n        if (routeHelper.bailout(output)) {\n          return;\n        }\n\n        stores = getDataStores(runtimeContext);\n\n        await postAsyncRender(output, runtimeContext, stores);\n\n        await routeHelper.mergeMenus(output.menuRequests);\n        rendererContext.setInitialMenuRequests(output.menuRequests);\n      } catch (error) {\n        // eslint-disable-next-line no-console\n        console.error(\"Router failed:\", error);\n\n        const result = routeHelper.catch(error, renderRoot);\n        if (!result) {\n          return;\n        }\n        ({ failed, output } = result);\n      }\n      renderRoot.child = output.node;\n\n      cleanUpPreviousRender();\n\n      if ((output.route && output.route.type !== \"routes\") || failed) {\n        if (!failed) {\n          // There is a window to set theme and mode by `lifeCycle.onBeforePageLoad`.\n          rendererContext.dispatchBeforePageLoad();\n        }\n        applyTheme();\n        applyMode();\n\n        window.DISABLE_REACT_FLUSH_SYNC = false;\n        setUIVersion(currentApp?.uiVersion);\n        mountTree(renderRoot);\n        setTimeout(() => {\n          window.DISABLE_REACT_FLUSH_SYNC = true;\n        });\n\n        // Scroll to top after each rendering.\n        // See https://github.com/ReactTraining/react-router/blob/master/packages/react-router-dom/docs/guides/scroll-restoration.md\n        window.scrollTo(0, 0);\n\n        if (!failed) {\n          rendererContext.dispatchPageLoad();\n          rendererContext.dispatchAnchorLoad();\n          rendererContext.dispatchOnMount();\n          rendererContext.initializeScrollIntoView();\n          rendererContext.initializeMediaChange();\n          rendererContext.initializeMessageDispatcher();\n\n          for (const store of stores) {\n            store.mountAsyncData();\n          }\n\n          finishPageView?.({\n            status: \"ok\",\n            path: output.path,\n            pageTitle: document.title,\n          });\n        } else {\n          finishPageView?.({ status: \"failed\" });\n        }\n        devtoolsHookEmit(\"rendered\");\n\n        return;\n      }\n    } else if (\n      !window.NO_AUTH_GUARD &&\n      hooks?.auth &&\n      !hooks.auth.isLoggedIn()\n    ) {\n      // Todo(steve): refine after api-gateway supports fetching storyboards before logged in.\n      // Redirect to login if no storyboard is matched.\n      redirectToLogin();\n      return;\n    } else {\n      cleanUpPreviousRender();\n    }\n\n    applyTheme();\n    applyMode();\n\n    const node: RenderBrick = {\n      tag: RenderTag.BRICK,\n      type: \"div\",\n      properties: {\n        textContent: \"Page not found\",\n      },\n      runtimeContext: null!,\n      return: renderRoot,\n    };\n    renderRoot.child = node;\n\n    mountTree(renderRoot);\n\n    // Scroll to top after each rendering.\n    window.scrollTo(0, 0);\n    finishPageView?.({ status: \"not-found\" });\n    devtoolsHookEmit(\"rendered\");\n  }\n}\n\nfunction mergeMenuConfs(menuConfs: StaticMenuConf[]) {\n  const navConfig = {\n    breadcrumb: [] as BreadcrumbItemConf[],\n  };\n  for (const menuConf of menuConfs) {\n    const { breadcrumb } = menuConf;\n    if (breadcrumb) {\n      if (breadcrumb.overwrite) {\n        navConfig.breadcrumb = breadcrumb.items;\n      } else {\n        navConfig.breadcrumb.push(...breadcrumb.items);\n      }\n    }\n  }\n  return navConfig;\n}\n","import { findLastIndex } from \"lodash\";\nimport type { RouteConf } from \"@next-core/types\";\n\nexport function insertPreviewRoutes(routes: RouteConf[]): RouteConf[] {\n  // Insert preview routes for iframe only.\n  if (window.parent === window) {\n    return routes;\n  }\n\n  let mergedRoutes = routes;\n\n  const specificTemplatePreviewIndex = findLastIndex(mergedRoutes, (route) =>\n    route.path.startsWith(\"${APP.homepage}/_dev_only_/template-preview/\")\n  );\n  mergedRoutes = [\n    ...mergedRoutes.slice(0, specificTemplatePreviewIndex + 1),\n    {\n      path: \"${APP.homepage}/_dev_only_/template-preview/:templateId\",\n      bricks: [{ brick: \"span\" }],\n      menu: false,\n      exact: true,\n    } as RouteConf,\n    ...mergedRoutes.slice(specificTemplatePreviewIndex + 1),\n  ];\n\n  const specificSnippetPreviewIndex = findLastIndex(mergedRoutes, (route) =>\n    route.path.startsWith(\"${APP.homepage}/_dev_only_/snippet-preview/\")\n  );\n  mergedRoutes = [\n    ...mergedRoutes.slice(0, specificSnippetPreviewIndex + 1),\n    {\n      path: \"${APP.homepage}/_dev_only_/snippet-preview/:snippetId\",\n      bricks: [{ brick: \"span\" }],\n      menu: false,\n      exact: true,\n    } as RouteConf,\n    ...mergedRoutes.slice(specificSnippetPreviewIndex + 1),\n  ];\n\n  return mergedRoutes;\n}\n","import type { BrickPackage } from \"@next-core/types\";\n\n// Allow inject brick packages in a runtime other than Brick Next.\nexport const injectedBrickPackages: BrickPackage[] | null =\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore\n  typeof BRICK_PACKAGES !== \"undefined\" ? BRICK_PACKAGES : null;\n","import {\n  BaseColors,\n  BrandColor,\n  getStyleByBaseColors,\n  getStyleByBrandColor,\n  getStyleByVariables,\n} from \"@next-core/color-theme\";\n\nexport type ColorThemeOptions =\n  | ColorThemeOptionsByBrand\n  | ColorThemeOptionsByBaseColors\n  | ColorThemeOptionsByVariables;\n\nexport interface ColorThemeOptionsByBrand {\n  type: \"brandColor\";\n  light?: BrandColor;\n  dark?: BrandColor;\n}\n\nexport interface ColorThemeOptionsByBaseColors {\n  type: \"baseColors\";\n  light?: BaseColors;\n  dark?: BaseColors;\n  backgroundColor?: string;\n}\n\nexport interface ColorThemeOptionsByVariables {\n  type: \"variables\";\n  light?: Record<string, string>;\n  dark?: Record<string, string>;\n}\n\nexport interface ThemeSettings {\n  brandColor?: Omit<ColorThemeOptionsByBrand, \"type\">;\n  baseColors?: Omit<ColorThemeOptionsByBaseColors, \"type\">;\n  variables?: Omit<ColorThemeOptionsByVariables, \"type\">;\n}\n\nexport function customizeColorTheme(theme: ThemeSettings | undefined): void {\n  if (!theme) {\n    return;\n  }\n  if (theme.brandColor) {\n    applyColorTheme({\n      type: \"brandColor\",\n      ...theme.brandColor,\n    });\n  } else if (theme.baseColors) {\n    applyColorTheme({\n      type: \"baseColors\",\n      ...theme.baseColors,\n    });\n  } else if (theme.variables) {\n    applyColorTheme({\n      type: \"variables\",\n      ...theme.variables,\n    });\n  }\n}\n\nexport function applyColorTheme(\n  options: ColorThemeOptions\n): (() => void) | undefined {\n  const style: string[] = [];\n  const themes = [\"light\", \"dark\"] as const;\n  themes.forEach((theme) => {\n    if (options[theme]) {\n      switch (options.type) {\n        case \"brandColor\":\n          style.push(getStyleByBrandColor(theme, options[theme]!));\n          break;\n        case \"baseColors\":\n          style.push(\n            getStyleByBaseColors(\n              theme,\n              options[theme]!,\n              options.backgroundColor\n            )\n          );\n          break;\n        case \"variables\":\n          style.push(getStyleByVariables(theme, options[theme]!));\n          break;\n      }\n    }\n  });\n\n  if (style.length > 0) {\n    const element = document.createElement(\"style\");\n    element.textContent = style.join(\"\\n\\n\");\n    document.head.appendChild(element);\n    return () => {\n      element.remove();\n    };\n  }\n}\n","// istanbul ignore file\n// Todo(steve): This file will be removed in the future.\nimport { hooks } from \"./internal/Runtime.js\";\n\n/** @deprecated import it from \"@next-core/easyops-runtime\" instead */\nexport function authenticate(...args: unknown[]): void {\n  hooks?.auth?.authenticate?.(...args);\n}\n\n/** @deprecated import it from \"@next-core/easyops-runtime\" instead */\nexport function getAuth() {\n  return hooks?.auth?.getAuth();\n}\n\n/** @deprecated import it from \"@next-core/easyops-runtime\" instead */\nexport function logout() {\n  return hooks?.auth?.logout?.();\n}\n\n/** @deprecated import it from \"@next-core/easyops-runtime\" instead */\nexport function isLoggedIn() {\n  return hooks?.auth?.isLoggedIn();\n}\n","import { getProviderBrick } from \"./internal/data/getProviderBrick.js\";\nimport {\n  ResolveOptions,\n  resolveByProvider,\n} from \"./internal/data/resolveData.js\";\n\nexport async function fetchByProvider(\n  provider: string,\n  args: unknown[],\n  options?: ResolveOptions\n) {\n  const providerBrick = (await getProviderBrick(provider)) as unknown as Record<\n    string,\n    Function\n  >;\n  return resolveByProvider(providerBrick, provider, \"resolve\", args, options);\n}\n","import type {\n  BrickConf,\n  ContextConf,\n  CustomTemplate,\n  MetaI18n,\n  MicroApp,\n  SiteTheme,\n  Storyboard,\n  StoryboardFunction,\n} from \"@next-core/types\";\nimport { uniqueId } from \"lodash\";\nimport {\n  RenderOutput,\n  getDataStores,\n  postAsyncRender,\n  renderBricks,\n} from \"./internal/Renderer.js\";\nimport { RendererContext } from \"./internal/RendererContext.js\";\nimport { DataStore } from \"./internal/data/DataStore.js\";\nimport type { RenderRoot, RuntimeContext } from \"./internal/interfaces.js\";\nimport { mountTree, unmountTree } from \"./internal/mount.js\";\nimport { httpErrorToString } from \"./handleHttpError.js\";\nimport { applyMode, applyTheme, setMode, setTheme } from \"./themeAndMode.js\";\nimport { RenderTag } from \"./internal/enums.js\";\nimport { registerStoryboardFunctions } from \"./internal/compute/StoryboardFunctions.js\";\nimport { registerAppI18n } from \"./internal/registerAppI18n.js\";\nimport { registerCustomTemplates } from \"./internal/registerCustomTemplates.js\";\nimport { setUIVersion } from \"./setUIVersion.js\";\n\nexport interface CreateRootOptions {\n  portal?: HTMLElement;\n  /**\n   * Defaults to \"fragment\", only set it to \"page\" when the root is in a standalone iframe.\n   * - page: render as whole page, triggering page life cycles, and enable register of functions/templates/i18n.\n   * - fragment: render as fragment, not triggering page life cycles, and disable register of functions/templates/i18n.\n   */\n  scope?: \"page\" | \"fragment\";\n\n  /**\n   * Whether to throw error when encountering unknown bricks.\n   *\n   * Defaults to \"throw\".\n   */\n  unknownBricks?: \"silent\" | \"throw\";\n}\n\nexport interface RenderOptions {\n  theme?: SiteTheme;\n  uiVersion?: string;\n  context?: ContextConf[];\n  functions?: StoryboardFunction[];\n  templates?: CustomTemplate[];\n  i18n?: MetaI18n;\n}\n\nexport function unstable_createRoot(\n  container: HTMLElement | DocumentFragment,\n  { portal: _portal, scope = \"fragment\", unknownBricks }: CreateRootOptions = {}\n) {\n  let portal = _portal;\n  let createPortal: RenderRoot[\"createPortal\"];\n  if (_portal) {\n    createPortal = _portal;\n  } else {\n    // Create portal container when necessary.\n    createPortal = () => {\n      portal = document.createElement(\"div\");\n      portal.style.position = \"absolute\";\n      portal.style.width = portal.style.height = \"0\";\n      document.body.append(portal);\n      return portal;\n    };\n  }\n  let unmounted = false;\n  let rendererContext: RendererContext | undefined;\n  let clearI18nBundles: Function | undefined;\n\n  return {\n    async render(\n      brick: BrickConf | BrickConf[],\n      {\n        theme,\n        uiVersion,\n        context,\n        functions,\n        templates,\n        i18n: i18nData,\n      }: RenderOptions = {}\n    ) {\n      if (unmounted) {\n        throw new Error(\n          \"The root is unmounted and cannot be rendered any more\"\n        );\n      }\n      const bricks = ([] as BrickConf[]).concat(brick);\n\n      const previousRendererContext = rendererContext;\n      const renderId = uniqueId(\"render-id-\");\n      rendererContext = new RendererContext(scope, { unknownBricks, renderId });\n\n      const runtimeContext = {\n        ctxStore: new DataStore(\"CTX\", undefined, rendererContext),\n        pendingPermissionsPreCheck: [],\n        tplStateStoreMap: new Map<string, DataStore<\"STATE\">>(),\n        formStateStoreMap: new Map<string, DataStore<\"FORM_STATE\">>(),\n      } as Partial<RuntimeContext> as RuntimeContext;\n\n      const renderRoot: RenderRoot = {\n        tag: RenderTag.ROOT,\n        container,\n        createPortal,\n      };\n\n      if (scope === \"page\") {\n        setTheme(theme ?? \"light\");\n        setMode(\"default\");\n        setUIVersion(uiVersion);\n\n        const demoApp = {\n          id: \"demo\",\n          homepage: \"/demo\",\n        } as MicroApp;\n        runtimeContext.app = demoApp;\n        const demoStoryboard = {\n          app: demoApp,\n          meta: {\n            i18n: i18nData,\n            customTemplates: templates,\n          },\n        } as Storyboard;\n\n        // Register i18n.\n        clearI18nBundles?.();\n        clearI18nBundles = registerAppI18n(demoStoryboard);\n\n        // Register custom templates.\n        registerCustomTemplates(demoStoryboard);\n\n        // Register functions.\n        registerStoryboardFunctions(functions, demoApp);\n      }\n\n      runtimeContext.ctxStore.define(context, runtimeContext);\n\n      let failed = false;\n      let output: RenderOutput;\n      let stores: DataStore<\"CTX\" | \"STATE\" | \"FORM_STATE\">[] = [];\n\n      try {\n        output = await renderBricks(\n          renderRoot,\n          bricks,\n          runtimeContext,\n          rendererContext,\n          []\n        );\n\n        stores = getDataStores(runtimeContext);\n        await postAsyncRender(output, runtimeContext, stores);\n      } catch (error) {\n        failed = true;\n        output = {\n          node: {\n            tag: RenderTag.BRICK,\n            type: \"div\",\n            properties: {\n              textContent: httpErrorToString(error),\n            },\n            return: renderRoot,\n            runtimeContext: null!,\n          },\n          blockingList: [],\n          menuRequests: [],\n        };\n      }\n\n      renderRoot.child = output.node;\n\n      previousRendererContext?.dispatchOnUnmount();\n      previousRendererContext?.dispose();\n      unmountTree(container);\n      if (portal) {\n        unmountTree(portal);\n      }\n\n      if (scope === \"page\") {\n        if (!failed) {\n          rendererContext.dispatchBeforePageLoad();\n        }\n\n        applyTheme();\n        applyMode();\n      }\n\n      mountTree(renderRoot);\n\n      if (scope === \"page\") {\n        window.scrollTo(0, 0);\n      }\n\n      if (!failed) {\n        for (const store of stores) {\n          store.mountAsyncData();\n        }\n\n        if (scope === \"page\") {\n          rendererContext.dispatchPageLoad();\n          // rendererContext.dispatchAnchorLoad();\n        }\n        rendererContext.dispatchOnMount();\n        rendererContext.initializeScrollIntoView();\n        rendererContext.initializeMediaChange();\n        rendererContext.initializeMessageDispatcher();\n      }\n    },\n    unmount() {\n      if (unmounted) {\n        return;\n      }\n      unmounted = true;\n      unmountTree(container);\n      if (portal) {\n        unmountTree(portal);\n        // Only remove the portal from its parent when it's dynamic created.\n        if (!_portal) {\n          portal.remove();\n        }\n      }\n    },\n  };\n}\n","import type {\n  BrickConf,\n  CustomTemplate,\n  RouteConf,\n  Storyboard,\n  UseSingleBrickConf,\n  RuntimeSnippet,\n  ContextConf,\n} from \"@next-core/types\";\nimport { pick } from \"lodash\";\nimport {\n  _internalApiGetRenderId,\n  _internalApiGetRuntimeContext,\n  _internalApiGetStoryboardInBootstrapData,\n  getBrickPackages,\n} from \"./Runtime.js\";\nimport {\n  createScopedRuntimeContext,\n  postAsyncRender,\n  renderBrick,\n} from \"./Renderer.js\";\nimport { RendererContext } from \"./RendererContext.js\";\nimport type { DataStore } from \"./data/DataStore.js\";\nimport type {\n  DataValueOption,\n  PreviewOption,\n  PreviewStoryboardPatch,\n  RenderRoot,\n} from \"./interfaces.js\";\nimport { mountTree, unmountTree } from \"./mount.js\";\nimport { RenderTag } from \"./enums.js\";\nimport { computeRealValue } from \"./compute/computeRealValue.js\";\nimport { isStrictMode, warnAboutStrictMode } from \"../isStrictMode.js\";\nimport { customTemplates } from \"../CustomTemplates.js\";\nimport { registerAppI18n } from \"./registerAppI18n.js\";\nimport { getTplStateStore } from \"./CustomTemplates/utils.js\";\n\nexport type { DataValueOption, RuntimeContext } from \"./interfaces.js\";\n\nexport interface RenderUseBrickResult {\n  tagName: string | null;\n  renderRoot: RenderRoot;\n  rendererContext: RendererContext;\n  scopedStores: DataStore<\"STATE\" | \"FORM_STATE\">[];\n}\n\nexport async function renderUseBrick(\n  useBrick: UseSingleBrickConf,\n  data: unknown\n): Promise<RenderUseBrickResult> {\n  const [scopedRuntimeContext, tplStateStoreScope, formStateStoreScope] =\n    createScopedRuntimeContext({\n      ..._internalApiGetRuntimeContext()!,\n      data,\n      pendingPermissionsPreCheck: [],\n    });\n\n  scopedRuntimeContext.tplStateStoreMap ??= new Map();\n  scopedRuntimeContext.formStateStoreMap ??= new Map();\n\n  const rendererContext = new RendererContext(\"fragment\");\n\n  const renderRoot: RenderRoot = {\n    tag: RenderTag.ROOT,\n    // Will set during `mountUseBrick`\n    createPortal: null!,\n  };\n\n  const transform = (useBrick as { transform?: Record<string, unknown> })\n    .transform;\n  const strict = isStrictMode();\n  if (transform) {\n    warnAboutStrictMode(\n      strict,\n      \"`useBrick.transform`\",\n      'please use \"properties\" instead, check your useBrick:',\n      useBrick\n    );\n  }\n\n  const output = await renderBrick(\n    renderRoot,\n    strict\n      ? useBrick\n      : {\n          ...useBrick,\n          properties: {\n            ...useBrick.properties,\n            ...transform,\n          },\n        },\n    scopedRuntimeContext,\n    rendererContext,\n    []\n  );\n\n  const scopedStores = [...tplStateStoreScope, ...formStateStoreScope];\n\n  await postAsyncRender(output, scopedRuntimeContext, scopedStores);\n\n  if (output.node?.tag === RenderTag.PLACEHOLDER) {\n    throw new Error(\n      \"The root brick of useBrick cannot be an ignored control node\"\n    );\n  }\n\n  if (output.node?.portal) {\n    throw new Error(\"The root brick of useBrick cannot be a portal brick\");\n  }\n\n  renderRoot.child = output.node;\n\n  const tagName = output.node ? output.node.type : null;\n\n  return { tagName, renderRoot, rendererContext, scopedStores };\n}\n\nexport interface MountUseBrickResult {\n  portal?: HTMLElement;\n}\n\nexport function mountUseBrick(\n  { renderRoot, rendererContext, scopedStores }: RenderUseBrickResult,\n  element: HTMLElement\n): MountUseBrickResult {\n  let portal: HTMLElement | undefined;\n  renderRoot.createPortal = () => {\n    const portalRoot = document.querySelector(\n      \"#portal-mount-point\"\n    ) as HTMLElement;\n    portal = document.createElement(\"div\");\n    portalRoot.appendChild(portal);\n    return portal;\n  };\n\n  mountTree(renderRoot, element);\n\n  rendererContext.dispatchOnMount();\n  rendererContext.initializeScrollIntoView();\n  rendererContext.initializeMediaChange();\n  rendererContext.initializeMessageDispatcher();\n\n  for (const store of scopedStores) {\n    store.mountAsyncData();\n  }\n\n  return {\n    portal,\n  };\n}\n\nexport function unmountUseBrick(\n  { rendererContext }: RenderUseBrickResult,\n  mountResult: MountUseBrickResult\n): void {\n  // if (mountResult.mainBrick) {\n  //   mountResult.mainBrick.unmount();\n  // }\n  if (mountResult.portal) {\n    unmountTree(mountResult.portal);\n    mountResult.portal.remove();\n  }\n  rendererContext.dispatchOnUnmount();\n  rendererContext.dispose();\n}\n\n/** For v2 compatibility of `doTransform` from brick-kit. */\nexport function legacyDoTransform(\n  data: unknown,\n  to: unknown,\n  options?: unknown\n) {\n  if (options) {\n    throw new Error(\"Legacy doTransform does not support options in v3\");\n  }\n  return computeRealValue(\n    to,\n    {\n      ..._internalApiGetRuntimeContext()!,\n      data,\n    },\n    {\n      noInject: true,\n    }\n  );\n}\n\nexport function updateStoryboard(\n  appId: string,\n  storyboardPatch: Partial<Storyboard>\n): void {\n  const storyboard = _internalApiGetStoryboardInBootstrapData(appId)!;\n  Object.assign(storyboard, {\n    ...storyboardPatch,\n    $$fulfilling: null,\n    $$fulfilled: true,\n    $$registerCustomTemplateProcessed: false,\n  });\n  registerAppI18n(storyboard);\n}\n\nexport function updateStoryboardByRoute(appId: string, newRoute: RouteConf) {\n  const storyboard = _internalApiGetStoryboardInBootstrapData(appId)!;\n  let match = false;\n  const getKey = (route: RouteConf): string => `${route.path}.${route.exact}`;\n  const replaceRoute = (routes: RouteConf[], key: string): RouteConf[] => {\n    return routes.map((route) => {\n      const routeKey = getKey(route);\n      if (route.type === \"routes\") {\n        route.routes = replaceRoute(route.routes, key);\n        return route;\n      } else if (routeKey === key) {\n        match = true;\n        return newRoute;\n      } else {\n        return route;\n      }\n    });\n  };\n  storyboard.routes = replaceRoute(storyboard.routes, getKey(newRoute));\n  if (!match) {\n    storyboard.routes.unshift(newRoute);\n  }\n}\n\nexport function updateStoryboardByTemplate(\n  appId: string,\n  newTemplate: CustomTemplate,\n  settings: unknown\n): void {\n  const tplName = `${appId}.${newTemplate.name}`;\n  // customTemplateRegistry.delete(tplName);\n  customTemplates.define(tplName, {\n    bricks: newTemplate.bricks,\n    proxy: newTemplate.proxy,\n    state: newTemplate.state,\n  });\n  updateTemplatePreviewSettings(appId, newTemplate.name, settings);\n}\n\nexport function updateTemplatePreviewSettings(\n  appId: string,\n  templateId: string,\n  settings?: unknown\n): void {\n  _updatePreviewSettings(\n    appId,\n    `\\${APP.homepage}/_dev_only_/template-preview/${templateId}`,\n    [\n      {\n        brick: templateId,\n        ...pick(\n          settings,\n          \"properties\",\n          \"events\",\n          \"lifeCycle\",\n          \"context\",\n          \"slots\",\n          \"children\"\n        ),\n      },\n    ]\n  );\n}\n\nfunction getSnippetPreviewPath(snippetId: string): string {\n  return `\\${APP.homepage}/_dev_only_/snippet-preview/${snippetId}`;\n}\n\nexport function updateStoryboardBySnippet(\n  appId: string,\n  snippetData: {\n    snippetId: string;\n    bricks?: BrickConf[];\n    context?: ContextConf[];\n  }\n): void {\n  _updatePreviewSettings(\n    appId,\n    getSnippetPreviewPath(snippetData.snippetId),\n    snippetData.bricks?.length ? snippetData.bricks : [{ brick: \"span\" }],\n    snippetData.context\n  );\n}\n\nexport const updateSnippetPreviewSettings = updateStoryboardBySnippet;\n\nfunction _updatePreviewSettings(\n  appId: string,\n  path: string,\n  bricks: BrickConf[],\n  context?: ContextConf[]\n) {\n  const { routes } = _internalApiGetStoryboardInBootstrapData(appId)!;\n  const previewRouteIndex = routes.findIndex((route) => route.path === path);\n  const newPreviewRoute: RouteConf = {\n    path,\n    bricks,\n    context,\n    menu: false,\n    exact: true,\n  };\n  if (previewRouteIndex === -1) {\n    routes.unshift(newPreviewRoute);\n  } else {\n    routes.splice(previewRouteIndex, 1, newPreviewRoute);\n  }\n}\n\nexport function getContextValue(\n  name: string,\n  { tplStateStoreId }: DataValueOption\n): unknown {\n  const runtimeContext = _internalApiGetRuntimeContext()!;\n\n  if (tplStateStoreId) {\n    const tplStateStore = getTplStateStore(\n      {\n        ...runtimeContext,\n        tplStateStoreId,\n      },\n      \"STATE\"\n    );\n    return tplStateStore.getValue(name);\n  }\n\n  return runtimeContext.ctxStore.getValue(name);\n}\n\nexport function getAllContextValues({\n  tplStateStoreId,\n}: DataValueOption): Record<string, unknown> {\n  const runtimeContext = _internalApiGetRuntimeContext()!;\n\n  if (tplStateStoreId) {\n    const tplStateStore = getTplStateStore(\n      {\n        ...runtimeContext,\n        tplStateStoreId,\n      },\n      \"STATE\"\n    );\n    return tplStateStore.getAllValues();\n  }\n\n  return runtimeContext.ctxStore.getAllValues();\n}\n\nexport function getBrickPackagesById(id: string) {\n  return getBrickPackages().find((pkg) =>\n    pkg.id ? pkg.id === id : pkg.filePath.startsWith(id)\n  );\n}\n\nexport function getRenderId() {\n  return _internalApiGetRenderId();\n}\n\nexport async function getAddedContracts(\n  storyboardPatch: PreviewStoryboardPatch,\n  { appId, updateStoryboardType, collectUsedContracts }: PreviewOption\n): Promise<string[]> {\n  const storyboard = _internalApiGetStoryboardInBootstrapData(appId);\n  let updatedStoryboard;\n\n  // 拿到更新部分的 storyboard 配置，然后扫描一遍，找到新增的 contracts\n  if (updateStoryboardType === \"route\") {\n    updatedStoryboard = {\n      routes: [storyboardPatch as RouteConf],\n    } as Storyboard;\n  } else if (updateStoryboardType === \"template\") {\n    updatedStoryboard = {\n      meta: {\n        customTemplates: [storyboardPatch as CustomTemplate],\n      },\n    } as Storyboard;\n  } else if (updateStoryboardType === \"snippet\") {\n    // snippet 是放在挂载 route 里预览，通过 previewPath 拿到当前修改 route\n    const snippetPreviewPath = getSnippetPreviewPath(\n      (storyboardPatch as RuntimeSnippet).snippetId\n    );\n    const currentRoute = storyboard?.routes?.find(\n      (route) => route.path === snippetPreviewPath\n    );\n\n    updatedStoryboard = {\n      routes: [currentRoute],\n    } as Storyboard;\n  }\n\n  const addedContracts: string[] = [];\n\n  if (updatedStoryboard && collectUsedContracts) {\n    const contractApis = await collectUsedContracts(updatedStoryboard);\n\n    contractApis.forEach((api: string) => {\n      // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      const [_, namespaceId, name] = api.match(\n        /(.*)@(.*):\\d\\.\\d\\.\\d/\n      ) as string[];\n\n      if (\n        !storyboard?.meta?.contracts?.some(\n          (contract) =>\n            contract.namespaceId === namespaceId && contract.name === name\n        )\n      ) {\n        addedContracts.push(api);\n      }\n    });\n  }\n\n  return addedContracts;\n}\n","interface ProviderElement<T extends unknown[], U> extends HTMLElement {\n  resolve(...args: T): U;\n}\n\ninterface ProviderConstructor<T extends unknown[], U> {\n  new (): ProviderElement<T, U>;\n}\n\nexport function createProviderClass<T extends unknown[], U>(\n  api: (...args: T) => U\n): ProviderConstructor<T, U> {\n  return class extends HTMLElement {\n    get $$typeof(): string {\n      return \"provider\";\n    }\n\n    resolve(...args: T): U {\n      return api(...args);\n    }\n  };\n}\n","// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze\n\n/** @internal */\nexport function deepFreeze<T>(object: T): T {\n  // Retrieve the property names defined on object\n  const propNames = Object.getOwnPropertyNames(object);\n\n  // Freeze properties before freezing self\n\n  for (const name of propNames) {\n    const value = (object as Record<string, unknown>)[name];\n\n    if (value && typeof value === \"object\") {\n      deepFreeze(value);\n    }\n  }\n\n  return Object.freeze(object);\n}\n","export function hasOwnProperty(\n  object: object,\n  property: string | number | symbol\n): boolean {\n  return Object.prototype.hasOwnProperty.call(object, property);\n}\n","// Ref https://github.com/lodash/lodash/blob/4.17.11/lodash.js#L11744\nexport function isObject(value: unknown): value is Record<string, unknown> {\n  const type = typeof value;\n  return value != null && (type == \"object\" || type == \"function\");\n}\n","// This is copied from\n// [@next-libs/storage](https://github.com/easyops-cn/next-libs/tree/master/libs/storage),\n// and the types is refined.\n// The usage of JsonStorage from @next-libs/storage should be deprecated,\n// and migrated to from @next-core/brick-utils.\nexport class JsonStorage<U = Record<string, unknown>> {\n  constructor(\n    private storage: Storage,\n    private prefix: string = \"brick-next-\"\n  ) {}\n\n  setItem<T extends string & keyof U>(name: T, value: U[T]): void {\n    this.storage.setItem(this.prefix + name, JSON.stringify(value));\n  }\n\n  getItem<T extends string & keyof U>(name: T): U[T] {\n    return JSON.parse(\n      this.storage.getItem(this.prefix + name) ?? \"null\"\n    ) as U[T];\n  }\n\n  removeItem<T extends string & keyof U>(name: T): void {\n    return this.storage.removeItem(this.prefix + name);\n  }\n\n  clear(): void {\n    return this.storage.clear();\n  }\n}\n","const pool = new Map<string, HTMLElement>();\n\nfunction getProviderBrick(provider: string) {\n  let brick = pool.get(provider);\n  if (brick) {\n    return brick;\n  }\n  brick = document.createElement(provider);\n  pool.set(provider, brick);\n  return brick;\n}\n\nexport function unwrapProvider<T extends (...args: any[]) => any>(\n  provider: string\n): (...args: Parameters<T>) => ReturnType<T> {\n  return function (...args: Parameters<T>): ReturnType<T> {\n    const brick = getProviderBrick(provider) as unknown as {\n      resolve(...args: Parameters<T>): ReturnType<T>;\n    };\n    return brick.resolve(...args);\n  };\n}\n","import type { Identifier } from \"@babel/types\";\nimport type { EstreeParent } from \"@next-core/cook\";\n\nexport interface MemberUsage {\n  usedProperties: Set<string>;\n  hasNonStaticUsage: boolean;\n}\n\nexport type BeforeVisitGlobal = (\n  node: Identifier,\n  parent: EstreeParent\n) => void;\n\nexport function beforeVisitGlobalMember(\n  usage: MemberUsage,\n  objectName: string | string[],\n  level: 1 | 2 = 1,\n  rememberObjectName = false\n): BeforeVisitGlobal {\n  return function beforeVisitGlobal(node, parent): void {\n    if (\n      typeof objectName === \"string\"\n        ? node.name === objectName\n        : objectName.includes(node.name)\n    ) {\n      const segments: string[] = [];\n      for (let i = 1; i <= level; i++) {\n        const memberParent = parent[parent.length - i];\n        if (\n          memberParent?.node.type === \"MemberExpression\" &&\n          memberParent.key === \"object\"\n        ) {\n          const memberNode = memberParent.node;\n          if (\n            !memberNode.computed &&\n            memberNode.property.type === \"Identifier\"\n          ) {\n            segments.push(\n              rememberObjectName\n                ? `${node.name}.${memberNode.property.name}`\n                : memberNode.property.name\n            );\n          } else if (\n            memberNode.computed &&\n            (memberNode.property as any).type === \"Literal\" &&\n            typeof (memberNode.property as any).value === \"string\"\n          ) {\n            segments.push(\n              rememberObjectName\n                ? `${node.name}.${(memberNode.property as any).value}`\n                : (memberNode.property as any).value\n            );\n          } else {\n            usage.hasNonStaticUsage = true;\n          }\n        } else {\n          usage.hasNonStaticUsage = true;\n        }\n      }\n      if (segments.length === level) {\n        usage.usedProperties.add(segments.join(\".\"));\n      }\n    }\n  };\n}\n","import type { Identifier } from \"@babel/types\";\nimport type { EstreeLiteral, EstreeParent } from \"@next-core/cook\";\n\nexport interface MemberCallUsage {\n  usedArgs: Set<string>;\n  hasNonStaticUsage?: boolean;\n}\n\nfunction collectMemberCallUsageFactory(object: string, property: string) {\n  return function collectMemberCallUsage(\n    usage: MemberCallUsage,\n    node: Identifier,\n    parent: EstreeParent\n  ) {\n    if (node.name === object) {\n      const memberParent = parent[parent.length - 1];\n      const callParent = parent[parent.length - 2];\n      if (\n        callParent?.node.type === \"CallExpression\" &&\n        callParent?.key === \"callee\" &&\n        memberParent?.node.type === \"MemberExpression\" &&\n        memberParent.key === \"object\" &&\n        (memberParent.node.computed\n          ? (memberParent.node.property as any).type === \"Literal\" &&\n            (memberParent.node.property as any).value === property\n          : memberParent.node.property.type === \"Identifier\" &&\n            memberParent.node.property.name === property)\n      ) {\n        const args = callParent.node.arguments as unknown as EstreeLiteral[];\n        if (args.length > 0) {\n          const firstArg = args[0];\n          if (\n            firstArg.type === \"Literal\" &&\n            typeof firstArg.value === \"string\"\n          ) {\n            usage.usedArgs.add(firstArg.value);\n          } else {\n            usage.hasNonStaticUsage = true;\n          }\n        }\n      }\n    }\n  };\n}\n\nexport const collectAppGetMenuUsage = collectMemberCallUsageFactory(\n  \"APP\",\n  \"getMenu\"\n);\n\nexport const collectInstalledAppsHasUsage = collectMemberCallUsageFactory(\n  \"INSTALLED_APPS\",\n  \"has\"\n);\n","import { Identifier } from \"@babel/types\";\nimport { isEvaluable, preevaluate, type EstreeParent } from \"@next-core/cook\";\nimport { isObject } from \"@next-core/utils/general\";\n\nexport interface TraverseStoryboardExpressionsOptions {\n  matchExpressionString: (v: string) => boolean;\n  visitNotMatchedExpressionString?: (v: string) => unknown;\n  visitNonExpressionString?: (v: string) => unknown;\n  visitObject?: (v: unknown[] | Record<string, unknown>) => unknown;\n}\n\nexport type BeforeVisitGlobalWithExpr = (\n  node: Identifier,\n  parent: EstreeParent,\n  expr: string\n) => void;\n\nexport function traverseStoryboardExpressions(\n  data: unknown,\n  beforeVisitGlobal: BeforeVisitGlobalWithExpr,\n  // If `options` is a string, it means the *keyword*.\n  options: string | TraverseStoryboardExpressionsOptions\n): void {\n  const memo = new WeakSet();\n  const {\n    matchExpressionString,\n    visitNotMatchedExpressionString,\n    visitNonExpressionString,\n    visitObject,\n  } =\n    typeof options === \"string\"\n      ? ({\n          matchExpressionString: (v: string) => v.includes(options),\n        } as TraverseStoryboardExpressionsOptions)\n      : options;\n  function traverse(value: unknown): void {\n    if (typeof value === \"string\") {\n      if (isEvaluable(value)) {\n        if (matchExpressionString(value)) {\n          try {\n            preevaluate(value, {\n              withParent: true,\n              hooks: {\n                beforeVisitGlobal(node, parent) {\n                  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                  beforeVisitGlobal(node, parent!, value);\n                },\n              },\n            });\n          } catch (error) {\n            // eslint-disable-next-line no-console\n            console.error(\"Parse storyboard expression failed:\", error);\n          }\n        } else {\n          visitNotMatchedExpressionString?.(value);\n        }\n      } else {\n        visitNonExpressionString?.(value);\n      }\n    } else if (isObject(value)) {\n      // Avoid call stack overflow.\n      if (memo.has(value)) {\n        return;\n      }\n      memo.add(value);\n      visitObject?.(value);\n      for (const item of Array.isArray(value) ? value : Object.values(value)) {\n        traverse(item);\n      }\n    }\n  }\n  traverse(data);\n}\n","import {\n  MemberUsage,\n  beforeVisitGlobalMember,\n} from \"./beforeVisitGlobalMember.js\";\nimport { traverseStoryboardExpressions } from \"./traverse.js\";\n\nexport interface MemberUsageInExpressions extends MemberUsage {\n  nonStaticUsage?: string;\n}\n\nexport function strictCollectMemberUsage(\n  data: unknown,\n  objectName: string,\n  level: 1 | 2 = 1\n): Set<string> {\n  const { hasNonStaticUsage, nonStaticUsage, usedProperties } =\n    collectMemberUsage(data, objectName, level);\n  if (hasNonStaticUsage) {\n    throw new Error(\n      `Non-static usage of ${objectName} is prohibited, check your expression: \"${nonStaticUsage}\"`\n    );\n  }\n  return usedProperties;\n}\n\nexport function collectMemberUsage(\n  data: unknown,\n  objectName: string,\n  level: 1 | 2 = 1\n): MemberUsageInExpressions {\n  const usage: MemberUsageInExpressions = {\n    usedProperties: new Set(),\n    hasNonStaticUsage: false,\n  };\n  const beforeVisitGlobal = beforeVisitGlobalMember(usage, objectName, level);\n  traverseStoryboardExpressions(\n    data,\n    (node, parent, expr) => {\n      beforeVisitGlobal(node, parent);\n      if (usage.hasNonStaticUsage) {\n        usage.nonStaticUsage = expr;\n      }\n    },\n    objectName\n  );\n  return usage;\n}\n","import { preevaluate } from \"@next-core/cook\";\nimport {\n  MemberUsage,\n  beforeVisitGlobalMember,\n} from \"./beforeVisitGlobalMember.js\";\n\ninterface trackAllResult {\n  context: string[] | false;\n  state: string[] | false;\n  formState: string[] | false;\n}\n\nexport function track(\n  raw: string,\n  trackText: string,\n  variableName: string\n): Set<string> | false {\n  if (raw.includes(trackText)) {\n    const usage: MemberUsage = {\n      usedProperties: new Set(),\n      hasNonStaticUsage: false,\n    };\n    const { expression } = preevaluate(raw, {\n      withParent: true,\n      hooks: {\n        beforeVisitGlobal: beforeVisitGlobalMember(usage, variableName),\n      },\n    });\n    let trackCtxExp: any;\n    if (\n      expression.type === \"SequenceExpression\" &&\n      (trackCtxExp = expression.expressions[0] as unknown) &&\n      trackCtxExp.type === \"Literal\" &&\n      trackCtxExp.value === trackText\n    ) {\n      if (usage.usedProperties.size > 0) {\n        return usage.usedProperties;\n      } else {\n        // eslint-disable-next-line no-console\n        console.warn(\n          `You are using \"${trackText}\" but no \\`${variableName}\\` usage found in your expression: ${JSON.stringify(\n            raw\n          )}`\n        );\n      }\n    }\n  }\n  return false;\n}\n\nexport function trackAll(raw: string): trackAllResult | false {\n  if (raw) {\n    const usage: MemberUsage = {\n      usedProperties: new Set(),\n      hasNonStaticUsage: false,\n    };\n    preevaluate(raw, {\n      withParent: true,\n      hooks: {\n        beforeVisitGlobal: beforeVisitGlobalMember(\n          usage,\n          [\"CTX\", \"STATE\", \"FORM_STATE\"],\n          1,\n          true\n        ),\n      },\n    });\n    if (usage.usedProperties.size > 0) {\n      const usedProperites = [...usage.usedProperties];\n      const result: trackAllResult = {\n        context: false,\n        state: false,\n        formState: false,\n      };\n      const keyMap: Record<string, keyof trackAllResult> = {\n        CTX: \"context\",\n        STATE: \"state\",\n        FORM_STATE: \"formState\",\n      };\n      usedProperites.forEach((item) => {\n        const [key, name] = item.split(\".\");\n        if (!result[keyMap[key]]) {\n          result[keyMap[key]] = [];\n        }\n        (result[keyMap[key]] as string[]).push(name);\n      });\n      return result;\n    } else {\n      // eslint-disable-next-line no-console\n      console.warn(\n        `You are using track all but no \"CTX\" or \"STATE\" or \"FORM_STATE\" usage found in your expression: ${JSON.stringify(\n          raw\n        )}`\n      );\n    }\n  }\n  return false;\n}\n","import type { StoryboardFunction } from \"@next-core/types\";\nimport { precookFunction } from \"@next-core/cook\";\nimport { BeforeVisitGlobal } from \"../index.js\";\n\nexport function traverseStoryboardFunctions(\n  functions: StoryboardFunction[] | null | undefined,\n  beforeVisitGlobal: BeforeVisitGlobal\n): void {\n  if (Array.isArray(functions)) {\n    for (const fn of functions) {\n      traverseStoryboardFunction(fn, beforeVisitGlobal);\n    }\n  }\n}\n\nexport function traverseStoryboardFunction(\n  fn: StoryboardFunction,\n  beforeVisitGlobal: BeforeVisitGlobal,\n  silentErrors?: boolean\n): void {\n  try {\n    precookFunction(fn.source, {\n      typescript: fn.typescript,\n      withParent: true,\n      hooks: { beforeVisitGlobal },\n    });\n  } catch (error) {\n    if (!silentErrors) {\n      // eslint-disable-next-line no-console\n      console.error(`Parse storyboard function \"${fn.name}\" failed:`, error);\n    }\n  }\n}\n","import type { StoryboardFunction } from \"@next-core/types\";\nimport {\n  MemberUsage,\n  beforeVisitGlobalMember,\n} from \"../expressions/beforeVisitGlobalMember.js\";\nimport { traverseStoryboardFunction } from \"./traverse.js\";\n\nexport function collectMemberUsageInFunction(\n  fn: StoryboardFunction,\n  objectName: string,\n  silentErrors?: boolean,\n  level: 1 | 2 = 1\n): Set<string> {\n  const usage: MemberUsage = {\n    usedProperties: new Set(),\n    hasNonStaticUsage: false,\n  };\n\n  traverseStoryboardFunction(\n    fn,\n    beforeVisitGlobalMember(usage, objectName, level),\n    silentErrors\n  );\n\n  if (usage.hasNonStaticUsage && !silentErrors) {\n    throw new Error(\n      `Non-static usage of ${objectName} is prohibited, check your function: \"${fn.name}\"`\n    );\n  }\n\n  usage.usedProperties.delete(fn.name);\n\n  return usage.usedProperties;\n}\n","import type { Storyboard } from \"@next-core/types\";\nimport type { EstreeLiteral } from \"@next-core/cook\";\nimport {\n  traverseStoryboardExpressions,\n  BeforeVisitGlobal,\n} from \"./expressions/index.js\";\nimport { traverseStoryboardFunctions } from \"./functions/index.js\";\n\nconst PERMISSIONS = \"PERMISSIONS\";\nconst check = \"check\";\n\nexport function scanPermissionActionsInStoryboard(\n  storyboard: Storyboard\n): string[] {\n  const collection = new Set<string>();\n  const beforeVisitPermissions = beforeVisitPermissionsFactory(collection);\n  const { customTemplates, functions } = storyboard.meta ?? {};\n  traverseStoryboardExpressions(\n    [storyboard.routes, customTemplates],\n    beforeVisitPermissions,\n    PERMISSIONS\n  );\n  traverseStoryboardFunctions(functions, beforeVisitPermissions);\n  return Array.from(collection);\n}\n\nexport function scanPermissionActionsInAny(data: unknown): string[] {\n  const collection = new Set<string>();\n  traverseStoryboardExpressions(\n    data,\n    beforeVisitPermissionsFactory(collection),\n    PERMISSIONS\n  );\n  return Array.from(collection);\n}\n\nfunction beforeVisitPermissionsFactory(\n  collection: Set<string>\n): BeforeVisitGlobal {\n  return function beforeVisitPermissions(node, parent): void {\n    if (node.name === PERMISSIONS) {\n      const memberParent = parent[parent.length - 1];\n      const callParent = parent[parent.length - 2];\n      if (\n        callParent?.node.type === \"CallExpression\" &&\n        callParent?.key === \"callee\" &&\n        memberParent?.node.type === \"MemberExpression\" &&\n        memberParent.key === \"object\" &&\n        (memberParent.node.computed\n          ? (memberParent.node.property as any).type === \"Literal\" &&\n            (memberParent.node.property as any).value === check\n          : memberParent.node.property.type === \"Identifier\" &&\n            memberParent.node.property.name === check)\n      ) {\n        for (const arg of callParent.node\n          .arguments as unknown as EstreeLiteral[]) {\n          if (arg.type === \"Literal\" && typeof arg.value === \"string\") {\n            collection.add(arg.value);\n          }\n        }\n      }\n    }\n  };\n}\n"],"names":["dispatchRequestEventByConfig","type","config","_config$options","options","interceptorParams","ignoreLoadingBar","window","dispatchEvent","Event","http","interceptors","request","use","response","error","Promise","reject","loadingBar","document","querySelector","classList","add","loading","count","updateLoadingStatus","hasRemainingRequests","addEventListener","requestStart","requestEnd","nextRequest","runtime","createRuntime","container","portal","root","unstable_createRoot","scope","unknownBricks","bootstrap","get","BOOTSTRAP_FILE","responseType","then","data","initialize","BOOTSTRAP_FILE_FIELD","rendering","queuedRender","_x","_queuedRender","apply","arguments","_asyncToGenerator","sources","_x2","_x3","_render","render","req","undefined","_preview_only_render","initialized","_ref","yaml","html","theme","uiVersion","context","functions","templates","i18n","styleText","templatesAreArrayOfYaml","length","body","applyTheme","remove","setUIVersion","dom","DOMParser","parseFromString","bricks","Set","node","querySelectorAll","tagName","includes","lowerTagName","toLowerCase","bricksInScript","text","matchAll","match","loadBricks","replaceChildren","scripts","scriptTags","scriptTag","newScriptTag","createElement","push","append","head","childNodes","parsed","safeLoad","schema","JSON_SCHEMA","json","concat","brick","properties","textContent","parsedContext","loadYaml","parsedFunctions","parsedTemplates","parsedI18n","e","console","String","content","map","item","_objectSpread","name","ExecutionContext","constructor","_defineProperty","EnvironmentRecord","outer","Map","this","OuterEnv","HasBinding","bindingMap","has","CreateMutableBinding","deletable","set","mutable","NormalCompletion","CreateImmutableBinding","strict","InitializeBinding","value","binding","Object","assign","SetMutableBinding","ReferenceError","TypeError","GetBindingValue","DeclarativeEnvironment","FunctionEnvironment","SourceNode","Symbol","for","FormalParameters","ECMAScriptCode","Environment","IsConstructor","ReferenceRecord","base","referenceName","Base","ReferenceName","Strict","CompletionRecord","Type","Value","Empty","collectBoundNames","names","collect","Array","isArray","n","declarations","id","elements","left","argument","from","containsExpression","some","computed","collectScopedDeclarations","nextOptions","var","Number","topLevel","kind","consequent","alternate","init","cases","block","handler","finalizer","IsPropertyReference","V","InitializeReferencedBinding","W","CopyDataProperties","target","source","excludedItems","keys","getOwnPropertyNames","getOwnPropertySymbols","nextKey","desc","getOwnPropertyDescriptor","enumerable","ForDeclarationBindingInstantiation","forDeclaration","env","isConst","LoopContinues","completion","UpdateEmpty","GetValue","ToPropertyKey","arg","GetV","P","PutValue","CreateListIteratorRecord","args","cooked","iterator","RequireObjectCoercible","GetIdentifierReference","ApplyStringOrNumericBinaryOperator","leftValue","operator","rightValue","SyntaxError","reservedObjects","WeakSet","Function","prototype","self","global","Error","getGlobal","sanitize","allowedConstructors","URLSearchParams","WeakMap","RegExp","cook","rootAst","codeSource","_hooks$beforeEvaluate3","rules","globalVariables","hooks","expressionOnly","rootEnv","rootContext","VariableEnvironment","LexicalEnvironment","executionContextStack","key","entries","TemplateMap","Evaluate","optionalChainRef","_hooks$beforeEvaluate","_hooks$beforeBranch","_hooks$beforeBranch2","beforeEvaluate","call","array","element","spreadValues","ThrowIfFunctionIsInvalid","OrdinaryFunctionCreate","getRunningContext","rightRef","right","funcName","substring","start","end","thisValue","ref","callee","func","optional","skipped","EvaluateCall","expression","test","ResolveBinding","regex","raw","flags","_leftValue","baseValue","object","_result","propertyKey","EvaluatePropertyAccessWithExpressionKey","property","identifier","propertyNameString","EvaluatePropertyAccessWithIdentifierKey","constructExpr","argList","ArgumentListEvaluation","constructorName","Date","isAllowedConstructor","_constructorName","EvaluateNew","prop","propName","EvaluateComputedPropertyName","_result2","expr","expressions","chunks","quasis","index","_expr","val","join","tagRef","tag","tagFunc","quasi","ApplyUnaryOperator","_lref","_rval","_rval2","DestructuringAssignmentEvaluation","lref","lval","rval","r","substr","ApplyStringOrNumericAssignment","oldEnv","blockEnv","BlockDeclarationInstantiation","blockValue","EvaluateStatementList","EvaluateBreakableStatement","stmtResult","DoWhileLoopEvaluation","lhs","lhsKind","uninitializedBoundNames","iterationKind","keyResult","runningContext","newEnv","exprRef","exprValue","_iterator","_key","EnumerateObjectProperties","ForInOfHeadEvaluation","stmt","iteratorRecord","destructuring","done","nextValue","next","lhsRef","iterationEnv","lhsName","BindingInitialization","result","status","return","innerResult","ForInOfBodyEvaluation","ForInOfLoopEvaluation","_node$init","ForBodyEvaluation","update","loopEnv","boundNames","dn","perIterationLets","bodyResult","ForLoopEvaluation","functionExpression","funcEnv","closure","InstantiateOrdinaryFunctionExpression","beforeBranch","v","oldValue","newValue","prefix","switchValue","discriminant","_oldEnv","_blockEnv","R","input","defaultCaseIndex","findIndex","switchCase","hasDefaultCase","A","slice","found","C","CaseClauseIsSelected","_R2","foundInB","B","_C","_R3","_C2","_R4","CaseBlockEvaluation","_R","_hooks$beforeEvaluate2","thrownValue","param","catchEnv","argName","CatchClauseEvaluation","F","_result3","declarator","_lhs2","_value","_rval3","WhileLoopEvaluation","increment","perIterationBindings","CreatePerIterationEnvironment","lastIterationEnv","thisIterationEnv","bn","lastValue","pattern","excludedNames","valueTarget","KeyedDestructuringAssignmentEvaluation","RestDestructuringAssignmentEvaluation","PropertyDestructuringAssignmentEvaluation","assignmentTarget","isObjectOrArray","_value2","_done","_nextValue","IteratorDestructuringAssignmentEvaluation","propertyName","rhsValue","restProperty","code","d","IsConstantDeclaration","_fn","_fo","InstantiateFunctionObject","templateLiteral","memo","rawObj","template","freeze","defineProperty","writable","configurable","GetTemplateObject","statements","s","sourceNode","isConstructor","_hooks$beforeCall","beforeCall","calleeContext","localEnv","PrepareForOrdinaryCall","formals","parameterNames","hasParameterExpressions","varDeclarations","varNames","functionNames","functionsToInitialize","i","_fn2","unshift","noVar","varEnv","paramName","IteratorBindingInitialization","_n","initialValue","lexEnv","lexDeclarations","_d","f","_fn3","_fo2","FunctionDeclarationInstantiation","EvaluateFunctionBody","OrdinaryCallEvaluateBody","pop","CallFunction","defineProperties","params","environment","InitializeBoundName","RestBindingInitialization","KeyedBindingInitialization","PropertyBindingInitialization","restObj","_node","_value3","_A","_n2","_done2","_value4","bindingElement","_done3","_value5","_lhs3","_v","_done4","_value6","_v2","async","generator","fn","fo","AnalysisContext","AnalysisEnvironment","bindingSet","CreateBinding","precook","visitors","withParent","attemptToVisitGlobals","analysisContextStack","EvaluateChildren","parent","forEach","_hooks$beforeVisit","_hooks$beforeVisitUnk","beforeVisit","hasOwnProperty","visit","_hooks$beforeVisitGlo","beforeVisitGlobal","_runningContext","BoundNamesInstantiation","lexicalBinding","_runningContext2","_oldEnv2","_lexicalBinding","_runningContext3","_oldEnv3","_env","_runningContext4","_oldEnv4","beforeVisitUnknown","warn","precookFunction","typescript","restOptions","_objectWithoutProperties","_excluded","parse","plugins","filter","Boolean","strictMode","attachComment","program","jsNodes","startsWith","parseAsEstree","function","preevaluate","fixes","replace","m","parseExpression","proposal","parseAsEstreeExpression","suffix","isEvaluable","shouldAllowRecursiveEvaluations","isTrackAll","fetch","Request","credentials","HttpFetchError","message","super","captureStackTrace","HttpResponseError","responseJson","statusText","HttpParseError","HttpAbortError","InterceptorManager","onFulfilled","onRejected","handlers","fulfilled","rejected","eject","isNil","fullBaseHref","href","location","origin","isHttpAbortError","DOMException","url","_ref2","resolve","toString","ok","headers","_x4","_x5","getUrlWithParams","parsedUrl","URL","searchParams","_ref3","getBodyAndHeaders","parsedHeaders","Headers","contentTypeHeader","FormData","JSON","stringify","defaultAdapter","method","simpleRequest","_ref4","observe","noAbortOnRouteChange","useCache","requestInit","requestWithBody","_ref5","_excluded2","_adapter","_fetch","Http","_config","_this","_classPrivateMethodInitSpec","_classPrivateFieldInitSpec","_ref6","_ref7","_excluded3","_classPrivateMethodGet","_fetch2","_x6","_x7","_x8","adapter","_classPrivateFieldSet","delete","post","put","patch","chain","promise","interceptor","_classPrivateFieldGet","res","_interceptor$fulfille","_interceptor$rejected","shift","HttpModule","HttpModuleV2","createHttpInstance","dll","_window$BRICK_NEXT_VE","BRICK_NEXT_VERSIONS","HttpModuleV3","initializedNamespaces","initializeI18n","NS","locales","LanguageDetector","fallbackLng","debug","process","supportedLngs","nonExplicitSupportedLngs","interpolation","escapeValue","react","useSuspense","compatibilityJSON","resources","lang","addResourceBundle","i18nText","_i18n$language","language","primaryLanguage","split","i18next","LexicalStatus","TokenType","JsonValueType","getRegExpOfPlaceholder","symbols","symbol","escapeRegExp","eatOptionalRawAndOptionalPlaceholderBegin","_subRaw$match","subRaw","getSubRaw","matchedPlaceholder","beginPlaceholder","subCursor","indexOf","charAt","nextCursor","cursor","tokens","Raw","BeginPlaceHolder","loc","ExpectField","eatWhitespace","eatField","Field","ExpectOptionalBeginDefault","eatOptionalDefault","BeginDefault","ExpectDefaultValue","ExpectOptionalBeginPipe","eatDefaultValue","eatJsonValueOrLiteralString","eatOptionalBeginPipe","BeginPipe","ExpectPipeIdentifier","ExpectPlaceholderEnd","eatPipeIdentifier","matches","PipeIdentifier","ExpectOptionalBeginPipeParameter","eatOptionalBeginPipeParameter","BeginPipeParameter","ExpectPipeParameter","eatPipeParameter","eatPlaceholderEnd","EndPlaceHolder","Initial","jsonLiteralMap","nextStatus","firstChar","valueType","Others","objectBracesToMatch","arrayBracketsToMatch","stringQuotesToClose","stringBackslashToEscape","matched","char","JsonValue","eatJsonValue","LiteralString","transform","compile","inject","transformAndInject","isInjectable","values","transformNode","field","defaultValue","processPipes","pipes","injectNode","_context$overrideApp","_context$overrideApp2","namespace","subField","SimpleContextMap","SYS","FLAGS","query","getAll","event","overrideApp","app","hash","anchor","original","injectNodeFactory","token","tree","optionalToken","acceptToken","placeholder","pipe","parameters","parseTokens","tokenize","parseInjectableString","cache","loadScriptOrStyle","src","attrs","all","fixedSrc","cachedPromise","rel","onload","onerror","firstScript","currentScript","getElementsByTagName","parentNode","insertBefore","loadScript","loadStyle","resolveBasicPkg","loadSharedModule","_loadSharedModule","module","__webpack_init_sharing__","__webpack_share_scopes__","default","v2AdapterPromise","basicPkgWillBeResolved","waitBasicPkg","flushStableLoadBricks","enqueueStableLoadBricks","brickPackages","dispatchRequestStatus","enqueueStableLoad","enqueueStableLoadProcessors","processors","loadBricksImperatively","_loadBricksImperatively","loadProcessorsImperatively","V2_ADAPTER_LOAD_BRICKS","getItemsByPkg","list","brickPackagesMap","itemsByPkg","listToLoad","_pkg$dependencies","pkg","lastName","pkgId","toLocaleLowerCase","p","_p$elements","groupItems","fullName","deps","dependencies","dep","loadBrickModule","_loadBrickModule","moduleName","loadRestBricks","pkgs","itemsMap","_window$PUBLIC_ROOT","filePath","PUBLIC_ROOT","_x9","_enqueueStableLoad","_pkg$id","getPkgIdByFilePath","foundBasicPkg","maybeV2Adapter","v2Packages","v3PackagesOtherThanBasic","_pkg","basicPkgPromise","v2Adapter","basicPkg","_window$PUBLIC_ROOT2","tempPromise","pkgPromises","v2AdapterItemsByPkg","v2AdapterPackages","loadV2Adapter","pkgNamespace","_x10","_dispatchRequestStatus","PipeRegistry","registeredPipe","getBasePath","getAttribute","matchStoryboard","storyboards","pathname","sortedStoryboards","orderBy","storyboard","_storyboard$app$homep","_storyboard$app$homep2","homepage","matchHomepage","isOutsideApp","_getRuntime$getCurren","getRuntime","getCurrentApp","STANDALONE_MICRO_APPS","standaloneMode","history","blocked","getUserConfirmation","callback","confirm","getV2RuntimeFromDll","createHistory","browserHistory","createBrowserHistory","basename","blockMessage","originalPush","originalReplace","state","updateQueryFactory","extraQuery","clear","keepHash","urlSearchParams","search","pushQuery","replaceQuery","pushAnchor","notify","reload","setBlockMessage","getBlockMessage","unblock","updateFactory","path","pathIsString","parsePath","_bootstrapData$storyb","_bootstrapData8","bootstrapData","_internalApiMatchStoryboard","createHref","historyOverridden","historyExtended","getHistory","v2Kit","getHistoryV2Factory","_registry","customProcessors","define","processorFullName","processorFunc","registerCustomProcessor","getCustomProcessorsV2","processorName","registerAppI18n","meta","i18nNamespace","getI18nNamespace","languages","removeResourceBundle","widgetI18nFactory","widgetId","getFixedT","selectedPanel","registerWidgetI18n","i18nData","registerWidgetI18nV2Factory","ns","MESSAGE_SOURCE_PANEL","FRAME_ACTIVE_CHANGE","PANEL_CHANGE","frameIsActive","devtoolsHookEmit","payload","devtools","getDevHook","emit","_devtools$emit","requestIdleCallback","setTimeout","__BRICK_NEXT_DEVTOOLS_HOOK__","THROW","readOnlyHandler","deleteProperty","setPrototypeOf","getReadOnlyProxy","Proxy","getDynamicReadOnlyProxy","ownKeys","fromEntries","storage","JsonStorage","localStorage","LOCAL_STORAGE_APPS_THEME_KEY","setTheme","getTheme","getCurrentTheme","documentElement","dataset","CustomEvent","detail","batchSetAppsLocalTheme","appsTheme","setItem","getLocalAppsTheme","getItem","_unused","mode","setMode","getCurrentMode","applyMode","getCssPropertyValue","_window$getComputedSt","el","getComputedStyle","getPropertyValue","getGeneralGlobals","variableName","variable","getIndividualGlobal","_hooks$images","_hooks$images2","_hooks$checkPermissio","collectCoverage","widgetVersion","appendI18nNamespace","storyboardFunctions","isStoryboardFunction","images","widgetImagesFactory","imagesFactory","isBuildPush","currentVersion","identity","fakeI18nText","check","fakeCheckPermissions","checkPermissions","host","hostname","en","StoryboardFunctionRegistryFactory","currentApp","registeredFunctions","collector","processed","createCollector","precooked","supply","getStoryboardFunction","registerStoryboardFunctions","collectMemberUsageInFunction","hasPermissionsCheck","updateStoryboardFunction","newFn","checkPermissionsUsage","checkedFunctions","MediaBreakpoint","mediaBreakpointMinWidthMap","xLarge","large","medium","small","xSmall","mediaEventTarget","EventTarget","breakpointMatchesMap","MEDIA","handleMatchesChange","breakpoint","changed","_breakpoint","minWidth","mediaQueryList","matchMedia","addListener","getMedia","getStorageItem","storageType","_storage$getItem","sessionStorage","isStrictMode","runtimeContext","_getRuntime","getFeatureFlags","warnAboutStrictMode","_len","extraLogs","punctuation","allowedNativeProps","customTemplates","registerCustomTemplate","getCustomTemplatesV2","_constructor$proxy$pr","_constructor$proxy","_compatibleConstructo","_compatibleConstructo2","registered","customElements","proxyProperties","proxy","validProxyProps","legacyTplVariables","asVariable","mergeProperty","refTransform","compatibleConstructor","expose","tpl","_state$filter$map","exposedStates","uniq","proxyMethods","methods","props","entry","nativeProps","HTMLElement","TplElement","$$typeof","_dev_only_definedProperties","_dev_only_definedMethods","$$getElementByRef","_this$$$tplStateStore","$$tplStateStore","hostBrick","tplHostMetadata","internalBricksByRef","connectedCallback","shadowRoot","attachShadow","fragment","createDocumentFragment","style","slot","appendChild","disconnectedCallback","_loop","getValue","_this$$$tplStateStore2","updateValue","_loop2","to","_to$refProperty","refProperty","_this$$$getElementByR","_to$refProperty2","_loop3","_from","_to","_to$refMethod","refMethod","getTplStateStore","using","extraInfo","tplStateStoreId","tplStateStoreMap","store","getTplHostElement","hostElement","widgetFunctionRegistry","widgetFunctions","registerWidgetFunctions","registerWidgetFunctionsV2Factory","hasInstalledApp","appId","matchVersion","_internalApiGetAppInBootstrapData","checkInstalledApps","getCheckedApp","installStatus","compare","getFormStateStore","formStateStoreId","formStateStoreMap","pool","getProviderBrick","_getProviderBrick","provider","_hooks$flowApi","isFlowApi","flowApi","isFlowApiProvider","FLOW_API_PROVIDER","registerFlowApiProvider","getBrickPackages","markAsComputed","isObject","hasBeenComputed","proto","getPrototypeOf","resolveData","_resolveData","resolveConf","useProvider","onReject","legacyProvider","legacyField","hasLegacyField","providerBrick","actualArgs","asyncComputeRealValue","renderId","resolveByProvider","_internalApiGetRenderId","isHandleRejectByTransform","_resolveByProvider","originalArgs","stale","cacheKey","finalArgs","getArgsOfFlowApi","symbolForRaw","symbolForContext","isPreEvaluated","getPreEvaluatedRaw","pre","shouldDismissMarkingComputed","possibleErrorConstructs","getCookErrorConstructor","_asyncEvaluate","blockingList","run","lowLevelEvaluate","isAsync","passByRuntimeContext","omit","menuUsage","usedArgs","hasAppUsage","collectAppGetMenuUsage","collectInstalledAppsHasUsage","hasNonStaticUsage","usedCtx","usedProcessors","usedStates","tplStateStore","lazy","usedFormStates","formStateStore","devHook","strictCollectMemberUsage","ctxStore","waitFor","usedTpls","_hooks$checkInstalled","attemptToCheckPermissions","usedFunctions","pendingPermissionsPreCheck","size","menu","usedMenuIds","menuId","fetchMenuById","getStoryboardByAppId","_internalApiGetStoryboardInBootstrapData","waitForCheckingApps","_runtimeContext$overr","_hooks$menu","_match$params","sys","cloneDeep","getMenu","getMenuById","getMiscSettings","t","k","processor","_message","StateOfUseBrick","isLazyContentInUseBrick","USE_BRICK_PROPERTIES","USE_BRICK_TRANSFORM","USE_BRICK_EVENTS","USE_BRICK_IF","USE_BRICK_LIFECYCLE","USE_BRICK_DATA_SOURCE","getNextStateOfUseBrick","USE_BRICK","USE_BRICK_ITEM","USE_BRICK_SLOTS_ITEM_BRICKS","USE_BRICK_SLOTS_ITEM_BRICKS_ITEM","INITIAL","USE_BRICK_SLOTS","USE_BRICK_SLOTS_ITEM","_asyncComputeRealValue","internalOptions","preEvaluated","$$lazyForUseBrick","$$stateOfUseBrick","dismissMarkingComputed","asyncEvaluate","noInject","getNextComputeOptions","ignoreSymbols","computeRealValue","evaluate","asyncCheckIf","_asyncCheckIf","ifContainer","if","checkIf","checkIfOfComputed","_asyncCheckBrickIf","brickConf","checkIfByTransform","looseCheckIfByTransform","checkIfByTransformV2Factory","getTracks","contextNames","stateNames","formStateNames","trackAll","formState","track","computePropertyValue","_computePropertyValue","asyncPropertyEntries","asyncValue","ignoreUndefined","constructAsyncProperties","_constructAsyncProperties","setRealProperties","realProps","propValue","setProperties","realValue","computeRealProperties","cacheLimit","cacheCount","matchPath","exact","sensitive","reduce","regexp","pathCache","cacheResult","pathToRegexp","compilePath","exec","isExact","_matchRoutes","routes","route","matchRoute","noAuthGuard","public","auth","isLoggedIn","symbolForAsyncComputedPropsFromHost","symbolForTplStateStoreId","symbolForTPlExternalForEachItem","symbolForTPlExternalForEachIndex","timeoutIdList","K","REQUEST_FAILED","SOMETHING_WENT_WRONG","LOGIN_TIMEOUT_MESSAGE","NETWORK_ERROR","zh","Dialog","show","alert","setLoginStateCookie","pathValue","btoa","encodeURIComponent","searchValue","cookie","httpErrorToString","HTMLScriptElement","msg","isUnauthenticatedError","lastErrorMessage","unauthenticatedConfirming","handleHttpError","NO_AUTH_GUARD","ssoEnabled","title","contentStyle","whiteSpace","wordBreak","Notification","bindListeners","eventsMap","eventType","listener","listenerFactory","$$listeners","$$eventListeners","isBuiltinHandler","action","isUseProviderHandler","isCustomHandler","targetRef","isConditionalEventHandler","runtimeBrick","_handler$batch","_handler$batch2","handleHistoryAction","handleWindowAction","handleLocationAction","handleStorageAction","preventDefault","handleConsoleAction","handleMessageAction","handleContextAction","batch","handleTplStateAction","argsFactory","handleFormStateAction","handleMessageDispatcher","handleUseProviderAction","handleCustomAction","else","_handleUseProviderAction","brickCallback","targets","rawTarget","rawTargetRef","computedTarget","multiple","computedTargetRef","targetRefs","tplHostElement","_tplHostElement$$$get","isExecuteCustomHandler","useEventAsDefault","isSetPropsCustomHandler","_x11","_brickCallback","_poll","task","computedArgs","poll","callbackFactory","eventCallbackFactory","pollableCallback","progress","success","finally","enabled","currentTimeoutId","finallyCallback","interval","leadingRequestDelay","continueOnError","delegateLoadingBar","expectPollEnd","expectPollStopImmediately","currentRenderId","shouldStop","delayedPoll","delay","startPoll","err","baseArgsLength","hasCallback","overrideMethod","useEventDetailAsDefault","features","open","batchUpdate","updateValues","every","removeItem","_x12","_x13","_x14","_x15","_x16","_x17","_handleMessageDispatcher","_hooks$messageDispatc","messageDispatcher","supportContextResolveTriggerBrickLifeCycle","DataStore","rendererContext","changeEventType","getAllValues","_this$data$get","getAffectListByContext","affectNames","batchUpdateContextsNames","updateContexts","affectContexts","affectDepsContextNames","updateContextItem","affectContextItem","triggerEvent","contexts","_context$eventTarget","eventTarget","callbackRuntimeContext","load","loaded","shouldDismiss","_this$rendererContext","dataConfs","asyncHostPropertyEntries","routePath","pending","contextConfs","resolveContext","keyword","dependencyMap","depsMap","_contextConf","stats","collectMemberUsage","getDependencyMapOfContext","pendingDeps","contextName","contextConf","_pendingDeps$get","deferredContexts","pendingContexts","wrapResolve","_pendingDeps$get2","resolved","scheduleNext","scheduleAsSerial","_scheduleNext","readyContexts","usedProperties","predicateNextResolveFactory","pendingResult","deferred","duplicatedMap","processedAtLeastOne","_contextConf2","detectCircularContexts","catch","resolveDataStore","dataConf","pendingStack","onChange","dataName","_this$data$get2","dataNames","ctx","waitForAll","_this2","mountAsyncData","_this$routeMap$get","routeMap","asyncMounted","_this3","resolvePolicy","_this3$rendererContex","newData","_this3$rendererContex2","trigger","registerArbitraryLifeCycle","batchAddListener","disposeDataInRoutes","setupTemplateProxy","hostContext","slots","asyncComputedProps","asyncHostProps","reversedProxies","externalSlots","propertyProxies","filtered","slotProxies","quasisMap","_externalSlots$from$b","_externalSlots$from","_to$refSlot","_to$refPosition","insertBricks","refToSlot","refSlot","expandableSlot","refPosition","clamp","setupTemplateExternalBricks","forEachItem","forEachIndex","slotName","slotConf","flatMap","_brick$slots","_slotConf$bricks","setupTemplateExternalRoutes","setupUseBrickInTemplate","walk","setup","originalSlots","children","restConf","transpiledSlots","childrenToSlots","expandCustomTemplate","tplTagName","uniqueId","tplStateStoreScope","contracts","collectWidgetContract","originalExternalSlots","externalChildren","restBrickConf","newBrickConf","proxies","_proxies","expandBrickInTemplate","brickConfInTemplate","slotsInTemplate","childrenInTemplate","restBrickConfInTemplate","RenderTag","FORM_RENDERER","symbolForFormStateStoreId","formContainers","formSchemaToBrick","fields","events","mountPoint","instanceId","iid","find","fieldId","defaults","commonProps","label","testid","getReadOnlyAndRequired","_field$limit","_field$limit2","readOnly","limit","required","fieldType","description","precision","inputBoxStyle","width","getDefaultProperties","formSchemasToBricks","schemas","renderRoutes","_renderRoutes","returnNode","_runtimeContext","parentRoutes","slotId","isIncremental","matchRoutes","output","menuRequests","unauthenticated","preCheckPermissionsForBrickOrRoute","preLoadBricks","redirectTo","redirect","menuRequest","menuConf","loadMenu","mergeRenderOutput","renderBricks","BRICK","memoizeMenuRequests","_renderBricks","tplStack","keyPath","kPath","renderBrick","hasTrackingControls","memoize","_x18","_x19","_x20","_x21","_renderBrick","_hooks$checkPermissio2","_runtimeContext$app","brickIf","permissionsPreCheck","isGeneralizedTrackAll","dataSource","acc","asyncCheckBrickIf","brickName","_brickConf$lifeCycle","ensureValidControlBrick","lowerLevelRenderControlNode","_slots$slot","computedDataSource","_x22","_x23","_x24","_x25","_x26","_x27","_x28","_x29","_x30","_renderForEach","renderForEach","_x31","renderControlNode","_rawOutput$node","rawOutput","PLACEHOLDER","_x32","controlledOutput","onMount","onUnmount","lifeCycle","scopedRuntimeContext","formStateStoreScope","createScopedRuntimeContext","reControlledOutput","scopedStores","postAsyncRender","rerender","reRender","debouncedListener","debounce","_contextName","catchLoad","formData","confProps","getTagNameOfCustomTemplate","_tplStack$get","tplCount","_brickConf$properties","trackingContextList","asyncComputeRealPropertyEntries","computedPropsFromHost","isScript","_excluded4","_excluded5","loadProperties","stateName","_stateName","listenOnTrackingContext","registerBrickLifeCycle","childRuntimeContext","expandedBrickConf","hostBrickConf","_normalizedFormData$c","_hostBrickConf$proper","normalizedFormData","formConf","formSchema","targetEvents","sourceEvents","flat","mergeEvents","renderRoot","padding","expandFormRenderer","loadChildren","routeSlotIndexes","rendered","childSlotId","performIncrementalRender","_ref8","incrementalOutput","failed","reBailout","reMergeMenuRequests","reCatch","_x33","childrenOutput","child","rows","j","getDataStores","stores","newOutput","rest","last","sibling","newSlots","_child$slot","unknownPolicy","bindTemplateProxy","_tplHostMetadata$prox","_to$refEvent","_ref$$$proxyListeners","bubbles","stopPropagation","cancelable","composed","refEvent","$$proxyListeners","unbindTemplateProxy","_$$proxyListeners","removeEventListener","unmountTree","mountTree","initializedElement","current","portalElements","_current$tplHostMetad","setAttribute","childElements","_currentReturn","currentReturn","_currentReturn$contai","ROOT","createPortal","misc","nativeController","commonLifeCycles","pageOnlyLifeCycles","_routeHelper","_memoizedLifeCycle","_observers","_mediaListener","_arbitraryLifeCycle","_memoized","_allMenuRequests","_memoizedMenuRequestMap","_locationChangeCallbacks","_unmountBricks","_initializeRerenderBricks","_dispatchGeneralLifeCycle","_addObserver","RendererContext","_options$unknownBrick","onBeforePageLoad","onPageLoad","onPageLeave","onBeforePageLeave","onAnchorLoad","onAnchorUnload","onMediaChange","onScrollIntoView","onMessage","onMessageClose","routeHelper","setInitialMenuRequests","currentRoute","previousMenuRequest","previousRoute","mergedMenuRequests","previousIndex","splice","mergeMenus","bailout","didPerformIncrementalRender","lifeCycleTypes","isEmpty","useResolves","arbitraryCallbacks","memKey","mem","getLastNode","lastNormal","getLastNormalNode","lastPortal","getLastPortalNode","insertBeforeChild","insertPortalBeforeChild","_getNextNormalNode$el","_getNextNormalNode","_getNextPortalNode$el","_getNextPortalNode","_prevLastNormal$eleme","_prevLastNormal$eleme2","_prevLastPortal$eleme","_prevLastPortal$eleme2","memoized","prevNode","prevLast","prevLastNormal","prevLastPortal","getSpecifiedNormalNode","getNextNormalNode","getSpecifiedPortalNode","getNextPortalNode","nextSibling","prevSibling","portalFragment","_returnNode$container","_returnNode$element","removeBricks","getBrickRange","_unmountBricks2","_root","newBricks","_initializeRerenderBricks2","dispose","_list","observer","disconnect","dispatchBeforePageLoad","_dispatchGeneralLifeCycle2","dispatchPageLoad","dispatchBeforePageLeave","dispatchPageLeave","dispatchAnchorLoad","initializeScrollIntoView","conf","_addObserver2","initializeMediaChange","initializeMessageDispatcher","_hooks$messageDispatc2","channel","confList","onClose","dispatchOnMount","dispatchOnUnmount","unmountList","removed","_brick$element","_brick$element2","observers","unmountEvent","_brick","mountEvent","_brick2","_conf$threshold","threshold","IntersectionObserver","isIntersecting","intersectionRatio","_last","range","_currentReturn2","getPageInfo","isInIframe","isInIframeOfSameSite","isInIframeOfNext","isInIframeOfVisualBuilder","isInIframeOfLegacyConsole","selfIsNext","parentPathname","parentIsNext","registerCustomTemplates","_storyboard$meta","$$registerCustomTemplateProcessed","_fulfilStoryboard","$$fulfilled","$$fulfilling","_doFulfilStoryboard","doFulfilStoryboard","_hooks$fulfilStoryboa","fulfilStoryboard","version","ui","_storyboards","_rendering","_prevLocation","_nextLocation","_rendererContext","_rendererContextTrashCan","_redirectCount","_renderId","_currentApp","_previousApp","_navConfig","_getBlockMessageBeforePageLave","_safeRedirect","Router","_history","_getBlockMessageBeforePageLave2","returnValue","getRenderId","getRuntimeContext","getRecentApps","previousApp","getNavConfig","AbortController","signal","listen","_classPrivateFieldGet2","_location$state","_classPrivateFieldGet4","ignoreRendering","_classPrivateFieldGet3","omittedLocationProps","locationsAreEqual","abort","_queuedRender2","_classPrivateFieldGet5","previousMessage","_safeRedirect2","_this$redirectCount","_this$redirectCount2","_queuedRender3","_render2","nextLocation","_render3","_hooks$pageView","_classPrivateFieldGet6","clearCollectWidgetContract","finishPageView","pageView","create","appChanged","prevRendererContext","redirectToLogin","main","cleanUpPreviousRender","reset","_hooks$auth","_hooks$flowApi2","_storyboard$meta2","preCheckInstalledApps","menuConfs","navConfig","breadcrumb","overwrite","items","mergeMenuConfs","noAuthGuardLoginPath","getAuth","settings","brand","getBrandSettings","preCheckPermissions","collectContract","mergedRoutes","specificTemplatePreviewIndex","findLastIndex","specificSnippetPreviewIndex","insertPreviewRoutes","DISABLE_REACT_FLUSH_SYNC","scrollTo","pageTitle","router","injectedBrickPackages","BRICK_PACKAGES","applyColorTheme","getStyleByBrandColor","getStyleByBaseColors","backgroundColor","getStyleByVariables","active","panel","moment","on","Runtime","Reflect","getRuntimeV2Factory","_initialized","_bootstrapped","_getPresetBricks","_data$settings","localeName","deepFreeze","normalizeBootstrapData","notification","dialog","_getPresetBricks2","loadNotificationService","loader","loadDialogService","brandColor","baseColors","variables","customizeColorTheme","_router$getRecentApps","_router","_router2","_bootstrapData","_router3","featureFlags","_bootstrapData2","_router4","_bootstrapData3","base_title","getLaunchpadSettings","_bootstrapData4","columns","launchpad","getDesktops","_bootstrapData$deskto","_bootstrapData5","desktops","getLaunchpadSiteMap","_bootstrapData$siteSo","_bootstrapData6","siteSort","toggleLaunchpadEffect","toggle","applyPageTitle","baseTitle","_router5","_bootstrapData$settin","_bootstrapData10","presetBricks","_bootstrapData$brickP","_bootstrapData7","STANDALONE_BRICK_PACKAGES","_router6","_internalApiGetRuntimeContext","_router7","_bootstrapData9","_internalApiGetStoryb","authenticate","_hooks$auth$authentic","_hooks$auth2","logout","_hooks$auth3","_hooks$auth3$logout","_hooks$auth4","fetchByProvider","_fetchByProvider","_portal","position","height","clearI18nBundles","unmounted","_arguments","previousRendererContext","_clearI18nBundles","demoApp","demoStoryboard","unmount","renderUseBrick","_renderUseBrick","useBrick","_scopedRuntimeContext","_scopedRuntimeContext2","_output$node","_output$node2","mountUseBrick","portalRoot","unmountUseBrick","mountResult","legacyDoTransform","updateStoryboard","storyboardPatch","updateStoryboardByRoute","newRoute","getKey","replaceRoute","routeKey","updateStoryboardByTemplate","newTemplate","tplName","updateTemplatePreviewSettings","templateId","_updatePreviewSettings","pick","getSnippetPreviewPath","snippetId","updateStoryboardBySnippet","snippetData","_snippetData$bricks","updateSnippetPreviewSettings","previewRouteIndex","newPreviewRoute","getContextValue","getAllContextValues","getBrickPackagesById","getAddedContracts","_getAddedContracts","updatedStoryboard","updateStoryboardType","collectUsedContracts","_storyboard$routes","snippetPreviewPath","addedContracts","api","_","namespaceId","contract","providedGlobalVariables","mock","supplyIndividual","shouldOmitInLodash","shouldOmitInMoment","allowedGlobalObjects","lodash","tagUrlFactory","ignoreSlashes","strings","_len2","partials","_key2","str","createProviderClass","propNames","_this$storage$getItem","unwrapProvider","beforeVisitGlobalMember","usage","objectName","level","rememberObjectName","segments","memberParent","memberNode","collectMemberCallUsageFactory","callParent","firstArg","traverseStoryboardExpressions","matchExpressionString","visitNotMatchedExpressionString","visitNonExpressionString","visitObject","traverse","nonStaticUsage","trackText","trackCtxExp","usedProperites","keyMap","CTX","STATE","FORM_STATE","traverseStoryboardFunctions","traverseStoryboardFunction","silentErrors","PERMISSIONS","scanPermissionActionsInStoryboard","collection","beforeVisitPermissions","beforeVisitPermissionsFactory","scanPermissionActionsInAny"],"sourceRoot":""}